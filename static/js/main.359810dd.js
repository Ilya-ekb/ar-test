/*! For license information please see main.359810dd.js.LICENSE.txt */
!function(){"use strict";var e={463:function(e,t,n){var r=n(791),a=n(296);function i(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function u(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(s[e]=t,e=0;e<t.length;e++)o.add(t[e])}var l=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function m(e,t,n,r,a,i,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=o}var v={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){v[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];v[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){v[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){v[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){v[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){v[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){v[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){v[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){v[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var g=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function b(e,t,n,r){var a=v.hasOwnProperty(t)?v[t]:null;(null!==a?0!==a.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,a,r)&&(n=null),r||null===a?function(e){return!!d.call(f,e)||!d.call(p,e)&&(h.test(e)?f[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):a.mustUseProperty?e[a.propertyName]=null===n?3!==a.type&&"":n:(t=a.attributeName,r=a.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(a=a.type)||4===a&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(g,y);v[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(g,y);v[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(g,y);v[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){v[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),v.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){v[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var x=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for("react.element"),k=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),I=Symbol.for("react.provider"),E=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),M=Symbol.for("react.suspense"),N=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),L=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var A=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var P=Symbol.iterator;function D(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=P&&e[P]||e["@@iterator"])?e:null}var O,z=Object.assign;function F(e){if(void 0===O)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);O=t&&t[1]||""}return"\n"+O+e}var G=!1;function W(e,t){if(!e||G)return"";G=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var a=c.stack.split("\n"),i=r.stack.split("\n"),o=a.length-1,s=i.length-1;1<=o&&0<=s&&a[o]!==i[s];)s--;for(;1<=o&&0<=s;o--,s--)if(a[o]!==i[s]){if(1!==o||1!==s)do{if(o--,0>--s||a[o]!==i[s]){var u="\n"+a[o].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=o&&0<=s);break}}}finally{G=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?F(e):""}function V(e){switch(e.tag){case 5:return F(e.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return e=W(e.type,!1);case 11:return e=W(e.type.render,!1);case 1:return e=W(e.type,!0);default:return""}}function U(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case S:return"Fragment";case k:return"Portal";case _:return"Profiler";case T:return"StrictMode";case M:return"Suspense";case N:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case E:return(e.displayName||"Context")+".Consumer";case I:return(e._context.displayName||"Context")+".Provider";case C:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case R:return null!==(t=e.displayName||null)?t:U(e.type)||"Memo";case L:t=e._payload,e=e._init;try{return U(e(t))}catch(n){}}return null}function X(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return U(t);case 8:return t===T?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function B(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function H(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function Z(e){e._valueTracker||(e._valueTracker=function(e){var t=H(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var a=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(e){r=""+e,i.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function K(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=H(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function j(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Y(e,t){var n=t.checked;return z({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Q(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=B(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function J(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function q(e,t){J(e,t);var n=B(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,B(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&j(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&r&&(e[n].defaultSelected=!0)}else{for(n=""+B(n),t=null,a=0;a<e.length;a++){if(e[a].value===n)return e[a].selected=!0,void(r&&(e[a].defaultSelected=!0));null!==t||e[a].disabled||(t=e[a])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(i(91));return z({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ae(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(i(92));if(te(n)){if(1<n.length)throw Error(i(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:B(n)}}function ie(e,t){var n=B(t.value),r=B(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ue(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,le,de=(le=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return le(e,t)}))}:le);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function ve(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),a=me(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,a):e[n]=a}}Object.keys(pe).forEach((function(e){fe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]}))}));var ge=z({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ge[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(i(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(i(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(i(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(i(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xe=null;function we(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var ke=null,Se=null,Te=null;function _e(e){if(e=ba(e)){if("function"!==typeof ke)throw Error(i(280));var t=e.stateNode;t&&(t=wa(t),ke(e.stateNode,e.type,t))}}function Ie(e){Se?Te?Te.push(e):Te=[e]:Se=e}function Ee(){if(Se){var e=Se,t=Te;if(Te=Se=null,_e(e),t)for(e=0;e<t.length;e++)_e(t[e])}}function Ce(e,t){return e(t)}function Me(){}var Ne=!1;function Re(e,t,n){if(Ne)return e(t,n);Ne=!0;try{return Ce(e,t,n)}finally{Ne=!1,(null!==Se||null!==Te)&&(Me(),Ee())}}function Le(e,t){var n=e.stateNode;if(null===n)return null;var r=wa(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(i(231,t,typeof n));return n}var Ae=!1;if(l)try{var Pe={};Object.defineProperty(Pe,"passive",{get:function(){Ae=!0}}),window.addEventListener("test",Pe,Pe),window.removeEventListener("test",Pe,Pe)}catch(le){Ae=!1}function De(e,t,n,r,a,i,o,s,u){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(l){this.onError(l)}}var Oe=!1,ze=null,Fe=!1,Ge=null,We={onError:function(e){Oe=!0,ze=e}};function Ve(e,t,n,r,a,i,o,s,u){Oe=!1,ze=null,De.apply(We,arguments)}function Ue(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Xe(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Be(e){if(Ue(e)!==e)throw Error(i(188))}function He(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ue(e)))throw Error(i(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(null===a)break;var o=a.alternate;if(null===o){if(null!==(r=a.return)){n=r;continue}break}if(a.child===o.child){for(o=a.child;o;){if(o===n)return Be(a),e;if(o===r)return Be(a),t;o=o.sibling}throw Error(i(188))}if(n.return!==r.return)n=a,r=o;else{for(var s=!1,u=a.child;u;){if(u===n){s=!0,n=a,r=o;break}if(u===r){s=!0,r=a,n=o;break}u=u.sibling}if(!s){for(u=o.child;u;){if(u===n){s=!0,n=o,r=a;break}if(u===r){s=!0,r=o,n=a;break}u=u.sibling}if(!s)throw Error(i(189))}}if(n.alternate!==r)throw Error(i(190))}if(3!==n.tag)throw Error(i(188));return n.stateNode.current===n?e:t}(e))?Ze(e):null}function Ze(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ze(e);if(null!==t)return t;e=e.sibling}return null}var Ke=a.unstable_scheduleCallback,je=a.unstable_cancelCallback,Ye=a.unstable_shouldYield,Qe=a.unstable_requestPaint,Je=a.unstable_now,qe=a.unstable_getCurrentPriorityLevel,$e=a.unstable_ImmediatePriority,et=a.unstable_UserBlockingPriority,tt=a.unstable_NormalPriority,nt=a.unstable_LowPriority,rt=a.unstable_IdlePriority,at=null,it=null;var ot=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(st(e)/ut|0)|0},st=Math.log,ut=Math.LN2;var ct=64,lt=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,a=e.suspendedLanes,i=e.pingedLanes,o=268435455&n;if(0!==o){var s=o&~a;0!==s?r=dt(s):0!==(i&=o)&&(r=dt(i))}else 0!==(o=n&~a)?r=dt(o):0!==i&&(r=dt(i));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&a)&&((a=r&-r)>=(i=t&-t)||16===a&&0!==(4194240&i)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)a=1<<(n=31-ot(t)),r|=e[n],t&=~a;return r}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ft(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function vt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function gt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-ot(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-ot(n),a=1<<r;a&t|e[r]&t&&(e[r]|=t),n&=~a}}var bt=0;function xt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var wt,kt,St,Tt,_t,It=!1,Et=[],Ct=null,Mt=null,Nt=null,Rt=new Map,Lt=new Map,At=[],Pt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Dt(e,t){switch(e){case"focusin":case"focusout":Ct=null;break;case"dragenter":case"dragleave":Mt=null;break;case"mouseover":case"mouseout":Nt=null;break;case"pointerover":case"pointerout":Rt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Lt.delete(t.pointerId)}}function Ot(e,t,n,r,a,i){return null===e||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[a]},null!==t&&(null!==(t=ba(t))&&kt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==a&&-1===t.indexOf(a)&&t.push(a),e)}function zt(e){var t=ya(e.target);if(null!==t){var n=Ue(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Xe(n)))return e.blockedOn=t,void _t(e.priority,(function(){St(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ft(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Yt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=ba(n))&&kt(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);xe=r,n.target.dispatchEvent(r),xe=null,t.shift()}return!0}function Gt(e,t,n){Ft(e)&&n.delete(t)}function Wt(){It=!1,null!==Ct&&Ft(Ct)&&(Ct=null),null!==Mt&&Ft(Mt)&&(Mt=null),null!==Nt&&Ft(Nt)&&(Nt=null),Rt.forEach(Gt),Lt.forEach(Gt)}function Vt(e,t){e.blockedOn===t&&(e.blockedOn=null,It||(It=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,Wt)))}function Ut(e){function t(t){return Vt(t,e)}if(0<Et.length){Vt(Et[0],e);for(var n=1;n<Et.length;n++){var r=Et[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Ct&&Vt(Ct,e),null!==Mt&&Vt(Mt,e),null!==Nt&&Vt(Nt,e),Rt.forEach(t),Lt.forEach(t),n=0;n<At.length;n++)(r=At[n]).blockedOn===e&&(r.blockedOn=null);for(;0<At.length&&null===(n=At[0]).blockedOn;)zt(n),null===n.blockedOn&&At.shift()}var Xt=x.ReactCurrentBatchConfig,Bt=!0;function Ht(e,t,n,r){var a=bt,i=Xt.transition;Xt.transition=null;try{bt=1,Kt(e,t,n,r)}finally{bt=a,Xt.transition=i}}function Zt(e,t,n,r){var a=bt,i=Xt.transition;Xt.transition=null;try{bt=4,Kt(e,t,n,r)}finally{bt=a,Xt.transition=i}}function Kt(e,t,n,r){if(Bt){var a=Yt(e,t,n,r);if(null===a)Br(e,t,r,jt,n),Dt(e,r);else if(function(e,t,n,r,a){switch(t){case"focusin":return Ct=Ot(Ct,e,t,n,r,a),!0;case"dragenter":return Mt=Ot(Mt,e,t,n,r,a),!0;case"mouseover":return Nt=Ot(Nt,e,t,n,r,a),!0;case"pointerover":var i=a.pointerId;return Rt.set(i,Ot(Rt.get(i)||null,e,t,n,r,a)),!0;case"gotpointercapture":return i=a.pointerId,Lt.set(i,Ot(Lt.get(i)||null,e,t,n,r,a)),!0}return!1}(a,e,t,n,r))r.stopPropagation();else if(Dt(e,r),4&t&&-1<Pt.indexOf(e)){for(;null!==a;){var i=ba(a);if(null!==i&&wt(i),null===(i=Yt(e,t,n,r))&&Br(e,t,r,jt,n),i===a)break;a=i}null!==a&&r.stopPropagation()}else Br(e,t,r,null,n)}}var jt=null;function Yt(e,t,n,r){if(jt=null,null!==(e=ya(e=we(r))))if(null===(t=Ue(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Xe(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return jt=e,null}function Qt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(qe()){case $e:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Jt=null,qt=null,$t=null;function en(){if($t)return $t;var e,t,n=qt,r=n.length,a="value"in Jt?Jt.value:Jt.textContent,i=a.length;for(e=0;e<r&&n[e]===a[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===a[i-t];t++);return $t=a.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function an(e){function t(t,n,r,a,i){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=a,this.target=i,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(a):a[o]);return this.isDefaultPrevented=(null!=a.defaultPrevented?a.defaultPrevented:!1===a.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return z(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var on,sn,un,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ln=an(cn),dn=z({},cn,{view:0,detail:0}),hn=an(dn),pn=z({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:_n,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==un&&(un&&"mousemove"===e.type?(on=e.screenX-un.screenX,sn=e.screenY-un.screenY):sn=on=0,un=e),on)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),fn=an(pn),mn=an(z({},pn,{dataTransfer:0})),vn=an(z({},dn,{relatedTarget:0})),gn=an(z({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=z({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=an(yn),xn=an(z({},cn,{data:0})),wn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},kn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Tn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Sn[e])&&!!t[e]}function _n(){return Tn}var In=z({},dn,{key:function(e){if(e.key){var t=wn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?kn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:_n,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),En=an(In),Cn=an(z({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Mn=an(z({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:_n})),Nn=an(z({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Rn=z({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Ln=an(Rn),An=[9,13,27,32],Pn=l&&"CompositionEvent"in window,Dn=null;l&&"documentMode"in document&&(Dn=document.documentMode);var On=l&&"TextEvent"in window&&!Dn,zn=l&&(!Pn||Dn&&8<Dn&&11>=Dn),Fn=String.fromCharCode(32),Gn=!1;function Wn(e,t){switch(e){case"keyup":return-1!==An.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Vn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Un=!1;var Xn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Bn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Xn[e.type]:"textarea"===t}function Hn(e,t,n,r){Ie(r),0<(t=Zr(t,"onChange")).length&&(n=new ln("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Zn=null,Kn=null;function jn(e){Fr(e,0)}function Yn(e){if(K(xa(e)))return e}function Qn(e,t){if("change"===e)return t}var Jn=!1;if(l){var qn;if(l){var $n="oninput"in document;if(!$n){var er=document.createElement("div");er.setAttribute("oninput","return;"),$n="function"===typeof er.oninput}qn=$n}else qn=!1;Jn=qn&&(!document.documentMode||9<document.documentMode)}function tr(){Zn&&(Zn.detachEvent("onpropertychange",nr),Kn=Zn=null)}function nr(e){if("value"===e.propertyName&&Yn(Kn)){var t=[];Hn(t,Kn,e,we(e)),Re(jn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Kn=n,(Zn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ar(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Yn(Kn)}function ir(e,t){if("click"===e)return Yn(t)}function or(e,t){if("input"===e||"change"===e)return Yn(t)}var sr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ur(e,t){if(sr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var a=n[r];if(!d.call(t,a)||!sr(e[a],t[a]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function lr(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function dr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?dr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hr(){for(var e=window,t=j();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=j((e=t.contentWindow).document)}return t}function pr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function fr(e){var t=hr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&dr(n.ownerDocument.documentElement,n)){if(null!==r&&pr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var a=n.textContent.length,i=Math.min(r.start,a);r=void 0===r.end?i:Math.min(r.end,a),!e.extend&&i>r&&(a=r,r=i,i=a),a=lr(n,i);var o=lr(n,r);a&&o&&(1!==e.rangeCount||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(a.node,a.offset),e.removeAllRanges(),i>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mr=l&&"documentMode"in document&&11>=document.documentMode,vr=null,gr=null,yr=null,br=!1;function xr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;br||null==vr||vr!==j(r)||("selectionStart"in(r=vr)&&pr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},yr&&ur(yr,r)||(yr=r,0<(r=Zr(gr,"onSelect")).length&&(t=new ln("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=vr)))}function wr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var kr={animationend:wr("Animation","AnimationEnd"),animationiteration:wr("Animation","AnimationIteration"),animationstart:wr("Animation","AnimationStart"),transitionend:wr("Transition","TransitionEnd")},Sr={},Tr={};function _r(e){if(Sr[e])return Sr[e];if(!kr[e])return e;var t,n=kr[e];for(t in n)if(n.hasOwnProperty(t)&&t in Tr)return Sr[e]=n[t];return e}l&&(Tr=document.createElement("div").style,"AnimationEvent"in window||(delete kr.animationend.animation,delete kr.animationiteration.animation,delete kr.animationstart.animation),"TransitionEvent"in window||delete kr.transitionend.transition);var Ir=_r("animationend"),Er=_r("animationiteration"),Cr=_r("animationstart"),Mr=_r("transitionend"),Nr=new Map,Rr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Lr(e,t){Nr.set(e,t),u(t,[e])}for(var Ar=0;Ar<Rr.length;Ar++){var Pr=Rr[Ar];Lr(Pr.toLowerCase(),"on"+(Pr[0].toUpperCase()+Pr.slice(1)))}Lr(Ir,"onAnimationEnd"),Lr(Er,"onAnimationIteration"),Lr(Cr,"onAnimationStart"),Lr("dblclick","onDoubleClick"),Lr("focusin","onFocus"),Lr("focusout","onBlur"),Lr(Mr,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Dr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Or=new Set("cancel close invalid load scroll toggle".split(" ").concat(Dr));function zr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,a,o,s,u,c){if(Ve.apply(this,arguments),Oe){if(!Oe)throw Error(i(198));var l=ze;Oe=!1,ze=null,Fe||(Fe=!0,Ge=l)}}(r,t,void 0,e),e.currentTarget=null}function Fr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],a=r.event;r=r.listeners;e:{var i=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=r[o],u=s.instance,c=s.currentTarget;if(s=s.listener,u!==i&&a.isPropagationStopped())break e;zr(a,s,c),i=u}else for(o=0;o<r.length;o++){if(u=(s=r[o]).instance,c=s.currentTarget,s=s.listener,u!==i&&a.isPropagationStopped())break e;zr(a,s,c),i=u}}}if(Fe)throw e=Ge,Fe=!1,Ge=null,e}function Gr(e,t){var n=t[ma];void 0===n&&(n=t[ma]=new Set);var r=e+"__bubble";n.has(r)||(Xr(t,e,2,!1),n.add(r))}function Wr(e,t,n){var r=0;t&&(r|=4),Xr(n,e,r,t)}var Vr="_reactListening"+Math.random().toString(36).slice(2);function Ur(e){if(!e[Vr]){e[Vr]=!0,o.forEach((function(t){"selectionchange"!==t&&(Or.has(t)||Wr(t,!1,e),Wr(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Vr]||(t[Vr]=!0,Wr("selectionchange",!1,t))}}function Xr(e,t,n,r){switch(Qt(t)){case 1:var a=Ht;break;case 4:a=Zt;break;default:a=Kt}n=a.bind(null,t,n,e),a=void 0,!Ae||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(a=!0),r?void 0!==a?e.addEventListener(t,n,{capture:!0,passive:a}):e.addEventListener(t,n,!0):void 0!==a?e.addEventListener(t,n,{passive:a}):e.addEventListener(t,n,!1)}function Br(e,t,n,r,a){var i=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var s=r.stateNode.containerInfo;if(s===a||8===s.nodeType&&s.parentNode===a)break;if(4===o)for(o=r.return;null!==o;){var u=o.tag;if((3===u||4===u)&&((u=o.stateNode.containerInfo)===a||8===u.nodeType&&u.parentNode===a))return;o=o.return}for(;null!==s;){if(null===(o=ya(s)))return;if(5===(u=o.tag)||6===u){r=i=o;continue e}s=s.parentNode}}r=r.return}Re((function(){var r=i,a=we(n),o=[];e:{var s=Nr.get(e);if(void 0!==s){var u=ln,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":u=En;break;case"focusin":c="focus",u=vn;break;case"focusout":c="blur",u=vn;break;case"beforeblur":case"afterblur":u=vn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":u=fn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":u=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":u=Mn;break;case Ir:case Er:case Cr:u=gn;break;case Mr:u=Nn;break;case"scroll":u=hn;break;case"wheel":u=Ln;break;case"copy":case"cut":case"paste":u=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":u=Cn}var l=0!==(4&t),d=!l&&"scroll"===e,h=l?null!==s?s+"Capture":null:s;l=[];for(var p,f=r;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==h&&(null!=(m=Le(f,h))&&l.push(Hr(f,m,p)))),d)break;f=f.return}0<l.length&&(s=new u(s,c,null,n,a),o.push({event:s,listeners:l}))}}if(0===(7&t)){if(u="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===xe||!(c=n.relatedTarget||n.fromElement)||!ya(c)&&!c[fa])&&(u||s)&&(s=a.window===a?a:(s=a.ownerDocument)?s.defaultView||s.parentWindow:window,u?(u=r,null!==(c=(c=n.relatedTarget||n.toElement)?ya(c):null)&&(c!==(d=Ue(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(u=null,c=r),u!==c)){if(l=fn,m="onMouseLeave",h="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(l=Cn,m="onPointerLeave",h="onPointerEnter",f="pointer"),d=null==u?s:xa(u),p=null==c?s:xa(c),(s=new l(m,f+"leave",u,n,a)).target=d,s.relatedTarget=p,m=null,ya(a)===r&&((l=new l(h,f+"enter",c,n,a)).target=p,l.relatedTarget=d,m=l),d=m,u&&c)e:{for(h=c,f=0,p=l=u;p;p=Kr(p))f++;for(p=0,m=h;m;m=Kr(m))p++;for(;0<f-p;)l=Kr(l),f--;for(;0<p-f;)h=Kr(h),p--;for(;f--;){if(l===h||null!==h&&l===h.alternate)break e;l=Kr(l),h=Kr(h)}l=null}else l=null;null!==u&&jr(o,s,u,l,!1),null!==c&&null!==d&&jr(o,d,c,l,!0)}if("select"===(u=(s=r?xa(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===u&&"file"===s.type)var v=Qn;else if(Bn(s))if(Jn)v=or;else{v=ar;var g=rr}else(u=s.nodeName)&&"input"===u.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(v=ir);switch(v&&(v=v(e,r))?Hn(o,v,n,a):(g&&g(e,s,r),"focusout"===e&&(g=s._wrapperState)&&g.controlled&&"number"===s.type&&ee(s,"number",s.value)),g=r?xa(r):window,e){case"focusin":(Bn(g)||"true"===g.contentEditable)&&(vr=g,gr=r,yr=null);break;case"focusout":yr=gr=vr=null;break;case"mousedown":br=!0;break;case"contextmenu":case"mouseup":case"dragend":br=!1,xr(o,n,a);break;case"selectionchange":if(mr)break;case"keydown":case"keyup":xr(o,n,a)}var y;if(Pn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Un?Wn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(zn&&"ko"!==n.locale&&(Un||"onCompositionStart"!==b?"onCompositionEnd"===b&&Un&&(y=en()):(qt="value"in(Jt=a)?Jt.value:Jt.textContent,Un=!0)),0<(g=Zr(r,b)).length&&(b=new xn(b,e,null,n,a),o.push({event:b,listeners:g}),y?b.data=y:null!==(y=Vn(n))&&(b.data=y))),(y=On?function(e,t){switch(e){case"compositionend":return Vn(t);case"keypress":return 32!==t.which?null:(Gn=!0,Fn);case"textInput":return(e=t.data)===Fn&&Gn?null:e;default:return null}}(e,n):function(e,t){if(Un)return"compositionend"===e||!Pn&&Wn(e,t)?(e=en(),$t=qt=Jt=null,Un=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return zn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Zr(r,"onBeforeInput")).length&&(a=new xn("onBeforeInput","beforeinput",null,n,a),o.push({event:a,listeners:r}),a.data=y))}Fr(o,t)}))}function Hr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Zr(e,t){for(var n=t+"Capture",r=[];null!==e;){var a=e,i=a.stateNode;5===a.tag&&null!==i&&(a=i,null!=(i=Le(e,n))&&r.unshift(Hr(e,i,a)),null!=(i=Le(e,t))&&r.push(Hr(e,i,a))),e=e.return}return r}function Kr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function jr(e,t,n,r,a){for(var i=t._reactName,o=[];null!==n&&n!==r;){var s=n,u=s.alternate,c=s.stateNode;if(null!==u&&u===r)break;5===s.tag&&null!==c&&(s=c,a?null!=(u=Le(n,i))&&o.unshift(Hr(n,u,s)):a||null!=(u=Le(n,i))&&o.push(Hr(n,u,s))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Yr=/\r\n?/g,Qr=/\u0000|\uFFFD/g;function Jr(e){return("string"===typeof e?e:""+e).replace(Yr,"\n").replace(Qr,"")}function qr(e,t,n){if(t=Jr(t),Jr(e)!==t&&n)throw Error(i(425))}function $r(){}var ea=null,ta=null;function na(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ra="function"===typeof setTimeout?setTimeout:void 0,aa="function"===typeof clearTimeout?clearTimeout:void 0,ia="function"===typeof Promise?Promise:void 0,oa="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ia?function(e){return ia.resolve(null).then(e).catch(sa)}:ra;function sa(e){setTimeout((function(){throw e}))}function ua(e,t){var n=t,r=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&8===a.nodeType)if("/$"===(n=a.data)){if(0===r)return e.removeChild(a),void Ut(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=a}while(n);Ut(t)}function ca(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function la(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var da=Math.random().toString(36).slice(2),ha="__reactFiber$"+da,pa="__reactProps$"+da,fa="__reactContainer$"+da,ma="__reactEvents$"+da,va="__reactListeners$"+da,ga="__reactHandles$"+da;function ya(e){var t=e[ha];if(t)return t;for(var n=e.parentNode;n;){if(t=n[fa]||n[ha]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=la(e);null!==e;){if(n=e[ha])return n;e=la(e)}return t}n=(e=n).parentNode}return null}function ba(e){return!(e=e[ha]||e[fa])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function xa(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(i(33))}function wa(e){return e[pa]||null}var ka=[],Sa=-1;function Ta(e){return{current:e}}function _a(e){0>Sa||(e.current=ka[Sa],ka[Sa]=null,Sa--)}function Ia(e,t){Sa++,ka[Sa]=e.current,e.current=t}var Ea={},Ca=Ta(Ea),Ma=Ta(!1),Na=Ea;function Ra(e,t){var n=e.type.contextTypes;if(!n)return Ea;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a,i={};for(a in n)i[a]=t[a];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function La(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Aa(){_a(Ma),_a(Ca)}function Pa(e,t,n){if(Ca.current!==Ea)throw Error(i(168));Ia(Ca,t),Ia(Ma,n)}function Da(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var a in r=r.getChildContext())if(!(a in t))throw Error(i(108,X(e)||"Unknown",a));return z({},n,r)}function Oa(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ea,Na=Ca.current,Ia(Ca,e),Ia(Ma,Ma.current),!0}function za(e,t,n){var r=e.stateNode;if(!r)throw Error(i(169));n?(e=Da(e,t,Na),r.__reactInternalMemoizedMergedChildContext=e,_a(Ma),_a(Ca),Ia(Ca,e)):_a(Ma),Ia(Ma,n)}var Fa=null,Ga=!1,Wa=!1;function Va(e){null===Fa?Fa=[e]:Fa.push(e)}function Ua(){if(!Wa&&null!==Fa){Wa=!0;var e=0,t=bt;try{var n=Fa;for(bt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Fa=null,Ga=!1}catch(a){throw null!==Fa&&(Fa=Fa.slice(e+1)),Ke($e,Ua),a}finally{bt=t,Wa=!1}}return null}var Xa=[],Ba=0,Ha=null,Za=0,Ka=[],ja=0,Ya=null,Qa=1,Ja="";function qa(e,t){Xa[Ba++]=Za,Xa[Ba++]=Ha,Ha=e,Za=t}function $a(e,t,n){Ka[ja++]=Qa,Ka[ja++]=Ja,Ka[ja++]=Ya,Ya=e;var r=Qa;e=Ja;var a=32-ot(r)-1;r&=~(1<<a),n+=1;var i=32-ot(t)+a;if(30<i){var o=a-a%5;i=(r&(1<<o)-1).toString(32),r>>=o,a-=o,Qa=1<<32-ot(t)+a|n<<a|r,Ja=i+e}else Qa=1<<i|n<<a|r,Ja=e}function ei(e){null!==e.return&&(qa(e,1),$a(e,1,0))}function ti(e){for(;e===Ha;)Ha=Xa[--Ba],Xa[Ba]=null,Za=Xa[--Ba],Xa[Ba]=null;for(;e===Ya;)Ya=Ka[--ja],Ka[ja]=null,Ja=Ka[--ja],Ka[ja]=null,Qa=Ka[--ja],Ka[ja]=null}var ni=null,ri=null,ai=!1,ii=null;function oi(e,t){var n=Lc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function si(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ni=e,ri=ca(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ni=e,ri=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Ya?{id:Qa,overflow:Ja}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Lc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ni=e,ri=null,!0);default:return!1}}function ui(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ci(e){if(ai){var t=ri;if(t){var n=t;if(!si(e,t)){if(ui(e))throw Error(i(418));t=ca(n.nextSibling);var r=ni;t&&si(e,t)?oi(r,n):(e.flags=-4097&e.flags|2,ai=!1,ni=e)}}else{if(ui(e))throw Error(i(418));e.flags=-4097&e.flags|2,ai=!1,ni=e}}}function li(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ni=e}function di(e){if(e!==ni)return!1;if(!ai)return li(e),ai=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!na(e.type,e.memoizedProps)),t&&(t=ri)){if(ui(e))throw hi(),Error(i(418));for(;t;)oi(e,t),t=ca(t.nextSibling)}if(li(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(i(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ri=ca(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ri=null}}else ri=ni?ca(e.stateNode.nextSibling):null;return!0}function hi(){for(var e=ri;e;)e=ca(e.nextSibling)}function pi(){ri=ni=null,ai=!1}function fi(e){null===ii?ii=[e]:ii.push(e)}var mi=x.ReactCurrentBatchConfig;function vi(e,t){if(e&&e.defaultProps){for(var n in t=z({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var gi=Ta(null),yi=null,bi=null,xi=null;function wi(){xi=bi=yi=null}function ki(e){var t=gi.current;_a(gi),e._currentValue=t}function Si(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Ti(e,t){yi=e,xi=bi=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(xs=!0),e.firstContext=null)}function _i(e){var t=e._currentValue;if(xi!==e)if(e={context:e,memoizedValue:t,next:null},null===bi){if(null===yi)throw Error(i(308));bi=e,yi.dependencies={lanes:0,firstContext:e}}else bi=bi.next=e;return t}var Ii=null;function Ei(e){null===Ii?Ii=[e]:Ii.push(e)}function Ci(e,t,n,r){var a=t.interleaved;return null===a?(n.next=n,Ei(t)):(n.next=a.next,a.next=n),t.interleaved=n,Mi(e,r)}function Mi(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Ni=!1;function Ri(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Li(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ai(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Pi(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Mu)){var a=r.pending;return null===a?t.next=t:(t.next=a.next,a.next=t),r.pending=t,Mi(e,n)}return null===(a=r.interleaved)?(t.next=t,Ei(r)):(t.next=a.next,a.next=t),r.interleaved=t,Mi(e,n)}function Di(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}function Oi(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var a=null,i=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===i?a=i=o:i=i.next=o,n=n.next}while(null!==n);null===i?a=i=t:i=i.next=t}else a=i=t;return n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function zi(e,t,n,r){var a=e.updateQueue;Ni=!1;var i=a.firstBaseUpdate,o=a.lastBaseUpdate,s=a.shared.pending;if(null!==s){a.shared.pending=null;var u=s,c=u.next;u.next=null,null===o?i=c:o.next=c,o=u;var l=e.alternate;null!==l&&((s=(l=l.updateQueue).lastBaseUpdate)!==o&&(null===s?l.firstBaseUpdate=c:s.next=c,l.lastBaseUpdate=u))}if(null!==i){var d=a.baseState;for(o=0,l=c=u=null,s=i;;){var h=s.lane,p=s.eventTime;if((r&h)===h){null!==l&&(l=l.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var f=e,m=s;switch(h=t,p=n,m.tag){case 1:if("function"===typeof(f=m.payload)){d=f.call(p,d,h);break e}d=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(h="function"===typeof(f=m.payload)?f.call(p,d,h):f)||void 0===h)break e;d=z({},d,h);break e;case 2:Ni=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(h=a.effects)?a.effects=[s]:h.push(s))}else p={eventTime:p,lane:h,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===l?(c=l=p,u=d):l=l.next=p,o|=h;if(null===(s=s.next)){if(null===(s=a.shared.pending))break;s=(h=s).next,h.next=null,a.lastBaseUpdate=h,a.shared.pending=null}}if(null===l&&(u=d),a.baseState=u,a.firstBaseUpdate=c,a.lastBaseUpdate=l,null!==(t=a.shared.interleaved)){a=t;do{o|=a.lane,a=a.next}while(a!==t)}else null===i&&(a.shared.lanes=0);zu|=o,e.lanes=o,e.memoizedState=d}}function Fi(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(null!==a){if(r.callback=null,r=n,"function"!==typeof a)throw Error(i(191,a));a.call(r)}}}var Gi=(new r.Component).refs;function Wi(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:z({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Vi={isMounted:function(e){return!!(e=e._reactInternals)&&Ue(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=tc(),a=nc(e),i=Ai(r,a);i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=Pi(e,i,a))&&(rc(t,e,a,r),Di(t,e,a))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=tc(),a=nc(e),i=Ai(r,a);i.tag=1,i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=Pi(e,i,a))&&(rc(t,e,a,r),Di(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tc(),r=nc(e),a=Ai(n,r);a.tag=2,void 0!==t&&null!==t&&(a.callback=t),null!==(t=Pi(e,a,r))&&(rc(t,e,r,n),Di(t,e,r))}};function Ui(e,t,n,r,a,i,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,i,o):!t.prototype||!t.prototype.isPureReactComponent||(!ur(n,r)||!ur(a,i))}function Xi(e,t,n){var r=!1,a=Ea,i=t.contextType;return"object"===typeof i&&null!==i?i=_i(i):(a=La(t)?Na:Ca.current,i=(r=null!==(r=t.contextTypes)&&void 0!==r)?Ra(e,a):Ea),t=new t(n,i),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Vi,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function Bi(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Vi.enqueueReplaceState(t,t.state,null)}function Hi(e,t,n,r){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs=Gi,Ri(e);var i=t.contextType;"object"===typeof i&&null!==i?a.context=_i(i):(i=La(t)?Na:Ca.current,a.context=Ra(e,i)),a.state=e.memoizedState,"function"===typeof(i=t.getDerivedStateFromProps)&&(Wi(e,t,i,n),a.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof a.getSnapshotBeforeUpdate||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||(t=a.state,"function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),t!==a.state&&Vi.enqueueReplaceState(a,a.state,null),zi(e,n,a,r),a.state=e.memoizedState),"function"===typeof a.componentDidMount&&(e.flags|=4194308)}function Zi(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(i(309));var r=n.stateNode}if(!r)throw Error(i(147,e));var a=r,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=a.refs;t===Gi&&(t=a.refs={}),null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(i(284));if(!n._owner)throw Error(i(290,e))}return e}function Ki(e,t){throw e=Object.prototype.toString.call(t),Error(i(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ji(e){return(0,e._init)(e._payload)}function Yi(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function a(e,t){return(e=Pc(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=Fc(n,e.mode,r)).return=e,t):((t=a(t,n)).return=e,t)}function c(e,t,n,r){var i=n.type;return i===S?d(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===i||"object"===typeof i&&null!==i&&i.$$typeof===L&&ji(i)===t.type)?((r=a(t,n.props)).ref=Zi(e,t,n),r.return=e,r):((r=Dc(n.type,n.key,n.props,null,e.mode,r)).ref=Zi(e,t,n),r.return=e,r)}function l(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Gc(n,e.mode,r)).return=e,t):((t=a(t,n.children||[])).return=e,t)}function d(e,t,n,r,i){return null===t||7!==t.tag?((t=Oc(n,e.mode,r,i)).return=e,t):((t=a(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Fc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case w:return(n=Dc(t.type,t.key,t.props,null,e.mode,n)).ref=Zi(e,null,t),n.return=e,n;case k:return(t=Gc(t,e.mode,n)).return=e,t;case L:return h(e,(0,t._init)(t._payload),n)}if(te(t)||D(t))return(t=Oc(t,e.mode,n,null)).return=e,t;Ki(e,t)}return null}function p(e,t,n,r){var a=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==a?null:u(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case w:return n.key===a?c(e,t,n,r):null;case k:return n.key===a?l(e,t,n,r):null;case L:return p(e,t,(a=n._init)(n._payload),r)}if(te(n)||D(n))return null!==a?null:d(e,t,n,r,null);Ki(e,n)}return null}function f(e,t,n,r,a){if("string"===typeof r&&""!==r||"number"===typeof r)return u(t,e=e.get(n)||null,""+r,a);if("object"===typeof r&&null!==r){switch(r.$$typeof){case w:return c(t,e=e.get(null===r.key?n:r.key)||null,r,a);case k:return l(t,e=e.get(null===r.key?n:r.key)||null,r,a);case L:return f(e,t,n,(0,r._init)(r._payload),a)}if(te(r)||D(r))return d(t,e=e.get(n)||null,r,a,null);Ki(t,r)}return null}function m(a,i,s,u){for(var c=null,l=null,d=i,m=i=0,v=null;null!==d&&m<s.length;m++){d.index>m?(v=d,d=null):v=d.sibling;var g=p(a,d,s[m],u);if(null===g){null===d&&(d=v);break}e&&d&&null===g.alternate&&t(a,d),i=o(g,i,m),null===l?c=g:l.sibling=g,l=g,d=v}if(m===s.length)return n(a,d),ai&&qa(a,m),c;if(null===d){for(;m<s.length;m++)null!==(d=h(a,s[m],u))&&(i=o(d,i,m),null===l?c=d:l.sibling=d,l=d);return ai&&qa(a,m),c}for(d=r(a,d);m<s.length;m++)null!==(v=f(d,a,m,s[m],u))&&(e&&null!==v.alternate&&d.delete(null===v.key?m:v.key),i=o(v,i,m),null===l?c=v:l.sibling=v,l=v);return e&&d.forEach((function(e){return t(a,e)})),ai&&qa(a,m),c}function v(a,s,u,c){var l=D(u);if("function"!==typeof l)throw Error(i(150));if(null==(u=l.call(u)))throw Error(i(151));for(var d=l=null,m=s,v=s=0,g=null,y=u.next();null!==m&&!y.done;v++,y=u.next()){m.index>v?(g=m,m=null):g=m.sibling;var b=p(a,m,y.value,c);if(null===b){null===m&&(m=g);break}e&&m&&null===b.alternate&&t(a,m),s=o(b,s,v),null===d?l=b:d.sibling=b,d=b,m=g}if(y.done)return n(a,m),ai&&qa(a,v),l;if(null===m){for(;!y.done;v++,y=u.next())null!==(y=h(a,y.value,c))&&(s=o(y,s,v),null===d?l=y:d.sibling=y,d=y);return ai&&qa(a,v),l}for(m=r(a,m);!y.done;v++,y=u.next())null!==(y=f(m,a,v,y.value,c))&&(e&&null!==y.alternate&&m.delete(null===y.key?v:y.key),s=o(y,s,v),null===d?l=y:d.sibling=y,d=y);return e&&m.forEach((function(e){return t(a,e)})),ai&&qa(a,v),l}return function e(r,i,o,u){if("object"===typeof o&&null!==o&&o.type===S&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case w:e:{for(var c=o.key,l=i;null!==l;){if(l.key===c){if((c=o.type)===S){if(7===l.tag){n(r,l.sibling),(i=a(l,o.props.children)).return=r,r=i;break e}}else if(l.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===L&&ji(c)===l.type){n(r,l.sibling),(i=a(l,o.props)).ref=Zi(r,l,o),i.return=r,r=i;break e}n(r,l);break}t(r,l),l=l.sibling}o.type===S?((i=Oc(o.props.children,r.mode,u,o.key)).return=r,r=i):((u=Dc(o.type,o.key,o.props,null,r.mode,u)).ref=Zi(r,i,o),u.return=r,r=u)}return s(r);case k:e:{for(l=o.key;null!==i;){if(i.key===l){if(4===i.tag&&i.stateNode.containerInfo===o.containerInfo&&i.stateNode.implementation===o.implementation){n(r,i.sibling),(i=a(i,o.children||[])).return=r,r=i;break e}n(r,i);break}t(r,i),i=i.sibling}(i=Gc(o,r.mode,u)).return=r,r=i}return s(r);case L:return e(r,i,(l=o._init)(o._payload),u)}if(te(o))return m(r,i,o,u);if(D(o))return v(r,i,o,u);Ki(r,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==i&&6===i.tag?(n(r,i.sibling),(i=a(i,o)).return=r,r=i):(n(r,i),(i=Fc(o,r.mode,u)).return=r,r=i),s(r)):n(r,i)}}var Qi=Yi(!0),Ji=Yi(!1),qi={},$i=Ta(qi),eo=Ta(qi),to=Ta(qi);function no(e){if(e===qi)throw Error(i(174));return e}function ro(e,t){switch(Ia(to,t),Ia(eo,e),Ia($i,qi),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ue(null,"");break;default:t=ue(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}_a($i),Ia($i,t)}function ao(){_a($i),_a(eo),_a(to)}function io(e){no(to.current);var t=no($i.current),n=ue(t,e.type);t!==n&&(Ia(eo,e),Ia($i,n))}function oo(e){eo.current===e&&(_a($i),_a(eo))}var so=Ta(0);function uo(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var co=[];function lo(){for(var e=0;e<co.length;e++)co[e]._workInProgressVersionPrimary=null;co.length=0}var ho=x.ReactCurrentDispatcher,po=x.ReactCurrentBatchConfig,fo=0,mo=null,vo=null,go=null,yo=!1,bo=!1,xo=0,wo=0;function ko(){throw Error(i(321))}function So(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!sr(e[n],t[n]))return!1;return!0}function To(e,t,n,r,a,o){if(fo=o,mo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ho.current=null===e||null===e.memoizedState?ss:us,e=n(r,a),bo){o=0;do{if(bo=!1,xo=0,25<=o)throw Error(i(301));o+=1,go=vo=null,t.updateQueue=null,ho.current=cs,e=n(r,a)}while(bo)}if(ho.current=os,t=null!==vo&&null!==vo.next,fo=0,go=vo=mo=null,yo=!1,t)throw Error(i(300));return e}function _o(){var e=0!==xo;return xo=0,e}function Io(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===go?mo.memoizedState=go=e:go=go.next=e,go}function Eo(){if(null===vo){var e=mo.alternate;e=null!==e?e.memoizedState:null}else e=vo.next;var t=null===go?mo.memoizedState:go.next;if(null!==t)go=t,vo=e;else{if(null===e)throw Error(i(310));e={memoizedState:(vo=e).memoizedState,baseState:vo.baseState,baseQueue:vo.baseQueue,queue:vo.queue,next:null},null===go?mo.memoizedState=go=e:go=go.next=e}return go}function Co(e,t){return"function"===typeof t?t(e):t}function Mo(e){var t=Eo(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=vo,a=r.baseQueue,o=n.pending;if(null!==o){if(null!==a){var s=a.next;a.next=o.next,o.next=s}r.baseQueue=a=o,n.pending=null}if(null!==a){o=a.next,r=r.baseState;var u=s=null,c=null,l=o;do{var d=l.lane;if((fo&d)===d)null!==c&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:e(r,l.action);else{var h={lane:d,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};null===c?(u=c=h,s=r):c=c.next=h,mo.lanes|=d,zu|=d}l=l.next}while(null!==l&&l!==o);null===c?s=r:c.next=u,sr(r,t.memoizedState)||(xs=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){a=e;do{o=a.lane,mo.lanes|=o,zu|=o,a=a.next}while(a!==e)}else null===a&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function No(e){var t=Eo(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,o=t.memoizedState;if(null!==a){n.pending=null;var s=a=a.next;do{o=e(o,s.action),s=s.next}while(s!==a);sr(o,t.memoizedState)||(xs=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function Ro(){}function Lo(e,t){var n=mo,r=Eo(),a=t(),o=!sr(r.memoizedState,a);if(o&&(r.memoizedState=a,xs=!0),r=r.queue,Bo(Do.bind(null,n,r,e),[e]),r.getSnapshot!==t||o||null!==go&&1&go.memoizedState.tag){if(n.flags|=2048,Go(9,Po.bind(null,n,r,a,t),void 0,null),null===Nu)throw Error(i(349));0!==(30&fo)||Ao(n,t,a)}return a}function Ao(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=mo.updateQueue)?(t={lastEffect:null,stores:null},mo.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Po(e,t,n,r){t.value=n,t.getSnapshot=r,Oo(t)&&zo(e)}function Do(e,t,n){return n((function(){Oo(t)&&zo(e)}))}function Oo(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!sr(e,n)}catch(r){return!0}}function zo(e){var t=Mi(e,1);null!==t&&rc(t,e,1,-1)}function Fo(e){var t=Io();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Co,lastRenderedState:e},t.queue=e,e=e.dispatch=ns.bind(null,mo,e),[t.memoizedState,e]}function Go(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=mo.updateQueue)?(t={lastEffect:null,stores:null},mo.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Wo(){return Eo().memoizedState}function Vo(e,t,n,r){var a=Io();mo.flags|=e,a.memoizedState=Go(1|t,n,void 0,void 0===r?null:r)}function Uo(e,t,n,r){var a=Eo();r=void 0===r?null:r;var i=void 0;if(null!==vo){var o=vo.memoizedState;if(i=o.destroy,null!==r&&So(r,o.deps))return void(a.memoizedState=Go(t,n,i,r))}mo.flags|=e,a.memoizedState=Go(1|t,n,i,r)}function Xo(e,t){return Vo(8390656,8,e,t)}function Bo(e,t){return Uo(2048,8,e,t)}function Ho(e,t){return Uo(4,2,e,t)}function Zo(e,t){return Uo(4,4,e,t)}function Ko(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function jo(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Uo(4,4,Ko.bind(null,t,e),n)}function Yo(){}function Qo(e,t){var n=Eo();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&So(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Jo(e,t){var n=Eo();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&So(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function qo(e,t,n){return 0===(21&fo)?(e.baseState&&(e.baseState=!1,xs=!0),e.memoizedState=n):(sr(n,t)||(n=mt(),mo.lanes|=n,zu|=n,e.baseState=!0),t)}function $o(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var r=po.transition;po.transition={};try{e(!1),t()}finally{bt=n,po.transition=r}}function es(){return Eo().memoizedState}function ts(e,t,n){var r=nc(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},rs(e))as(t,n);else if(null!==(n=Ci(e,t,n,r))){rc(n,e,r,tc()),is(n,t,r)}}function ns(e,t,n){var r=nc(e),a={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(rs(e))as(t,a);else{var i=e.alternate;if(0===e.lanes&&(null===i||0===i.lanes)&&null!==(i=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=i(o,n);if(a.hasEagerState=!0,a.eagerState=s,sr(s,o)){var u=t.interleaved;return null===u?(a.next=a,Ei(t)):(a.next=u.next,u.next=a),void(t.interleaved=a)}}catch(c){}null!==(n=Ci(e,t,a,r))&&(rc(n,e,r,a=tc()),is(n,t,r))}}function rs(e){var t=e.alternate;return e===mo||null!==t&&t===mo}function as(e,t){bo=yo=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function is(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}var os={readContext:_i,useCallback:ko,useContext:ko,useEffect:ko,useImperativeHandle:ko,useInsertionEffect:ko,useLayoutEffect:ko,useMemo:ko,useReducer:ko,useRef:ko,useState:ko,useDebugValue:ko,useDeferredValue:ko,useTransition:ko,useMutableSource:ko,useSyncExternalStore:ko,useId:ko,unstable_isNewReconciler:!1},ss={readContext:_i,useCallback:function(e,t){return Io().memoizedState=[e,void 0===t?null:t],e},useContext:_i,useEffect:Xo,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Vo(4194308,4,Ko.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Vo(4194308,4,e,t)},useInsertionEffect:function(e,t){return Vo(4,2,e,t)},useMemo:function(e,t){var n=Io();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Io();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=ts.bind(null,mo,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Io().memoizedState=e},useState:Fo,useDebugValue:Yo,useDeferredValue:function(e){return Io().memoizedState=e},useTransition:function(){var e=Fo(!1),t=e[0];return e=$o.bind(null,e[1]),Io().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=mo,a=Io();if(ai){if(void 0===n)throw Error(i(407));n=n()}else{if(n=t(),null===Nu)throw Error(i(349));0!==(30&fo)||Ao(r,t,n)}a.memoizedState=n;var o={value:n,getSnapshot:t};return a.queue=o,Xo(Do.bind(null,r,o,e),[e]),r.flags|=2048,Go(9,Po.bind(null,r,o,n,t),void 0,null),n},useId:function(){var e=Io(),t=Nu.identifierPrefix;if(ai){var n=Ja;t=":"+t+"R"+(n=(Qa&~(1<<32-ot(Qa)-1)).toString(32)+n),0<(n=xo++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=wo++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},us={readContext:_i,useCallback:Qo,useContext:_i,useEffect:Bo,useImperativeHandle:jo,useInsertionEffect:Ho,useLayoutEffect:Zo,useMemo:Jo,useReducer:Mo,useRef:Wo,useState:function(){return Mo(Co)},useDebugValue:Yo,useDeferredValue:function(e){return qo(Eo(),vo.memoizedState,e)},useTransition:function(){return[Mo(Co)[0],Eo().memoizedState]},useMutableSource:Ro,useSyncExternalStore:Lo,useId:es,unstable_isNewReconciler:!1},cs={readContext:_i,useCallback:Qo,useContext:_i,useEffect:Bo,useImperativeHandle:jo,useInsertionEffect:Ho,useLayoutEffect:Zo,useMemo:Jo,useReducer:No,useRef:Wo,useState:function(){return No(Co)},useDebugValue:Yo,useDeferredValue:function(e){var t=Eo();return null===vo?t.memoizedState=e:qo(t,vo.memoizedState,e)},useTransition:function(){return[No(Co)[0],Eo().memoizedState]},useMutableSource:Ro,useSyncExternalStore:Lo,useId:es,unstable_isNewReconciler:!1};function ls(e,t){try{var n="",r=t;do{n+=V(r),r=r.return}while(r);var a=n}catch(i){a="\nError generating stack: "+i.message+"\n"+i.stack}return{value:e,source:t,stack:a,digest:null}}function ds(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function hs(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var ps="function"===typeof WeakMap?WeakMap:Map;function fs(e,t,n){(n=Ai(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Hu||(Hu=!0,Zu=r),hs(0,t)},n}function ms(e,t,n){(n=Ai(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var a=t.value;n.payload=function(){return r(a)},n.callback=function(){hs(0,t)}}var i=e.stateNode;return null!==i&&"function"===typeof i.componentDidCatch&&(n.callback=function(){hs(0,t),"function"!==typeof r&&(null===Ku?Ku=new Set([this]):Ku.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function vs(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new ps;var a=new Set;r.set(t,a)}else void 0===(a=r.get(t))&&(a=new Set,r.set(t,a));a.has(n)||(a.add(n),e=Ic.bind(null,e,t,n),t.then(e,e))}function gs(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function ys(e,t,n,r,a){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Ai(-1,1)).tag=2,Pi(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=a,e)}var bs=x.ReactCurrentOwner,xs=!1;function ws(e,t,n,r){t.child=null===e?Ji(t,null,n,r):Qi(t,e.child,n,r)}function ks(e,t,n,r,a){n=n.render;var i=t.ref;return Ti(t,a),r=To(e,t,n,r,i,a),n=_o(),null===e||xs?(ai&&n&&ei(t),t.flags|=1,ws(e,t,r,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Hs(e,t,a))}function Ss(e,t,n,r,a){if(null===e){var i=n.type;return"function"!==typeof i||Ac(i)||void 0!==i.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Dc(n.type,null,r,t,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=i,Ts(e,t,i,r,a))}if(i=e.child,0===(e.lanes&a)){var o=i.memoizedProps;if((n=null!==(n=n.compare)?n:ur)(o,r)&&e.ref===t.ref)return Hs(e,t,a)}return t.flags|=1,(e=Pc(i,r)).ref=t.ref,e.return=t,t.child=e}function Ts(e,t,n,r,a){if(null!==e){var i=e.memoizedProps;if(ur(i,r)&&e.ref===t.ref){if(xs=!1,t.pendingProps=r=i,0===(e.lanes&a))return t.lanes=e.lanes,Hs(e,t,a);0!==(131072&e.flags)&&(xs=!0)}}return Es(e,t,n,r,a)}function _s(e,t,n){var r=t.pendingProps,a=r.children,i=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ia(Pu,Au),Au|=n;else{if(0===(1073741824&n))return e=null!==i?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ia(Pu,Au),Au|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==i?i.baseLanes:n,Ia(Pu,Au),Au|=r}else null!==i?(r=i.baseLanes|n,t.memoizedState=null):r=n,Ia(Pu,Au),Au|=r;return ws(e,t,a,n),t.child}function Is(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Es(e,t,n,r,a){var i=La(n)?Na:Ca.current;return i=Ra(t,i),Ti(t,a),n=To(e,t,n,r,i,a),r=_o(),null===e||xs?(ai&&r&&ei(t),t.flags|=1,ws(e,t,n,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Hs(e,t,a))}function Cs(e,t,n,r,a){if(La(n)){var i=!0;Oa(t)}else i=!1;if(Ti(t,a),null===t.stateNode)Bs(e,t),Xi(t,n,r),Hi(t,n,r,a),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var u=o.context,c=n.contextType;"object"===typeof c&&null!==c?c=_i(c):c=Ra(t,c=La(n)?Na:Ca.current);var l=n.getDerivedStateFromProps,d="function"===typeof l||"function"===typeof o.getSnapshotBeforeUpdate;d||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||u!==c)&&Bi(t,o,r,c),Ni=!1;var h=t.memoizedState;o.state=h,zi(t,r,o,a),u=t.memoizedState,s!==r||h!==u||Ma.current||Ni?("function"===typeof l&&(Wi(t,n,l,r),u=t.memoizedState),(s=Ni||Ui(t,n,s,r,h,u,c))?(d||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=u),o.props=r,o.state=u,o.context=c,r=s):("function"===typeof o.componentDidMount&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,Li(e,t),s=t.memoizedProps,c=t.type===t.elementType?s:vi(t.type,s),o.props=c,d=t.pendingProps,h=o.context,"object"===typeof(u=n.contextType)&&null!==u?u=_i(u):u=Ra(t,u=La(n)?Na:Ca.current);var p=n.getDerivedStateFromProps;(l="function"===typeof p||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==d||h!==u)&&Bi(t,o,r,u),Ni=!1,h=t.memoizedState,o.state=h,zi(t,r,o,a);var f=t.memoizedState;s!==d||h!==f||Ma.current||Ni?("function"===typeof p&&(Wi(t,n,p,r),f=t.memoizedState),(c=Ni||Ui(t,n,c,r,h,f,u)||!1)?(l||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,f,u),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,f,u)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),o.props=r,o.state=f,o.context=u,r=c):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return Ms(e,t,n,r,i,a)}function Ms(e,t,n,r,a,i){Is(e,t);var o=0!==(128&t.flags);if(!r&&!o)return a&&za(t,n,!1),Hs(e,t,i);r=t.stateNode,bs.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&o?(t.child=Qi(t,e.child,null,i),t.child=Qi(t,null,s,i)):ws(e,t,s,i),t.memoizedState=r.state,a&&za(t,n,!0),t.child}function Ns(e){var t=e.stateNode;t.pendingContext?Pa(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Pa(0,t.context,!1),ro(e,t.containerInfo)}function Rs(e,t,n,r,a){return pi(),fi(a),t.flags|=256,ws(e,t,n,r),t.child}var Ls,As,Ps,Ds,Os={dehydrated:null,treeContext:null,retryLane:0};function zs(e){return{baseLanes:e,cachePool:null,transitions:null}}function Fs(e,t,n){var r,a=t.pendingProps,o=so.current,s=!1,u=0!==(128&t.flags);if((r=u)||(r=(null===e||null!==e.memoizedState)&&0!==(2&o)),r?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Ia(so,1&o),null===e)return ci(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(u=a.children,e=a.fallback,s?(a=t.mode,s=t.child,u={mode:"hidden",children:u},0===(1&a)&&null!==s?(s.childLanes=0,s.pendingProps=u):s=zc(u,a,0,null),e=Oc(e,a,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=zs(n),t.memoizedState=Os,e):Gs(t,u));if(null!==(o=e.memoizedState)&&null!==(r=o.dehydrated))return function(e,t,n,r,a,o,s){if(n)return 256&t.flags?(t.flags&=-257,Ws(e,t,s,r=ds(Error(i(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=r.fallback,a=t.mode,r=zc({mode:"visible",children:r.children},a,0,null),(o=Oc(o,a,s,null)).flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,0!==(1&t.mode)&&Qi(t,e.child,null,s),t.child.memoizedState=zs(s),t.memoizedState=Os,o);if(0===(1&t.mode))return Ws(e,t,s,null);if("$!"===a.data){if(r=a.nextSibling&&a.nextSibling.dataset)var u=r.dgst;return r=u,Ws(e,t,s,r=ds(o=Error(i(419)),r,void 0))}if(u=0!==(s&e.childLanes),xs||u){if(null!==(r=Nu)){switch(s&-s){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}0!==(a=0!==(a&(r.suspendedLanes|s))?0:a)&&a!==o.retryLane&&(o.retryLane=a,Mi(e,a),rc(r,e,a,-1))}return vc(),Ws(e,t,s,r=ds(Error(i(421))))}return"$?"===a.data?(t.flags|=128,t.child=e.child,t=Cc.bind(null,e),a._reactRetry=t,null):(e=o.treeContext,ri=ca(a.nextSibling),ni=t,ai=!0,ii=null,null!==e&&(Ka[ja++]=Qa,Ka[ja++]=Ja,Ka[ja++]=Ya,Qa=e.id,Ja=e.overflow,Ya=t),t=Gs(t,r.children),t.flags|=4096,t)}(e,t,u,a,r,o,n);if(s){s=a.fallback,u=t.mode,r=(o=e.child).sibling;var c={mode:"hidden",children:a.children};return 0===(1&u)&&t.child!==o?((a=t.child).childLanes=0,a.pendingProps=c,t.deletions=null):(a=Pc(o,c)).subtreeFlags=14680064&o.subtreeFlags,null!==r?s=Pc(r,s):(s=Oc(s,u,n,null)).flags|=2,s.return=t,a.return=t,a.sibling=s,t.child=a,a=s,s=t.child,u=null===(u=e.child.memoizedState)?zs(n):{baseLanes:u.baseLanes|n,cachePool:null,transitions:u.transitions},s.memoizedState=u,s.childLanes=e.childLanes&~n,t.memoizedState=Os,a}return e=(s=e.child).sibling,a=Pc(s,{mode:"visible",children:a.children}),0===(1&t.mode)&&(a.lanes=n),a.return=t,a.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=a,t.memoizedState=null,a}function Gs(e,t){return(t=zc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Ws(e,t,n,r){return null!==r&&fi(r),Qi(t,e.child,null,n),(e=Gs(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Vs(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Si(e.return,t,n)}function Us(e,t,n,r,a){var i=e.memoizedState;null===i?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=a)}function Xs(e,t,n){var r=t.pendingProps,a=r.revealOrder,i=r.tail;if(ws(e,t,r.children,n),0!==(2&(r=so.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Vs(e,n,t);else if(19===e.tag)Vs(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ia(so,r),0===(1&t.mode))t.memoizedState=null;else switch(a){case"forwards":for(n=t.child,a=null;null!==n;)null!==(e=n.alternate)&&null===uo(e)&&(a=n),n=n.sibling;null===(n=a)?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),Us(t,!1,a,n,i);break;case"backwards":for(n=null,a=t.child,t.child=null;null!==a;){if(null!==(e=a.alternate)&&null===uo(e)){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}Us(t,!0,n,null,i);break;case"together":Us(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Bs(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Hs(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),zu|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(i(153));if(null!==t.child){for(n=Pc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Pc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Zs(e,t){if(!ai)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Ks(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=14680064&a.subtreeFlags,r|=14680064&a.flags,a.return=e,a=a.sibling;else for(a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function js(e,t,n){var r=t.pendingProps;switch(ti(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ks(t),null;case 1:case 17:return La(t.type)&&Aa(),Ks(t),null;case 3:return r=t.stateNode,ao(),_a(Ma),_a(Ca),lo(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(di(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ii&&(sc(ii),ii=null))),As(e,t),Ks(t),null;case 5:oo(t);var a=no(to.current);if(n=t.type,null!==e&&null!=t.stateNode)Ps(e,t,n,r,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(i(166));return Ks(t),null}if(e=no($i.current),di(t)){r=t.stateNode,n=t.type;var o=t.memoizedProps;switch(r[ha]=t,r[pa]=o,e=0!==(1&t.mode),n){case"dialog":Gr("cancel",r),Gr("close",r);break;case"iframe":case"object":case"embed":Gr("load",r);break;case"video":case"audio":for(a=0;a<Dr.length;a++)Gr(Dr[a],r);break;case"source":Gr("error",r);break;case"img":case"image":case"link":Gr("error",r),Gr("load",r);break;case"details":Gr("toggle",r);break;case"input":Q(r,o),Gr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},Gr("invalid",r);break;case"textarea":ae(r,o),Gr("invalid",r)}for(var u in ye(n,o),a=null,o)if(o.hasOwnProperty(u)){var c=o[u];"children"===u?"string"===typeof c?r.textContent!==c&&(!0!==o.suppressHydrationWarning&&qr(r.textContent,c,e),a=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(!0!==o.suppressHydrationWarning&&qr(r.textContent,c,e),a=["children",""+c]):s.hasOwnProperty(u)&&null!=c&&"onScroll"===u&&Gr("scroll",r)}switch(n){case"input":Z(r),$(r,o,!0);break;case"textarea":Z(r),oe(r);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(r.onclick=$r)}r=a,t.updateQueue=r,null!==r&&(t.flags|=4)}else{u=9===a.nodeType?a:a.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=u.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=u.createElement(n,{is:r.is}):(e=u.createElement(n),"select"===n&&(u=e,r.multiple?u.multiple=!0:r.size&&(u.size=r.size))):e=u.createElementNS(e,n),e[ha]=t,e[pa]=r,Ls(e,t,!1,!1),t.stateNode=e;e:{switch(u=be(n,r),n){case"dialog":Gr("cancel",e),Gr("close",e),a=r;break;case"iframe":case"object":case"embed":Gr("load",e),a=r;break;case"video":case"audio":for(a=0;a<Dr.length;a++)Gr(Dr[a],e);a=r;break;case"source":Gr("error",e),a=r;break;case"img":case"image":case"link":Gr("error",e),Gr("load",e),a=r;break;case"details":Gr("toggle",e),a=r;break;case"input":Q(e,r),a=Y(e,r),Gr("invalid",e);break;case"option":default:a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=z({},r,{value:void 0}),Gr("invalid",e);break;case"textarea":ae(e,r),a=re(e,r),Gr("invalid",e)}for(o in ye(n,a),c=a)if(c.hasOwnProperty(o)){var l=c[o];"style"===o?ve(e,l):"dangerouslySetInnerHTML"===o?null!=(l=l?l.__html:void 0)&&de(e,l):"children"===o?"string"===typeof l?("textarea"!==n||""!==l)&&he(e,l):"number"===typeof l&&he(e,""+l):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(s.hasOwnProperty(o)?null!=l&&"onScroll"===o&&Gr("scroll",e):null!=l&&b(e,o,l,u))}switch(n){case"input":Z(e),$(e,r,!1);break;case"textarea":Z(e),oe(e);break;case"option":null!=r.value&&e.setAttribute("value",""+B(r.value));break;case"select":e.multiple=!!r.multiple,null!=(o=r.value)?ne(e,!!r.multiple,o,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof a.onClick&&(e.onclick=$r)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Ks(t),null;case 6:if(e&&null!=t.stateNode)Ds(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(i(166));if(n=no(to.current),no($i.current),di(t)){if(r=t.stateNode,n=t.memoizedProps,r[ha]=t,(o=r.nodeValue!==n)&&null!==(e=ni))switch(e.tag){case 3:qr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&qr(r.nodeValue,n,0!==(1&e.mode))}o&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[ha]=t,t.stateNode=r}return Ks(t),null;case 13:if(_a(so),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ai&&null!==ri&&0!==(1&t.mode)&&0===(128&t.flags))hi(),pi(),t.flags|=98560,o=!1;else if(o=di(t),null!==r&&null!==r.dehydrated){if(null===e){if(!o)throw Error(i(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(i(317));o[ha]=t}else pi(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Ks(t),o=!1}else null!==ii&&(sc(ii),ii=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&so.current)?0===Du&&(Du=3):vc())),null!==t.updateQueue&&(t.flags|=4),Ks(t),null);case 4:return ao(),As(e,t),null===e&&Ur(t.stateNode.containerInfo),Ks(t),null;case 10:return ki(t.type._context),Ks(t),null;case 19:if(_a(so),null===(o=t.memoizedState))return Ks(t),null;if(r=0!==(128&t.flags),null===(u=o.rendering))if(r)Zs(o,!1);else{if(0!==Du||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(u=uo(e))){for(t.flags|=128,Zs(o,!1),null!==(r=u.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(o=n).flags&=14680066,null===(u=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=u.childLanes,o.lanes=u.lanes,o.child=u.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=u.memoizedProps,o.memoizedState=u.memoizedState,o.updateQueue=u.updateQueue,o.type=u.type,e=u.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ia(so,1&so.current|2),t.child}e=e.sibling}null!==o.tail&&Je()>Xu&&(t.flags|=128,r=!0,Zs(o,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=uo(u))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Zs(o,!0),null===o.tail&&"hidden"===o.tailMode&&!u.alternate&&!ai)return Ks(t),null}else 2*Je()-o.renderingStartTime>Xu&&1073741824!==n&&(t.flags|=128,r=!0,Zs(o,!1),t.lanes=4194304);o.isBackwards?(u.sibling=t.child,t.child=u):(null!==(n=o.last)?n.sibling=u:t.child=u,o.last=u)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Je(),t.sibling=null,n=so.current,Ia(so,r?1&n|2:1&n),t):(Ks(t),null);case 22:case 23:return hc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Au)&&(Ks(t),6&t.subtreeFlags&&(t.flags|=8192)):Ks(t),null;case 24:case 25:return null}throw Error(i(156,t.tag))}function Ys(e,t){switch(ti(t),t.tag){case 1:return La(t.type)&&Aa(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return ao(),_a(Ma),_a(Ca),lo(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return oo(t),null;case 13:if(_a(so),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(i(340));pi()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return _a(so),null;case 4:return ao(),null;case 10:return ki(t.type._context),null;case 22:case 23:return hc(),null;default:return null}}Ls=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},As=function(){},Ps=function(e,t,n,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,no($i.current);var i,o=null;switch(n){case"input":a=Y(e,a),r=Y(e,r),o=[];break;case"select":a=z({},a,{value:void 0}),r=z({},r,{value:void 0}),o=[];break;case"textarea":a=re(e,a),r=re(e,r),o=[];break;default:"function"!==typeof a.onClick&&"function"===typeof r.onClick&&(e.onclick=$r)}for(l in ye(n,r),n=null,a)if(!r.hasOwnProperty(l)&&a.hasOwnProperty(l)&&null!=a[l])if("style"===l){var u=a[l];for(i in u)u.hasOwnProperty(i)&&(n||(n={}),n[i]="")}else"dangerouslySetInnerHTML"!==l&&"children"!==l&&"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&"autoFocus"!==l&&(s.hasOwnProperty(l)?o||(o=[]):(o=o||[]).push(l,null));for(l in r){var c=r[l];if(u=null!=a?a[l]:void 0,r.hasOwnProperty(l)&&c!==u&&(null!=c||null!=u))if("style"===l)if(u){for(i in u)!u.hasOwnProperty(i)||c&&c.hasOwnProperty(i)||(n||(n={}),n[i]="");for(i in c)c.hasOwnProperty(i)&&u[i]!==c[i]&&(n||(n={}),n[i]=c[i])}else n||(o||(o=[]),o.push(l,n)),n=c;else"dangerouslySetInnerHTML"===l?(c=c?c.__html:void 0,u=u?u.__html:void 0,null!=c&&u!==c&&(o=o||[]).push(l,c)):"children"===l?"string"!==typeof c&&"number"!==typeof c||(o=o||[]).push(l,""+c):"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&(s.hasOwnProperty(l)?(null!=c&&"onScroll"===l&&Gr("scroll",e),o||u===c||(o=[])):(o=o||[]).push(l,c))}n&&(o=o||[]).push("style",n);var l=o;(t.updateQueue=l)&&(t.flags|=4)}},Ds=function(e,t,n,r){n!==r&&(t.flags|=4)};var Qs=!1,Js=!1,qs="function"===typeof WeakSet?WeakSet:Set,$s=null;function eu(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){_c(e,t,r)}else n.current=null}function tu(e,t,n){try{n()}catch(r){_c(e,t,r)}}var nu=!1;function ru(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var a=r=r.next;do{if((a.tag&e)===e){var i=a.destroy;a.destroy=void 0,void 0!==i&&tu(t,n,i)}a=a.next}while(a!==r)}}function au(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function iu(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function ou(e){var t=e.alternate;null!==t&&(e.alternate=null,ou(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[ha],delete t[pa],delete t[ma],delete t[va],delete t[ga])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function su(e){return 5===e.tag||3===e.tag||4===e.tag}function uu(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||su(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function cu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$r));else if(4!==r&&null!==(e=e.child))for(cu(e,t,n),e=e.sibling;null!==e;)cu(e,t,n),e=e.sibling}function lu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(lu(e,t,n),e=e.sibling;null!==e;)lu(e,t,n),e=e.sibling}var du=null,hu=!1;function pu(e,t,n){for(n=n.child;null!==n;)fu(e,t,n),n=n.sibling}function fu(e,t,n){if(it&&"function"===typeof it.onCommitFiberUnmount)try{it.onCommitFiberUnmount(at,n)}catch(s){}switch(n.tag){case 5:Js||eu(n,t);case 6:var r=du,a=hu;du=null,pu(e,t,n),hu=a,null!==(du=r)&&(hu?(e=du,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):du.removeChild(n.stateNode));break;case 18:null!==du&&(hu?(e=du,n=n.stateNode,8===e.nodeType?ua(e.parentNode,n):1===e.nodeType&&ua(e,n),Ut(e)):ua(du,n.stateNode));break;case 4:r=du,a=hu,du=n.stateNode.containerInfo,hu=!0,pu(e,t,n),du=r,hu=a;break;case 0:case 11:case 14:case 15:if(!Js&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){a=r=r.next;do{var i=a,o=i.destroy;i=i.tag,void 0!==o&&(0!==(2&i)||0!==(4&i))&&tu(n,t,o),a=a.next}while(a!==r)}pu(e,t,n);break;case 1:if(!Js&&(eu(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){_c(n,t,s)}pu(e,t,n);break;case 21:pu(e,t,n);break;case 22:1&n.mode?(Js=(r=Js)||null!==n.memoizedState,pu(e,t,n),Js=r):pu(e,t,n);break;default:pu(e,t,n)}}function mu(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new qs),t.forEach((function(t){var r=Mc.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function vu(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var a=n[r];try{var o=e,s=t,u=s;e:for(;null!==u;){switch(u.tag){case 5:du=u.stateNode,hu=!1;break e;case 3:case 4:du=u.stateNode.containerInfo,hu=!0;break e}u=u.return}if(null===du)throw Error(i(160));fu(o,s,a),du=null,hu=!1;var c=a.alternate;null!==c&&(c.return=null),a.return=null}catch(l){_c(a,t,l)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gu(t,e),t=t.sibling}function gu(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(vu(t,e),yu(e),4&r){try{ru(3,e,e.return),au(3,e)}catch(v){_c(e,e.return,v)}try{ru(5,e,e.return)}catch(v){_c(e,e.return,v)}}break;case 1:vu(t,e),yu(e),512&r&&null!==n&&eu(n,n.return);break;case 5:if(vu(t,e),yu(e),512&r&&null!==n&&eu(n,n.return),32&e.flags){var a=e.stateNode;try{he(a,"")}catch(v){_c(e,e.return,v)}}if(4&r&&null!=(a=e.stateNode)){var o=e.memoizedProps,s=null!==n?n.memoizedProps:o,u=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===u&&"radio"===o.type&&null!=o.name&&J(a,o),be(u,s);var l=be(u,o);for(s=0;s<c.length;s+=2){var d=c[s],h=c[s+1];"style"===d?ve(a,h):"dangerouslySetInnerHTML"===d?de(a,h):"children"===d?he(a,h):b(a,d,h,l)}switch(u){case"input":q(a,o);break;case"textarea":ie(a,o);break;case"select":var p=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!o.multiple;var f=o.value;null!=f?ne(a,!!o.multiple,f,!1):p!==!!o.multiple&&(null!=o.defaultValue?ne(a,!!o.multiple,o.defaultValue,!0):ne(a,!!o.multiple,o.multiple?[]:"",!1))}a[pa]=o}catch(v){_c(e,e.return,v)}}break;case 6:if(vu(t,e),yu(e),4&r){if(null===e.stateNode)throw Error(i(162));a=e.stateNode,o=e.memoizedProps;try{a.nodeValue=o}catch(v){_c(e,e.return,v)}}break;case 3:if(vu(t,e),yu(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Ut(t.containerInfo)}catch(v){_c(e,e.return,v)}break;case 4:default:vu(t,e),yu(e);break;case 13:vu(t,e),yu(e),8192&(a=e.child).flags&&(o=null!==a.memoizedState,a.stateNode.isHidden=o,!o||null!==a.alternate&&null!==a.alternate.memoizedState||(Uu=Je())),4&r&&mu(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?(Js=(l=Js)||d,vu(t,e),Js=l):vu(t,e),yu(e),8192&r){if(l=null!==e.memoizedState,(e.stateNode.isHidden=l)&&!d&&0!==(1&e.mode))for($s=e,d=e.child;null!==d;){for(h=$s=d;null!==$s;){switch(f=(p=$s).child,p.tag){case 0:case 11:case 14:case 15:ru(4,p,p.return);break;case 1:eu(p,p.return);var m=p.stateNode;if("function"===typeof m.componentWillUnmount){r=p,n=p.return;try{t=r,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(v){_c(r,n,v)}}break;case 5:eu(p,p.return);break;case 22:if(null!==p.memoizedState){ku(h);continue}}null!==f?(f.return=p,$s=f):ku(h)}d=d.sibling}e:for(d=null,h=e;;){if(5===h.tag){if(null===d){d=h;try{a=h.stateNode,l?"function"===typeof(o=a.style).setProperty?o.setProperty("display","none","important"):o.display="none":(u=h.stateNode,s=void 0!==(c=h.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,u.style.display=me("display",s))}catch(v){_c(e,e.return,v)}}}else if(6===h.tag){if(null===d)try{h.stateNode.nodeValue=l?"":h.memoizedProps}catch(v){_c(e,e.return,v)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:vu(t,e),yu(e),4&r&&mu(e);case 21:}}function yu(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(su(n)){var r=n;break e}n=n.return}throw Error(i(160))}switch(r.tag){case 5:var a=r.stateNode;32&r.flags&&(he(a,""),r.flags&=-33),lu(e,uu(e),a);break;case 3:case 4:var o=r.stateNode.containerInfo;cu(e,uu(e),o);break;default:throw Error(i(161))}}catch(s){_c(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function bu(e,t,n){$s=e,xu(e,t,n)}function xu(e,t,n){for(var r=0!==(1&e.mode);null!==$s;){var a=$s,i=a.child;if(22===a.tag&&r){var o=null!==a.memoizedState||Qs;if(!o){var s=a.alternate,u=null!==s&&null!==s.memoizedState||Js;s=Qs;var c=Js;if(Qs=o,(Js=u)&&!c)for($s=a;null!==$s;)u=(o=$s).child,22===o.tag&&null!==o.memoizedState?Su(a):null!==u?(u.return=o,$s=u):Su(a);for(;null!==i;)$s=i,xu(i,t,n),i=i.sibling;$s=a,Qs=s,Js=c}wu(e)}else 0!==(8772&a.subtreeFlags)&&null!==i?(i.return=a,$s=i):wu(e)}}function wu(e){for(;null!==$s;){var t=$s;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Js||au(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Js)if(null===n)r.componentDidMount();else{var a=t.elementType===t.type?n.memoizedProps:vi(t.type,n.memoizedProps);r.componentDidUpdate(a,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&Fi(t,o,r);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Fi(t,s,n)}break;case 5:var u=t.stateNode;if(null===n&&4&t.flags){n=u;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var l=t.alternate;if(null!==l){var d=l.memoizedState;if(null!==d){var h=d.dehydrated;null!==h&&Ut(h)}}}break;default:throw Error(i(163))}Js||512&t.flags&&iu(t)}catch(p){_c(t,t.return,p)}}if(t===e){$s=null;break}if(null!==(n=t.sibling)){n.return=t.return,$s=n;break}$s=t.return}}function ku(e){for(;null!==$s;){var t=$s;if(t===e){$s=null;break}var n=t.sibling;if(null!==n){n.return=t.return,$s=n;break}$s=t.return}}function Su(e){for(;null!==$s;){var t=$s;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{au(4,t)}catch(u){_c(t,n,u)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var a=t.return;try{r.componentDidMount()}catch(u){_c(t,a,u)}}var i=t.return;try{iu(t)}catch(u){_c(t,i,u)}break;case 5:var o=t.return;try{iu(t)}catch(u){_c(t,o,u)}}}catch(u){_c(t,t.return,u)}if(t===e){$s=null;break}var s=t.sibling;if(null!==s){s.return=t.return,$s=s;break}$s=t.return}}var Tu,_u=Math.ceil,Iu=x.ReactCurrentDispatcher,Eu=x.ReactCurrentOwner,Cu=x.ReactCurrentBatchConfig,Mu=0,Nu=null,Ru=null,Lu=0,Au=0,Pu=Ta(0),Du=0,Ou=null,zu=0,Fu=0,Gu=0,Wu=null,Vu=null,Uu=0,Xu=1/0,Bu=null,Hu=!1,Zu=null,Ku=null,ju=!1,Yu=null,Qu=0,Ju=0,qu=null,$u=-1,ec=0;function tc(){return 0!==(6&Mu)?Je():-1!==$u?$u:$u=Je()}function nc(e){return 0===(1&e.mode)?1:0!==(2&Mu)&&0!==Lu?Lu&-Lu:null!==mi.transition?(0===ec&&(ec=mt()),ec):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Qt(e.type)}function rc(e,t,n,r){if(50<Ju)throw Ju=0,qu=null,Error(i(185));gt(e,n,r),0!==(2&Mu)&&e===Nu||(e===Nu&&(0===(2&Mu)&&(Fu|=n),4===Du&&uc(e,Lu)),ac(e,r),1===n&&0===Mu&&0===(1&t.mode)&&(Xu=Je()+500,Ga&&Ua()))}function ac(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,i=e.pendingLanes;0<i;){var o=31-ot(i),s=1<<o,u=a[o];-1===u?0!==(s&n)&&0===(s&r)||(a[o]=pt(s,t)):u<=t&&(e.expiredLanes|=s),i&=~s}}(e,t);var r=ht(e,e===Nu?Lu:0);if(0===r)null!==n&&je(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&je(n),1===t)0===e.tag?function(e){Ga=!0,Va(e)}(cc.bind(null,e)):Va(cc.bind(null,e)),oa((function(){0===(6&Mu)&&Ua()})),n=null;else{switch(xt(r)){case 1:n=$e;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Nc(n,ic.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function ic(e,t){if($u=-1,ec=0,0!==(6&Mu))throw Error(i(327));var n=e.callbackNode;if(Sc()&&e.callbackNode!==n)return null;var r=ht(e,e===Nu?Lu:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=gc(e,r);else{t=r;var a=Mu;Mu|=2;var o=mc();for(Nu===e&&Lu===t||(Bu=null,Xu=Je()+500,pc(e,t));;)try{bc();break}catch(u){fc(e,u)}wi(),Iu.current=o,Mu=a,null!==Ru?t=0:(Nu=null,Lu=0,t=Du)}if(0!==t){if(2===t&&(0!==(a=ft(e))&&(r=a,t=oc(e,a))),1===t)throw n=Ou,pc(e,0),uc(e,r),ac(e,Je()),n;if(6===t)uc(e,r);else{if(a=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var a=n[r],i=a.getSnapshot;a=a.value;try{if(!sr(i(),a))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(a)&&(2===(t=gc(e,r))&&(0!==(o=ft(e))&&(r=o,t=oc(e,o))),1===t))throw n=Ou,pc(e,0),uc(e,r),ac(e,Je()),n;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(i(345));case 2:case 5:kc(e,Vu,Bu);break;case 3:if(uc(e,r),(130023424&r)===r&&10<(t=Uu+500-Je())){if(0!==ht(e,0))break;if(((a=e.suspendedLanes)&r)!==r){tc(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=ra(kc.bind(null,e,Vu,Bu),t);break}kc(e,Vu,Bu);break;case 4:if(uc(e,r),(4194240&r)===r)break;for(t=e.eventTimes,a=-1;0<r;){var s=31-ot(r);o=1<<s,(s=t[s])>a&&(a=s),r&=~o}if(r=a,10<(r=(120>(r=Je()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*_u(r/1960))-r)){e.timeoutHandle=ra(kc.bind(null,e,Vu,Bu),r);break}kc(e,Vu,Bu);break;default:throw Error(i(329))}}}return ac(e,Je()),e.callbackNode===n?ic.bind(null,e):null}function oc(e,t){var n=Wu;return e.current.memoizedState.isDehydrated&&(pc(e,t).flags|=256),2!==(e=gc(e,t))&&(t=Vu,Vu=n,null!==t&&sc(t)),e}function sc(e){null===Vu?Vu=e:Vu.push.apply(Vu,e)}function uc(e,t){for(t&=~Gu,t&=~Fu,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-ot(t),r=1<<n;e[n]=-1,t&=~r}}function cc(e){if(0!==(6&Mu))throw Error(i(327));Sc();var t=ht(e,0);if(0===(1&t))return ac(e,Je()),null;var n=gc(e,t);if(0!==e.tag&&2===n){var r=ft(e);0!==r&&(t=r,n=oc(e,r))}if(1===n)throw n=Ou,pc(e,0),uc(e,t),ac(e,Je()),n;if(6===n)throw Error(i(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,kc(e,Vu,Bu),ac(e,Je()),null}function lc(e,t){var n=Mu;Mu|=1;try{return e(t)}finally{0===(Mu=n)&&(Xu=Je()+500,Ga&&Ua())}}function dc(e){null!==Yu&&0===Yu.tag&&0===(6&Mu)&&Sc();var t=Mu;Mu|=1;var n=Cu.transition,r=bt;try{if(Cu.transition=null,bt=1,e)return e()}finally{bt=r,Cu.transition=n,0===(6&(Mu=t))&&Ua()}}function hc(){Au=Pu.current,_a(Pu)}function pc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,aa(n)),null!==Ru)for(n=Ru.return;null!==n;){var r=n;switch(ti(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Aa();break;case 3:ao(),_a(Ma),_a(Ca),lo();break;case 5:oo(r);break;case 4:ao();break;case 13:case 19:_a(so);break;case 10:ki(r.type._context);break;case 22:case 23:hc()}n=n.return}if(Nu=e,Ru=e=Pc(e.current,null),Lu=Au=t,Du=0,Ou=null,Gu=Fu=zu=0,Vu=Wu=null,null!==Ii){for(t=0;t<Ii.length;t++)if(null!==(r=(n=Ii[t]).interleaved)){n.interleaved=null;var a=r.next,i=n.pending;if(null!==i){var o=i.next;i.next=a,r.next=o}n.pending=r}Ii=null}return e}function fc(e,t){for(;;){var n=Ru;try{if(wi(),ho.current=os,yo){for(var r=mo.memoizedState;null!==r;){var a=r.queue;null!==a&&(a.pending=null),r=r.next}yo=!1}if(fo=0,go=vo=mo=null,bo=!1,xo=0,Eu.current=null,null===n||null===n.return){Du=1,Ou=t,Ru=null;break}e:{var o=e,s=n.return,u=n,c=t;if(t=Lu,u.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var l=c,d=u,h=d.tag;if(0===(1&d.mode)&&(0===h||11===h||15===h)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var f=gs(s);if(null!==f){f.flags&=-257,ys(f,s,u,0,t),1&f.mode&&vs(o,l,t),c=l;var m=(t=f).updateQueue;if(null===m){var v=new Set;v.add(c),t.updateQueue=v}else m.add(c);break e}if(0===(1&t)){vs(o,l,t),vc();break e}c=Error(i(426))}else if(ai&&1&u.mode){var g=gs(s);if(null!==g){0===(65536&g.flags)&&(g.flags|=256),ys(g,s,u,0,t),fi(ls(c,u));break e}}o=c=ls(c,u),4!==Du&&(Du=2),null===Wu?Wu=[o]:Wu.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,Oi(o,fs(0,c,t));break e;case 1:u=c;var y=o.type,b=o.stateNode;if(0===(128&o.flags)&&("function"===typeof y.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===Ku||!Ku.has(b)))){o.flags|=65536,t&=-t,o.lanes|=t,Oi(o,ms(o,u,t));break e}}o=o.return}while(null!==o)}wc(n)}catch(x){t=x,Ru===n&&null!==n&&(Ru=n=n.return);continue}break}}function mc(){var e=Iu.current;return Iu.current=os,null===e?os:e}function vc(){0!==Du&&3!==Du&&2!==Du||(Du=4),null===Nu||0===(268435455&zu)&&0===(268435455&Fu)||uc(Nu,Lu)}function gc(e,t){var n=Mu;Mu|=2;var r=mc();for(Nu===e&&Lu===t||(Bu=null,pc(e,t));;)try{yc();break}catch(a){fc(e,a)}if(wi(),Mu=n,Iu.current=r,null!==Ru)throw Error(i(261));return Nu=null,Lu=0,Du}function yc(){for(;null!==Ru;)xc(Ru)}function bc(){for(;null!==Ru&&!Ye();)xc(Ru)}function xc(e){var t=Tu(e.alternate,e,Au);e.memoizedProps=e.pendingProps,null===t?wc(e):Ru=t,Eu.current=null}function wc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=js(n,t,Au)))return void(Ru=n)}else{if(null!==(n=Ys(n,t)))return n.flags&=32767,void(Ru=n);if(null===e)return Du=6,void(Ru=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Ru=t);Ru=t=e}while(null!==t);0===Du&&(Du=5)}function kc(e,t,n){var r=bt,a=Cu.transition;try{Cu.transition=null,bt=1,function(e,t,n,r){do{Sc()}while(null!==Yu);if(0!==(6&Mu))throw Error(i(327));n=e.finishedWork;var a=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(i(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var a=31-ot(n),i=1<<a;t[a]=0,r[a]=-1,e[a]=-1,n&=~i}}(e,o),e===Nu&&(Ru=Nu=null,Lu=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||ju||(ju=!0,Nc(tt,(function(){return Sc(),null}))),o=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||o){o=Cu.transition,Cu.transition=null;var s=bt;bt=1;var u=Mu;Mu|=4,Eu.current=null,function(e,t){if(ea=Bt,pr(e=hr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var a=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch(w){n=null;break e}var s=0,u=-1,c=-1,l=0,d=0,h=e,p=null;t:for(;;){for(var f;h!==n||0!==a&&3!==h.nodeType||(u=s+a),h!==o||0!==r&&3!==h.nodeType||(c=s+r),3===h.nodeType&&(s+=h.nodeValue.length),null!==(f=h.firstChild);)p=h,h=f;for(;;){if(h===e)break t;if(p===n&&++l===a&&(u=s),p===o&&++d===r&&(c=s),null!==(f=h.nextSibling))break;p=(h=p).parentNode}h=f}n=-1===u||-1===c?null:{start:u,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ta={focusedElem:e,selectionRange:n},Bt=!1,$s=t;null!==$s;)if(e=(t=$s).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,$s=e;else for(;null!==$s;){t=$s;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var v=m.memoizedProps,g=m.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(t.elementType===t.type?v:vi(t.type,v),g);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var x=t.stateNode.containerInfo;1===x.nodeType?x.textContent="":9===x.nodeType&&x.documentElement&&x.removeChild(x.documentElement);break;default:throw Error(i(163))}}catch(w){_c(t,t.return,w)}if(null!==(e=t.sibling)){e.return=t.return,$s=e;break}$s=t.return}m=nu,nu=!1}(e,n),gu(n,e),fr(ta),Bt=!!ea,ta=ea=null,e.current=n,bu(n,e,a),Qe(),Mu=u,bt=s,Cu.transition=o}else e.current=n;if(ju&&(ju=!1,Yu=e,Qu=a),o=e.pendingLanes,0===o&&(Ku=null),function(e){if(it&&"function"===typeof it.onCommitFiberRoot)try{it.onCommitFiberRoot(at,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),ac(e,Je()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)a=t[n],r(a.value,{componentStack:a.stack,digest:a.digest});if(Hu)throw Hu=!1,e=Zu,Zu=null,e;0!==(1&Qu)&&0!==e.tag&&Sc(),o=e.pendingLanes,0!==(1&o)?e===qu?Ju++:(Ju=0,qu=e):Ju=0,Ua()}(e,t,n,r)}finally{Cu.transition=a,bt=r}return null}function Sc(){if(null!==Yu){var e=xt(Qu),t=Cu.transition,n=bt;try{if(Cu.transition=null,bt=16>e?16:e,null===Yu)var r=!1;else{if(e=Yu,Yu=null,Qu=0,0!==(6&Mu))throw Error(i(331));var a=Mu;for(Mu|=4,$s=e.current;null!==$s;){var o=$s,s=o.child;if(0!==(16&$s.flags)){var u=o.deletions;if(null!==u){for(var c=0;c<u.length;c++){var l=u[c];for($s=l;null!==$s;){var d=$s;switch(d.tag){case 0:case 11:case 15:ru(8,d,o)}var h=d.child;if(null!==h)h.return=d,$s=h;else for(;null!==$s;){var p=(d=$s).sibling,f=d.return;if(ou(d),d===l){$s=null;break}if(null!==p){p.return=f,$s=p;break}$s=f}}}var m=o.alternate;if(null!==m){var v=m.child;if(null!==v){m.child=null;do{var g=v.sibling;v.sibling=null,v=g}while(null!==v)}}$s=o}}if(0!==(2064&o.subtreeFlags)&&null!==s)s.return=o,$s=s;else e:for(;null!==$s;){if(0!==(2048&(o=$s).flags))switch(o.tag){case 0:case 11:case 15:ru(9,o,o.return)}var y=o.sibling;if(null!==y){y.return=o.return,$s=y;break e}$s=o.return}}var b=e.current;for($s=b;null!==$s;){var x=(s=$s).child;if(0!==(2064&s.subtreeFlags)&&null!==x)x.return=s,$s=x;else e:for(s=b;null!==$s;){if(0!==(2048&(u=$s).flags))try{switch(u.tag){case 0:case 11:case 15:au(9,u)}}catch(k){_c(u,u.return,k)}if(u===s){$s=null;break e}var w=u.sibling;if(null!==w){w.return=u.return,$s=w;break e}$s=u.return}}if(Mu=a,Ua(),it&&"function"===typeof it.onPostCommitFiberRoot)try{it.onPostCommitFiberRoot(at,e)}catch(k){}r=!0}return r}finally{bt=n,Cu.transition=t}}return!1}function Tc(e,t,n){e=Pi(e,t=fs(0,t=ls(n,t),1),1),t=tc(),null!==e&&(gt(e,1,t),ac(e,t))}function _c(e,t,n){if(3===e.tag)Tc(e,e,n);else for(;null!==t;){if(3===t.tag){Tc(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Ku||!Ku.has(r))){t=Pi(t,e=ms(t,e=ls(n,e),1),1),e=tc(),null!==t&&(gt(t,1,e),ac(t,e));break}}t=t.return}}function Ic(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=tc(),e.pingedLanes|=e.suspendedLanes&n,Nu===e&&(Lu&n)===n&&(4===Du||3===Du&&(130023424&Lu)===Lu&&500>Je()-Uu?pc(e,0):Gu|=n),ac(e,t)}function Ec(e,t){0===t&&(0===(1&e.mode)?t=1:(t=lt,0===(130023424&(lt<<=1))&&(lt=4194304)));var n=tc();null!==(e=Mi(e,t))&&(gt(e,t,n),ac(e,n))}function Cc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Ec(e,n)}function Mc(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;null!==a&&(n=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(i(314))}null!==r&&r.delete(t),Ec(e,n)}function Nc(e,t){return Ke(e,t)}function Rc(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Lc(e,t,n,r){return new Rc(e,t,n,r)}function Ac(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Pc(e,t){var n=e.alternate;return null===n?((n=Lc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Dc(e,t,n,r,a,o){var s=2;if(r=e,"function"===typeof e)Ac(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case S:return Oc(n.children,a,o,t);case T:s=8,a|=8;break;case _:return(e=Lc(12,n,t,2|a)).elementType=_,e.lanes=o,e;case M:return(e=Lc(13,n,t,a)).elementType=M,e.lanes=o,e;case N:return(e=Lc(19,n,t,a)).elementType=N,e.lanes=o,e;case A:return zc(n,a,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case I:s=10;break e;case E:s=9;break e;case C:s=11;break e;case R:s=14;break e;case L:s=16,r=null;break e}throw Error(i(130,null==e?e:typeof e,""))}return(t=Lc(s,n,t,a)).elementType=e,t.type=r,t.lanes=o,t}function Oc(e,t,n,r){return(e=Lc(7,e,r,t)).lanes=n,e}function zc(e,t,n,r){return(e=Lc(22,e,r,t)).elementType=A,e.lanes=n,e.stateNode={isHidden:!1},e}function Fc(e,t,n){return(e=Lc(6,e,null,t)).lanes=n,e}function Gc(e,t,n){return(t=Lc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Wc(e,t,n,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=vt(0),this.expirationTimes=vt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vt(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function Vc(e,t,n,r,a,i,o,s,u){return e=new Wc(e,t,n,s,u),1===t?(t=1,!0===i&&(t|=8)):t=0,i=Lc(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ri(i),e}function Uc(e){if(!e)return Ea;e:{if(Ue(e=e._reactInternals)!==e||1!==e.tag)throw Error(i(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(La(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(i(171))}if(1===e.tag){var n=e.type;if(La(n))return Da(e,n,t)}return t}function Xc(e,t,n,r,a,i,o,s,u){return(e=Vc(n,r,!0,e,0,i,0,s,u)).context=Uc(null),n=e.current,(i=Ai(r=tc(),a=nc(n))).callback=void 0!==t&&null!==t?t:null,Pi(n,i,a),e.current.lanes=a,gt(e,a,r),ac(e,r),e}function Bc(e,t,n,r){var a=t.current,i=tc(),o=nc(a);return n=Uc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Ai(i,o)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Pi(a,t,o))&&(rc(e,a,o,i),Di(e,a,o)),o}function Hc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Zc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Kc(e,t){Zc(e,t),(e=e.alternate)&&Zc(e,t)}Tu=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ma.current)xs=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return xs=!1,function(e,t,n){switch(t.tag){case 3:Ns(t),pi();break;case 5:io(t);break;case 1:La(t.type)&&Oa(t);break;case 4:ro(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,a=t.memoizedProps.value;Ia(gi,r._currentValue),r._currentValue=a;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ia(so,1&so.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Fs(e,t,n):(Ia(so,1&so.current),null!==(e=Hs(e,t,n))?e.sibling:null);Ia(so,1&so.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Xs(e,t,n);t.flags|=128}if(null!==(a=t.memoizedState)&&(a.rendering=null,a.tail=null,a.lastEffect=null),Ia(so,so.current),r)break;return null;case 22:case 23:return t.lanes=0,_s(e,t,n)}return Hs(e,t,n)}(e,t,n);xs=0!==(131072&e.flags)}else xs=!1,ai&&0!==(1048576&t.flags)&&$a(t,Za,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Bs(e,t),e=t.pendingProps;var a=Ra(t,Ca.current);Ti(t,n),a=To(null,t,r,e,a,n);var o=_o();return t.flags|=1,"object"===typeof a&&null!==a&&"function"===typeof a.render&&void 0===a.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,La(r)?(o=!0,Oa(t)):o=!1,t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,Ri(t),a.updater=Vi,t.stateNode=a,a._reactInternals=t,Hi(t,r,e,n),t=Ms(null,t,r,!0,o,n)):(t.tag=0,ai&&o&&ei(t),ws(null,t,a,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Bs(e,t),e=t.pendingProps,r=(a=r._init)(r._payload),t.type=r,a=t.tag=function(e){if("function"===typeof e)return Ac(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===C)return 11;if(e===R)return 14}return 2}(r),e=vi(r,e),a){case 0:t=Es(null,t,r,e,n);break e;case 1:t=Cs(null,t,r,e,n);break e;case 11:t=ks(null,t,r,e,n);break e;case 14:t=Ss(null,t,r,vi(r.type,e),n);break e}throw Error(i(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,Es(e,t,r,a=t.elementType===r?a:vi(r,a),n);case 1:return r=t.type,a=t.pendingProps,Cs(e,t,r,a=t.elementType===r?a:vi(r,a),n);case 3:e:{if(Ns(t),null===e)throw Error(i(387));r=t.pendingProps,a=(o=t.memoizedState).element,Li(e,t),zi(t,r,null,n);var s=t.memoizedState;if(r=s.element,o.isDehydrated){if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Rs(e,t,r,n,a=ls(Error(i(423)),t));break e}if(r!==a){t=Rs(e,t,r,n,a=ls(Error(i(424)),t));break e}for(ri=ca(t.stateNode.containerInfo.firstChild),ni=t,ai=!0,ii=null,n=Ji(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(pi(),r===a){t=Hs(e,t,n);break e}ws(e,t,r,n)}t=t.child}return t;case 5:return io(t),null===e&&ci(t),r=t.type,a=t.pendingProps,o=null!==e?e.memoizedProps:null,s=a.children,na(r,a)?s=null:null!==o&&na(r,o)&&(t.flags|=32),Is(e,t),ws(e,t,s,n),t.child;case 6:return null===e&&ci(t),null;case 13:return Fs(e,t,n);case 4:return ro(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Qi(t,null,r,n):ws(e,t,r,n),t.child;case 11:return r=t.type,a=t.pendingProps,ks(e,t,r,a=t.elementType===r?a:vi(r,a),n);case 7:return ws(e,t,t.pendingProps,n),t.child;case 8:case 12:return ws(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,o=t.memoizedProps,s=a.value,Ia(gi,r._currentValue),r._currentValue=s,null!==o)if(sr(o.value,s)){if(o.children===a.children&&!Ma.current){t=Hs(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var u=o.dependencies;if(null!==u){s=o.child;for(var c=u.firstContext;null!==c;){if(c.context===r){if(1===o.tag){(c=Ai(-1,n&-n)).tag=2;var l=o.updateQueue;if(null!==l){var d=(l=l.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),l.pending=c}}o.lanes|=n,null!==(c=o.alternate)&&(c.lanes|=n),Si(o.return,n,t),u.lanes|=n;break}c=c.next}}else if(10===o.tag)s=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(s=o.return))throw Error(i(341));s.lanes|=n,null!==(u=s.alternate)&&(u.lanes|=n),Si(s,n,t),s=o.sibling}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===t){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}ws(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,Ti(t,n),r=r(a=_i(a)),t.flags|=1,ws(e,t,r,n),t.child;case 14:return a=vi(r=t.type,t.pendingProps),Ss(e,t,r,a=vi(r.type,a),n);case 15:return Ts(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:vi(r,a),Bs(e,t),t.tag=1,La(r)?(e=!0,Oa(t)):e=!1,Ti(t,n),Xi(t,r,a),Hi(t,r,a,n),Ms(null,t,r,!0,e,n);case 19:return Xs(e,t,n);case 22:return _s(e,t,n)}throw Error(i(156,t.tag))};var jc="function"===typeof reportError?reportError:function(e){console.error(e)};function Yc(e){this._internalRoot=e}function Qc(e){this._internalRoot=e}function Jc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function qc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function $c(){}function el(e,t,n,r,a){var i=n._reactRootContainer;if(i){var o=i;if("function"===typeof a){var s=a;a=function(){var e=Hc(o);s.call(e)}}Bc(t,o,e,a)}else o=function(e,t,n,r,a){if(a){if("function"===typeof r){var i=r;r=function(){var e=Hc(o);i.call(e)}}var o=Xc(t,r,e,0,null,!1,0,"",$c);return e._reactRootContainer=o,e[fa]=o.current,Ur(8===e.nodeType?e.parentNode:e),dc(),o}for(;a=e.lastChild;)e.removeChild(a);if("function"===typeof r){var s=r;r=function(){var e=Hc(u);s.call(e)}}var u=Vc(e,0,!1,null,0,!1,0,"",$c);return e._reactRootContainer=u,e[fa]=u.current,Ur(8===e.nodeType?e.parentNode:e),dc((function(){Bc(t,u,n,r)})),u}(n,t,e,a,r);return Hc(o)}Qc.prototype.render=Yc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(i(409));Bc(e,t,null,null)},Qc.prototype.unmount=Yc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;dc((function(){Bc(null,e,null,null)})),t[fa]=null}},Qc.prototype.unstable_scheduleHydration=function(e){if(e){var t=Tt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<At.length&&0!==t&&t<At[n].priority;n++);At.splice(n,0,e),0===n&&zt(e)}},wt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(yt(t,1|n),ac(t,Je()),0===(6&Mu)&&(Xu=Je()+500,Ua()))}break;case 13:dc((function(){var t=Mi(e,1);if(null!==t){var n=tc();rc(t,e,1,n)}})),Kc(e,1)}},kt=function(e){if(13===e.tag){var t=Mi(e,134217728);if(null!==t)rc(t,e,134217728,tc());Kc(e,134217728)}},St=function(e){if(13===e.tag){var t=nc(e),n=Mi(e,t);if(null!==n)rc(n,e,t,tc());Kc(e,t)}},Tt=function(){return bt},_t=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},ke=function(e,t,n){switch(t){case"input":if(q(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=wa(r);if(!a)throw Error(i(90));K(r),q(r,a)}}}break;case"textarea":ie(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ce=lc,Me=dc;var tl={usingClientEntryPoint:!1,Events:[ba,xa,wa,Ie,Ee,lc]},nl={findFiberByHostInstance:ya,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},rl={bundleType:nl.bundleType,version:nl.version,rendererPackageName:nl.rendererPackageName,rendererConfig:nl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=He(e))?null:e.stateNode},findFiberByHostInstance:nl.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var al=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!al.isDisabled&&al.supportsFiber)try{at=al.inject(rl),it=al}catch(le){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tl,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Jc(t))throw Error(i(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:k,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Jc(e))throw Error(i(299));var n=!1,r="",a=jc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(a=t.onRecoverableError)),t=Vc(e,1,!1,null,0,n,0,r,a),e[fa]=t.current,Ur(8===e.nodeType?e.parentNode:e),new Yc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(i(188));throw e=Object.keys(e).join(","),Error(i(268,e))}return e=null===(e=He(t))?null:e.stateNode},t.flushSync=function(e){return dc(e)},t.hydrate=function(e,t,n){if(!qc(t))throw Error(i(200));return el(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Jc(e))throw Error(i(405));var r=null!=n&&n.hydratedSources||null,a=!1,o="",s=jc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(a=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Xc(t,null,e,1,null!=n?n:null,a,0,o,s),e[fa]=t.current,Ur(e),r)for(e=0;e<r.length;e++)a=(a=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,a]:t.mutableSourceEagerHydrationData.push(n,a);return new Qc(t)},t.render=function(e,t,n){if(!qc(t))throw Error(i(200));return el(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!qc(e))throw Error(i(40));return!!e._reactRootContainer&&(dc((function(){el(null,null,e,!1,(function(){e._reactRootContainer=null,e[fa]=null}))})),!0)},t.unstable_batchedUpdates=lc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!qc(n))throw Error(i(200));if(null==e||void 0===e._reactInternals)throw Error(i(38));return el(e,t,n,!1,r)},t.version="18.2.0-next-9e3b772b8-20220608"},250:function(e,t,n){var r=n(164);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},164:function(e,t,n){!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(463)},3:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.Unity=void 0;var r=n(791),a=n(791),i=n(445),o=n(802),s=n(604),u=n(428),c=(0,a.forwardRef)((function(e,t){var n=(0,a.useRef)(null),c=(0,i.useUnityCanvasId)(),l=(0,s.useUnityArguments)(e),d=(0,u.useUnityLoader)(e.unityProvider.unityConfig.loaderUrl);return(0,o.useUnityInstance)(d,n.current,l,e.unityProvider),(0,r.useImperativeHandle)(t,(function(){return n.current})),(0,r.createElement)("canvas",{ref:n,id:c,style:e.style,className:e.className,tabIndex:e.tabIndex})}));t.Unity=c},774:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.errorMessages=void 0;t.errorMessages={genericNoUnityInstance:"No Unity Instance found.",requestFullscreenNoUnityInstance:"Unable to Set Fullscreen while Unity is not Instantiated.",requestPointerLockNoUnityInstanceOrCanvas:"Unable to Request Pointer Lock while Unity is not Instantiated or the Canvas is not found.",sendMessageNoUnityInstance:"Unable to Send Message while Unity is not Instantiated.",quitNoUnityInstance:"Unable to Quit Unity while Unity is not Instantiated.",screenshotNoUnityInstanceOrCanvas:"Unable to Take Screenshot while Unity is not Instantiated or Canvas is not available.",noEventListener:"Unable to find Event Listener in Event System for Event"}},359:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isBrowserEnvironment=void 0,t.isBrowserEnvironment="undefined"!==typeof window&&"undefined"!==typeof document},229:function(e,t){var n;Object.defineProperty(t,"__esModule",{value:!0}),t.UnityLoaderStatus=void 0,function(e){e.Idle="Idle",e.Loading="Loading",e.Loaded="Loaded",e.Error="Error"}(n||(n={})),t.UnityLoaderStatus=n},277:function(e,t,n){t.JM=t.Y4=void 0;var r=n(3);Object.defineProperty(t,"Y4",{enumerable:!0,get:function(){return r.Unity}});var a=n(138);Object.defineProperty(t,"JM",{enumerable:!0,get:function(){return a.useUnityContext}})},773:function(e,t,n){var r=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,a=0,i=t.length;a<i;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.useEventSystem=void 0;var a=n(791),i=n(774),o=n(359),s=[];!0===o.isBrowserEnvironment&&(window.dispatchReactUnityEvent=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var a=void 0;return s.forEach((function(n){a=n.apply(void 0,r([e],t,!1))})),a});t.useEventSystem=function(){var e=(0,a.useRef)([]),t=(0,a.useCallback)((function(t,n){e.current=r(r([],e.current,!0),[{eventName:t,callback:n}],!1)}),[e]),n=(0,a.useCallback)((function(t,n){e.current=e.current.filter((function(e){return e.eventName!==t&&e.callback!==n}))}),[e]),o=(0,a.useCallback)((function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var a=e.current.find((function(e){return e.eventName===t}));if("undefined"!==typeof a)return a.callback.apply(a,n);console.warn(i.errorMessages.noEventListener,{eventName:t})}),[e]);return(0,a.useEffect)((function(){return s.push(o),function(){s.splice(s.indexOf(o),1)}}),[o]),{addEventListener:t,removeEventListener:n}}},627:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.useNullableState=void 0;var r=n(791);t.useNullableState=function(e){return(0,r.useState)(e||null)}},604:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.useUnityArguments=void 0;var r=n(791);t.useUnityArguments=function(e){return(0,r.useMemo)((function(){return{dataUrl:e.unityProvider.unityConfig.dataUrl,frameworkUrl:e.unityProvider.unityConfig.frameworkUrl,codeUrl:e.unityProvider.unityConfig.codeUrl,streamingAssetsUrl:e.unityProvider.unityConfig.streamingAssetsUrl,memoryUrl:e.unityProvider.unityConfig.memoryUrl,symbolsUrl:e.unityProvider.unityConfig.symbolsUrl,companyName:e.unityProvider.unityConfig.companyName,productName:e.unityProvider.unityConfig.productName,productVersion:e.unityProvider.unityConfig.productVersion,webglContextAttributes:e.unityProvider.unityConfig.webglContextAttributes||{},cacheControl:e.unityProvider.unityConfig.cacheControl||function(){return"must-revalidate"},devicePixelRatio:e.devicePixelRatio||1,matchWebGLToCanvasSize:e.matchWebGLToCanvasSize||!0,disabledCanvasEvents:e.disabledCanvasEvents||["contextmenu","dragstart"],print:function(e){},printErr:function(e){}}}),[])}},445:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.useUnityCanvasId=void 0;var r=n(791),a=0,i="react-unity-webgl-canvas";t.useUnityCanvasId=function(){return(0,r.useMemo)((function(){return[i,++a].join("-")}),[])}},138:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(s){i=[6,s],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.useUnityContext=void 0;var i=n(791),o=n(774),s=n(773),u=n(627);t.useUnityContext=function(e){var t=(0,u.useNullableState)(),n=t[0],c=t[1],l=(0,i.useState)(0),d=l[0],h=l[1],p=(0,i.useState)(!1),f=p[0],m=p[1],v=(0,u.useNullableState)(),g=v[0],y=v[1],b=(0,s.useEventSystem)(),x=(0,i.useRef)({setLoadingProgression:h,setInitialisationError:y,setUnityInstance:c,setIsLoaded:m,unityConfig:e}),w=(0,i.useCallback)((function(e){null!==n?n.SetFullscreen(!0===e?1:0):console.warn(o.errorMessages.requestFullscreenNoUnityInstance)}),[n]),k=(0,i.useCallback)((function(){if(null!==n&&"undefined"!==typeof n.Module.canvas)return n.Module.canvas.requestPointerLock();console.warn(o.errorMessages.requestPointerLockNoUnityInstanceOrCanvas)}),[n]),S=(0,i.useCallback)((function(e,t,r){null!==n?n.SendMessage(e,t,r):console.warn(o.errorMessages.sendMessageNoUnityInstance)}),[n]),T=(0,i.useCallback)((function(e,t){if(null!==n&&"undefined"!==typeof n.Module.canvas)return n.Module.canvas.toDataURL(e,t);console.warn(o.errorMessages.screenshotNoUnityInstanceOrCanvas)}),[n]),_=(0,i.useCallback)((function(){return null===n?(console.warn(o.errorMessages.quitNoUnityInstance),Promise.reject()):n.Quit()}),[n]),I=(0,i.useCallback)((function(){return r(void 0,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return null===n||"undefined"===typeof n.Module.canvas?(console.warn(o.errorMessages.genericNoUnityInstance),[2,Promise.reject()]):(e=n.Module.canvas,document.body.appendChild(e),e.style.display="none",[4,_()]);case 1:return t.sent(),e.remove(),[2]}}))}))}),[n]);return(0,i.useEffect)((function(){m(1===d)}),[d]),{unityProvider:x.current,loadingProgression:d,initialisationError:g,isLoaded:f,UNSAFE__unityInstance:n,requestFullscreen:w,requestPointerLock:k,sendMessage:S,unload:_,takeScreenshot:T,addEventListener:b.addEventListener,removeEventListener:b.removeEventListener,UNSAFE__detachAndUnloadImmediate:I}}},802:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(s){i=[6,s],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.useUnityInstance=void 0;var i=n(791),o=n(229),s=n(359);t.useUnityInstance=function(e,t,n,u){(0,i.useEffect)((function(){r(void 0,void 0,void 0,(function(){var r,i;return a(this,(function(a){switch(a.label){case 0:if(!1===s.isBrowserEnvironment)return[2];if(e!==o.UnityLoaderStatus.Loaded||null===t)return u.setUnityInstance(null),u.setInitialisationError(null),[2];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,window.createUnityInstance(t,n,u.setLoadingProgression)];case 2:return r=a.sent(),u.setUnityInstance(r),u.setInitialisationError(null),[3,4];case 3:return i=a.sent(),u.setUnityInstance(null),u.setInitialisationError(i),[3,4];case 4:return[2]}}))}))}),[e,t,n,u])}},428:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.useUnityLoader=void 0;var r=n(791),a=n(359),i=n(229);t.useUnityLoader=function(e){var t=(0,r.useState)(i.UnityLoaderStatus.Loading),n=t[0],o=t[1];return(0,r.useEffect)((function(){if(!1!==a.isBrowserEnvironment){if(null!==e){var t=window.document.querySelector('script[src="'.concat(e,'"]'));null===t?((t=window.document.createElement("script")).type="text/javascript",t.src=e,t.async=!0,t.setAttribute("data-status","loading"),window.document.body.appendChild(t),t.addEventListener("load",(function(){return null===t||void 0===t?void 0:t.setAttribute("data-status","loaded")})),t.addEventListener("error",(function(){return null===t||void 0===t?void 0:t.setAttribute("data-status","error")}))):o("loaded"===t.getAttribute("data-status")?i.UnityLoaderStatus.Loaded:i.UnityLoaderStatus.Error);var n=function(e){return o("load"===e.type?i.UnityLoaderStatus.Loaded:i.UnityLoaderStatus.Error)};return t.addEventListener("load",n),t.addEventListener("error",n),function(){null!==t&&(t.removeEventListener("load",n),t.removeEventListener("error",n),window.document.body.removeChild(t))}}o(i.UnityLoaderStatus.Idle)}}),[e]),n}},374:function(e,t,n){var r=n(791),a=Symbol.for("react.element"),i=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,i={},c=null,l=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(l=t.ref),t)o.call(t,r)&&!u.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:a,type:e,key:c,ref:l,props:i,_owner:s.current}}t.jsx=c,t.jsxs=c},117:function(e,t){var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),u=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,v={};function g(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||f}function y(){}function b(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||f}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=g.prototype;var x=b.prototype=new y;x.constructor=b,m(x,g.prototype),x.isPureReactComponent=!0;var w=Array.isArray,k=Object.prototype.hasOwnProperty,S={current:null},T={key:!0,ref:!0,__self:!0,__source:!0};function _(e,t,r){var a,i={},o=null,s=null;if(null!=t)for(a in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)k.call(t,a)&&!T.hasOwnProperty(a)&&(i[a]=t[a]);var u=arguments.length-2;if(1===u)i.children=r;else if(1<u){for(var c=Array(u),l=0;l<u;l++)c[l]=arguments[l+2];i.children=c}if(e&&e.defaultProps)for(a in u=e.defaultProps)void 0===i[a]&&(i[a]=u[a]);return{$$typeof:n,type:e,key:o,ref:s,props:i,_owner:S.current}}function I(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var E=/\/+/g;function C(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function M(e,t,a,i,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var u=!1;if(null===e)u=!0;else switch(s){case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case n:case r:u=!0}}if(u)return o=o(u=e),e=""===i?"."+C(u,0):i,w(o)?(a="",null!=e&&(a=e.replace(E,"$&/")+"/"),M(o,t,a,"",(function(e){return e}))):null!=o&&(I(o)&&(o=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,a+(!o.key||u&&u.key===o.key?"":(""+o.key).replace(E,"$&/")+"/")+e)),t.push(o)),1;if(u=0,i=""===i?".":i+":",w(e))for(var c=0;c<e.length;c++){var l=i+C(s=e[c],c);u+=M(s,t,a,l,o)}else if(l=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof l)for(e=l.call(e),c=0;!(s=e.next()).done;)u+=M(s=s.value,t,a,l=i+C(s,c++),o);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return u}function N(e,t,n){if(null==e)return e;var r=[],a=0;return M(e,r,"","",(function(e){return t.call(n,e,a++)})),r}function R(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var L={current:null},A={transition:null},P={ReactCurrentDispatcher:L,ReactCurrentBatchConfig:A,ReactCurrentOwner:S};t.Children={map:N,forEach:function(e,t,n){N(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return N(e,(function(){t++})),t},toArray:function(e){return N(e,(function(e){return e}))||[]},only:function(e){if(!I(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=g,t.Fragment=a,t.Profiler=o,t.PureComponent=b,t.StrictMode=i,t.Suspense=l,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=P,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var a=m({},e.props),i=e.key,o=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,s=S.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(c in t)k.call(t,c)&&!T.hasOwnProperty(c)&&(a[c]=void 0===t[c]&&void 0!==u?u[c]:t[c])}var c=arguments.length-2;if(1===c)a.children=r;else if(1<c){u=Array(c);for(var l=0;l<c;l++)u[l]=arguments[l+2];a.children=u}return{$$typeof:n,type:e.type,key:i,ref:o,props:a,_owner:s}},t.createContext=function(e){return(e={$$typeof:u,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=_,t.createFactory=function(e){var t=_.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=I,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:R}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=A.transition;A.transition={};try{e()}finally{A.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return L.current.useCallback(e,t)},t.useContext=function(e){return L.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return L.current.useDeferredValue(e)},t.useEffect=function(e,t){return L.current.useEffect(e,t)},t.useId=function(){return L.current.useId()},t.useImperativeHandle=function(e,t,n){return L.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return L.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return L.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return L.current.useMemo(e,t)},t.useReducer=function(e,t,n){return L.current.useReducer(e,t,n)},t.useRef=function(e){return L.current.useRef(e)},t.useState=function(e){return L.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return L.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return L.current.useTransition()},t.version="18.2.0"},791:function(e,t,n){e.exports=n(117)},184:function(e,t,n){e.exports=n(374)},813:function(e,t){function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,a=e[r];if(!(0<i(a,t)))break e;e[r]=t,e[n]=a,n=r}}function r(e){return 0===e.length?null:e[0]}function a(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length,o=a>>>1;r<o;){var s=2*(r+1)-1,u=e[s],c=s+1,l=e[c];if(0>i(u,n))c<a&&0>i(l,u)?(e[r]=l,e[c]=n,r=c):(e[r]=u,e[s]=n,r=s);else{if(!(c<a&&0>i(l,n)))break e;e[r]=l,e[c]=n,r=c}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,u=s.now();t.unstable_now=function(){return s.now()-u}}var c=[],l=[],d=1,h=null,p=3,f=!1,m=!1,v=!1,g="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=r(l);null!==t;){if(null===t.callback)a(l);else{if(!(t.startTime<=e))break;a(l),t.sortIndex=t.expirationTime,n(c,t)}t=r(l)}}function w(e){if(v=!1,x(e),!m)if(null!==r(c))m=!0,A(k);else{var t=r(l);null!==t&&P(w,t.startTime-e)}}function k(e,n){m=!1,v&&(v=!1,y(I),I=-1),f=!0;var i=p;try{for(x(n),h=r(c);null!==h&&(!(h.expirationTime>n)||e&&!M());){var o=h.callback;if("function"===typeof o){h.callback=null,p=h.priorityLevel;var s=o(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?h.callback=s:h===r(c)&&a(c),x(n)}else a(c);h=r(c)}if(null!==h)var u=!0;else{var d=r(l);null!==d&&P(w,d.startTime-n),u=!1}return u}finally{h=null,p=i,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,T=!1,_=null,I=-1,E=5,C=-1;function M(){return!(t.unstable_now()-C<E)}function N(){if(null!==_){var e=t.unstable_now();C=e;var n=!0;try{n=_(!0,e)}finally{n?S():(T=!1,_=null)}}else T=!1}if("function"===typeof b)S=function(){b(N)};else if("undefined"!==typeof MessageChannel){var R=new MessageChannel,L=R.port2;R.port1.onmessage=N,S=function(){L.postMessage(null)}}else S=function(){g(N,0)};function A(e){_=e,T||(T=!0,S())}function P(e,n){I=g((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,A(k))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,a,i){var o=t.unstable_now();switch("object"===typeof i&&null!==i?i="number"===typeof(i=i.delay)&&0<i?o+i:o:i=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:d++,callback:a,priorityLevel:e,startTime:i,expirationTime:s=i+s,sortIndex:-1},i>o?(e.sortIndex=i,n(l,e),null===r(c)&&e===r(l)&&(v?(y(I),I=-1):v=!0,P(w,i-o))):(e.sortIndex=s,n(c,e),m||f||(m=!0,A(k))),e},t.unstable_shouldYield=M,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},296:function(e,t,n){e.exports=n(813)}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}n.m=e,n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce((function(t,r){return n.f[r](e,t),t}),[]))},n.u=function(e){return"static/js/"+e+".af22aece.chunk.js"},n.miniCssF=function(e){},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e={},t="ar-test:";n.l=function(r,a,i,o){if(e[r])e[r].push(a);else{var s,u;if(void 0!==i)for(var c=document.getElementsByTagName("script"),l=0;l<c.length;l++){var d=c[l];if(d.getAttribute("src")==r||d.getAttribute("data-webpack")==t+i){s=d;break}}s||(u=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,n.nc&&s.setAttribute("nonce",n.nc),s.setAttribute("data-webpack",t+i),s.src=r),e[r]=[a];var h=function(t,n){s.onerror=s.onload=null,clearTimeout(p);var a=e[r];if(delete e[r],s.parentNode&&s.parentNode.removeChild(s),a&&a.forEach((function(e){return e(n)})),t)return t(n)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=h.bind(null,s.onerror),s.onload=h.bind(null,s.onload),u&&document.head.appendChild(s)}}}(),n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/",function(){var e={179:0};n.f.j=function(t,r){var a=n.o(e,t)?e[t]:void 0;if(0!==a)if(a)r.push(a[2]);else{var i=new Promise((function(n,r){a=e[t]=[n,r]}));r.push(a[2]=i);var o=n.p+n.u(t),s=new Error;n.l(o,(function(r){if(n.o(e,t)&&(0!==(a=e[t])&&(e[t]=void 0),a)){var i=r&&("load"===r.type?"missing":r.type),o=r&&r.target&&r.target.src;s.message="Loading chunk "+t+" failed.\n("+i+": "+o+")",s.name="ChunkLoadError",s.type=i,s.request=o,a[1](s)}}),"chunk-"+t,t)}};var t=function(t,r){var a,i,o=r[0],s=r[1],u=r[2],c=0;if(o.some((function(t){return 0!==e[t]}))){for(a in s)n.o(s,a)&&(n.m[a]=s[a]);if(u)u(n)}for(t&&t(r);c<o.length;c++)i=o[c],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0},r=self.webpackChunkar_test=self.webpackChunkar_test||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}(),function(){var e=n(791),t=n(250);function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function a(e,t){if(e){if("string"===typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i,o,s=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(l){c=!0,a=l}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw a}}return s}}(e,t)||a(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var o,s,u=n(277),c=n(184);function l(e){return(0,c.jsx)("div",{className:"onboarding"})}function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t){if(t&&("object"===d(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return h(e)}function f(e,t){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},f(e,t)}function m(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&f(e,t)}function v(e){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},v(e)}function g(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(jZ){return!1}}function y(e){var t=g();return function(){var n,r=v(e);if(t){var a=v(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return p(this,n)}}function b(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||a(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=a(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw o}}}}function w(){w=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(N){u=function(e,t,n){return e[t]=n}}function c(e,t,n,a){var i=t&&t.prototype instanceof p?t:p,o=Object.create(i.prototype),s=new E(a||[]);return r(o,"_invoke",{value:S(e,n,s)}),o}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(N){return{type:"throw",arg:N}}}e.wrap=c;var h={};function p(){}function f(){}function m(){}var v={};u(v,i,(function(){return this}));var g=Object.getPrototypeOf,y=g&&g(g(C([])));y&&y!==t&&n.call(y,i)&&(v=y);var b=m.prototype=p.prototype=Object.create(v);function x(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function a(r,i,o,s){var u=l(e[r],e,i);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==d(h)&&n.call(h,"__await")?t.resolve(h.__await).then((function(e){a("next",e,o,s)}),(function(e){a("throw",e,o,s)})):t.resolve(h).then((function(e){c.value=e,o(c)}),(function(e){return a("throw",e,o,s)}))}s(u.arg)}var i;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){a(e,n,t,r)}))}return i=i?i.then(r,r):r()}})}function S(e,t,n){var r="suspendedStart";return function(a,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw i;return M()}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var s=T(o,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=l(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===h)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function T(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=l(r,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,h;var i=a.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function C(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:M}}function M(){return{value:void 0,done:!0}}return f.prototype=m,r(b,"constructor",{value:m,configurable:!0}),r(m,"constructor",{value:f,configurable:!0}),f.displayName=u(m,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,u(e,s,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},x(k.prototype),u(k.prototype,o,(function(){return this})),e.AsyncIterator=k,e.async=function(t,n,r,a,i){void 0===i&&(i=Promise);var o=new k(c(t,n,r,a),i);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},x(b),u(b,s,"Generator"),u(b,i,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=C,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(I),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;I(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),h}},e}function k(e,t,n,r,a,i,o){try{var s=e[i](o),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,a)}function S(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){k(i,r,a,o,s,"next",e)}function s(e){k(i,r,a,o,s,"throw",e)}o(void 0)}))}}function T(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _(e){var t=function(e,t){if("object"!==d(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==d(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===d(t)?t:String(t)}function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_(r.key),r)}}function E(e,t,n){return t&&I(e.prototype,t),n&&I(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function C(e,t,n){return C=g()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return n&&f(a,n.prototype),a},C.apply(null,arguments)}function M(e){var t="function"===typeof Map?new Map:void 0;return M=function(e){if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return C(e,arguments,v(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),f(n,e)},M(e)}function N(){return N="undefined"!==typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=v(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},N.apply(this,arguments)}function R(e,t,n){return(t=_(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var L="152",A=1,P=2,D=3,O=0,z=1,F=2,G=0,W=100,V=0,U=1,X=2,B=0,H=1,Z=2,K=3,j=4,Y=5,Q=301,J=302,q=303,$=304,ee=306,te=1e3,ne=1001,re=1002,ae=1003,ie=1004,oe=1005,se=1006,ue=1007,ce=1008,le=1009,de=1014,he=1015,pe=1016,fe=1020,me=1023,ve=1026,ge=1027,ye=33776,be=33777,xe=33778,we=33779,ke=36492,Se=2300,Te=2301,_e=2302,Ie=2400,Ee=2401,Ce=2402,Me=3001,Ne=0,Re="",Le="srgb",Ae="srgb-linear",Pe="display-p3",De=7680,Oe=35044,ze="300 es",Fe=1035,Ge=function(){function e(){T(this,e)}return E(e,[{key:"addEventListener",value:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}},{key:"hasEventListener",value:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}},{key:"removeEventListener",value:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}}},{key:"dispatchEvent",value:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=t.slice(0),r=0,a=n.length;r<a;r++)n[r].call(this,e);e.target=null}}}}]),e}(),We=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Ve=Math.PI/180,Ue=180/Math.PI;function Xe(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(We[255&e]+We[e>>8&255]+We[e>>16&255]+We[e>>24&255]+"-"+We[255&t]+We[t>>8&255]+"-"+We[t>>16&15|64]+We[t>>24&255]+"-"+We[63&n|128]+We[n>>8&255]+"-"+We[n>>16&255]+We[n>>24&255]+We[255&r]+We[r>>8&255]+We[r>>16&255]+We[r>>24&255]).toLowerCase()}function Be(e,t,n){return Math.max(t,Math.min(n,e))}function He(e,t){return(e%t+t)%t}function Ze(e,t,n){return(1-n)*e+n*t}function Ke(e){return 0===(e&e-1)&&0!==e}function je(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function Ye(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Qe(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}var Je=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;T(this,t),t.prototype.isVector2=!0,this.x=e,this.y=n}return E(t,[{key:"width",get:function(){return this.x},set:function(e){this.x=e}},{key:"height",get:function(){return this.y},set:function(e){this.y=e}},{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function(e){return this.x*e.y-this.y*e.x}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){var e=Math.atan2(-this.y,-this.x)+Math.PI;return e}},{key:"angleTo",value:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var n=this.dot(e)/t;return Math.acos(Be(n,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:"fromBufferAttribute",value:function(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}},{key:"rotateAround",value:function(e,t){var n=Math.cos(t),r=Math.sin(t),a=this.x-e.x,i=this.y-e.y;return this.x=a*n-i*r+e.x,this.y=a*r+i*n+e.y,this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this}},{key:Symbol.iterator,value:w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:case"end":return e.stop()}}),e,this)}))}]),t}(),qe=function(){function e(){T(this,e),e.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}return E(e,[{key:"set",value:function(e,t,n,r,a,i,o,s,u){var c=this.elements;return c[0]=e,c[1]=r,c[2]=o,c[3]=t,c[4]=a,c[5]=s,c[6]=n,c[7]=i,c[8]=u,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}},{key:"setFromMatrix4",value:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,r=t.elements,a=this.elements,i=n[0],o=n[3],s=n[6],u=n[1],c=n[4],l=n[7],d=n[2],h=n[5],p=n[8],f=r[0],m=r[3],v=r[6],g=r[1],y=r[4],b=r[7],x=r[2],w=r[5],k=r[8];return a[0]=i*f+o*g+s*x,a[3]=i*m+o*y+s*w,a[6]=i*v+o*b+s*k,a[1]=u*f+c*g+l*x,a[4]=u*m+c*y+l*w,a[7]=u*v+c*b+l*k,a[2]=d*f+h*g+p*x,a[5]=d*m+h*y+p*w,a[8]=d*v+h*b+p*k,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],o=e[5],s=e[6],u=e[7],c=e[8];return t*i*c-t*o*u-n*a*c+n*o*s+r*a*u-r*i*s}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],o=e[5],s=e[6],u=e[7],c=e[8],l=c*i-o*u,d=o*s-c*a,h=u*a-i*s,p=t*l+n*d+r*h;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);var f=1/p;return e[0]=l*f,e[1]=(r*u-c*n)*f,e[2]=(o*n-r*i)*f,e[3]=d*f,e[4]=(c*t-r*s)*f,e[5]=(r*a-o*t)*f,e[6]=h*f,e[7]=(n*s-u*t)*f,e[8]=(i*t-n*a)*f,this}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}},{key:"getNormalMatrix",value:function(e){return this.setFromMatrix4(e).invert().transpose()}},{key:"transposeIntoArray",value:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},{key:"setUvTransform",value:function(e,t,n,r,a,i,o){var s=Math.cos(a),u=Math.sin(a);return this.set(n*s,n*u,-n*(s*i+u*o)+i+e,-r*u,r*s,-r*(-u*i+s*o)+o+t,0,0,1),this}},{key:"scale",value:function(e,t){return this.premultiply($e.makeScale(e,t)),this}},{key:"rotate",value:function(e){return this.premultiply($e.makeRotation(-e)),this}},{key:"translate",value:function(e,t){return this.premultiply($e.makeTranslation(e,t)),this}},{key:"makeTranslation",value:function(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}},{key:"makeRotation",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}},{key:"makeScale",value:function(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<9;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}}]),e}(),$e=new qe;function et(e){for(var t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;function tt(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}var nt={};function rt(e){e in nt||(nt[e]=!0,console.warn(e))}function at(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function it(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}var ot=(new qe).fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),st=(new qe).fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]);var ut,ct=(R(o={},Ae,(function(e){return e})),R(o,Le,(function(e){return e.convertSRGBToLinear()})),R(o,Pe,(function(e){return e.convertSRGBToLinear().applyMatrix3(st)})),o),lt=(R(s={},Ae,(function(e){return e})),R(s,Le,(function(e){return e.convertLinearToSRGB()})),R(s,Pe,(function(e){return e.applyMatrix3(ot).convertLinearToSRGB()})),s),dt={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(e){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!e},get workingColorSpace(){return Ae},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,n){if(!1===this.enabled||t===n||!t||!n)return e;var r=ct[t],a=lt[n];if(void 0===r||void 0===a)throw new Error('Unsupported color space conversion, "'.concat(t,'" to "').concat(n,'".'));return a(r(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},ht=function(){function e(){T(this,e)}return E(e,null,[{key:"getDataURL",value:function(e){if(/^data:/i.test(e.src))return e.src;if("undefined"===typeof HTMLCanvasElement)return e.src;var t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===ut&&(ut=tt("canvas")),ut.width=e.width,ut.height=e.height;var n=ut.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=ut}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}},{key:"sRGBToLinear",value:function(e){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){var t=tt("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);for(var r=n.getImageData(0,0,e.width,e.height),a=r.data,i=0;i<a.length;i++)a[i]=255*at(a[i]/255);return n.putImageData(r,0,0),t}if(e.data){for(var o=e.data.slice(0),s=0;s<o.length;s++)o instanceof Uint8Array||o instanceof Uint8ClampedArray?o[s]=Math.floor(255*at(o[s]/255)):o[s]=at(o[s]);return{data:o,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}]),e}(),pt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;T(this,e),this.isSource=!0,this.uuid=Xe(),this.data=t,this.version=0}return E(e,[{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];var n={uuid:this.uuid,url:""},r=this.data;if(null!==r){var a;if(Array.isArray(r)){a=[];for(var i=0,o=r.length;i<o;i++)r[i].isDataTexture?a.push(ft(r[i].image)):a.push(ft(r[i]))}else a=ft(r);n.url=a}return t||(e.images[this.uuid]=n),n}}]),e}();function ft(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap?ht.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var mt=0,vt=function(e){m(n,e);var t=y(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.DEFAULT_IMAGE,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.DEFAULT_MAPPING,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ne,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ne,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:se,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:ce,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:me,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:le,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:n.DEFAULT_ANISOTROPY,p=arguments.length>9&&void 0!==arguments[9]?arguments[9]:Re;return T(this,n),(e=t.call(this)).isTexture=!0,Object.defineProperty(h(e),"id",{value:mt++}),e.uuid=Xe(),e.name="",e.source=new pt(r),e.mipmaps=[],e.mapping=a,e.channel=0,e.wrapS=i,e.wrapT=o,e.magFilter=s,e.minFilter=u,e.anisotropy=d,e.format=c,e.internalFormat=null,e.type=l,e.offset=new Je(0,0),e.repeat=new Je(1,1),e.center=new Je(0,0),e.rotation=0,e.matrixAutoUpdate=!0,e.matrix=new qe,e.generateMipmaps=!0,e.premultiplyAlpha=!1,e.flipY=!0,e.unpackAlignment=4,"string"===typeof p?e.colorSpace=p:(rt("THREE.Texture: Property .encoding has been replaced by .colorSpace."),e.colorSpace=p===Me?Le:Re),e.userData={},e.version=0,e.onUpdate=null,e.isRenderTargetTexture=!1,e.needsPMREMUpdate=!1,e}return E(n,[{key:"image",get:function(){return this.source.data},set:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.source.data=e}},{key:"updateMatrix",value:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"transformUv",value:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case te:e.x=e.x-Math.floor(e.x);break;case ne:e.x=e.x<0?0:1;break;case re:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case te:e.y=e.y-Math.floor(e.y);break;case ne:e.y=e.y<0?0:1;break;case re:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}},{key:"needsUpdate",set:function(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}},{key:"encoding",get:function(){return rt("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===Le?Me:3e3},set:function(e){rt("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===Me?Le:Re}}]),n}(Ge);vt.DEFAULT_IMAGE=null,vt.DEFAULT_MAPPING=300,vt.DEFAULT_ANISOTROPY=1;var gt=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;T(this,t),t.prototype.isVector4=!0,this.x=e,this.y=n,this.z=r,this.w=a}return E(t,[{key:"width",get:function(){return this.z},set:function(e){this.z=e}},{key:"height",get:function(){return this.w},set:function(e){this.w=e}},{key:"set",value:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setW",value:function(e){return this.w=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,r=this.z,a=this.w,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r+i[12]*a,this.y=i[1]*t+i[5]*n+i[9]*r+i[13]*a,this.z=i[2]*t+i[6]*n+i[10]*r+i[14]*a,this.w=i[3]*t+i[7]*n+i[11]*r+i[15]*a,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"setAxisAngleFromQuaternion",value:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:"setAxisAngleFromRotationMatrix",value:function(e){var t,n,r,a,i=.01,o=.1,s=e.elements,u=s[0],c=s[4],l=s[8],d=s[1],h=s[5],p=s[9],f=s[2],m=s[6],v=s[10];if(Math.abs(c-d)<i&&Math.abs(l-f)<i&&Math.abs(p-m)<i){if(Math.abs(c+d)<o&&Math.abs(l+f)<o&&Math.abs(p+m)<o&&Math.abs(u+h+v-3)<o)return this.set(1,0,0,0),this;t=Math.PI;var g=(u+1)/2,y=(h+1)/2,b=(v+1)/2,x=(c+d)/4,w=(l+f)/4,k=(p+m)/4;return g>y&&g>b?g<i?(n=0,r=.707106781,a=.707106781):(r=x/(n=Math.sqrt(g)),a=w/n):y>b?y<i?(n=.707106781,r=0,a=.707106781):(n=x/(r=Math.sqrt(y)),a=k/r):b<i?(n=.707106781,r=.707106781,a=0):(n=w/(a=Math.sqrt(b)),r=k/a),this.set(n,r,a,t),this}var S=Math.sqrt((m-p)*(m-p)+(l-f)*(l-f)+(d-c)*(d-c));return Math.abs(S)<.001&&(S=1),this.x=(m-p)/S,this.y=(l-f)/S,this.z=(d-c)/S,this.w=Math.acos((u+h+v-1)/2),this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:"fromBufferAttribute",value:function(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}},{key:Symbol.iterator,value:w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:return e.next=6,this.z;case 6:return e.next=8,this.w;case 8:case"end":return e.stop()}}),e,this)}))}]),t}(),yt=function(e){m(n,e);var t=y(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};T(this,n),(e=t.call(this)).isWebGLRenderTarget=!0,e.width=r,e.height=a,e.depth=1,e.scissor=new gt(0,0,r,a),e.scissorTest=!1,e.viewport=new gt(0,0,r,a);var o={width:r,height:a,depth:1};return void 0!==i.encoding&&(rt("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),i.colorSpace=i.encoding===Me?Le:Re),e.texture=new vt(o,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),e.texture.isRenderTargetTexture=!0,e.texture.flipY=!1,e.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,e.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,e.texture.minFilter=void 0!==i.minFilter?i.minFilter:se,e.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,e.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,e.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,e.samples=void 0!==i.samples?i.samples:0,e}return E(n,[{key:"setSize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;var t=Object.assign({},e.texture.image);return this.texture.source=new pt(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(Ge),bt=function(e){m(n,e);var t=y(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return T(this,n),(e=t.call(this,null)).isDataArrayTexture=!0,e.image={data:r,width:a,height:i,depth:o},e.magFilter=ae,e.minFilter=ae,e.wrapR=ne,e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e}return E(n)}(vt),xt=function(e){m(n,e);var t=y(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return T(this,n),(e=t.call(this,null)).isData3DTexture=!0,e.image={data:r,width:a,height:i,depth:o},e.magFilter=ae,e.minFilter=ae,e.wrapR=ne,e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e}return E(n)}(vt),wt=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;T(this,t),this.isQuaternion=!0,this._x=e,this._y=n,this._z=r,this._w=a}return E(t,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}},{key:"setFromEuler",value:function(e,t){var n=e._x,r=e._y,a=e._z,i=e._order,o=Math.cos,s=Math.sin,u=o(n/2),c=o(r/2),l=o(a/2),d=s(n/2),h=s(r/2),p=s(a/2);switch(i){case"XYZ":this._x=d*c*l+u*h*p,this._y=u*h*l-d*c*p,this._z=u*c*p+d*h*l,this._w=u*c*l-d*h*p;break;case"YXZ":this._x=d*c*l+u*h*p,this._y=u*h*l-d*c*p,this._z=u*c*p-d*h*l,this._w=u*c*l+d*h*p;break;case"ZXY":this._x=d*c*l-u*h*p,this._y=u*h*l+d*c*p,this._z=u*c*p+d*h*l,this._w=u*c*l-d*h*p;break;case"ZYX":this._x=d*c*l-u*h*p,this._y=u*h*l+d*c*p,this._z=u*c*p-d*h*l,this._w=u*c*l+d*h*p;break;case"YZX":this._x=d*c*l+u*h*p,this._y=u*h*l+d*c*p,this._z=u*c*p-d*h*l,this._w=u*c*l-d*h*p;break;case"XZY":this._x=d*c*l-u*h*p,this._y=u*h*l-d*c*p,this._z=u*c*p+d*h*l,this._w=u*c*l+d*h*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+i)}return!1!==t&&this._onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=e.elements,n=t[0],r=t[4],a=t[8],i=t[1],o=t[5],s=t[9],u=t[2],c=t[6],l=t[10],d=n+o+l;if(d>0){var h=.5/Math.sqrt(d+1);this._w=.25/h,this._x=(c-s)*h,this._y=(a-u)*h,this._z=(i-r)*h}else if(n>o&&n>l){var p=2*Math.sqrt(1+n-o-l);this._w=(c-s)/p,this._x=.25*p,this._y=(r+i)/p,this._z=(a+u)/p}else if(o>l){var f=2*Math.sqrt(1+o-n-l);this._w=(a-u)/f,this._x=(r+i)/f,this._y=.25*f,this._z=(s+c)/f}else{var m=2*Math.sqrt(1+l-n-o);this._w=(i-r)/m,this._x=(a+u)/m,this._y=(s+c)/m,this._z=.25*m}return this._onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}},{key:"angleTo",value:function(e){return 2*Math.acos(Math.abs(Be(this.dot(e),-1,1)))}},{key:"rotateTowards",value:function(e,t){var n=this.angleTo(e);if(0===n)return this;var r=Math.min(1,t/n);return this.slerp(e,r),this}},{key:"identity",value:function(){return this.set(0,0,0,1)}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}},{key:"multiply",value:function(e){return this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var n=e._x,r=e._y,a=e._z,i=e._w,o=t._x,s=t._y,u=t._z,c=t._w;return this._x=n*c+i*o+r*u-a*s,this._y=r*c+i*s+a*o-n*u,this._z=a*c+i*u+n*s-r*o,this._w=i*c-n*o-r*s-a*u,this._onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,r=this._y,a=this._z,i=this._w,o=i*e._w+n*e._x+r*e._y+a*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=i,this._x=n,this._y=r,this._z=a,this;var s=1-o*o;if(s<=Number.EPSILON){var u=1-t;return this._w=u*i+t*this._w,this._x=u*n+t*this._x,this._y=u*r+t*this._y,this._z=u*a+t*this._z,this.normalize(),this._onChangeCallback(),this}var c=Math.sqrt(s),l=Math.atan2(c,o),d=Math.sin((1-t)*l)/c,h=Math.sin(t*l)/c;return this._w=i*d+this._w*h,this._x=n*d+this._x*h,this._y=r*d+this._y*h,this._z=a*d+this._z*h,this._onChangeCallback(),this}},{key:"slerpQuaternions",value:function(e,t,n){return this.copy(e).slerp(t,n)}},{key:"random",value:function(){var e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),r=2*Math.PI*Math.random(),a=2*Math.PI*Math.random();return this.set(t*Math.cos(r),n*Math.sin(a),n*Math.cos(a),t*Math.sin(r))}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"fromBufferAttribute",value:function(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}},{key:"toJSON",value:function(){return this.toArray()}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}},{key:Symbol.iterator,value:w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._x;case 2:return e.next=4,this._y;case 4:return e.next=6,this._z;case 6:return e.next=8,this._w;case 8:case"end":return e.stop()}}),e,this)}))}],[{key:"slerpFlat",value:function(e,t,n,r,a,i,o){var s=n[r+0],u=n[r+1],c=n[r+2],l=n[r+3],d=a[i+0],h=a[i+1],p=a[i+2],f=a[i+3];if(0===o)return e[t+0]=s,e[t+1]=u,e[t+2]=c,void(e[t+3]=l);if(1===o)return e[t+0]=d,e[t+1]=h,e[t+2]=p,void(e[t+3]=f);if(l!==f||s!==d||u!==h||c!==p){var m=1-o,v=s*d+u*h+c*p+l*f,g=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){var b=Math.sqrt(y),x=Math.atan2(b,v*g);m=Math.sin(m*x)/b,o=Math.sin(o*x)/b}var w=o*g;if(s=s*m+d*w,u=u*m+h*w,c=c*m+p*w,l=l*m+f*w,m===1-o){var k=1/Math.sqrt(s*s+u*u+c*c+l*l);s*=k,u*=k,c*=k,l*=k}}e[t]=s,e[t+1]=u,e[t+2]=c,e[t+3]=l}},{key:"multiplyQuaternionsFlat",value:function(e,t,n,r,a,i){var o=n[r],s=n[r+1],u=n[r+2],c=n[r+3],l=a[i],d=a[i+1],h=a[i+2],p=a[i+3];return e[t]=o*p+c*l+s*h-u*d,e[t+1]=s*p+c*d+u*l-o*h,e[t+2]=u*p+c*h+o*d-s*l,e[t+3]=c*p-o*l-s*d-u*h,e}}]),t}(),kt=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;T(this,t),t.prototype.isVector3=!0,this.x=e,this.y=n,this.z=r}return E(t,[{key:"set",value:function(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyEuler",value:function(e){return this.applyQuaternion(Tt.setFromEuler(e))}},{key:"applyAxisAngle",value:function(e,t){return this.applyQuaternion(Tt.setFromAxisAngle(e,t))}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,r=this.z,a=e.elements;return this.x=a[0]*t+a[3]*n+a[6]*r,this.y=a[1]*t+a[4]*n+a[7]*r,this.z=a[2]*t+a[5]*n+a[8]*r,this}},{key:"applyNormalMatrix",value:function(e){return this.applyMatrix3(e).normalize()}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,r=this.z,a=e.elements,i=1/(a[3]*t+a[7]*n+a[11]*r+a[15]);return this.x=(a[0]*t+a[4]*n+a[8]*r+a[12])*i,this.y=(a[1]*t+a[5]*n+a[9]*r+a[13])*i,this.z=(a[2]*t+a[6]*n+a[10]*r+a[14])*i,this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,r=this.z,a=e.x,i=e.y,o=e.z,s=e.w,u=s*t+i*r-o*n,c=s*n+o*t-a*r,l=s*r+a*n-i*t,d=-a*t-i*n-o*r;return this.x=u*s+d*-a+c*-o-l*-i,this.y=c*s+d*-i+l*-a-u*-o,this.z=l*s+d*-o+u*-i-c*-a,this}},{key:"project",value:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}},{key:"unproject",value:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}},{key:"transformDirection",value:function(e){var t=this.x,n=this.y,r=this.z,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*r,this.y=a[1]*t+a[5]*n+a[9]*r,this.z=a[2]*t+a[6]*n+a[10]*r,this.normalize()}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}},{key:"cross",value:function(e){return this.crossVectors(this,e)}},{key:"crossVectors",value:function(e,t){var n=e.x,r=e.y,a=e.z,i=t.x,o=t.y,s=t.z;return this.x=r*s-a*o,this.y=a*i-n*s,this.z=n*o-r*i,this}},{key:"projectOnVector",value:function(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);var n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}},{key:"projectOnPlane",value:function(e){return St.copy(this).projectOnVector(e),this.sub(St)}},{key:"reflect",value:function(e){return this.sub(St.copy(e).multiplyScalar(2*this.dot(e)))}},{key:"angleTo",value:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var n=this.dot(e)/t;return Math.acos(Be(n,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:"setFromSphericalCoords",value:function(e,t,n){var r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}},{key:"setFromCylindrical",value:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:"setFromCylindricalCoords",value:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"setFromMatrix3Column",value:function(e,t){return this.fromArray(e.elements,3*t)}},{key:"setFromEuler",value:function(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}},{key:"setFromColor",value:function(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"fromBufferAttribute",value:function(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}},{key:"randomDirection",value:function(){var e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-Math.pow(e,2));return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}},{key:Symbol.iterator,value:w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:return e.next=6,this.z;case 6:case"end":return e.stop()}}),e,this)}))}]),t}(),St=new kt,Tt=new wt,_t=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new kt(1/0,1/0,1/0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new kt(-1/0,-1/0,-1/0);T(this,e),this.isBox3=!0,this.min=t,this.max=n}return E(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromArray",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t+=3)this.expandByPoint(Et.fromArray(e,t));return this}},{key:"setFromBufferAttribute",value:function(e){this.makeEmpty();for(var t=0,n=e.count;t<n;t++)this.expandByPoint(Et.fromBufferAttribute(e,t));return this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=Et.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"setFromObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(e,t)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"expandByObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.updateWorldMatrix(!1,!1),void 0!==e.boundingBox)null===e.boundingBox&&e.computeBoundingBox(),Ct.copy(e.boundingBox),Ct.applyMatrix4(e.matrixWorld),this.union(Ct);else{var n=e.geometry;if(void 0!==n)if(t&&void 0!==n.attributes&&void 0!==n.attributes.position)for(var r=n.attributes.position,a=0,i=r.count;a<i;a++)Et.fromBufferAttribute(r,a).applyMatrix4(e.matrixWorld),this.expandByPoint(Et);else null===n.boundingBox&&n.computeBoundingBox(),Ct.copy(n.boundingBox),Ct.applyMatrix4(e.matrixWorld),this.union(Ct)}for(var o=e.children,s=0,u=o.length;s<u;s++)this.expandByObject(o[s],t);return this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}},{key:"getParameter",value:function(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}},{key:"intersectsSphere",value:function(e){return this.clampPoint(e.center,Et),Et.distanceToSquared(e.center)<=e.radius*e.radius}},{key:"intersectsPlane",value:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}},{key:"intersectsTriangle",value:function(e){if(this.isEmpty())return!1;this.getCenter(Dt),Ot.subVectors(this.max,Dt),Mt.subVectors(e.a,Dt),Nt.subVectors(e.b,Dt),Rt.subVectors(e.c,Dt),Lt.subVectors(Nt,Mt),At.subVectors(Rt,Nt),Pt.subVectors(Mt,Rt);var t=[0,-Lt.z,Lt.y,0,-At.z,At.y,0,-Pt.z,Pt.y,Lt.z,0,-Lt.x,At.z,0,-At.x,Pt.z,0,-Pt.x,-Lt.y,Lt.x,0,-At.y,At.x,0,-Pt.y,Pt.x,0];return!!Gt(t,Mt,Nt,Rt,Ot)&&(!!Gt(t=[1,0,0,0,1,0,0,0,1],Mt,Nt,Rt,Ot)&&(zt.crossVectors(Lt,At),Gt(t=[zt.x,zt.y,zt.z],Mt,Nt,Rt,Ot)))}},{key:"clampPoint",value:function(e,t){return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return this.clampPoint(e,Et).distanceTo(e)}},{key:"getBoundingSphere",value:function(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(Et).length()),e}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"applyMatrix4",value:function(e){return this.isEmpty()||(It[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),It[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),It[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),It[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),It[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),It[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),It[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),It[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(It)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),It=[new kt,new kt,new kt,new kt,new kt,new kt,new kt,new kt],Et=new kt,Ct=new _t,Mt=new kt,Nt=new kt,Rt=new kt,Lt=new kt,At=new kt,Pt=new kt,Dt=new kt,Ot=new kt,zt=new kt,Ft=new kt;function Gt(e,t,n,r,a){for(var i=0,o=e.length-3;i<=o;i+=3){Ft.fromArray(e,i);var s=a.x*Math.abs(Ft.x)+a.y*Math.abs(Ft.y)+a.z*Math.abs(Ft.z),u=t.dot(Ft),c=n.dot(Ft),l=r.dot(Ft);if(Math.max(-Math.max(u,c,l),Math.min(u,c,l))>s)return!1}return!0}var Wt=new _t,Vt=new kt,Ut=new kt,Xt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new kt,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;T(this,e),this.center=t,this.radius=n}return E(e,[{key:"set",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:"setFromPoints",value:function(e,t){var n=this.center;void 0!==t?n.copy(t):Wt.setFromPoints(e).getCenter(n);for(var r=0,a=0,i=e.length;a<i;a++)r=Math.max(r,n.distanceToSquared(e[a]));return this.radius=Math.sqrt(r),this}},{key:"copy",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:"isEmpty",value:function(){return this.radius<0}},{key:"makeEmpty",value:function(){return this.center.set(0,0,0),this.radius=-1,this}},{key:"containsPoint",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"distanceToPoint",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:"intersectsSphere",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:"intersectsBox",value:function(e){return e.intersectsSphere(this)}},{key:"intersectsPlane",value:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}},{key:"clampPoint",value:function(e,t){var n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:"getBoundingBox",value:function(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}},{key:"applyMatrix4",value:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}},{key:"translate",value:function(e){return this.center.add(e),this}},{key:"expandByPoint",value:function(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Vt.subVectors(e,this.center);var t=Vt.lengthSq();if(t>this.radius*this.radius){var n=Math.sqrt(t),r=.5*(n-this.radius);this.center.addScaledVector(Vt,r/n),this.radius+=r}return this}},{key:"union",value:function(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(Ut.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Vt.copy(e.center).add(Ut)),this.expandByPoint(Vt.copy(e.center).sub(Ut))),this)}},{key:"equals",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),Bt=new kt,Ht=new kt,Zt=new kt,Kt=new kt,jt=new kt,Yt=new kt,Qt=new kt,Jt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new kt,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new kt(0,0,-1);T(this,e),this.origin=t,this.direction=n}return E(e,[{key:"set",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:"copy",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:"at",value:function(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}},{key:"lookAt",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:"recast",value:function(e){return this.origin.copy(this.at(e,Bt)),this}},{key:"closestPointToPoint",value:function(e,t){t.subVectors(e,this.origin);var n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}},{key:"distanceToPoint",value:function(e){return Math.sqrt(this.distanceSqToPoint(e))}},{key:"distanceSqToPoint",value:function(e){var t=Bt.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Bt.copy(this.origin).addScaledVector(this.direction,t),Bt.distanceToSquared(e))}},{key:"distanceSqToSegment",value:function(e,t,n,r){Ht.copy(e).add(t).multiplyScalar(.5),Zt.copy(t).sub(e).normalize(),Kt.copy(this.origin).sub(Ht);var a,i,o,s,u=.5*e.distanceTo(t),c=-this.direction.dot(Zt),l=Kt.dot(this.direction),d=-Kt.dot(Zt),h=Kt.lengthSq(),p=Math.abs(1-c*c);if(p>0)if(i=c*l-d,s=u*p,(a=c*d-l)>=0)if(i>=-s)if(i<=s){var f=1/p;o=(a*=f)*(a+c*(i*=f)+2*l)+i*(c*a+i+2*d)+h}else i=u,o=-(a=Math.max(0,-(c*i+l)))*a+i*(i+2*d)+h;else i=-u,o=-(a=Math.max(0,-(c*i+l)))*a+i*(i+2*d)+h;else i<=-s?o=-(a=Math.max(0,-(-c*u+l)))*a+(i=a>0?-u:Math.min(Math.max(-u,-d),u))*(i+2*d)+h:i<=s?(a=0,o=(i=Math.min(Math.max(-u,-d),u))*(i+2*d)+h):o=-(a=Math.max(0,-(c*u+l)))*a+(i=a>0?u:Math.min(Math.max(-u,-d),u))*(i+2*d)+h;else i=c>0?-u:u,o=-(a=Math.max(0,-(c*i+l)))*a+i*(i+2*d)+h;return n&&n.copy(this.origin).addScaledVector(this.direction,a),r&&r.copy(Ht).addScaledVector(Zt,i),o}},{key:"intersectSphere",value:function(e,t){Bt.subVectors(e.center,this.origin);var n=Bt.dot(this.direction),r=Bt.dot(Bt)-n*n,a=e.radius*e.radius;if(r>a)return null;var i=Math.sqrt(a-r),o=n-i,s=n+i;return s<0?null:o<0?this.at(s,t):this.at(o,t)}},{key:"intersectsSphere",value:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:"distanceToPlane",value:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}},{key:"intersectPlane",value:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}},{key:"intersectsPlane",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}},{key:"intersectBox",value:function(e,t){var n,r,a,i,o,s,u=1/this.direction.x,c=1/this.direction.y,l=1/this.direction.z,d=this.origin;return u>=0?(n=(e.min.x-d.x)*u,r=(e.max.x-d.x)*u):(n=(e.max.x-d.x)*u,r=(e.min.x-d.x)*u),c>=0?(a=(e.min.y-d.y)*c,i=(e.max.y-d.y)*c):(a=(e.max.y-d.y)*c,i=(e.min.y-d.y)*c),n>i||a>r?null:((a>n||isNaN(n))&&(n=a),(i<r||isNaN(r))&&(r=i),l>=0?(o=(e.min.z-d.z)*l,s=(e.max.z-d.z)*l):(o=(e.max.z-d.z)*l,s=(e.min.z-d.z)*l),n>s||o>r?null:((o>n||n!==n)&&(n=o),(s<r||r!==r)&&(r=s),r<0?null:this.at(n>=0?n:r,t)))}},{key:"intersectsBox",value:function(e){return null!==this.intersectBox(e,Bt)}},{key:"intersectTriangle",value:function(e,t,n,r,a){jt.subVectors(t,e),Yt.subVectors(n,e),Qt.crossVectors(jt,Yt);var i,o=this.direction.dot(Qt);if(o>0){if(r)return null;i=1}else{if(!(o<0))return null;i=-1,o=-o}Kt.subVectors(this.origin,e);var s=i*this.direction.dot(Yt.crossVectors(Kt,Yt));if(s<0)return null;var u=i*this.direction.dot(jt.cross(Kt));if(u<0)return null;if(s+u>o)return null;var c=-i*Kt.dot(Qt);return c<0?null:this.at(c/o,a)}},{key:"applyMatrix4",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:"equals",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),qt=function(){function e(){T(this,e),e.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}return E(e,[{key:"set",value:function(e,t,n,r,a,i,o,s,u,c,l,d,h,p,f,m){var v=this.elements;return v[0]=e,v[4]=t,v[8]=n,v[12]=r,v[1]=a,v[5]=i,v[9]=o,v[13]=s,v[2]=u,v[6]=c,v[10]=l,v[14]=d,v[3]=h,v[7]=p,v[11]=f,v[15]=m,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"clone",value:function(){return(new e).fromArray(this.elements)}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}},{key:"copyPosition",value:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}},{key:"setFromMatrix3",value:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(e){var t=this.elements,n=e.elements,r=1/$t.setFromMatrixColumn(e,0).length(),a=1/$t.setFromMatrixColumn(e,1).length(),i=1/$t.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=0,t[8]=n[8]*i,t[9]=n[9]*i,t[10]=n[10]*i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromEuler",value:function(e){var t=this.elements,n=e.x,r=e.y,a=e.z,i=Math.cos(n),o=Math.sin(n),s=Math.cos(r),u=Math.sin(r),c=Math.cos(a),l=Math.sin(a);if("XYZ"===e.order){var d=i*c,h=i*l,p=o*c,f=o*l;t[0]=s*c,t[4]=-s*l,t[8]=u,t[1]=h+p*u,t[5]=d-f*u,t[9]=-o*s,t[2]=f-d*u,t[6]=p+h*u,t[10]=i*s}else if("YXZ"===e.order){var m=s*c,v=s*l,g=u*c,y=u*l;t[0]=m+y*o,t[4]=g*o-v,t[8]=i*u,t[1]=i*l,t[5]=i*c,t[9]=-o,t[2]=v*o-g,t[6]=y+m*o,t[10]=i*s}else if("ZXY"===e.order){var b=s*c,x=s*l,w=u*c,k=u*l;t[0]=b-k*o,t[4]=-i*l,t[8]=w+x*o,t[1]=x+w*o,t[5]=i*c,t[9]=k-b*o,t[2]=-i*u,t[6]=o,t[10]=i*s}else if("ZYX"===e.order){var S=i*c,T=i*l,_=o*c,I=o*l;t[0]=s*c,t[4]=_*u-T,t[8]=S*u+I,t[1]=s*l,t[5]=I*u+S,t[9]=T*u-_,t[2]=-u,t[6]=o*s,t[10]=i*s}else if("YZX"===e.order){var E=i*s,C=i*u,M=o*s,N=o*u;t[0]=s*c,t[4]=N-E*l,t[8]=M*l+C,t[1]=l,t[5]=i*c,t[9]=-o*c,t[2]=-u*c,t[6]=C*l+M,t[10]=E-N*l}else if("XZY"===e.order){var R=i*s,L=i*u,A=o*s,P=o*u;t[0]=s*c,t[4]=-l,t[8]=u*c,t[1]=R*l+P,t[5]=i*c,t[9]=L*l-A,t[2]=A*l-L,t[6]=o*c,t[10]=P*l+R}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(e){return this.compose(tn,e,nn)}},{key:"lookAt",value:function(e,t,n){var r=this.elements;return on.subVectors(e,t),0===on.lengthSq()&&(on.z=1),on.normalize(),rn.crossVectors(n,on),0===rn.lengthSq()&&(1===Math.abs(n.z)?on.x+=1e-4:on.z+=1e-4,on.normalize(),rn.crossVectors(n,on)),rn.normalize(),an.crossVectors(on,rn),r[0]=rn.x,r[4]=an.x,r[8]=on.x,r[1]=rn.y,r[5]=an.y,r[9]=on.y,r[2]=rn.z,r[6]=an.z,r[10]=on.z,this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,r=t.elements,a=this.elements,i=n[0],o=n[4],s=n[8],u=n[12],c=n[1],l=n[5],d=n[9],h=n[13],p=n[2],f=n[6],m=n[10],v=n[14],g=n[3],y=n[7],b=n[11],x=n[15],w=r[0],k=r[4],S=r[8],T=r[12],_=r[1],I=r[5],E=r[9],C=r[13],M=r[2],N=r[6],R=r[10],L=r[14],A=r[3],P=r[7],D=r[11],O=r[15];return a[0]=i*w+o*_+s*M+u*A,a[4]=i*k+o*I+s*N+u*P,a[8]=i*S+o*E+s*R+u*D,a[12]=i*T+o*C+s*L+u*O,a[1]=c*w+l*_+d*M+h*A,a[5]=c*k+l*I+d*N+h*P,a[9]=c*S+l*E+d*R+h*D,a[13]=c*T+l*C+d*L+h*O,a[2]=p*w+f*_+m*M+v*A,a[6]=p*k+f*I+m*N+v*P,a[10]=p*S+f*E+m*R+v*D,a[14]=p*T+f*C+m*L+v*O,a[3]=g*w+y*_+b*M+x*A,a[7]=g*k+y*I+b*N+x*P,a[11]=g*S+y*E+b*R+x*D,a[15]=g*T+y*C+b*L+x*O,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],a=e[12],i=e[1],o=e[5],s=e[9],u=e[13],c=e[2],l=e[6],d=e[10],h=e[14];return e[3]*(+a*s*l-r*u*l-a*o*d+n*u*d+r*o*h-n*s*h)+e[7]*(+t*s*h-t*u*d+a*i*d-r*i*h+r*u*c-a*s*c)+e[11]*(+t*u*l-t*o*h-a*i*l+n*i*h+a*o*c-n*u*c)+e[15]*(-r*o*c-t*s*l+t*o*d+r*i*l-n*i*d+n*s*c)}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}},{key:"setPosition",value:function(e,t,n){var r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],o=e[5],s=e[6],u=e[7],c=e[8],l=e[9],d=e[10],h=e[11],p=e[12],f=e[13],m=e[14],v=e[15],g=l*m*u-f*d*u+f*s*h-o*m*h-l*s*v+o*d*v,y=p*d*u-c*m*u-p*s*h+i*m*h+c*s*v-i*d*v,b=c*f*u-p*l*u+p*o*h-i*f*h-c*o*v+i*l*v,x=p*l*s-c*f*s-p*o*d+i*f*d+c*o*m-i*l*m,w=t*g+n*y+r*b+a*x;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var k=1/w;return e[0]=g*k,e[1]=(f*d*a-l*m*a-f*r*h+n*m*h+l*r*v-n*d*v)*k,e[2]=(o*m*a-f*s*a+f*r*u-n*m*u-o*r*v+n*s*v)*k,e[3]=(l*s*a-o*d*a-l*r*u+n*d*u+o*r*h-n*s*h)*k,e[4]=y*k,e[5]=(c*m*a-p*d*a+p*r*h-t*m*h-c*r*v+t*d*v)*k,e[6]=(p*s*a-i*m*a-p*r*u+t*m*u+i*r*v-t*s*v)*k,e[7]=(i*d*a-c*s*a+c*r*u-t*d*u-i*r*h+t*s*h)*k,e[8]=b*k,e[9]=(p*l*a-c*f*a-p*n*h+t*f*h+c*n*v-t*l*v)*k,e[10]=(i*f*a-p*o*a+p*n*u-t*f*u-i*n*v+t*o*v)*k,e[11]=(c*o*a-i*l*a-c*n*u+t*l*u+i*n*h-t*o*h)*k,e[12]=x*k,e[13]=(c*f*r-p*l*r+p*n*d-t*f*d-c*n*m+t*l*m)*k,e[14]=(p*o*r-i*f*r-p*n*s+t*f*s+i*n*m-t*o*m)*k,e[15]=(i*l*r-c*o*r+c*n*s-t*l*s-i*n*d+t*o*d)*k,this}},{key:"scale",value:function(e){var t=this.elements,n=e.x,r=e.y,a=e.z;return t[0]*=n,t[4]*=r,t[8]*=a,t[1]*=n,t[5]*=r,t[9]*=a,t[2]*=n,t[6]*=r,t[10]*=a,t[3]*=n,t[7]*=r,t[11]*=a,this}},{key:"getMaxScaleOnAxis",value:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}},{key:"makeTranslation",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:"makeRotationX",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}},{key:"makeRotationY",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(e,t){var n=Math.cos(t),r=Math.sin(t),a=1-n,i=e.x,o=e.y,s=e.z,u=a*i,c=a*o;return this.set(u*i+n,u*o-r*s,u*s+r*o,0,u*o+r*s,c*o+n,c*s-r*i,0,u*s-r*o,c*s+r*i,a*s*s+n,0,0,0,0,1),this}},{key:"makeScale",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}},{key:"makeShear",value:function(e,t,n,r,a,i){return this.set(1,n,a,0,e,1,i,0,t,r,1,0,0,0,0,1),this}},{key:"compose",value:function(e,t,n){var r=this.elements,a=t._x,i=t._y,o=t._z,s=t._w,u=a+a,c=i+i,l=o+o,d=a*u,h=a*c,p=a*l,f=i*c,m=i*l,v=o*l,g=s*u,y=s*c,b=s*l,x=n.x,w=n.y,k=n.z;return r[0]=(1-(f+v))*x,r[1]=(h+b)*x,r[2]=(p-y)*x,r[3]=0,r[4]=(h-b)*w,r[5]=(1-(d+v))*w,r[6]=(m+g)*w,r[7]=0,r[8]=(p+y)*k,r[9]=(m-g)*k,r[10]=(1-(d+f))*k,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}},{key:"decompose",value:function(e,t,n){var r=this.elements,a=$t.set(r[0],r[1],r[2]).length(),i=$t.set(r[4],r[5],r[6]).length(),o=$t.set(r[8],r[9],r[10]).length();this.determinant()<0&&(a=-a),e.x=r[12],e.y=r[13],e.z=r[14],en.copy(this);var s=1/a,u=1/i,c=1/o;return en.elements[0]*=s,en.elements[1]*=s,en.elements[2]*=s,en.elements[4]*=u,en.elements[5]*=u,en.elements[6]*=u,en.elements[8]*=c,en.elements[9]*=c,en.elements[10]*=c,t.setFromRotationMatrix(en),n.x=a,n.y=i,n.z=o,this}},{key:"makePerspective",value:function(e,t,n,r,a,i){var o=this.elements,s=2*a/(t-e),u=2*a/(n-r),c=(t+e)/(t-e),l=(n+r)/(n-r),d=-(i+a)/(i-a),h=-2*i*a/(i-a);return o[0]=s,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=u,o[9]=l,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=h,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}},{key:"makeOrthographic",value:function(e,t,n,r,a,i){var o=this.elements,s=1/(t-e),u=1/(n-r),c=1/(i-a),l=(t+e)*s,d=(n+r)*u,h=(i+a)*c;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-l,o[1]=0,o[5]=2*u,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-h,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<16;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}]),e}(),$t=new kt,en=new qt,tn=new kt(0,0,0),nn=new kt(1,1,1),rn=new kt,an=new kt,on=new kt,sn=new qt,un=new wt,cn=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.DEFAULT_ORDER;T(this,t),this.isEuler=!0,this._x=e,this._y=n,this._z=r,this._order=a}return E(t,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"order",get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._order)}},{key:"copy",value:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=e.elements,a=r[0],i=r[4],o=r[8],s=r[1],u=r[5],c=r[9],l=r[2],d=r[6],h=r[10];switch(t){case"XYZ":this._y=Math.asin(Be(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,h),this._z=Math.atan2(-i,a)):(this._x=Math.atan2(d,u),this._z=0);break;case"YXZ":this._x=Math.asin(-Be(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,h),this._z=Math.atan2(s,u)):(this._y=Math.atan2(-l,a),this._z=0);break;case"ZXY":this._x=Math.asin(Be(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-l,h),this._z=Math.atan2(-i,u)):(this._y=0,this._z=Math.atan2(s,a));break;case"ZYX":this._y=Math.asin(-Be(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(d,h),this._z=Math.atan2(s,a)):(this._x=0,this._z=Math.atan2(-i,u));break;case"YZX":this._z=Math.asin(Be(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-l,a)):(this._x=0,this._y=Math.atan2(o,h));break;case"XZY":this._z=Math.asin(-Be(i,-1,1)),Math.abs(i)<.9999999?(this._x=Math.atan2(d,u),this._y=Math.atan2(o,a)):(this._x=Math.atan2(-c,h),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}},{key:"setFromQuaternion",value:function(e,t,n){return sn.makeRotationFromQuaternion(e),this.setFromRotationMatrix(sn,t,n)}},{key:"setFromVector3",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}},{key:"reorder",value:function(e){return un.setFromEuler(this),this.setFromQuaternion(un,e)}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}},{key:"fromArray",value:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}},{key:Symbol.iterator,value:w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._x;case 2:return e.next=4,this._y;case 4:return e.next=6,this._z;case 6:return e.next=8,this._order;case 8:case"end":return e.stop()}}),e,this)}))}]),t}();cn.DEFAULT_ORDER="XYZ";var ln=function(){function e(){T(this,e),this.mask=1}return E(e,[{key:"set",value:function(e){this.mask=(1<<e|0)>>>0}},{key:"enable",value:function(e){this.mask|=1<<e|0}},{key:"enableAll",value:function(){this.mask=-1}},{key:"toggle",value:function(e){this.mask^=1<<e|0}},{key:"disable",value:function(e){this.mask&=~(1<<e|0)}},{key:"disableAll",value:function(){this.mask=0}},{key:"test",value:function(e){return 0!==(this.mask&e.mask)}},{key:"isEnabled",value:function(e){return 0!==(this.mask&(1<<e|0))}}]),e}(),dn=0,hn=new kt,pn=new wt,fn=new qt,mn=new kt,vn=new kt,gn=new kt,yn=new wt,bn=new kt(1,0,0),xn=new kt(0,1,0),wn=new kt(0,0,1),kn={type:"added"},Sn={type:"removed"},Tn=function(e){m(n,e);var t=y(n);function n(){var e;T(this,n),(e=t.call(this)).isObject3D=!0,Object.defineProperty(h(e),"id",{value:dn++}),e.uuid=Xe(),e.name="",e.type="Object3D",e.parent=null,e.children=[],e.up=n.DEFAULT_UP.clone();var r=new kt,a=new cn,i=new wt,o=new kt(1,1,1);return a._onChange((function(){i.setFromEuler(a,!1)})),i._onChange((function(){a.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(h(e),{position:{configurable:!0,enumerable:!0,value:r},rotation:{configurable:!0,enumerable:!0,value:a},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new qt},normalMatrix:{value:new qe}}),e.matrix=new qt,e.matrixWorld=new qt,e.matrixAutoUpdate=n.DEFAULT_MATRIX_AUTO_UPDATE,e.matrixWorldNeedsUpdate=!1,e.matrixWorldAutoUpdate=n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,e.layers=new ln,e.visible=!0,e.castShadow=!1,e.receiveShadow=!1,e.frustumCulled=!0,e.renderOrder=0,e.animations=[],e.userData={},e}return E(n,[{key:"onBeforeRender",value:function(){}},{key:"onAfterRender",value:function(){}},{key:"applyMatrix4",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}},{key:"applyQuaternion",value:function(e){return this.quaternion.premultiply(e),this}},{key:"setRotationFromAxisAngle",value:function(e,t){this.quaternion.setFromAxisAngle(e,t)}},{key:"setRotationFromEuler",value:function(e){this.quaternion.setFromEuler(e,!0)}},{key:"setRotationFromMatrix",value:function(e){this.quaternion.setFromRotationMatrix(e)}},{key:"setRotationFromQuaternion",value:function(e){this.quaternion.copy(e)}},{key:"rotateOnAxis",value:function(e,t){return pn.setFromAxisAngle(e,t),this.quaternion.multiply(pn),this}},{key:"rotateOnWorldAxis",value:function(e,t){return pn.setFromAxisAngle(e,t),this.quaternion.premultiply(pn),this}},{key:"rotateX",value:function(e){return this.rotateOnAxis(bn,e)}},{key:"rotateY",value:function(e){return this.rotateOnAxis(xn,e)}},{key:"rotateZ",value:function(e){return this.rotateOnAxis(wn,e)}},{key:"translateOnAxis",value:function(e,t){return hn.copy(e).applyQuaternion(this.quaternion),this.position.add(hn.multiplyScalar(t)),this}},{key:"translateX",value:function(e){return this.translateOnAxis(bn,e)}},{key:"translateY",value:function(e){return this.translateOnAxis(xn,e)}},{key:"translateZ",value:function(e){return this.translateOnAxis(wn,e)}},{key:"localToWorld",value:function(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}},{key:"worldToLocal",value:function(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(fn.copy(this.matrixWorld).invert())}},{key:"lookAt",value:function(e,t,n){e.isVector3?mn.copy(e):mn.set(e,t,n);var r=this.parent;this.updateWorldMatrix(!0,!1),vn.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?fn.lookAt(vn,mn,this.up):fn.lookAt(mn,vn,this.up),this.quaternion.setFromRotationMatrix(fn),r&&(fn.extractRotation(r.matrixWorld),pn.setFromRotationMatrix(fn),this.quaternion.premultiply(pn.invert()))}},{key:"add",value:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(kn)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}},{key:"remove",value:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return-1!==n&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(Sn)),this}},{key:"removeFromParent",value:function(){var e=this.parent;return null!==e&&e.remove(this),this}},{key:"clear",value:function(){for(var e=0;e<this.children.length;e++){var t=this.children[e];t.parent=null,t.dispatchEvent(Sn)}return this.children.length=0,this}},{key:"attach",value:function(e){return this.updateWorldMatrix(!0,!1),fn.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),fn.multiply(e.parent.matrixWorld)),e.applyMatrix4(fn),this.add(e),e.updateWorldMatrix(!1,!0),this}},{key:"getObjectById",value:function(e){return this.getObjectByProperty("id",e)}},{key:"getObjectByName",value:function(e){return this.getObjectByProperty("name",e)}},{key:"getObjectByProperty",value:function(e,t){if(this[e]===t)return this;for(var n=0,r=this.children.length;n<r;n++){var a=this.children[n].getObjectByProperty(e,t);if(void 0!==a)return a}}},{key:"getObjectsByProperty",value:function(e,t){var n=[];this[e]===t&&n.push(this);for(var r=0,a=this.children.length;r<a;r++){var i=this.children[r].getObjectsByProperty(e,t);i.length>0&&(n=n.concat(i))}return n}},{key:"getWorldPosition",value:function(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}},{key:"getWorldQuaternion",value:function(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(vn,e,gn),e}},{key:"getWorldScale",value:function(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(vn,yn,e),e}},{key:"getWorldDirection",value:function(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}},{key:"raycast",value:function(){}},{key:"traverse",value:function(e){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverse(e)}},{key:"traverseVisible",value:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}}},{key:"traverseAncestors",value:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}},{key:"updateMatrix",value:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}},{key:"updateMatrixWorld",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,n=0,r=t.length;n<r;n++){var a=t[n];!0!==a.matrixWorldAutoUpdate&&!0!==e||a.updateMatrixWorld(e)}}},{key:"updateWorldMatrix",value:function(e,t){var n=this.parent;if(!0===e&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var r=this.children,a=0,i=r.length;a<i;a++){var o=r[a];!0===o.matrixWorldAutoUpdate&&o.updateWorldMatrix(!1,!0)}}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};function a(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=a(e.geometries,this.geometry);var i=this.geometry.parameters;if(void 0!==i&&void 0!==i.shapes){var o=i.shapes;if(Array.isArray(o))for(var s=0,u=o.length;s<u;s++){var c=o[s];a(e.shapes,c)}else a(e.shapes,o)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(a(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){for(var l=[],d=0,h=this.material.length;d<h;d++)l.push(a(e.materials,this.material[d]));r.material=l}else r.material=a(e.materials,this.material);if(this.children.length>0){r.children=[];for(var p=0;p<this.children.length;p++)r.children.push(this.children[p].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(var f=0;f<this.animations.length;f++){var m=this.animations[f];r.animations.push(a(e.animations,m))}}if(t){var v=T(e.geometries),g=T(e.materials),y=T(e.textures),b=T(e.images),x=T(e.shapes),w=T(e.skeletons),k=T(e.animations),S=T(e.nodes);v.length>0&&(n.geometries=v),g.length>0&&(n.materials=g),y.length>0&&(n.textures=y),b.length>0&&(n.images=b),x.length>0&&(n.shapes=x),w.length>0&&(n.skeletons=w),k.length>0&&(n.animations=k),S.length>0&&(n.nodes=S)}return n.object=r,n;function T(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}}},{key:"clone",value:function(e){return(new this.constructor).copy(this,e)}},{key:"copy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var n=0;n<e.children.length;n++){var r=e.children[n];this.add(r.clone())}return this}}]),n}(Ge);Tn.DEFAULT_UP=new kt(0,1,0),Tn.DEFAULT_MATRIX_AUTO_UPDATE=!0,Tn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var _n=new kt,In=new kt,En=new kt,Cn=new kt,Mn=new kt,Nn=new kt,Rn=new kt,Ln=new kt,An=new kt,Pn=new kt,Dn=!1,On=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new kt,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new kt,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new kt;T(this,e),this.a=t,this.b=n,this.c=r}return E(e,[{key:"set",value:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}},{key:"setFromPointsAndIndices",value:function(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}},{key:"setFromAttributeAndIndices",value:function(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}},{key:"getArea",value:function(){return _n.subVectors(this.c,this.b),In.subVectors(this.a,this.b),.5*_n.cross(In).length()}},{key:"getMidpoint",value:function(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}},{key:"getNormal",value:function(t){return e.getNormal(this.a,this.b,this.c,t)}},{key:"getPlane",value:function(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}},{key:"getBarycoord",value:function(t,n){return e.getBarycoord(t,this.a,this.b,this.c,n)}},{key:"getUV",value:function(t,n,r,a,i){return!1===Dn&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Dn=!0),e.getInterpolation(t,this.a,this.b,this.c,n,r,a,i)}},{key:"getInterpolation",value:function(t,n,r,a,i){return e.getInterpolation(t,this.a,this.b,this.c,n,r,a,i)}},{key:"containsPoint",value:function(t){return e.containsPoint(t,this.a,this.b,this.c)}},{key:"isFrontFacing",value:function(t){return e.isFrontFacing(this.a,this.b,this.c,t)}},{key:"intersectsBox",value:function(e){return e.intersectsTriangle(this)}},{key:"closestPointToPoint",value:function(e,t){var n,r,a=this.a,i=this.b,o=this.c;Mn.subVectors(i,a),Nn.subVectors(o,a),Ln.subVectors(e,a);var s=Mn.dot(Ln),u=Nn.dot(Ln);if(s<=0&&u<=0)return t.copy(a);An.subVectors(e,i);var c=Mn.dot(An),l=Nn.dot(An);if(c>=0&&l<=c)return t.copy(i);var d=s*l-c*u;if(d<=0&&s>=0&&c<=0)return n=s/(s-c),t.copy(a).addScaledVector(Mn,n);Pn.subVectors(e,o);var h=Mn.dot(Pn),p=Nn.dot(Pn);if(p>=0&&h<=p)return t.copy(o);var f=h*u-s*p;if(f<=0&&u>=0&&p<=0)return r=u/(u-p),t.copy(a).addScaledVector(Nn,r);var m=c*p-h*l;if(m<=0&&l-c>=0&&h-p>=0)return Rn.subVectors(o,i),r=(l-c)/(l-c+(h-p)),t.copy(i).addScaledVector(Rn,r);var v=1/(m+f+d);return n=f*v,r=d*v,t.copy(a).addScaledVector(Mn,n).addScaledVector(Nn,r)}},{key:"equals",value:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}],[{key:"getNormal",value:function(e,t,n,r){r.subVectors(n,t),_n.subVectors(e,t),r.cross(_n);var a=r.lengthSq();return a>0?r.multiplyScalar(1/Math.sqrt(a)):r.set(0,0,0)}},{key:"getBarycoord",value:function(e,t,n,r,a){_n.subVectors(r,t),In.subVectors(n,t),En.subVectors(e,t);var i=_n.dot(_n),o=_n.dot(In),s=_n.dot(En),u=In.dot(In),c=In.dot(En),l=i*u-o*o;if(0===l)return a.set(-2,-1,-1);var d=1/l,h=(u*s-o*c)*d,p=(i*c-o*s)*d;return a.set(1-h-p,p,h)}},{key:"containsPoint",value:function(e,t,n,r){return this.getBarycoord(e,t,n,r,Cn),Cn.x>=0&&Cn.y>=0&&Cn.x+Cn.y<=1}},{key:"getUV",value:function(e,t,n,r,a,i,o,s){return!1===Dn&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Dn=!0),this.getInterpolation(e,t,n,r,a,i,o,s)}},{key:"getInterpolation",value:function(e,t,n,r,a,i,o,s){return this.getBarycoord(e,t,n,r,Cn),s.setScalar(0),s.addScaledVector(a,Cn.x),s.addScaledVector(i,Cn.y),s.addScaledVector(o,Cn.z),s}},{key:"isFrontFacing",value:function(e,t,n,r){return _n.subVectors(n,t),In.subVectors(e,t),_n.cross(In).dot(r)<0}}]),e}(),zn=0,Fn=function(e){m(n,e);var t=y(n);function n(){var e;return T(this,n),(e=t.call(this)).isMaterial=!0,Object.defineProperty(h(e),"id",{value:zn++}),e.uuid=Xe(),e.name="",e.type="Material",e.blending=1,e.side=O,e.vertexColors=!1,e.opacity=1,e.transparent=!1,e.blendSrc=204,e.blendDst=205,e.blendEquation=W,e.blendSrcAlpha=null,e.blendDstAlpha=null,e.blendEquationAlpha=null,e.depthFunc=3,e.depthTest=!0,e.depthWrite=!0,e.stencilWriteMask=255,e.stencilFunc=519,e.stencilRef=0,e.stencilFuncMask=255,e.stencilFail=De,e.stencilZFail=De,e.stencilZPass=De,e.stencilWrite=!1,e.clippingPlanes=null,e.clipIntersection=!1,e.clipShadows=!1,e.shadowSide=null,e.colorWrite=!0,e.precision=null,e.polygonOffset=!1,e.polygonOffsetFactor=0,e.polygonOffsetUnits=0,e.dithering=!1,e.alphaToCoverage=!1,e.premultipliedAlpha=!1,e.forceSinglePass=!1,e.visible=!0,e.toneMapped=!0,e.userData={},e.version=0,e._alphaTest=0,e}return E(n,[{key:"alphaTest",get:function(){return this._alphaTest},set:function(e){this._alphaTest>0!==e>0&&this.version++,this._alphaTest=e}},{key:"onBuild",value:function(){}},{key:"onBeforeRender",value:function(){}},{key:"onBeforeCompile",value:function(){}},{key:"customProgramCacheKey",value:function(){return this.onBeforeCompile.toString()}},{key:"setValues",value:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n){var r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn("THREE.Material: '".concat(t,"' is not a property of THREE.").concat(this.type,"."))}else console.warn("THREE.Material: parameter '".concat(t,"' has value of undefined."))}}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),this.side!==O&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.forceSinglePass&&(n.forceSinglePass=this.forceSinglePass),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){var a=r(e.textures),i=r(e.images);a.length>0&&(n.textures=a),i.length>0&&(n.images=i)}return n}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,n=null;if(null!==t){var r=t.length;n=new Array(r);for(var a=0;a!==r;++a)n[a]=t[a].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}}]),n}(Ge),Gn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Wn={h:0,s:0,l:0},Vn={h:0,s:0,l:0};function Un(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}var Xn=function(e){function t(e,n,r){return T(this,t),this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===n&&void 0===r?this.set(e):this.setRGB(e,n,r)}return E(t,[{key:"set",value:function(e){return e&&e.isColor?this.copy(e):"number"===typeof e?this.setHex(e):"string"===typeof e&&this.setStyle(e),this}},{key:"setScalar",value:function(e){return this.r=e,this.g=e,this.b=e,this}},{key:"setHex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Le;return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,dt.toWorkingColorSpace(this,t),this}},{key:"setRGB",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:dt.workingColorSpace;return this.r=e,this.g=t,this.b=n,dt.toWorkingColorSpace(this,r),this}},{key:"setHSL",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:dt.workingColorSpace;if(e=He(e,1),t=Be(t,0,1),n=Be(n,0,1),0===t)this.r=this.g=this.b=n;else{var a=n<=.5?n*(1+t):n+t-n*t,i=2*n-a;this.r=Un(i,a,e+1/3),this.g=Un(i,a,e),this.b=Un(i,a,e-1/3)}return dt.toWorkingColorSpace(this,r),this}},{key:"setStyle",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Le;function r(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(t=/^(\w+)\(([^\)]*)\)/.exec(e)){var a,i=t[1],o=t[2];switch(i){case"rgb":case"rgba":if(a=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(a[4]),this.setRGB(Math.min(255,parseInt(a[1],10))/255,Math.min(255,parseInt(a[2],10))/255,Math.min(255,parseInt(a[3],10))/255,n);if(a=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(a[4]),this.setRGB(Math.min(100,parseInt(a[1],10))/100,Math.min(100,parseInt(a[2],10))/100,Math.min(100,parseInt(a[3],10))/100,n);break;case"hsl":case"hsla":if(a=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(a[4]),this.setHSL(parseFloat(a[1])/360,parseFloat(a[2])/100,parseFloat(a[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(t=/^\#([A-Fa-f\d]+)$/.exec(e)){var s=t[1],u=s.length;if(3===u)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(6===u)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}},{key:"setColorName",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Le,n=Gn[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}},{key:"clone",value:function(){return new this.constructor(this.r,this.g,this.b)}},{key:"copy",value:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}},{key:"copySRGBToLinear",value:function(e){return this.r=at(e.r),this.g=at(e.g),this.b=at(e.b),this}},{key:"copyLinearToSRGB",value:function(e){return this.r=it(e.r),this.g=it(e.g),this.b=it(e.b),this}},{key:"convertSRGBToLinear",value:function(){return this.copySRGBToLinear(this),this}},{key:"convertLinearToSRGB",value:function(){return this.copyLinearToSRGB(this),this}},{key:"getHex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Le;return dt.fromWorkingColorSpace(Bn.copy(this),e),65536*Math.round(Be(255*Bn.r,0,255))+256*Math.round(Be(255*Bn.g,0,255))+Math.round(Be(255*Bn.b,0,255))}},{key:"getHexString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Le;return("000000"+this.getHex(e).toString(16)).slice(-6)}},{key:"getHSL",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:dt.workingColorSpace;dt.fromWorkingColorSpace(Bn.copy(this),t);var n,r,a=Bn.r,i=Bn.g,o=Bn.b,s=Math.max(a,i,o),u=Math.min(a,i,o),c=(u+s)/2;if(u===s)n=0,r=0;else{var l=s-u;switch(r=c<=.5?l/(s+u):l/(2-s-u),s){case a:n=(i-o)/l+(i<o?6:0);break;case i:n=(o-a)/l+2;break;case o:n=(a-i)/l+4}n/=6}return e.h=n,e.s=r,e.l=c,e}},{key:"getRGB",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:dt.workingColorSpace;return dt.fromWorkingColorSpace(Bn.copy(this),t),e.r=Bn.r,e.g=Bn.g,e.b=Bn.b,e}},{key:"getStyle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Le;dt.fromWorkingColorSpace(Bn.copy(this),e);var t=Bn.r,n=Bn.g,r=Bn.b;return e!==Le?"color(".concat(e," ").concat(t.toFixed(3)," ").concat(n.toFixed(3)," ").concat(r.toFixed(3),")"):"rgb(".concat(Math.round(255*t),",").concat(Math.round(255*n),",").concat(Math.round(255*r),")")}},{key:"offsetHSL",value:function(e,t,n){return this.getHSL(Wn),Wn.h+=e,Wn.s+=t,Wn.l+=n,this.setHSL(Wn.h,Wn.s,Wn.l),this}},{key:"add",value:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}},{key:"addColors",value:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}},{key:"addScalar",value:function(e){return this.r+=e,this.g+=e,this.b+=e,this}},{key:"sub",value:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}},{key:"multiply",value:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}},{key:"multiplyScalar",value:function(e){return this.r*=e,this.g*=e,this.b*=e,this}},{key:"lerp",value:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}},{key:"lerpColors",value:function(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}},{key:"lerpHSL",value:function(e,t){this.getHSL(Wn),e.getHSL(Vn);var n=Ze(Wn.h,Vn.h,t),r=Ze(Wn.s,Vn.s,t),a=Ze(Wn.l,Vn.l,t);return this.setHSL(n,r,a),this}},{key:"setFromVector3",value:function(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}},{key:"applyMatrix3",value:function(e){var t=this.r,n=this.g,r=this.b,a=e.elements;return this.r=a[0]*t+a[3]*n+a[6]*r,this.g=a[1]*t+a[4]*n+a[7]*r,this.b=a[2]*t+a[5]*n+a[8]*r,this}},{key:"equals",value:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}},{key:"fromBufferAttribute",value:function(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}},{key:"toJSON",value:function(){return this.getHex()}},{key:Symbol.iterator,value:w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.r;case 2:return e.next=4,this.g;case 4:return e.next=6,this.b;case 6:case"end":return e.stop()}}),e,this)}))}]),t}(),Bn=new Xn;Xn.NAMES=Gn;var Hn=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this)).isMeshBasicMaterial=!0,r.type="MeshBasicMaterial",r.color=new Xn(16777215),r.map=null,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=null,r.aoMapIntensity=1,r.specularMap=null,r.alphaMap=null,r.envMap=null,r.combine=V,r.reflectivity=1,r.refractionRatio=.98,r.wireframe=!1,r.wireframeLinewidth=1,r.wireframeLinecap="round",r.wireframeLinejoin="round",r.fog=!0,r.setValues(e),r}return E(n,[{key:"copy",value:function(e){return N(v(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}]),n}(Fn);var Zn=new kt,Kn=new Je,jn=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(T(this,e),Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=n,this.count=void 0!==t?t.length/n:0,this.normalized=r,this.usage=Oe,this.updateRange={offset:0,count:-1},this.version=0}return E(e,[{key:"onUploadCallback",value:function(){}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"setUsage",value:function(e){return this.usage=e,this}},{key:"copy",value:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}},{key:"copyAt",value:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var r=0,a=this.itemSize;r<a;r++)this.array[e+r]=t.array[n+r];return this}},{key:"copyArray",value:function(e){return this.array.set(e),this}},{key:"applyMatrix3",value:function(e){if(2===this.itemSize)for(var t=0,n=this.count;t<n;t++)Kn.fromBufferAttribute(this,t),Kn.applyMatrix3(e),this.setXY(t,Kn.x,Kn.y);else if(3===this.itemSize)for(var r=0,a=this.count;r<a;r++)Zn.fromBufferAttribute(this,r),Zn.applyMatrix3(e),this.setXYZ(r,Zn.x,Zn.y,Zn.z);return this}},{key:"applyMatrix4",value:function(e){for(var t=0,n=this.count;t<n;t++)Zn.fromBufferAttribute(this,t),Zn.applyMatrix4(e),this.setXYZ(t,Zn.x,Zn.y,Zn.z);return this}},{key:"applyNormalMatrix",value:function(e){for(var t=0,n=this.count;t<n;t++)Zn.fromBufferAttribute(this,t),Zn.applyNormalMatrix(e),this.setXYZ(t,Zn.x,Zn.y,Zn.z);return this}},{key:"transformDirection",value:function(e){for(var t=0,n=this.count;t<n;t++)Zn.fromBufferAttribute(this,t),Zn.transformDirection(e),this.setXYZ(t,Zn.x,Zn.y,Zn.z);return this}},{key:"set",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}},{key:"getX",value:function(e){var t=this.array[e*this.itemSize];return this.normalized&&(t=Ye(t,this.array)),t}},{key:"setX",value:function(e,t){return this.normalized&&(t=Qe(t,this.array)),this.array[e*this.itemSize]=t,this}},{key:"getY",value:function(e){var t=this.array[e*this.itemSize+1];return this.normalized&&(t=Ye(t,this.array)),t}},{key:"setY",value:function(e,t){return this.normalized&&(t=Qe(t,this.array)),this.array[e*this.itemSize+1]=t,this}},{key:"getZ",value:function(e){var t=this.array[e*this.itemSize+2];return this.normalized&&(t=Ye(t,this.array)),t}},{key:"setZ",value:function(e,t){return this.normalized&&(t=Qe(t,this.array)),this.array[e*this.itemSize+2]=t,this}},{key:"getW",value:function(e){var t=this.array[e*this.itemSize+3];return this.normalized&&(t=Ye(t,this.array)),t}},{key:"setW",value:function(e,t){return this.normalized&&(t=Qe(t,this.array)),this.array[e*this.itemSize+3]=t,this}},{key:"setXY",value:function(e,t,n){return e*=this.itemSize,this.normalized&&(t=Qe(t,this.array),n=Qe(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}},{key:"setXYZ",value:function(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=Qe(t,this.array),n=Qe(n,this.array),r=Qe(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}},{key:"setXYZW",value:function(e,t,n,r,a){return e*=this.itemSize,this.normalized&&(t=Qe(t,this.array),n=Qe(n,this.array),r=Qe(r,this.array),a=Qe(a,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=a,this}},{key:"onUpload",value:function(e){return this.onUploadCallback=e,this}},{key:"clone",value:function(){return new this.constructor(this.array,this.itemSize).copy(this)}},{key:"toJSON",value:function(){var e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==Oe&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}},{key:"copyColorsArray",value:function(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}},{key:"copyVector2sArray",value:function(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}},{key:"copyVector3sArray",value:function(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}},{key:"copyVector4sArray",value:function(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}]),e}(),Yn=function(e){m(n,e);var t=y(n);function n(e,r,a){return T(this,n),t.call(this,new Uint16Array(e),r,a)}return E(n)}(jn),Qn=function(e){m(n,e);var t=y(n);function n(e,r,a){return T(this,n),t.call(this,new Uint32Array(e),r,a)}return E(n)}(jn),Jn=function(e){m(n,e);var t=y(n);function n(e,r,a){return T(this,n),t.call(this,new Float32Array(e),r,a)}return E(n)}(jn),qn=0,$n=new qt,er=new Tn,tr=new kt,nr=new _t,rr=new _t,ar=new kt,ir=function(e){m(n,e);var t=y(n);function n(){var e;return T(this,n),(e=t.call(this)).isBufferGeometry=!0,Object.defineProperty(h(e),"id",{value:qn++}),e.uuid=Xe(),e.name="",e.type="BufferGeometry",e.index=null,e.attributes={},e.morphAttributes={},e.morphTargetsRelative=!1,e.groups=[],e.boundingBox=null,e.boundingSphere=null,e.drawRange={start:0,count:1/0},e.userData={},e}return E(n,[{key:"getIndex",value:function(){return this.index}},{key:"setIndex",value:function(e){return Array.isArray(e)?this.index=new(et(e)?Qn:Yn)(e,1):this.index=e,this}},{key:"getAttribute",value:function(e){return this.attributes[e]}},{key:"setAttribute",value:function(e,t){return this.attributes[e]=t,this}},{key:"deleteAttribute",value:function(e){return delete this.attributes[e],this}},{key:"hasAttribute",value:function(e){return void 0!==this.attributes[e]}},{key:"addGroup",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})}},{key:"clearGroups",value:function(){this.groups=[]}},{key:"setDrawRange",value:function(e,t){this.drawRange.start=e,this.drawRange.count=t}},{key:"applyMatrix4",value:function(e){var t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var r=(new qe).getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}var a=this.attributes.tangent;return void 0!==a&&(a.transformDirection(e),a.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}},{key:"applyQuaternion",value:function(e){return $n.makeRotationFromQuaternion(e),this.applyMatrix4($n),this}},{key:"rotateX",value:function(e){return $n.makeRotationX(e),this.applyMatrix4($n),this}},{key:"rotateY",value:function(e){return $n.makeRotationY(e),this.applyMatrix4($n),this}},{key:"rotateZ",value:function(e){return $n.makeRotationZ(e),this.applyMatrix4($n),this}},{key:"translate",value:function(e,t,n){return $n.makeTranslation(e,t,n),this.applyMatrix4($n),this}},{key:"scale",value:function(e,t,n){return $n.makeScale(e,t,n),this.applyMatrix4($n),this}},{key:"lookAt",value:function(e){return er.lookAt(e),er.updateMatrix(),this.applyMatrix4(er.matrix),this}},{key:"center",value:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(tr).negate(),this.translate(tr.x,tr.y,tr.z),this}},{key:"setFromPoints",value:function(e){for(var t=[],n=0,r=e.length;n<r;n++){var a=e[n];t.push(a.x,a.y,a.z||0)}return this.setAttribute("position",new Jn(t,3)),this}},{key:"computeBoundingBox",value:function(){null===this.boundingBox&&(this.boundingBox=new _t);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new kt(-1/0,-1/0,-1/0),new kt(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var n=0,r=t.length;n<r;n++){var a=t[n];nr.setFromBufferAttribute(a),this.morphTargetsRelative?(ar.addVectors(this.boundingBox.min,nr.min),this.boundingBox.expandByPoint(ar),ar.addVectors(this.boundingBox.max,nr.max),this.boundingBox.expandByPoint(ar)):(this.boundingBox.expandByPoint(nr.min),this.boundingBox.expandByPoint(nr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}},{key:"computeBoundingSphere",value:function(){null===this.boundingSphere&&(this.boundingSphere=new Xt);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new kt,1/0);if(e){var n=this.boundingSphere.center;if(nr.setFromBufferAttribute(e),t)for(var r=0,a=t.length;r<a;r++){var i=t[r];rr.setFromBufferAttribute(i),this.morphTargetsRelative?(ar.addVectors(nr.min,rr.min),nr.expandByPoint(ar),ar.addVectors(nr.max,rr.max),nr.expandByPoint(ar)):(nr.expandByPoint(rr.min),nr.expandByPoint(rr.max))}nr.getCenter(n);for(var o=0,s=0,u=e.count;s<u;s++)ar.fromBufferAttribute(e,s),o=Math.max(o,n.distanceToSquared(ar));if(t)for(var c=0,l=t.length;c<l;c++)for(var d=t[c],h=this.morphTargetsRelative,p=0,f=d.count;p<f;p++)ar.fromBufferAttribute(d,p),h&&(tr.fromBufferAttribute(e,p),ar.add(tr)),o=Math.max(o,n.distanceToSquared(ar));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}},{key:"computeTangents",value:function(){var e=this.index,t=this.attributes;if(null!==e&&void 0!==t.position&&void 0!==t.normal&&void 0!==t.uv){var n=e.array,r=t.position.array,a=t.normal.array,i=t.uv.array,o=r.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new jn(new Float32Array(4*o),4));for(var s=this.getAttribute("tangent").array,u=[],c=[],l=0;l<o;l++)u[l]=new kt,c[l]=new kt;var d=new kt,h=new kt,p=new kt,f=new Je,m=new Je,v=new Je,g=new kt,y=new kt,b=this.groups;0===b.length&&(b=[{start:0,count:n.length}]);for(var x=0,w=b.length;x<w;++x)for(var k=b[x],S=k.start,T=S,_=S+k.count;T<_;T+=3)O(n[T+0],n[T+1],n[T+2]);for(var I=new kt,E=new kt,C=new kt,M=new kt,N=0,R=b.length;N<R;++N)for(var L=b[N],A=L.start,P=A,D=A+L.count;P<D;P+=3)z(n[P+0]),z(n[P+1]),z(n[P+2])}else console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");function O(e,t,n){d.fromArray(r,3*e),h.fromArray(r,3*t),p.fromArray(r,3*n),f.fromArray(i,2*e),m.fromArray(i,2*t),v.fromArray(i,2*n),h.sub(d),p.sub(d),m.sub(f),v.sub(f);var a=1/(m.x*v.y-v.x*m.y);isFinite(a)&&(g.copy(h).multiplyScalar(v.y).addScaledVector(p,-m.y).multiplyScalar(a),y.copy(p).multiplyScalar(m.x).addScaledVector(h,-v.x).multiplyScalar(a),u[e].add(g),u[t].add(g),u[n].add(g),c[e].add(y),c[t].add(y),c[n].add(y))}function z(e){C.fromArray(a,3*e),M.copy(C);var t=u[e];I.copy(t),I.sub(C.multiplyScalar(C.dot(t))).normalize(),E.crossVectors(M,t);var n=E.dot(c[e])<0?-1:1;s[4*e]=I.x,s[4*e+1]=I.y,s[4*e+2]=I.z,s[4*e+3]=n}}},{key:"computeVertexNormals",value:function(){var e=this.index,t=this.getAttribute("position");if(void 0!==t){var n=this.getAttribute("normal");if(void 0===n)n=new jn(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(var r=0,a=n.count;r<a;r++)n.setXYZ(r,0,0,0);var i=new kt,o=new kt,s=new kt,u=new kt,c=new kt,l=new kt,d=new kt,h=new kt;if(e)for(var p=0,f=e.count;p<f;p+=3){var m=e.getX(p+0),v=e.getX(p+1),g=e.getX(p+2);i.fromBufferAttribute(t,m),o.fromBufferAttribute(t,v),s.fromBufferAttribute(t,g),d.subVectors(s,o),h.subVectors(i,o),d.cross(h),u.fromBufferAttribute(n,m),c.fromBufferAttribute(n,v),l.fromBufferAttribute(n,g),u.add(d),c.add(d),l.add(d),n.setXYZ(m,u.x,u.y,u.z),n.setXYZ(v,c.x,c.y,c.z),n.setXYZ(g,l.x,l.y,l.z)}else for(var y=0,b=t.count;y<b;y+=3)i.fromBufferAttribute(t,y+0),o.fromBufferAttribute(t,y+1),s.fromBufferAttribute(t,y+2),d.subVectors(s,o),h.subVectors(i,o),d.cross(h),n.setXYZ(y+0,d.x,d.y,d.z),n.setXYZ(y+1,d.x,d.y,d.z),n.setXYZ(y+2,d.x,d.y,d.z);this.normalizeNormals(),n.needsUpdate=!0}}},{key:"merge",value:function(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeGeometries() instead."),this}},{key:"normalizeNormals",value:function(){for(var e=this.attributes.normal,t=0,n=e.count;t<n;t++)ar.fromBufferAttribute(e,t),ar.normalize(),e.setXYZ(t,ar.x,ar.y,ar.z)}},{key:"toNonIndexed",value:function(){function e(e,t){for(var n=e.array,r=e.itemSize,a=e.normalized,i=new n.constructor(t.length*r),o=0,s=0,u=0,c=t.length;u<c;u++){o=e.isInterleavedBufferAttribute?t[u]*e.data.stride+e.offset:t[u]*r;for(var l=0;l<r;l++)i[s++]=n[o++]}return new jn(i,r,a)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;var t=new n,r=this.index.array,a=this.attributes;for(var i in a){var o=e(a[i],r);t.setAttribute(i,o)}var s=this.morphAttributes;for(var u in s){for(var c=[],l=s[u],d=0,h=l.length;d<h;d++){var p=e(l[d],r);c.push(p)}t.morphAttributes[u]=c}t.morphTargetsRelative=this.morphTargetsRelative;for(var f=this.groups,m=0,v=f.length;m<v;m++){var g=f[m];t.addGroup(g.start,g.count,g.materialIndex)}return t}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};var r=this.index;null!==r&&(e.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)});var a=this.attributes;for(var i in a){var o=a[i];e.data.attributes[i]=o.toJSON(e.data)}var s={},u=!1;for(var c in this.morphAttributes){for(var l=this.morphAttributes[c],d=[],h=0,p=l.length;h<p;h++){var f=l[h];d.push(f.toJSON(e.data))}d.length>0&&(s[c]=d,u=!0)}u&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);var m=this.groups;m.length>0&&(e.data.groups=JSON.parse(JSON.stringify(m)));var v=this.boundingSphere;return null!==v&&(e.data.boundingSphere={center:v.center.toArray(),radius:v.radius}),e}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var t={};this.name=e.name;var n=e.index;null!==n&&this.setIndex(n.clone(t));var r=e.attributes;for(var a in r){var i=r[a];this.setAttribute(a,i.clone(t))}var o=e.morphAttributes;for(var s in o){for(var u=[],c=o[s],l=0,d=c.length;l<d;l++)u.push(c[l].clone(t));this.morphAttributes[s]=u}this.morphTargetsRelative=e.morphTargetsRelative;for(var h=e.groups,p=0,f=h.length;p<f;p++){var m=h[p];this.addGroup(m.start,m.count,m.materialIndex)}var v=e.boundingBox;null!==v&&(this.boundingBox=v.clone());var g=e.boundingSphere;return null!==g&&(this.boundingSphere=g.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(Ge),or=new qt,sr=new Jt,ur=new Xt,cr=new kt,lr=new kt,dr=new kt,hr=new kt,pr=new kt,fr=new kt,mr=new Je,vr=new Je,gr=new Je,yr=new kt,br=new kt,xr=new kt,wr=new kt,kr=new kt,Sr=function(e){m(n,e);var t=y(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ir,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Hn;return T(this,n),(e=t.call(this)).isMesh=!0,e.type="Mesh",e.geometry=r,e.material=a,e.updateMorphTargets(),e}return E(n,[{key:"copy",value:function(e,t){return N(v(n.prototype),"copy",this).call(this,e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}},{key:"updateMorphTargets",value:function(){var e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){var n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var r=0,a=n.length;r<a;r++){var i=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=r}}}}},{key:"getVertexPosition",value:function(e,t){var n=this.geometry,r=n.attributes.position,a=n.morphAttributes.position,i=n.morphTargetsRelative;t.fromBufferAttribute(r,e);var o=this.morphTargetInfluences;if(a&&o){fr.set(0,0,0);for(var s=0,u=a.length;s<u;s++){var c=o[s],l=a[s];0!==c&&(pr.fromBufferAttribute(l,e),i?fr.addScaledVector(pr,c):fr.addScaledVector(pr.sub(t),c))}t.add(fr)}return t}},{key:"raycast",value:function(e,t){var n=this.geometry,r=this.material,a=this.matrixWorld;if(void 0!==r){if(null===n.boundingSphere&&n.computeBoundingSphere(),ur.copy(n.boundingSphere),ur.applyMatrix4(a),sr.copy(e.ray).recast(e.near),!1===ur.containsPoint(sr.origin)){if(null===sr.intersectSphere(ur,cr))return;if(sr.origin.distanceToSquared(cr)>Math.pow(e.far-e.near,2))return}or.copy(a).invert(),sr.copy(e.ray).applyMatrix4(or),null!==n.boundingBox&&!1===sr.intersectsBox(n.boundingBox)||this._computeIntersections(e,t)}}},{key:"_computeIntersections",value:function(e,t){var n,r=this.geometry,a=this.material,i=r.index,o=r.attributes.position,s=r.attributes.uv,u=r.attributes.uv1,c=r.attributes.normal,l=r.groups,d=r.drawRange;if(null!==i)if(Array.isArray(a))for(var h=0,p=l.length;h<p;h++)for(var f=l[h],m=a[f.materialIndex],v=Math.max(f.start,d.start),g=Math.min(i.count,Math.min(f.start+f.count,d.start+d.count));v<g;v+=3){var y=i.getX(v),b=i.getX(v+1),x=i.getX(v+2);(n=Tr(this,m,e,sr,s,u,c,y,b,x))&&(n.faceIndex=Math.floor(v/3),n.face.materialIndex=f.materialIndex,t.push(n))}else for(var w=Math.max(0,d.start),k=Math.min(i.count,d.start+d.count);w<k;w+=3){var S=i.getX(w),T=i.getX(w+1),_=i.getX(w+2);(n=Tr(this,a,e,sr,s,u,c,S,T,_))&&(n.faceIndex=Math.floor(w/3),t.push(n))}else if(void 0!==o)if(Array.isArray(a))for(var I=0,E=l.length;I<E;I++)for(var C=l[I],M=a[C.materialIndex],N=Math.max(C.start,d.start),R=Math.min(o.count,Math.min(C.start+C.count,d.start+d.count));N<R;N+=3){(n=Tr(this,M,e,sr,s,u,c,N,N+1,N+2))&&(n.faceIndex=Math.floor(N/3),n.face.materialIndex=C.materialIndex,t.push(n))}else for(var L=Math.max(0,d.start),A=Math.min(o.count,d.start+d.count);L<A;L+=3){(n=Tr(this,a,e,sr,s,u,c,L,L+1,L+2))&&(n.faceIndex=Math.floor(L/3),t.push(n))}}}]),n}(Tn);function Tr(e,t,n,r,a,i,o,s,u,c){e.getVertexPosition(s,lr),e.getVertexPosition(u,dr),e.getVertexPosition(c,hr);var l=function(e,t,n,r,a,i,o,s){if(null===(t.side===z?r.intersectTriangle(o,i,a,!0,s):r.intersectTriangle(a,i,o,t.side===O,s)))return null;kr.copy(s),kr.applyMatrix4(e.matrixWorld);var u=n.ray.origin.distanceTo(kr);return u<n.near||u>n.far?null:{distance:u,point:kr.clone(),object:e}}(e,t,n,r,lr,dr,hr,wr);if(l){a&&(mr.fromBufferAttribute(a,s),vr.fromBufferAttribute(a,u),gr.fromBufferAttribute(a,c),l.uv=On.getInterpolation(wr,lr,dr,hr,mr,vr,gr,new Je)),i&&(mr.fromBufferAttribute(i,s),vr.fromBufferAttribute(i,u),gr.fromBufferAttribute(i,c),l.uv1=On.getInterpolation(wr,lr,dr,hr,mr,vr,gr,new Je),l.uv2=l.uv1),o&&(yr.fromBufferAttribute(o,s),br.fromBufferAttribute(o,u),xr.fromBufferAttribute(o,c),l.normal=On.getInterpolation(wr,lr,dr,hr,yr,br,xr,new kt),l.normal.dot(r.direction)>0&&l.normal.multiplyScalar(-1));var d={a:s,b:u,c:c,normal:new kt,materialIndex:0};On.getNormal(lr,dr,hr,d.normal),l.face=d}return l}var _r=function(e){m(n,e);var t=y(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;T(this,n),(e=t.call(this)).type="BoxGeometry",e.parameters={width:r,height:a,depth:i,widthSegments:o,heightSegments:s,depthSegments:u};var c=h(e);o=Math.floor(o),s=Math.floor(s),u=Math.floor(u);var l=[],d=[],p=[],f=[],m=0,v=0;function g(e,t,n,r,a,i,o,s,u,h,g){for(var y=i/u,b=o/h,x=i/2,w=o/2,k=s/2,S=u+1,T=h+1,_=0,I=0,E=new kt,C=0;C<T;C++)for(var M=C*b-w,N=0;N<S;N++){var R=N*y-x;E[e]=R*r,E[t]=M*a,E[n]=k,d.push(E.x,E.y,E.z),E[e]=0,E[t]=0,E[n]=s>0?1:-1,p.push(E.x,E.y,E.z),f.push(N/u),f.push(1-C/h),_+=1}for(var L=0;L<h;L++)for(var A=0;A<u;A++){var P=m+A+S*L,D=m+A+S*(L+1),O=m+(A+1)+S*(L+1),z=m+(A+1)+S*L;l.push(P,D,z),l.push(D,O,z),I+=6}c.addGroup(v,I,g),v+=I,m+=_}return g("z","y","x",-1,-1,i,a,r,u,s,0),g("z","y","x",1,-1,i,a,-r,u,s,1),g("x","z","y",1,1,r,i,a,o,u,2),g("x","z","y",1,-1,r,i,-a,o,u,3),g("x","y","z",1,-1,r,a,i,o,s,4),g("x","y","z",-1,-1,r,a,-i,o,s,5),e.setIndex(l),e.setAttribute("position",new Jn(d,3)),e.setAttribute("normal",new Jn(p,3)),e.setAttribute("uv",new Jn(f,2)),e}return E(n,[{key:"copy",value:function(e){return N(v(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}}],[{key:"fromJSON",value:function(e){return new n(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}]),n}(ir);function Ir(e){var t={};for(var n in e)for(var r in t[n]={},e[n]){var a=e[n][r];a&&(a.isColor||a.isMatrix3||a.isMatrix4||a.isVector2||a.isVector3||a.isVector4||a.isTexture||a.isQuaternion)?a.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[n][r]=null):t[n][r]=a.clone():Array.isArray(a)?t[n][r]=a.slice():t[n][r]=a}return t}function Er(e){for(var t={},n=0;n<e.length;n++){var r=Ir(e[n]);for(var a in r)t[a]=r[a]}return t}function Cr(e){return null===e.getRenderTarget()?e.outputColorSpace:Ae}var Mr={clone:Ir,merge:Er},Nr=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this)).isShaderMaterial=!0,r.type="ShaderMaterial",r.defines={},r.uniforms={},r.uniformsGroups=[],r.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",r.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",r.linewidth=1,r.wireframe=!1,r.wireframeLinewidth=1,r.fog=!1,r.lights=!1,r.clipping=!1,r.forceSinglePass=!0,r.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},r.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},r.index0AttributeName=void 0,r.uniformsNeedUpdate=!1,r.glslVersion=null,void 0!==e&&r.setValues(e),r}return E(n,[{key:"copy",value:function(e){return N(v(n.prototype),"copy",this).call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Ir(e.uniforms),this.uniformsGroups=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}},{key:"toJSON",value:function(e){var t=N(v(n.prototype),"toJSON",this).call(this,e);for(var r in t.glslVersion=this.glslVersion,t.uniforms={},this.uniforms){var a=this.uniforms[r].value;a&&a.isTexture?t.uniforms[r]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?t.uniforms[r]={type:"c",value:a.getHex()}:a&&a.isVector2?t.uniforms[r]={type:"v2",value:a.toArray()}:a&&a.isVector3?t.uniforms[r]={type:"v3",value:a.toArray()}:a&&a.isVector4?t.uniforms[r]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?t.uniforms[r]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?t.uniforms[r]={type:"m4",value:a.toArray()}:t.uniforms[r]={value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;var i={};for(var o in this.extensions)!0===this.extensions[o]&&(i[o]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}]),n}(Fn),Rr=function(e){m(n,e);var t=y(n);function n(){var e;return T(this,n),(e=t.call(this)).isCamera=!0,e.type="Camera",e.matrixWorldInverse=new qt,e.projectionMatrix=new qt,e.projectionMatrixInverse=new qt,e}return E(n,[{key:"copy",value:function(e,t){return N(v(n.prototype),"copy",this).call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}},{key:"getWorldDirection",value:function(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}},{key:"updateMatrixWorld",value:function(e){N(v(n.prototype),"updateMatrixWorld",this).call(this,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"updateWorldMatrix",value:function(e,t){N(v(n.prototype),"updateWorldMatrix",this).call(this,e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),n}(Tn),Lr=function(e){m(n,e);var t=y(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;return T(this,n),(e=t.call(this)).isPerspectiveCamera=!0,e.type="PerspectiveCamera",e.fov=r,e.zoom=1,e.near=i,e.far=o,e.focus=10,e.aspect=a,e.view=null,e.filmGauge=35,e.filmOffset=0,e.updateProjectionMatrix(),e}return E(n,[{key:"copy",value:function(e,t){return N(v(n.prototype),"copy",this).call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}},{key:"setFocalLength",value:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*Ue*Math.atan(t),this.updateProjectionMatrix()}},{key:"getFocalLength",value:function(){var e=Math.tan(.5*Ve*this.fov);return.5*this.getFilmHeight()/e}},{key:"getEffectiveFOV",value:function(){return 2*Ue*Math.atan(Math.tan(.5*Ve*this.fov)/this.zoom)}},{key:"getFilmWidth",value:function(){return this.filmGauge*Math.min(this.aspect,1)}},{key:"getFilmHeight",value:function(){return this.filmGauge/Math.max(this.aspect,1)}},{key:"setViewOffset",value:function(e,t,n,r,a,i){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=a,this.view.height=i,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var e=this.near,t=e*Math.tan(.5*Ve*this.fov)/this.zoom,n=2*t,r=this.aspect*n,a=-.5*r,i=this.view;if(null!==this.view&&this.view.enabled){var o=i.fullWidth,s=i.fullHeight;a+=i.offsetX*r/o,t-=i.offsetY*n/s,r*=i.width/o,n*=i.height/s}var u=this.filmOffset;0!==u&&(a+=e*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(a,a+r,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(e){var t=N(v(n.prototype),"toJSON",this).call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}]),n}(Rr),Ar=-90,Pr=function(e){m(n,e);var t=y(n);function n(e,r,a){var i;T(this,n),(i=t.call(this)).type="CubeCamera",i.renderTarget=a;var o=new Lr(Ar,1,e,r);o.layers=i.layers,o.up.set(0,1,0),o.lookAt(1,0,0),i.add(o);var s=new Lr(Ar,1,e,r);s.layers=i.layers,s.up.set(0,1,0),s.lookAt(-1,0,0),i.add(s);var u=new Lr(Ar,1,e,r);u.layers=i.layers,u.up.set(0,0,-1),u.lookAt(0,1,0),i.add(u);var c=new Lr(Ar,1,e,r);c.layers=i.layers,c.up.set(0,0,1),c.lookAt(0,-1,0),i.add(c);var l=new Lr(Ar,1,e,r);l.layers=i.layers,l.up.set(0,1,0),l.lookAt(0,0,1),i.add(l);var d=new Lr(Ar,1,e,r);return d.layers=i.layers,d.up.set(0,1,0),d.lookAt(0,0,-1),i.add(d),i}return E(n,[{key:"update",value:function(e,t){null===this.parent&&this.updateMatrixWorld();var n=this.renderTarget,r=i(this.children,6),a=r[0],o=r[1],s=r[2],u=r[3],c=r[4],l=r[5],d=e.getRenderTarget(),h=e.toneMapping,p=e.xr.enabled;e.toneMapping=B,e.xr.enabled=!1;var f=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,a),e.setRenderTarget(n,1),e.render(t,o),e.setRenderTarget(n,2),e.render(t,s),e.setRenderTarget(n,3),e.render(t,u),e.setRenderTarget(n,4),e.render(t,c),n.texture.generateMipmaps=f,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(d),e.toneMapping=h,e.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}]),n}(Tn),Dr=function(e){m(n,e);var t=y(n);function n(e,r,a,i,o,s,u,c,l,d){var h;return T(this,n),e=void 0!==e?e:[],r=void 0!==r?r:Q,(h=t.call(this,e,r,a,i,o,s,u,c,l,d)).isCubeTexture=!0,h.flipY=!1,h}return E(n,[{key:"images",get:function(){return this.image},set:function(e){this.image=e}}]),n}(vt),Or=function(e){m(n,e);var t=y(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};T(this,n),(e=t.call(this,r,r,a)).isWebGLCubeRenderTarget=!0;var i={width:r,height:r,depth:1},o=[i,i,i,i,i,i];return void 0!==a.encoding&&(rt("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),a.colorSpace=a.encoding===Me?Le:Re),e.texture=new Dr(o,a.mapping,a.wrapS,a.wrapT,a.magFilter,a.minFilter,a.format,a.type,a.anisotropy,a.colorSpace),e.texture.isRenderTargetTexture=!0,e.texture.generateMipmaps=void 0!==a.generateMipmaps&&a.generateMipmaps,e.texture.minFilter=void 0!==a.minFilter?a.minFilter:se,e}return E(n,[{key:"fromEquirectangularTexture",value:function(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;var n={tEquirect:{value:null}},r="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",a="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",i=new _r(5,5,5),o=new Nr({name:"CubemapFromEquirect",uniforms:Ir(n),vertexShader:r,fragmentShader:a,side:z,blending:G});o.uniforms.tEquirect.value=t;var s=new Sr(i,o),u=t.minFilter;return t.minFilter===ce&&(t.minFilter=se),new Pr(1,10,this).update(e,s),t.minFilter=u,s.geometry.dispose(),s.material.dispose(),this}},{key:"clear",value:function(e,t,n,r){for(var a=e.getRenderTarget(),i=0;i<6;i++)e.setRenderTarget(this,i),e.clear(t,n,r);e.setRenderTarget(a)}}]),n}(yt),zr=new kt,Fr=new kt,Gr=new qe,Wr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new kt(1,0,0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;T(this,e),this.isPlane=!0,this.normal=t,this.constant=n}return E(e,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(e,t,n){var r=zr.subVectors(n,t).cross(Fr.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.constant*=-1,this.normal.negate(),this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}},{key:"intersectLine",value:function(e,t){var n=e.delta(zr),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;var a=-(e.start.dot(this.normal)+this.constant)/r;return a<0||a>1?null:t.copy(e.start).addScaledVector(n,a)}},{key:"intersectsLine",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}},{key:"intersectsBox",value:function(e){return e.intersectsPlane(this)}},{key:"intersectsSphere",value:function(e){return e.intersectsPlane(this)}},{key:"coplanarPoint",value:function(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:"applyMatrix4",value:function(e,t){var n=t||Gr.getNormalMatrix(e),r=this.coplanarPoint(zr).applyMatrix4(e),a=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(a),this}},{key:"translate",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),Vr=new Xt,Ur=new kt,Xr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Wr,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Wr,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Wr,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Wr,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Wr,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new Wr;T(this,e),this.planes=[t,n,r,a,i,o]}return E(e,[{key:"set",value:function(e,t,n,r,a,i){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(r),o[4].copy(a),o[5].copy(i),this}},{key:"copy",value:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this}},{key:"setFromProjectionMatrix",value:function(e){var t=this.planes,n=e.elements,r=n[0],a=n[1],i=n[2],o=n[3],s=n[4],u=n[5],c=n[6],l=n[7],d=n[8],h=n[9],p=n[10],f=n[11],m=n[12],v=n[13],g=n[14],y=n[15];return t[0].setComponents(o-r,l-s,f-d,y-m).normalize(),t[1].setComponents(o+r,l+s,f+d,y+m).normalize(),t[2].setComponents(o+a,l+u,f+h,y+v).normalize(),t[3].setComponents(o-a,l-u,f-h,y-v).normalize(),t[4].setComponents(o-i,l-c,f-p,y-g).normalize(),t[5].setComponents(o+i,l+c,f+p,y+g).normalize(),this}},{key:"intersectsObject",value:function(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),Vr.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{var t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),Vr.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Vr)}},{key:"intersectsSprite",value:function(e){return Vr.center.set(0,0,0),Vr.radius=.7071067811865476,Vr.applyMatrix4(e.matrixWorld),this.intersectsSphere(Vr)}},{key:"intersectsSphere",value:function(e){for(var t=this.planes,n=e.center,r=-e.radius,a=0;a<6;a++){if(t[a].distanceToPoint(n)<r)return!1}return!0}},{key:"intersectsBox",value:function(e){for(var t=this.planes,n=0;n<6;n++){var r=t[n];if(Ur.x=r.normal.x>0?e.max.x:e.min.x,Ur.y=r.normal.y>0?e.max.y:e.min.y,Ur.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Ur)<0)return!1}return!0}},{key:"containsPoint",value:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}();function Br(){var e=null,t=!1,n=null,r=null;function a(t,i){n(t,i),r=e.requestAnimationFrame(a)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(a),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function Hr(e,t){var n=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var n=r.get(t);n&&(e.deleteBuffer(n.buffer),r.delete(t))},update:function(t,a){if(t.isGLBufferAttribute){var i=r.get(t);(!i||i.version<t.version)&&r.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version})}else{t.isInterleavedBufferAttribute&&(t=t.data);var o=r.get(t);void 0===o?r.set(t,function(t,r){var a,i=t.array,o=t.usage,s=e.createBuffer();if(e.bindBuffer(r,s),e.bufferData(r,i,o),t.onUploadCallback(),i instanceof Float32Array)a=e.FLOAT;else if(i instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");a=e.HALF_FLOAT}else a=e.UNSIGNED_SHORT;else if(i instanceof Int16Array)a=e.SHORT;else if(i instanceof Uint32Array)a=e.UNSIGNED_INT;else if(i instanceof Int32Array)a=e.INT;else if(i instanceof Int8Array)a=e.BYTE;else if(i instanceof Uint8Array)a=e.UNSIGNED_BYTE;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+i);a=e.UNSIGNED_BYTE}return{buffer:s,type:a,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}(t,a)):o.version<t.version&&(!function(t,r,a){var i=r.array,o=r.updateRange;e.bindBuffer(a,t),-1===o.count?e.bufferSubData(a,0,i):(n?e.bufferSubData(a,o.offset*i.BYTES_PER_ELEMENT,i,o.offset,o.count):e.bufferSubData(a,o.offset*i.BYTES_PER_ELEMENT,i.subarray(o.offset,o.offset+o.count)),o.count=-1),r.onUploadCallback()}(o.buffer,t,a),o.version=t.version)}}}}var Zr=function(e){m(n,e);var t=y(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;T(this,n),(e=t.call(this)).type="PlaneGeometry",e.parameters={width:r,height:a,widthSegments:i,heightSegments:o};for(var s=r/2,u=a/2,c=Math.floor(i),l=Math.floor(o),d=c+1,h=l+1,p=r/c,f=a/l,m=[],v=[],g=[],y=[],b=0;b<h;b++)for(var x=b*f-u,w=0;w<d;w++){var k=w*p-s;v.push(k,-x,0),g.push(0,0,1),y.push(w/c),y.push(1-b/l)}for(var S=0;S<l;S++)for(var _=0;_<c;_++){var I=_+d*S,E=_+d*(S+1),C=_+1+d*(S+1),M=_+1+d*S;m.push(I,E,M),m.push(E,C,M)}return e.setIndex(m),e.setAttribute("position",new Jn(v,3)),e.setAttribute("normal",new Jn(g,3)),e.setAttribute("uv",new Jn(y,2)),e}return E(n,[{key:"copy",value:function(e){return N(v(n.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}}],[{key:"fromJSON",value:function(e){return new n(e.width,e.height,e.widthSegments,e.heightSegments)}}]),n}(ir),Kr={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, vMapUv );\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_NORMALMAP_TANGENTSPACE\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal, vNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#ifdef USE_UV\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},jr={common:{diffuse:{value:new Xn(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new qe},alphaMap:{value:null},alphaMapTransform:{value:new qe},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new qe}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new qe}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new qe}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new qe},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new qe},normalScale:{value:new Je(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new qe},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new qe}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new qe}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new qe}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Xn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Xn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new qe}},sprite:{diffuse:{value:new Xn(16777215)},opacity:{value:1},center:{value:new Je(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new qe},alphaMap:{value:null},alphaTest:{value:0}}},Yr={basic:{uniforms:Er([jr.common,jr.specularmap,jr.envmap,jr.aomap,jr.lightmap,jr.fog]),vertexShader:Kr.meshbasic_vert,fragmentShader:Kr.meshbasic_frag},lambert:{uniforms:Er([jr.common,jr.specularmap,jr.envmap,jr.aomap,jr.lightmap,jr.emissivemap,jr.bumpmap,jr.normalmap,jr.displacementmap,jr.fog,jr.lights,{emissive:{value:new Xn(0)}}]),vertexShader:Kr.meshlambert_vert,fragmentShader:Kr.meshlambert_frag},phong:{uniforms:Er([jr.common,jr.specularmap,jr.envmap,jr.aomap,jr.lightmap,jr.emissivemap,jr.bumpmap,jr.normalmap,jr.displacementmap,jr.fog,jr.lights,{emissive:{value:new Xn(0)},specular:{value:new Xn(1118481)},shininess:{value:30}}]),vertexShader:Kr.meshphong_vert,fragmentShader:Kr.meshphong_frag},standard:{uniforms:Er([jr.common,jr.envmap,jr.aomap,jr.lightmap,jr.emissivemap,jr.bumpmap,jr.normalmap,jr.displacementmap,jr.roughnessmap,jr.metalnessmap,jr.fog,jr.lights,{emissive:{value:new Xn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Kr.meshphysical_vert,fragmentShader:Kr.meshphysical_frag},toon:{uniforms:Er([jr.common,jr.aomap,jr.lightmap,jr.emissivemap,jr.bumpmap,jr.normalmap,jr.displacementmap,jr.gradientmap,jr.fog,jr.lights,{emissive:{value:new Xn(0)}}]),vertexShader:Kr.meshtoon_vert,fragmentShader:Kr.meshtoon_frag},matcap:{uniforms:Er([jr.common,jr.bumpmap,jr.normalmap,jr.displacementmap,jr.fog,{matcap:{value:null}}]),vertexShader:Kr.meshmatcap_vert,fragmentShader:Kr.meshmatcap_frag},points:{uniforms:Er([jr.points,jr.fog]),vertexShader:Kr.points_vert,fragmentShader:Kr.points_frag},dashed:{uniforms:Er([jr.common,jr.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Kr.linedashed_vert,fragmentShader:Kr.linedashed_frag},depth:{uniforms:Er([jr.common,jr.displacementmap]),vertexShader:Kr.depth_vert,fragmentShader:Kr.depth_frag},normal:{uniforms:Er([jr.common,jr.bumpmap,jr.normalmap,jr.displacementmap,{opacity:{value:1}}]),vertexShader:Kr.meshnormal_vert,fragmentShader:Kr.meshnormal_frag},sprite:{uniforms:Er([jr.sprite,jr.fog]),vertexShader:Kr.sprite_vert,fragmentShader:Kr.sprite_frag},background:{uniforms:{uvTransform:{value:new qe},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Kr.background_vert,fragmentShader:Kr.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Kr.backgroundCube_vert,fragmentShader:Kr.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Kr.cube_vert,fragmentShader:Kr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Kr.equirect_vert,fragmentShader:Kr.equirect_frag},distanceRGBA:{uniforms:Er([jr.common,jr.displacementmap,{referencePosition:{value:new kt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Kr.distanceRGBA_vert,fragmentShader:Kr.distanceRGBA_frag},shadow:{uniforms:Er([jr.lights,jr.fog,{color:{value:new Xn(0)},opacity:{value:1}}]),vertexShader:Kr.shadow_vert,fragmentShader:Kr.shadow_frag}};Yr.physical={uniforms:Er([Yr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new qe},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new qe},clearcoatNormalScale:{value:new Je(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new qe},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new qe},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new qe},sheen:{value:0},sheenColor:{value:new Xn(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new qe},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new qe},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new qe},transmissionSamplerSize:{value:new Je},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new qe},attenuationDistance:{value:0},attenuationColor:{value:new Xn(0)},specularColor:{value:new Xn(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new qe},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new qe}}]),vertexShader:Kr.meshphysical_vert,fragmentShader:Kr.meshphysical_frag};var Qr={r:0,b:0,g:0};function Jr(e,t,n,r,a,i,o){var s,u,c=new Xn(0),l=!0===i?0:1,d=null,h=0,p=null;function f(t,n){t.getRGB(Qr,Cr(e)),r.buffers.color.setClear(Qr.r,Qr.g,Qr.b,n,o)}return{getClearColor:function(){return c},setClearColor:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;c.set(e),f(c,l=t)},getClearAlpha:function(){return l},setClearAlpha:function(e){f(c,l=e)},render:function(i,m){var v=!1,g=!0===m.isScene?m.background:null;switch(g&&g.isTexture&&(g=(m.backgroundBlurriness>0?n:t).get(g)),null===g?f(c,l):g&&g.isColor&&(f(g,1),v=!0),e.xr.getEnvironmentBlendMode()){case"opaque":v=!0;break;case"additive":r.buffers.color.setClear(0,0,0,1,o),v=!0;break;case"alpha-blend":r.buffers.color.setClear(0,0,0,0,o),v=!0}(e.autoClear||v)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),g&&(g.isCubeTexture||g.mapping===ee)?(void 0===u&&((u=new Sr(new _r(1,1,1),new Nr({name:"BackgroundCubeMaterial",uniforms:Ir(Yr.backgroundCube.uniforms),vertexShader:Yr.backgroundCube.vertexShader,fragmentShader:Yr.backgroundCube.fragmentShader,side:z,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),a.update(u)),u.material.uniforms.envMap.value=g,u.material.uniforms.flipEnvMap.value=g.isCubeTexture&&!1===g.isRenderTargetTexture?-1:1,u.material.uniforms.backgroundBlurriness.value=m.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,u.material.toneMapped=g.colorSpace!==Le,d===g&&h===g.version&&p===e.toneMapping||(u.material.needsUpdate=!0,d=g,h=g.version,p=e.toneMapping),u.layers.enableAll(),i.unshift(u,u.geometry,u.material,0,0,null)):g&&g.isTexture&&(void 0===s&&((s=new Sr(new Zr(2,2),new Nr({name:"BackgroundMaterial",uniforms:Ir(Yr.background.uniforms),vertexShader:Yr.background.vertexShader,fragmentShader:Yr.background.fragmentShader,side:O,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(s.material,"map",{get:function(){return this.uniforms.t2D.value}}),a.update(s)),s.material.uniforms.t2D.value=g,s.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,s.material.toneMapped=g.colorSpace!==Le,!0===g.matrixAutoUpdate&&g.updateMatrix(),s.material.uniforms.uvTransform.value.copy(g.matrix),d===g&&h===g.version&&p===e.toneMapping||(s.material.needsUpdate=!0,d=g,h=g.version,p=e.toneMapping),s.layers.enableAll(),i.unshift(s,s.geometry,s.material,0,0,null))}}}function qr(e,t,n,r){var a=e.getParameter(e.MAX_VERTEX_ATTRIBS),i=r.isWebGL2?null:t.get("OES_vertex_array_object"),o=r.isWebGL2||null!==i,s={},u=p(null),c=u,l=!1;function d(t){return r.isWebGL2?e.bindVertexArray(t):i.bindVertexArrayOES(t)}function h(t){return r.isWebGL2?e.deleteVertexArray(t):i.deleteVertexArrayOES(t)}function p(e){for(var t=[],n=[],r=[],i=0;i<a;i++)t[i]=0,n[i]=0,r[i]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:r,object:e,attributes:{},index:null}}function f(){for(var e=c.newAttributes,t=0,n=e.length;t<n;t++)e[t]=0}function m(e){v(e,0)}function v(n,a){var i=c.newAttributes,o=c.enabledAttributes,s=c.attributeDivisors;(i[n]=1,0===o[n]&&(e.enableVertexAttribArray(n),o[n]=1),s[n]!==a)&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,a),s[n]=a)}function g(){for(var t=c.newAttributes,n=c.enabledAttributes,r=0,a=n.length;r<a;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function y(t,n,a,i,o,s){!0!==r.isWebGL2||a!==e.INT&&a!==e.UNSIGNED_INT?e.vertexAttribPointer(t,n,a,i,o,s):e.vertexAttribIPointer(t,n,a,o,s)}function b(){x(),l=!0,c!==u&&d((c=u).object)}function x(){u.geometry=null,u.program=null,u.wireframe=!1}return{setup:function(a,u,h,b,x){var w=!1;if(o){var k=function(t,n,a){var o=!0===a.wireframe,u=s[t.id];void 0===u&&(u={},s[t.id]=u);var c=u[n.id];void 0===c&&(c={},u[n.id]=c);var l=c[o];void 0===l&&(l=p(r.isWebGL2?e.createVertexArray():i.createVertexArrayOES()),c[o]=l);return l}(b,h,u);c!==k&&d((c=k).object),w=function(e,t,n,r){var a=c.attributes,i=t.attributes,o=0,s=n.getAttributes();for(var u in s){if(s[u].location>=0){var l=a[u],d=i[u];if(void 0===d&&("instanceMatrix"===u&&e.instanceMatrix&&(d=e.instanceMatrix),"instanceColor"===u&&e.instanceColor&&(d=e.instanceColor)),void 0===l)return!0;if(l.attribute!==d)return!0;if(d&&l.data!==d.data)return!0;o++}}return c.attributesNum!==o||c.index!==r}(a,b,h,x),w&&function(e,t,n,r){var a={},i=t.attributes,o=0,s=n.getAttributes();for(var u in s){if(s[u].location>=0){var l=i[u];void 0===l&&("instanceMatrix"===u&&e.instanceMatrix&&(l=e.instanceMatrix),"instanceColor"===u&&e.instanceColor&&(l=e.instanceColor));var d={};d.attribute=l,l&&l.data&&(d.data=l.data),a[u]=d,o++}}c.attributes=a,c.attributesNum=o,c.index=r}(a,b,h,x)}else{var S=!0===u.wireframe;c.geometry===b.id&&c.program===h.id&&c.wireframe===S||(c.geometry=b.id,c.program=h.id,c.wireframe=S,w=!0)}null!==x&&n.update(x,e.ELEMENT_ARRAY_BUFFER),(w||l)&&(l=!1,function(a,i,o,s){if(!1===r.isWebGL2&&(a.isInstancedMesh||s.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;f();var u=s.attributes,c=o.getAttributes(),l=i.defaultAttributeValues;for(var d in c){var h=c[d];if(h.location>=0){var p=u[d];if(void 0===p&&("instanceMatrix"===d&&a.instanceMatrix&&(p=a.instanceMatrix),"instanceColor"===d&&a.instanceColor&&(p=a.instanceColor)),void 0!==p){var b=p.normalized,x=p.itemSize,w=n.get(p);if(void 0===w)continue;var k=w.buffer,S=w.type,T=w.bytesPerElement;if(p.isInterleavedBufferAttribute){var _=p.data,I=_.stride,E=p.offset;if(_.isInstancedInterleavedBuffer){for(var C=0;C<h.locationSize;C++)v(h.location+C,_.meshPerAttribute);!0!==a.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=_.meshPerAttribute*_.count)}else for(var M=0;M<h.locationSize;M++)m(h.location+M);e.bindBuffer(e.ARRAY_BUFFER,k);for(var N=0;N<h.locationSize;N++)y(h.location+N,x/h.locationSize,S,b,I*T,(E+x/h.locationSize*N)*T)}else{if(p.isInstancedBufferAttribute){for(var R=0;R<h.locationSize;R++)v(h.location+R,p.meshPerAttribute);!0!==a.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=p.meshPerAttribute*p.count)}else for(var L=0;L<h.locationSize;L++)m(h.location+L);e.bindBuffer(e.ARRAY_BUFFER,k);for(var A=0;A<h.locationSize;A++)y(h.location+A,x/h.locationSize,S,b,x*T,x/h.locationSize*A*T)}}else if(void 0!==l){var P=l[d];if(void 0!==P)switch(P.length){case 2:e.vertexAttrib2fv(h.location,P);break;case 3:e.vertexAttrib3fv(h.location,P);break;case 4:e.vertexAttrib4fv(h.location,P);break;default:e.vertexAttrib1fv(h.location,P)}}}}g()}(a,u,h,b),null!==x&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.get(x).buffer))},reset:b,resetDefaultState:x,dispose:function(){for(var e in b(),s){var t=s[e];for(var n in t){var r=t[n];for(var a in r)h(r[a].object),delete r[a];delete t[n]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0!==s[e.id]){var t=s[e.id];for(var n in t){var r=t[n];for(var a in r)h(r[a].object),delete r[a];delete t[n]}delete s[e.id]}},releaseStatesOfProgram:function(e){for(var t in s){var n=s[t];if(void 0!==n[e.id]){var r=n[e.id];for(var a in r)h(r[a].object),delete r[a];delete n[e.id]}}},initAttributes:f,enableAttribute:m,disableUnusedAttributes:g}}function $r(e,t,n,r){var a,i=r.isWebGL2;this.setMode=function(e){a=e},this.render=function(t,r){e.drawArrays(a,t,r),n.update(r,a,1)},this.renderInstances=function(r,o,s){if(0!==s){var u,c;if(i)u=e,c="drawArraysInstanced";else if(c="drawArraysInstancedANGLE",null===(u=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[c](a,r,o,s),n.update(o,a,s)}}}function ea(e,t,n){var r;function a(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var i="undefined"!==typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===e.constructor.name,o=void 0!==n.precision?n.precision:"highp",s=a(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var u=i||t.has("WEBGL_draw_buffers"),c=!0===n.logarithmicDepthBuffer,l=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_TEXTURE_SIZE),p=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),f=e.getParameter(e.MAX_VERTEX_ATTRIBS),m=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),v=e.getParameter(e.MAX_VARYING_VECTORS),g=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),y=d>0,b=i||t.has("OES_texture_float");return{isWebGL2:i,drawBuffers:u,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===t.has("EXT_texture_filter_anisotropic")){var n=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:a,precision:o,logarithmicDepthBuffer:c,maxTextures:l,maxVertexTextures:d,maxTextureSize:h,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:v,maxFragmentUniforms:g,vertexTextures:y,floatFragmentTextures:b,floatVertexTextures:y&&b,maxSamples:i?e.getParameter(e.MAX_SAMPLES):0}}function ta(e){var t=this,n=null,r=0,a=!1,i=!1,o=new Wr,s=new qe,u={value:null,needsUpdate:!1};function c(e,n,r,a){var i=null!==e?e.length:0,c=null;if(0!==i){if(c=u.value,!0!==a||null===c){var l=r+4*i,d=n.matrixWorldInverse;s.getNormalMatrix(d),(null===c||c.length<l)&&(c=new Float32Array(l));for(var h=0,p=r;h!==i;++h,p+=4)o.copy(e[h]).applyMatrix4(d,s),o.normal.toArray(c,p),c[p+3]=o.constant}u.value=c,u.needsUpdate=!0}return t.numPlanes=i,t.numIntersection=0,c}this.uniform=u,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){var n=0!==e.length||t||0!==r||a;return a=t,r=e.length,n},this.beginShadows=function(){i=!0,c(null)},this.endShadows=function(){i=!1},this.setGlobalState=function(e,t){n=c(e,t,0)},this.setState=function(o,s,l){var d=o.clippingPlanes,h=o.clipIntersection,p=o.clipShadows,f=e.get(o);if(!a||null===d||0===d.length||i&&!p)i?c(null):function(){u.value!==n&&(u.value=n,u.needsUpdate=r>0);t.numPlanes=r,t.numIntersection=0}();else{var m=i?0:r,v=4*m,g=f.clippingState||null;u.value=g,g=c(d,s,v,l);for(var y=0;y!==v;++y)g[y]=n[y];f.clippingState=g,this.numIntersection=h?this.numPlanes:0,this.numPlanes+=m}}}function na(e){var t=new WeakMap;function n(e,t){return t===q?e.mapping=Q:t===$&&(e.mapping=J),e}function r(e){var n=e.target;n.removeEventListener("dispose",r);var a=t.get(n);void 0!==a&&(t.delete(n),a.dispose())}return{get:function(a){if(a&&a.isTexture&&!1===a.isRenderTargetTexture){var i=a.mapping;if(i===q||i===$){if(t.has(a))return n(t.get(a).texture,a.mapping);var o=a.image;if(o&&o.height>0){var s=new Or(o.height/2);return s.fromEquirectangularTexture(e,a),t.set(a,s),a.addEventListener("dispose",r),n(s.texture,a.mapping)}return null}}return a},dispose:function(){t=new WeakMap}}}var ra=function(e){m(n,e);var t=y(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;return T(this,n),(e=t.call(this)).isOrthographicCamera=!0,e.type="OrthographicCamera",e.zoom=1,e.view=null,e.left=r,e.right=a,e.top=i,e.bottom=o,e.near=s,e.far=u,e.updateProjectionMatrix(),e}return E(n,[{key:"copy",value:function(e,t){return N(v(n.prototype),"copy",this).call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}},{key:"setViewOffset",value:function(e,t,n,r,a,i){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=a,this.view.height=i,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,a=n-e,i=n+e,o=r+t,s=r-t;if(null!==this.view&&this.view.enabled){var u=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i=(a+=u*this.view.offsetX)+u*this.view.width,s=(o-=c*this.view.offsetY)-c*this.view.height}this.projectionMatrix.makeOrthographic(a,i,o,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(e){var t=N(v(n.prototype),"toJSON",this).call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}]),n}(Rr),aa=4,ia=[.125,.215,.35,.446,.526,.582],oa=20,sa=new ra,ua=new Xn,ca=null,la=(1+Math.sqrt(5))/2,da=1/la,ha=[new kt(1,1,1),new kt(-1,1,1),new kt(1,1,-1),new kt(-1,1,-1),new kt(0,la,da),new kt(0,la,-da),new kt(da,0,la),new kt(-da,0,la),new kt(la,da,0),new kt(-la,da,0)],pa=function(){function e(t){T(this,e),this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}return E(e,[{key:"fromScene",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;ca=this._renderer.getRenderTarget(),this._setSize(256);var a=this._allocateTargets();return a.depthBuffer=!0,this._sceneToCubeUV(e,n,r,a),t>0&&this._blur(a,0,0,t),this._applyPMREM(a),this._cleanup(a),a}},{key:"fromEquirectangular",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}},{key:"fromCubemap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}},{key:"compileCubemapShader",value:function(){null===this._cubemapMaterial&&(this._cubemapMaterial=ga(),this._compileMaterial(this._cubemapMaterial))}},{key:"compileEquirectangularShader",value:function(){null===this._equirectMaterial&&(this._equirectMaterial=va(),this._compileMaterial(this._equirectMaterial))}},{key:"dispose",value:function(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}},{key:"_setSize",value:function(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}},{key:"_dispose",value:function(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(var e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}},{key:"_cleanup",value:function(e){this._renderer.setRenderTarget(ca),e.scissorTest=!1,ma(e,0,0,e.width,e.height)}},{key:"_fromTexture",value:function(e,t){e.mapping===Q||e.mapping===J?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),ca=this._renderer.getRenderTarget();var n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}},{key:"_allocateTargets",value:function(){var e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:se,minFilter:se,generateMipmaps:!1,type:pe,format:me,colorSpace:Ae,depthBuffer:!1},r=fa(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=fa(e,t,n);var a=this._lodMax,i=function(e){for(var t=[],n=[],r=[],a=e,i=e-aa+1+ia.length,o=0;o<i;o++){var s=Math.pow(2,a);n.push(s);var u=1/s;o>e-aa?u=ia[o-e+aa-1]:0===o&&(u=0),r.push(u);for(var c=1/(s-2),l=-c,d=1+c,h=[l,l,d,l,d,d,l,l,d,d,l,d],p=6,f=6,m=3,v=2,g=1,y=new Float32Array(m*f*p),b=new Float32Array(v*f*p),x=new Float32Array(g*f*p),w=0;w<p;w++){var k=w%3*2/3-1,S=w>2?0:-1,T=[k,S,0,k+2/3,S,0,k+2/3,S+1,0,k,S,0,k+2/3,S+1,0,k,S+1,0];y.set(T,m*f*w),b.set(h,v*f*w);var _=[w,w,w,w,w,w];x.set(_,g*f*w)}var I=new ir;I.setAttribute("position",new jn(y,m)),I.setAttribute("uv",new jn(b,v)),I.setAttribute("faceIndex",new jn(x,g)),t.push(I),a>aa&&a--}return{lodPlanes:t,sizeLods:n,sigmas:r}}(a);this._sizeLods=i.sizeLods,this._lodPlanes=i.lodPlanes,this._sigmas=i.sigmas,this._blurMaterial=function(e,t,n){var r=new Float32Array(oa),a=new kt(0,1,0),i=new Nr({name:"SphericalGaussianBlur",defines:{n:oa,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:"".concat(e,".0")},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:a}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:G,depthTest:!1,depthWrite:!1});return i}(a,e,t)}return r}},{key:"_compileMaterial",value:function(e){var t=new Sr(this._lodPlanes[0],e);this._renderer.compile(t,sa)}},{key:"_sceneToCubeUV",value:function(e,t,n,r){var a=new Lr(90,1,t,n),i=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,u=s.autoClear,c=s.toneMapping;s.getClearColor(ua),s.toneMapping=B,s.autoClear=!1;var l=new Hn({name:"PMREM.Background",side:z,depthWrite:!1,depthTest:!1}),d=new Sr(new _r,l),h=!1,p=e.background;p?p.isColor&&(l.color.copy(p),e.background=null,h=!0):(l.color.copy(ua),h=!0);for(var f=0;f<6;f++){var m=f%3;0===m?(a.up.set(0,i[f],0),a.lookAt(o[f],0,0)):1===m?(a.up.set(0,0,i[f]),a.lookAt(0,o[f],0)):(a.up.set(0,i[f],0),a.lookAt(0,0,o[f]));var v=this._cubeSize;ma(r,m*v,f>2?v:0,v,v),s.setRenderTarget(r),h&&s.render(d,a),s.render(e,a)}d.geometry.dispose(),d.material.dispose(),s.toneMapping=c,s.autoClear=u,e.background=p}},{key:"_textureToCubeUV",value:function(e,t){var n=this._renderer,r=e.mapping===Q||e.mapping===J;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=ga()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=va());var a=r?this._cubemapMaterial:this._equirectMaterial,i=new Sr(this._lodPlanes[0],a);a.uniforms.envMap.value=e;var o=this._cubeSize;ma(t,0,0,3*o,2*o),n.setRenderTarget(t),n.render(i,sa)}},{key:"_applyPMREM",value:function(e){var t=this._renderer,n=t.autoClear;t.autoClear=!1;for(var r=1;r<this._lodPlanes.length;r++){var a=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),i=ha[(r-1)%ha.length];this._blur(e,r-1,r,a,i)}t.autoClear=n}},{key:"_blur",value:function(e,t,n,r,a){var i=this._pingPongRenderTarget;this._halfBlur(e,i,t,n,r,"latitudinal",a),this._halfBlur(i,e,n,n,r,"longitudinal",a)}},{key:"_halfBlur",value:function(e,t,n,r,a,i,o){var s=this._renderer,u=this._blurMaterial;"latitudinal"!==i&&"longitudinal"!==i&&console.error("blur direction must be either latitudinal or longitudinal!");var c=new Sr(this._lodPlanes[r],u),l=u.uniforms,d=this._sizeLods[n]-1,h=isFinite(a)?Math.PI/(2*d):2*Math.PI/(2*oa-1),p=a/h,f=isFinite(a)?1+Math.floor(3*p):oa;f>oa&&console.warn("sigmaRadians, ".concat(a,", is too large and will clip, as it requested ").concat(f," samples when the maximum is set to ").concat(oa));for(var m=[],v=0,g=0;g<oa;++g){var y=g/p,b=Math.exp(-y*y/2);m.push(b),0===g?v+=b:g<f&&(v+=2*b)}for(var x=0;x<m.length;x++)m[x]=m[x]/v;l.envMap.value=e.texture,l.samples.value=f,l.weights.value=m,l.latitudinal.value="latitudinal"===i,o&&(l.poleAxis.value=o);var w=this._lodMax;l.dTheta.value=h,l.mipInt.value=w-n;var k=this._sizeLods[r];ma(t,3*k*(r>w-aa?r-w+aa:0),4*(this._cubeSize-k),3*k,2*k),s.setRenderTarget(t),s.render(c,sa)}}]),e}();function fa(e,t,n){var r=new yt(e,t,n);return r.texture.mapping=ee,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function ma(e,t,n,r,a){e.viewport.set(t,n,r,a),e.scissor.set(t,n,r,a)}function va(){return new Nr({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:G,depthTest:!1,depthWrite:!1})}function ga(){return new Nr({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:G,depthTest:!1,depthWrite:!1})}function ya(e){var t=new WeakMap,n=null;function r(e){var n=e.target;n.removeEventListener("dispose",r);var a=t.get(n);void 0!==a&&(t.delete(n),a.dispose())}return{get:function(a){if(a&&a.isTexture){var i=a.mapping,o=i===q||i===$,s=i===Q||i===J;if(o||s){if(a.isRenderTargetTexture&&!0===a.needsPMREMUpdate){a.needsPMREMUpdate=!1;var u=t.get(a);return null===n&&(n=new pa(e)),u=o?n.fromEquirectangular(a,u):n.fromCubemap(a,u),t.set(a,u),u.texture}if(t.has(a))return t.get(a).texture;var c=a.image;if(o&&c&&c.height>0||s&&c&&function(e){for(var t=0,n=6,r=0;r<n;r++)void 0!==e[r]&&t++;return t===n}(c)){null===n&&(n=new pa(e));var l=o?n.fromEquirectangular(a):n.fromCubemap(a);return t.set(a,l),a.addEventListener("dispose",r),l.texture}return null}}return a},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function ba(e){var t={};function n(n){if(void 0!==t[n])return t[n];var r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){var t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function xa(e,t,n,r){var a={},i=new WeakMap;function o(e){var s=e.target;for(var u in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[u]);s.removeEventListener("dispose",o),delete a[s.id];var c=i.get(s);c&&(t.remove(c),i.delete(s)),r.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){var n=[],r=e.index,a=e.attributes.position,o=0;if(null!==r){var s=r.array;o=r.version;for(var u=0,c=s.length;u<c;u+=3){var l=s[u+0],d=s[u+1],h=s[u+2];n.push(l,d,d,h,h,l)}}else{var p=a.array;o=a.version;for(var f=0,m=p.length/3-1;f<m;f+=3){var v=f+0,g=f+1,y=f+2;n.push(v,g,g,y,y,v)}}var b=new(et(n)?Qn:Yn)(n,1);b.version=o;var x=i.get(e);x&&t.remove(x),i.set(e,b)}return{get:function(e,t){return!0===a[t.id]||(t.addEventListener("dispose",o),a[t.id]=!0,n.memory.geometries++),t},update:function(n){var r=n.attributes;for(var a in r)t.update(r[a],e.ARRAY_BUFFER);var i=n.morphAttributes;for(var o in i)for(var s=i[o],u=0,c=s.length;u<c;u++)t.update(s[u],e.ARRAY_BUFFER)},getWireframeAttribute:function(e){var t=i.get(e);if(t){var n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return i.get(e)}}}function wa(e,t,n,r){var a,i,o,s=r.isWebGL2;this.setMode=function(e){a=e},this.setIndex=function(e){i=e.type,o=e.bytesPerElement},this.render=function(t,r){e.drawElements(a,r,i,t*o),n.update(r,a,1)},this.renderInstances=function(r,u,c){if(0!==c){var l,d;if(s)l=e,d="drawElementsInstanced";else if(d="drawElementsInstancedANGLE",null===(l=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[d](a,u,i,r*o,c),n.update(u,a,c)}}}function ka(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,r,a){switch(t.calls++,r){case e.TRIANGLES:t.triangles+=a*(n/3);break;case e.LINES:t.lines+=a*(n/2);break;case e.LINE_STRIP:t.lines+=a*(n-1);break;case e.LINE_LOOP:t.lines+=a*n;break;case e.POINTS:t.points+=a*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function Sa(e,t){return e[0]-t[0]}function Ta(e,t){return Math.abs(t[1])-Math.abs(e[1])}function _a(e,t,n){for(var r={},a=new Float32Array(8),i=new WeakMap,o=new gt,s=[],u=0;u<8;u++)s[u]=[u,0];return{update:function(u,c,l){var d=u.morphTargetInfluences;if(!0===t.isWebGL2){var h=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,p=void 0!==h?h.length:0,f=i.get(c);if(void 0===f||f.count!==p){void 0!==f&&f.texture.dispose();var m=void 0!==c.morphAttributes.position,v=void 0!==c.morphAttributes.normal,g=void 0!==c.morphAttributes.color,y=c.morphAttributes.position||[],b=c.morphAttributes.normal||[],x=c.morphAttributes.color||[],w=0;!0===m&&(w=1),!0===v&&(w=2),!0===g&&(w=3);var k=c.attributes.position.count*w,S=1;k>t.maxTextureSize&&(S=Math.ceil(k/t.maxTextureSize),k=t.maxTextureSize);var T=new Float32Array(k*S*4*p),_=new bt(T,k,S,p);_.type=he,_.needsUpdate=!0;for(var I=4*w,E=0;E<p;E++)for(var C=y[E],M=b[E],N=x[E],R=k*S*4*E,L=0;L<C.count;L++){var A=L*I;!0===m&&(o.fromBufferAttribute(C,L),T[R+A+0]=o.x,T[R+A+1]=o.y,T[R+A+2]=o.z,T[R+A+3]=0),!0===v&&(o.fromBufferAttribute(M,L),T[R+A+4]=o.x,T[R+A+5]=o.y,T[R+A+6]=o.z,T[R+A+7]=0),!0===g&&(o.fromBufferAttribute(N,L),T[R+A+8]=o.x,T[R+A+9]=o.y,T[R+A+10]=o.z,T[R+A+11]=4===N.itemSize?o.w:1)}f={count:p,texture:_,size:new Je(k,S)},i.set(c,f),c.addEventListener("dispose",(function e(){_.dispose(),i.delete(c),c.removeEventListener("dispose",e)}))}for(var P=0,D=0;D<d.length;D++)P+=d[D];var O=c.morphTargetsRelative?1:1-P;l.getUniforms().setValue(e,"morphTargetBaseInfluence",O),l.getUniforms().setValue(e,"morphTargetInfluences",d),l.getUniforms().setValue(e,"morphTargetsTexture",f.texture,n),l.getUniforms().setValue(e,"morphTargetsTextureSize",f.size)}else{var z=void 0===d?0:d.length,F=r[c.id];if(void 0===F||F.length!==z){F=[];for(var G=0;G<z;G++)F[G]=[G,0];r[c.id]=F}for(var W=0;W<z;W++){var V=F[W];V[0]=W,V[1]=d[W]}F.sort(Ta);for(var U=0;U<8;U++)U<z&&F[U][1]?(s[U][0]=F[U][0],s[U][1]=F[U][1]):(s[U][0]=Number.MAX_SAFE_INTEGER,s[U][1]=0);s.sort(Sa);for(var X=c.morphAttributes.position,B=c.morphAttributes.normal,H=0,Z=0;Z<8;Z++){var K=s[Z],j=K[0],Y=K[1];j!==Number.MAX_SAFE_INTEGER&&Y?(X&&c.getAttribute("morphTarget"+Z)!==X[j]&&c.setAttribute("morphTarget"+Z,X[j]),B&&c.getAttribute("morphNormal"+Z)!==B[j]&&c.setAttribute("morphNormal"+Z,B[j]),a[Z]=Y,H+=Y):(X&&!0===c.hasAttribute("morphTarget"+Z)&&c.deleteAttribute("morphTarget"+Z),B&&!0===c.hasAttribute("morphNormal"+Z)&&c.deleteAttribute("morphNormal"+Z),a[Z]=0)}var Q=c.morphTargetsRelative?1:1-H;l.getUniforms().setValue(e,"morphTargetBaseInfluence",Q),l.getUniforms().setValue(e,"morphTargetInfluences",a)}}}}function Ia(e,t,n,r){var a=new WeakMap;function i(e){var t=e.target;t.removeEventListener("dispose",i),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(o){var s=r.render.frame,u=o.geometry,c=t.get(o,u);return a.get(c)!==s&&(t.update(c),a.set(c,s)),o.isInstancedMesh&&(!1===o.hasEventListener("dispose",i)&&o.addEventListener("dispose",i),n.update(o.instanceMatrix,e.ARRAY_BUFFER),null!==o.instanceColor&&n.update(o.instanceColor,e.ARRAY_BUFFER)),c},dispose:function(){a=new WeakMap}}}var Ea=new vt,Ca=new bt,Ma=new xt,Na=new Dr,Ra=[],La=[],Aa=new Float32Array(16),Pa=new Float32Array(9),Da=new Float32Array(4);function Oa(e,t,n){var r=e[0];if(r<=0||r>0)return e;var a=t*n,i=Ra[a];if(void 0===i&&(i=new Float32Array(a),Ra[a]=i),0!==t){r.toArray(i,0);for(var o=1,s=0;o!==t;++o)s+=n,e[o].toArray(i,s)}return i}function za(e,t){if(e.length!==t.length)return!1;for(var n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function Fa(e,t){for(var n=0,r=t.length;n<r;n++)e[n]=t[n]}function Ga(e,t){var n=La[t];void 0===n&&(n=new Int32Array(t),La[t]=n);for(var r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function Wa(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function Va(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(za(n,t))return;e.uniform2fv(this.addr,t),Fa(n,t)}}function Ua(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(za(n,t))return;e.uniform3fv(this.addr,t),Fa(n,t)}}function Xa(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(za(n,t))return;e.uniform4fv(this.addr,t),Fa(n,t)}}function Ba(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(za(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),Fa(n,t)}else{if(za(n,r))return;Da.set(r),e.uniformMatrix2fv(this.addr,!1,Da),Fa(n,r)}}function Ha(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(za(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),Fa(n,t)}else{if(za(n,r))return;Pa.set(r),e.uniformMatrix3fv(this.addr,!1,Pa),Fa(n,r)}}function Za(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(za(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),Fa(n,t)}else{if(za(n,r))return;Aa.set(r),e.uniformMatrix4fv(this.addr,!1,Aa),Fa(n,r)}}function Ka(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function ja(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(za(n,t))return;e.uniform2iv(this.addr,t),Fa(n,t)}}function Ya(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(za(n,t))return;e.uniform3iv(this.addr,t),Fa(n,t)}}function Qa(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(za(n,t))return;e.uniform4iv(this.addr,t),Fa(n,t)}}function Ja(e,t){var n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function qa(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(za(n,t))return;e.uniform2uiv(this.addr,t),Fa(n,t)}}function $a(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(za(n,t))return;e.uniform3uiv(this.addr,t),Fa(n,t)}}function ei(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(za(n,t))return;e.uniform4uiv(this.addr,t),Fa(n,t)}}function ti(e,t,n){var r=this.cache,a=n.allocateTextureUnit();r[0]!==a&&(e.uniform1i(this.addr,a),r[0]=a),n.setTexture2D(t||Ea,a)}function ni(e,t,n){var r=this.cache,a=n.allocateTextureUnit();r[0]!==a&&(e.uniform1i(this.addr,a),r[0]=a),n.setTexture3D(t||Ma,a)}function ri(e,t,n){var r=this.cache,a=n.allocateTextureUnit();r[0]!==a&&(e.uniform1i(this.addr,a),r[0]=a),n.setTextureCube(t||Na,a)}function ai(e,t,n){var r=this.cache,a=n.allocateTextureUnit();r[0]!==a&&(e.uniform1i(this.addr,a),r[0]=a),n.setTexture2DArray(t||Ca,a)}function ii(e,t){e.uniform1fv(this.addr,t)}function oi(e,t){var n=Oa(t,this.size,2);e.uniform2fv(this.addr,n)}function si(e,t){var n=Oa(t,this.size,3);e.uniform3fv(this.addr,n)}function ui(e,t){var n=Oa(t,this.size,4);e.uniform4fv(this.addr,n)}function ci(e,t){var n=Oa(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function li(e,t){var n=Oa(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function di(e,t){var n=Oa(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function hi(e,t){e.uniform1iv(this.addr,t)}function pi(e,t){e.uniform2iv(this.addr,t)}function fi(e,t){e.uniform3iv(this.addr,t)}function mi(e,t){e.uniform4iv(this.addr,t)}function vi(e,t){e.uniform1uiv(this.addr,t)}function gi(e,t){e.uniform2uiv(this.addr,t)}function yi(e,t){e.uniform3uiv(this.addr,t)}function bi(e,t){e.uniform4uiv(this.addr,t)}function xi(e,t,n){var r=this.cache,a=t.length,i=Ga(n,a);za(r,i)||(e.uniform1iv(this.addr,i),Fa(r,i));for(var o=0;o!==a;++o)n.setTexture2D(t[o]||Ea,i[o])}function wi(e,t,n){var r=this.cache,a=t.length,i=Ga(n,a);za(r,i)||(e.uniform1iv(this.addr,i),Fa(r,i));for(var o=0;o!==a;++o)n.setTexture3D(t[o]||Ma,i[o])}function ki(e,t,n){var r=this.cache,a=t.length,i=Ga(n,a);za(r,i)||(e.uniform1iv(this.addr,i),Fa(r,i));for(var o=0;o!==a;++o)n.setTextureCube(t[o]||Na,i[o])}function Si(e,t,n){var r=this.cache,a=t.length,i=Ga(n,a);za(r,i)||(e.uniform1iv(this.addr,i),Fa(r,i));for(var o=0;o!==a;++o)n.setTexture2DArray(t[o]||Ca,i[o])}var Ti=E((function e(t,n,r){T(this,e),this.id=t,this.addr=r,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Wa;case 35664:return Va;case 35665:return Ua;case 35666:return Xa;case 35674:return Ba;case 35675:return Ha;case 35676:return Za;case 5124:case 35670:return Ka;case 35667:case 35671:return ja;case 35668:case 35672:return Ya;case 35669:case 35673:return Qa;case 5125:return Ja;case 36294:return qa;case 36295:return $a;case 36296:return ei;case 35678:case 36198:case 36298:case 36306:case 35682:return ti;case 35679:case 36299:case 36307:return ni;case 35680:case 36300:case 36308:case 36293:return ri;case 36289:case 36303:case 36311:case 36292:return ai}}(n.type)})),_i=E((function e(t,n,r){T(this,e),this.id=t,this.addr=r,this.cache=[],this.size=n.size,this.setValue=function(e){switch(e){case 5126:return ii;case 35664:return oi;case 35665:return si;case 35666:return ui;case 35674:return ci;case 35675:return li;case 35676:return di;case 5124:case 35670:return hi;case 35667:case 35671:return pi;case 35668:case 35672:return fi;case 35669:case 35673:return mi;case 5125:return vi;case 36294:return gi;case 36295:return yi;case 36296:return bi;case 35678:case 36198:case 36298:case 36306:case 35682:return xi;case 35679:case 36299:case 36307:return wi;case 35680:case 36300:case 36308:case 36293:return ki;case 36289:case 36303:case 36311:case 36292:return Si}}(n.type)})),Ii=function(){function e(t){T(this,e),this.id=t,this.seq=[],this.map={}}return E(e,[{key:"setValue",value:function(e,t,n){for(var r=this.seq,a=0,i=r.length;a!==i;++a){var o=r[a];o.setValue(e,t[o.id],n)}}}]),e}(),Ei=/(\w+)(\])?(\[|\.)?/g;function Ci(e,t){e.seq.push(t),e.map[t.id]=t}function Mi(e,t,n){var r=e.name,a=r.length;for(Ei.lastIndex=0;;){var i=Ei.exec(r),o=Ei.lastIndex,s=i[1],u="]"===i[2],c=i[3];if(u&&(s|=0),void 0===c||"["===c&&o+2===a){Ci(n,void 0===c?new Ti(s,e,t):new _i(s,e,t));break}var l=n.map[s];void 0===l&&Ci(n,l=new Ii(s)),n=l}}var Ni=function(){function e(t,n){T(this,e),this.seq=[],this.map={};for(var r=t.getProgramParameter(n,t.ACTIVE_UNIFORMS),a=0;a<r;++a){var i=t.getActiveUniform(n,a);Mi(i,t.getUniformLocation(n,i.name),this)}}return E(e,[{key:"setValue",value:function(e,t,n,r){var a=this.map[t];void 0!==a&&a.setValue(e,n,r)}},{key:"setOptional",value:function(e,t,n){var r=t[n];void 0!==r&&this.setValue(e,n,r)}}],[{key:"upload",value:function(e,t,n,r){for(var a=0,i=t.length;a!==i;++a){var o=t[a],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,r)}}},{key:"seqWithValue",value:function(e,t){for(var n=[],r=0,a=e.length;r!==a;++r){var i=e[r];i.id in t&&n.push(i)}return n}}]),e}();function Ri(e,t,n){var r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}var Li=0;function Ai(e,t,n){var r=e.getShaderParameter(t,e.COMPILE_STATUS),a=e.getShaderInfoLog(t).trim();if(r&&""===a)return"";var i=/ERROR: 0:(\d+)/.exec(a);if(i){var o=parseInt(i[1]);return n.toUpperCase()+"\n\n"+a+"\n\n"+function(e,t){for(var n=e.split("\n"),r=[],a=Math.max(t-6,0),i=Math.min(t+6,n.length),o=a;o<i;o++){var s=o+1;r.push("".concat(s===t?">":" "," ").concat(s,": ").concat(n[o]))}return r.join("\n")}(e.getShaderSource(t),o)}return a}function Pi(e,t){var n=function(e){switch(e){case Ae:return["Linear","( value )"];case Le:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),["Linear","( value )"]}}(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function Di(e,t){var n;switch(t){case H:n="Linear";break;case Z:n="Reinhard";break;case K:n="OptimizedCineon";break;case j:n="ACESFilmic";break;case Y:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Oi(e){return""!==e}function zi(e,t){var n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Fi(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var Gi=/^[ \t]*#include +<([\w\d./]+)>/gm;function Wi(e){return e.replace(Gi,Vi)}function Vi(e,t){var n=Kr[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return Wi(n)}var Ui=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Xi(e){return e.replace(Ui,Bi)}function Bi(e,t,n,r){for(var a="",i=parseInt(t);i<parseInt(n);i++)a+=r.replace(/\[\s*i\s*\]/g,"[ "+i+" ]").replace(/UNROLLED_LOOP_INDEX/g,i);return a}function Hi(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Zi(e,t,n,r){var a,i,o=e.getContext(),s=n.defines,u=n.vertexShader,c=n.fragmentShader,l=function(e){var t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===A?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===P?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===D&&(t="SHADOWMAP_TYPE_VSM"),t}(n),d=function(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case Q:case J:t="ENVMAP_TYPE_CUBE";break;case ee:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),h=function(e){var t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===J&&(t="ENVMAP_MODE_REFRACTION");return t}(n),p=function(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case V:t="ENVMAP_BLENDING_MULTIPLY";break;case U:t="ENVMAP_BLENDING_MIX";break;case X:t="ENVMAP_BLENDING_ADD"}return t}(n),f=function(e){var t=e.envMapCubeUVHeight;if(null===t)return null;var n=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}(n),m=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.normalMapTangentSpace||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Oi).join("\n")}(n),v=function(e){var t=[];for(var n in e){var r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(s),g=o.createProgram(),y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?((a=[v].filter(Oi).join("\n")).length>0&&(a+="\n"),(i=[m,v].filter(Oi).join("\n")).length>0&&(i+="\n")):(a=[Hi(n),"#define SHADER_NAME "+n.shaderName,v,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Oi).join("\n"),i=[m,Hi(n),"#define SHADER_NAME "+n.shaderName,v,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+d:"",n.envMap?"#define "+h:"",n.envMap?"#define "+p:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==B?"#define TONE_MAPPING":"",n.toneMapping!==B?Kr.tonemapping_pars_fragment:"",n.toneMapping!==B?Di("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",Kr.encodings_pars_fragment,Pi("linearToOutputTexel",n.outputColorSpace),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Oi).join("\n")),u=Fi(u=zi(u=Wi(u),n),n),c=Fi(c=zi(c=Wi(c),n),n),u=Xi(u),c=Xi(c),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",a=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+a,i=["#define varying in",n.glslVersion===ze?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===ze?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+i);var b,x,w=y+a+u,k=y+i+c,S=Ri(o,o.VERTEX_SHADER,w),T=Ri(o,o.FRAGMENT_SHADER,k);if(o.attachShader(g,S),o.attachShader(g,T),void 0!==n.index0AttributeName?o.bindAttribLocation(g,0,n.index0AttributeName):!0===n.morphTargets&&o.bindAttribLocation(g,0,"position"),o.linkProgram(g),e.debug.checkShaderErrors){var _=o.getProgramInfoLog(g).trim(),I=o.getShaderInfoLog(S).trim(),E=o.getShaderInfoLog(T).trim(),C=!0,M=!0;if(!1===o.getProgramParameter(g,o.LINK_STATUS))if(C=!1,"function"===typeof e.debug.onShaderError)e.debug.onShaderError(o,g,S,T);else{var N=Ai(o,S,"vertex"),R=Ai(o,T,"fragment");console.error("THREE.WebGLProgram: Shader Error "+o.getError()+" - VALIDATE_STATUS "+o.getProgramParameter(g,o.VALIDATE_STATUS)+"\n\nProgram Info Log: "+_+"\n"+N+"\n"+R)}else""!==_?console.warn("THREE.WebGLProgram: Program Info Log:",_):""!==I&&""!==E||(M=!1);M&&(this.diagnostics={runnable:C,programLog:_,vertexShader:{log:I,prefix:a},fragmentShader:{log:E,prefix:i}})}return o.deleteShader(S),o.deleteShader(T),this.getUniforms=function(){return void 0===b&&(b=new Ni(o,g)),b},this.getAttributes=function(){return void 0===x&&(x=function(e,t){for(var n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),a=0;a<r;a++){var i=e.getActiveAttrib(t,a),o=i.name,s=1;i.type===e.FLOAT_MAT2&&(s=2),i.type===e.FLOAT_MAT3&&(s=3),i.type===e.FLOAT_MAT4&&(s=4),n[o]={type:i.type,location:e.getAttribLocation(t,o),locationSize:s}}return n}(o,g)),x},this.destroy=function(){r.releaseStatesOfProgram(this),o.deleteProgram(g),this.program=void 0},this.name=n.shaderName,this.id=Li++,this.cacheKey=t,this.usedTimes=1,this.program=g,this.vertexShader=S,this.fragmentShader=T,this}var Ki=0,ji=function(){function e(){T(this,e),this.shaderCache=new Map,this.materialCache=new Map}return E(e,[{key:"update",value:function(e){var t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),a=this._getShaderStage(n),i=this._getShaderCacheForMaterial(e);return!1===i.has(r)&&(i.add(r),r.usedTimes++),!1===i.has(a)&&(i.add(a),a.usedTimes++),this}},{key:"remove",value:function(e){var t,n=x(this.materialCache.get(e));try{for(n.s();!(t=n.n()).done;){var r=t.value;r.usedTimes--,0===r.usedTimes&&this.shaderCache.delete(r.code)}}catch(a){n.e(a)}finally{n.f()}return this.materialCache.delete(e),this}},{key:"getVertexShaderID",value:function(e){return this._getShaderStage(e.vertexShader).id}},{key:"getFragmentShaderID",value:function(e){return this._getShaderStage(e.fragmentShader).id}},{key:"dispose",value:function(){this.shaderCache.clear(),this.materialCache.clear()}},{key:"_getShaderCacheForMaterial",value:function(e){var t=this.materialCache,n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}},{key:"_getShaderStage",value:function(e){var t=this.shaderCache,n=t.get(e);return void 0===n&&(n=new Yi(e),t.set(e,n)),n}}]),e}(),Yi=E((function e(t){T(this,e),this.id=Ki++,this.code=t,this.usedTimes=0}));function Qi(e,t,n,r,a,i,o){var s=new ln,u=new ji,c=[],l=a.isWebGL2,d=a.logarithmicDepthBuffer,h=a.vertexTextures,p=a.precision,f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(e){return 1===e?"uv1":2===e?"uv2":3===e?"uv3":"uv"}return{getParameters:function(i,s,c,v,g){var y=v.fog,b=g.geometry,x=i.isMeshStandardMaterial?v.environment:null,w=(i.isMeshStandardMaterial?n:t).get(i.envMap||x),k=w&&w.mapping===ee?w.image.height:null,S=f[i.type];null!==i.precision&&(p=a.getMaxPrecision(i.precision))!==i.precision&&console.warn("THREE.WebGLProgram.getParameters:",i.precision,"not supported, using",p,"instead.");var T,_,I,E,C=b.morphAttributes.position||b.morphAttributes.normal||b.morphAttributes.color,M=void 0!==C?C.length:0,N=0;if(void 0!==b.morphAttributes.position&&(N=1),void 0!==b.morphAttributes.normal&&(N=2),void 0!==b.morphAttributes.color&&(N=3),S){var R=Yr[S];T=R.vertexShader,_=R.fragmentShader}else T=i.vertexShader,_=i.fragmentShader,u.update(i),I=u.getVertexShaderID(i),E=u.getFragmentShaderID(i);var L=e.getRenderTarget(),A=!0===g.isInstancedMesh,P=!!i.map,D=!!i.matcap,O=!!w,G=!!i.aoMap,W=!!i.lightMap,V=!!i.bumpMap,U=!!i.normalMap,X=!!i.displacementMap,H=!!i.emissiveMap,Z=!!i.metalnessMap,K=!!i.roughnessMap,j=i.clearcoat>0,Y=i.iridescence>0,Q=i.sheen>0,J=i.transmission>0,q=j&&!!i.clearcoatMap,$=j&&!!i.clearcoatNormalMap,te=j&&!!i.clearcoatRoughnessMap,ne=Y&&!!i.iridescenceMap,re=Y&&!!i.iridescenceThicknessMap,ae=Q&&!!i.sheenColorMap,ie=Q&&!!i.sheenRoughnessMap,oe=!!i.specularMap,se=!!i.specularColorMap,ue=!!i.specularIntensityMap,ce=J&&!!i.transmissionMap,le=J&&!!i.thicknessMap,de=!!i.gradientMap,he=!!i.alphaMap,pe=i.alphaTest>0,fe=!!i.extensions,me=!!b.attributes.uv1,ve=!!b.attributes.uv2,ge=!!b.attributes.uv3;return{isWebGL2:l,shaderID:S,shaderName:i.type,vertexShader:T,fragmentShader:_,defines:i.defines,customVertexShaderID:I,customFragmentShaderID:E,isRawShaderMaterial:!0===i.isRawShaderMaterial,glslVersion:i.glslVersion,precision:p,instancing:A,instancingColor:A&&null!==g.instanceColor,supportsVertexTextures:h,outputColorSpace:null===L?e.outputColorSpace:!0===L.isXRRenderTarget?L.texture.colorSpace:Ae,map:P,matcap:D,envMap:O,envMapMode:O&&w.mapping,envMapCubeUVHeight:k,aoMap:G,lightMap:W,bumpMap:V,normalMap:U,displacementMap:h&&X,emissiveMap:H,normalMapObjectSpace:U&&1===i.normalMapType,normalMapTangentSpace:U&&i.normalMapType===Ne,metalnessMap:Z,roughnessMap:K,clearcoat:j,clearcoatMap:q,clearcoatNormalMap:$,clearcoatRoughnessMap:te,iridescence:Y,iridescenceMap:ne,iridescenceThicknessMap:re,sheen:Q,sheenColorMap:ae,sheenRoughnessMap:ie,specularMap:oe,specularColorMap:se,specularIntensityMap:ue,transmission:J,transmissionMap:ce,thicknessMap:le,gradientMap:de,opaque:!1===i.transparent&&1===i.blending,alphaMap:he,alphaTest:pe,combine:i.combine,mapUv:P&&m(i.map.channel),aoMapUv:G&&m(i.aoMap.channel),lightMapUv:W&&m(i.lightMap.channel),bumpMapUv:V&&m(i.bumpMap.channel),normalMapUv:U&&m(i.normalMap.channel),displacementMapUv:X&&m(i.displacementMap.channel),emissiveMapUv:H&&m(i.emissiveMap.channel),metalnessMapUv:Z&&m(i.metalnessMap.channel),roughnessMapUv:K&&m(i.roughnessMap.channel),clearcoatMapUv:q&&m(i.clearcoatMap.channel),clearcoatNormalMapUv:$&&m(i.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:te&&m(i.clearcoatRoughnessMap.channel),iridescenceMapUv:ne&&m(i.iridescenceMap.channel),iridescenceThicknessMapUv:re&&m(i.iridescenceThicknessMap.channel),sheenColorMapUv:ae&&m(i.sheenColorMap.channel),sheenRoughnessMapUv:ie&&m(i.sheenRoughnessMap.channel),specularMapUv:oe&&m(i.specularMap.channel),specularColorMapUv:se&&m(i.specularColorMap.channel),specularIntensityMapUv:ue&&m(i.specularIntensityMap.channel),transmissionMapUv:ce&&m(i.transmissionMap.channel),thicknessMapUv:le&&m(i.thicknessMap.channel),alphaMapUv:he&&m(i.alphaMap.channel),vertexTangents:U&&!!b.attributes.tangent,vertexColors:i.vertexColors,vertexAlphas:!0===i.vertexColors&&!!b.attributes.color&&4===b.attributes.color.itemSize,vertexUv1s:me,vertexUv2s:ve,vertexUv3s:ge,pointsUvs:!0===g.isPoints&&!!b.attributes.uv&&(P||he),fog:!!y,useFog:!0===i.fog,fogExp2:y&&y.isFogExp2,flatShading:!0===i.flatShading,sizeAttenuation:!0===i.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===g.isSkinnedMesh,morphTargets:void 0!==b.morphAttributes.position,morphNormals:void 0!==b.morphAttributes.normal,morphColors:void 0!==b.morphAttributes.color,morphTargetsCount:M,morphTextureStride:N,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numSpotLightMaps:s.spotLightMap.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numSpotLightShadowsWithMaps:s.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:i.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.length>0,shadowMapType:e.shadowMap.type,toneMapping:i.toneMapped?e.toneMapping:B,useLegacyLights:e.useLegacyLights,premultipliedAlpha:i.premultipliedAlpha,doubleSided:i.side===F,flipSided:i.side===z,useDepthPacking:i.depthPacking>=0,depthPacking:i.depthPacking||0,index0AttributeName:i.index0AttributeName,extensionDerivatives:fe&&!0===i.extensions.derivatives,extensionFragDepth:fe&&!0===i.extensions.fragDepth,extensionDrawBuffers:fe&&!0===i.extensions.drawBuffers,extensionShaderTextureLOD:fe&&!0===i.extensions.shaderTextureLOD,rendererExtensionFragDepth:l||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:l||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:l||r.has("EXT_shader_texture_lod"),customProgramCacheKey:i.customProgramCacheKey()}},getProgramCacheKey:function(t){var n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(var r in t.defines)n.push(r),n.push(t.defines[r]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){s.disableAll(),t.isWebGL2&&s.enable(0);t.supportsVertexTextures&&s.enable(1);t.instancing&&s.enable(2);t.instancingColor&&s.enable(3);t.matcap&&s.enable(4);t.envMap&&s.enable(5);t.normalMapObjectSpace&&s.enable(6);t.normalMapTangentSpace&&s.enable(7);t.clearcoat&&s.enable(8);t.iridescence&&s.enable(9);t.alphaTest&&s.enable(10);t.vertexColors&&s.enable(11);t.vertexAlphas&&s.enable(12);t.vertexUv1s&&s.enable(13);t.vertexUv2s&&s.enable(14);t.vertexUv3s&&s.enable(15);t.vertexTangents&&s.enable(16);e.push(s.mask),s.disableAll(),t.fog&&s.enable(0);t.useFog&&s.enable(1);t.flatShading&&s.enable(2);t.logarithmicDepthBuffer&&s.enable(3);t.skinning&&s.enable(4);t.morphTargets&&s.enable(5);t.morphNormals&&s.enable(6);t.morphColors&&s.enable(7);t.premultipliedAlpha&&s.enable(8);t.shadowMapEnabled&&s.enable(9);t.useLegacyLights&&s.enable(10);t.doubleSided&&s.enable(11);t.flipSided&&s.enable(12);t.useDepthPacking&&s.enable(13);t.dithering&&s.enable(14);t.transmission&&s.enable(15);t.sheen&&s.enable(16);t.opaque&&s.enable(17);t.pointsUvs&&s.enable(18);e.push(s.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){var t,n=f[e.type];if(n){var r=Yr[n];t=Mr.clone(r.uniforms)}else t=e.uniforms;return t},acquireProgram:function(t,n){for(var r,a=0,o=c.length;a<o;a++){var s=c[a];if(s.cacheKey===n){++(r=s).usedTimes;break}}return void 0===r&&(r=new Zi(e,n,t,i),c.push(r)),r},releaseProgram:function(e){if(0===--e.usedTimes){var t=c.indexOf(e);c[t]=c[c.length-1],c.pop(),e.destroy()}},releaseShaderCache:function(e){u.remove(e)},programs:c,dispose:function(){u.dispose()}}}function Ji(){var e=new WeakMap;return{get:function(t){var n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function qi(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function $i(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function eo(){var e=[],t=0,n=[],r=[],a=[];function i(n,r,a,i,o,s){var u=e[t];return void 0===u?(u={id:n.id,object:n,geometry:r,material:a,groupOrder:i,renderOrder:n.renderOrder,z:o,group:s},e[t]=u):(u.id=n.id,u.object=n,u.geometry=r,u.material=a,u.groupOrder=i,u.renderOrder=n.renderOrder,u.z=o,u.group=s),t++,u}return{opaque:n,transmissive:r,transparent:a,init:function(){t=0,n.length=0,r.length=0,a.length=0},push:function(e,t,o,s,u,c){var l=i(e,t,o,s,u,c);o.transmission>0?r.push(l):!0===o.transparent?a.push(l):n.push(l)},unshift:function(e,t,o,s,u,c){var l=i(e,t,o,s,u,c);o.transmission>0?r.unshift(l):!0===o.transparent?a.unshift(l):n.unshift(l)},finish:function(){for(var n=t,r=e.length;n<r;n++){var a=e[n];if(null===a.id)break;a.id=null,a.object=null,a.geometry=null,a.material=null,a.group=null}},sort:function(e,t){n.length>1&&n.sort(e||qi),r.length>1&&r.sort(t||$i),a.length>1&&a.sort(t||$i)}}}function to(){var e=new WeakMap;return{get:function(t,n){var r,a=e.get(t);return void 0===a?(r=new eo,e.set(t,[r])):n>=a.length?(r=new eo,a.push(r)):r=a[n],r},dispose:function(){e=new WeakMap}}}function no(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":n={direction:new kt,color:new Xn};break;case"SpotLight":n={position:new kt,direction:new kt,color:new Xn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new kt,color:new Xn,distance:0,decay:0};break;case"HemisphereLight":n={direction:new kt,skyColor:new Xn,groundColor:new Xn};break;case"RectAreaLight":n={color:new Xn,position:new kt,halfWidth:new kt,halfHeight:new kt}}return e[t.id]=n,n}}}var ro=0;function ao(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function io(e,t){for(var n=new no,r=function(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Je};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Je,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),a={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0},i=0;i<9;i++)a.probe.push(new kt);var o=new kt,s=new qt,u=new qt;return{setup:function(i,o){for(var s=0,u=0,c=0,l=0;l<9;l++)a.probe[l].set(0,0,0);var d=0,h=0,p=0,f=0,m=0,v=0,g=0,y=0,b=0,x=0;i.sort(ao);for(var w=!0===o?Math.PI:1,k=0,S=i.length;k<S;k++){var T=i[k],_=T.color,I=T.intensity,E=T.distance,C=T.shadow&&T.shadow.map?T.shadow.map.texture:null;if(T.isAmbientLight)s+=_.r*I*w,u+=_.g*I*w,c+=_.b*I*w;else if(T.isLightProbe)for(var M=0;M<9;M++)a.probe[M].addScaledVector(T.sh.coefficients[M],I);else if(T.isDirectionalLight){var N=n.get(T);if(N.color.copy(T.color).multiplyScalar(T.intensity*w),T.castShadow){var R=T.shadow,L=r.get(T);L.shadowBias=R.bias,L.shadowNormalBias=R.normalBias,L.shadowRadius=R.radius,L.shadowMapSize=R.mapSize,a.directionalShadow[d]=L,a.directionalShadowMap[d]=C,a.directionalShadowMatrix[d]=T.shadow.matrix,v++}a.directional[d]=N,d++}else if(T.isSpotLight){var A=n.get(T);A.position.setFromMatrixPosition(T.matrixWorld),A.color.copy(_).multiplyScalar(I*w),A.distance=E,A.coneCos=Math.cos(T.angle),A.penumbraCos=Math.cos(T.angle*(1-T.penumbra)),A.decay=T.decay,a.spot[p]=A;var P=T.shadow;if(T.map&&(a.spotLightMap[b]=T.map,b++,P.updateMatrices(T),T.castShadow&&x++),a.spotLightMatrix[p]=P.matrix,T.castShadow){var D=r.get(T);D.shadowBias=P.bias,D.shadowNormalBias=P.normalBias,D.shadowRadius=P.radius,D.shadowMapSize=P.mapSize,a.spotShadow[p]=D,a.spotShadowMap[p]=C,y++}p++}else if(T.isRectAreaLight){var O=n.get(T);O.color.copy(_).multiplyScalar(I),O.halfWidth.set(.5*T.width,0,0),O.halfHeight.set(0,.5*T.height,0),a.rectArea[f]=O,f++}else if(T.isPointLight){var z=n.get(T);if(z.color.copy(T.color).multiplyScalar(T.intensity*w),z.distance=T.distance,z.decay=T.decay,T.castShadow){var F=T.shadow,G=r.get(T);G.shadowBias=F.bias,G.shadowNormalBias=F.normalBias,G.shadowRadius=F.radius,G.shadowMapSize=F.mapSize,G.shadowCameraNear=F.camera.near,G.shadowCameraFar=F.camera.far,a.pointShadow[h]=G,a.pointShadowMap[h]=C,a.pointShadowMatrix[h]=T.shadow.matrix,g++}a.point[h]=z,h++}else if(T.isHemisphereLight){var W=n.get(T);W.skyColor.copy(T.color).multiplyScalar(I*w),W.groundColor.copy(T.groundColor).multiplyScalar(I*w),a.hemi[m]=W,m++}}f>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(a.rectAreaLTC1=jr.LTC_FLOAT_1,a.rectAreaLTC2=jr.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(a.rectAreaLTC1=jr.LTC_HALF_1,a.rectAreaLTC2=jr.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),a.ambient[0]=s,a.ambient[1]=u,a.ambient[2]=c;var V=a.hash;V.directionalLength===d&&V.pointLength===h&&V.spotLength===p&&V.rectAreaLength===f&&V.hemiLength===m&&V.numDirectionalShadows===v&&V.numPointShadows===g&&V.numSpotShadows===y&&V.numSpotMaps===b||(a.directional.length=d,a.spot.length=p,a.rectArea.length=f,a.point.length=h,a.hemi.length=m,a.directionalShadow.length=v,a.directionalShadowMap.length=v,a.pointShadow.length=g,a.pointShadowMap.length=g,a.spotShadow.length=y,a.spotShadowMap.length=y,a.directionalShadowMatrix.length=v,a.pointShadowMatrix.length=g,a.spotLightMatrix.length=y+b-x,a.spotLightMap.length=b,a.numSpotLightShadowsWithMaps=x,V.directionalLength=d,V.pointLength=h,V.spotLength=p,V.rectAreaLength=f,V.hemiLength=m,V.numDirectionalShadows=v,V.numPointShadows=g,V.numSpotShadows=y,V.numSpotMaps=b,a.version=ro++)},setupView:function(e,t){for(var n=0,r=0,i=0,c=0,l=0,d=t.matrixWorldInverse,h=0,p=e.length;h<p;h++){var f=e[h];if(f.isDirectionalLight){var m=a.directional[n];m.direction.setFromMatrixPosition(f.matrixWorld),o.setFromMatrixPosition(f.target.matrixWorld),m.direction.sub(o),m.direction.transformDirection(d),n++}else if(f.isSpotLight){var v=a.spot[i];v.position.setFromMatrixPosition(f.matrixWorld),v.position.applyMatrix4(d),v.direction.setFromMatrixPosition(f.matrixWorld),o.setFromMatrixPosition(f.target.matrixWorld),v.direction.sub(o),v.direction.transformDirection(d),i++}else if(f.isRectAreaLight){var g=a.rectArea[c];g.position.setFromMatrixPosition(f.matrixWorld),g.position.applyMatrix4(d),u.identity(),s.copy(f.matrixWorld),s.premultiply(d),u.extractRotation(s),g.halfWidth.set(.5*f.width,0,0),g.halfHeight.set(0,.5*f.height,0),g.halfWidth.applyMatrix4(u),g.halfHeight.applyMatrix4(u),c++}else if(f.isPointLight){var y=a.point[r];y.position.setFromMatrixPosition(f.matrixWorld),y.position.applyMatrix4(d),r++}else if(f.isHemisphereLight){var b=a.hemi[l];b.direction.setFromMatrixPosition(f.matrixWorld),b.direction.transformDirection(d),l++}}},state:a}}function oo(e,t){var n=new io(e,t),r=[],a=[];return{init:function(){r.length=0,a.length=0},state:{lightsArray:r,shadowsArray:a,lights:n},setupLights:function(e){n.setup(r,e)},setupLightsView:function(e){n.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){a.push(e)}}}function so(e,t){var n=new WeakMap;return{get:function(r){var a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=n.get(r);return void 0===o?(a=new oo(e,t),n.set(r,[a])):i>=o.length?(a=new oo(e,t),o.push(a)):a=o[i],a},dispose:function(){n=new WeakMap}}}var uo=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this)).isMeshDepthMaterial=!0,r.type="MeshDepthMaterial",r.depthPacking=3200,r.map=null,r.alphaMap=null,r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.wireframe=!1,r.wireframeLinewidth=1,r.setValues(e),r}return E(n,[{key:"copy",value:function(e){return N(v(n.prototype),"copy",this).call(this,e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}]),n}(Fn),co=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this)).isMeshDistanceMaterial=!0,r.type="MeshDistanceMaterial",r.map=null,r.alphaMap=null,r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.setValues(e),r}return E(n,[{key:"copy",value:function(e){return N(v(n.prototype),"copy",this).call(this,e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}]),n}(Fn);function lo(e,t,n){var r,a=new Xr,i=new Je,o=new Je,s=new gt,u=new uo({depthPacking:3201}),c=new co,l={},d=n.maxTextureSize,h=(R(r={},O,z),R(r,z,O),R(r,F,F),r),p=new Nr({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Je},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),f=p.clone();f.defines.HORIZONTAL_PASS=1;var m=new ir;m.setAttribute("position",new jn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var v=new Sr(m,p),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=A;var y=this.type;function b(n,r){var a=t.update(v);p.defines.VSM_SAMPLES!==n.blurSamples&&(p.defines.VSM_SAMPLES=n.blurSamples,f.defines.VSM_SAMPLES=n.blurSamples,p.needsUpdate=!0,f.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new yt(i.x,i.y)),p.uniforms.shadow_pass.value=n.map.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,a,p,v,null),f.uniforms.shadow_pass.value=n.mapPass.texture,f.uniforms.resolution.value=n.mapSize,f.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,a,f,v,null)}function x(t,n,r,a){var i=null,o=!0===r.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==o)i=o;else if(i=!0===r.isPointLight?c:u,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){var s=i.uuid,d=n.uuid,p=l[s];void 0===p&&(p={},l[s]=p);var f=p[d];void 0===f&&(f=i.clone(),p[d]=f),i=f}(i.visible=n.visible,i.wireframe=n.wireframe,i.side=a===D?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:h[n.side],i.alphaMap=n.alphaMap,i.alphaTest=n.alphaTest,i.map=n.map,i.clipShadows=n.clipShadows,i.clippingPlanes=n.clippingPlanes,i.clipIntersection=n.clipIntersection,i.displacementMap=n.displacementMap,i.displacementScale=n.displacementScale,i.displacementBias=n.displacementBias,i.wireframeLinewidth=n.wireframeLinewidth,i.linewidth=n.linewidth,!0===r.isPointLight&&!0===i.isMeshDistanceMaterial)&&(e.properties.get(i).light=r);return i}function w(n,r,i,o,s){if(!1!==n.visible){if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&s===D)&&(!n.frustumCulled||a.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,n.matrixWorld);var u=t.update(n),c=n.material;if(Array.isArray(c))for(var l=u.groups,d=0,h=l.length;d<h;d++){var p=l[d],f=c[p.materialIndex];if(f&&f.visible){var m=x(n,f,o,s);e.renderBufferDirect(i,null,u,m,n,p)}}else if(c.visible){var v=x(n,c,o,s);e.renderBufferDirect(i,null,u,v,n,null)}}for(var g=n.children,y=0,b=g.length;y<b;y++)w(g[y],r,i,o,s)}}this.render=function(t,n,r){if(!1!==g.enabled&&(!1!==g.autoUpdate||!1!==g.needsUpdate)&&0!==t.length){var u=e.getRenderTarget(),c=e.getActiveCubeFace(),l=e.getActiveMipmapLevel(),h=e.state;h.setBlending(G),h.buffers.color.setClear(1,1,1,1),h.buffers.depth.setTest(!0),h.setScissorTest(!1);for(var p=y!==D&&this.type===D,f=y===D&&this.type!==D,m=0,v=t.length;m<v;m++){var x=t[m],k=x.shadow;if(void 0!==k){if(!1!==k.autoUpdate||!1!==k.needsUpdate){i.copy(k.mapSize);var S=k.getFrameExtents();if(i.multiply(S),o.copy(k.mapSize),(i.x>d||i.y>d)&&(i.x>d&&(o.x=Math.floor(d/S.x),i.x=o.x*S.x,k.mapSize.x=o.x),i.y>d&&(o.y=Math.floor(d/S.y),i.y=o.y*S.y,k.mapSize.y=o.y)),null===k.map||!0===p||!0===f){var T=this.type!==D?{minFilter:ae,magFilter:ae}:{};null!==k.map&&k.map.dispose(),k.map=new yt(i.x,i.y,T),k.map.texture.name=x.name+".shadowMap",k.camera.updateProjectionMatrix()}e.setRenderTarget(k.map),e.clear();for(var _=k.getViewportCount(),I=0;I<_;I++){var E=k.getViewport(I);s.set(o.x*E.x,o.y*E.y,o.x*E.z,o.y*E.w),h.viewport(s),k.updateMatrices(x,I),a=k.getFrustum(),w(n,r,k.camera,x,this.type)}!0!==k.isPointLightShadow&&this.type===D&&b(k,r),k.needsUpdate=!1}}else console.warn("THREE.WebGLShadowMap:",x,"has no shadow.")}y=this.type,g.needsUpdate=!1,e.setRenderTarget(u,c,l)}}}function ho(e,t,n){var r,a,i=n.isWebGL2;var o=new function(){var t=!1,n=new gt,r=null,a=new gt(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,i,o,s){!0===s&&(t*=o,r*=o,i*=o),n.set(t,r,i,o),!1===a.equals(n)&&(e.clearColor(t,r,i,o),a.copy(n))},reset:function(){t=!1,r=null,a.set(-1,0,0,0)}}},s=new function(){var t=!1,n=null,r=null,a=null;return{setTest:function(t){t?K(e.DEPTH_TEST):j(e.DEPTH_TEST)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case 3:default:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL)}r=t}},setLocked:function(e){t=e},setClear:function(t){a!==t&&(e.clearDepth(t),a=t)},reset:function(){t=!1,n=null,r=null,a=null}}},u=new function(){var t=!1,n=null,r=null,a=null,i=null,o=null,s=null,u=null,c=null;return{setTest:function(n){t||(n?K(e.STENCIL_TEST):j(e.STENCIL_TEST))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,o){r===t&&a===n&&i===o||(e.stencilFunc(t,n,o),r=t,a=n,i=o)},setOp:function(t,n,r){o===t&&s===n&&u===r||(e.stencilOp(t,n,r),o=t,s=n,u=r)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,r=null,a=null,i=null,o=null,s=null,u=null,c=null}}},c=new WeakMap,l=new WeakMap,d={},h={},p=new WeakMap,f=[],m=null,v=!1,g=null,y=null,b=null,x=null,w=null,k=null,S=null,T=!1,_=null,I=null,E=null,C=null,M=null,N=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),L=!1,A=0,P=e.getParameter(e.VERSION);-1!==P.indexOf("WebGL")?(A=parseFloat(/^WebGL (\d)/.exec(P)[1]),L=A>=1):-1!==P.indexOf("OpenGL ES")&&(A=parseFloat(/^OpenGL ES (\d)/.exec(P)[1]),L=A>=2);var D=null,O={},V=e.getParameter(e.SCISSOR_BOX),U=e.getParameter(e.VIEWPORT),X=(new gt).fromArray(V),B=(new gt).fromArray(U);function H(t,n,r,a){var o=new Uint8Array(4),s=e.createTexture();e.bindTexture(t,s),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(var u=0;u<r;u++)!i||t!==e.TEXTURE_3D&&t!==e.TEXTURE_2D_ARRAY?e.texImage2D(n+u,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,o):e.texImage3D(n,0,e.RGBA,1,1,a,0,e.RGBA,e.UNSIGNED_BYTE,o);return s}var Z={};function K(t){!0!==d[t]&&(e.enable(t),d[t]=!0)}function j(t){!1!==d[t]&&(e.disable(t),d[t]=!1)}Z[e.TEXTURE_2D]=H(e.TEXTURE_2D,e.TEXTURE_2D,1),Z[e.TEXTURE_CUBE_MAP]=H(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),i&&(Z[e.TEXTURE_2D_ARRAY]=H(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),Z[e.TEXTURE_3D]=H(e.TEXTURE_3D,e.TEXTURE_3D,1,1)),o.setClear(0,0,0,1),s.setClear(1),u.setClear(0),K(e.DEPTH_TEST),s.setFunc(3),$(!1),ee(1),K(e.CULL_FACE),q(G);var Y=(R(r={},W,e.FUNC_ADD),R(r,101,e.FUNC_SUBTRACT),R(r,102,e.FUNC_REVERSE_SUBTRACT),r);if(i)Y[103]=e.MIN,Y[104]=e.MAX;else{var Q=t.get("EXT_blend_minmax");null!==Q&&(Y[103]=Q.MIN_EXT,Y[104]=Q.MAX_EXT)}var J=(R(a={},200,e.ZERO),R(a,201,e.ONE),R(a,202,e.SRC_COLOR),R(a,204,e.SRC_ALPHA),R(a,210,e.SRC_ALPHA_SATURATE),R(a,208,e.DST_COLOR),R(a,206,e.DST_ALPHA),R(a,203,e.ONE_MINUS_SRC_COLOR),R(a,205,e.ONE_MINUS_SRC_ALPHA),R(a,209,e.ONE_MINUS_DST_COLOR),R(a,207,e.ONE_MINUS_DST_ALPHA),a);function q(t,n,r,a,i,o,s,u){if(t!==G){if(!1===v&&(K(e.BLEND),v=!0),5===t)i=i||n,o=o||r,s=s||a,n===y&&i===w||(e.blendEquationSeparate(Y[n],Y[i]),y=n,w=i),r===b&&a===x&&o===k&&s===S||(e.blendFuncSeparate(J[r],J[a],J[o],J[s]),b=r,x=a,k=o,S=s),g=t,T=!1;else if(t!==g||u!==T){if(y===W&&w===W||(e.blendEquation(e.FUNC_ADD),y=W,w=W),u)switch(t){case 1:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.ONE,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}b=null,x=null,k=null,S=null,g=t,T=u}}else!0===v&&(j(e.BLEND),v=!1)}function $(t){_!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),_=t)}function ee(t){0!==t?(K(e.CULL_FACE),t!==I&&(1===t?e.cullFace(e.BACK):2===t?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):j(e.CULL_FACE),I=t}function te(t,n,r){t?(K(e.POLYGON_OFFSET_FILL),C===n&&M===r||(e.polygonOffset(n,r),C=n,M=r)):j(e.POLYGON_OFFSET_FILL)}return{buffers:{color:o,depth:s,stencil:u},enable:K,disable:j,bindFramebuffer:function(t,n){return h[t]!==n&&(e.bindFramebuffer(t,n),h[t]=n,i&&(t===e.DRAW_FRAMEBUFFER&&(h[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(h[e.DRAW_FRAMEBUFFER]=n)),!0)},drawBuffers:function(r,a){var i=f,o=!1;if(r)if(void 0===(i=p.get(a))&&(i=[],p.set(a,i)),r.isWebGLMultipleRenderTargets){var s=r.texture;if(i.length!==s.length||i[0]!==e.COLOR_ATTACHMENT0){for(var u=0,c=s.length;u<c;u++)i[u]=e.COLOR_ATTACHMENT0+u;i.length=s.length,o=!0}}else i[0]!==e.COLOR_ATTACHMENT0&&(i[0]=e.COLOR_ATTACHMENT0,o=!0);else i[0]!==e.BACK&&(i[0]=e.BACK,o=!0);o&&(n.isWebGL2?e.drawBuffers(i):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(i))},useProgram:function(t){return m!==t&&(e.useProgram(t),m=t,!0)},setBlending:q,setMaterial:function(t,n){t.side===F?j(e.CULL_FACE):K(e.CULL_FACE);var r=t.side===z;n&&(r=!r),$(r),1===t.blending&&!1===t.transparent?q(G):q(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),s.setFunc(t.depthFunc),s.setTest(t.depthTest),s.setMask(t.depthWrite),o.setMask(t.colorWrite);var a=t.stencilWrite;u.setTest(a),a&&(u.setMask(t.stencilWriteMask),u.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),u.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),te(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?K(e.SAMPLE_ALPHA_TO_COVERAGE):j(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:$,setCullFace:ee,setLineWidth:function(t){t!==E&&(L&&e.lineWidth(t),E=t)},setPolygonOffset:te,setScissorTest:function(t){t?K(e.SCISSOR_TEST):j(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+N-1),D!==t&&(e.activeTexture(t),D=t)},bindTexture:function(t,n,r){void 0===r&&(r=null===D?e.TEXTURE0+N-1:D);var a=O[r];void 0===a&&(a={type:void 0,texture:void 0},O[r]=a),a.type===t&&a.texture===n||(D!==r&&(e.activeTexture(r),D=r),e.bindTexture(t,n||Z[t]),a.type=t,a.texture=n)},unbindTexture:function(){var t=O[D];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},updateUBOMapping:function(t,n){var r=l.get(n);void 0===r&&(r=new WeakMap,l.set(n,r));var a=r.get(t);void 0===a&&(a=e.getUniformBlockIndex(n,t.name),r.set(t,a))},uniformBlockBinding:function(t,n){var r=l.get(n).get(t);c.get(n)!==r&&(e.uniformBlockBinding(n,r,t.__bindingPointIndex),c.set(n,r))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===X.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),X.copy(t))},viewport:function(t){!1===B.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),B.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),!0===i&&(e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),d={},D=null,O={},h={},p=new WeakMap,f=[],m=null,v=!1,g=null,y=null,b=null,x=null,w=null,k=null,S=null,T=!1,_=null,I=null,E=null,C=null,M=null,X.set(0,0,e.canvas.width,e.canvas.height),B.set(0,0,e.canvas.width,e.canvas.height),o.reset(),s.reset(),u.reset()}}}function po(e,t,n,r,a,i,o){var s,u,c,l=a.isWebGL2,d=a.maxTextures,h=a.maxCubemapSize,p=a.maxTextureSize,f=a.maxSamples,m=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,v="undefined"!==typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),g=new WeakMap,y=new WeakMap,b=!1;try{b="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(H){}function x(e,t){return b?new OffscreenCanvas(e,t):tt("canvas")}function w(e,t,n,r){var a=1;if((e.width>r||e.height>r)&&(a=r/Math.max(e.width,e.height)),a<1||!0===t){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){var i=t?je:Math.floor,o=i(a*e.width),s=i(a*e.height);void 0===c&&(c=x(o,s));var u=n?x(o,s):c;return u.width=o,u.height=s,u.getContext("2d").drawImage(e,0,0,o,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+s+")."),u}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function k(e){return Ke(e.width)&&Ke(e.height)}function S(e,t){return e.generateMipmaps&&t&&e.minFilter!==ae&&e.minFilter!==se}function T(t){e.generateMipmap(t)}function _(n,r,a,i){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!1===l)return r;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}var s=r;return r===e.RED&&(a===e.FLOAT&&(s=e.R32F),a===e.HALF_FLOAT&&(s=e.R16F),a===e.UNSIGNED_BYTE&&(s=e.R8)),r===e.RG&&(a===e.FLOAT&&(s=e.RG32F),a===e.HALF_FLOAT&&(s=e.RG16F),a===e.UNSIGNED_BYTE&&(s=e.RG8)),r===e.RGBA&&(a===e.FLOAT&&(s=e.RGBA32F),a===e.HALF_FLOAT&&(s=e.RGBA16F),a===e.UNSIGNED_BYTE&&(s=i===Le&&!1===o?e.SRGB8_ALPHA8:e.RGBA8),a===e.UNSIGNED_SHORT_4_4_4_4&&(s=e.RGBA4),a===e.UNSIGNED_SHORT_5_5_5_1&&(s=e.RGB5_A1)),s!==e.R16F&&s!==e.R32F&&s!==e.RG16F&&s!==e.RG32F&&s!==e.RGBA16F&&s!==e.RGBA32F||t.get("EXT_color_buffer_float"),s}function I(e,t,n){return!0===S(e,n)||e.isFramebufferTexture&&e.minFilter!==ae&&e.minFilter!==se?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function E(t){return t===ae||t===ie||t===oe?e.NEAREST:e.LINEAR}function C(e){var t=e.target;t.removeEventListener("dispose",C),function(e){var t=r.get(e);if(void 0===t.__webglInit)return;var n=e.source,a=y.get(n);if(a){var i=a[t.__cacheKey];i.usedTimes--,0===i.usedTimes&&N(e),0===Object.keys(a).length&&y.delete(n)}r.remove(e)}(t),t.isVideoTexture&&g.delete(t)}function M(t){var n=t.target;n.removeEventListener("dispose",M),function(t){var n=t.texture,a=r.get(t),i=r.get(n);void 0!==i.__webglTexture&&(e.deleteTexture(i.__webglTexture),o.memory.textures--);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(var s=0;s<6;s++)e.deleteFramebuffer(a.__webglFramebuffer[s]),a.__webglDepthbuffer&&e.deleteRenderbuffer(a.__webglDepthbuffer[s]);else{if(e.deleteFramebuffer(a.__webglFramebuffer),a.__webglDepthbuffer&&e.deleteRenderbuffer(a.__webglDepthbuffer),a.__webglMultisampledFramebuffer&&e.deleteFramebuffer(a.__webglMultisampledFramebuffer),a.__webglColorRenderbuffer)for(var u=0;u<a.__webglColorRenderbuffer.length;u++)a.__webglColorRenderbuffer[u]&&e.deleteRenderbuffer(a.__webglColorRenderbuffer[u]);a.__webglDepthRenderbuffer&&e.deleteRenderbuffer(a.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(var c=0,l=n.length;c<l;c++){var d=r.get(n[c]);d.__webglTexture&&(e.deleteTexture(d.__webglTexture),o.memory.textures--),r.remove(n[c])}r.remove(n),r.remove(t)}(n)}function N(t){var n=r.get(t);e.deleteTexture(n.__webglTexture);var a=t.source;delete y.get(a)[n.__cacheKey],o.memory.textures--}var L=0;function A(t,a){var i=r.get(t);if(t.isVideoTexture&&function(e){var t=o.render.frame;g.get(e)!==t&&(g.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&i.__version!==t.version){var s=t.image;if(null===s)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==s.complete)return void F(i,t,a);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(e.TEXTURE_2D,i.__webglTexture,e.TEXTURE0+a)}var P=(R(s={},te,e.REPEAT),R(s,ne,e.CLAMP_TO_EDGE),R(s,re,e.MIRRORED_REPEAT),s),D=(R(u={},ae,e.NEAREST),R(u,ie,e.NEAREST_MIPMAP_NEAREST),R(u,oe,e.NEAREST_MIPMAP_LINEAR),R(u,se,e.LINEAR),R(u,ue,e.LINEAR_MIPMAP_NEAREST),R(u,ce,e.LINEAR_MIPMAP_LINEAR),u);function O(n,i,o){if(o?(e.texParameteri(n,e.TEXTURE_WRAP_S,P[i.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,P[i.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,P[i.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,D[i.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,D[i.minFilter])):(e.texParameteri(n,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(n,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),i.wrapS===ne&&i.wrapT===ne||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,e.TEXTURE_MAG_FILTER,E(i.magFilter)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,E(i.minFilter)),i.minFilter!==ae&&i.minFilter!==se&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){var s=t.get("EXT_texture_filter_anisotropic");if(i.magFilter===ae)return;if(i.minFilter!==oe&&i.minFilter!==ce)return;if(i.type===he&&!1===t.has("OES_texture_float_linear"))return;if(!1===l&&i.type===pe&&!1===t.has("OES_texture_half_float_linear"))return;(i.anisotropy>1||r.get(i).__currentAnisotropy)&&(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i.anisotropy,a.getMaxAnisotropy())),r.get(i).__currentAnisotropy=i.anisotropy)}}function z(t,n){var r=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",C));var a=n.source,i=y.get(a);void 0===i&&(i={},y.set(a,i));var s=function(e){var t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(s!==t.__cacheKey){void 0===i[s]&&(i[s]={texture:e.createTexture(),usedTimes:0},o.memory.textures++,r=!0),i[s].usedTimes++;var u=i[t.__cacheKey];void 0!==u&&(i[t.__cacheKey].usedTimes--,0===u.usedTimes&&N(n)),t.__cacheKey=s,t.__webglTexture=i[s].texture}return r}function F(t,a,o){var s=e.TEXTURE_2D;(a.isDataArrayTexture||a.isCompressedArrayTexture)&&(s=e.TEXTURE_2D_ARRAY),a.isData3DTexture&&(s=e.TEXTURE_3D);var u=z(t,a),c=a.source;n.bindTexture(s,t.__webglTexture,e.TEXTURE0+o);var d=r.get(c);if(c.version!==d.__version||!0===u){n.activeTexture(e.TEXTURE0+o),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,a.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,a.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE);var h,f=function(e){return!l&&(e.wrapS!==ne||e.wrapT!==ne||e.minFilter!==ae&&e.minFilter!==se)}(a)&&!1===k(a.image),m=w(a.image,f,!1,p),v=k(m=B(a,m))||l,g=i.convert(a.format,a.colorSpace),y=i.convert(a.type),b=_(a.internalFormat,g,y,a.colorSpace);O(s,a,v);var x=a.mipmaps,E=l&&!0!==a.isVideoTexture,C=void 0===d.__version||!0===u,M=I(a,m,v);if(a.isDepthTexture)b=e.DEPTH_COMPONENT,l?b=a.type===he?e.DEPTH_COMPONENT32F:a.type===de?e.DEPTH_COMPONENT24:a.type===fe?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT16:a.type===he&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),a.format===ve&&b===e.DEPTH_COMPONENT&&1012!==a.type&&a.type!==de&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),a.type=de,y=i.convert(a.type)),a.format===ge&&b===e.DEPTH_COMPONENT&&(b=e.DEPTH_STENCIL,a.type!==fe&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),a.type=fe,y=i.convert(a.type))),C&&(E?n.texStorage2D(e.TEXTURE_2D,1,b,m.width,m.height):n.texImage2D(e.TEXTURE_2D,0,b,m.width,m.height,0,g,y,null));else if(a.isDataTexture)if(x.length>0&&v){E&&C&&n.texStorage2D(e.TEXTURE_2D,M,b,x[0].width,x[0].height);for(var N=0,R=x.length;N<R;N++)h=x[N],E?n.texSubImage2D(e.TEXTURE_2D,N,0,0,h.width,h.height,g,y,h.data):n.texImage2D(e.TEXTURE_2D,N,b,h.width,h.height,0,g,y,h.data);a.generateMipmaps=!1}else E?(C&&n.texStorage2D(e.TEXTURE_2D,M,b,m.width,m.height),n.texSubImage2D(e.TEXTURE_2D,0,0,0,m.width,m.height,g,y,m.data)):n.texImage2D(e.TEXTURE_2D,0,b,m.width,m.height,0,g,y,m.data);else if(a.isCompressedTexture)if(a.isCompressedArrayTexture){E&&C&&n.texStorage3D(e.TEXTURE_2D_ARRAY,M,b,x[0].width,x[0].height,m.depth);for(var L=0,A=x.length;L<A;L++)h=x[L],a.format!==me?null!==g?E?n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,L,0,0,0,h.width,h.height,m.depth,g,h.data,0,0):n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,L,b,h.width,h.height,m.depth,0,h.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):E?n.texSubImage3D(e.TEXTURE_2D_ARRAY,L,0,0,0,h.width,h.height,m.depth,g,y,h.data):n.texImage3D(e.TEXTURE_2D_ARRAY,L,b,h.width,h.height,m.depth,0,g,y,h.data)}else{E&&C&&n.texStorage2D(e.TEXTURE_2D,M,b,x[0].width,x[0].height);for(var P=0,D=x.length;P<D;P++)h=x[P],a.format!==me?null!==g?E?n.compressedTexSubImage2D(e.TEXTURE_2D,P,0,0,h.width,h.height,g,h.data):n.compressedTexImage2D(e.TEXTURE_2D,P,b,h.width,h.height,0,h.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):E?n.texSubImage2D(e.TEXTURE_2D,P,0,0,h.width,h.height,g,y,h.data):n.texImage2D(e.TEXTURE_2D,P,b,h.width,h.height,0,g,y,h.data)}else if(a.isDataArrayTexture)E?(C&&n.texStorage3D(e.TEXTURE_2D_ARRAY,M,b,m.width,m.height,m.depth),n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,m.width,m.height,m.depth,g,y,m.data)):n.texImage3D(e.TEXTURE_2D_ARRAY,0,b,m.width,m.height,m.depth,0,g,y,m.data);else if(a.isData3DTexture)E?(C&&n.texStorage3D(e.TEXTURE_3D,M,b,m.width,m.height,m.depth),n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,m.width,m.height,m.depth,g,y,m.data)):n.texImage3D(e.TEXTURE_3D,0,b,m.width,m.height,m.depth,0,g,y,m.data);else if(a.isFramebufferTexture){if(C)if(E)n.texStorage2D(e.TEXTURE_2D,M,b,m.width,m.height);else for(var F=m.width,G=m.height,W=0;W<M;W++)n.texImage2D(e.TEXTURE_2D,W,b,F,G,0,g,y,null),F>>=1,G>>=1}else if(x.length>0&&v){E&&C&&n.texStorage2D(e.TEXTURE_2D,M,b,x[0].width,x[0].height);for(var V=0,U=x.length;V<U;V++)h=x[V],E?n.texSubImage2D(e.TEXTURE_2D,V,0,0,g,y,h):n.texImage2D(e.TEXTURE_2D,V,b,g,y,h);a.generateMipmaps=!1}else E?(C&&n.texStorage2D(e.TEXTURE_2D,M,b,m.width,m.height),n.texSubImage2D(e.TEXTURE_2D,0,0,0,g,y,m)):n.texImage2D(e.TEXTURE_2D,0,b,g,y,m);S(a,v)&&T(s),d.__version=c.version,a.onUpdate&&a.onUpdate(a)}t.__version=a.version}function G(t,a,o,s,u){var c=i.convert(o.format,o.colorSpace),l=i.convert(o.type),d=_(o.internalFormat,c,l,o.colorSpace);r.get(a).__hasExternalTextures||(u===e.TEXTURE_3D||u===e.TEXTURE_2D_ARRAY?n.texImage3D(u,0,d,a.width,a.height,a.depth,0,c,l,null):n.texImage2D(u,0,d,a.width,a.height,0,c,l,null)),n.bindFramebuffer(e.FRAMEBUFFER,t),X(a)?m.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,s,u,r.get(o).__webglTexture,0,U(a)):(u===e.TEXTURE_2D||u>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&u<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,s,u,r.get(o).__webglTexture,0),n.bindFramebuffer(e.FRAMEBUFFER,null)}function W(t,n,r){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer&&!n.stencilBuffer){var a=e.DEPTH_COMPONENT16;if(r||X(n)){var o=n.depthTexture;o&&o.isDepthTexture&&(o.type===he?a=e.DEPTH_COMPONENT32F:o.type===de&&(a=e.DEPTH_COMPONENT24));var s=U(n);X(n)?m.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,s,a,n.width,n.height):e.renderbufferStorageMultisample(e.RENDERBUFFER,s,a,n.width,n.height)}else e.renderbufferStorage(e.RENDERBUFFER,a,n.width,n.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(n.depthBuffer&&n.stencilBuffer){var u=U(n);r&&!1===X(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,u,e.DEPTH24_STENCIL8,n.width,n.height):X(n)?m.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,u,e.DEPTH24_STENCIL8,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else for(var c=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture],l=0;l<c.length;l++){var d=c[l],h=i.convert(d.format,d.colorSpace),p=i.convert(d.type),f=_(d.internalFormat,h,p,d.colorSpace),v=U(n);r&&!1===X(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,v,f,n.width,n.height):X(n)?m.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,v,f,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,f,n.width,n.height)}e.bindRenderbuffer(e.RENDERBUFFER,null)}function V(t){var a=r.get(t),i=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!a.__autoAllocateDepthBuffer){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,a){if(a&&a.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!a.depthTexture||!a.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(a.depthTexture).__webglTexture&&a.depthTexture.image.width===a.width&&a.depthTexture.image.height===a.height||(a.depthTexture.image.width=a.width,a.depthTexture.image.height=a.height,a.depthTexture.needsUpdate=!0),A(a.depthTexture,0);var i=r.get(a.depthTexture).__webglTexture,o=U(a);if(a.depthTexture.format===ve)X(a)?m.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,i,0,o):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,i,0);else{if(a.depthTexture.format!==ge)throw new Error("Unknown depthTexture format");X(a)?m.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,i,0,o):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,i,0)}}(a.__webglFramebuffer,t)}else if(i){a.__webglDepthbuffer=[];for(var o=0;o<6;o++)n.bindFramebuffer(e.FRAMEBUFFER,a.__webglFramebuffer[o]),a.__webglDepthbuffer[o]=e.createRenderbuffer(),W(a.__webglDepthbuffer[o],t,!1)}else n.bindFramebuffer(e.FRAMEBUFFER,a.__webglFramebuffer),a.__webglDepthbuffer=e.createRenderbuffer(),W(a.__webglDepthbuffer,t,!1);n.bindFramebuffer(e.FRAMEBUFFER,null)}function U(e){return Math.min(f,e.samples)}function X(e){var n=r.get(e);return l&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function B(e,n){var r=e.colorSpace,a=e.format,i=e.type;return!0===e.isCompressedTexture||e.format===Fe||r!==Ae&&r!==Re&&(r===Le?!1===l?!0===t.has("EXT_sRGB")&&a===me?(e.format=Fe,e.minFilter=se,e.generateMipmaps=!1):n=ht.sRGBToLinear(n):a===me&&i===le||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",r)),n}this.allocateTextureUnit=function(){var e=L;return e>=d&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+d),L+=1,e},this.resetTextureUnits=function(){L=0},this.setTexture2D=A,this.setTexture2DArray=function(t,a){var i=r.get(t);t.version>0&&i.__version!==t.version?F(i,t,a):n.bindTexture(e.TEXTURE_2D_ARRAY,i.__webglTexture,e.TEXTURE0+a)},this.setTexture3D=function(t,a){var i=r.get(t);t.version>0&&i.__version!==t.version?F(i,t,a):n.bindTexture(e.TEXTURE_3D,i.__webglTexture,e.TEXTURE0+a)},this.setTextureCube=function(t,a){var o=r.get(t);t.version>0&&o.__version!==t.version?function(t,a,o){if(6!==a.image.length)return;var s=z(t,a),u=a.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+o);var c=r.get(u);if(u.version!==c.__version||!0===s){n.activeTexture(e.TEXTURE0+o),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,a.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,a.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE);for(var d=a.isCompressedTexture||a.image[0].isCompressedTexture,p=a.image[0]&&a.image[0].isDataTexture,f=[],m=0;m<6;m++)f[m]=d||p?p?a.image[m].image:a.image[m]:w(a.image[m],!1,!0,h),f[m]=B(a,f[m]);var v,g=f[0],y=k(g)||l,b=i.convert(a.format,a.colorSpace),x=i.convert(a.type),E=_(a.internalFormat,b,x,a.colorSpace),C=l&&!0!==a.isVideoTexture,M=void 0===c.__version||!0===s,N=I(a,g,y);if(O(e.TEXTURE_CUBE_MAP,a,y),d){C&&M&&n.texStorage2D(e.TEXTURE_CUBE_MAP,N,E,g.width,g.height);for(var R=0;R<6;R++){v=f[R].mipmaps;for(var L=0;L<v.length;L++){var A=v[L];a.format!==me?null!==b?C?n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+R,L,0,0,A.width,A.height,b,A.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+R,L,E,A.width,A.height,0,A.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):C?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+R,L,0,0,A.width,A.height,b,x,A.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+R,L,E,A.width,A.height,0,b,x,A.data)}}}else{v=a.mipmaps,C&&M&&(v.length>0&&N++,n.texStorage2D(e.TEXTURE_CUBE_MAP,N,E,f[0].width,f[0].height));for(var P=0;P<6;P++)if(p){C?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+P,0,0,0,f[P].width,f[P].height,b,x,f[P].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+P,0,E,f[P].width,f[P].height,0,b,x,f[P].data);for(var D=0;D<v.length;D++){var F=v[D].image[P].image;C?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+P,D+1,0,0,F.width,F.height,b,x,F.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+P,D+1,E,F.width,F.height,0,b,x,F.data)}}else{C?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+P,0,0,0,b,x,f[P]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+P,0,E,b,x,f[P]);for(var G=0;G<v.length;G++){var W=v[G];C?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+P,G+1,0,0,b,x,W.image[P]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+P,G+1,E,b,x,W.image[P])}}}S(a,y)&&T(e.TEXTURE_CUBE_MAP),c.__version=u.version,a.onUpdate&&a.onUpdate(a)}t.__version=a.version}(o,t,a):n.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture,e.TEXTURE0+a)},this.rebindTextures=function(t,n,a){var i=r.get(t);void 0!==n&&G(i.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D),void 0!==a&&V(t)},this.setupRenderTarget=function(t){var s=t.texture,u=r.get(t),c=r.get(s);t.addEventListener("dispose",M),!0!==t.isWebGLMultipleRenderTargets&&(void 0===c.__webglTexture&&(c.__webglTexture=e.createTexture()),c.__version=s.version,o.memory.textures++);var d=!0===t.isWebGLCubeRenderTarget,h=!0===t.isWebGLMultipleRenderTargets,p=k(t)||l;if(d){u.__webglFramebuffer=[];for(var f=0;f<6;f++)u.__webglFramebuffer[f]=e.createFramebuffer()}else{if(u.__webglFramebuffer=e.createFramebuffer(),h)if(a.drawBuffers)for(var m=t.texture,v=0,g=m.length;v<g;v++){var y=r.get(m[v]);void 0===y.__webglTexture&&(y.__webglTexture=e.createTexture(),o.memory.textures++)}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(l&&t.samples>0&&!1===X(t)){var b=h?s:[s];u.__webglMultisampledFramebuffer=e.createFramebuffer(),u.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer);for(var x=0;x<b.length;x++){var w=b[x];u.__webglColorRenderbuffer[x]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,u.__webglColorRenderbuffer[x]);var I=i.convert(w.format,w.colorSpace),E=i.convert(w.type),C=_(w.internalFormat,I,E,w.colorSpace,!0===t.isXRRenderTarget),N=U(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,N,C,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+x,e.RENDERBUFFER,u.__webglColorRenderbuffer[x])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(u.__webglDepthRenderbuffer=e.createRenderbuffer(),W(u.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(d){n.bindTexture(e.TEXTURE_CUBE_MAP,c.__webglTexture),O(e.TEXTURE_CUBE_MAP,s,p);for(var R=0;R<6;R++)G(u.__webglFramebuffer[R],t,s,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+R);S(s,p)&&T(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(h){for(var L=t.texture,A=0,P=L.length;A<P;A++){var D=L[A],z=r.get(D);n.bindTexture(e.TEXTURE_2D,z.__webglTexture),O(e.TEXTURE_2D,D,p),G(u.__webglFramebuffer,t,D,e.COLOR_ATTACHMENT0+A,e.TEXTURE_2D),S(D,p)&&T(e.TEXTURE_2D)}n.unbindTexture()}else{var F=e.TEXTURE_2D;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(l?F=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(F,c.__webglTexture),O(F,s,p),G(u.__webglFramebuffer,t,s,e.COLOR_ATTACHMENT0,F),S(s,p)&&T(F),n.unbindTexture()}t.depthBuffer&&V(t)},this.updateRenderTargetMipmap=function(t){for(var a=k(t)||l,i=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture],o=0,s=i.length;o<s;o++){var u=i[o];if(S(u,a)){var c=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,d=r.get(u).__webglTexture;n.bindTexture(c,d),T(c),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(l&&t.samples>0&&!1===X(t)){var a=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],i=t.width,o=t.height,s=e.COLOR_BUFFER_BIT,u=[],c=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,d=r.get(t),h=!0===t.isWebGLMultipleRenderTargets;if(h)for(var p=0;p<a.length;p++)n.bindFramebuffer(e.FRAMEBUFFER,d.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+p,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,d.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+p,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,d.__webglMultisampledFramebuffer),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,d.__webglFramebuffer);for(var f=0;f<a.length;f++){u.push(e.COLOR_ATTACHMENT0+f),t.depthBuffer&&u.push(c);var m=void 0!==d.__ignoreDepthValues&&d.__ignoreDepthValues;if(!1===m&&(t.depthBuffer&&(s|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&(s|=e.STENCIL_BUFFER_BIT)),h&&e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,d.__webglColorRenderbuffer[f]),!0===m&&(e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[c]),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[c])),h){var g=r.get(a[f]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,g,0)}e.blitFramebuffer(0,0,i,o,0,0,i,o,s,e.NEAREST),v&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,u)}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),h)for(var y=0;y<a.length;y++){n.bindFramebuffer(e.FRAMEBUFFER,d.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+y,e.RENDERBUFFER,d.__webglColorRenderbuffer[y]);var b=r.get(a[y]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,d.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+y,e.TEXTURE_2D,b,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,d.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=V,this.setupFrameBufferTexture=G,this.useMultisampledRTT=X}function fo(e,t,n){var r=n.isWebGL2;return{convert:function(n){var a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Re;if(n===le)return e.UNSIGNED_BYTE;if(1017===n)return e.UNSIGNED_SHORT_4_4_4_4;if(1018===n)return e.UNSIGNED_SHORT_5_5_5_1;if(1010===n)return e.BYTE;if(1011===n)return e.SHORT;if(1012===n)return e.UNSIGNED_SHORT;if(1013===n)return e.INT;if(n===de)return e.UNSIGNED_INT;if(n===he)return e.FLOAT;if(n===pe)return r?e.HALF_FLOAT:null!==(a=t.get("OES_texture_half_float"))?a.HALF_FLOAT_OES:null;if(1021===n)return e.ALPHA;if(n===me)return e.RGBA;if(1024===n)return e.LUMINANCE;if(1025===n)return e.LUMINANCE_ALPHA;if(n===ve)return e.DEPTH_COMPONENT;if(n===ge)return e.DEPTH_STENCIL;if(n===Fe)return null!==(a=t.get("EXT_sRGB"))?a.SRGB_ALPHA_EXT:null;if(1028===n)return e.RED;if(1029===n)return e.RED_INTEGER;if(1030===n)return e.RG;if(1031===n)return e.RG_INTEGER;if(1033===n)return e.RGBA_INTEGER;if(n===ye||n===be||n===xe||n===we)if(i===Le){if(null===(a=t.get("WEBGL_compressed_texture_s3tc_srgb")))return null;if(n===ye)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===be)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===xe)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===we)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(a=t.get("WEBGL_compressed_texture_s3tc")))return null;if(n===ye)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===be)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===xe)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===we)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===n||35841===n||35842===n||35843===n){if(null===(a=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(35840===n)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===n)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===n)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===n)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===n)return null!==(a=t.get("WEBGL_compressed_texture_etc1"))?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===n||37496===n){if(null===(a=t.get("WEBGL_compressed_texture_etc")))return null;if(37492===n)return i===Le?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(37496===n)return i===Le?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}if(37808===n||37809===n||37810===n||37811===n||37812===n||37813===n||37814===n||37815===n||37816===n||37817===n||37818===n||37819===n||37820===n||37821===n){if(null===(a=t.get("WEBGL_compressed_texture_astc")))return null;if(37808===n)return i===Le?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===n)return i===Le?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===n)return i===Le?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===n)return i===Le?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===n)return i===Le?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===n)return i===Le?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===n)return i===Le?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===n)return i===Le?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===n)return i===Le?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===n)return i===Le?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===n)return i===Le?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===n)return i===Le?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===n)return i===Le?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===n)return i===Le?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===ke){if(null===(a=t.get("EXT_texture_compression_bptc")))return null;if(n===ke)return i===Le?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(36283===n||36284===n||36285===n||36286===n){if(null===(a=t.get("EXT_texture_compression_rgtc")))return null;if(n===ke)return a.COMPRESSED_RED_RGTC1_EXT;if(36284===n)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(36285===n)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(36286===n)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===fe?r?e.UNSIGNED_INT_24_8:null!==(a=t.get("WEBGL_depth_texture"))?a.UNSIGNED_INT_24_8_WEBGL:null:void 0!==e[n]?e[n]:null}}}var mo=function(e){m(n,e);var t=y(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return T(this,n),(e=t.call(this)).isArrayCamera=!0,e.cameras=r,e}return E(n)}(Lr),vo=function(e){m(n,e);var t=y(n);function n(){var e;return T(this,n),(e=t.call(this)).isGroup=!0,e.type="Group",e}return E(n)}(Tn),go={type:"move"},yo=function(){function e(){T(this,e),this._targetRay=null,this._grip=null,this._hand=null}return E(e,[{key:"getHandSpace",value:function(){return null===this._hand&&(this._hand=new vo,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}},{key:"getTargetRaySpace",value:function(){return null===this._targetRay&&(this._targetRay=new vo,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new kt,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new kt),this._targetRay}},{key:"getGripSpace",value:function(){return null===this._grip&&(this._grip=new vo,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new kt,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new kt),this._grip}},{key:"dispatchEvent",value:function(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}},{key:"connect",value:function(e){if(e&&e.hand){var t=this._hand;if(t){var n,r=x(e.hand.values());try{for(r.s();!(n=r.n()).done;){var a=n.value;this._getHandJoint(t,a)}}catch(i){r.e(i)}finally{r.f()}}}return this.dispatchEvent({type:"connected",data:e}),this}},{key:"disconnect",value:function(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}},{key:"update",value:function(e,t,n){var r=null,a=null,i=null,o=this._targetRay,s=this._grip,u=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(u&&e.hand){i=!0;var c,l=x(e.hand.values());try{for(l.s();!(c=l.n()).done;){var d=c.value,h=t.getJointPose(d,n),p=this._getHandJoint(u,d);null!==h&&(p.matrix.fromArray(h.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale),p.matrixWorldNeedsUpdate=!0,p.jointRadius=h.radius),p.visible=null!==h}}catch(g){l.e(g)}finally{l.f()}var f=u.joints["index-finger-tip"],m=u.joints["thumb-tip"],v=f.position.distanceTo(m.position);u.inputState.pinching&&v>.025?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&v<=.015&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&null!==(a=t.getPose(e.gripSpace,n))&&(s.matrix.fromArray(a.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,a.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(a.linearVelocity)):s.hasLinearVelocity=!1,a.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(a.angularVelocity)):s.hasAngularVelocity=!1);null!==o&&(null===(r=t.getPose(e.targetRaySpace,n))&&null!==a&&(r=a),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(go)))}return null!==o&&(o.visible=null!==r),null!==s&&(s.visible=null!==a),null!==u&&(u.visible=null!==i),this}},{key:"_getHandJoint",value:function(e,t){if(void 0===e.joints[t.jointName]){var n=new vo;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}]),e}(),bo=function(e){m(n,e);var t=y(n);function n(e,r,a,i,o,s,u,c,l,d){var h;if(T(this,n),(d=void 0!==d?d:ve)!==ve&&d!==ge)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");return void 0===a&&d===ve&&(a=de),void 0===a&&d===ge&&(a=fe),(h=t.call(this,null,i,o,s,u,c,d,a,l)).isDepthTexture=!0,h.image={width:e,height:r},h.magFilter=void 0!==u?u:ae,h.minFilter=void 0!==c?c:ae,h.flipY=!1,h.generateMipmaps=!1,h}return E(n)}(vt),xo=function(e){m(n,e);var t=y(n);function n(e,r){var a;T(this,n);var i=h(a=t.call(this)),o=null,s=1,u=null,c="local-floor",l=1,d=null,p=null,f=null,m=null,v=null,g=null,y=r.getContextAttributes(),b=null,k=null,_=[],I=[],E=new Set,C=new Map,M=new Lr;M.layers.enable(1),M.viewport=new gt;var N=new Lr;N.layers.enable(2),N.viewport=new gt;var R=[M,N],L=new mo;L.layers.enable(1),L.layers.enable(2);var A=null,P=null;function D(e){var t=I.indexOf(e.inputSource);if(-1!==t){var n=_[t];void 0!==n&&(n.update(e.inputSource,e.frame,d||u),n.dispatchEvent({type:e.type,data:e.inputSource}))}}function O(){o.removeEventListener("select",D),o.removeEventListener("selectstart",D),o.removeEventListener("selectend",D),o.removeEventListener("squeeze",D),o.removeEventListener("squeezestart",D),o.removeEventListener("squeezeend",D),o.removeEventListener("end",O),o.removeEventListener("inputsourceschange",z);for(var t=0;t<_.length;t++){var n=I[t];null!==n&&(I[t]=null,_[t].disconnect(n))}A=null,P=null,e.setRenderTarget(b),v=null,m=null,f=null,o=null,k=null,U.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function z(e){for(var t=0;t<e.removed.length;t++){var n=e.removed[t],r=I.indexOf(n);r>=0&&(I[r]=null,_[r].disconnect(n))}for(var a=0;a<e.added.length;a++){var i=e.added[a],o=I.indexOf(i);if(-1===o){for(var s=0;s<_.length;s++){if(s>=I.length){I.push(i),o=s;break}if(null===I[s]){I[s]=i,o=s;break}}if(-1===o)break}var u=_[o];u&&u.connect(i)}}a.cameraAutoUpdate=!0,a.enabled=!1,a.isPresenting=!1,a.getController=function(e){var t=_[e];return void 0===t&&(t=new yo,_[e]=t),t.getTargetRaySpace()},a.getControllerGrip=function(e){var t=_[e];return void 0===t&&(t=new yo,_[e]=t),t.getGripSpace()},a.getHand=function(e){var t=_[e];return void 0===t&&(t=new yo,_[e]=t),t.getHandSpace()},a.setFramebufferScaleFactor=function(e){s=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},a.setReferenceSpaceType=function(e){c=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},a.getReferenceSpace=function(){return d||u},a.setReferenceSpace=function(e){d=e},a.getBaseLayer=function(){return null!==m?m:v},a.getBinding=function(){return f},a.getFrame=function(){return g},a.getSession=function(){return o},a.setSession=function(){var t=S(w().mark((function t(n){var a,h,p,g,x;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null===(o=n)){t.next=25;break}if(b=e.getRenderTarget(),o.addEventListener("select",D),o.addEventListener("selectstart",D),o.addEventListener("selectend",D),o.addEventListener("squeeze",D),o.addEventListener("squeezestart",D),o.addEventListener("squeezeend",D),o.addEventListener("end",O),o.addEventListener("inputsourceschange",z),!0===y.xrCompatible){t.next=14;break}return t.next=14,r.makeXRCompatible();case 14:return void 0===o.renderState.layers||!1===e.capabilities.isWebGL2?(a={antialias:void 0!==o.renderState.layers||y.antialias,alpha:!0,depth:y.depth,stencil:y.stencil,framebufferScaleFactor:s},v=new XRWebGLLayer(o,r,a),o.updateRenderState({baseLayer:v}),k=new yt(v.framebufferWidth,v.framebufferHeight,{format:me,type:le,colorSpace:e.outputColorSpace,stencilBuffer:y.stencil})):(h=null,p=null,g=null,y.depth&&(g=y.stencil?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24,h=y.stencil?ge:ve,p=y.stencil?fe:de),x={colorFormat:r.RGBA8,depthFormat:g,scaleFactor:s},f=new XRWebGLBinding(o,r),m=f.createProjectionLayer(x),o.updateRenderState({layers:[m]}),k=new yt(m.textureWidth,m.textureHeight,{format:me,type:le,depthTexture:new bo(m.textureWidth,m.textureHeight,p,void 0,void 0,void 0,void 0,void 0,void 0,h),stencilBuffer:y.stencil,colorSpace:e.outputColorSpace,samples:y.antialias?4:0}),e.properties.get(k).__ignoreDepthValues=m.ignoreDepthValues),k.isXRRenderTarget=!0,this.setFoveation(l),d=null,t.next=20,o.requestReferenceSpace(c);case 20:u=t.sent,U.setContext(o),U.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"});case 25:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),a.getEnvironmentBlendMode=function(){if(null!==o)return o.environmentBlendMode};var F=new kt,G=new kt;function W(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}a.updateCamera=function(e){if(null!==o){L.near=N.near=M.near=e.near,L.far=N.far=M.far=e.far,A===L.near&&P===L.far||(o.updateRenderState({depthNear:L.near,depthFar:L.far}),A=L.near,P=L.far);var t=e.parent,n=L.cameras;W(L,t);for(var r=0;r<n.length;r++)W(n[r],t);2===n.length?function(e,t,n){F.setFromMatrixPosition(t.matrixWorld),G.setFromMatrixPosition(n.matrixWorld);var r=F.distanceTo(G),a=t.projectionMatrix.elements,i=n.projectionMatrix.elements,o=a[14]/(a[10]-1),s=a[14]/(a[10]+1),u=(a[9]+1)/a[5],c=(a[9]-1)/a[5],l=(a[8]-1)/a[0],d=(i[8]+1)/i[0],h=o*l,p=o*d,f=r/(-l+d),m=f*-l;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();var v=o+f,g=s+f,y=h-m,b=p+(r-m),x=u*s/g*v,w=c*s/g*v;e.projectionMatrix.makePerspective(y,b,x,w,v,g),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}(L,M,N):L.projectionMatrix.copy(M.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld));e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0);for(var r=e.children,a=0,i=r.length;a<i;a++)r[a].updateMatrixWorld(!0);e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*Ue*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,L,t)}},a.getCamera=function(){return L},a.getFoveation=function(){if(null!==m||null!==v)return l},a.setFoveation=function(e){l=e,null!==m&&(m.fixedFoveation=e),null!==v&&void 0!==v.fixedFoveation&&(v.fixedFoveation=e)},a.getPlanes=function(){return E};var V=null;var U=new Br;return U.setAnimationLoop((function(t,n){if(p=n.getViewerPose(d||u),g=n,null!==p){var r=p.views;null!==v&&(e.setRenderTargetFramebuffer(k,v.framebuffer),e.setRenderTarget(k));var a=!1;r.length!==L.cameras.length&&(L.cameras.length=0,a=!0);for(var o=0;o<r.length;o++){var s=r[o],c=null;if(null!==v)c=v.getViewport(s);else{var l=f.getViewSubImage(m,s);c=l.viewport,0===o&&(e.setRenderTargetTextures(k,l.colorTexture,m.ignoreDepthValues?void 0:l.depthStencilTexture),e.setRenderTarget(k))}var h=R[o];void 0===h&&((h=new Lr).layers.enable(o),h.viewport=new gt,R[o]=h),h.matrix.fromArray(s.transform.matrix),h.matrix.decompose(h.position,h.quaternion,h.scale),h.projectionMatrix.fromArray(s.projectionMatrix),h.projectionMatrixInverse.copy(h.projectionMatrix).invert(),h.viewport.set(c.x,c.y,c.width,c.height),0===o&&(L.matrix.copy(h.matrix),L.matrix.decompose(L.position,L.quaternion,L.scale)),!0===a&&L.cameras.push(h)}}for(var y=0;y<_.length;y++){var b=I[y],w=_[y];null!==b&&void 0!==w&&w.update(b,n,d||u)}if(V&&V(t,n),n.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:n.detectedPlanes});var S,T=null,M=x(E);try{for(M.s();!(S=M.n()).done;){var N=S.value;n.detectedPlanes.has(N)||(null===T&&(T=[]),T.push(N))}}catch(W){M.e(W)}finally{M.f()}if(null!==T){var A,P=x(T);try{for(P.s();!(A=P.n()).done;){var D=A.value;E.delete(D),C.delete(D),i.dispatchEvent({type:"planeremoved",data:D})}}catch(W){P.e(W)}finally{P.f()}}var O,z=x(n.detectedPlanes);try{for(z.s();!(O=z.n()).done;){var F=O.value;if(E.has(F)){var G=C.get(F);F.lastChangedTime>G&&(C.set(F,F.lastChangedTime),i.dispatchEvent({type:"planechanged",data:F}))}else E.add(F),C.set(F,n.lastChangedTime),i.dispatchEvent({type:"planeadded",data:F})}}catch(W){z.e(W)}finally{z.f()}}g=null})),a.setAnimationLoop=function(e){V=e},a.dispose=function(){},a}return E(n)}(Ge);function wo(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function r(r,a){r.opacity.value=a.opacity,a.color&&r.diffuse.value.copy(a.color),a.emissive&&r.emissive.value.copy(a.emissive).multiplyScalar(a.emissiveIntensity),a.map&&(r.map.value=a.map,n(a.map,r.mapTransform)),a.alphaMap&&(r.alphaMap.value=a.alphaMap,n(a.alphaMap,r.alphaMapTransform)),a.bumpMap&&(r.bumpMap.value=a.bumpMap,n(a.bumpMap,r.bumpMapTransform),r.bumpScale.value=a.bumpScale,a.side===z&&(r.bumpScale.value*=-1)),a.normalMap&&(r.normalMap.value=a.normalMap,n(a.normalMap,r.normalMapTransform),r.normalScale.value.copy(a.normalScale),a.side===z&&r.normalScale.value.negate()),a.displacementMap&&(r.displacementMap.value=a.displacementMap,n(a.displacementMap,r.displacementMapTransform),r.displacementScale.value=a.displacementScale,r.displacementBias.value=a.displacementBias),a.emissiveMap&&(r.emissiveMap.value=a.emissiveMap,n(a.emissiveMap,r.emissiveMapTransform)),a.specularMap&&(r.specularMap.value=a.specularMap,n(a.specularMap,r.specularMapTransform)),a.alphaTest>0&&(r.alphaTest.value=a.alphaTest);var i=t.get(a).envMap;if(i&&(r.envMap.value=i,r.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,r.reflectivity.value=a.reflectivity,r.ior.value=a.ior,r.refractionRatio.value=a.refractionRatio),a.lightMap){r.lightMap.value=a.lightMap;var o=!0===e.useLegacyLights?Math.PI:1;r.lightMapIntensity.value=a.lightMapIntensity*o,n(a.lightMap,r.lightMapTransform)}a.aoMap&&(r.aoMap.value=a.aoMap,r.aoMapIntensity.value=a.aoMapIntensity,n(a.aoMap,r.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,Cr(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,a,i,o,s){a.isMeshBasicMaterial||a.isMeshLambertMaterial?r(e,a):a.isMeshToonMaterial?(r(e,a),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,a)):a.isMeshPhongMaterial?(r(e,a),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,a)):a.isMeshStandardMaterial?(r(e,a),function(e,r){e.metalness.value=r.metalness,r.metalnessMap&&(e.metalnessMap.value=r.metalnessMap,n(r.metalnessMap,e.metalnessMapTransform));e.roughness.value=r.roughness,r.roughnessMap&&(e.roughnessMap.value=r.roughnessMap,n(r.roughnessMap,e.roughnessMapTransform));var a=t.get(r).envMap;a&&(e.envMapIntensity.value=r.envMapIntensity)}(e,a),a.isMeshPhysicalMaterial&&function(e,t,r){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform)));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),t.side===z&&e.clearcoatNormalScale.value.negate()));t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform)));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=r.texture,e.transmissionSamplerSize.value.set(r.width,r.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform));t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,a,s)):a.isMeshMatcapMaterial?(r(e,a),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,a)):a.isMeshDepthMaterial?r(e,a):a.isMeshDistanceMaterial?(r(e,a),function(e,n){var r=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(r.matrixWorld),e.nearDistance.value=r.shadow.camera.near,e.farDistance.value=r.shadow.camera.far}(e,a)):a.isMeshNormalMaterial?r(e,a):a.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,a),a.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,a)):a.isPointsMaterial?function(e,t,r,a){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*r,e.scale.value=.5*a,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,a,i,o):a.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,a):a.isShadowMaterial?(e.color.value.copy(a.color),e.opacity.value=a.opacity):a.isShaderMaterial&&(a.uniformsNeedUpdate=!1)}}}function ko(e,t,n,r){var a={},i={},o=[],s=n.isWebGL2?e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS):0;function u(e,t,n){var r=e.value;if(void 0===n[t]){if("number"===typeof r)n[t]=r;else{for(var a=Array.isArray(r)?r:[r],i=[],o=0;o<a.length;o++)i.push(a[o].clone());n[t]=i}return!0}if("number"===typeof r){if(n[t]!==r)return n[t]=r,!0}else for(var s=Array.isArray(n[t])?n[t]:[n[t]],u=Array.isArray(r)?r:[r],c=0;c<s.length;c++){var l=s[c];if(!1===l.equals(u[c]))return l.copy(u[c]),!0}return!1}function c(e){var t={boundary:0,storage:0};return"number"===typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function l(t){var n=t.target;n.removeEventListener("dispose",l);var r=o.indexOf(n.__bindingPointIndex);o.splice(r,1),e.deleteBuffer(a[n.id]),delete a[n.id],delete i[n.id]}return{bind:function(e,t){var n=t.program;r.uniformBlockBinding(e,n)},update:function(n,d){var h=a[n.id];void 0===h&&(!function(e){for(var t=e.uniforms,n=0,r=16,a=0,i=0,o=t.length;i<o;i++){for(var s=t[i],u={boundary:0,storage:0},l=Array.isArray(s.value)?s.value:[s.value],d=0,h=l.length;d<h;d++){var p=c(l[d]);u.boundary+=p.boundary,u.storage+=p.storage}if(s.__data=new Float32Array(u.storage/Float32Array.BYTES_PER_ELEMENT),s.__offset=n,i>0)0!==(a=n%r)&&r-a-u.boundary<0&&(n+=r-a,s.__offset=n);n+=u.storage}(a=n%r)>0&&(n+=r-a);e.__size=n,e.__cache={}}(n),h=function(t){var n=function(){for(var e=0;e<s;e++)if(-1===o.indexOf(e))return o.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;var r=e.createBuffer(),a=t.__size,i=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,r),e.bufferData(e.UNIFORM_BUFFER,a,i),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,r),r}(n),a[n.id]=h,n.addEventListener("dispose",l));var p=d.program;r.updateUBOMapping(n,p);var f=t.render.frame;i[n.id]!==f&&(!function(t){var n=a[t.id],r=t.uniforms,i=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(var o=0,s=r.length;o<s;o++){var l=r[o];if(!0===u(l,o,i)){for(var d=l.__offset,h=Array.isArray(l.value)?l.value:[l.value],p=0,f=0;f<h.length;f++){var m=h[f],v=c(m);"number"===typeof m?(l.__data[0]=m,e.bufferSubData(e.UNIFORM_BUFFER,d+p,l.__data)):m.isMatrix3?(l.__data[0]=m.elements[0],l.__data[1]=m.elements[1],l.__data[2]=m.elements[2],l.__data[3]=m.elements[0],l.__data[4]=m.elements[3],l.__data[5]=m.elements[4],l.__data[6]=m.elements[5],l.__data[7]=m.elements[0],l.__data[8]=m.elements[6],l.__data[9]=m.elements[7],l.__data[10]=m.elements[8],l.__data[11]=m.elements[0]):(m.toArray(l.__data,p),p+=v.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,d,l.__data)}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),i[n.id]=f)},dispose:function(){for(var t in a)e.deleteBuffer(a[t]);o=[],a={},i={}}}}var So=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};T(this,e);var n,r=t.canvas,a=void 0===r?function(){var e=tt("canvas");return e.style.display="block",e}():r,i=t.context,o=void 0===i?null:i,s=t.depth,u=void 0===s||s,c=t.stencil,l=void 0===c||c,d=t.alpha,h=void 0!==d&&d,p=t.antialias,f=void 0!==p&&p,m=t.premultipliedAlpha,v=void 0===m||m,g=t.preserveDrawingBuffer,y=void 0!==g&&g,b=t.powerPreference,x=void 0===b?"default":b,w=t.failIfMajorPerformanceCaveat,k=void 0!==w&&w;this.isWebGLRenderer=!0,n=null!==o?o.getContextAttributes().alpha:h;var S=null,_=null,I=[],E=[];this.domElement=a,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=Le,this.useLegacyLights=!0,this.toneMapping=B,this.toneMappingExposure=1;var C=this,M=!1,N=0,R=0,A=null,P=-1,D=null,G=new gt,W=new gt,V=null,U=a.width,X=a.height,H=1,Z=null,K=null,j=new gt(0,0,U,X),Y=new gt(0,0,U,X),Q=!1,J=new Xr,q=!1,$=!1,ee=null,te=new qt,ne=new kt,re={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ae(){return null===A?H:1}var ie,oe,se,ue,de,fe,ve,ge,ye,be,xe,we,ke,Se,Te,_e,Ie,Ee,Ce,Me,Ne,Re,Pe,De,Oe=o;function ze(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=a.getContext(r,t);if(null!==i)return i}return null}try{var Fe={alpha:!0,depth:u,stencil:l,antialias:f,premultipliedAlpha:v,preserveDrawingBuffer:y,powerPreference:x,failIfMajorPerformanceCaveat:k};if("setAttribute"in a&&a.setAttribute("data-engine","three.js r".concat(L)),a.addEventListener("webglcontextlost",Ue,!1),a.addEventListener("webglcontextrestored",Xe,!1),a.addEventListener("webglcontextcreationerror",Be,!1),null===Oe){var Ge=["webgl2","webgl","experimental-webgl"];if(!0===C.isWebGL1Renderer&&Ge.shift(),null===(Oe=ze(Ge,Fe)))throw ze(Ge)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===Oe.getShaderPrecisionFormat&&(Oe.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(rt){throw console.error("THREE.WebGLRenderer: "+rt.message),rt}function We(){ie=new ba(Oe),oe=new ea(Oe,ie,t),ie.init(oe),Re=new fo(Oe,ie,oe),se=new ho(Oe,ie,oe),ue=new ka(Oe),de=new Ji,fe=new po(Oe,ie,se,de,oe,Re,ue),ve=new na(C),ge=new ya(C),ye=new Hr(Oe,oe),Pe=new qr(Oe,ie,ye,oe),be=new xa(Oe,ye,ue,Pe),xe=new Ia(Oe,be,ye,ue),Ce=new _a(Oe,oe,fe),_e=new ta(de),we=new Qi(C,ve,ge,ie,oe,Pe,_e),ke=new wo(C,de),Se=new to,Te=new so(ie,oe),Ee=new Jr(C,ve,ge,se,xe,n,v),Ie=new lo(C,xe,oe),De=new ko(Oe,ue,oe,se),Me=new $r(Oe,ie,ue,oe),Ne=new wa(Oe,ie,ue,oe),ue.programs=we.programs,C.capabilities=oe,C.extensions=ie,C.properties=de,C.renderLists=Se,C.shadowMap=Ie,C.state=se,C.info=ue}We();var Ve=new xo(C,Oe);function Ue(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),M=!0}function Xe(){console.log("THREE.WebGLRenderer: Context Restored."),M=!1;var e=ue.autoReset,t=Ie.enabled,n=Ie.autoUpdate,r=Ie.needsUpdate,a=Ie.type;We(),ue.autoReset=e,Ie.enabled=t,Ie.autoUpdate=n,Ie.needsUpdate=r,Ie.type=a}function Be(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function He(e){var t=e.target;t.removeEventListener("dispose",He),function(e){(function(e){var t=de.get(e).programs;void 0!==t&&(t.forEach((function(e){we.releaseProgram(e)})),e.isShaderMaterial&&we.releaseShaderCache(e))})(e),de.remove(e)}(t)}this.xr=Ve,this.getContext=function(){return Oe},this.getContextAttributes=function(){return Oe.getContextAttributes()},this.forceContextLoss=function(){var e=ie.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=ie.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return H},this.setPixelRatio=function(e){void 0!==e&&(H=e,this.setSize(U,X,!1))},this.getSize=function(e){return e.set(U,X)},this.setSize=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];Ve.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(U=e,X=t,a.width=Math.floor(e*H),a.height=Math.floor(t*H),!0===n&&(a.style.width=e+"px",a.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(e){return e.set(U*H,X*H).floor()},this.setDrawingBufferSize=function(e,t,n){U=e,X=t,H=n,a.width=Math.floor(e*n),a.height=Math.floor(t*n),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return e.copy(G)},this.getViewport=function(e){return e.copy(j)},this.setViewport=function(e,t,n,r){e.isVector4?j.set(e.x,e.y,e.z,e.w):j.set(e,t,n,r),se.viewport(G.copy(j).multiplyScalar(H).floor())},this.getScissor=function(e){return e.copy(Y)},this.setScissor=function(e,t,n,r){e.isVector4?Y.set(e.x,e.y,e.z,e.w):Y.set(e,t,n,r),se.scissor(W.copy(Y).multiplyScalar(H).floor())},this.getScissorTest=function(){return Q},this.setScissorTest=function(e){se.setScissorTest(Q=e)},this.setOpaqueSort=function(e){Z=e},this.setTransparentSort=function(e){K=e},this.getClearColor=function(e){return e.copy(Ee.getClearColor())},this.setClearColor=function(){Ee.setClearColor.apply(Ee,arguments)},this.getClearAlpha=function(){return Ee.getClearAlpha()},this.setClearAlpha=function(){Ee.setClearAlpha.apply(Ee,arguments)},this.clear=function(){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=0;(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(n|=Oe.COLOR_BUFFER_BIT),e&&(n|=Oe.DEPTH_BUFFER_BIT),t&&(n|=Oe.STENCIL_BUFFER_BIT),Oe.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){a.removeEventListener("webglcontextlost",Ue,!1),a.removeEventListener("webglcontextrestored",Xe,!1),a.removeEventListener("webglcontextcreationerror",Be,!1),Se.dispose(),Te.dispose(),de.dispose(),ve.dispose(),ge.dispose(),xe.dispose(),Pe.dispose(),De.dispose(),we.dispose(),Ve.dispose(),Ve.removeEventListener("sessionstart",Ke),Ve.removeEventListener("sessionend",je),ee&&(ee.dispose(),ee=null),Ye.stop()},this.renderBufferDirect=function(e,t,n,r,a,i){null===t&&(t=re);var o=a.isMesh&&a.matrixWorld.determinant()<0,s=function(e,t,n,r,a){!0!==t.isScene&&(t=re);fe.resetTextureUnits();var i=t.fog,o=r.isMeshStandardMaterial?t.environment:null,s=null===A?C.outputColorSpace:!0===A.isXRRenderTarget?A.texture.colorSpace:Ae,u=(r.isMeshStandardMaterial?ge:ve).get(r.envMap||o),c=!0===r.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,l=!!r.normalMap&&!!n.attributes.tangent,d=!!n.morphAttributes.position,h=!!n.morphAttributes.normal,p=!!n.morphAttributes.color,f=r.toneMapped?C.toneMapping:B,m=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,v=void 0!==m?m.length:0,g=de.get(r),y=_.state.lights;if(!0===q&&(!0===$||e!==D)){var b=e===D&&r.id===P;_e.setState(r,e,b)}var x=!1;r.version===g.__version?g.needsLights&&g.lightsStateVersion!==y.state.version||g.outputColorSpace!==s||a.isInstancedMesh&&!1===g.instancing?x=!0:a.isInstancedMesh||!0!==g.instancing?a.isSkinnedMesh&&!1===g.skinning?x=!0:a.isSkinnedMesh||!0!==g.skinning?g.envMap!==u||!0===r.fog&&g.fog!==i?x=!0:void 0===g.numClippingPlanes||g.numClippingPlanes===_e.numPlanes&&g.numIntersection===_e.numIntersection?(g.vertexAlphas!==c||g.vertexTangents!==l||g.morphTargets!==d||g.morphNormals!==h||g.morphColors!==p||g.toneMapping!==f||!0===oe.isWebGL2&&g.morphTargetsCount!==v)&&(x=!0):x=!0:x=!0:x=!0:(x=!0,g.__version=r.version);var w=g.currentProgram;!0===x&&(w=et(r,t,a));var k=!1,S=!1,T=!1,I=w.getUniforms(),E=g.uniforms;se.useProgram(w.program)&&(k=!0,S=!0,T=!0);r.id!==P&&(P=r.id,S=!0);if(k||D!==e){if(I.setValue(Oe,"projectionMatrix",e.projectionMatrix),oe.logarithmicDepthBuffer&&I.setValue(Oe,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),D!==e&&(D=e,S=!0,T=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshStandardMaterial||r.envMap){var M=I.map.cameraPosition;void 0!==M&&M.setValue(Oe,ne.setFromMatrixPosition(e.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&I.setValue(Oe,"isOrthographic",!0===e.isOrthographicCamera),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.isShadowMaterial||a.isSkinnedMesh)&&I.setValue(Oe,"viewMatrix",e.matrixWorldInverse)}if(a.isSkinnedMesh){I.setOptional(Oe,a,"bindMatrix"),I.setOptional(Oe,a,"bindMatrixInverse");var N=a.skeleton;N&&(oe.floatVertexTextures?(null===N.boneTexture&&N.computeBoneTexture(),I.setValue(Oe,"boneTexture",N.boneTexture,fe),I.setValue(Oe,"boneTextureSize",N.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}var R=n.morphAttributes;(void 0!==R.position||void 0!==R.normal||void 0!==R.color&&!0===oe.isWebGL2)&&Ce.update(a,n,w);(S||g.receiveShadow!==a.receiveShadow)&&(g.receiveShadow=a.receiveShadow,I.setValue(Oe,"receiveShadow",a.receiveShadow));r.isMeshGouraudMaterial&&null!==r.envMap&&(E.envMap.value=u,E.flipEnvMap.value=u.isCubeTexture&&!1===u.isRenderTargetTexture?-1:1);S&&(I.setValue(Oe,"toneMappingExposure",C.toneMappingExposure),g.needsLights&&(O=T,(L=E).ambientLightColor.needsUpdate=O,L.lightProbe.needsUpdate=O,L.directionalLights.needsUpdate=O,L.directionalLightShadows.needsUpdate=O,L.pointLights.needsUpdate=O,L.pointLightShadows.needsUpdate=O,L.spotLights.needsUpdate=O,L.spotLightShadows.needsUpdate=O,L.rectAreaLights.needsUpdate=O,L.hemisphereLights.needsUpdate=O),i&&!0===r.fog&&ke.refreshFogUniforms(E,i),ke.refreshMaterialUniforms(E,r,H,X,ee),Ni.upload(Oe,g.uniformsList,E,fe));var L,O;r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(Ni.upload(Oe,g.uniformsList,E,fe),r.uniformsNeedUpdate=!1);r.isSpriteMaterial&&I.setValue(Oe,"center",a.center);if(I.setValue(Oe,"modelViewMatrix",a.modelViewMatrix),I.setValue(Oe,"normalMatrix",a.normalMatrix),I.setValue(Oe,"modelMatrix",a.matrixWorld),r.isShaderMaterial||r.isRawShaderMaterial)for(var z=r.uniformsGroups,F=0,G=z.length;F<G;F++)if(oe.isWebGL2){var W=z[F];De.update(W,w),De.bind(W,w)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.");return w}(e,t,n,r,a);se.setMaterial(r,o);var u=n.index,c=1;!0===r.wireframe&&(u=be.getWireframeAttribute(n),c=2);var l=n.drawRange,d=n.attributes.position,h=l.start*c,p=(l.start+l.count)*c;null!==i&&(h=Math.max(h,i.start*c),p=Math.min(p,(i.start+i.count)*c)),null!==u?(h=Math.max(h,0),p=Math.min(p,u.count)):void 0!==d&&null!==d&&(h=Math.max(h,0),p=Math.min(p,d.count));var f=p-h;if(!(f<0||f===1/0)){var m;Pe.setup(a,r,s,n,u);var v=Me;if(null!==u&&(m=ye.get(u),(v=Ne).setIndex(m)),a.isMesh)!0===r.wireframe?(se.setLineWidth(r.wireframeLinewidth*ae()),v.setMode(Oe.LINES)):v.setMode(Oe.TRIANGLES);else if(a.isLine){var g=r.linewidth;void 0===g&&(g=1),se.setLineWidth(g*ae()),a.isLineSegments?v.setMode(Oe.LINES):a.isLineLoop?v.setMode(Oe.LINE_LOOP):v.setMode(Oe.LINE_STRIP)}else a.isPoints?v.setMode(Oe.POINTS):a.isSprite&&v.setMode(Oe.TRIANGLES);if(a.isInstancedMesh)v.renderInstances(h,f,a.count);else if(n.isInstancedBufferGeometry){var y=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,b=Math.min(n.instanceCount,y);v.renderInstances(h,f,b)}else v.render(h,f)}},this.compile=function(e,t){function n(e,t,n){!0===e.transparent&&e.side===F&&!1===e.forceSinglePass?(e.side=z,e.needsUpdate=!0,et(e,t,n),e.side=O,e.needsUpdate=!0,et(e,t,n),e.side=F):et(e,t,n)}(_=Te.get(e)).init(),E.push(_),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(_.pushLight(e),e.castShadow&&_.pushShadow(e))})),_.setupLights(C.useLegacyLights),e.traverse((function(t){var r=t.material;if(r)if(Array.isArray(r))for(var a=0;a<r.length;a++){n(r[a],e,t)}else n(r,e,t)})),E.pop(),_=null};var Ze=null;function Ke(){Ye.stop()}function je(){Ye.start()}var Ye=new Br;function Qe(e,t,n,r){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)_.pushLight(e),e.castShadow&&_.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||J.intersectsSprite(e)){r&&ne.setFromMatrixPosition(e.matrixWorld).applyMatrix4(te);var a=xe.update(e),i=e.material;i.visible&&S.push(e,a,i,n,ne.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||J.intersectsObject(e))){e.isSkinnedMesh&&e.skeleton.frame!==ue.render.frame&&(e.skeleton.update(),e.skeleton.frame=ue.render.frame);var o=xe.update(e),s=e.material;if(r&&(null===o.boundingSphere&&o.computeBoundingSphere(),ne.copy(o.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(te)),Array.isArray(s))for(var u=o.groups,c=0,l=u.length;c<l;c++){var d=u[c],h=s[d.materialIndex];h&&h.visible&&S.push(e,o,h,n,ne.z,d)}else s.visible&&S.push(e,o,s,n,ne.z,null)}for(var p=e.children,f=0,m=p.length;f<m;f++)Qe(p[f],t,n,r)}}function Je(e,t,n,r){var a=e.opaque,i=e.transmissive,o=e.transparent;_.setupLightsView(n),!0===q&&_e.setGlobalState(C.clippingPlanes,n),i.length>0&&function(e,t,n,r){if(null===ee){var a=oe.isWebGL2;ee=new yt(1024,1024,{generateMipmaps:!0,type:ie.has("EXT_color_buffer_half_float")?pe:le,minFilter:ce,samples:a&&!0===f?4:0})}var i=C.getRenderTarget();C.setRenderTarget(ee),C.clear();var o=C.toneMapping;C.toneMapping=B,qe(e,n,r),fe.updateMultisampleRenderTarget(ee),fe.updateRenderTargetMipmap(ee);for(var s=!1,u=0,c=t.length;u<c;u++){var l=t[u],d=l.object,h=l.geometry,p=l.material,m=l.group;if(p.side===F&&d.layers.test(r.layers)){var v=p.side;p.side=z,p.needsUpdate=!0,$e(d,n,r,h,p,m),p.side=v,p.needsUpdate=!0,s=!0}}!0===s&&(fe.updateMultisampleRenderTarget(ee),fe.updateRenderTargetMipmap(ee));C.setRenderTarget(i),C.toneMapping=o}(a,i,t,n),r&&se.viewport(G.copy(r)),a.length>0&&qe(a,t,n),i.length>0&&qe(i,t,n),o.length>0&&qe(o,t,n),se.buffers.depth.setTest(!0),se.buffers.depth.setMask(!0),se.buffers.color.setMask(!0),se.setPolygonOffset(!1)}function qe(e,t,n){for(var r=!0===t.isScene?t.overrideMaterial:null,a=0,i=e.length;a<i;a++){var o=e[a],s=o.object,u=o.geometry,c=null===r?o.material:r,l=o.group;s.layers.test(n.layers)&&$e(s,t,n,u,c,l)}}function $e(e,t,n,r,a,i){e.onBeforeRender(C,t,n,r,a,i),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),a.onBeforeRender(C,t,n,r,e,i),!0===a.transparent&&a.side===F&&!1===a.forceSinglePass?(a.side=z,a.needsUpdate=!0,C.renderBufferDirect(n,t,r,a,e,i),a.side=O,a.needsUpdate=!0,C.renderBufferDirect(n,t,r,a,e,i),a.side=F):C.renderBufferDirect(n,t,r,a,e,i),e.onAfterRender(C,t,n,r,a,i)}function et(e,t,n){!0!==t.isScene&&(t=re);var r=de.get(e),a=_.state.lights,i=_.state.shadowsArray,o=a.state.version,s=we.getParameters(e,a.state,i,t,n),u=we.getProgramCacheKey(s),c=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?ge:ve).get(e.envMap||r.environment),void 0===c&&(e.addEventListener("dispose",He),c=new Map,r.programs=c);var l=c.get(u);if(void 0!==l){if(r.currentProgram===l&&r.lightsStateVersion===o)return nt(e,s),l}else s.uniforms=we.getUniforms(e),e.onBuild(n,s,C),e.onBeforeCompile(s,C),l=we.acquireProgram(s,u),c.set(u,l),r.uniforms=s.uniforms;var d=r.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(d.clippingPlanes=_e.uniform),nt(e,s),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=o,r.needsLights&&(d.ambientLightColor.value=a.state.ambient,d.lightProbe.value=a.state.probe,d.directionalLights.value=a.state.directional,d.directionalLightShadows.value=a.state.directionalShadow,d.spotLights.value=a.state.spot,d.spotLightShadows.value=a.state.spotShadow,d.rectAreaLights.value=a.state.rectArea,d.ltc_1.value=a.state.rectAreaLTC1,d.ltc_2.value=a.state.rectAreaLTC2,d.pointLights.value=a.state.point,d.pointLightShadows.value=a.state.pointShadow,d.hemisphereLights.value=a.state.hemi,d.directionalShadowMap.value=a.state.directionalShadowMap,d.directionalShadowMatrix.value=a.state.directionalShadowMatrix,d.spotShadowMap.value=a.state.spotShadowMap,d.spotLightMatrix.value=a.state.spotLightMatrix,d.spotLightMap.value=a.state.spotLightMap,d.pointShadowMap.value=a.state.pointShadowMap,d.pointShadowMatrix.value=a.state.pointShadowMatrix);var h=l.getUniforms(),p=Ni.seqWithValue(h.seq,d);return r.currentProgram=l,r.uniformsList=p,l}function nt(e,t){var n=de.get(e);n.outputColorSpace=t.outputColorSpace,n.instancing=t.instancing,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}Ye.setAnimationLoop((function(e){Ze&&Ze(e)})),"undefined"!==typeof self&&Ye.setContext(self),this.setAnimationLoop=function(e){Ze=e,Ve.setAnimationLoop(e),null===e?Ye.stop():Ye.start()},Ve.addEventListener("sessionstart",Ke),Ve.addEventListener("sessionend",je),this.render=function(e,t){if(void 0===t||!0===t.isCamera){if(!0!==M){!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===Ve.enabled&&!0===Ve.isPresenting&&(!0===Ve.cameraAutoUpdate&&Ve.updateCamera(t),t=Ve.getCamera()),!0===e.isScene&&e.onBeforeRender(C,e,t,A),(_=Te.get(e,E.length)).init(),E.push(_),te.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),J.setFromProjectionMatrix(te),$=this.localClippingEnabled,q=_e.init(this.clippingPlanes,$),(S=Se.get(e,I.length)).init(),I.push(S),Qe(e,t,0,C.sortObjects),S.finish(),!0===C.sortObjects&&S.sort(Z,K),!0===q&&_e.beginShadows();var n=_.state.shadowsArray;if(Ie.render(n,e,t),!0===q&&_e.endShadows(),!0===this.info.autoReset&&this.info.reset(),Ee.render(S,e),_.setupLights(C.useLegacyLights),t.isArrayCamera)for(var r=t.cameras,a=0,i=r.length;a<i;a++){var o=r[a];Je(S,e,o,o.viewport)}else Je(S,e,t);null!==A&&(fe.updateMultisampleRenderTarget(A),fe.updateRenderTargetMipmap(A)),!0===e.isScene&&e.onAfterRender(C,e,t),Pe.resetDefaultState(),P=-1,D=null,E.pop(),_=E.length>0?E[E.length-1]:null,I.pop(),S=I.length>0?I[I.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return N},this.getActiveMipmapLevel=function(){return R},this.getRenderTarget=function(){return A},this.setRenderTargetTextures=function(e,t,n){de.get(e.texture).__webglTexture=t,de.get(e.depthTexture).__webglTexture=n;var r=de.get(e);r.__hasExternalTextures=!0,r.__hasExternalTextures&&(r.__autoAllocateDepthBuffer=void 0===n,r.__autoAllocateDepthBuffer||!0===ie.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),r.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){var n=de.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;A=e,N=t,R=n;var r=!0,a=null,i=!1,o=!1;if(e){var s=de.get(e);void 0!==s.__useDefaultFramebuffer?(se.bindFramebuffer(Oe.FRAMEBUFFER,null),r=!1):void 0===s.__webglFramebuffer?fe.setupRenderTarget(e):s.__hasExternalTextures&&fe.rebindTextures(e,de.get(e.texture).__webglTexture,de.get(e.depthTexture).__webglTexture);var u=e.texture;(u.isData3DTexture||u.isDataArrayTexture||u.isCompressedArrayTexture)&&(o=!0);var c=de.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(a=c[t],i=!0):a=oe.isWebGL2&&e.samples>0&&!1===fe.useMultisampledRTT(e)?de.get(e).__webglMultisampledFramebuffer:c,G.copy(e.viewport),W.copy(e.scissor),V=e.scissorTest}else G.copy(j).multiplyScalar(H).floor(),W.copy(Y).multiplyScalar(H).floor(),V=Q;if(se.bindFramebuffer(Oe.FRAMEBUFFER,a)&&oe.drawBuffers&&r&&se.drawBuffers(e,a),se.viewport(G),se.scissor(W),se.setScissorTest(V),i){var l=de.get(e.texture);Oe.framebufferTexture2D(Oe.FRAMEBUFFER,Oe.COLOR_ATTACHMENT0,Oe.TEXTURE_CUBE_MAP_POSITIVE_X+t,l.__webglTexture,n)}else if(o){var d=de.get(e.texture),h=t||0;Oe.framebufferTextureLayer(Oe.FRAMEBUFFER,Oe.COLOR_ATTACHMENT0,d.__webglTexture,n||0,h)}P=-1},this.readRenderTargetPixels=function(e,t,n,r,a,i,o){if(e&&e.isWebGLRenderTarget){var s=de.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){se.bindFramebuffer(Oe.FRAMEBUFFER,s);try{var u=e.texture,c=u.format,l=u.type;if(c!==me&&Re.convert(c)!==Oe.getParameter(Oe.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");var d=l===pe&&(ie.has("EXT_color_buffer_half_float")||oe.isWebGL2&&ie.has("EXT_color_buffer_float"));if(l!==le&&Re.convert(l)!==Oe.getParameter(Oe.IMPLEMENTATION_COLOR_READ_TYPE)&&(l!==he||!(oe.isWebGL2||ie.has("OES_texture_float")||ie.has("WEBGL_color_buffer_float")))&&!d)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-r&&n>=0&&n<=e.height-a&&Oe.readPixels(t,n,r,a,Re.convert(c),Re.convert(l),i)}finally{var h=null!==A?de.get(A).__webglFramebuffer:null;se.bindFramebuffer(Oe.FRAMEBUFFER,h)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Math.pow(2,-n),a=Math.floor(t.image.width*r),i=Math.floor(t.image.height*r);fe.setTexture2D(t,0),Oe.copyTexSubImage2D(Oe.TEXTURE_2D,n,0,0,e.x,e.y,a,i),se.unbindTexture()},this.copyTextureToTexture=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=t.image.width,i=t.image.height,o=Re.convert(n.format),s=Re.convert(n.type);fe.setTexture2D(n,0),Oe.pixelStorei(Oe.UNPACK_FLIP_Y_WEBGL,n.flipY),Oe.pixelStorei(Oe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),Oe.pixelStorei(Oe.UNPACK_ALIGNMENT,n.unpackAlignment),t.isDataTexture?Oe.texSubImage2D(Oe.TEXTURE_2D,r,e.x,e.y,a,i,o,s,t.image.data):t.isCompressedTexture?Oe.compressedTexSubImage2D(Oe.TEXTURE_2D,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):Oe.texSubImage2D(Oe.TEXTURE_2D,r,e.x,e.y,o,s,t.image),0===r&&n.generateMipmaps&&Oe.generateMipmap(Oe.TEXTURE_2D),se.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(C.isWebGL1Renderer)console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");else{var i,o=e.max.x-e.min.x+1,s=e.max.y-e.min.y+1,u=e.max.z-e.min.z+1,c=Re.convert(r.format),l=Re.convert(r.type);if(r.isData3DTexture)fe.setTexture3D(r,0),i=Oe.TEXTURE_3D;else{if(!r.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");fe.setTexture2DArray(r,0),i=Oe.TEXTURE_2D_ARRAY}Oe.pixelStorei(Oe.UNPACK_FLIP_Y_WEBGL,r.flipY),Oe.pixelStorei(Oe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),Oe.pixelStorei(Oe.UNPACK_ALIGNMENT,r.unpackAlignment);var d=Oe.getParameter(Oe.UNPACK_ROW_LENGTH),h=Oe.getParameter(Oe.UNPACK_IMAGE_HEIGHT),p=Oe.getParameter(Oe.UNPACK_SKIP_PIXELS),f=Oe.getParameter(Oe.UNPACK_SKIP_ROWS),m=Oe.getParameter(Oe.UNPACK_SKIP_IMAGES),v=n.isCompressedTexture?n.mipmaps[0]:n.image;Oe.pixelStorei(Oe.UNPACK_ROW_LENGTH,v.width),Oe.pixelStorei(Oe.UNPACK_IMAGE_HEIGHT,v.height),Oe.pixelStorei(Oe.UNPACK_SKIP_PIXELS,e.min.x),Oe.pixelStorei(Oe.UNPACK_SKIP_ROWS,e.min.y),Oe.pixelStorei(Oe.UNPACK_SKIP_IMAGES,e.min.z),n.isDataTexture||n.isData3DTexture?Oe.texSubImage3D(i,a,t.x,t.y,t.z,o,s,u,c,l,v.data):n.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Oe.compressedTexSubImage3D(i,a,t.x,t.y,t.z,o,s,u,c,v.data)):Oe.texSubImage3D(i,a,t.x,t.y,t.z,o,s,u,c,l,v),Oe.pixelStorei(Oe.UNPACK_ROW_LENGTH,d),Oe.pixelStorei(Oe.UNPACK_IMAGE_HEIGHT,h),Oe.pixelStorei(Oe.UNPACK_SKIP_PIXELS,p),Oe.pixelStorei(Oe.UNPACK_SKIP_ROWS,f),Oe.pixelStorei(Oe.UNPACK_SKIP_IMAGES,m),0===a&&r.generateMipmaps&&Oe.generateMipmap(i),se.unbindTexture()}},this.initTexture=function(e){e.isCubeTexture?fe.setTextureCube(e,0):e.isData3DTexture?fe.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?fe.setTexture2DArray(e,0):fe.setTexture2D(e,0),se.unbindTexture()},this.resetState=function(){N=0,R=0,A=null,se.reset(),Pe.reset()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}return E(e,[{key:"physicallyCorrectLights",get:function(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights},set:function(e){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}},{key:"outputEncoding",get:function(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===Le?Me:3e3},set:function(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===Me?Le:Ae}}]),e}(),To=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n)}(So);To.prototype.isWebGL1Renderer=!0;var _o=function(e){m(n,e);var t=y(n);function n(){var e;return T(this,n),(e=t.call(this)).isScene=!0,e.type="Scene",e.background=null,e.environment=null,e.fog=null,e.backgroundBlurriness=0,e.backgroundIntensity=1,e.overrideMaterial=null,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:h(e)})),e}return E(n,[{key:"copy",value:function(e,t){return N(v(n.prototype),"copy",this).call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}},{key:"toJSON",value:function(e){var t=N(v(n.prototype),"toJSON",this).call(this,e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}},{key:"autoUpdate",get:function(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate},set:function(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}]),n}(Tn);function Io(e,t,n){return Co(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)}function Eo(e,t,n){return!e||!n&&e.constructor===t?e:"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function Co(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}var Mo=function(){function e(t,n,r,a){T(this,e),this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==a?a:new n.constructor(r),this.sampleValues=n,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}return E(e,[{key:"evaluate",value:function(e){var t=this.parameterPositions,n=this._cachedIndex,r=t[n],a=t[n-1];e:{t:{var i;n:{r:if(!(e<r)){for(var o=n+2;;){if(void 0===r){if(e<a)break r;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===o)break;if(a=r,e<(r=t[++n]))break t}i=t.length;break n}if(e>=a)break e;var s=t[1];e<s&&(n=2,a=s);for(var u=n-2;;){if(void 0===a)return this._cachedIndex=0,this.copySampleValue_(0);if(n===u)break;if(r=a,e>=(a=t[--n-1]))break t}i=n,n=0}for(;n<i;){var c=n+i>>>1;e<t[c]?i=c:n=c+1}if(r=t[n],void 0===(a=t[n-1]))return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,a,r)}return this.interpolate_(n,a,e,r)}},{key:"getSettings_",value:function(){return this.settings||this.DefaultSettings_}},{key:"copySampleValue_",value:function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,a=e*r,i=0;i!==r;++i)t[i]=n[a+i];return t}},{key:"interpolate_",value:function(){throw new Error("call to abstract method")}},{key:"intervalChanged_",value:function(){}}]),e}(),No=function(e){m(n,e);var t=y(n);function n(e,r,a,i){var o;return T(this,n),(o=t.call(this,e,r,a,i))._weightPrev=-0,o._offsetPrev=-0,o._weightNext=-0,o._offsetNext=-0,o.DefaultSettings_={endingStart:Ie,endingEnd:Ie},o}return E(n,[{key:"intervalChanged_",value:function(e,t,n){var r=this.parameterPositions,a=e-2,i=e+1,o=r[a],s=r[i];if(void 0===o)switch(this.getSettings_().endingStart){case Ee:a=e,o=2*t-n;break;case Ce:o=t+r[a=r.length-2]-r[a+1];break;default:a=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case Ee:i=e,s=2*n-t;break;case Ce:i=1,s=n+r[1]-r[0];break;default:i=e-1,s=t}var u=.5*(n-t),c=this.valueSize;this._weightPrev=u/(t-o),this._weightNext=u/(s-n),this._offsetPrev=a*c,this._offsetNext=i*c}},{key:"interpolate_",value:function(e,t,n,r){for(var a=this.resultBuffer,i=this.sampleValues,o=this.valueSize,s=e*o,u=s-o,c=this._offsetPrev,l=this._offsetNext,d=this._weightPrev,h=this._weightNext,p=(n-t)/(r-t),f=p*p,m=f*p,v=-d*m+2*d*f-d*p,g=(1+d)*m+(-1.5-2*d)*f+(-.5+d)*p+1,y=(-1-h)*m+(1.5+h)*f+.5*p,b=h*m-h*f,x=0;x!==o;++x)a[x]=v*i[c+x]+g*i[u+x]+y*i[s+x]+b*i[l+x];return a}}]),n}(Mo),Ro=function(e){m(n,e);var t=y(n);function n(e,r,a,i){return T(this,n),t.call(this,e,r,a,i)}return E(n,[{key:"interpolate_",value:function(e,t,n,r){for(var a=this.resultBuffer,i=this.sampleValues,o=this.valueSize,s=e*o,u=s-o,c=(n-t)/(r-t),l=1-c,d=0;d!==o;++d)a[d]=i[u+d]*l+i[s+d]*c;return a}}]),n}(Mo),Lo=function(e){m(n,e);var t=y(n);function n(e,r,a,i){return T(this,n),t.call(this,e,r,a,i)}return E(n,[{key:"interpolate_",value:function(e){return this.copySampleValue_(e-1)}}]),n}(Mo),Ao=function(){function e(t,n,r,a){if(T(this,e),void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===n||0===n.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Eo(n,this.TimeBufferType),this.values=Eo(r,this.ValueBufferType),this.setInterpolation(a||this.DefaultInterpolation)}return E(e,[{key:"InterpolantFactoryMethodDiscrete",value:function(e){return new Lo(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodLinear",value:function(e){return new Ro(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodSmooth",value:function(e){return new No(this.times,this.values,this.getValueSize(),e)}},{key:"setInterpolation",value:function(e){var t;switch(e){case Se:t=this.InterpolantFactoryMethodDiscrete;break;case Te:t=this.InterpolantFactoryMethodLinear;break;case _e:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}},{key:"getInterpolation",value:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Se;case this.InterpolantFactoryMethodLinear:return Te;case this.InterpolantFactoryMethodSmooth:return _e}}},{key:"getValueSize",value:function(){return this.values.length/this.times.length}},{key:"shift",value:function(e){if(0!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]+=e;return this}},{key:"scale",value:function(e){if(1!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]*=e;return this}},{key:"trim",value:function(e,t){for(var n=this.times,r=n.length,a=0,i=r-1;a!==r&&n[a]<e;)++a;for(;-1!==i&&n[i]>t;)--i;if(++i,0!==a||i!==r){a>=i&&(a=(i=Math.max(i,1))-1);var o=this.getValueSize();this.times=Io(n,a,i),this.values=Io(this.values,a*o,i*o)}return this}},{key:"validate",value:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var n=this.times,r=this.values,a=n.length;0===a&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var i=null,o=0;o!==a;o++){var s=n[o];if("number"===typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),e=!1;break}if(null!==i&&i>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,i),e=!1;break}i=s}if(void 0!==r&&Co(r))for(var u=0,c=r.length;u!==c;++u){var l=r[u];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,u,l),e=!1;break}}return e}},{key:"optimize",value:function(){for(var e=Io(this.times),t=Io(this.values),n=this.getValueSize(),r=this.getInterpolation()===_e,a=e.length-1,i=1,o=1;o<a;++o){var s=!1,u=e[o];if(u!==e[o+1]&&(1!==o||u!==e[0]))if(r)s=!0;else for(var c=o*n,l=c-n,d=c+n,h=0;h!==n;++h){var p=t[c+h];if(p!==t[l+h]||p!==t[d+h]){s=!0;break}}if(s){if(o!==i){e[i]=e[o];for(var f=o*n,m=i*n,v=0;v!==n;++v)t[m+v]=t[f+v]}++i}}if(a>0){e[i]=e[a];for(var g=a*n,y=i*n,b=0;b!==n;++b)t[y+b]=t[g+b];++i}return i!==e.length?(this.times=Io(e,0,i),this.values=Io(t,0,i*n)):(this.times=e,this.values=t),this}},{key:"clone",value:function(){var e=Io(this.times,0),t=Io(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}],[{key:"toJSON",value:function(e){var t,n=e.constructor;if(n.toJSON!==this.toJSON)t=n.toJSON(e);else{t={name:e.name,times:Eo(e.times,Array),values:Eo(e.values,Array)};var r=e.getInterpolation();r!==e.DefaultInterpolation&&(t.interpolation=r)}return t.type=e.ValueTypeName,t}}]),e}();Ao.prototype.TimeBufferType=Float32Array,Ao.prototype.ValueBufferType=Float32Array,Ao.prototype.DefaultInterpolation=Te;var Po=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n)}(Ao);Po.prototype.ValueTypeName="bool",Po.prototype.ValueBufferType=Array,Po.prototype.DefaultInterpolation=Se,Po.prototype.InterpolantFactoryMethodLinear=void 0,Po.prototype.InterpolantFactoryMethodSmooth=void 0;var Do=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n)}(Ao);Do.prototype.ValueTypeName="color";var Oo=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n)}(Ao);Oo.prototype.ValueTypeName="number";var zo=function(e){m(n,e);var t=y(n);function n(e,r,a,i){return T(this,n),t.call(this,e,r,a,i)}return E(n,[{key:"interpolate_",value:function(e,t,n,r){for(var a=this.resultBuffer,i=this.sampleValues,o=this.valueSize,s=(n-t)/(r-t),u=e*o,c=u+o;u!==c;u+=4)wt.slerpFlat(a,0,i,u-o,i,u,s);return a}}]),n}(Mo),Fo=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n,[{key:"InterpolantFactoryMethodLinear",value:function(e){return new zo(this.times,this.values,this.getValueSize(),e)}}]),n}(Ao);Fo.prototype.ValueTypeName="quaternion",Fo.prototype.DefaultInterpolation=Te,Fo.prototype.InterpolantFactoryMethodSmooth=void 0;var Go=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n)}(Ao);Go.prototype.ValueTypeName="string",Go.prototype.ValueBufferType=Array,Go.prototype.DefaultInterpolation=Se,Go.prototype.InterpolantFactoryMethodLinear=void 0,Go.prototype.InterpolantFactoryMethodSmooth=void 0;var Wo=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n)}(Ao);Wo.prototype.ValueTypeName="vector";Error;var Vo="\\[\\]\\.:\\/",Uo=new RegExp("["+Vo+"]","g"),Xo="[^"+Vo+"]",Bo="[^"+Vo.replace("\\.","")+"]",Ho=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Xo)+/(WCOD+)?/.source.replace("WCOD",Bo)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Xo)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Xo)+"$"),Zo=["material","materials","bones","map"],Ko=function(){function e(t,n,r){T(this,e);var a=r||jo.parseTrackName(n);this._targetGroup=t,this._bindings=t.subscribe_(n,a)}return E(e,[{key:"getValue",value:function(e,t){this.bind();var n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)}},{key:"setValue",value:function(e,t){for(var n=this._bindings,r=this._targetGroup.nCachedObjects_,a=n.length;r!==a;++r)n[r].setValue(e,t)}},{key:"bind",value:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}},{key:"unbind",value:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}]),e}(),jo=function(){function e(t,n,r){T(this,e),this.path=n,this.parsedPath=r||e.parseTrackName(n),this.node=e.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}return E(e,[{key:"_getValue_unavailable",value:function(){}},{key:"_setValue_unavailable",value:function(){}},{key:"_getValue_direct",value:function(e,t){e[t]=this.targetObject[this.propertyName]}},{key:"_getValue_array",value:function(e,t){for(var n=this.resolvedProperty,r=0,a=n.length;r!==a;++r)e[t++]=n[r]}},{key:"_getValue_arrayElement",value:function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}},{key:"_getValue_toArray",value:function(e,t){this.resolvedProperty.toArray(e,t)}},{key:"_setValue_direct",value:function(e,t){this.targetObject[this.propertyName]=e[t]}},{key:"_setValue_direct_setNeedsUpdate",value:function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}},{key:"_setValue_direct_setMatrixWorldNeedsUpdate",value:function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_array",value:function(e,t){for(var n=this.resolvedProperty,r=0,a=n.length;r!==a;++r)n[r]=e[t++]}},{key:"_setValue_array_setNeedsUpdate",value:function(e,t){for(var n=this.resolvedProperty,r=0,a=n.length;r!==a;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}},{key:"_setValue_array_setMatrixWorldNeedsUpdate",value:function(e,t){for(var n=this.resolvedProperty,r=0,a=n.length;r!==a;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_arrayElement",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}},{key:"_setValue_arrayElement_setNeedsUpdate",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}},{key:"_setValue_arrayElement_setMatrixWorldNeedsUpdate",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_fromArray",value:function(e,t){this.resolvedProperty.fromArray(e,t)}},{key:"_setValue_fromArray_setNeedsUpdate",value:function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}},{key:"_setValue_fromArray_setMatrixWorldNeedsUpdate",value:function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_getValue_unbound",value:function(e,t){this.bind(),this.getValue(e,t)}},{key:"_setValue_unbound",value:function(e,t){this.bind(),this.setValue(e,t)}},{key:"bind",value:function(){var t=this.node,n=this.parsedPath,r=n.objectName,a=n.propertyName,i=n.propertyIndex;if(t||(t=e.findNode(this.rootNode,n.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(r){var o=n.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var s=0;s<t.length;s++)if(t[s].name===o){o=s;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==o){if(void 0===t[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[o]}}var u=t[a];if(void 0!==u){var c=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?c=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(c=this.Versioning.MatrixWorldNeedsUpdate);var l=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===a){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[i]&&(i=t.morphTargetDictionary[i])}l=this.BindingType.ArrayElement,this.resolvedProperty=u,this.propertyIndex=i}else void 0!==u.fromArray&&void 0!==u.toArray?(l=this.BindingType.HasFromToArray,this.resolvedProperty=u):Array.isArray(u)?(l=this.BindingType.EntireArray,this.resolvedProperty=u):this.propertyName=a;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][c]}else{var d=n.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+d+"."+a+" but it wasn't found.",t)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")}},{key:"unbind",value:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}],[{key:"create",value:function(t,n,r){return t&&t.isAnimationObjectGroup?new e.Composite(t,n,r):new e(t,n,r)}},{key:"sanitizeNodeName",value:function(e){return e.replace(/\s/g,"_").replace(Uo,"")}},{key:"parseTrackName",value:function(e){var t=Ho.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var a=n.nodeName.substring(r+1);-1!==Zo.indexOf(a)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=a)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}},{key:"findNode",value:function(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){var r=function e(n){for(var r=0;r<n.length;r++){var a=n[r];if(a.name===t||a.uuid===t)return a;var i=e(a.children);if(i)return i}return null}(e.children);if(r)return r}return null}}]),e}();jo.Composite=Ko,jo.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},jo.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},jo.prototype.GetterByBindingType=[jo.prototype._getValue_direct,jo.prototype._getValue_array,jo.prototype._getValue_arrayElement,jo.prototype._getValue_toArray],jo.prototype.SetterByBindingTypeAndVersioning=[[jo.prototype._setValue_direct,jo.prototype._setValue_direct_setNeedsUpdate,jo.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[jo.prototype._setValue_array,jo.prototype._setValue_array_setNeedsUpdate,jo.prototype._setValue_array_setMatrixWorldNeedsUpdate],[jo.prototype._setValue_arrayElement,jo.prototype._setValue_arrayElement_setNeedsUpdate,jo.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[jo.prototype._setValue_fromArray,jo.prototype._setValue_fromArray_setNeedsUpdate,jo.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];new Float32Array(1);"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:L}})),"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=L);var Yo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Qo(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var n=function e(){if(this instanceof e){var n=[null];return n.push.apply(n,arguments),new(Function.bind.apply(t,n))}return t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})})),n}var Jo=function(e,t){var n=2*Math.PI*t*e;return n/(n+1)},qo=function(e,t,n){return e*t+(1-e)*n},$o=function(){function e(t){var n=t.minCutOff,r=t.beta;T(this,e),this.minCutOff=n,this.beta=r,this.dCutOff=.001,this.xPrev=null,this.dxPrev=null,this.tPrev=null,this.initialized=!1}return E(e,[{key:"reset",value:function(){this.initialized=!1}},{key:"filter",value:function(e,t){if(!this.initialized)return this.initialized=!0,this.xPrev=t,this.dxPrev=t.map((function(){return 0})),this.tPrev=e,t;for(var n=this.xPrev,r=this.tPrev,a=this.dxPrev,i=e-r,o=Jo(i,this.dCutOff),s=[],u=[],c=[],l=0;l<t.length;l++){s[l]=(t[l]-n[l])/i,u[l]=qo(o,s[l],a[l]);var d=this.minCutOff+this.beta*Math.abs(u[l]),h=Jo(i,d);c[l]=qo(h,t[l],n[l])}return this.xPrev=c,this.dxPrev=u,this.tPrev=e,c}}]),e}(),es=function(){function e(t){var n=t.uiLoading,r=t.uiScanning,a=t.uiError;T(this,e);var i=document.createElement("style");i.innerText=".mindar-ui-overlay{display:flex;align-items:center;justify-content:center;position:absolute;left:0;right:0;top:0;bottom:0;background:transparent;z-index:2}.mindar-ui-overlay.hidden{display:none}.mindar-ui-loading .loader{border:16px solid #222;border-top:16px solid white;opacity:.8;border-radius:50%;width:120px;height:120px;animation:spin 2s linear infinite}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.mindar-ui-compatibility .content{background:black;color:#fff;opacity:.8;text-align:center;margin:20px;padding:20px;min-height:50vh}@media (min-aspect-ratio: 1/1){.mindar-ui-scanning .scanning{width:50vh;height:50vh}}@media (max-aspect-ratio: 1/1){.mindar-ui-scanning .scanning{width:80vw;height:80vw}}.mindar-ui-scanning .scanning .inner{position:relative;width:100%;height:100%;opacity:.8;background:linear-gradient(to right,white 10px,transparent 10px) 0 0,linear-gradient(to right,white 10px,transparent 10px) 0 100%,linear-gradient(to left,white 10px,transparent 10px) 100% 0,linear-gradient(to left,white 10px,transparent 10px) 100% 100%,linear-gradient(to bottom,white 10px,transparent 10px) 0 0,linear-gradient(to bottom,white 10px,transparent 10px) 100% 0,linear-gradient(to top,white 10px,transparent 10px) 0 100%,linear-gradient(to top,white 10px,transparent 10px) 100% 100%;background-repeat:no-repeat;background-size:40px 40px}.mindar-ui-scanning .scanning .inner .scanline{position:absolute;width:100%;height:10px;background:white;animation:move 2s linear infinite}@keyframes move{0%,to{top:0%}50%{top:calc(100% - 10px)}}",document.head.appendChild(i),"yes"===n?this.loadingModal=this._loadHTML('<div class="mindar-ui-overlay mindar-ui-loading">\n  <div class="loader"/>\n</div>\n'):"no"!==n&&(this.loadingModal=document.querySelector(n)),"yes"===a?this.compatibilityModal=this._loadHTML('<div class="mindar-ui-overlay mindar-ui-compatibility">\n  <div class="content">\n    <h1>Failed to launch :(</h1>\n    <p>\n      Looks like your device/browser is not compatible.\n    </p>\n\n    <br/>\n    <br/>\n    <p>\n      Please try the following recommended browsers:\n    </p>\n    <p>\n      For Android device - Chrome\n    </p>\n    <p>\n      For iOS device - Safari\n    </p>\n  </div>\n</div>\n'):"no"!==a&&(this.compatibilityModal=document.querySelector(a)),"yes"===r?this.scanningMask=this._loadHTML('<div class="mindar-ui-overlay mindar-ui-scanning">\n  <div class="scanning">\n    <div class="inner">\n      <div class="scanline"/>\n    </div>\n  </div>\n</div>\n'):"no"!==r&&(this.scanningMask=document.querySelector(r)),this.hideLoading(),this.hideCompatibility(),this.hideScanning()}return E(e,[{key:"showLoading",value:function(){this.loadingModal&&this.loadingModal.classList.remove("hidden")}},{key:"hideLoading",value:function(){this.loadingModal&&this.loadingModal.classList.add("hidden")}},{key:"showCompatibility",value:function(){this.compatibilityModal&&this.compatibilityModal.classList.remove("hidden")}},{key:"hideCompatibility",value:function(){this.compatibilityModal&&this.compatibilityModal.classList.add("hidden")}},{key:"showScanning",value:function(){this.scanningMask&&this.scanningMask.classList.remove("hidden")}},{key:"hideScanning",value:function(){this.scanningMask&&this.scanningMask.classList.add("hidden")}},{key:"_loadHTML",value:function(e){var t=document.createElement("template");t.innerHTML=e.trim();var n=t.content.firstChild;return document.getElementsByTagName("body")[0].appendChild(n),n}}]),e}();function ts(e,t){for(var n=function(){var n=t[r];if("string"!=typeof n&&!Array.isArray(n)){var a=function(t){if("default"!==t&&!(t in e)){var r=Object.getOwnPropertyDescriptor(n,t);r&&Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return n[t]}})}};for(var i in n)a(i)}},r=0;r<t.length;r++)n();return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}var ns=function(){function e(t,n){T(this,e),this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}return E(e,[{key:"get",value:function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}},{key:"set",value:function(e,t){this.dataIdsCount++,this.data.set(e,t)}},{key:"has",value:function(e){return this.data.has(e)}},{key:"delete",value:function(e){return this.dataIdsCount--,this.data.delete(e)}},{key:"numDataIds",value:function(){return this.dataIdsCount}}]),e}(),rs=function(){function e(){T(this,e)}return E(e,[{key:"refCount",value:function(e){return as("refCount")}},{key:"incRef",value:function(e){return as("incRef")}},{key:"timerAvailable",value:function(){return!0}},{key:"time",value:function(e){return as("time")}},{key:"read",value:function(e){return as("read")}},{key:"readSync",value:function(e){return as("readSync")}},{key:"readToGPU",value:function(e,t){return as("readToGPU")}},{key:"numDataIds",value:function(){return as("numDataIds")}},{key:"disposeData",value:function(e,t){return as("disposeData")}},{key:"write",value:function(e,t,n){return as("write")}},{key:"move",value:function(e,t,n,r,a){return as("move")}},{key:"memory",value:function(){return as("memory")}},{key:"floatPrecision",value:function(){return as("floatPrecision")}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"dispose",value:function(){return as("dispose")}}]),e}();function as(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen"))}function is(e){for(var t=e.length,n=0;t>0;)n=Math.random()*t|0,us(e,--t,n)}function os(e,t,n){return Math.max(e,Math.min(t,n))}function ss(e){return e%2===0?e:e+1}function us(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function cs(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function ls(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function ds(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";ls(ms(e,t),(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}function hs(e){ls(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function ps(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),Array.isArray(e)||Cs(e)&&!n)for(var r=0;r<e.length;++r)ps(e[r],t,n);else t.push(e);return t}function fs(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function ms(e,t){if(e===t)return!0;if(null==e||null==t||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function vs(e){return e%1===0}function gs(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function ys(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function bs(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return 0},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:setTimeout;return new Promise((function(a,i){var o=0;!function s(){if(e())a();else{o++;var u=t(o);null!=n&&o>=n?i():r(s,u)}}()}))}function xs(e,t){for(var n=1,r=-1,a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(-1===e[a]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim ".concat(r," and dim ").concat(a));r=a}else if(e[a]<0)throw Error("Shapes can not be < 0. Found ".concat(e[a]," at dim ").concat(a));if(-1===r){if(t>0&&t!==n)throw Error("Size(".concat(t,") must match the product of shape ").concat(e));return e}if(0===n)throw Error("Cannot infer the missing size in [".concat(e,"] when there are 0 elements"));if(t%n!==0)throw Error("The implicit shape can't be a fractional number. Got ".concat(t," / ").concat(n));var i=e.slice();return i[r]=t/n,i}function ws(e,t){var n=t.length;return ls((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-".concat(n,", ").concat(n,") but got axis ").concat(e)})),ls(e.every((function(e){return vs(e)})),(function(){return"All values in axis param must be integers but got axis ".concat(e)})),e.map((function(e){return e<0?n+e:e}))}function ks(e,t){for(var n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||a?null:ws(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=i){if(i[o]===s&&1!==e[s])throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(e[s],"' is not 1"));(null==i[o]||i[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),i[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function Ss(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type ".concat(e));n=new Uint8Array(t)}return n}function Ts(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type ".concat(e));n=new Array(t)}return n}function _s(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(r,"."))}}function Is(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function Es(e,t){return!("complex64"===t||"float32"===t&&"complex64"!==e||"int32"===t&&"float32"!==e&&"complex64"!==e||"bool"===t&&"bool"===e)}function Cs(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}function Ms(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype ".concat(e))}function Ns(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}function Rs(e){return"string"==typeof e||e instanceof String}function Ls(e){return"boolean"==typeof e}function As(e){return"number"==typeof e}function Ps(e){return Array.isArray(e)?Ps(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":As(e)?"float32":Rs(e)?"string":Ls(e)?"bool":"float32"}function Ds(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Os(e,t){for(var n=t;n<e;++n)if(e%n===0)return n;return e}function zs(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function Fs(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=new Array;if(1===t.length)for(var i=t[0]*(r?2:1),o=0;o<i;o++)a[o]=n[e+o];else for(var s=t[0],u=t.slice(1),c=u.reduce((function(e,t){return e*t}))*(r?2:1),l=0;l<s;l++)a[l]=Fs(e+l*c,u,n,r);return a}function Gs(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0===e.length)return t[0];var r=e.reduce((function(e,t){return e*t}))*(n?2:1);if(0===r)return[];if(r!==t.length)throw new Error("[".concat(e,"] does not match the input size ").concat(t.length).concat(n?" for a complex tensor":"","."));return Fs(0,e,t,n)}function Ws(e,t){for(var n=Vs(e,t),r=0;r<n.length;r++)n[r]=1;return n}function Vs(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type ".concat(t))}function Us(e,t){var n=e.reduce((function(e,t){return e*t}),1);if(null==t||"float32"===t)return Gs(e,new Float32Array(n));if("int32"===t)return Gs(e,new Int32Array(n));if("bool"===t)return Gs(e,new Uint8Array(n));throw new Error("Unknown data type ".concat(t))}function Xs(e){e.forEach((function(t){ls(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape [".concat(e,"].")}))}))}function Bs(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function Hs(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}function Zs(e){return e&&e.then&&"function"==typeof e.then}var Ks="tfjsflags",js=function(){function e(t){T(this,e),this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Ys,this.populateURLFlags()}return E(e,[{key:"setPlatform",value:function(e,t){null!=this.platform&&(Qs().getBool("IS_TEST")||Qs().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. Overwriting the platform with ").concat(e,"."))),this.platformName=e,this.platform=t}},{key:"registerFlag",value:function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];Qs().getBool("IS_TEST")||Qs().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(r,".")),this.set(e,r)}}},{key:"getAsync",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in this.flags)){e.next=4;break}e.t0=this.flags[t],e.next=8;break;case 4:return e.next=6,this.evaluateFlag(t);case 6:this.flags[t]=e.sent,e.t0=this.flags[t];case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(Zs(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. Please use getAsync() instead."));return this.flags[e]=t,this.flags[e]}},{key:"getNumber",value:function(e){return this.get(e)}},{key:"getBool",value:function(e){return this.get(e)}},{key:"getFlags",value:function(){return this.flags}},{key:"features",get:function(){return this.flags}},{key:"set",value:function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}},{key:"evaluateFlag",value:function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}},{key:"setFlags",value:function(e){this.flags=Object.assign({},e)}},{key:"reset",value:function(){this.flags={},this.urlFlags={},this.populateURLFlags()}},{key:"populateURLFlags",value:function(){var e=this;if(!(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")){var t=this.getQueryParams(this.global.location.search);Ks in t&&t[Ks].split(",").forEach((function(t){var n=i(t.split(":"),2),r=n[0],a=n[1];e.urlFlags[r]=function(e,t){if(t=t.toLowerCase(),"true"===t||"false"===t)return"true"===t;if("".concat(+t)===t)return+t;throw new Error("Could not parse value flag value ".concat(t," for flag ").concat(e,"."))}(r,a)}))}}}]),e}();function Ys(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,r[0],r[1]),r.join("=")})),t}function Qs(){return qs}var Js,qs=null;function $s(){if(null==Js){var e;if(typeof window<"u")e=window;else if(typeof global<"u")e=global;else if(typeof process<"u")e=process;else{if(!(typeof self<"u"))throw new Error("Could not find a global object");e=self}Js=e}return Js}function eu(e,t){var n=function(){var e=$s();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);var r=t();return n.set(e,r),n.get(e)}var tu="Abs",nu="Acos",ru="Acosh",au="Add",iu="AddN",ou="All",su="Any",uu="ArgMax",cu="ArgMin",lu="Asin",du="Asinh",hu="Atan",pu="Atanh",fu="Atan2",mu="AvgPool",vu="AvgPoolGrad",gu="AvgPool3D",yu="AvgPool3DGrad",bu="BatchMatMul",xu="BatchToSpaceND",wu="Bincount",ku="BroadcastTo",Su="BroadcastArgs",Tu="Cast",_u="Ceil",Iu="ClipByValue",Eu="Complex",Cu="ComplexAbs",Mu="Concat",Nu="Conv2D",Ru="Conv2DBackpropFilter",Lu="Conv2DBackpropInput",Au="Conv3D",Pu="Conv3DBackpropFilterV2",Du="Conv3DBackpropInputV2",Ou="Cos",zu="Cosh",Fu="Cumprod",Gu="Cumsum",Wu="CropAndResize",Vu="DenseBincount",Uu="DepthToSpace",Xu="DepthwiseConv2dNative",Bu="DepthwiseConv2dNativeBackpropFilter",Hu="DepthwiseConv2dNativeBackpropInput",Zu="Diag",Ku="Dilation2D",ju="Dilation2DBackpropInput",Yu="Dilation2DBackpropFilter",Qu="RealDiv",Ju="Einsum",qu="Elu",$u="EluGrad",ec="Erf",tc="Equal",nc="Exp",rc="ExpandDims",ac="Expm1",ic="FFT",oc="Fill",sc="FlipLeftRight",uc="Floor",cc="FloorDiv",lc="FusedBatchNorm",dc="GatherV2",hc="GatherNd",pc="Greater",fc="GreaterEqual",mc="Identity",vc="IFFT",gc="Imag",yc="IsFinite",bc="IsInf",xc="IsNan",wc="LeakyRelu",kc="Less",Sc="LessEqual",Tc="LinSpace",_c="Log",Ic="Log1p",Ec="LogicalAnd",Cc="LogicalNot",Mc="LogicalOr",Nc="LogSoftmax",Rc="LRN",Lc="LRNGrad",Ac="Max",Pc="Maximum",Dc="MaxPool",Oc="MaxPoolGrad",zc="MaxPool3D",Fc="MaxPool3DGrad",Gc="MaxPoolWithArgmax",Wc="Mean",Vc="Min",Uc="Minimum",Xc="MirrorPad",Bc="Mod",Hc="Multinomial",Zc="Multiply",Kc="Neg",jc="NotEqual",Yc="NonMaxSuppressionV3",Qc="NonMaxSuppressionV4",Jc="NonMaxSuppressionV5",qc="OnesLike",$c="OneHot",el="Pack",tl="PadV2",nl="Pow",rl="Prelu",al="Prod",il="RaggedGather",ol="RaggedTensorToTensor",sl="Range",ul="Real",cl="Reciprocal",ll="Relu",dl="Reshape",hl="ResizeNearestNeighbor",pl="ResizeNearestNeighborGrad",fl="ResizeBilinear",ml="ResizeBilinearGrad",vl="Relu6",gl="Reverse",yl="Round",bl="Rsqrt",xl="ScatterNd",wl="SearchSorted",kl="Select",Sl="Selu",Tl="Slice",_l="Sin",Il="Sinh",El="Sign",Cl="Sigmoid",Ml="Softplus",Nl="Sqrt",Rl="Sum",Ll="SpaceToBatchND",Al="SplitV",Pl="Softmax",Dl="SparseFillEmptyRows",Ol="SparseReshape",zl="SparseSegmentMean",Fl="SparseSegmentSum",Gl="SparseToDense",Wl="SquaredDifference",Vl="Square",Ul="StridedSlice",Xl="StringNGrams",Bl="StringSplit",Hl="StringToHashBucketFast",Zl="Sub",Kl="Tan",jl="Tanh",Yl="Tile",Ql="TopK",Jl="Transform",ql="Transpose",$l="Unique",ed="Unpack",td="UnsortedSegmentSum",nd="ZerosLike",rd="Step",ad="FromPixels",id="RotateWithOffset",od="_FusedMatMul",sd="FusedConv2D",ud="FusedDepthwiseConv2D";function cd(){var e;Qs().getBool("IS_TEST")||Qs().getBool("PROD")||(e=console).warn.apply(e,arguments)}var ld=eu("kernelRegistry",(function(){return new Map})),dd=eu("gradRegistry",(function(){return new Map}));function hd(e,t){var n=gd(e,t);return ld.get(n)}function pd(e){return dd.get(e)}function fd(e){for(var t=ld.entries(),n=[];;){var r=t.next(),a=r.done,o=r.value;if(a)break;var s=i(o,2),u=s[0],c=s[1];i(u.split("_"),1)[0]===e&&n.push(c)}return n}function md(e){var t=e.kernelName,n=e.backendName,r=gd(t,n);ld.has(r)&&cd("The kernel '".concat(t,"' for backend '").concat(n,"' is already registered")),ld.set(r,e)}function vd(e){var t=e.kernelName;dd.has(t)&&Qs().getBool("DEBUG")&&cd("Overriding the gradient for '".concat(t,"'")),dd.set(t,e)}function gd(e,t){return"".concat(t,"_").concat(e)}var yd=xd,bd=null;try{bd=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(AJ){}function xd(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function wd(e){return!0===(e&&e.__isLong__)}xd.prototype.__isLong__,Object.defineProperty(xd.prototype,"__isLong__",{value:!0}),xd.isLong=wd;var kd={},Sd={};function Td(e,t){var n,r,a;return t?(a=0<=(e>>>=0)&&e<256)&&(r=Sd[e])?r:(n=Id(e,(0|e)<0?-1:0,!0),a&&(Sd[e]=n),n):(a=-128<=(e|=0)&&e<128)&&(r=kd[e])?r:(n=Id(e,e<0?-1:0,!1),a&&(kd[e]=n),n)}function _d(e,t){if(isNaN(e))return t?Dd:Pd;if(t){if(e<0)return Dd;if(e>=Rd)return Wd}else{if(e<=-Ld)return Vd;if(e+1>=Ld)return Gd}return e<0?_d(-e,t).neg():Id(e%Nd|0,e/Nd|0,t)}function Id(e,t,n){return new xd(e,t,n)}xd.fromInt=Td,xd.fromNumber=_d,xd.fromBits=Id;var Ed=Math.pow;function Cd(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return Pd;if("number"==typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return Cd(e.substring(1),t,n).neg();for(var a=_d(Ed(n,8)),i=Pd,o=0;o<e.length;o+=8){var s=Math.min(8,e.length-o),u=parseInt(e.substring(o,o+s),n);if(s<8){var c=_d(Ed(n,s));i=i.mul(c).add(_d(u))}else i=(i=i.mul(a)).add(_d(u))}return i.unsigned=t,i}function Md(e,t){return"number"==typeof e?_d(e,t):"string"==typeof e?Cd(e,t):Id(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}xd.fromString=Cd,xd.fromValue=Md;var Nd=4294967296,Rd=Nd*Nd,Ld=Rd/2,Ad=Td(1<<24),Pd=Td(0);xd.ZERO=Pd;var Dd=Td(0,!0);xd.UZERO=Dd;var Od=Td(1);xd.ONE=Od;var zd=Td(1,!0);xd.UONE=zd;var Fd=Td(-1);xd.NEG_ONE=Fd;var Gd=Id(-1,2147483647,!1);xd.MAX_VALUE=Gd;var Wd=Id(-1,-1,!0);xd.MAX_UNSIGNED_VALUE=Wd;var Vd=Id(0,-2147483648,!1);xd.MIN_VALUE=Vd;var Ud=xd.prototype;Ud.toInt=function(){return this.unsigned?this.low>>>0:this.low},Ud.toNumber=function(){return this.unsigned?(this.high>>>0)*Nd+(this.low>>>0):this.high*Nd+(this.low>>>0)},Ud.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(Vd)){var t=_d(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var a=_d(Ed(e,6),this.unsigned),i=this,o="";;){var s=i.div(a),u=(i.sub(s.mul(a)).toInt()>>>0).toString(e);if((i=s).isZero())return u+o;for(;u.length<6;)u="0"+u;o=""+u+o}},Ud.getHighBits=function(){return this.high},Ud.getHighBitsUnsigned=function(){return this.high>>>0},Ud.getLowBits=function(){return this.low},Ud.getLowBitsUnsigned=function(){return this.low>>>0},Ud.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Vd)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return 0!=this.high?t+33:t+1},Ud.isZero=function(){return 0===this.high&&0===this.low},Ud.eqz=Ud.isZero,Ud.isNegative=function(){return!this.unsigned&&this.high<0},Ud.isPositive=function(){return this.unsigned||this.high>=0},Ud.isOdd=function(){return 1===(1&this.low)},Ud.isEven=function(){return 0===(1&this.low)},Ud.equals=function(e){return wd(e)||(e=Md(e)),(this.unsigned===e.unsigned||this.high>>>31!==1||e.high>>>31!==1)&&(this.high===e.high&&this.low===e.low)},Ud.eq=Ud.equals,Ud.notEquals=function(e){return!this.eq(e)},Ud.neq=Ud.notEquals,Ud.ne=Ud.notEquals,Ud.lessThan=function(e){return this.comp(e)<0},Ud.lt=Ud.lessThan,Ud.lessThanOrEqual=function(e){return this.comp(e)<=0},Ud.lte=Ud.lessThanOrEqual,Ud.le=Ud.lessThanOrEqual,Ud.greaterThan=function(e){return this.comp(e)>0},Ud.gt=Ud.greaterThan,Ud.greaterThanOrEqual=function(e){return this.comp(e)>=0},Ud.gte=Ud.greaterThanOrEqual,Ud.ge=Ud.greaterThanOrEqual,Ud.compare=function(e){if(wd(e)||(e=Md(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},Ud.comp=Ud.compare,Ud.negate=function(){return!this.unsigned&&this.eq(Vd)?Vd:this.not().add(Od)},Ud.neg=Ud.negate,Ud.add=function(e){wd(e)||(e=Md(e));var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,a=65535&this.low,i=e.high>>>16,o=65535&e.high,s=e.low>>>16,u=0,c=0,l=0,d=0;return l+=(d+=a+(65535&e.low))>>>16,c+=(l+=r+s)>>>16,u+=(c+=n+o)>>>16,u+=t+i,Id((l&=65535)<<16|(d&=65535),(u&=65535)<<16|(c&=65535),this.unsigned)},Ud.subtract=function(e){return wd(e)||(e=Md(e)),this.add(e.neg())},Ud.sub=Ud.subtract,Ud.multiply=function(e){if(this.isZero())return Pd;if(wd(e)||(e=Md(e)),bd)return Id(bd.mul(this.low,this.high,e.low,e.high),bd.get_high(),this.unsigned);if(e.isZero())return Pd;if(this.eq(Vd))return e.isOdd()?Vd:Pd;if(e.eq(Vd))return this.isOdd()?Vd:Pd;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(Ad)&&e.lt(Ad))return _d(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,a=65535&this.low,i=e.high>>>16,o=65535&e.high,s=e.low>>>16,u=65535&e.low,c=0,l=0,d=0,h=0;return d+=(h+=a*u)>>>16,l+=(d+=r*u)>>>16,d&=65535,l+=(d+=a*s)>>>16,c+=(l+=n*u)>>>16,l&=65535,c+=(l+=r*s)>>>16,l&=65535,c+=(l+=a*o)>>>16,c+=t*u+n*s+r*o+a*i,Id((d&=65535)<<16|(h&=65535),(c&=65535)<<16|(l&=65535),this.unsigned)},Ud.mul=Ud.multiply,Ud.divide=function(e){if(wd(e)||(e=Md(e)),e.isZero())throw Error("division by zero");var t,n,r;if(bd)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?Id((this.unsigned?bd.div_u:bd.div_s)(this.low,this.high,e.low,e.high),bd.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Dd:Pd;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Dd;if(e.gt(this.shru(1)))return zd;r=Dd}else{if(this.eq(Vd))return e.eq(Od)||e.eq(Fd)?Vd:e.eq(Vd)?Od:(t=this.shr(1).div(e).shl(1)).eq(Pd)?e.isNegative()?Od:Fd:(n=this.sub(e.mul(t)),r=t.add(n.div(e)));if(e.eq(Vd))return this.unsigned?Dd:Pd;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();r=Pd}for(n=this;n.gte(e);){t=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(t)/Math.LN2),i=a<=48?1:Ed(2,a-48),o=_d(t),s=o.mul(e);s.isNegative()||s.gt(n);)s=(o=_d(t-=i,this.unsigned)).mul(e);o.isZero()&&(o=Od),r=r.add(o),n=n.sub(s)}return r},Ud.div=Ud.divide,Ud.modulo=function(e){return wd(e)||(e=Md(e)),bd?Id((this.unsigned?bd.rem_u:bd.rem_s)(this.low,this.high,e.low,e.high),bd.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},Ud.mod=Ud.modulo,Ud.rem=Ud.modulo,Ud.not=function(){return Id(~this.low,~this.high,this.unsigned)},Ud.and=function(e){return wd(e)||(e=Md(e)),Id(this.low&e.low,this.high&e.high,this.unsigned)},Ud.or=function(e){return wd(e)||(e=Md(e)),Id(this.low|e.low,this.high|e.high,this.unsigned)},Ud.xor=function(e){return wd(e)||(e=Md(e)),Id(this.low^e.low,this.high^e.high,this.unsigned)},Ud.shiftLeft=function(e){return wd(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?Id(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Id(0,this.low<<e-32,this.unsigned)},Ud.shl=Ud.shiftLeft,Ud.shiftRight=function(e){return wd(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?Id(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Id(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},Ud.shr=Ud.shiftRight,Ud.shiftRightUnsigned=function(e){if(wd(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?Id(this.low>>>e|t<<32-e,t>>>e,this.unsigned):Id(32===e?t:t>>>e-32,0,this.unsigned)},Ud.shru=Ud.shiftRightUnsigned,Ud.shr_u=Ud.shiftRightUnsigned,Ud.toSigned=function(){return this.unsigned?Id(this.low,this.high,!1):this},Ud.toUnsigned=function(){return this.unsigned?this:Id(this.low,this.high,!0)},Ud.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},Ud.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},Ud.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},xd.fromBytes=function(e,t,n){return n?xd.fromBytesLE(e,t):xd.fromBytesBE(e,t)},xd.fromBytesLE=function(e,t){return new xd(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},xd.fromBytesBE=function(e,t){return new xd(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var Xd=yd||ts({__proto__:null,default:yd},[yd]);function Bd(e){return Xd.fromString(e,!0,16)}var Hd=Bd("c3a5c85c97cb3127"),Zd=Bd("b492b66fbe98f273"),Kd=Bd("9ae16a3b2f90404f");function jd(e){return e.xor(e.shru(47))}function Yd(e,t,n){var r=e.slice(t,t+n);return Xd.fromBytes(Array.from(r),!0,!0)}function Qd(e,t){return Yd(e,t,8)}function Jd(e,t){return Yd(e,t,4)}function qd(e,t){return 0===t?e:e.shru(t).or(e.shl(64-t))}function $d(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Bd("9ddfea08eb382d69"),r=e.xor(t).mul(n);r=r.xor(r.shru(47));var a=t.xor(r).mul(n);return a=(a=a.xor(a.shru(47))).mul(n)}function eh(e,t,n,r){return function(e,t,n,r,a,i){a=a.add(e),i=qd(i.add(a).add(r),21);var o=a;return a=(a=a.add(t)).add(n),i=i.add(qd(a,44)),[a.add(r),i.add(o)]}(Qd(e,t),Qd(e,t+8),Qd(e,t+16),Qd(e,t+24),n,r)}function th(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,r=Xd.fromNumber(81,!0);if(n<=32)return n<=16?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;if(t>=8){var n=Kd.add(2*t),r=Qd(e,0).add(Kd),a=Qd(e,t-8);return $d(qd(a,37).mul(n).add(r),qd(r,25).add(a).mul(n),n)}if(t>=4){var i=Kd.add(2*t);return $d(Jd(e,0).shl(3).add(t),Jd(e,t-4),i)}if(t>0){var o=e[0]+(e[t>>1]<<8),s=t+(e[t-1]<<2);return jd(Kd.mul(o).xor(Hd.mul(s))).mul(Kd)}return Kd}(e,n):function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=Kd.add(2*t),r=Qd(e,0).mul(Zd),a=Qd(e,8),i=Qd(e,t-8).mul(n),o=Qd(e,t-16).mul(Kd);return $d(qd(r.add(a),43).add(qd(i,30)).add(o),r.add(qd(a.add(Kd),18)).add(i),n)}(e,n);if(n<=64)return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=Kd.add(2*t),r=Qd(e,0).mul(Kd),a=Qd(e,8),i=Qd(e,t-8).mul(n),o=Qd(e,t-16).mul(Kd),s=qd(r.add(a),43).add(qd(i,30)).add(o),u=$d(s,r.add(qd(a.add(Kd),18)).add(i),n),c=Qd(e,16).mul(n),l=Qd(e,24),d=s.add(Qd(e,t-32)).mul(n),h=u.add(Qd(e,t-24)).mul(n);return $d(qd(c.add(l),43).add(qd(d,30)).add(h),c.add(qd(l.add(r),18)).add(d),n)}(e,n);var a=r,i=r.mul(Zd).add(113),o=jd(i.mul(Kd).add(113)).mul(Kd),s=[Xd.UZERO,Xd.UZERO],u=[Xd.UZERO,Xd.UZERO];a=a.mul(Kd).add(Qd(e,0));var c=0,l=64*(n-1>>6),d=l+(n-1&63)-63;do{var h;a=qd(a.add(i).add(s[0]).add(Qd(e,c+8)),37).mul(Zd),i=qd(i.add(s[1]).add(Qd(e,c+48)),42).mul(Zd),a=a.xor(u[1]),i=i.add(s[0]).add(Qd(e,c+40)),o=qd(o.add(u[0]),33).mul(Zd),s=eh(e,c,s[1].mul(Zd),a.add(u[0])),u=eh(e,c+32,o.add(u[1]),i.add(Qd(e,c+16))),o=(h=[a,o])[0],a=h[1],c+=64}while(c!==l);var p=Zd.add(o.and(255).shl(1));return c=d,u[0]=u[0].add(n-1&63),s[0]=s[0].add(u[0]),u[0]=u[0].add(s[0]),a=qd(a.add(i).add(s[0]).add(Qd(e,c+8)),37).mul(p),i=qd(i.add(s[1]).add(Qd(e,c+48)),42).mul(p),a=a.xor(u[1].mul(9)),i=i.add(s[0].mul(9).add(Qd(e,c+40))),o=qd(o.add(u[0]),33).mul(p),s=eh(e,c,s[1].mul(p),a.add(u[0])),u=eh(e,c+32,o.add(u[1]),i.add(Qd(e,c+16))),o=(t=[a,o])[0],a=t[1],$d($d(s[0],u[0],p).add(jd(i).mul(Hd)).add(o),$d(s[1],u[1],p).add(a),p)}function nh(e,t){return"string"===t?oh(e):rh([e],t)}function rh(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=ps(e)),Qs().getBool("DEBUG")&&_s(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var n=new Uint8Array(e.length),r=0;r<n.length;++r)0!==Math.round(e[r])&&(n[r]=1);return n}throw new Error("Unknown data type ".concat(t))}function ah(){return Qs().platform.now()}function ih(e,t){return Qs().platform.fetch(e,t)}function oh(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",Qs().platform.encode(e,t)}function sh(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",Qs().platform.decode(e,t)}var uh=Object.freeze(Object.defineProperty({__proto__:null,arraysEqual:ms,assert:ls,assertNonNegativeIntegerDimensions:Xs,assertNonNull:hs,assertShapesMatch:ds,bytesFromStringArray:Ns,bytesPerElement:Ms,checkConversionForErrors:_s,clamp:os,computeStrides:zs,createScalarValue:nh,createShuffledIndices:function(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return is(t),t},decodeString:sh,distSquared:function(e,t){for(var n=0,r=0;r<e.length;r++){var a=Number(e[r])-Number(t[r]);n+=a*a}return n},encodeString:oh,fetch:ih,fingerPrint64:th,flatten:ps,getArrayFromDType:Ts,getTypedArrayFromDType:Ss,hasEncodingLoss:Es,hexToLong:Bd,indexToLoc:Hs,inferDtype:Ps,inferFromImplicitShape:xs,isBoolean:Ls,isFunction:Ds,isInt:vs,isNumber:As,isPromise:Zs,isScalarShape:function(e){return 0===e.length},isString:Rs,isTypedArray:Cs,isValidDtype:Is,locToIndex:Bs,makeOnesTypedArray:Ws,makeZerosNestedTypedArray:Us,makeZerosTypedArray:Vs,nearestDivisor:Os,nearestLargerEven:ss,now:ah,parseAxisParam:ws,randUniform:function(e,t){var n=Math.random();return t*n+(1-n)*e},repeatedTry:bs,rightPad:ys,shuffle:is,shuffleCombo:function(e,t){if(e.length!==t.length)throw new Error("Array sizes must match to be shuffled together First array length was ".concat(e.length,"Second array length was ").concat(t.length));for(var n=e.length,r=0;n>0;)r=Math.random()*n|0,us(e,--n,r),us(t,n,r)},sizeFromShape:fs,sizeToSquarishShape:gs,squeezeShape:ks,sum:cs,swap:us,tanh:function(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)},toNestedArray:Gs,toTypedArray:rh},Symbol.toStringTag,{value:"Module"})),ch=function(){function e(t,n){T(this,e),this.backendTimer=t,this.logger=n,null==n&&(this.logger=new lh)}return E(e,[{key:"profileKernel",value:function(e,t,n){var r,a,i=function(){r=n()},o=ah();if(this.backendTimer.timerAvailable())a=this.backendTimer.time(i);else{i();var s,u=x(r);try{for(u.s();!(s=u.n()).done;){s.value.dataSync()}}catch(d){u.e(d)}finally{u.f()}a=Promise.resolve({kernelMs:ah()-o})}if(Qs().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var c=function(){var t=r[l];t.data().then((function(n){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var a=e[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(n,"'")),!0}}(n,t.dtype,e)}))},l=0;l<r.length;l++)c();return{kernelName:e,outputs:r,inputs:t,timeMs:a.then((function(e){return e.kernelMs})),extraInfo:a.then((function(e){return null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""}))}}},{key:"logKernelProfile",value:function(e){var t=this,n=e.kernelName,r=e.outputs,a=e.timeMs,i=e.inputs,o=e.extraInfo;r.forEach((function(e){Promise.all([e.data(),a,o]).then((function(r){t.logger.logKernelProfile(n,e,r[0],r[1],i,r[2])}))}))}}]),e}();var lh=function(){function e(){T(this,e)}return E(e,[{key:"logKernelProfile",value:function(e,t,n,r,a,i){var o="number"==typeof r?ys("".concat(r,"ms"),9):r.error,s=ys(e,25),u=t.rank,c=t.size,l=ys(t.shape.toString(),14),d="";for(var h in a){var p=a[h];if(null!=p){var f=p.shape||t.shape,m=f.length;d+="".concat(h,": ").concat(m,"D ").concat(m>0?f:""," ")}}console.log("%c".concat(s,"\t%c").concat(o,"\t%c").concat(u,"D ").concat(l,"\t%c").concat(c,"\t%c").concat(d,"\t%c").concat(i),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}]),e}();var dh=20,hh=3,ph=7;function fh(e,t,n,r){var a=zs(t),i=function(e,t,n,r){var a=fs(t),i=r[r.length-1],o=new Array(i).fill(0),s=t.length,u="complex64"===n?yh(e):e;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,d=0;d<i;d++)o[d]=Math.max(o[d],mh(u[l+d],0,n).length);return o}(e,t,n,a),o=t.length,s=gh(e,t,n,a,i),u=["Tensor"];return r&&(u.push("  dtype: ".concat(n)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(t,"]")),u.push("  values:")),u.push(s.map((function(e){return"    "+e})).join("\n")),u.join("\n")}function mh(e,t,n){return ys(Array.isArray(e)?"".concat(parseFloat(e[0].toFixed(ph))," + ").concat(parseFloat(e[1].toFixed(ph)),"j"):Rs(e)?"'".concat(e,"'"):"bool"===n?vh(e):parseFloat(e.toFixed(ph)).toString(),t)}function vh(e){return 0===e?"false":"true"}function gh(e,t,n,r,a){var i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o="complex64"===n?2:1,s=t[0],u=t.length;if(0===u)return"complex64"===n?[mh(yh(e)[0],0,n)]:"bool"===n?[vh(e[0])]:[e[0].toString()];if(1===u){if(s>dh){var c=hh*o,l=Array.from(e.slice(0,c)),d=Array.from(e.slice((s-hh)*o,s*o));return"complex64"===n&&(l=yh(l),d=yh(d)),["["+l.map((function(e,t){return mh(e,a[t],n)})).join(", ")+", ..., "+d.map((function(e,t){return mh(e,a[s-hh+t],n)})).join(", ")+"]"]}return["["+("complex64"===n?yh(e):Array.from(e)).map((function(e,t){return mh(e,a[t],n)})).join(", ")+"]"]}var h=t.slice(1),p=r.slice(1),f=r[0]*o,m=[];if(s>dh){for(var v=0;v<hh;v++){var g=v*f,y=g+f;m.push.apply(m,b(gh(e.slice(g,y),h,n,p,a,!1)))}m.push("...");for(var x=s-hh;x<s;x++){var w=x*f,k=w+f;m.push.apply(m,b(gh(e.slice(w,k),h,n,p,a,x===s-1)))}}else for(var S=0;S<s;S++){var T=S*f,_=T+f;m.push.apply(m,b(gh(e.slice(T,_),h,n,p,a,S===s-1)))}var I=2===u?",":"";m[0]="["+m[0]+I;for(var E=1;E<m.length-1;E++)m[E]=" "+m[E]+I;for(var C=",\n",M=2;M<u;M++)C+="\n";return m[m.length-1]=" "+m[m.length-1]+"]"+(i?"":C),m}function yh(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var bh=function(){function e(t,n,r){var a=this;if(T(this,e),this.dtype=n,this.shape=t.slice(),this.size=fs(t),null!=r){var i=r.length;ls(i===this.size,(function(){return"Length of values '".concat(i,"' does not match the size inferred by the shape '").concat(a.size,"'.")}))}if("complex64"===n)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Ts(n,this.size),this.strides=zs(t)}return E(e,[{key:"set",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];0===r.length&&(r=[0]),ls(r.length===this.rank,(function(){return"The number of provided coordinates (".concat(r.length,") must match the rank (").concat(t.rank,")")}));var i=this.locToIndex(r);this.values[i]=e}},{key:"get",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];0===t.length&&(t=[0]);for(var r=0,a=0,i=t;a<i.length;a++){var o=i[a];if(o<0||o>=this.shape[r]){var s="Requested out of range element at ".concat(t,".   Buffer shape=").concat(this.shape);throw new Error(s)}r++}for(var u=t[t.length-1],c=0;c<t.length-1;++c)u+=this.strides[c]*t[c];return this.values[u]}},{key:"locToIndex",value:function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}},{key:"indexToLoc",value:function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}},{key:"rank",get:function(){return this.shape.length}},{key:"toTensor",value:function(){return xh().makeTensor(this.values,this.shape,this.dtype)}}]),e}(),xh=null,wh=null;var kh=function(){function e(t,n,r,a){T(this,e),this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=fs(t),this.strides=zs(t),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return E(e,[{key:"rank",get:function(){return this.shape.length}},{key:"buffer",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",wh.buffer(this.shape,this.dtype,t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"bufferSync",value:function(){return wh.buffer(this.shape,this.dtype,this.dataSync())}},{key:"array",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",Gs(this.shape,t,"complex64"===this.dtype));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"arraySync",value:function(){return Gs(this.shape,this.dataSync(),"complex64"===this.dtype)}},{key:"data",value:function(){var e=S(w().mark((function e(){var t,n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.throwIfDisposed(),t=xh().read(this.dataId),"string"!==this.dtype){e.next=13;break}return e.next=5,t;case 5:return n=e.sent,e.prev=6,e.abrupt("return",n.map((function(e){return sh(e)})));case 10:throw e.prev=10,e.t0=e.catch(6),new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().");case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this,[[6,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"dataToGPU",value:function(e){return this.throwIfDisposed(),xh().readToGPU(this.dataId,e)}},{key:"dataSync",value:function(){this.throwIfDisposed();var e=xh().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return sh(e)}))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}},{key:"bytes",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.throwIfDisposed(),e.next=3,xh().read(this.dataId);case 3:return t=e.sent,e.abrupt("return","string"===this.dtype?t:new Uint8Array(t.buffer));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){this.isDisposed||(xh().disposeTensor(this),this.isDisposedInternal=!0)}},{key:"isDisposed",get:function(){return this.isDisposedInternal}},{key:"throwIfDisposed",value:function(){if(this.isDisposed)throw new Error("Tensor is disposed.")}},{key:"print",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return wh.print(this,e)}},{key:"clone",value:function(){return this.throwIfDisposed(),wh.clone(this)}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return fh(this.dataSync(),this.shape,this.dtype,e)}},{key:"cast",value:function(e){return this.throwIfDisposed(),wh.cast(this,e)}},{key:"variable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),xh().makeVariable(this,e,t,n)}}]),e}();function Sh(){return eu("Tensor",(function(){return kh}))}Object.defineProperty(kh,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}}),Sh();var Th,_h,Ih,Eh,Ch,Mh=function(e){m(n,e);var t=y(n);function n(e,r,a,i){var o;return T(this,n),(o=t.call(this,e.shape,e.dtype,e.dataId,i)).trainable=r,o.name=a,o}return E(n,[{key:"assign",value:function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and previous value (").concat(this.dtype,") must match"));if(!ms(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and previous value (").concat(this.shape,") must match"));xh().disposeTensor(this),this.dataId=e.dataId,xh().incRef(this,null)}},{key:"dispose",value:function(){xh().disposeVariable(this),this.isDisposedInternal=!0}}]),n}(kh);Object.defineProperty(Mh,Symbol.hasInstance,{value:function(e){return e instanceof kh&&null!=e.assign&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(Th||(Th={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(_h||(_h={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(Ih||(Ih={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(Eh||(Eh={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(Ch||(Ch={}));var Nh={float32:Eh,int32:_h,bool:Ih,complex64:Ch};function Rh(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return Nh[e][t]}function Lh(e){return Rh(e,"int32")}function Ah(e,t){if(e.dtype===t.dtype)return[e,t];var n=Rh(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Ph(e,t){ls(e.dtype===t.dtype,(function(){return"The dtypes of the first(".concat(e.dtype,") and second(").concat(t.dtype,") input must match")}))}function Dh(e,t){return t.some((function(t){return t.id===e.id}))}function Oh(e){var t=[];return zh(e,t,new Set),t}function zh(e,t,n){if(null!=e)if(e instanceof kh)t.push(e);else if(function(e){return Array.isArray(e)||"object"==typeof e}(e)){var r=e;for(var a in r){var i=r[a];n.has(i)||(n.add(i),zh(i,t,n))}}}var Fh=Object.freeze(Object.defineProperty({__proto__:null,assertTypesMatch:Ph,getTensorsInContainer:Oh,isTensorInList:Dh,makeTypesMatch:Ah},Symbol.toStringTag,{value:"Module"}));function Gh(e){return null!=e.kernelName}var Wh=function(){function e(){T(this,e),this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((function(e){return e.name}))))}}}return E(e,[{key:"dispose",value:function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()}}]),e}(),Vh=function(){function e(t){T(this,e),this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Wh}return E(e,[{key:"ready",value:function(){var e=S(w().mark((function e(){var t,n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.pendingBackendInit){e.next=2;break}return e.abrupt("return",this.pendingBackendInit.then((function(){})));case 2:if(null==this.backendInstance){e.next=4;break}return e.abrupt("return");case 4:t=this.getSortedBackends(),n=0;case 6:if(!(n<t.length)){e.next=17;break}return r=t[n],e.next=10,this.initializeBackend(r).success;case 10:if(!e.sent){e.next=14;break}return e.next=13,this.setBackend(r);case 13:return e.abrupt("return");case 14:n++,e.next=6;break;case 17:throw new Error("Could not initialize any backends, all backend initializations failed.");case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"backend",get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods"));if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '".concat(t,"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods"));this.setBackend(t)}return this.backendInstance}},{key:"backendNames",value:function(){return Object.keys(this.registryFactory)}},{key:"findBackend",value:function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]}},{key:"findBackendFactory",value:function(e){return e in this.registryFactory?this.registryFactory[e].factory:null}},{key:"registerBackend",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(cd("".concat(e," backend was already registered. Reusing existing backend factory.")),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}},{key:"setBackend",value:function(){var e=S(w().mark((function e(t){var n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.registryFactory[t]){e.next=2;break}throw new Error("Backend name '".concat(t,"' not found in registry"));case 2:if(this.backendName=t,null!=this.registry[t]){e.next=14;break}if(this.backendInstance=null,n=this.initializeBackend(t),r=n.success,!n.asyncInit){e.next=11;break}return e.next=8,r;case 8:e.t0=e.sent,e.next=12;break;case 11:e.t0=r;case 12:if(e.t0){e.next=14;break}return e.abrupt("return",!1);case 14:return e.abrupt("return",(this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new ch(this.backendInstance),!0));case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setupRegisteredKernels",value:function(){var e=this;fd(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))}},{key:"disposeRegisteredKernels",value:function(e){var t=this;fd(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))}},{key:"initializeBackend",value:function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var r=n.factory();if(!r||r instanceof rs||"function"!=typeof r.then)return this.registry[e]=r,{success:!0,asyncInit:!1};var a=++this.pendingBackendInitId,i=r.then((function(n){return!(a<t.pendingBackendInitId)&&(t.registry[e]=n,t.pendingBackendInit=null,!0)})).catch((function(n){return a<t.pendingBackendInitId||(t.pendingBackendInit=null,cd("Initialization of backend ".concat(e," failed")),cd(n.stack||n.message)),!1}));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}catch(r){return cd("Initialization of backend ".concat(e," failed")),cd(r.stack||r.message),{success:!1,asyncInit:!1}}}},{key:"removeBackend",value:function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}},{key:"getSortedBackends",value:function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))}},{key:"initializeBackendsAndReturnBest",value:function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),a=r.success,i=r.asyncInit;if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}},{key:"moveData",value:function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t),i=r.refCount(t);r.disposeData(t,!0),n.backend=e,e.move(t,a,n.shape,n.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}},{key:"tidy",value:function(e,t){var n,r=this,a=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun((function(){return r.startScope(a)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))}},{key:"scopedRun",value:function(e,t,n){e();try{var r=n();return t(),r}catch(r){throw t(),r}}},{key:"nextTensorId",value:function(){return e.nextTensorId++}},{key:"nextVariableId",value:function(){return e.nextVariableId++}},{key:"clone",value:function(e){var t=Bh.runKernel(mc,{x:e}),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(function(e){return{x:function(){var t={x:e},n={dtype:"float32"};return Bh.runKernel(Tu,t,n)}}}),[],{}),t}},{key:"runKernel",value:function(e,t,n){if(null==this.backendName&&this.backend,null==hd(e,this.backendName))throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}},{key:"shouldCheckForMemLeaks",value:function(){return this.ENV.getBool("IS_TEST")}},{key:"checkKernelForMemLeak",value:function(e,t,n){var r=this.backend.numDataIds(),a=0;n.forEach((function(e){a+="complex64"===e.dtype?3:1}));var i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-a-i;if(o>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak (").concat(o," data ids) after running '").concat(e,"'"))}},{key:"runKernelFunc",value:function(e){var t,n,r,a=this,i=[],o=this.isTapeOn(),s=this.state.numBytes,u=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;var c=Gh(e)?e.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(Gh(e)){var l=e.kernelName,d=e.inputs,h=e.attrs;null==this.backendName&&this.backend;var p=hd(l,this.backendName);ls(null!=p,(function(){return"Cannot find registered kernel '".concat(l,"' for backend '").concat(a.backendName,"'")})),n=function(){var e=a.backend.numDataIds();r=p.kernelFunc({inputs:d,attrs:h,backend:a.backend});var t=Array.isArray(r)?r:[r];a.shouldCheckForMemLeaks()&&a.checkKernelForMemLeak(l,e,t);var n=t.map((function(e){return null!=e.rank?e:a.makeTensorFromTensorInfo(e)}));if(o){var s=a.getTensorsForGradient(l,d,n);i=a.saveTensorsForBackwardMode(s)}return n}}else{var f=e.forwardFunc,m=function(e){o&&(i=e.map((function(e){return a.keep(a.clone(e))})))};n=function(){var e=a.backend.numDataIds();r=a.tidy((function(){return f(a.backend,m)}));var t=Array.isArray(r)?r:[r];return a.shouldCheckForMemLeaks()&&a.checkKernelForMemLeak(c,e,t),t}}var v,g=e.inputs,y=e.attrs,b=Gh(e)?null:e.backwardsFunc;return this.scopedRun((function(){return a.state.kernelDepth++}),(function(){return a.state.kernelDepth--}),(function(){a.ENV.getBool("DEBUG")||a.state.profiling?(v=a.profiler.profileKernel(c,g,(function(){return n()})),a.ENV.getBool("DEBUG")&&a.profiler.logKernelProfile(v),t=v.outputs):t=n()})),o&&this.addTapeNode(c,g,t,b,i,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-u,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map((function(e){return null!=g[e]?g[e].shape:null})),outputShapes:t.map((function(e){return e.shape})),kernelTimeMs:v.timeMs,extraInfo:v.extraInfo}),Array.isArray(r)?t:t[0]}},{key:"saveTensorsForBackwardMode",value:function(e){var t=this;return e.map((function(e){return t.keep(t.clone(e))}))}},{key:"getTensorsForGradient",value:function(e,t,n){var r=pd(e);if(null!=r){var a,i=r.inputsToSave||[],o=r.outputsToSave||[];r.saveAllInputs?(ls(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),a=Object.keys(t).map((function(e){return t[e]}))):a=i.map((function(e){return t[e]}));var s=n.filter((function(e,t){return o[t]}));return a.concat(s)}return[]}},{key:"makeTensor",value:function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var a=e;"string"===n&&Rs(e[0])&&(a=e.map((function(e){return oh(e)})));var i=r.write(a,t,n),o=new kh(t,n,i,this.nextTensorId());if(this.trackTensor(o,r),"string"===n){var s=this.state.tensorInfo.get(i),u=Ns(a);this.state.numBytes+=u-s.bytes,s.bytes=u}return o}},{key:"makeTensorFromDataId",value:function(e,t,n,r){var a={dataId:e,shape:t,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(a,r)}},{key:"makeTensorFromTensorInfo",value:function(e,t){var n=e.dataId,r=e.shape,a=e.dtype,i=new kh(r,a,n,this.nextTensorId());return this.trackTensor(i,t),i}},{key:"makeVariable",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));var a=new Mh(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name ".concat(a.name," was already registered"));return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}},{key:"trackTensor",value:function(e,t){this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++;var n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*Ms(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof Mh||this.track(e)}},{key:"incRef",value:function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}},{key:"removeDataId",value:function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}},{key:"disposeTensor",value:function(e){if(this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,"string"===e.dtype&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),"complex64"!==e.dtype&&"string"!==e.dtype){var n=e.size*Ms(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}}},{key:"disposeVariables",value:function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}}},{key:"disposeVariable",value:function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}},{key:"memory",value:function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}},{key:"profile",value:function(){var e=S(w().mark((function e(t){var n,r,a,i,o;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state.profiling=!0,n=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],e.next=5,t();case 5:this.state.activeProfile.result=e.sent,this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,b(this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot})))),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r,a=x(this.state.activeProfile.kernels),e.prev=11,a.s();case 13:if((i=a.n()).done){e.next=23;break}return o=i.value,e.next=17,o.kernelTimeMs;case 17:return o.kernelTimeMs=e.sent,e.next=20,o.extraInfo;case 20:o.extraInfo=e.sent;case 21:e.next=13;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(11),a.e(e.t0);case 28:return e.prev=28,a.f(),e.finish(28);case 31:return e.abrupt("return",this.state.activeProfile);case 32:case"end":return e.stop()}}),e,this,[[11,25,28,31]])})));return function(t){return e.apply(this,arguments)}}()},{key:"isTapeOn",value:function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}},{key:"addTapeNode",value:function(e,t,n,r,a,i){var o=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},u=pd(e);null!=u&&(r=u.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],a=Vs(r.size,r.dtype);return o.makeTensor(a,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],a,i)}),this.state.activeTape.push(s)}},{key:"keep",value:function(e){return e.kept=!0,e}},{key:"startTape",value:function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}},{key:"endTape",value:function(){this.state.gradientDepth--}},{key:"startScope",value:function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}},{key:"endScope",value:function(e){for(var t=this,n=Oh(e),r=new Set(n.map((function(e){return e.id}))),a=0;a<this.state.activeScope.track.length;a++){var i=this.state.activeScope.track[a];!i.kept&&!r.has(i.id)&&i.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){!e.kept&&e.scopeId===o.id&&t.track(e)}))}},{key:"gradients",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(ls(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var i=this.scopedRun((function(){return r.startTape()}),(function(){return r.endTape()}),(function(){return r.tidy("forward",e)}));ls(i instanceof kh,(function(){return"The result y returned by f() must be a tensor."}));var o=function(e,t,n){for(var r={},a={},i=0;i<t.length;i++)r[t[i].id]=!0;for(var o=0;o<e.length;o++){var s=e[o],u=s.inputs;for(var c in u){for(var l=u[c],d=!1,h=0;h<t.length;h++)if(r[l.id]){s.outputs.forEach((function(e){return r[e.id]=!0})),d=!0,a[s.id]=!0;break}if(d)break}}var p={};p[n.id]=!0;for(var f={},m=e.length-1;m>=0;m--)for(var v=e[m],g=v.inputs,y=0;y<v.outputs.length;y++)if(p[v.outputs[y].id]){for(var b in g)p[g[b].id]=!0,f[v.id]=!0;break}for(var x=[],w=0;w<e.length;w++){var k=e[w];if(a[k.id]&&f[k.id]){var S={};for(var T in k.inputs){var _=k.inputs[T];r[_.id]&&(S[T]=_)}var I=Object.assign({},k);I.inputs=S,I.outputs=k.outputs,x.push(I)}}return x}(this.state.activeTape,t,i);if(!a&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e={};e[i.id]=null!==n&&void 0!==n?n:function(e){var t=Ws(fs(e),"float32");return Bh.makeTensor(t,e,"float32")}(i.shape),function(e,t,n,r){for(var a=function(){var a=t[i],o=[];if(a.outputs.forEach((function(t){var n=e[t.id];null!=n?o.push(n):o.push(null)})),null==a.gradient)throw new Error("Cannot compute gradient: gradient function not found for ".concat(a.kernelName,"."));var s=a.gradient(o),u=function(t){if(!(t in s))throw new Error("Cannot backprop through input ".concat(t,". Available gradients found: ").concat(Object.keys(s),"."));var i=n((function(){return s[t]()}));if("float32"!==i.dtype)throw new Error("Error in gradient for op ".concat(a.kernelName,". The gradient of input ").concat(t," must have 'float32' dtype, but has '").concat(i.dtype,"'"));var o=a.inputs[t];if(!ms(i.shape,o.shape))throw new Error("Error in gradient for op ".concat(a.kernelName,". The gradient of input '").concat(t,"' has shape '").concat(i.shape,"', which does not match the shape of the input '").concat(o.shape,"'"));if(null==e[o.id])e[o.id]=i;else{var u=e[o.id];e[o.id]=r(u,i),u.dispose()}};for(var c in a.inputs)u(c)},i=t.length-1;i>=0;i--)a()}(e,o,(function(e){return r.tidy(e)}),Hh);var a=t.map((function(t){return e[t.id]}));return 0===r.state.gradientDepth&&(r.state.activeTape.forEach((function(e){var t,n=x(e.saved);try{for(n.s();!(t=n.n()).done;){t.value.dispose()}}catch(r){n.e(r)}finally{n.f()}})),r.state.activeTape=null),{value:i,grads:a}}))}},{key:"customGrad",value:function(e){var t=this;return ls(Ds(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i;ls(r.every((function(e){return e instanceof kh})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var o={};r.forEach((function(e,t){o[t]=e}));return t.runKernelFunc({forwardFunc:function(t,n){return ls((i=e.apply(void 0,r.concat([n]))).value instanceof kh,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),ls(Ds(i.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),i.value},backwardsFunc:function(e,t){var n=i.gradFunc(e,t),a=Array.isArray(n)?n:[n];ls(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),ls(a.every((function(e){return e instanceof kh})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(e,t){o[t]=function(){return e}})),o},inputs:o})}}},{key:"readSync",value:function(e){return this.state.tensorInfo.get(e).backend.readSync(e)}},{key:"read",value:function(e){return this.state.tensorInfo.get(e).backend.read(e)}},{key:"readToGPU",value:function(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}},{key:"time",value:function(){var e=S(w().mark((function e(t){var n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=ah(),e.next=3,this.backend.time(t);case 3:return r=e.sent,e.abrupt("return",(r.wallMs=ah()-n,r));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"track",value:function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}},{key:"registeredVariables",get:function(){return this.state.registeredVariables}},{key:"reset",value:function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Wh,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}]),e}();function Uh(){var e=$s();if(null==e._tfengine){var t=new js(e);e._tfengine=new Vh(t)}return function(e){qs=e}(e._tfengine.ENV),function(e){xh=e}((function(){return e._tfengine})),e._tfengine}Vh.nextTensorId=0,Vh.nextVariableId=0;var Xh,Bh=Uh();function Hh(e,t){var n={a:e,b:t};return Bh.runKernel(au,n)}function Zh(e){if(void 0!==Xh)return Xh;if(e||typeof navigator<"u"&&null!=navigator){if(e||(e=navigator),"ReactNative"===e.product)return!0;var t=e.userAgent||e.vendor||(typeof window<"u"?window.opera:"");if(!t){var n=e;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function Kh(){return typeof window<"u"&&null!=window.document||typeof WorkerGlobalScope<"u"}var jh=Object.freeze(Object.defineProperty({__proto__:null,isBrowser:Kh,isMobile:Zh,mockIsMobile:function(e){Xh=e}},Symbol.toStringTag,{value:"Module"})),Yh=Qs();function Qh(e,t){var n=e;if(Cs(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||Cs(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&Qs().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Jh(e,r,[]),r}function Jh(e,t,n){if(n=n||[],Array.isArray(e)||Cs(e)){ls(t.length>0,(function(){return"Element arr[".concat(n.join("]["),"] should be a primitive, but is an array of ").concat(e.length," elements")})),ls(e.length===t[0],(function(){return"Element arr[".concat(n.join("]["),"] should have ").concat(t[0]," elements, but has ").concat(e.length," elements")}));for(var r=t.slice(1),a=0;a<e.length;++a)Jh(e[a],r,n.concat(a))}else ls(0===t.length,(function(){return"Element arr[".concat(n.join("]["),"] is a primitive, but should be an array/TypedArray of ").concat(t[0]," elements")}))}function qh(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error("Argument '".concat(n,"' passed to '").concat(r,"' must be ").concat(e," tensor, but got ").concat(t," tensor"))}}function $h(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof kh)return qh(r,e.dtype,t,n),e;var a=Ps(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),qh(r,a,t,n),null==e||!Cs(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){var i=null==e?"null":e.constructor.name;throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a Tensor or TensorLike, but got '").concat(i,"'"))}var o=Qh(e,a);!Cs(e)&&!Array.isArray(e)&&(e=[e]);var s="string"!==a?rh(e,a):ps(e,[],!0);return Bh.makeTensor(s,o,a)}function ep(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(!Array.isArray(e))throw new Error("Argument ".concat(t," passed to ").concat(n," must be a `Tensor[]` or `TensorLike[]`"));return e.map((function(e,a){return $h(e,"".concat(t,"[").concat(a,"]"),n,r)}))}Yh.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),Yh.registerFlag("IS_BROWSER",(function(){return Kh()})),Yh.registerFlag("IS_NODE",(function(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"})),Yh.registerFlag("IS_CHROME",(function(){return typeof navigator<"u"&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),Yh.registerFlag("PROD",(function(){return!1})),Yh.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return Yh.getBool("DEBUG")})),Yh.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),Yh.registerFlag("IS_TEST",(function(){return!1})),Yh.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(function(){return!0})),Yh.registerFlag("WRAP_TO_IMAGEBITMAP",(function(){return!1})),Yh.registerFlag("ENGINE_COMPILE_ONLY",(function(){return!1})),Yh.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",(function(){return!1})),Yh.registerFlag("USE_SETTIMEOUTCUSTOM",(function(){return!1}));var tp="__op";function np(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with ".concat(t.length," keys."));var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+=tp;var a=function(){Bh.startScope(n);try{var e=r.apply(void 0,arguments);return Zs(e)&&console.error("Cannot return a Promise inside of tidy."),Bh.endScope(e),e}catch(e){throw Bh.endScope(null),e}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}var rp=np({complex_:function(e,t){var n=$h(e,"real","complex"),r=$h(t,"imag","complex");ds(n.shape,r.shape,"real and imag shapes, ".concat(n.shape," and ").concat(r.shape,", must match in call to tf.complex()."));var a={real:n,imag:r};return Bh.runKernel(Eu,a)}});function ap(e,t,n,r){if(null==r&&(r=Ps(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Cs(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){Xs(t);var a=fs(t),i=fs(n);ls(a===i,(function(){return"Based on the provided shape, [".concat(t,"], the tensor should have ").concat(a," values but has ").concat(i)}));for(var o=0;o<n.length;++o){var s=n[o],u=o!==n.length-1||s!==fs(t.slice(o));ls(n[o]===t[o]||!u,(function(){return"Error creating a new Tensor. Inferred shape (".concat(n,") does not match the provided shape (").concat(t,"). ")}))}}return!Cs(e)&&!Array.isArray(e)&&(e=[e]),t=t||n,e="string"!==r?rh(e,r):ps(e,[],!0),Bh.makeTensor(e,t,r)}function ip(e,t,n){return ap(e,t,Qh(e,n),n)}var op={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8},sp=4;function up(e,t){return cp.apply(this,arguments)}function cp(){return cp=S(w().mark((function e(t,n){var r,a,i,o,s,u;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],a=[],i=Array.isArray(t)?t.map((function(e){return e.name})):Object.keys(t),o=w().mark((function e(){var o,u,c,l;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=i[s],"float32"===(u=Array.isArray(t)?t[s].tensor:t[o]).dtype||"int32"===u.dtype||"bool"===u.dtype||"string"===u.dtype||"complex64"===u.dtype){e.next=3;break}throw new Error("Unsupported dtype in weight '".concat(o,"': ").concat(u.dtype));case 3:c={name:o,shape:u.shape,dtype:u.dtype},"string"===u.dtype?(l=new Promise(function(){var e=S(w().mark((function e(t){var n,r,a,i,o,s,c;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.bytes();case 2:for(n=e.sent,r=n.reduce((function(e,t){return e+t.length}),0)+sp*n.length,a=new Uint8Array(r),i=0,o=0;o<n.length;o++)s=n[o],c=new Uint8Array(new Uint32Array([s.length]).buffer),a.set(c,i),i+=sp,a.set(s,i),i+=s.length;t(a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.push(l)):a.push(u.data()),null!=n&&(c.group=n),r.push(c);case 6:case"end":return e.stop()}}),e)})),s=0;case 3:if(!(s<i.length)){e.next=8;break}return e.delegateYield(o(),"t0",5);case 5:++s,e.next=3;break;case 8:return e.next=10,Promise.all(a);case 10:return u=e.sent,e.abrupt("return",{data:dp(u),specs:r});case 12:case"end":return e.stop()}}),e)}))),cp.apply(this,arguments)}function lp(e,t){var n,r,a={},i=0,o=x(t);try{for(o.s();!(r=o.n()).done;){var s=r.value,u=s.name,c=s.dtype,l=s.shape,d=fs(l),h=void 0;if("quantization"in s){var p=s.quantization;if("uint8"===p.dtype||"uint16"===p.dtype){if(!("min"in p)||!("scale"in p))throw new Error("Weight ".concat(s.name," with quantization ").concat(p.dtype," doesn't have corresponding metadata min and scale."))}else{if("float16"!==p.dtype)throw new Error("Weight ".concat(s.name," has unknown quantization dtype ").concat(p.dtype,". Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'."));if("float32"!==c)throw new Error("Weight ".concat(s.name," is quantized with ").concat(p.dtype," which only supports weights of type float32 not ").concat(c,"."))}var f=op[p.dtype],m=e.slice(i,i+d*f),v="uint8"===p.dtype?new Uint8Array(m):new Uint16Array(m);if("float32"===c)if("uint8"===p.dtype||"uint16"===p.dtype){h=new Float32Array(v.length);for(var g=0;g<v.length;g++){var y=v[g];h[g]=y*p.scale+p.min}}else{if("float16"!==p.dtype)throw new Error("Unsupported quantization type ".concat(p.dtype," for weight type float32."));void 0===n&&(n=Tp()),h=n(v)}else{if("int32"!==c)throw new Error("Unsupported dtype in weight '".concat(u,"': ").concat(c));if("uint8"!==p.dtype&&"uint16"!==p.dtype)throw new Error("Unsupported quantization type ".concat(p.dtype," for weight type int32."));h=new Int32Array(v.length);for(var b=0;b<v.length;b++){var w=v[b];h[b]=Math.round(w*p.scale+p.min)}}i+=d*f}else if("string"===c){var k=fs(s.shape);h=[];for(var S=0;S<k;S++){var T=new Uint32Array(e.slice(i,i+sp))[0];i+=sp;var _=new Uint8Array(e.slice(i,i+T));h.push(_),i+=T}}else{var I=op[c],E=e.slice(i,i+d*I);if("float32"===c)h=new Float32Array(E);else if("int32"===c)h=new Int32Array(E);else if("bool"===c)h=new Uint8Array(E);else{if("complex64"!==c)throw new Error("Unsupported dtype in weight '".concat(u,"': ").concat(c));h=new Float32Array(E);for(var C=new Float32Array(h.length/2),M=new Float32Array(h.length/2),N=0;N<C.length;N++)C[N]=h[2*N],M[N]=h[2*N+1];var R=ip(C,l,"float32"),L=ip(M,l,"float32");a[u]=rp(R,L),R.dispose(),L.dispose()}i+=d*I}"complex64"!==c&&(a[u]=ip(h,l,c))}}catch(A){o.e(A)}finally{o.f()}return a}function dp(e){if(null===e)throw new Error("Invalid input value: ".concat(JSON.stringify(e)));var t=0,n=[];e.forEach((function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: ".concat(e.constructor.name))}));var r=new Uint8Array(t),a=0;return n.forEach((function(e){r.set(new Uint8Array(e.buffer),a),a+=e.byteLength})),r.buffer}var hp=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function pp(e){return hp?Buffer.byteLength(e):new Blob([e]).size}function fp(e){if(hp)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}function mp(e){if(hp){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),a=0;a<n.length;++a)r.set([n.charCodeAt(a)],a);return r.buffer}function vp(e){if(1===e.length)return e[0];var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function gp(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function yp(e,t){var n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),n}function bp(e,t,n){var r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(null!=e.trainingConfig&&(r.trainingConfig=e.trainingConfig),null!=e.weightsManifest){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=t,r.weightData=n}return null!=e.signature&&(r.signature=e.signature),null!=e.userDefinedMetadata&&(r.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(r.modelInitializer=e.modelInitializer),r}function xp(e,t){return wp.apply(this,arguments)}function wp(){return wp=S(w().mark((function e(t,n){var r,a,o,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=t.weightsManifest,!e.t0){e.next=9;break}return e.next=4,n(t.weightsManifest);case 4:r=e.sent,a=i(r,2),o=a[0],s=a[1];case 9:return e.abrupt("return",bp(t,o,s));case 10:case"end":return e.stop()}}),e)}))),wp.apply(this,arguments)}function kp(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:pp(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:pp(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}function Sp(e){var t,n=[],r=x(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push.apply(n,b(a.weights))}}catch(i){r.e(i)}finally{r.f()}return n}function Tp(){var e=function(){var e=function(e){for(var t=e<<13,n=0;!(8388608&t);)n-=8388608,t<<=1;return(t&=-8388609)|n+947912704},t=new Uint32Array(2048);t[0]=0;for(var n=1;n<1024;n++)t[n]=e(n);for(var r=1024;r<2048;r++)t[r]=939524096+(r-1024<<13);return t}(),t=function(){var e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(var t=1;t<31;t++)e[t]=t<<23;for(var n=33;n<63;n++)e[n]=2147483648+(n-32<<23);return e}(),n=function(){for(var e=new Uint32Array(64),t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}();return function(r){for(var a=new ArrayBuffer(4*r.length),i=new Uint32Array(a),o=0;o<r.length;o++){var s=r[o],u=e[n[s>>10]+(1023&s)]+t[s>>10];i[o]=u}return new Float32Array(a)}}var _p=function(){function e(){T(this,e),this.saveRouters=[],this.loadRouters=[]}return E(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerSaveRouter",value:function(t){e.getInstance().saveRouters.push(t)}},{key:"registerLoadRouter",value:function(t){e.getInstance().loadRouters.push(t)}},{key:"getSaveHandlers",value:function(t){return e.getHandlers(t,"save")}},{key:"getLoadHandlers",value:function(t,n){return e.getHandlers(t,"load",n)}},{key:"getHandlers",value:function(t,n,r){var a=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&a.push(n)})),a}}]),e}(),Ip=function(e){return _p.getSaveHandlers(e)},Ep=function(e,t){return _p.getLoadHandlers(e,t)},Cp="tensorflowjs",Mp="models_store",Np="model_info_store";function Rp(){if(!Qs().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=typeof window>"u"?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function Lp(e){var t=e.result;t.createObjectStore(Mp,{keyPath:"modelPath"}),t.createObjectStore(Np,{keyPath:"modelPath"})}var Ap=function(){function e(t){if(T(this,e),this.indexedDB=Rp(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return E(e,[{key:"save",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return e.abrupt("return",this.databaseAction(this.modelPath,t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.databaseAction(this.modelPath));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"databaseAction",value:function(e,t){var n=this;return new Promise((function(e,r){var a=n.indexedDB.open(Cp,1);a.onupgradeneeded=function(){return Lp(a)},a.onsuccess=function(){var i=a.result;if(null==t){var o=i.transaction(Mp,"readonly"),s=o.objectStore(Mp).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '".concat(n.modelPath,"' in IndexedDB.")));e(s.result.modelArtifacts)},s.onerror=function(e){return i.close(),r(s.error)},o.oncomplete=function(){return i.close()}}else{var u,c=kp(t),l=i.transaction(Np,"readwrite"),d=l.objectStore(Np),h=d.put({modelPath:n.modelPath,modelArtifactsInfo:c});h.onsuccess=function(){var a=(u=i.transaction(Mp,"readwrite")).objectStore(Mp).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:c});a.onsuccess=function(){return e({modelArtifactsInfo:c})},a.onerror=function(e){var t=(d=l.objectStore(Np)).delete(n.modelPath);t.onsuccess=function(){return i.close(),r(a.error)},t.onerror=function(e){return i.close(),r(a.error)}}},h.onerror=function(e){return i.close(),r(h.error)},l.oncomplete=function(){null==u?i.close():u.oncomplete=function(){return i.close()}}}},a.onerror=function(e){return r(a.error)}}))}}]),e}();Ap.URL_SCHEME="indexeddb://";var Pp=function(e){return Qs().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Ap.URL_SCHEME)?function(e){return new Ap(e)}(e.slice(Ap.URL_SCHEME.length)):null};function Dp(e){return e.startsWith(Ap.URL_SCHEME)?e.slice(Ap.URL_SCHEME.length):e}_p.registerSaveRouter(Pp),_p.registerLoadRouter(Pp);var Op=function(){function e(){T(this,e),this.indexedDB=Rp()}return E(e,[{key:"listModels",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=t.indexedDB.open(Cp,1);r.onupgradeneeded=function(){return Lp(r)},r.onsuccess=function(){var t=r.result,a=t.transaction(Np,"readonly"),i=a.objectStore(Np).getAll();i.onsuccess=function(){var t,n={},r=x(i.result);try{for(r.s();!(t=r.n()).done;){var a=t.value;n[a.modelPath]=a.modelArtifactsInfo}}catch(o){r.e(o)}finally{r.f()}e(n)},i.onerror=function(e){return t.close(),n(i.error)},a.oncomplete=function(){return t.close()}},r.onerror=function(e){return n(r.error)}})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=S(w().mark((function e(t){var n=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=Dp(t),new Promise((function(e,r){var a=n.indexedDB.open(Cp,1);a.onupgradeneeded=function(){return Lp(a)},a.onsuccess=function(){var n,i=a.result,o=i.transaction(Np,"readwrite"),s=o.objectStore(Np),u=s.get(t);u.onsuccess=function(){if(null==u.result)return i.close(),r(new Error("Cannot find model with path '".concat(t,"' in IndexedDB.")));var a=s.delete(t),o=function(){var a=(n=i.transaction(Mp,"readwrite")).objectStore(Mp).delete(t);a.onsuccess=function(){return e(u.result.modelArtifactsInfo)},a.onerror=function(e){return r(u.error)}};a.onsuccess=o,a.onerror=function(e){return o(),i.close(),r(u.error)}},u.onerror=function(e){return i.close(),r(u.error)},o.oncomplete=function(){null==n?i.close():n.oncomplete=function(){return i.close()}}},a.onerror=function(e){return r(a.error)}}))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),zp="/",Fp="tensorflowjs_models",Gp="info",Wp="model_topology",Vp="weight_specs",Up="weight_data",Xp="model_metadata";function Bp(e){return{info:[Fp,e,Gp].join(zp),topology:[Fp,e,Wp].join(zp),weightSpecs:[Fp,e,Vp].join(zp),weightData:[Fp,e,Up].join(zp),modelMetadata:[Fp,e,Xp].join(zp)}}function Hp(e){for(var t=0,n=Object.values(e);t<n.length;t++){var r=n[t];window.localStorage.removeItem(r)}}function Zp(e){var t=e.split(zp);if(t.length<3)throw new Error("Invalid key format: ".concat(e));return t.slice(1,t.length-1).join(zp)}function Kp(e){return e.startsWith(jp.URL_SCHEME)?e.slice(jp.URL_SCHEME.length):e}var jp=function(){function e(t){if(T(this,e),!Qs().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=Bp(this.modelPath)}return E(e,[{key:"save",value:function(){var e=S(w().mark((function e(t){var n,r,a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),a=kp(t),e.prev=3,this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,fp(t.weightData)),i={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:null!=t.signature?t.signature:void 0,userDefinedMetadata:null!=t.userDefinedMetadata?t.userDefinedMetadata:void 0,modelInitializer:null!=t.modelInitializer?t.modelInitializer:void 0,trainingConfig:null!=t.trainingConfig?t.trainingConfig:void 0},e.abrupt("return",(this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:a}));case 9:throw e.prev=9,e.t0=e.catch(3),Hp(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=").concat(a.modelTopologyBytes,", weightSpecsBytes=").concat(a.weightSpecsBytes,", weightDataBytes=").concat(a.weightDataBytes,"."));case 12:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i,o,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(t=JSON.parse(this.LS.getItem(this.keys.info)))){e.next=3;break}throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));case 3:if("JSON"===t.modelTopologyType){e.next=5;break}throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");case 5:if(n={},null!=(r=JSON.parse(this.LS.getItem(this.keys.topology)))){e.next=8;break}throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' is missing."));case 8:if(n.modelTopology=r,null!=(a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))){e.next=12;break}throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' are missing."));case 12:if(n.weightSpecs=a,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(o=JSON.parse(i),n.format=o.format,n.generatedBy=o.generatedBy,n.convertedBy=o.convertedBy,null!=o.signature&&(n.signature=o.signature),null!=o.userDefinedMetadata&&(n.userDefinedMetadata=o.userDefinedMetadata),null!=o.modelInitializer&&(n.modelInitializer=o.modelInitializer),null!=o.trainingConfig&&(n.trainingConfig=o.trainingConfig)),null!=(s=this.LS.getItem(this.keys.weightData))){e.next=18;break}throw new Error("In local storage, the binary weight values of model '".concat(this.modelPath,"' are missing."));case 18:return e.abrupt("return",(n.weightData=mp(s),n));case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();jp.URL_SCHEME="localstorage://";var Yp=function(e){return Qs().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(jp.URL_SCHEME)?function(e){return new jp(e)}(e.slice(jp.URL_SCHEME.length)):null};_p.registerSaveRouter(Yp),_p.registerLoadRouter(Yp);var Qp=function(){function e(){T(this,e),ls(Qs().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),ls(typeof window>"u"||typeof window.localStorage<"u",(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return E(e,[{key:"listModels",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i,o;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t={},n=Fp+zp,r=zp+Gp,a=0;a<this.LS.length;++a)(i=this.LS.key(a)).startsWith(n)&&i.endsWith(r)&&(o=Zp(i),t[o]=JSON.parse(this.LS.getItem(i)));return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=S(w().mark((function e(t){var n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Kp(t),n=Bp(t),null!=this.LS.getItem(n.info)){e.next=4;break}throw new Error("Cannot find model at path '".concat(t,"'"));case 4:return r=JSON.parse(this.LS.getItem(n.info)),e.abrupt("return",(Hp(n),r));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Jp="://",qp=function(){function e(){T(this,e),this.managers={}}return E(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerManager",value:function(t,n){ls(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith(Jp)&&(t=t.slice(0,t.indexOf(Jp))),ls(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();ls(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '".concat(t,"'.")})),r.managers[t]=n}},{key:"getManager",value:function(t){var n=e.getInstance().managers[t];if(null==n)throw new Error("Cannot find model manager for scheme '".concat(t,"'"));return n}},{key:"getSchemes",value:function(){return Object.keys(e.getInstance().managers)}}]),e}();function $p(e){if(-1===e.indexOf(Jp))throw new Error("The url string provided does not contain a scheme. Supported schemes are: ".concat(qp.getSchemes().join(",")));return{scheme:e.split(Jp)[0],path:e.split(Jp)[1]}}function ef(e,t){return tf.apply(this,arguments)}function tf(){return tf=S(w().mark((function e(t,n){var r,a,i,o,s,u,c,l,d,h,p=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=p.length>2&&void 0!==p[2]&&p[2],ls(t!==n,(function(){return"Old path and new path are the same: '".concat(t,"'")})),ls((a=_p.getLoadHandlers(t)).length>0,(function(){return"Copying failed because no load handler is found for source URL ".concat(t,".")})),ls(a.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") load handlers for source URL ").concat(t,".")})),i=a[0],ls((o=_p.getSaveHandlers(n)).length>0,(function(){return"Copying failed because no save handler is found for destination URL ".concat(n,".")})),ls(o.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") save handlers for destination URL ").concat(n,".")})),s=o[0],u=$p(t).scheme,c=$p(t).path,l=u===$p(t).scheme,e.next=12,i.load();case 12:if(d=e.sent,e.t0=r&&l,!e.t0){e.next=17;break}return e.next=17,qp.getManager(u).removeModel(c);case 17:return e.next=19,s.save(d);case 19:if(h=e.sent,e.t1=r&&!l,!e.t1){e.next=24;break}return e.next=24,qp.getManager(u).removeModel(c);case 24:return e.abrupt("return",h.modelArtifactsInfo);case 25:case"end":return e.stop()}}),e)}))),tf.apply(this,arguments)}function nf(){return nf=S(w().mark((function e(){var t,n,r,a,i,o,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=qp.getSchemes(),n={},r=x(t),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=12;break}return i=a.value,e.next=8,qp.getManager(i).listModels();case 8:for(s in o=e.sent)n[i+Jp+s]=o[s];case 10:e.next=4;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),r.e(e.t0);case 17:return e.prev=17,r.f(),e.finish(17);case 20:return e.abrupt("return",n);case 21:case"end":return e.stop()}}),e,null,[[2,14,17,20]])}))),nf.apply(this,arguments)}function rf(){return rf=S(w().mark((function e(t){var n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=$p(t),e.abrupt("return",qp.getManager(n.scheme).removeModel(n.path));case 2:case"end":return e.stop()}}),e)}))),rf.apply(this,arguments)}function af(){return af=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ef(t,n,!1));case 1:case"end":return e.stop()}}),e)}))),af.apply(this,arguments)}function of(){return of=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ef(t,n,!0));case 1:case"end":return e.stop()}}),e)}))),of.apply(this,arguments)}var sf=function(){function e(){T(this,e),this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}return E(e,[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){return fetch(e,t)}))},{key:"now",value:function(){return performance.now()}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return new TextDecoder(t).decode(e)}},{key:"setTimeoutCustom",value:function(e,t){var n=this;window&&Qs().getBool("USE_SETTIMEOUTCUSTOM")?(this.functionRefs.push(e),setTimeout((function(){window.postMessage({name:n.messageName,index:n.functionRefs.length-1},"*")}),t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",(function(e){e.source===window&&e.data.name===n.messageName&&(e.stopPropagation(),(0,n.functionRefs[e.data.index])(),n.handledMessageCount++,n.handledMessageCount===n.functionRefs.length&&(n.functionRefs=[],n.handledMessageCount=0))}),!0))):setTimeout(e,t)}}]),e}();if(Qs().get("IS_BROWSER")){Qs().setPlatform("browser",new sf);try{qp.registerManager(jp.URL_SCHEME,new Qp)}catch(PJ){}try{qp.registerManager(Ap.URL_SCHEME,new Op)}catch(DJ){}}var uf,cf=function(){return require("node-fetch")},lf=function(){function e(){T(this,e),this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return E(e,[{key:"fetch",value:function(e,t){return null!=Qs().global.fetch?Qs().global.fetch(e,t):(null==uf&&(uf=cf()),uf(e,t))}},{key:"now",value:function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}}]),e}();function df(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",Xs(e),new bh(e,t,n)}Qs().get("IS_NODE")&&!Qs().get("IS_BROWSER")&&Qs().setPlatform("node",new lf);var hf=np({cast_:function(e,t){var n=$h(e,"x","cast");if(!Is(t))throw new Error("Failed to cast to unknown dtype ".concat(t));if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={x:n},a={dtype:t};return Bh.runKernel(Tu,r,a)}});var pf=np({clone_:function(e){var t={x:$h(e,"x","clone","string_or_numeric")};return Bh.runKernel(mc,t)}});function ff(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}function mf(e,t,n,r){var a,i,o;ls(null!=(o=e)&&Array.isArray(o)&&o.length>0,(function(){return"promises must be a none empty array"})),n=null!==(a=n)&&void 0!==a?a:0,r=null!==(i=r)&&void 0!==i?i:1,function(e,t){ls(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction ".concat(e)})),ls(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction ".concat(t)})),ls(t>=e,(function(){return"startFraction must be no more than endFraction, but got startFraction ".concat(e," and endFraction ").concat(t)}))}(n,r);var s=0;return Promise.all(e.map((function(a){return a.then((function(a){var i=n+ ++s/e.length*(r-n);return t(i),a})),a})))}function vf(e,t){return gf.apply(this,arguments)}function gf(){return gf=S(w().mark((function e(t,n){var r,a,i,o,s,u,c;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),r=null==n.fetchFunc?Qs().platform.fetch:n.fetchFunc,a=t.map((function(e){return r(e,n.requestInit,{isBinary:!0})})),i=0,o=.5,null!=n.onProgress){e.next=11;break}return e.next=8,Promise.all(a);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,mf(a,n.onProgress,i,o);case 13:e.t0=e.sent;case 14:if(s=e.t0.map((function(e){return e.arrayBuffer()})),u=.5,c=1,null!=n.onProgress){e.next=23;break}return e.next=20,Promise.all(s);case 20:e.t1=e.sent,e.next=26;break;case 23:return e.next=25,mf(s,n.onProgress,u,c);case 25:e.t1=e.sent;case 26:return e.abrupt("return",e.t1);case 27:case"end":return e.stop()}}),e)}))),gf.apply(this,arguments)}function yf(e){return bf.apply(this,arguments)}function bf(){return bf=S(w().mark((function e(t){var n,r,a,i=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:"",r=i.length>2?i[2]:void 0,a=i.length>3?i[3]:void 0,e.abrupt("return",xf((function(e){return vf(e,{requestInit:a})}))(t,n,r));case 4:case"end":return e.stop()}}),e)}))),bf.apply(this,arguments)}function xf(e){return function(){var t=S(w().mark((function t(n){var r,a,i,o,s,u,c,l,d,h,p,f,m=arguments;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=m.length>1&&void 0!==m[1]?m[1]:"",a=m.length>2?m[2]:void 0,i=n.map((function(){return!1})),o={},s=null!=a?a.map((function(){return!1})):[],u=[],n.forEach((function(e,t){var n=0;e.weights.forEach((function(e){var r="quantization"in e?e.quantization.dtype:e.dtype,c=op[r]*fs(e.shape),l=function(){i[t]=!0,null==o[t]&&(o[t]=[]),o[t].push({manifestEntry:e,groupOffset:n,sizeBytes:c})};null!=a?a.forEach((function(t,n){t===e.name&&(l(),s[n]=!0)})):l(),u.push(e.name),n+=c}))})),s.every((function(e){return e}))){t.next=6;break}throw c=a.filter((function(e,t){return!s[t]})),new Error("Could not find weights in manifest with names: ".concat(c.join(", "),". \nManifest JSON has weights with names: ").concat(u.join(", "),"."));case 6:return l=i.reduce((function(e,t,n){return t&&e.push(n),e}),[]),d=[],l.forEach((function(e){n[e].paths.forEach((function(e){var t=r+(r.endsWith("/")?"":"/")+e;d.push(t)}))})),t.next=10,e(d);case 10:return h=t.sent,p={},f=0,t.abrupt("return",(l.forEach((function(e){for(var t=n[e].paths.length,r=0,a=0;a<t;a++)r+=h[f+a].byteLength;for(var i=new ArrayBuffer(r),s=new Uint8Array(i),u=0,c=0;c<t;c++){var l=new Uint8Array(h[f+c]);s.set(l,u),u+=l.byteLength}o[e].forEach((function(e){var t=lp(i.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)p[n]=t[n]})),f+=t})),p));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}Uh(),function(e){wh=e}({buffer:df,cast:hf,clone:pf,print:ff});var wf=function(){function e(t,n){if(T(this,e),this.DEFAULT_METHOD="POST",null==n&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,null!=n.fetchFunc?(ls("function"==typeof n.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=n.fetchFunc):this.fetch=Qs().platform.fetch,ls(null!=t&&t.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(t)&&ls(2===t.length,(function(){return"URL paths for http must have a length of 2, (actual length is ".concat(t.length,").")})),this.path=t,null!=n.requestInit&&null!=n.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}return E(e,[{key:"save",value:function(){var e=S(w().mark((function e(t){var n,r,a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");case 2:return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],a=yp(t,r),n.body.append("model.json",new Blob([JSON.stringify(a)],{type:"application/json"}),"model.json"),null!=t.weightData&&n.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),e.next=8,this.fetch(this.path,n);case 8:if(!(i=e.sent).ok){e.next=11;break}return e.abrupt("return",{modelArtifactsInfo:kp(t),responses:[i]});case 11:throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status ".concat(i.status,"."));case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i,o=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch(this.path,this.requestInit);case 2:if((t=e.sent).ok){e.next=5;break}throw new Error("Request to ".concat(this.path," failed with status code ").concat(t.status,". Please verify this URL points to the model JSON of the model to load."));case 5:return e.prev=5,e.next=8,t.json();case 8:n=e.sent,e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(5),r="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 15:if(a=n.modelTopology,i=n.weightsManifest,null!=a||null!=i){e.next=18;break}throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model topology or manifest for weights."));case 18:return e.abrupt("return",xp(n,(function(e){return o.loadWeights(e)})));case 19:case"end":return e.stop()}}),e,this,[[5,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadWeights",value:function(){var e=S(w().mark((function e(t){var n,r,a,o,s,u,c,l,d,h,p,f,m,v,g,y;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Array.isArray(this.path)?this.path[1]:this.path,r=kf(n),a=i(r,2),o=a[0],s=a[1],u=this.weightPathPrefix||o,c=Sp(t),l=[],d=[],h=x(t);try{for(h.s();!(p=h.n()).done;){f=p.value,m=x(f.paths);try{for(m.s();!(v=m.n()).done;)g=v.value,null!=this.weightUrlConverter?d.push(this.weightUrlConverter(g)):l.push(u+g+s)}catch(w){m.e(w)}finally{m.f()}}}catch(w){h.e(w)}finally{h.f()}if(e.t0=this.weightUrlConverter,!e.t0){e.next=13;break}return e.t1=l.push,e.t2=l,e.t3=b,e.next=10,Promise.all(d);case 10:e.t4=e.sent,e.t5=(0,e.t3)(e.t4),e.t1.apply.call(e.t1,e.t2,e.t5);case 13:return e.next=15,vf(l,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});case 15:return y=e.sent,e.abrupt("return",[c,vp(y)]);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function kf(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}function Sf(e){return null!=e.match(wf.URL_SCHEME_REGEX)}wf.URL_SCHEME_REGEX=/^https?:\/\//;var Tf=function(e,t){if(typeof fetch>"u"&&(null==t||null==t.fetchFunc))return null;var n=!0;return n=Array.isArray(e)?e.every((function(e){return Sf(e)})):Sf(e),n?_f(e,t):null};function _f(e,t){return new wf(e,t)}function If(e,t){return _f(e,t)}_p.registerSaveRouter(Tf),_p.registerLoadRouter(Tf);var Ef=np({matMul_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=$h(e,"a","matMul"),o=$h(t,"b","matMul"),s=i(Ah(a,o),2),u={a:a=s[0],b:o=s[1]},c={transposeA:n,transposeB:r};return Bh.runKernel(bu,u,c)}});var Cf=np({oneHot_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"int32";if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(t));var i={indices:$h(e,"indices","oneHot","int32")},o={dtype:a,depth:t,onValue:n,offValue:r};return Bh.runKernel($c,i,o)}});function Mf(){return Bh}function Nf(){return Bh.memory()}function Rf(e,t){return Bh.tidy(e,t)}function Lf(e){Oh(e).forEach((function(e){return e.dispose()}))}function Af(e){return Bh.keep(e)}function Pf(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Bh.registerBackend(e,t,n)}function Df(){return Bh.backend}var Of=np({imag_:function(e){var t={input:$h(e,"input","imag")};return Bh.runKernel(gc,t)}});var zf=np({neg_:function(e){var t={x:$h(e,"x","neg")};return Bh.runKernel(Kc,t)}});var Ff=np({real_:function(e){var t={input:$h(e,"input","real")};return Bh.runKernel(ul,t)}});var Gf=np({transpose_:function(e,t,n){var r=$h(e,"x","transpose");if(null==t&&(t=r.shape.map((function(e,t){return t})).reverse()),ls(r.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(r.rank," must match length of perm ").concat(t,".")})),t.forEach((function(e){ls(e>=0&&e<r.rank,(function(){return"All entries in 'perm' must be between 0 and ".concat(r.rank-1," but got ").concat(t)}))})),r.rank<=1)return r.clone();var a={x:r},i={perm:t};return"complex64"===r.dtype?Rf((function(){var e=Ff(r),t=Of(r);return e=Bh.runKernel(ql,{x:e},i),t=Bh.runKernel(ql,{x:t},i),n&&(t=zf(t)),rp(e,t)})):Bh.runKernel(ql,a,i)}});function Wf(e,t){for(var n=e.length,r=[],a=0;a<n;a++){var i=n-1-a,o=e[i]||1;(t[t.length-1-a]||1)>1&&1===o&&r.unshift(i)}return r}function Vf(e,t){for(var n=[],r=0;r<t.length;r++){var a=e[e.length-r-1],i=t.length-r-1,o=t[i];(null==a||1===a&&o>1)&&n.unshift(i)}return n}function Uf(e,t){for(var n=[],r=Math.max(e.length,t.length),a=0;a<r;a++){var i=e[e.length-a-1];null==i&&(i=1);var o=t[t.length-a-1];if(null==o&&(o=1),1===i)n.unshift(o);else if(1===o)n.unshift(i);else{if(i!==o){var s="Operands could not be broadcast together with shapes ".concat(e," and ").concat(t,".");throw Error(s)}n.unshift(i)}}return n}var Xf,Bf=Object.freeze(Object.defineProperty({__proto__:null,assertAndGetBroadcastShape:Uf,getBroadcastDims:Wf,getReductionAxes:Vf},Symbol.toStringTag,{value:"Module"}));function Hf(e,t,n){if(hs(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=Qh(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return ap(e,t,r,n)}function Zf(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,a=!1,o=!1,s=!1,u=!1;if(e.data instanceof Uint8Array)n=!0;else if(typeof ImageData<"u"&&e instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)a=!0;else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)o=!0;else if(null!=e.getContext)s=!0;else{if(!(typeof ImageBitmap<"u"&&e instanceof ImageBitmap))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ".concat(e.constructor.name));u=!0}if(null!=hd(ad,Bh.backendName)){var c={pixels:e},l={numChannels:t};return Bh.runKernel(ad,c,l)}var d,h,p=i(a?[e.videoWidth,e.videoHeight]:[e.width,e.height],2),f=p[0],m=p[1];if(s)d=e.getContext("2d").getImageData(0,0,f,m).data;else if(r||n)d=e.data;else if(o||a||u){if(null==Xf)if(typeof document>"u"){if(!(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u"))throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");Xf=new OffscreenCanvas(1,1).getContext("2d")}else Xf=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});Xf.canvas.width=f,Xf.canvas.height=m,Xf.drawImage(e,0,0,f,m),d=Xf.getImageData(0,0,f,m).data}if(4===t)h=new Int32Array(d);else{var v=f*m;h=new Int32Array(v*t);for(var g=0;g<v;g++)for(var y=0;y<t;++y)h[g*t+y]=d[4*g+y]}return Hf(h,[m,f,t],"int32")}function Kf(e){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")&&!(e instanceof ImageBitmap)&&function(e){return null!=e&&0!==e.width&&0!==e.height}(e)&&!function(e){return null!=e&&e.data instanceof Uint8Array}(e)}function jf(){return jf=S(w().mark((function e(t){var n,r,a,i=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:3,r=null,!Qs().getBool("WRAP_TO_IMAGEBITMAP")||!Kf(t)){e.next=15;break}return e.prev=3,e.next=6,createImageBitmap(t,{premultiplyAlpha:"none"});case 6:a=e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),a=null;case 12:r=null!=a&&a.width===t.width&&a.height===t.height?a:t,e.next=16;break;case 15:r=t;case 16:return e.abrupt("return",Zf(r,n));case 17:case"end":return e.stop()}}),e,null,[[3,9]])}))),jf.apply(this,arguments)}function Yf(){return Yf=S(w().mark((function e(t,n){var r,a,o,s,u,c,l,d,h,p,f,m,v,g,y,b,x;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=$h(t,"img","toPixels"),t instanceof kh||(r=hf(a=r,"int32"),a.dispose()),2===r.rank||3===r.rank){e.next=4;break}throw new Error("toPixels only supports rank 2 or 3 tensors, got rank ".concat(r.rank,"."));case 4:if(o=r.shape.slice(0,2),s=i(o,2),u=s[0],c=s[1],!((l=2===r.rank?1:r.shape[2])>4||2===l)){e.next=7;break}throw new Error("toPixels only supports depth of size 1, 3 or 4 but got ".concat(l));case 7:if("float32"===r.dtype||"int32"===r.dtype){e.next=9;break}throw new Error("Unsupported type for toPixels: ".concat(r.dtype,". Please use float32 or int32 tensors."));case 9:return e.next=11,r.data();case 11:d=e.sent,h="float32"===r.dtype?255:1,p=new Uint8ClampedArray(c*u*4),f=0;case 15:if(!(f<u*c)){e.next=36;break}m=[0,0,0,255],v=0;case 18:if(!(v<l)){e.next=31;break}if(g=d[f*l+v],"float32"!==r.dtype){e.next=25;break}if(!(g<0||g>1)){e.next=23;break}throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ".concat(g,"."));case 23:e.next=27;break;case 25:if("int32"!==r.dtype||!(g<0||g>255)){e.next=27;break}throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ".concat(g,"."));case 27:1===l?(m[0]=g*h,m[1]=g*h,m[2]=g*h):m[v]=g*h;case 28:v++,e.next=18;break;case 31:p[(y=4*f)+0]=Math.round(m[0]),p[y+1]=Math.round(m[1]),p[y+2]=Math.round(m[2]),p[y+3]=Math.round(m[3]);case 33:++f,e.next=15;break;case 36:return null!=n&&(n.width=c,n.height=u,b=n.getContext("2d"),x=new ImageData(p,c,u),b.putImageData(x,0,0)),e.abrupt("return",(r!==t&&r.dispose(),p));case 38:case"end":return e.stop()}}),e)}))),Yf.apply(this,arguments)}var Qf=np({fromPixels_:Zf}),Jf=Object.freeze(Object.defineProperty({__proto__:null,fromPixels:Qf,fromPixelsAsync:function(e){return jf.apply(this,arguments)},toPixels:function(e,t){return Yf.apply(this,arguments)}},Symbol.toStringTag,{value:"Module"}));function qf(e,t){var n=e.shape.length,r=t.shape.length;if(n<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was ".concat(n,"."));if(r<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ".concat(r,"."));if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was ".concat(t.dtype,"."));if(t.shape[r-1]>n)throw new Error("index innermost dimension length must be <= tensor rank; saw: ".concat(t.shape[r-1]," vs. ").concat(n));if(0===fs(e.shape))throw new Error("Requested more than 0 entries, but input is empty. Input shape: ".concat(e.shape,"."));for(var a=t.shape,i=a[a.length-1],o=1,s=0;s<a.length-1;++s)o*=a[s];var u=e.shape,c=a.slice();c.pop();for(var l=1,d=i;d<n;++d)l*=u[d],c.push(u[d]);var h=[].concat(b(zs(e.shape).map((function(e){return e/l}))),[1]).slice(0,i);return[c,o,l,h]}var $f=Object.freeze(Object.defineProperty({__proto__:null,prepareAndValidate:qf},Symbol.toStringTag,{value:"Module"}));function em(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ".concat(n.shape,", indices.shape: ").concat(t.shape,", shape: ").concat(e,", sliceDim: ").concat(r,", and batchDim: ").concat(a,".");if(n.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(e.length<r+(n.rank-a))throw new Error(i+" Output shape length < ".concat(r+(n.rank-a)));if(n.rank!==a+e.length-r)throw new Error(i+" update.rank != ".concat(a+e.length-r));for(var o=0;o<a;++o)if(n.shape[o]!==t.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(n.shape[o],") != indices.shape[").concat(o,"] (").concat(t.shape[o],")."));for(var s=0;s<n.rank-a;++s)if(n.shape[s+a]!==e[s+r])throw new Error(i+" updates.shape[".concat(s+a,"] (").concat(n.shape[s+a],") != shape[").concat(s+a,"] (").concat(e[s+a],")"))}function tm(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ".concat(t.rank,"."));if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ".concat(e.rank,"."));if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(t.dtype));if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(n));if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: ".concat(t.shape));if(0===e.size)throw new Error("Updates specified for empty output. updates shape: ".concat(e.shape))}em(n,t,e)}function nm(e,t,n){for(var r=t.shape.length,a=r>1?t.shape[r-1]:1,i=n.length,o=1,s=a;s<i;++s)o*=n[s];var u=a<1?1:a;return{sliceRank:a,numUpdates:fs(t.shape)/u,sliceSize:o,strides:[].concat(b(zs(n.slice(0,a))),[1]),outputSize:fs(n)}}var rm=Object.freeze(Object.defineProperty({__proto__:null,calculateShapes:nm,validateInput:tm,validateUpdateShape:em},Symbol.toStringTag,{value:"Module"})),am=-2,im=-1;function om(e,t,n){var r=e.shape.length;ls(r===t.length,(function(){return"Error in slice".concat(r,"D: Length of begin ").concat(t," must match the rank of the array (").concat(r,").")})),ls(r===n.length,(function(){return"Error in slice".concat(r,"D: Length of size ").concat(n," must match the rank of the array (").concat(r,").")}));for(var a=function(a){ls(t[a]+n[a]<=e.shape[a],(function(){return"Error in slice".concat(r,"D: begin[").concat(a,"] + size[").concat(a,"] (").concat(t[a]+n[a],") would overflow input.shape[").concat(a,"] (").concat(e.shape[a],")")}))},i=0;i<r;++i)a(i)}function sm(e,t,n){for(var r=[],a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function um(e,t,n,r){for(var a=b(e),i=a.length;i<r.length;i++)a.push(1);for(var o=0;o<n;o++)0===o?a[t]=1:(a.splice(t,0,1),a.pop());return a}function cm(e,t,n){return n<=e?n:n-(t-1)}function lm(e,t){for(var n=[],r=0;r<e;r++)n.push(t+r);return n}function dm(e,t,n,r,a){for(var i=b(a),o=lm(n,t),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=0;else{var u=cm(t,n,s),c=r[u];e&1<<u&&(c=0),i[s]=c}return i}function hm(e,t,n,r,a){for(var i=b(a),o=lm(n,t),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=Number.MAX_SAFE_INTEGER;else{var u=cm(t,n,s),c=r[u];e&1<<u&&(c=Number.MAX_SAFE_INTEGER),i[s]=c}for(var l=0;l<i.length;l++){var d=a[l];i[l]<0&&(i[l]+=d),i[l]=os(0,i[l],a[l])}return i}function pm(e,t,n){var r=e[t];return(n&1<<t||null==r)&&(r=1),r}function fm(e,t,n,r,a,i){var o=t[a],s=n[a]||1;(e&1<<a||i&1<<a||null==o)&&(o=s>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var u=r[a];return o<0&&(o+=u),o=os(0,o,u-1)}function mm(e,t,n,r,a,i){var o=t[a],s=n[a]||1;(e&1<<a||i&1<<a||null==o)&&(o=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var u=r[a];return o<0&&(o+=u),o=s>0?os(0,o,u):os(-1,o,u-1)}function vm(e,t,n){for(var r=n.length,a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(var i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function gm(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function ym(e,t,n){var r,a,i=e.shape.length;return(r="number"==typeof t?[t].concat(b(new Array(i-1).fill(0))):t.length<i?t.concat(new Array(i-t.length).fill(0)):t.slice()).forEach((function(e){ls(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),a=(a=null==n?new Array(i).fill(-1):"number"==typeof n?[n].concat(b(new Array(i-1).fill(-1))):n.length<i?n.concat(new Array(i-n.length).fill(-1)):n).map((function(t,n){return t>=0?t:(ls(-1===t,(function(){return"Negative size values should be exactly -1 but got ".concat(t," for the slice() size at index ").concat(n,".")})),e.shape[n]-r[n])})),[r,a]}function bm(e,t,n,r,a,i,o,s,u){var c;if(null==r?(c=new Array(t.length)).fill(1):c=r,null!=o&&o&o-1)throw new Error("Multiple ellipses in slice is not allowed.");for(var l=!1,d={dims:c.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:c.slice(),beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u},h=0;h<d.dims;h++)l&&1<<h&s&&d.numAddAxisAfterEllipsis++,1<<h&o&&(l=!0);l||(d.ellipsisMask|=1<<d.dims,d.dims++);var p={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;var n=0;t.beginValid=null!=e.begin,t.endValid=null!=e.end,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(var r=0;r<e.dims;r++)if(1<<r&e.ellipsisMask)for(var a=Math.min(t.dims-(e.dims-r)+1+e.numAddAxisAfterEllipsis,t.dims);n<a;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=r;else if(1<<r&e.newAxisMask)t.finalShapeGatherIndices.push(am),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error("Index out of range using input dim ".concat(n,"; input has only ").concat(t.dims," dims, ").concat(t.begin.length,"."));null!=e.begin&&(t.begin[n]=e.begin[r]),null!=e.end&&(t.end[n]=e.end[r]),t.strides[n]=e.strides[r],e.beginMask&1<<r&&(t.beginMask|=1<<n),e.endMask&1<<r&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(im),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[n]=r,n++}}(d,p);for(var f=!0,m=!0,v=!0,g=[],y=[],b=0;b<e.length;++b){if(0===p.strides[b])throw Error("strides[".concat(b,"] must be non-zero"));var x=!!(p.shrinkAxisMask&1<<b),w=e[b];if(-1!==w){var k=[p.beginMask&1<<b,p.endMask&1<<b],S=[p.strides[b]>0?0:-1,p.strides[b]>0?w:w-1];if(x&&p.strides[b]<=0)throw Error("only stride 1 allowed on non-range indexing.");v=v&&1===p.strides[b];var T=!!(p.beginMask&1<<b&&p.endMask&1<<b);if(p.beginValid&&p.endValid){if(x){var _=p.begin[b]<0?w+p.begin[b]:p.begin[b];if(p.begin[b]=_,p.end[b]=p.begin[b]+1,_<0||_>=w)throw Error("slice index ".concat(p.begin[b]," of dimension ").concat(b," out of bounds."))}else p.begin[b]=xm(p.begin[b],0,p.strides[b],w,k,S),p.end[b]=xm(p.end[b],1,p.strides[b],w,k,S);var I=1===p.strides[b]&&0===p.begin[b]&&p.end[b]===w;f=f&&I,m=m&&(0===b&&1===p.strides[b]||I)}else f=f&&1===p.strides[b]&&T,m=m&&(0===b&&1===p.strides[b]||T);var E=void 0,C=!1;if(p.beginValid&&p.endValid?(E=p.end[b]-p.begin[b],C=!0):x?(E=1,C=!0):T&&w>=0&&(E=p.strides[b]<0?-w:w,C=!0),C){var M=void 0;M=0===E||E<0!=p.strides[b]<0?0:Math.trunc(E/p.strides[b])+(E%p.strides[b]!==0?1:0),g.push(M)}else g.push(-1)}else g.push(x?1:-1)}for(var N=0;N<p.finalShapeGatherIndices.length;++N){var R=p.finalShapeGatherIndices[N];R>=0?y.push(g[R]):R===am&&y.push(1)}return{finalShapeSparse:y.filter((function(e,t){return p.finalShapeGatherIndices[t]!==am})),finalShape:y,isIdentity:f,sliceDim0:m,isSimpleSlice:v,begin:p.begin,end:p.end,strides:p.strides}}function xm(e,t,n,r,a,i){if(a[t])return n>0?i[t]:i[t+1&1];var o=e<0?r+e:e;return o<i[0]?i[0]:o>i[1]?i[1]:o}var wm=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:om,computeFlatOffset:gm,computeOutShape:sm,getNormalizedAxes:function(e,t,n,r,a,i,o,s,u){var c=e.length,l=new Array(c),d=new Array(c),h=new Array(c);if(t.length&&n>0){var p=t[0],f=n+1;l=dm(o,p,f,r,e),d=hm(s,p,f,a,e),h=um(i,p,f,e)}else for(var m=0;m<c;m++)l[m]=fm(o,r,i,e,m,u),d[m]=mm(s,a,i,e,m,u),h[m]=pm(i,m,u);return{begin:l,end:d,strides:h}},isSliceContinous:vm,maskToAxes:function(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t},parseSliceParams:ym,sliceInfo:bm,startForAxis:fm,startIndicesWithElidedDims:dm,stopForAxis:mm,stopIndicesWithElidedDims:hm,stridesForAxis:pm,stridesWithElidedDims:um},Symbol.toStringTag,{value:"Module"})),km=function(){function e(){T(this,e)}return E(e,[{key:"getClassName",value:function(){return this.constructor.className}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),e}(),Sm=function(){function e(){T(this,e),this.classNameMap={}}return E(e,null,[{key:"getMap",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"register",value:function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]}}]),e}();function Tm(e){ls(null!=e.className,(function(){return"Class being registered does not have the static className property defined."})),ls("string"==typeof e.className,(function(){return"className is required to be a string, but got type "+typeof e.className})),ls(e.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),Sm.register(e)}var _m=Object.freeze(Object.defineProperty({__proto__:null,Serializable:km,SerializationMap:Sm,registerClass:Tm},Symbol.toStringTag,{value:"Module"}));var Im=np({add_:function(e,t){var n=$h(e,"a","add"),r=$h(t,"b","add"),a=i(Ah(n,r),2),o={a:n=a[0],b:r=a[1]};return Bh.runKernel(au,o)}});var Em=np({floorDiv_:function(e,t){var n=$h(e,"a","floorDiv"),r=$h(t,"b","floorDiv"),a=i(Ah(n,r),2),o={a:n=a[0],b:r=a[1]};return Bh.runKernel(cc,o)}});var Cm=np({div_:function(e,t){var n,r=$h(e,"a","div"),a=$h(t,"b","div");if(r=(n=i(Ah(r,a),2))[0],a=n[1],"int32"===r.dtype&&"int32"===a.dtype)return Em(r,a);var o={a:r,b:a};return Bh.runKernel(Qu,o,{})}});var Mm=np({mul_:function(e,t){var n=$h(e,"a","mul"),r=$h(t,"b","mul"),a=i(Ah(n,r),2),o={a:n=a[0],b:r=a[1]};return Bh.runKernel(Zc,o)}});var Nm=np({abs_:function(e){var t=$h(e,"x","abs");if("complex64"===t.dtype){var n={x:t};return Bh.runKernel(Cu,n)}var r={x:t};return Bh.runKernel(tu,r)}});var Rm=np({acos_:function(e){var t={x:$h(e,"x","acos")};return Bh.runKernel(nu,t)}});var Lm=np({acosh_:function(e){var t={x:$h(e,"x","acosh")};return Bh.runKernel(ru,t)}});var Am=np({all_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:$h(e,"x","all","bool")},a={axis:t,keepDims:n};return Bh.runKernel(ou,r,a)}});var Pm=np({any_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:$h(e,"x","any","bool")},a={axis:t,keepDims:n};return Bh.runKernel(su,r,a)}});var Dm=np({argMax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:$h(e,"x","argMax")},r={axis:t};return Bh.runKernel(uu,n,r)}});var Om=np({argMin_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:$h(e,"x","argMin")},r={axis:t};return Bh.runKernel(cu,n,r)}});var zm=np({asin_:function(e){var t={x:$h(e,"x","asin")};return Bh.runKernel(lu,t)}});var Fm=np({asinh_:function(e){var t={x:$h(e,"x","asinh")};return Bh.runKernel(du,t)}});var Gm=np({atan_:function(e){var t={x:$h(e,"x","atan")};return Bh.runKernel(hu,t)}});var Wm=np({atan2_:function(e,t){var n=$h(e,"a","atan2"),r=$h(t,"b","atan2"),a=i(Ah(n,r),2),o={a:n=a[0],b:r=a[1]};return Bh.runKernel(fu,o)}});var Vm=np({atanh_:function(e){var t={x:$h(e,"x","atanh")};return Bh.runKernel(pu,t)}});function Um(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5?arguments[5]:void 0,o=e[3];return Hm(e,[].concat(b(t),[o]),n,i,r,null,null,ev(a))}function Xm(e,t,n,r,a,o){var s,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",c=i(jm(t),2),l=c[0],d=c[1];if("channelsLast"===u)s=[l,d,e[3],e[3]];else{if("channelsFirst"!==u)throw new Error("Unknown dataFormat ".concat(u));s=[l,d,e[1],e[1]]}return Hm(e,s,n,r,a,o,!1,u)}function Bm(e,t,n,r,a,o){var s,u,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NDHWC",l=i(Ym(t),3),d=l[0],h=l[1],p=l[2];if("NDHWC"===c)u="channelsLast",s=[d,h,p,e[4],e[4]];else{if("NCDHW"!==c)throw new Error("Unknown dataFormat ".concat(c));u="channelsFirst",s=[d,h,p,e[1],e[1]]}return Zm(e,s,n,r,a,!1,u,o)}function Hm(e,t,n,r,a,o){var s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",c=-1,l=-1,d=-1,h=-1;if("channelsLast"===u){var p=i(e,4);c=p[0],l=p[1],d=p[2],h=p[3]}else{if("channelsFirst"!==u)throw new Error("Unknown dataFormat ".concat(u));var f=i(e,4);c=f[0],h=f[1],l=f[2],d=f[3]}var m,v=i(t,4),g=v[0],y=v[1],b=v[3],x=i(jm(n),2),w=x[0],k=x[1],S=i(jm(r),2),T=S[0],_=S[1],I=Qm(g,T),E=Qm(y,_),C=function(e,t,n,r,a,i,o,s,u){var c,l,d;if("number"==typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var h=function(e,t,n,r,a){null==r&&(r=Km(e,t,n));var i=e[0],o=e[1],s=Jm((i-t+2*r)/n+1,a),u=Jm((o-t+2*r)/n+1,a);return[s,u]}([t,n],i,r,e,s);l=h[0],d=h[1]}else if("same"===e){l=Math.ceil(t/r),d=Math.ceil(n/a);var p=Math.max(0,(l-1)*r+i-t),f=Math.max(0,(d-1)*a+o-n),m=Math.floor(p/2),v=p-m,g=Math.floor(f/2);c={top:m,bottom:v,left:g,right:f-g,type:"SAME"}}else if("valid"===e)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-i+1)/r),d=Math.ceil((n-o+1)/a);else{if("object"!=typeof e)throw Error("Unknown padding parameter: ".concat(e));var y="channelsLast"===u?e[1][0]:e[2][0],b="channelsLast"===u?e[1][1]:e[2][1],x="channelsLast"===u?e[2][0]:e[3][0],w="channelsLast"===u?e[2][1]:e[3][1];c={top:y,bottom:b,left:x,right:w,type:0===y&&0===b&&0===x&&0===w?"VALID":"EXPLICIT"},l=Jm((t-i+y+b)/r+1,s),d=Jm((n-o+x+w)/a+1,s)}return{padInfo:c,outHeight:l,outWidth:d}}(a,l,d,w,k,I,E,o,u),M=C.padInfo,N=C.outHeight,R=C.outWidth,L=s?b*h:b;return"channelsFirst"===u?m=[c,L,N,R]:"channelsLast"===u&&(m=[c,N,R,L]),{batchSize:c,dataFormat:u,inHeight:l,inWidth:d,inChannels:h,outHeight:N,outWidth:R,outChannels:L,padInfo:M,strideHeight:w,strideWidth:k,filterHeight:g,filterWidth:y,effectiveFilterHeight:I,effectiveFilterWidth:E,dilationHeight:T,dilationWidth:_,inShape:e,outShape:m,filterShape:t}}function Zm(e,t,n,r,a){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",u=arguments.length>7?arguments[7]:void 0,c=-1,l=-1,d=-1,h=-1,p=-1;if("channelsLast"===s){var f=i(e,5);c=f[0],l=f[1],d=f[2],h=f[3],p=f[4]}else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));var m=i(e,5);c=m[0],p=m[1],l=m[2],d=m[3],h=m[4]}var v,g=i(t,5),y=g[0],b=g[1],x=g[2],w=g[4],k=i(Ym(n),3),S=k[0],T=k[1],_=k[2],I=i(Ym(r),3),E=I[0],C=I[1],M=I[2],N=Qm(y,E),R=Qm(b,C),L=Qm(x,M),A=function(e,t,n,r,a,i,o,s,u,c,l){var d,h,p,f;if("number"==typeof e){d={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var m=function(e,t,n,r,a,i){null==a&&(a=Km(e,t,r));var o=e[0],s=e[1],u=e[2],c=Jm((o-t+2*a)/r+1,i),l=Jm((s-t+2*a)/r+1,i),d=Jm((u-t+2*a)/r+1,i);return[c,l,d,n]}([t,n,r,1],s,1,a,e,l);h=m[0],p=m[1],f=m[2]}else if("same"===e){var v=((h=Math.ceil(t/a))-1)*a+s-t,g=((p=Math.ceil(n/i))-1)*i+u-n,y=((f=Math.ceil(r/o))-1)*o+c-r,b=Math.floor(v/2),x=v-b,w=Math.floor(g/2),k=g-w,S=Math.floor(y/2);d={top:w,bottom:k,left:S,right:y-S,front:b,back:x,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: ".concat(e));d={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},h=Math.ceil((t-s+1)/a),p=Math.ceil((n-u+1)/i),f=Math.ceil((r-c+1)/o)}return{padInfo:d,outDepth:h,outHeight:p,outWidth:f}}(a,l,d,h,S,T,_,N,R,L,u),P=A.padInfo,D=A.outDepth,O=A.outHeight,z=A.outWidth,F=o?w*p:w;return"channelsFirst"===s?v=[c,F,D,O,z]:"channelsLast"===s&&(v=[c,D,O,z,F]),{batchSize:c,dataFormat:s,inDepth:l,inHeight:d,inWidth:h,inChannels:p,outDepth:D,outHeight:O,outWidth:z,outChannels:F,padInfo:P,strideDepth:S,strideHeight:T,strideWidth:_,filterDepth:y,filterHeight:b,filterWidth:x,effectiveFilterDepth:N,effectiveFilterHeight:R,effectiveFilterWidth:L,dilationDepth:E,dilationHeight:C,dilationWidth:M,inShape:e,outShape:v,filterShape:t}}function Km(e,t,n){var r=Qm(t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1);return Math.floor((e[0]*(n-1)-n+r)/2)}function jm(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function Ym(e){return"number"==typeof e?[e,e,e]:e}function Qm(e,t){return t<=1?e:e+(e-1)*(t-1)}function Jm(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode ".concat(t))}}function qm(e){var t=i(jm(e),3),n=t[0],r=t[1],a=t[2];return 1===n&&1===r&&1===a}function $m(e,t){return qm(e)||qm(t)}function ev(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat ".concat(e))}function tv(e,t,n){if(null!=n){if("string"==typeof t)throw Error("Error in ".concat(e,": pad must be an integer when using dimRoundingMode ").concat(n," but got pad ").concat(t,"."));if("number"==typeof t)ls(vs(t),(function(){return"Error in ".concat(e,": pad must be an integer when using dimRoundingMode ").concat(n," but got pad ").concat(t,".")}));else{if("object"!=typeof t)throw Error("Error in ".concat(e,": Unknown padding parameter: ").concat(t));t.forEach((function(t){t.forEach((function(t){ls(vs(t),(function(){return"Error in ".concat(e,": pad must be an integer when using dimRoundingMode ").concat(n," but got pad ").concat(t,".")}))}))}))}}}var nv=np({reshape_:function(e,t){var n={x:$h(e,"x","reshape","string_or_numeric")},r={shape:t};return Bh.runKernel(dl,n,r)}});var rv=np({avgPool_:function(e,t,n,r,a){var i=$h(e,"x","avgPool","float32");ls($m(n,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(1,"'")}));var o=i,s=!1;3===i.rank&&(s=!0,o=nv(i,[1,i.shape[0],i.shape[1],i.shape[2]])),ls(4===o.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(o.rank,".")})),tv("avgPool",r,a);var u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a},l=Bh.runKernel(mu,u,c);return l=hf(l,i.dtype),s?nv(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var av=np({avgPool3d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=$h(e,"x","avgPool3d","float32"),s=o,u=!1;4===o.rank&&(u=!0,s=nv(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),ls(5===s.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(s.rank,".")})),ls("NDHWC"===i,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ".concat(i)})),tv("avgPool3d",r,a);var c={x:s},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},d=Bh.runKernel(gu,c,l);return d=hf(d,s.dtype),u?nv(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});var iv=np({concat_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;ls(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=ep(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype ".concat(e.dtype,". "))})),1===n.length)return pf(n[0]);var r=n,a={axis:t};return Bh.runKernel(Mu,r,a)}});var ov=np({sigmoid_:function(e){var t={x:$h(e,"x","sigmoid","float32")};return Bh.runKernel(Cl,t)}});var sv=np({slice_:function(e,t,n){var r=$h(e,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");var a={x:r},i={begin:t,size:n};return Bh.runKernel(Tl,a,i)}});var uv=np({tanh_:function(e){var t={x:$h(e,"x","tanh","float32")};return Bh.runKernel(jl,t)}});var cv=np({batchToSpaceND_:function(e,t,n){var r=$h(e,"x","batchToSpaceND"),a=t.reduce((function(e,t){return e*t}));ls(r.rank>=1+t.length,(function(){return"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(t.length)})),ls(n.length===t.length,(function(){return"crops.length is ".concat(n.length," but should be equal to blockShape.length  ").concat(t.length)})),ls(r.shape[0]%a===0,(function(){return"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of the elements of blockShape ").concat(t.join(" * ")," === ").concat(a)}));var i={x:r},o={blockShape:t,crops:n};return Bh.runKernel(xu,i,o)}});function lv(e){return 0===e.rank||1===e.rank?nv(e,[1,1,1,e.size]):2===e.rank?nv(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?nv(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e}var dv=np({batchNorm_:function(e,t,n,r,a,i){null==i&&(i=.001);var o,s,u=$h(e,"x","batchNorm"),c=$h(t,"mean","batchNorm"),l=$h(n,"variance","batchNorm");null!=a&&(o=$h(a,"scale","batchNorm")),null!=r&&(s=$h(r,"offset","batchNorm")),ls(c.rank===l.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),ls(null==s||c.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),ls(null==o||c.rank===o.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var d={x:lv(u),scale:o,offset:s,mean:c,variance:l},h={varianceEpsilon:i},p=Bh.runKernel(lc,d,h);return nv(p,u.shape)}});var hv=np({batchNorm2d_:function(e,t,n,r,a,i){var o,s,u=$h(e,"x","batchNorm"),c=$h(t,"mean","batchNorm"),l=$h(n,"variance","batchNorm");return null!=a&&(o=$h(a,"scale","batchNorm")),null!=r&&(s=$h(r,"offset","batchNorm")),ls(2===u.rank,(function(){return"Error in batchNorm2D: x must be rank 2 but got rank ".concat(u.rank,".")})),ls(2===c.rank||1===c.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ".concat(c.rank,".")})),ls(2===l.rank||1===l.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ".concat(l.rank,".")})),null!=o&&ls(2===o.rank||1===o.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ".concat(o.rank,".")})),null!=s&&ls(2===s.rank||1===s.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ".concat(s.rank,".")})),dv(u,c,l,s,o,i)}});var pv=np({batchNorm3d_:function(e,t,n,r,a,i){var o,s,u=$h(e,"x","batchNorm"),c=$h(t,"mean","batchNorm"),l=$h(n,"variance","batchNorm");return null!=a&&(o=$h(a,"scale","batchNorm")),null!=r&&(s=$h(r,"offset","batchNorm")),ls(3===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank ".concat(u.rank,".")})),ls(3===c.rank||1===c.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ".concat(c.rank,".")})),ls(3===l.rank||1===l.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ".concat(l.rank,".")})),null!=o&&ls(3===o.rank||1===o.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ".concat(o.rank,".")})),null!=s&&ls(3===s.rank||1===s.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ".concat(s.rank,".")})),dv(u,c,l,s,o,i)}});var fv=np({batchNorm4d_:function(e,t,n,r,a,i){var o,s,u=$h(e,"x","batchNorm"),c=$h(t,"mean","batchNorm"),l=$h(n,"variance","batchNorm");return null!=a&&(o=$h(a,"scale","batchNorm")),null!=r&&(s=$h(r,"offset","batchNorm")),ls(4===u.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank ".concat(u.rank,".")})),ls(4===c.rank||1===c.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ".concat(c.rank,".")})),ls(4===l.rank||1===l.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ".concat(l.rank,".")})),null!=o&&ls(4===o.rank||1===o.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ".concat(o.rank,".")})),null!=s&&ls(4===s.rank||1===s.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ".concat(s.rank,".")})),dv(u,c,l,s,o,i)}});var mv=np({bincount_:function(e,t,n){var r=$h(e,"x","bincount"),a=$h(t,"weights","bincount");ls("int32"===r.dtype,(function(){return"Error in bincount: input dtype must be int32, but got ".concat(r.dtype)})),ls(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),ls(a.size===r.size||0===a.size,(function(){return"Error in bincount: weights must have the same size as input or0-length, but got input shape: ".concat(r.shape,", weights shape: ").concat(a.shape,".")}));var i={x:r,weights:a},o={size:n};return Bh.runKernel(wu,i,o)}});var vv=np({broadcastTo_:function(e,t){var n=$h(e,"broadcastTo","x"),r=n.shape;if(t.some((function(e){return!(e>0)||e%1!==0})))throw new Error("broadcastTo(): Invalid broadcast shape [".concat(t,"]."));if(t.length<n.rank)throw new Error("broadcastTo(): shape.length=".concat(t.length," < input.rank=").concat(n.rank,"."));if(t.length>n.rank){for(var a=n.shape.slice();a.length<t.length;)a.unshift(1);n=nv(n,a)}for(var i=n.shape,o=Array.from(t),s=t.length-1;s>=0;s--)if(i[s]===t[s])o[s]=1;else if(1!==n.shape[s])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(t,"]."));if(0===o.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0})).length)return pf(n);var u={x:n},c={reps:o};return Bh.runKernel(Yl,u,c)}});var gv=np({ceil_:function(e){var t={x:$h(e,"x","ceil","float32")};return Bh.runKernel(_u,t)}});function yv(e,t,n){var r={shape:e,value:t,dtype:n};return Bh.runKernel(oc,{},r)}var bv=np({clipByValue_:function(e,t,n){var r=$h(e,"x","clipByValue");if(ls(t<=n,(function(){return"Error in clip: min (".concat(t,") must be less than or equal to max (").concat(n,").")})),t===n)return yv(r.shape,t,r.dtype);var a={x:r},i={clipValueMin:t,clipValueMax:n};return Bh.runKernel(Iu,a,i)}});var xv=np({concat1d_:function(e){return iv(e,0)}});var wv=np({concat2d_:function(e,t){return iv(e,t)}});var kv=np({concat3d_:function(e,t){return iv(e,t)}});var Sv=np({concat4d_:function(e,t){return iv(e,t)}});var Tv=np({conv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=$h(e,"x","conv2d","float32"),u=$h(t,"filter","conv2d","float32"),c=s,l=!1;3===s.rank&&(l=!0,c=nv(s,[1,s.shape[0],s.shape[1],s.shape[2]])),ls(4===c.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")})),ls(4===u.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank ".concat(u.rank,".")})),tv("conv2d",r,o);var d="NHWC"===a?c.shape[3]:c.shape[1];ls(d===u.shape[2],(function(){return"Error in conv2d: depth of input (".concat(d,") must match input depth for filter ").concat(u.shape[2],".")})),ls($m(n,i),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(i,"'")}));var h={x:c,filter:u},p={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},f=Bh.runKernel(Nu,h,p);return l?nv(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});var _v=np({conv1d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6?arguments[6]:void 0,s=$h(e,"x","conv1d"),u=$h(t,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=nv(s,[1,s.shape[0],s.shape[1]])),ls(3===c.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")})),ls(3===u.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank ".concat(u.rank,".")})),tv("conv1d",r,o),ls(c.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match input depth for filter ").concat(u.shape[1],".")})),ls($m(n,i),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride ".concat(n," and dilation '").concat(i,"'")})),ls("NWC"===a,(function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")}));var d=nv(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=nv(c,[c.shape[0],1,c.shape[1],c.shape[2]]),p=Tv(h,d,[1,n],r,"NHWC",[1,i],o);return nv(p,l?[p.shape[2],p.shape[3]]:[p.shape[0],p.shape[2],p.shape[3]])}});var Iv=np({conv2DBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0;ls(e.length===t.rank,(function(){return"Length of inShape (".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var s=e,u=t,c=!1;3===t.rank&&(c=!0,u=nv(t,[1,t.shape[0],t.shape[1],t.shape[2]]),s=[1,e[0],e[1],e[2]]),ls(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length ".concat(s.length,".")})),ls(4===u.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank ".concat(u.rank)})),ls(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank ".concat(n.rank)}));var l="NHWC"===i?s[3]:s[1],d="NHWC"===i?u.shape[3]:u.shape[1];ls(l===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must match input depth for filter ").concat(n.shape[2],".")})),ls(d===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output (".concat(d,") must match output depth for filter ").concat(n.shape[3],".")})),tv("conv2dDerInput",a,o);var h={dy:u,filter:n},p={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},f=Bh.runKernel(Lu,h,p);return c?nv(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});var Ev=np({conv2dTranspose_:function(e,t,n,r,a,i){var o=$h(e,"x","conv2dTranspose"),s=$h(t,"filter","conv2dTranspose");return Iv(n,o,s,r,a,"NHWC",i)}});var Cv=np({conv3d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NDHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1],o=$h(e,"x","conv3d"),s=$h(t,"filter","conv3d"),u=o,c=!1;4===o.rank&&(c=!0,u=nv(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),ls(5===u.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")})),ls(5===s.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank ".concat(s.rank,".")})),ls(u.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match input depth for filter ").concat(s.shape[3],".")})),ls($m(n,i),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(i,"'")})),ls("NDHWC"===a,(function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")}));var l={x:u,filter:s},d={strides:n,pad:r,dataFormat:a,dilations:i},h=Bh.runKernel(Au,l,d);return c?nv(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});var Mv=np({conv3DBackpropInput_:function(e,t,n,r,a){ls(e.length===t.rank,(function(){return"Length of inShape (".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var i=e,o=t,s=!1;4===t.rank&&(s=!0,o=nv(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),i=[1,e[0],e[1],e[2],e[3]]);var u=i[4],c=o.shape[4];ls(5===i.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length ".concat(i.length,".")})),ls(5===o.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank ".concat(o.rank)})),ls(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank ".concat(n.rank)})),ls(u===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must match input depth for filter ").concat(n.shape[3],".")})),ls(c===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must match output depth for filter ").concat(n.shape[4],".")}));var l={dy:o,filter:n},d={pad:a,strides:r,inputShape:i},h=Bh.runKernel(Du,l,d);return s?nv(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});var Nv=np({conv3dTranspose_:function(e,t,n,r,a){var i=$h(e,"x","conv3dTranspose"),o=$h(t,"filter","conv3dTranspose");return Mv(n,i,o,r,a)}});var Rv=np({cos_:function(e){var t={x:$h(e,"x","cos","float32")};return Bh.runKernel(Ou,t)}});var Lv=np({cosh_:function(e){var t={x:$h(e,"x","cosh","float32")};return Bh.runKernel(zu,t)}});var Av=np({cumprod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a={x:$h(e,"x","cumprod")},i={axis:t,exclusive:n,reverse:r};return Bh.runKernel(Fu,a,i)}});var Pv=np({cumsum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a={x:$h(e,"x","cumsum")},i={axis:t,exclusive:n,reverse:r};return Bh.runKernel(Gu,a,i)}});var Dv=np({depthToSpace_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"NHWC",r=$h(e,"x","depthToSpace","float32"),a="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];ls(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(t)})),ls(a*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(a," and ").concat(t,"  for depthToSpace with input shape\n    ").concat(r.shape)})),ls(i*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(i," and ").concat(t," for depthToSpace with input shape\n        ").concat(r.shape)})),ls(o%(t*t)===0,(function(){return"Dimension size must be evenly divisible by ".concat(t*t," but is ").concat(o," for depthToSpace with input shape ").concat(r.shape)}));var s={x:r},u={blockSize:t,dataFormat:n};return Bh.runKernel(Uu,s,u)}});var Ov=np({depthwiseConv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=$h(e,"x","depthwiseConv2d","float32"),u=$h(t,"filter","depthwiseConv2d","float32"),c=s,l=!1;3===s.rank&&(l=!0,c=nv(s,[1,s.shape[0],s.shape[1],s.shape[2]])),ls(4===c.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank ".concat(c.rank,".")})),ls(4===u.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank ".concat(u.rank,".")}));var d="NHWC"===a?c.shape[3]:c.shape[1];ls(d===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels (".concat(d,") must match the inChannels dimension in filter ").concat(u.shape[2],".")})),tv("depthwiseConv2d",r,o);var h={x:c,filter:u},p={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},f=Bh.runKernel(Xu,h,p);return l?nv(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});var zv=np({dilation2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=$h(e,"x","dilation2d"),s=$h(t,"filter","dilation2d");ls(3===o.rank||4===o.rank,(function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank ".concat(o.rank,".")})),ls(3===s.rank,(function(){return"Error in dilation2d: filter must be rank 3, but got rank ".concat(s.rank,".")})),ls("NHWC"===i,(function(){return"Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ".concat(i)}));var u=o,c=!1;3===o.rank&&(u=nv(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0);var l={x:u,filter:s},d={strides:n,pad:r,dilations:a},h=Bh.runKernel(Ku,l,d);return c?nv(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});var Fv=np({equal_:function(e,t){var n,r=$h(e,"a","equal","string_or_numeric"),a=$h(t,"b","equal","string_or_numeric");r=(n=i(Ah(r,a),2))[0],a=n[1],Uf(r.shape,a.shape);var o={a:r,b:a};return Bh.runKernel(tc,o)}});var Gv=np({where_:function(e,t,n){var r=$h(t,"a","where"),a=$h(n,"b","where"),i=$h(e,"condition","where","bool"),o=Uf(Uf(i.shape,r.shape),a.shape),s={condition:vv(i,o),t:vv(r,o),e:vv(a,o)};return Bh.runKernel(kl,s)}});var Wv=np({zerosLike_:function(e){var t={x:$h(e,"x","zerosLike")};return Bh.runKernel(nd,t)}});var Vv=np({divNoNan_:function(e,t){var n=$h(e,"a","div"),r=$h(t,"b","div"),a=i(Ah(n,r),2);n=a[0],r=a[1];var o=Cm(n,r),s=Wv(o),u=Fv(r,s);return Gv(u,s,o)}});var Uv=np({dot_:function(e,t){var n=$h(e,"t1","dot"),r=$h(t,"t2","dot");ls((1===n.rank||2===n.rank)&&(1===r.rank||2===r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks ".concat(n.rank," and ").concat(r.rank,".")}));var a=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];if(ls(a===i,(function(){return"Error in dot: inner dimensions of inputs must match, but got ".concat(a," and ").concat(i,".")})),1===n.rank&&1===r.rank){var o=nv(n,[1,-1]),s=nv(r,[-1,1]),u=Ef(o,s);return nv(u,[])}if(1===n.rank&&2===r.rank){var c=nv(n,[1,-1]),l=nv(r,[r.shape[0],r.shape[1]]),d=Ef(c,l);return nv(d,[d.size])}if(2===n.rank&&1===r.rank){var h=nv(r,[-1,1]),p=Ef(n,h);return nv(p,[p.size])}var f=nv(r,[r.shape[0],r.shape[1]]);return Ef(n,f)}});var Xv=np({elu_:function(e){var t={x:$h(e,"x","elu","float32")};return Bh.runKernel(qu,t)}});var Bv=np({erf_:function(e){var t=$h(e,"x","erf");ls("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=hf(t,"float32"));var n={x:t};return Bh.runKernel(ec,n)}});function Hv(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function Zv(e,t,n){for(var r=e.length+t.length,a=[],i=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?a.push(e[i++]):a.push(t[o++]);return a}function Kv(e,t){for(var n=[],r=e.length,a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);var i=t.map((function(t){return e[t]}));return[n,i]}function jv(e,t){return Zv(e,t.map((function(e){return 1})),t)}function Yv(e,t,n){ls(Hv(t,n),(function(){return"".concat(e," supports only inner-most axes for now. Got axes ").concat(t," and rank-").concat(n," input.")}))}function Qv(e,t){if(Hv(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function Jv(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function qv(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}var $v=np({max_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:$h(e,"x","max")},a={reductionIndices:t,keepDims:n};return Bh.runKernel(Ac,r,a)}});var eg=np({min_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:$h(e,"x","min")},a={axis:t,keepDims:n};return Bh.runKernel(Vc,r,a)}});var tg=np({pow_:function(e,t){var n=$h(e,"base","pow"),r=$h(t,"exp","pow"),a=i(Ah(n,r),2),o={a:n=a[0],b:r=a[1]};return Bh.runKernel(nl,o)}});function ng(e,t){if((Cs(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&Cs(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return ap(e,[],[],t)}var rg=np({sqrt_:function(e){var t={x:$h(e,"x","sqrt","float32")};return Bh.runKernel(Nl,t)}});var ag=np({square_:function(e){var t=$h(e,"x","square");return Bh.runKernel("Square",{x:t},{})}});var ig=np({sum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=$h(e,"x","sum");"bool"===r.dtype&&(r=hf(r,"int32"));var a={x:r},i={axis:t,keepDims:n};return Bh.runKernel(Rl,a,i)}});function og(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(0===e.rank)return Nm(e);if(1!==e.rank&&null===n)return og(nv(e,[-1]),t,n);if(1===e.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===t)return ig(Nm(e),n);if(t===1/0)return $v(Nm(e),n);if(t===-1/0)return eg(Nm(e),n);if("euclidean"===t||2===t)return rg(ig(tg(Nm(e),ng(2,"int32")),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}if(Array.isArray(n)&&2===n.length){if(1===t)return $v(ig(Nm(e),n[0]),n[1]-1);if(t===1/0)return $v(ig(Nm(e),n[1]),n[0]);if(t===-1/0)return eg(ig(Nm(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return rg(ig(ag(e),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}throw new Error("Error in norm: invalid axis: ".concat(n))}var sg=np({norm_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"euclidean",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=og(e=$h(e,"x","norm"),t,n),i=a.shape;if(r){var o=ws(n,e.shape);i=jv(a.shape,o)}return nv(a,i)}});var ug=np({euclideanNorm_:function(e){return sg(e,"euclidean",arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]&&arguments[2])}});var cg=np({exp_:function(e){var t={x:$h(e,"x","exp")};return Bh.runKernel(nc,t)}});var lg=np({expandDims_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=$h(e,"x","expandDims","string_or_numeric");ls(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r={input:n},a={dim:t};return Bh.runKernel(rc,r,a)}});var dg=np({expm1_:function(e){var t={x:$h(e,"x","expm1")};return Bh.runKernel(ac,t)}});var hg=np({tile_:function(e,t){var n=$h(e,"x","tile","string_or_numeric");ls(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," must match length of reps ").concat(t,".")}));var r={x:n},a={reps:t};return Bh.runKernel(Yl,r,a)}});var pg=np({eye_:function(e,t,n){null==t&&(t=e);for(var r=df([e,t],arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32"),a=e<=t?e:t,i=0;i<a;++i)r.set(1,i,i);var o=nv(r.toTensor(),[e,t]);if(null==n)return o;if(1===n.length)return hg(lg(o,0),[n[0],1,1]);if(2===n.length)return hg(lg(lg(o,0),0),[n[0],n[1],1,1]);if(3===n.length)return hg(lg(lg(lg(o,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received ".concat(n.length,"D."))}});var fg=np({floor_:function(e){var t={x:$h(e,"x","floor","float32")};return Bh.runKernel(uc,t)}});var mg=np({gather_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a={x:$h(e,"x","gather"),indices:$h(t,"indices","gather","int32")},i={axis:n,batchDims:r};return Bh.runKernel(dc,a,i)}});var vg=np({greater_:function(e,t){var n,r=$h(e,"a","greater","string_or_numeric"),a=$h(t,"b","greater","string_or_numeric");r=(n=i(Ah(r,a),2))[0],a=n[1],Uf(r.shape,a.shape);var o={a:r,b:a};return Bh.runKernel(pc,o)}});var gg=np({greaterEqual_:function(e,t){var n,r=$h(e,"a","greaterEqual","string_or_numeric"),a=$h(t,"b","greaterEqual","string_or_numeric");r=(n=i(Ah(r,a),2))[0],a=n[1],Uf(r.shape,a.shape);var o={a:r,b:a};return Bh.runKernel(fc,o)}});var yg=np({isFinite_:function(e){var t={x:$h(e,"x","isFinite")};return Bh.runKernel(yc,t)}});var bg=np({isInf_:function(e){var t={x:$h(e,"x","isInf")};return Bh.runKernel(bc,t)}});var xg=np({isNaN_:function(e){var t={x:$h(e,"x","isNaN")};return Bh.runKernel(xc,t)}});var wg=np({leakyRelu_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,n={x:$h(e,"x","leakyRelu")},r={alpha:t};return Bh.runKernel(wc,n,r)}});var kg=np({less_:function(e,t){var n,r=$h(e,"a","less","string_or_numeric"),a=$h(t,"b","less","string_or_numeric");r=(n=i(Ah(r,a),2))[0],a=n[1],Uf(r.shape,a.shape);var o={a:r,b:a};return Bh.runKernel(kc,o)}});var Sg=np({lessEqual_:function(e,t){var n,r=$h(e,"a","lessEqual","string_or_numeric"),a=$h(t,"b","lessEqual","string_or_numeric");r=(n=i(Ah(r,a),2))[0],a=n[1],Uf(r.shape,a.shape);var o={a:r,b:a};return Bh.runKernel(Sc,o)}});var Tg=np({localResponseNormalization_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,i=$h(e,"x","localResponseNormalization");ls(4===i.rank||3===i.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ".concat(i.rank,".")})),ls(vs(t),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ".concat(t,".")}));var o=i,s=!1;3===i.rank&&(s=!0,o=nv(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},c={depthRadius:t,bias:n,alpha:r,beta:a},l=Bh.runKernel(Rc,u,c);return s?nv(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var _g=np({log_:function(e){var t={x:$h(e,"x","log","float32")};return Bh.runKernel(_c,t)}});var Ig=np({log1p_:function(e){var t={x:$h(e,"x","log1p")};return Bh.runKernel(Ic,t)}});function Eg(e,t){ls(Ds(e),(function(){return"The f passed in variableGrads(f) must be a function"})),ls(null==t||Array.isArray(t)&&t.every((function(e){return e instanceof Mh})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var n=null!=t;if(!n)for(var r in t=[],Bh.registeredVariables)t.push(Bh.registeredVariables[r]);var a=n?t.filter((function(e){return!e.trainable})):null,i=t.length;t=t.filter((function(e){return e.trainable})),ls(t.length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the ".concat(i," variables is trainable.")}));var o=Bh.gradients(e,t,null,!0),s=o.value,u=o.grads;ls(u.some((function(e){return null!=e})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),ls(0===s.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-".concat(s.rank," tensor")}));var c={};return t.forEach((function(e,t){null!=u[t]&&(c[e.name]=u[t])})),null!=a&&a.forEach((function(e){return c[e.name]=null})),{value:s,grads:c}}function Cg(e){return Bh.customGrad(e)}function Mg(e){if(e.filter((function(e){return null==e})).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}var Ng=np({softplus_:function(e){var t={x:$h(e,"x","softplus")};return Bh.runKernel(Ml,t)}});var Rg=np({logSigmoid_:function(e){var t=$h(e,"x","logSigmoid");return Cg((function(e){return{value:zf(Ng(zf(e))),gradFunc:function(t){return Mm(t,ov(zf(e)))}}}))(t)}});var Lg=np({sub_:function(e,t){var n=$h(e,"a","sub"),r=$h(t,"b","sub"),a=i(Ah(n,r),2),o={a:n=a[0],b:r=a[1]};return Bh.runKernel(Zl,o)}});var Ag=np({logSoftmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=$h(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(n.rank," and axis was ").concat(t));return Cg((function(e,n){var r=$v(e,t,!0),a=Lg(e,r),o=Lg(hf(a,"float32"),_g(ig(cg(a),t,!0)));return n([o]),{value:o,gradFunc:function(e,n){var r=i(n,1)[0],a=cg(r);return Lg(e,Mm(ig(e,t,!0),a))}}}))(n)}});var Pg=np({logSumExp_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=$h(e,"x","logSumExp"),a=ws(t,r.shape),i=$v(r,a,!0),o=Lg(r,i),s=cg(o),u=ig(s,a),c=_g(u),l=Im(nv(i,c.shape),c);if(n){var d=jv(l.shape,a);return nv(l,d)}return l}});var Dg=np({logicalAnd_:function(e,t){var n=$h(e,"a","logicalAnd","bool"),r=$h(t,"b","logicalAnd","bool");Uf(n.shape,r.shape);var a={a:n,b:r};return Bh.runKernel(Ec,a)}});var Og=np({logicalNot_:function(e){var t={x:$h(e,"x","logicalNot","bool")};return Bh.runKernel(Cc,t)}});var zg=np({logicalOr_:function(e,t){var n=$h(e,"a","logicalOr","bool"),r=$h(t,"b","logicalOr","bool");Uf(n.shape,r.shape);var a={a:n,b:r};return Bh.runKernel(Mc,a)}});var Fg=np({logicalXor_:function(e,t){var n=$h(e,"a","logicalXor","bool"),r=$h(t,"b","logicalXor","bool");return Uf(n.shape,r.shape),Dg(zg(e,t),Og(Dg(e,t)))}});var Gg=np({maxPool_:function(e,t,n,r,a){var i=$h(e,"x","maxPool"),o=i,s=!1;3===i.rank&&(s=!0,o=nv(i,[1,i.shape[0],i.shape[1],i.shape[2]])),ls(4===o.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(o.rank,".")})),ls($m(n,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(1,"'")})),tv("maxPool",r,a);var u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a},l=Bh.runKernel(Dc,u,c);return s?nv(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var Wg=np({maxPool3d_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=$h(e,"x","maxPool3d"),s=o,u=!1;4===o.rank&&(u=!0,s=nv(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),ls(5===s.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(s.rank,".")})),ls("NDHWC"===i,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ".concat(i)})),tv("maxPool3d",r,a);var c={x:s},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},d=Bh.runKernel(zc,c,l);return u?nv(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});var Vg=np({maximum_:function(e,t){var n,r=$h(e,"a","maximum"),a=$h(t,"b","maximum");r=(n=i(Ah(r,a),2))[0],a=n[1],"bool"===r.dtype&&(r=hf(r,"int32"),a=hf(a,"int32")),Uf(r.shape,a.shape);var o={a:r,b:a};return Bh.runKernel(Pc,o)}});var Ug=np({mean_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:$h(e,"x","mean")},a={axis:t,keepDims:n};return Bh.runKernel(Wc,r,a)}});function Xg(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var n=Xg(e,"float32"),r=Xg(e,"float32");return rp(n,r)}var a=Vs(fs(e),t);return Bh.makeTensor(a,e,t)}function Bg(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var n=Bg(e,"float32"),r=Xg(e,"float32");return rp(n,r)}var a=Ws(fs(e),t);return Bh.makeTensor(a,e,t)}var Hg=np({minimum_:function(e,t){var n,r=$h(e,"a","minimum"),a=$h(t,"b","minimum");r=(n=i(Ah(r,a),2))[0],a=n[1],"bool"===r.dtype&&(r=hf(r,"int32"),a=hf(a,"int32")),Uf(r.shape,a.shape);var o={a:r,b:a};return Bh.runKernel(Uc,o)}});var Zg=np({mirrorPad_:function(e,t,n){ls("reflect"===n||"symmetric"===n,(function(){return"Invalid mode. Mode must be either reflect or symmetric. Got ".concat(n,".")}));var r=$h(e,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");ls(t.length===r.rank,(function(){return"Padding doesn't match input. Must be ".concat(r.rank,". Got ").concat(t.length,".")}));for(var a="reflect"===n?1:0,i=function(e){ls(2===t[e].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),ls(t[e][0]>=0&&t[e][0]<=r.shape[e]-a&&t[e][1]>=0&&t[e][1]<=r.shape[e]-a,(function(){return"Padding in dimension ".concat(e," cannot be greater than or equal to ").concat(r.shape[e]-a," or less than 0 for input of shape ").concat(r.shape)}))},o=0;o<r.rank;o++)i(o);var s={paddings:t,mode:n},u={x:r};return Bh.runKernel(Xc,u,s)}});var Kg=np({mod_:function(e,t){var n=$h(e,"a","mod"),r=$h(t,"b","mod"),a=i(Ah(n,r),2),o={a:n=a[0],b:r=a[1]};return Bh.runKernel(Bc,o)}});var jg=np({moments_:function(e){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=ws(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,(e=$h(e,"x","moments")).shape),r=Ug(e,n,t),a=r.shape;t||(a=jv(r.shape,n));var i=ag(Lg(hf(e,"float32"),nv(r,a)));return{mean:r,variance:Ug(i,n,t)}}});var Yg=np({notEqual_:function(e,t){var n,r=$h(e,"a","notEqual","string_or_numeric"),a=$h(t,"b","notEqual","string_or_numeric");r=(n=i(Ah(r,a),2))[0],a=n[1],Uf(r.shape,a.shape);var o={a:r,b:a};return Bh.runKernel(jc,o)}});var Qg=np({onesLike_:function(e){var t={x:$h(e,"x","onesLike")};return Bh.runKernel(qc,t)}});var Jg=np({pad_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=$h(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:t,constantValue:n},i={x:r};return Bh.runKernel(tl,i,a)}});var qg=np({spaceToBatchND_:function(e,t,n){var r=$h(e,"x","spaceToBatchND");ls(r.rank>=1+t.length,(function(){return"input rank ".concat(r.rank," should be > than [blockShape] ").concat(t.length)})),ls(n.length===t.length,(function(){return"paddings.shape[0] ".concat(n.length," must be equal to [blockShape] ").concat(t.length)})),ls(r.shape.reduce((function(e,r,a){return a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]===0:e}),!0),(function(){return"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(n.toString()," must be divisible by blockShapes ").concat(t.toString())}));var a={x:r},i={blockShape:t,paddings:n};return Bh.runKernel(Ll,a,i)}});var $g=np({pool_:function(e,t,n,r,a,o,s){null==a&&(a=[1,1]),null==o&&(o=1),0===r&&(r="valid");var u=$h(e,"x","maxPool"),c=u,l=!1;3===u.rank&&(l=!0,c=nv(u,[1,u.shape[0],u.shape[1],u.shape[2]])),ls($m(o,a),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(a,"'")}));var d,h=Xm(c.shape,t,o,a,r),p=[h.dilationHeight,h.dilationWidth];d="same"===r?function(e,t){var n=e.map((function(e,n){return e+(e-1)*(t[n]-1)})).map((function(e){return e-1})),r=n.map((function(e){return Math.floor(e/2)})),a=n.map((function(e,t){return e-r[t]}));return n.map((function(e,t){return[r[t],a[t]]}))}([h.filterHeight,h.filterWidth],p):[[0,0],[0,0]];var f=1===p[0]&&1===p[1],m=function(e,t,n){var r=n.map((function(e){return e[0]})),a=n.map((function(e){return e[1]})),i=e.concat(r,a),o=t.map((function(e,t){return(e-i[t]%e)%e})),s=a.map((function(e,t){return e+o[t]})),u=t.map((function(e,t){return[r[t],s[t]]})),c=t.map((function(e,t){return[0,o[t]]}));return[u,c]}([h.inHeight,h.inWidth],p,d),v=i(m,2),g=v[0],y=v[1],b=f?r:"valid",x=f?c:qg(c,p,g),w=("avg"===n?function(){return rv(x,t,o,b,s)}:function(){return Gg(x,t,o,b,s)})(),k=f?w:cv(w,p,y);return l?nv(k,[k.shape[1],k.shape[2],k.shape[3]]):k}});var ey=np({prelu_:function(e,t){var n={x:$h(e,"x","prelu"),alpha:$h(t,"alpha","prelu")};return Bh.runKernel(rl,n)}});var ty=np({prod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=$h(e,"x","prod");"bool"===r.dtype&&(r=hf(r,"int32"));var a={x:r},i={axis:t,keepDims:n};return Bh.runKernel(al,a,i)}}),ny={},ry={get exports(){return ny},set exports(e){ny=e}};!function(e){!function(e,t,n){function r(e){var t=this,n=function(){var e=4022871197,t=function(t){t=String(t);for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)};return t}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function a(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function i(e,t){var n=new r(e),i=t&&t.state,o=n.next;return o.int32=function(){return 4294967296*n.next()|0},o.double=function(){return o()+11102230246251565e-32*(2097152*o()|0)},o.quick=o,i&&("object"==typeof i&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:this.alea=i}(0,e)}(ry);var ay={},iy={get exports(){return ay},set exports(e){ay=e}};!function(e){!function(e,t,n){function r(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function i(e,t){var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&("object"==typeof i&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:this.xor128=i}(0,e)}(iy);var oy={},sy={get exports(){return oy},set exports(e){oy=e}};!function(e){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function i(e,t){var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&("object"==typeof i&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:this.xorwow=i}(0,e)}(sy);var uy={},cy={get exports(){return uy},set exports(e){uy=e}};!function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function a(e,t){return t.x=e.x.slice(),t.i=e.i,t}function i(e,t){null==e&&(e=+new Date);var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&(i.x&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:this.xorshift7=i}(0,e)}(cy);var ly={},dy={get exports(){return ly},set exports(e){ly=e}};!function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[i]=n^e,t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),a=0,i=-32;i<u;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(o=o+1640531527|0,a=0==(n=s[127&i]^=r+o)?a+1:0);for(a>=128&&(s[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=s[a+34&127],n=s[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[a]=r^n;e.w=o,e.X=s,e.i=a}(t,e)}function a(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function i(e,t){null==e&&(e=+new Date);var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&(i.X&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:this.xor4096=i}(0,e)}(dy);var hy={},py={get exports(){return hy},set exports(e){hy=e}};!function(e){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function a(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function i(e,t){var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&("object"==typeof i&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:this.tychei=i}(0,e)}(py);var fy={},my={get exports(){return fy},set exports(e){fy=e}},vy=Qo(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));!function(e){!function(t,n,r){var a,i=256,o="random",s=r.pow(i,6),u=r.pow(2,52),c=2*u,l=i-1;function d(e,l,d){var g=[],y=m(f((l=1==l?{entropy:!0}:l||{}).entropy?[e,v(n)]:null!==e&&void 0!==e?e:function(){try{var e;return a&&(e=a.randomBytes)?e=e(i):(e=new Uint8Array(i),(t.crypto||t.msCrypto).getRandomValues(e)),v(e)}catch(s){var r=t.navigator,o=r&&r.plugins;return[+new Date,t,o,t.screen,v(n)]}}(),3),g),b=new h(g),x=function(){for(var e=b.g(6),t=s,n=0;e<u;)e=(e+n)*i,t*=i,n=b.g(1);for(;e>=c;)e/=2,t/=2,n>>>=1;return(e+n)/t};return x.int32=function(){return 0|b.g(4)},x.quick=function(){return b.g(4)/4294967296},x.double=x,m(v(b.S),n),(l.pass||d||function(e,t,n,a){return a&&(a.S&&p(a,b),e.state=function(){return p(b,{})}),n?(r[o]=e,t):e})(x,y,"global"in l?l.global:this==r,l.state)}function h(e){var t,n=e.length,r=this,a=0,o=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);a<i;)s[a]=a++;for(a=0;a<i;a++)s[a]=s[o=l&o+e[a%n]+(t=s[a])],s[o]=t;(r.g=function(e){for(var t,n=0,a=r.i,o=r.j,s=r.S;e--;)t=s[a=l&a+1],n=n*i+s[l&(s[a]=s[o=l&o+t])+(s[o]=t)];return r.i=a,r.j=o,n})(i)}function p(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function f(e,t){var n,r=[],a=typeof e;if(t&&"object"==a)for(n in e)try{r.push(f(e[n],t-1))}catch(i){}return r.length?r:"string"==a?e:e+"\0"}function m(e,t){for(var n,r=e+"",a=0;a<r.length;)t[l&a]=l&(n^=19*t[l&a])+r.charCodeAt(a++);return v(t)}function v(e){return String.fromCharCode.apply(0,e)}if(m(r.random(),n),e.exports){e.exports=d;try{a=vy}catch(g){}}else r["seed"+o]=d}(typeof self<"u"?self:Yo,[],Math)}(my);var gy=ny,yy=ay,by=oy,xy=uy,wy=ly,ky=hy,Sy=fy;Sy.alea=gy,Sy.xor128=yy,Sy.xorwow=by,Sy.xorshift7=xy,Sy.xor4096=wy,Sy.tychei=ky;var Ty=Sy,_y=function(){function e(t,n,r,a,i){T(this,e),this.mean=t,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=i||Math.random();this.random=Ty.alea(o.toString())}return E(e,[{key:"nextValue",value:function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var a=void 0,i=void 0,o=void 0;do{o=(a=2*this.random()-1)*a+(i=2*this.random()-1)*i}while(o>=1||0===o);var s=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*a*s,n=this.mean+this.stdDev*i*s,(!this.truncated||this.isValidTruncated(t))&&(r=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(t)}},{key:"convertValue",value:function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}},{key:"isValidTruncated",value:function(e){return e<=this.upper&&e>=this.lower}}]),e}(),Iy=function(){function e(t,n,r,a){T(this,e),this.alpha=t,this.beta=1/n,this.dtype=r;var i=a||Math.random();this.randu=Ty.alea(i.toString()),this.randn=new _y(0,1,r,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return E(e,[{key:"nextValue",value:function(){for(var e,t,n,r,a,i;;){do{r=this.randn.nextValue(),i=1+this.c*r}while(i<=0);if(i*=i*i,t=1-.331*(e=r*r)*e,n=.5*e+this.d*(1-i+Math.log(i)),(a=this.randu())<t||Math.log(a)<n)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)}},{key:"convertValue",value:function(e){return"float32"===this.dtype?e:Math.round(e)}}]),e}(),Ey=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(T(this,e),this.canReturnFloat=function(){return null==t.dtype||"float32"===t.dtype},this.min=n,this.range=r-n,this.dtype=a,null==i&&(i=Math.random()),"number"==typeof i&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(n," - ").concat(r," <= 1 and dtype is not float"));this.random=Ty.alea(i)}return E(e,[{key:"convertValue",value:function(e){return this.canReturnFloat()?e:Math.round(e)}},{key:"nextValue",value:function(){return this.convertValue(this.min+this.range*this.random())}}]),e}();var Cy=np({randomNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(null!=r&&"bool"===r)throw new Error("Unsupported data type ".concat(r));for(var i=new _y(t,n,r,!1,a),o=df(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var My=np({randomUniform_:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>4?arguments[4]:void 0,a=df(e,arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32"),i=new Ey(t,n,null,r),o=0;o<a.values.length;o++)a.values[o]=i.nextValue();return a.toTensor()}});function Ny(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===n)throw new Error("Cannot have a step of zero");var a={start:e,stop:t,step:n,dtype:r};return Bh.runKernel(sl,{},a)}var Ry=np({reciprocal_:function(e){var t={x:$h(e,"x","reciprocal")};return Bh.runKernel(cl,t)}});var Ly=np({relu_:function(e){var t={x:$h(e,"x","relu")};return Bh.runKernel(ll,t)}});var Ay=np({relu6_:function(e){var t={x:$h(e,"x","relu6")};return Bh.runKernel(vl,t)}});var Py=np({reverse_:function(e,t){var n={x:$h(e,"x","reverse")},r={dims:t};return Bh.runKernel(gl,n,r)}});var Dy=np({round_:function(e){var t={x:$h(e,"x","round")};return Bh.runKernel(yl,t)}});var Oy=np({rsqrt_:function(e){var t={x:$h(e,"x","rsqrt","float32")};return Bh.runKernel(bl,t)}});var zy=np({selu_:function(e){var t={x:$h(e,"x","selu")};return Bh.runKernel(Sl,t)}});var Fy=np({separableConv2d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NHWC",s=$h(e,"x","separableConv2d"),u=$h(t,"depthwiseFilter","separableConv2d"),c=$h(n,"pointwiseFilter","separableConv2d"),l=s,d=!1;if(3===s.rank&&(d=!0,l=nv(s,[1,s.shape[0],s.shape[1],s.shape[2]])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");ls(4===l.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got rank ".concat(l.rank,".")})),ls(4===u.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank ".concat(u.rank,".")})),ls(4===c.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank ".concat(u.rank,".")})),ls(1===c.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ".concat(c.shape[0],".")})),ls(1===c.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ".concat(c.shape[1],".")}));var h=u.shape[2],p=u.shape[3];ls(c.shape[2]===h*p,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be ".concat(h*p,", but got ").concat(c.shape[2],".")}));var f=Ov(l,u,r,a,o,i),m=Tv(f,c,1,"valid",o);return d?nv(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});var Gy=np({sign_:function(e){var t={x:$h(e,"x","sign")};return Bh.runKernel(El,t)}});var Wy=np({sin_:function(e){var t={x:$h(e,"x","sin","float32")};return Bh.runKernel(_l,t)}});var Vy=np({sinh_:function(e){var t={x:$h(e,"x","sinh")};return Bh.runKernel(Il,t)}});var Uy=np({slice1d_:function(e,t,n){var r=$h(e,"x","slice1d");return ls(1===r.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(r.rank," tensor")})),sv(r,[t],[n])}});var Xy=np({slice2d_:function(e,t,n){var r=$h(e,"x","slice2d");return ls(2===r.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(r.rank," tensor")})),sv(r,t,n)}});var By=np({slice3d_:function(e,t,n){var r=$h(e,"x","slice3d");return ls(3===r.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(r.rank," tensor")})),sv(r,t,n)}});var Hy=np({slice4d_:function(e,t,n){var r=$h(e,"x","slice4d");return ls(4===r.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(r.rank," tensor")})),sv(r,t,n)}});var Zy=np({softmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=$h(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(n.rank," and dim was ").concat(t));var r={logits:n},a={dim:t};return Bh.runKernel(Pl,r,a)}});var Ky=np({fft_:function(e){ls("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 but got ".concat(e.dtype,".")}));var t={input:e};return Bh.runKernel(ic,t)}});var jy=np({ifft_:function(e){ls("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got ".concat(e.dtype,".")}));var t={input:e};return Bh.runKernel(vc,t)}});var Yy=np({irfft_:function(e){var t,n=e.shape[e.shape.length-1],r=e.size/n;if(n<=2){var a=nv(e,[r,n]);t=jy(a)}else{var i=[r,2*(n-1)],o=nv(Ff(e),[r,n]),s=nv(Of(e),[r,n]),u=Py(sv(o,[0,1],[r,n-2]),1),c=Mm(Py(sv(s,[0,1],[r,n-2]),1),ng(-1)),l=iv([o,u],1),d=iv([s,c],1),h=nv(rp(l,d),[i[0],i[1]]);t=jy(h)}if(t=Ff(t),3===e.rank&&0!==e.shape[0]){var p=t,f=e.shape[0];t=nv(t,[f,t.shape[0]/f,t.shape[1]]),p.dispose()}return t}});var Qy=np({split_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r={x:$h(e,"x","split")},a={numOrSizeSplits:t,axis:n};return Bh.runKernel(Al,r,a)}});var Jy=np({rfft_:function(e,t){ls("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got ".concat(e.dtype)}));var n,r=e.shape[e.shape.length-1],a=e.size/r;if(null!=t&&t<r){var i=e.shape.map((function(e){return 0})),o=e.shape.map((function(e){return e}));o[e.shape.length-1]=t,n=sv(e,i,o),r=t}else if(null!=t&&t>r){var s=e.shape.map((function(e){return e}));s[e.shape.length-1]=t-r,n=iv([e,Xg(s)],e.shape.length-1),r=t}else n=e;var u=Wv(n),c=nv(rp(n,u),[a,r]),l=Ky(c),d=Math.floor(r/2)+1,h=Ff(l),p=Of(l),f=Qy(h,[d,r-d],h.shape.length-1),m=Qy(p,[d,r-d],p.shape.length-1),v=n.shape.slice();return v[n.shape.length-1]=d,nv(rp(f[0],m[0]),v)}});var qy=np({squaredDifference_:function(e,t){var n,r=$h(e,"a","squaredDifference"),a=$h(t,"b","squaredDifference");r=(n=i(Ah(r,a),2))[0],a=n[1],Uf(r.shape,a.shape);var o={a:r,b:a};return Bh.runKernel(Wl,o,{})}});var $y=np({squeeze_:function(e,t){var n=$h(e,"x","squeeze","string_or_numeric");return nv(n,ks(n.shape,t).newShape)}});var eb=np({stack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=ep(e,"tensors","stack","string_or_numeric");ls(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),n.length>0&&ls(t<=n[0].rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n,a={axis:t};return Bh.runKernel(el,r,a)}});var tb=np({step_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:$h(e,"x","step")},r={alpha:t};return Bh.runKernel(rd,n,r)}});var nb=np({stridedSlice_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,c={x:$h(e,"x","stridedSlice","string_or_numeric")},l={begin:t,end:n,strides:r,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return Bh.runKernel(Ul,c,l)}});var rb=np({tan_:function(e){var t={x:$h(e,"x","tan","float32")};return Bh.runKernel(Kl,t)}});function ab(e,t){hs(e);var n=Qh(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return ap(e,null,n,t)}function ib(e,t,n){if(hs(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=Qh(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return ap(e,t,r,n)}var ob=np({topk_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=$h(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(t<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(t));if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") but got ").concat(t));var o={x:r},s={k:t,sorted:n},u=i(Bh.runKernel(Ql,o,s),2);return{values:u[0],indices:u[1]}}});var sb=np({truncatedNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");for(var i=new _y(t,n,r,!0,a),o=df(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var ub=np({unique_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=$h(e,"x","unique","string_or_numeric");ls(n.rank>0,(function(){return"The input tensor must be at least 1D"}));var r={x:n},a={axis:t},o=i(Bh.runKernel($l,r,a),2);return{values:o[0],indices:o[1]}}});var cb=np({unsortedSegmentSum_:function(e,t,n){var r=$h(e,"x","unsortedSegmentSum"),a=$h(t,"segmentIds","unsortedSegmentSum","int32");ls(vs(n),(function(){return"numSegments must be of dtype int"}));var i={x:r,segmentIds:a},o={numSegments:n};return Bh.runKernel(td,i,o)}});var lb=np({unstack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=$h(e,"x","unstack","string_or_numeric");ls(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = ".concat(t," is not in [-").concat(n.shape.length,", ").concat(n.shape.length,")")}));var r={value:n},a={axis:t};return Bh.runKernel(ed,r,a)}});function db(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return Bh.makeVariable(e,t,n,r)}function hb(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);for(var a=df(e,"int32"),i=df([n.length,e.length],"int32"),o=0;o<n.length;o++){var s=a.indexToLoc(n[o]),u=o*e.length;i.values.set(s,u)}return i.toTensor()}var pb=np({dropout_:function(e,t,n,r){var a=$h(e,"x","dropout");if(ls("float32"===a.dtype,(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a ".concat(a.dtype," tensor instead.")})),ls(t>=0&&t<1,(function(){return"rate must be a float in the range [0, 1), but got ".concat(t,".")})),0===t)return e instanceof kh?a.clone():a;var i=function(e,t){if(null==t)return e.shape.slice();if(ms(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(a,n),o=1-t,s=Cm(fg(Im(My(i,0,1,"float32",r),o)),o);return Mm(a,s)}});function fb(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function mb(e,t,n){for(var r=1-e%2,a=new Float32Array(e),i=0;i<e;++i){var o=2*Math.PI*i/(e+r-1);a[i]=t-n*Math.cos(o)}return ab(a,"float32")}var vb=np({conv2DBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=nv(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=nv(t,[1,t.shape[0],t.shape[1],t.shape[2]])),ls(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape ".concat(s.shape,".")})),ls(4===u.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape ".concat(u.shape,".")})),ls(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got ".concat(n,".")}));var c="NHWC"===i?s.shape[3]:s.shape[1],l="NHWC"===i?u.shape[3]:u.shape[1];ls(c===n[2],(function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must match input depth in filter (").concat(n[2],".")})),ls(l===n[3],(function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must match output depth for filter (").concat(n[3],").")})),tv("conv2dDerFilter",a,o);var d={x:s,dy:u},h={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:n};return Bh.runKernel(Ru,d,h)}});function gb(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return Mm(e,tb(t));throw new Error("Cannot compute gradient for fused activation ".concat(n,"."))}function yb(e,t){var n=t,r=Vf(e.shape,t.shape);return r.length>0&&(n=ig(n,r)),nv(n,e.shape)}function bb(e,t,n,r){if("linear"===t)return e;if("relu"===t)return Ly(e);if("elu"===t)return Xv(e);if("relu6"===t)return Ay(e);if("prelu"===t)return ey(e,n);if("leakyrelu"===t)return wg(e,r);if("sigmoid"===t)return ov(e);throw new Error("Unknown fused activation ".concat(t,"."))}var xb=function(e,t){return!(e>0)||"linear"===t};var wb=np({fusedConv2d_:function(e){var t,n=e.x,r=e.filter,a=e.strides,o=e.pad,s=e.dataFormat,u=void 0===s?"NHWC":s,c=e.dilations,l=void 0===c?[1,1]:c,d=e.dimRoundingMode,h=e.bias,p=e.activation,f=void 0===p?"linear":p,m=e.preluActivationWeights,v=e.leakyreluAlpha;if(f=f||"linear",!1===xb(Bh.state.gradientDepth,f)){ls("NHWC"===u,(function(){return"Error in fused conv2d: got dataFormat of ".concat(u," but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.")}));var g=Tv(n,r,a,o,u,l,d);return null!=h&&(g=Im(g,h)),bb(g,f,m,v)}var y=$h(n,"x","conv2d","float32"),b=$h(r,"filter","conv2d","float32"),x=y,w=!1;3===y.rank&&(w=!0,x=nv(y,[1,y.shape[0],y.shape[1],y.shape[2]])),ls(4===x.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank ".concat(x.rank,".")})),ls(4===b.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank ".concat(b.rank,".")})),tv("fused conv2d",o,d);var k="NHWC"===u?x.shape[3]:x.shape[1];ls(b.shape[2]===k,(function(){return"Error in conv2d: depth of input (".concat(k,") must match input depth for filter ").concat(b.shape[2],".")})),ls($m(a,l),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides ".concat(a," and dilations '").concat(l,"'")}));var S,T,_=Hm(x.shape,b.shape,a,l,o,d);if(null!=h&&(t=i(Ah(S=$h(h,"bias","fused conv2d"),y),1),S=t[0],"NHWC"===u?Uf(_.outShape,S.shape):(ls(S.shape.length<=1,(function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-".concat(S.shape.length,".")})),ls(0===S.shape.length||S.shape[0]===_.outChannels||1===S.shape[0],(function(){return"Error in fused conv2d: bias shape (".concat(S.shape,") is not compatible with the number of output channels (").concat(_.outChannels,")")})))),null!=m){var I=m.shape;if(ls(I.length<=1||3===I.length,(function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-".concat(I.length,".")})),1===I.length)ls(1===I[0]||I[0]===_.outChannels,(function(){return"Error in fused conv2d: PReLU activation weights (".concat(I,") is not compatible with the number of output channels (").concat(_.outChannels,").")}));else if(3===I.length)try{Uf(I,_.outShape)}catch(R){var E="Error in fused conv2d: PReLU activation weights (".concat(I,") is not compatible with the output shape of the conv2d (").concat(_.outShape,").");throw Error(E)}T=$h(m,"prelu weights","fused conv2d")}var C=function(e,t){ls("NHWC"===u,(function(){return"Error in gradient of fused conv2D: got dataFormat of ".concat(u," but only NHWC is currently supported.")}));var n=i(t,4),r=n[0],s=n[1],c=n[2],d=n[3],h=gb(e,c,f);ls(qm(l),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(l,"'")}));var p=[Iv(s.shape,h,r,a,o),vb(s,h,r.shape,a,o)];if(null!=d){var m=yb(d,h);p.push(m)}return p},M={x:x,filter:b,bias:S,preluActivationWeights:T},N={strides:a,pad:o,dataFormat:u,dilations:l,dimRoundingMode:d,activation:f,leakyreluAlpha:v};return null==h?Cg((function(e,t,n){var r=Bh.runKernel(sd,M,N);return n([t,e,r]),w&&(r=nv(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:C}}))(x,b):Cg((function(e,t,n,r){var a=Bh.runKernel(sd,M,N);return r([t,e,a,n]),w&&(a=nv(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:C}}))(x,b,S)}});var kb=np({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=nv(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=nv(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var c={x:s,dy:u},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:n};return Bh.runKernel(Bu,c,l)}});var Sb=np({depthwiseConv2dNativeBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=t,u=!1;3===t.rank&&(u=!0,s=nv(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var c={dy:s,filter:n},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:e},d=Bh.runKernel(Hu,c,l);return u?nv(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});var Tb=np({fusedMatMul_:function(e){var t=e.a,n=e.b,r=e.transposeA,a=void 0!==r&&r,o=e.transposeB,s=void 0!==o&&o,u=e.bias,c=e.activation,l=void 0===c?"linear":c,d=e.preluActivationWeights,h=e.leakyreluAlpha,p=void 0===h?.2:h;if(!1===xb(Bh.state.gradientDepth,l)){var f=Ef(t,n,a,s);return null!=u&&(f=Im(f,u)),bb(f,l,d,p)}var m=$h(t,"a","fused matMul"),v=$h(n,"b","fused matMul"),g=i(Ah(m,v),2);m=g[0],v=g[1];var y=a?m.shape[m.rank-2]:m.shape[m.rank-1],b=s?v.shape[v.rank-1]:v.shape[v.rank-2],x=a?m.shape[m.rank-1]:m.shape[m.rank-2],w=s?v.shape[v.rank-2]:v.shape[v.rank-1],k=m.shape.slice(0,-2),S=v.shape.slice(0,-2),T=fs(k),_=fs(S);ls(y===b,(function(){return"Error in fused matMul: inner shapes (".concat(y,") and (").concat(b,") of Tensors with shapes ").concat(m.shape," and ").concat(v.shape," and transposeA=").concat(a," and transposeB=").concat(s," must match.")}));var I,E,C=Uf(m.shape.slice(0,-2),v.shape.slice(0,-2)).concat([x,w]),M=nv(m,a?[T,y,x]:[T,x,y]),N=nv(v,s?[_,w,b]:[_,b,w]);null!=u&&(I=i(Ah(I=$h(u,"bias","fused matMul"),m),1)[0],Uf(C,I.shape)),null!=d&&(E=$h(d,"prelu weights","fused matMul"));var R=function(e,t){var n,r,o=i(t,4),c=o[0],d=o[1],h=o[2],p=o[3],f=gb(nv(e,h.shape),h,l);return a||s?!a&&s?(n=Ef(f,d,!1,!1),r=Ef(f,c,!0,!1)):a&&!s?(n=Ef(d,f,!1,!0),r=Ef(c,f,!1,!1)):(n=Ef(d,f,!0,!0),r=Ef(f,c,!0,!0)):(n=Ef(f,d,!1,!0),r=Ef(c,f,!0,!1)),null!=u?[n,r,yb(p,f)]:[n,r]},L={a:M,b:N,bias:I,preluActivationWeights:E},A={transposeA:a,transposeB:s,activation:l,leakyreluAlpha:p};return null==u?Cg((function(e,t,n){var r=Bh.runKernel(od,L,A);return n([e,t,r]),{value:nv(r,C),gradFunc:R}}))(M,N):Cg((function(e,t,n,r){var a=Bh.runKernel(od,L,A);return r([e,t,a,n]),{value:nv(a,C),gradFunc:R}}))(M,N,I)}});var _b=np({hammingWindow_:function(e){return mb(e,.54,.46)}});var Ib=np({hannWindow_:function(e){return mb(e,.5,.5)}});var Eb=np({frame_:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=0,o=[];i+t<=e.size;)o.push(sv(e,i,t)),i+=n;if(r)for(;i<e.size;){var s=i+t-e.size,u=iv([sv(e,i,t-s),yv([s],a)]);o.push(u),i+=n}return 0===o.length?ib([],[0,t]):nv(iv(o),[o.length,t])}});var Cb=np({stft_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Ib;null==r&&(r=fb(t));var i=Eb(e,t,n),o=Mm(i,a(t));return Jy(o,r)}});var Mb=np({cropAndResize_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"bilinear",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=$h(e,"image","cropAndResize"),s=$h(t,"boxes","cropAndResize","float32"),u=$h(n,"boxInd","cropAndResize","int32"),c=s.shape[0];ls(4===o.rank,(function(){return"Error in cropAndResize: image must be rank 4,but got rank ".concat(o.rank,".")})),ls(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] but had shape ").concat(s.shape,".")})),ls(1===u.rank&&u.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] but had shape ").concat(s.shape,".")})),ls(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length ".concat(r.length,".")})),ls(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was ".concat(r)})),ls("bilinear"===a||"nearest"===a,(function(){return"method must be bilinear or nearest, but was ".concat(a)}));var l={image:o,boxes:s,boxInd:u},d={method:a,extrapolationValue:i,cropSize:r};return Bh.runKernel(Wu,l,d)}});var Nb=np({flipLeftRight_:function(e){var t=$h(e,"image","flipLeftRight","float32");ls(4===t.rank,(function(){return"Error in flipLeftRight: image must be rank 4,but got rank ".concat(t.rank,".")}));var n={image:t};return Bh.runKernel(sc,n,{})}});var Rb=np({grayscaleToRGB_:function(e){var t=$h(e,"image","grayscaleToRGB"),n=t.rank-1,r=t.shape[n];ls(t.rank>=2,(function(){return"Error in grayscaleToRGB: images must be at least rank 2, but got rank ".concat(t.rank,".")})),ls(1===r,(function(){return"Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ".concat(r,".")}));var a=new Array(t.rank);return a.fill(1,0,n),a[n]=3,hg(t,a)}});var Lb=np({rotateWithOffset_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=$h(e,"image","rotateWithOffset","float32");ls(4===a.rank,(function(){return"Error in rotateWithOffset: image must be rank 4,but got rank ".concat(a.rank,".")}));var i={image:a},o={radians:t,fillValue:n,center:r};return Bh.runKernel(id,i,o)}});function Ab(e,t,n,r,a,i){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==i&&(i=0);var o=e.shape[0];return n=Math.min(n,o),ls(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '".concat(r,"'")})),ls(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '".concat(e.rank,"'")})),ls(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(e.shape[1])})),ls(1===t.rank,(function(){return"scores must be a 1D tensor"})),ls(t.shape[0]===o,(function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", but was ").concat(t.shape[0])})),ls(0<=i&&i<=1,(function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}var Pb=np({nonMaxSuppression_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=$h(e,"boxes","nonMaxSuppression","float32"),o=$h(t,"scores","nonMaxSuppression","float32"),s=Ab(i,o,n,r,a),u={maxOutputSize:n=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:a=s.scoreThreshold};return Bh.runKernel(Yc,{boxes:i,scores:o},u)}});function Db(e,t,n){var r=function(e,t,n){return function(e,t,n){for(var r=0,a=e.length,i=0,o=!1;r<a;){var s=n(t,e[i=r+(a-r>>>1)]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}(e,t,n||Ob)}(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function Ob(e,t){return e>t?1:e<t?-1:0}function zb(e,t,n,r,a){return Wb(e,t,n,r,a,0)}function Fb(e,t,n,r,a,i){return Wb(e,t,n,r,a,0,!1,i,!0)}function Gb(e,t,n,r,a,i){return Wb(e,t,n,r,a,i,!0)}function Wb(e,t,n,r,a,i){for(var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=[],l=0;l<t.length;l++)t[l]>a&&c.push({score:t[l],boxIndex:l,suppressBeginIndex:0});c.sort(Xb);for(var d=i>0?-.5/i:0,h=[],p=[];h.length<n&&c.length>0;){var f=c.pop(),m=f.score,v=f.boxIndex,g=f.suppressBeginIndex;if(m<a)break;for(var y=!1,x=h.length-1;x>=g;--x){var w=Vb(e,v,h[x]);if(w>=r){y=!0;break}if(f.score=f.score*Ub(r,d,w),f.score<=a)break}f.suppressBeginIndex=h.length,y||(f.score===m?(h.push(v),p.push(f.score)):f.score>a&&Db(c,f,Xb))}var k=h.length,S=n-k;s&&S>0&&(h.push.apply(h,b(new Array(S).fill(0))),p.push.apply(p,b(new Array(S).fill(0))));var T={selectedIndices:h};return o&&(T.selectedScores=p),u&&(T.validOutputs=k),T}function Vb(e,t,n){var r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),d=Math.max(a[0],a[2]),h=Math.max(a[1],a[3]),p=(s-i)*(u-o),f=(d-c)*(h-l);if(p<=0||f<=0)return 0;var m=Math.max(i,c),v=Math.max(o,l),g=Math.min(s,d),y=Math.min(u,h),b=Math.max(g-m,0)*Math.max(y-v,0);return b/(p+f-b)}function Ub(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function Xb(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function Bb(){return Bb=S(w().mark((function e(t,n,r){var a,i,o,s,u,c,l,d,h,p,f=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=f.length>3&&void 0!==f[3]?f[3]:.5,i=f.length>4&&void 0!==f[4]?f[4]:Number.NEGATIVE_INFINITY,o=$h(t,"boxes","nonMaxSuppressionAsync"),s=$h(n,"scores","nonMaxSuppressionAsync"),u=Ab(o,s,r,a,i),r=u.maxOutputSize,a=u.iouThreshold,i=u.scoreThreshold,e.next=6,Promise.all([o.data(),s.data()]);case 6:return c=e.sent,l=c[0],d=c[1],h=zb(l,d,r,a,i),p=h.selectedIndices,e.abrupt("return",(o!==t&&o.dispose(),s!==n&&s.dispose(),ab(p,"int32")));case 12:case"end":return e.stop()}}),e)}))),Bb.apply(this,arguments)}var Hb=function(e,t,n){return Bb.apply(this,arguments)};var Zb=np({nonMaxSuppressionWithScore_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=$h(e,"boxes","nonMaxSuppression"),s=$h(t,"scores","nonMaxSuppression"),u=Ab(o,s,n,r,a,i),c={boxes:o,scores:s},l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:a=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},d=Bh.runKernel(Jc,c,l);return{selectedIndices:d[0],selectedScores:d[1]}}});function Kb(){return Kb=S(w().mark((function e(t,n,r){var a,i,o,s,u,c,l,d,h,p,f,m,v=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=v.length>3&&void 0!==v[3]?v[3]:.5,i=v.length>4&&void 0!==v[4]?v[4]:Number.NEGATIVE_INFINITY,o=v.length>5&&void 0!==v[5]?v[5]:0,s=$h(t,"boxes","nonMaxSuppressionAsync"),u=$h(n,"scores","nonMaxSuppressionAsync"),c=Ab(s,u,r,a,i,o),r=c.maxOutputSize,a=c.iouThreshold,i=c.scoreThreshold,o=c.softNmsSigma,e.next=7,Promise.all([s.data(),u.data()]);case 7:return l=e.sent,d=l[0],h=l[1],p=Gb(d,h,r,a,i,o),f=p.selectedIndices,m=p.selectedScores,e.abrupt("return",(s!==t&&s.dispose(),u!==n&&u.dispose(),{selectedIndices:ab(f,"int32"),selectedScores:ab(m)}));case 14:case"end":return e.stop()}}),e)}))),Kb.apply(this,arguments)}var jb=function(e,t,n){return Kb.apply(this,arguments)};var Yb=np({nonMaxSuppressionPadded_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=$h(e,"boxes","nonMaxSuppression"),s=$h(t,"scores","nonMaxSuppression"),u=Ab(o,s,n,r,a,null),c={boxes:o,scores:s},l={maxOutputSize:u.maxOutputSize,iouThreshold:u.iouThreshold,scoreThreshold:u.scoreThreshold,padToMaxOutputSize:i},d=Bh.runKernel(Qc,c,l);return{selectedIndices:d[0],validOutputs:d[1]}}});function Qb(){return Qb=S(w().mark((function e(t,n,r){var a,o,s,u,c,l,d,h,p,f,m,v,g,y,b,x,k=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=k.length>3&&void 0!==k[3]?k[3]:.5,o=k.length>4&&void 0!==k[4]?k[4]:Number.NEGATIVE_INFINITY,s=k.length>5&&void 0!==k[5]&&k[5],u=$h(t,"boxes","nonMaxSuppressionAsync"),c=$h(n,"scores","nonMaxSuppressionAsync"),l=Ab(u,c,r,a,o,null),d=l.maxOutputSize,h=l.iouThreshold,p=l.scoreThreshold,e.next=11,Promise.all([u.data(),c.data()]);case 11:return f=e.sent,m=i(f,2),v=m[0],g=m[1],y=Fb(v,g,d,h,p,s),b=y.selectedIndices,x=y.validOutputs,e.abrupt("return",(u!==t&&u.dispose(),c!==n&&c.dispose(),{selectedIndices:ab(b,"int32"),validOutputs:ng(x,"int32")}));case 19:case"end":return e.stop()}}),e)}))),Qb.apply(this,arguments)}var Jb=function(e,t,n){return Qb.apply(this,arguments)};var qb=np({resizeBilinear_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=$h(e,"images","resizeBilinear");ls(3===a.rank||4===a.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank ".concat(a.rank,".")})),ls(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape ".concat(t,".")})),ls(!1===r||!1===n,(function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."}));var i=a,o=!1;3===a.rank&&(o=!0,i=nv(a,[1,a.shape[0],a.shape[1],a.shape[2]]));var s={images:i},u={alignCorners:n,halfPixelCenters:r,size:t},c=Bh.runKernel(fl,s,u);return o?nv(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});var $b=np({resizeNearestNeighbor_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=$h(e,"images","resizeNearestNeighbor");ls(3===a.rank||4===a.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ".concat(a.rank,".")})),ls(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape ".concat(t,".")})),ls("float32"===a.dtype||"int32"===a.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"})),ls(!1===r||!1===n,(function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."}));var i=a,o=!1;3===a.rank&&(o=!0,i=nv(a,[1,a.shape[0],a.shape[1],a.shape[2]]));var s={images:i},u={alignCorners:n,halfPixelCenters:r,size:t},c=Bh.runKernel(hl,s,u);return o?nv(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});var ex=np({threshold_:function(e){var t,n,r,a,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"binary",s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,c=$h(e,"image","threshold"),l=c.shape[0]*c.shape[1],d=Mm(ab([u]),255);if(ls(3===c.rank,(function(){return"Error in threshold: image must be rank 3,but got rank ".concat(c.rank,".")})),ls(3===c.shape[2]||1===c.shape[2],(function(){return"Error in threshold: image color channel must be equal to 3 or 1but got ".concat(c.shape[2],".")})),ls("int32"===c.dtype||"float32"===c.dtype,(function(){return"Error in dtype: image dtype must be int32 or float32,but got dtype ".concat(c.dtype,".")})),ls("otsu"===o||"binary"===o,(function(){return"Method must be binary or otsu, but was ".concat(o)})),3===c.shape[2]){var h=i(Qy(c,[1,1,1],-1),3);t=h[0],n=h[1],r=h[2];var p=Mm(t,.2989),f=Mm(n,.587),m=Mm(r,.114);a=Im(Im(p,f),m)}else a=e;"otsu"===o&&(d=function(e,t){for(var n,r,a,i,o,s,u=ab([-1]),c=ab([0]),l=ab([0]),d=0;d<e.size-1;d++){n=sv(e,0,d+1),r=sv(e,d+1),o=Cm(ig(n),t),s=Cm(ig(r),t);var h=ig(Mm(n,Ny(0,n.size)));a=Cm(h,ig(n));var p=yv(r.shape,n.size),f=Im(Ny(0,r.size),p),m=Mm(r,f);i=Cm(ig(m),ig(r));var v=Lg(a,i),g=Lg(a,i),y=Mm(o,s);l=Mm(Mm(y,v),g);var b=vg(l,c);c=Gv(b,l,c),u=Gv(b,ab([d]),u)}return u}(mv(hf(Dy(a),"int32"),ip([]),256),l));var v=s?Sg(a,d):vg(a,d);return hf(Mm(v,255),"int32")}});var tx=np({transform_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"constant",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5?arguments[5]:void 0,o=$h(e,"image","transform","float32"),s=$h(t,"transforms","transform","float32");ls(4===o.rank,(function(){return"Error in transform: image must be rank 4,but got rank ".concat(o.rank,".")})),ls(2===s.rank&&(s.shape[0]===o.shape[0]||1===s.shape[0])&&8===s.shape[1],(function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"})),ls(null==i||2===i.length,(function(){return"Error in transform: outputShape must be [height, width] or null, but got ".concat(i,".")}));var u={image:o,transforms:s},c={interpolation:n,fillMode:r,fillValue:a,outputShape:i};return Bh.runKernel(Jl,u,c)}});var nx=np({bandPart_:function(e,t,n){ls(t%1===0,(function(){return"bandPart(): numLower must be an integer, got ".concat(t,".")})),ls(n%1===0,(function(){return"bandPart(): numUpper must be an integer, got ".concat(n,".")}));var r=$h(e,"a","bandPart");ls(r.rank>=2,(function(){return"bandPart(): Rank must be at least 2, got ".concat(r.rank,".")}));var a=r.shape,o=i(r.shape.slice(-2),2),s=o[0],u=o[1];if(!(t<=s))throw new Error("bandPart(): numLower (".concat(t,") must not be greater than the number of rows (").concat(s,")."));if(!(n<=u))throw new Error("bandPart(): numUpper (".concat(n,") must not be greater than the number of columns (").concat(u,")."));t<0&&(t=s),n<0&&(n=u);var c=nv(Ny(0,s,1,"int32"),[-1,1]),l=Ny(0,u,1,"int32"),d=Lg(c,l),h=Dg(Sg(d,ng(+t,"int32")),gg(d,ng(-n,"int32"))),p=Xg([s,u],r.dtype);return nv(eb(lb(nv(r,[-1,s,u])).map((function(e){return Gv(h,e,p)}))),a)}});var rx=np({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,ls(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){ls(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: (".concat(e[t].shape[0]," vs. ").concat(n,")")}))},a=1;a<e.length;++a)r(a)}else t=!0,e=Qy(e,e.shape[0],0).map((function(e){return $y(e,[0])}));ls(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors (".concat(e.length,") exceeds number of dimensions (").concat(e[0].shape[0],").")}));for(var i=[],o=e,s=function(e){i.push(Bh.tidy((function(){var t=o[e];if(e>0)for(var n=0;n<e;++n){var r=Mm(ig(Mm(i[n],t)),i[n]);t=Lg(t,r)}return Cm(t,sg(t,"euclidean"))})))},u=0;u<e.length;++u)s(u);return t?eb(i,0):i}});function ax(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Bh.tidy((function(){ls(2===e.shape.length,(function(){return"qr2d() requires a 2D Tensor, but got a ".concat(e.shape.length,"D Tensor.")}));for(var n=e.shape[0],r=e.shape[1],a=pg(n),o=pf(e),s=ib([[1]],[1,1]),u=pf(s),c=n>=r?r:n,l=function(e){var t,c,l=o,d=u,h=a;t=Bh.tidy((function(){var t=sv(o,[e,e],[n-e,1]),i=sg(t),c=sv(o,[e,e],[1,1]),l=Gv(vg(c,0),ib([[-1]]),ib([[1]])),d=Lg(c,Mm(l,i)),h=Cm(t,d);u=1===h.shape[0]?pf(s):iv([s,sv(h,[1,0],[h.shape[0]-1,h.shape[1]])],0);var p=zf(Cm(Ef(l,d),i)),f=sv(o,[e,0],[n-e,r]),m=Mm(p,u),v=Gf(u);if(0===e)o=Lg(f,Ef(m,Ef(v,f)));else{var g=Lg(f,Ef(m,Ef(v,f)));o=iv([sv(o,[0,0],[e,r]),g],0)}var y=Gf(m),b=sv(a,[0,e],[n,a.shape[1]-e]);if(0===e)a=Lg(b,Ef(Ef(b,u),y));else{var x=Lg(b,Ef(Ef(b,u),y));a=iv([sv(a,[0,0],[n,e]),x],1)}return[u,o,a]})),c=i(t,3),u=c[0],o=c[1],a=c[2],Lf([l,d,h])},d=0;d<c;++d)l(d);return!t&&n>r&&(a=sv(a,[0,0],[n,r]),o=sv(o,[0,0],[r,r])),[a,o]}))}var ix,ox=np({qr_:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(ls(e.rank>=2,(function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(e.rank)})),2===e.rank)return ax(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=lb(nv(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],o=[];return r.forEach((function(e){var n=i(ax(e,t),2),r=n[0],s=n[1];a.push(r),o.push(s)})),[nv(eb(a,0),e.shape),nv(eb(o,0),e.shape)]}});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(ix||(ix={}));var sx=np({computeWeightedLoss_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ix.SUM_BY_NONZERO_WEIGHTS,r=$h(e,"losses","computeWeightedLoss"),a=null;null!=t&&(a=$h(t,"weights","computeWeightedLoss"));var i=null==a?r:Mm(r,a);if(n===ix.NONE)return i;if(n===ix.SUM)return ig(i);if(n===ix.MEAN){if(null==a)return Ug(i);var o=r.size/a.size,s=Cm(ig(i),ig(a));return o>1?Cm(s,ng(o)):s}if(n===ix.SUM_BY_NONZERO_WEIGHTS){if(null==a)return Cm(ig(i),ng(r.size));var u=Mm(a,Bg(r.shape)),c=hf(ig(Yg(u,ng(0))),"float32");return Cm(ig(i),c)}throw Error("Unknown reduction: ".concat(n))}});var ux=np({absoluteDifference_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ix.SUM_BY_NONZERO_WEIGHTS,a=$h(e,"labels","absoluteDifference"),i=$h(t,"predictions","absoluteDifference"),o=null;null!=n&&(o=$h(n,"weights","absoluteDifference")),ds(a.shape,i.shape,"Error in absoluteDifference: ");var s=Nm(Lg(a,i));return sx(s,o,r)}});var cx=np({cosineDistance_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ix.SUM_BY_NONZERO_WEIGHTS,i=$h(e,"labels","cosineDistance"),o=$h(t,"predictions","cosineDistance"),s=null;null!=r&&(s=$h(r,"weights","cosineDistance")),ds(i.shape,o.shape,"Error in cosineDistance: ");var u=ng(1),c=Lg(u,ig(Mm(i,o),n,!0));return sx(c,s,a)}});var lx=np({hingeLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ix.SUM_BY_NONZERO_WEIGHTS,a=$h(e,"labels","hingeLoss"),i=$h(t,"predictions","hingeLoss"),o=null;null!=n&&(o=$h(n,"weights","hingeLoss")),ds(a.shape,i.shape,"Error in hingeLoss: ");var s=ng(1);a=Lg(Mm(ng(2),a),s);var u=Ly(Lg(s,Mm(a,i)));return sx(u,o,r)}});var dx=np({huberLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ix.SUM_BY_NONZERO_WEIGHTS,i=$h(e,"labels","huberLoss"),o=$h(t,"predictions","huberLoss"),s=null;null!=n&&(s=$h(n,"weights","huberLoss")),ds(i.shape,o.shape,"Error in huberLoss: ");var u=ng(r),c=Nm(Lg(o,i)),l=Hg(c,u),d=Lg(c,l),h=Im(Mm(ng(.5),ag(l)),Mm(u,d));return sx(h,s,a)}});var hx=np({logLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-7,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ix.SUM_BY_NONZERO_WEIGHTS,i=$h(e,"labels","logLoss"),o=$h(t,"predictions","logLoss"),s=null;null!=n&&(s=$h(n,"weights","logLoss")),ds(i.shape,o.shape,"Error in logLoss: ");var u=ng(1),c=ng(r),l=zf(Mm(i,_g(Im(o,c)))),d=Mm(Lg(u,i),_g(Im(Lg(u,o),c))),h=Lg(l,d);return sx(h,s,a)}});var px=np({meanSquaredError_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ix.SUM_BY_NONZERO_WEIGHTS,a=$h(e,"labels","meanSquaredError"),i=$h(t,"predictions","meanSquaredError"),o=null;null!=n&&(o=$h(n,"weights","meanSquaredError")),ds(a.shape,i.shape,"Error in meanSquaredError: ");var s=qy(a,i);return sx(s,o,r)}});var fx=np({sigmoidCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ix.SUM_BY_NONZERO_WEIGHTS,i=$h(e,"multiClassLabels","sigmoidCrossEntropy"),o=$h(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=$h(n,"weights","sigmoidCrossEntropy")),ds(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=ng(r),c=ng(1),l=ng(.5);i=Im(Mm(i,Lg(c,u)),Mm(l,u))}var d=function(e,t){var n=$h(e,"labels","sigmoidCrossEntropyWithLogits"),r=$h(t,"logits","sigmoidCrossEntropyWithLogits");ds(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=Ly(r),i=Mm(r,n),o=Ig(cg(zf(Nm(r))));return Im(Lg(a,i),o)}(i,o);return sx(d,s,a)}});var mx=np({softmaxCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ix.SUM_BY_NONZERO_WEIGHTS,o=$h(e,"onehotLabels","softmaxCrossEntropy"),s=$h(t,"logits","softmaxCrossEntropy"),u=null;if(null!=n&&(u=$h(n,"weights","softmaxCrossEntropy")),ds(o.shape,s.shape,"Error in softmaxCrossEntropy: "),r>0){var c=ng(r),l=ng(1),d=ng(o.shape[1]);o=Im(Mm(o,Lg(l,c)),Cm(c,d))}var h=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ".concat(t.rank," and dim was ").concat(n));return Cg((function(e,t,r){var a=Pg(t,[n],!0),o=Lg(hf(t,"float32"),a);r([e,o]);var s=zf(Mm(o,e));return{value:ig(s,[n]),gradFunc:function(e,t){var r=i(t,2),a=r[0],o=r[1],s=jv(e.shape,[n]);return[Mm(nv(e,s),Lg(hf(a,"float32"),cg(o))),Mm(nv(e,s),Lg(cg(o),hf(a,"float32")))]}}}))(e,t)}(o,s);return sx(h,u,a)}});var vx=np({sparseFillEmptyRows_:function(e,t,n,r){var a=$h(e,"indices","sparseFillEmptyRows","int32"),i=$h(t,"values","sparseFillEmptyRows"),o=$h(n,"denseShape","sparseFillEmptyRows","int32"),s=$h(r,"defaultValue","sparseFillEmptyRows",i.dtype);if(2!==a.rank)throw new Error("Indices should be Tensor2D but received shape\n        ".concat(a.shape));if(1!==i.rank)throw new Error("Values should be Tensor1D but received shape ".concat(i.shape));if(1!==o.rank)throw new Error("Dense shape should be Tensor1D but received shape ".concat(o.shape));if(0!==s.rank)throw new Error("Default value should be a scalar but received shape ".concat(s.shape));var u={indices:a,values:i,denseShape:o,defaultValue:s},c=Bh.runKernel(Dl,u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}});var gx=np({sparseReshape_:function(e,t,n){var r=$h(e,"inputIndices","sparseReshape","int32"),a=$h(t,"inputShape","sparseReshape","int32"),i=$h(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error("Input indices should be Tensor2D but received shape\n        ".concat(r.shape));if(1!==a.rank)throw new Error("Input shape should be Tensor1D but received shape ".concat(a.shape));if(1!==i.rank)throw new Error("New shape should be Tensor1D but received shape ".concat(i.shape));var o={inputIndices:r,inputShape:a,newShape:i},s=Bh.runKernel(Ol,o);return{outputIndices:s[0],outputShape:s[1]}}});var yx=np({sparseSegmentMean_:function(e,t,n){var r=$h(e,"data","sparseSegmentMean"),a=$h(t,"indices","sparseSegmentMean","int32"),i=$h(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error("Indices should be Tensor1D but received shape\n          ".concat(a.shape));if(1!==i.rank)throw new Error("Segment ids should be Tensor1D but received shape\n          ".concat(i.shape));var o={data:r,indices:a,segmentIds:i};return Bh.runKernel(zl,o)}});var bx=np({sparseSegmentSum_:function(e,t,n){var r=$h(e,"data","sparseSegmentSum"),a=$h(t,"indices","sparseSegmentSum","int32"),i=$h(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error("Indices should be Tensor1D but received shape\n         ".concat(a.shape));if(1!==i.rank)throw new Error("Segment ids should be Tensor1D but received shape\n         ".concat(i.shape));var o={data:r,indices:a,segmentIds:i};return Bh.runKernel(Fl,o)}});var xx=np({stringNGrams_:function(e,t,n,r,a,i,o,s){var u=$h(e,"data","stringNGrams","string");if("string"!==u.dtype)throw new Error("Data must be of datatype string");if(1!==u.shape.length)throw new Error("Data must be a vector, saw: ".concat(u.shape));var c=$h(t,"dataSplits","stringNGrams");if("int32"!==c.dtype)throw new Error("Data splits must be of datatype int32");var l={separator:n,nGramWidths:r,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},d={data:u,dataSplits:c},h=Bh.runKernel(Xl,d,l);return{nGrams:h[0],nGramsSplits:h[1]}}});var wx=np({stringSplit_:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=$h(e,"input","stringSplit","string"),a=$h(t,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error("Input should be Tensor1D but received shape ".concat(r.shape));if(0!==a.rank)throw new Error("Delimiter should be a scalar but received shape ".concat(a.shape));var i={skipEmpty:n},o={input:r,delimiter:a},s=Bh.runKernel(Bl,o,i);return{indices:s[0],values:s[1],shape:s[2]}}});var kx=np({stringToHashBucketFast_:function(e,t){var n=$h(e,"input","stringToHashBucketFast","string"),r={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");var a={input:n};return Bh.runKernel(Hl,a,r)}}),Sx={fft:Ky,ifft:jy,rfft:Jy,irfft:Yy},Tx={hammingWindow:_b,hannWindow:Ib,frame:Eb,stft:Cb},_x={flipLeftRight:Nb,grayscaleToRGB:Rb,resizeNearestNeighbor:$b,resizeBilinear:qb,rotateWithOffset:Lb,cropAndResize:Mb,nonMaxSuppression:Pb,nonMaxSuppressionAsync:Hb,nonMaxSuppressionWithScore:Zb,nonMaxSuppressionWithScoreAsync:jb,nonMaxSuppressionPadded:Yb,nonMaxSuppressionPaddedAsync:Jb,threshold:ex,transform:tx},Ix={bandPart:nx,gramSchmidt:rx,qr:ox},Ex={absoluteDifference:ux,computeWeightedLoss:sx,cosineDistance:cx,hingeLoss:lx,huberLoss:dx,logLoss:hx,meanSquaredError:px,sigmoidCrossEntropy:fx,softmaxCrossEntropy:mx},Cx={sparseFillEmptyRows:vx,sparseReshape:gx,sparseSegmentMean:yx,sparseSegmentSum:bx},Mx={stringNGrams:xx,stringSplit:wx,stringToHashBucketFast:kx},Nx=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n,[{key:"minimize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=this.computeGradients(e,n),a=r.value,i=r.grads;if(null!=n){var o=n.map((function(e){return{name:e.name,tensor:i[e.name]}}));this.applyGradients(o)}else this.applyGradients(i);return Lf(i),t?a:(a.dispose(),null)}},{key:"iterations",get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}},{key:"incrementIterations",value:function(){this.iterations_=this.iterations+1}},{key:"computeGradients",value:function(e,t){return Eg(e,t)}},{key:"dispose",value:function(){null!=this.iterations_&&Lf(this.iterations_)}},{key:"saveIterations",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:ng(this.iterations_,"int32")}));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getWeights",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for this optimizer yet.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for this optimizer class ".concat(this.getClassName()));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"extractIterations",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t[0].tensor.data();case 2:return this.iterations_=e.sent[0],e.abrupt("return",t.slice(1));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(km);Object.defineProperty(Nx,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var Rx=function(e){m(n,e);var t=y(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return T(this,n),(a=t.call(this)).learningRate=e,a.rho=r,a.epsilon=i,a.accumulatedGrads=[],a.accumulatedUpdates=[],null==i&&(a.epsilon=Bh.backend.epsilon()),a}return E(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Bh.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:"".concat(n,"/accum_grad"),variable:Rf((function(){return Wv(a).variable(false)}))}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:"".concat(n,"/accum_var"),variable:Rf((function(){return Wv(a).variable(false)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;Rf((function(){var e=Im(Mm(o,t.rho),Mm(ag(i),1-t.rho)),n=Mm(Cm(rg(Im(s,t.epsilon)),rg(Im(o,t.epsilon))),i),r=Im(Mm(s,t.rho),Mm(ag(n),1-t.rho));o.assign(e),s.assign(r);var u=Im(Mm(n,-t.learningRate),a);a.assign(u)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedUpdates&&(Lf(this.accumulatedGrads.map((function(e){return e.variable}))),Lf(this.accumulatedUpdates.map((function(e){return e.variable}))))}},{key:"getWeights",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(b(this.accumulatedGrads),b(this.accumulatedUpdates)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=S(w().mark((function e(t){var n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,n=t.length/2,!1,this.accumulatedGrads=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}})),this.accumulatedUpdates=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}]),n}(Nx);Rx.className="Adadelta",Tm(Rx);var Lx=function(e){m(n,e);var t=y(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return T(this,n),(r=t.call(this)).learningRate=e,r.initialAccumulatorValue=a,r.accumulatedGrads=[],r}return E(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Bh.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:"".concat(n,"/accumulator"),variable:Rf((function(){return yv(a.shape,t.initialAccumulatorValue).variable(!1)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable;Rf((function(){var e=Im(o,ag(i));o.assign(e);var n=Im(Mm(Cm(i,rg(Im(e,Bh.backend.epsilon()))),-t.learningRate),a);a.assign(n)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedGrads&&Lf(this.accumulatedGrads.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulatedGrads.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,!1,this.accumulatedGrads=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}]),n}(Nx);Lx.className="Adagrad",Tm(Lx);var Ax=function(e){m(n,e);var t=y(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return T(this,n),(i=t.call(this)).learningRate=e,i.beta1=r,i.beta2=a,i.epsilon=o,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],Rf((function(){i.accBeta1=ng(r).variable(),i.accBeta2=ng(a).variable()})),null==o&&(i.epsilon=Bh.backend.epsilon()),i}return E(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);Rf((function(){var r=Lg(1,t.accBeta1),a=Lg(1,t.accBeta2);n.forEach((function(n,i){var o=Bh.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:Rf((function(){return Wv(o).variable(false)}))}),null==t.accumulatedSecondMoment[i]&&(t.accumulatedSecondMoment[i]={originalName:"".concat(n,"/v"),variable:Rf((function(){return Wv(o).variable(false)}))});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedSecondMoment[i].variable,l=Im(Mm(u,t.beta1),Mm(s,1-t.beta1)),d=Im(Mm(c,t.beta2),Mm(ag(s),1-t.beta2)),h=Cm(l,r),p=Cm(d,a);u.assign(l),c.assign(d);var f=Im(Mm(Cm(h,Im(rg(p),t.epsilon)),-t.learningRate),o);o.assign(f)}})),t.accBeta1.assign(Mm(t.accBeta1,t.beta1)),t.accBeta2.assign(Mm(t.accBeta2,t.beta2))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Lf(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedSecondMoment&&Lf(this.accumulatedSecondMoment.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(b(this.accumulatedFirstMoment),b(this.accumulatedSecondMoment)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=S(w().mark((function e(t){var n,r=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,Rf((function(){r.accBeta1.assign(tg(r.beta1,r.iterations_+1)),r.accBeta2.assign(tg(r.beta2,r.iterations_+1))})),n=t.length/2,!1,this.accumulatedFirstMoment=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}})),this.accumulatedSecondMoment=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}]),n}(Nx);Ax.className="Adam",Tm(Ax);var Px=function(e){m(n,e);var t=y(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return T(this,n),(i=t.call(this)).learningRate=e,i.beta1=r,i.beta2=a,i.epsilon=o,i.decay=s,i.accumulatedFirstMoment=[],i.accumulatedWeightedInfNorm=[],Rf((function(){i.iteration=ng(0).variable(),i.accBeta1=ng(r).variable()})),null==o&&(i.epsilon=Bh.backend.epsilon()),i}return E(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);Rf((function(){var r=Lg(1,t.accBeta1),a=Cm(-t.learningRate,Im(Mm(t.iteration,t.decay),1));n.forEach((function(n,i){var o=Bh.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:Wv(o).variable(false)}),null==t.accumulatedWeightedInfNorm[i]&&(t.accumulatedWeightedInfNorm[i]={originalName:"".concat(n,"/v"),variable:Wv(o).variable(false)});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedWeightedInfNorm[i].variable,l=Im(Mm(u,t.beta1),Mm(s,1-t.beta1)),d=Mm(c,t.beta2),h=Nm(s),p=Vg(d,h);u.assign(l),c.assign(p);var f=Im(Mm(Cm(a,r),Cm(l,Im(p,t.epsilon))),o);o.assign(f)}})),t.iteration.assign(Im(t.iteration,1)),t.accBeta1.assign(Mm(t.accBeta1,t.beta1))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Lf(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedWeightedInfNorm&&Lf(this.accumulatedWeightedInfNorm.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}]),n}(Nx);Px.className="Adamax",Tm(Px);var Dx=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this)).learningRate=e,r.setLearningRate(e),r}return E(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=Bh.registeredVariables[n];Rf((function(){var e=Im(Mm(t.c,a),i);i.assign(e)}))}})),this.incrementIterations()}},{key:"setLearningRate",value:function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=Af(ng(-e))}},{key:"dispose",value:function(){this.c.dispose()}},{key:"getWeights",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0]);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:if(0===(t=e.sent).length){e.next=5;break}throw new Error("SGD optimizer does not have settable weights.");case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate)}}]),n}(Nx);Dx.className="SGD",Tm(Dx);var Ox=function(e){m(n,e);var t=y(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return T(this,n),(a=t.call(this,e)).learningRate=e,a.momentum=r,a.useNesterov=i,a.accumulations=[],a.m=ng(a.momentum),a}return E(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Bh.registeredVariables[n];null==t.accumulations[r]&&(t.accumulations[r]={originalName:"".concat(n,"/momentum"),variable:Rf((function(){return Wv(a).variable(!1)}))});var i=t.accumulations[r].variable,o=Array.isArray(e)?e[r].tensor:e[n];null!=o&&Rf((function(){var e,n=Im(Mm(t.m,i),o);e=t.useNesterov?Im(Mm(t.c,Im(o,Mm(n,t.m))),a):Im(Mm(t.c,n),a),i.assign(n),a.assign(e)}))})),this.incrementIterations()}},{key:"dispose",value:function(){this.m.dispose(),null!=this.accumulations&&Lf(this.accumulations.map((function(e){return e.variable})))}},{key:"setMomentum",value:function(e){this.momentum=e}},{key:"getWeights",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulations.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,!1,this.accumulations=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}]),n}(Dx);Ox.className="Momentum",Tm(Ox);var zx=function(e){m(n,e);var t=y(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(T(this,n),(r=t.call(this)).learningRate=e,r.decay=a,r.momentum=i,r.epsilon=o,r.accumulatedMeanSquares=[],r.accumulatedMoments=[],r.accumulatedMeanGrads=[],r.centered=s,null==o&&(r.epsilon=Bh.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return p(r)}return E(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Bh.registeredVariables[n],i=!1;null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:"".concat(n,"/rms"),variable:Rf((function(){return Wv(a).variable(i)}))}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:"".concat(n,"/momentum"),variable:Rf((function(){return Wv(a).variable(i)}))}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:"".concat(n,"/mg"),variable:Rf((function(){return Wv(a).variable(i)}))});var o=Array.isArray(e)?e[r].tensor:e[n];if(null!=o){var s=t.accumulatedMeanSquares[r].variable,u=t.accumulatedMoments[r].variable;Rf((function(){var e=Im(Mm(s,t.decay),Mm(ag(o),1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,i=Im(Mm(n,t.decay),Mm(o,1-t.decay)),c=Cm(Mm(o,t.learningRate),rg(Lg(e,Im(ag(i),t.epsilon)))),l=Im(Mm(u,t.momentum),c);s.assign(e),n.assign(i),u.assign(l);var d=Lg(a,l);a.assign(d)}else{var h=Im(Mm(s,t.decay),Mm(ag(o),1-t.decay)),p=Im(Mm(u,t.momentum),Cm(Mm(o,t.learningRate),rg(Im(h,t.epsilon))));s.assign(h),u.assign(p);var f=Lg(a,p);a.assign(f)}}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedMeanSquares&&Lf(this.accumulatedMeanSquares.map((function(e){return e.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&Lf(this.accumulatedMeanGrads.map((function(e){return e.variable}))),null!=this.accumulatedMoments&&Lf(this.accumulatedMoments.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(b(this.accumulatedMeanSquares),b(this.accumulatedMoments)),this.centered&&t.push.apply(t,b(this.accumulatedMeanGrads)),e.next=4,this.saveIterations();case 4:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=S(w().mark((function e(t){var n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,n=this.centered?t.length/3:t.length/2,r=!1,this.accumulatedMeanSquares=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})),this.accumulatedMoments=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*n,3*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}]),n}(Nx);zx.className="RMSProp",Tm(zx);var Fx,Gx=function(){function e(){T(this,e)}return E(e,null,[{key:"sgd",value:function(e){return new Dx(e)}},{key:"momentum",value:function(e,t){return new Ox(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2])}},{key:"rmsprop",value:function(e){return new zx(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}},{key:"adam",value:function(){return new Ax(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},{key:"adadelta",value:function(){return new Rx(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},{key:"adamax",value:function(){return new Px(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.002,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]?arguments[4]:0)}},{key:"adagrad",value:function(e){return new Lx(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1)}}]),e}(),Wx={sgd:Gx.sgd,momentum:Gx.momentum,adadelta:Gx.adadelta,adagrad:Gx.adagrad,rmsprop:Gx.rmsprop,adamax:Gx.adamax,adam:Gx.adam},Vx=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:function(e){return e()};function Ux(){return new Promise((function(e){return Vx((function(){return e()}))}))}function Xx(e,t){var n=e[0].length;e.forEach((function(e,t){ls(e.length===n,(function(){return"Error in concat".concat(n,"D: rank of tensors[").concat(t,"] must be the same as the rank of the rest (").concat(n,")")}))})),ls(t>=0&&t<n,(function(){return"Error in concat".concat(n,"D: axis must be between 0 and ").concat(n-1,".")}));var r=e[0];e.forEach((function(e,a){for(var i=0;i<n;i++)ls(i===t||e[i]===r[i],(function(){return"Error in concat".concat(n,"D: Shape of tensors[").concat(a,"] (").concat(e,") does not match the shape of the rest (").concat(r,") along the non-concatenated axis ").concat(a,".")}))}))}function Bx(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function Hx(e,t,n){var r=new Array;if(null==n&&null==t)return r;if(null==t)for(;r.length<e+n.length;)r.push(-1);else r=t.slice();if(null==n)return r;if(e+n.length!==r.length)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.rank = ").concat(e+n.length,", but shape.rank = ").concat(r.length));for(var a=1;a<n.length;++a){var i=n[a],o=r[r.length-n.length+a],s=r[o];if(i>=0)if(s>=0){if(s!==i)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.shape[").concat(a+e,"] = ").concat(i," but shape[").concat(a+e,"] = ").concat(s))}else r[o]=i}return r}function Zx(e){var t,n={FIRST_DIM_SIZE:Fx.FIRST_DIM_SIZE,VALUE_ROWIDS:Fx.VALUE_ROWIDS,ROW_LENGTHS:Fx.ROW_LENGTHS,ROW_SPLITS:Fx.ROW_SPLITS,ROW_LIMITS:Fx.ROW_LIMITS,ROW_STARTS:Fx.ROW_STARTS},r=[],a=x(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(!(i in n))break;r.push(n[i])}}catch(o){a.e(o)}finally{a.f()}return r}function Kx(e){return 0===e.length?0:e[0]===Fx.FIRST_DIM_SIZE?e.length-1:e.length}function jx(e,t){if(null!=e&&null!=t){var n=e.length,r=t.length;if(n>=r)throw new Error("defaultValue.shape=".concat(e," and ragged tensor flatValues.shape=").concat(t,", are incompatible: defaultValue.rank = ").concat(n," must be less than ragged tensor input flatValues.rank = ").concat(r,")"));for(var a=0;a<Math.min(n,r-1);++a){var i=e[a],o=t[a+1];if(i>=0&&o>=0&&1!==i&&i!==o)throw new Error("defaultValue.shape=".concat(e,", and ragged tensor input flatValues.shape=").concat(t," are incompatible: defaultValue.shape[").concat(a-e.length,"] = ").concat(i," but ragged tensor input.flatValues.shape[").concat(a-e.length,"] = ").concat(o))}}}!function(e){e[e.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",e[e.VALUE_ROWIDS=1]="VALUE_ROWIDS",e[e.ROW_LENGTHS=2]="ROW_LENGTHS",e[e.ROW_SPLITS=3]="ROW_SPLITS",e[e.ROW_LIMITS=4]="ROW_LIMITS",e[e.ROW_STARTS=5]="ROW_STARTS"}(Fx||(Fx={}));var Yx=30;function Qx(e){return e<=Yx?e:Os(e,Math.floor(Math.sqrt(e)))}function Jx(e,t,n){return[n*("number"==typeof e?e:e[0]),t*("number"==typeof e?e:e[1])]}function qx(e,t,n){var r=[];if(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])(r=r.concat(t.slice(0))).push(e[0]/n),r=r.concat(e.slice(1));else{r=r.concat(e[0]);for(var a=t.length,i=0;i<a;++i)r=r.concat([e[i+1]/t[i],t[i]]);r=r.concat(e.slice(a+1))}return r}function $x(e,t){var n=[];if(!(arguments.length>2&&void 0!==arguments[2])||arguments[2]){n.push(t);for(var r=t+1;r<e;++r)r<=2*t?(n.push(r),n.push(r-(t+1))):n.push(r)}else{for(var a=[],i=[],o=1;o<e;++o)o>=2*t+1||o%2===1?i.push(o):a.push(o);n.push.apply(n,a),n.push(0),n.push.apply(n,i)}return n}function ew(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(var i=1;i<e.length;++i)i<=t.length?r?a.push(t[i-1]*e[i]):a.push(e[i]/t[i-1]):a.push(e[i]);return a}function tw(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function nw(e,t,n){for(var r=e.slice(0,1),a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}var rw=1.7580993408473768,aw=1.0507009873554805,iw=.3275911,ow=.254829592,sw=-.284496736,uw=1.421413741,cw=-1.453152027,lw=1.061405429;function dw(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:".concat(e.length,", imag: ").concat(t.length,"."));for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function hw(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function pw(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=0;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function fw(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=2;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function mw(e,t){return{real:e[2*t],imag:e[2*t+1]}}function vw(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function gw(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),a=0;a<Math.ceil(e/2);a++){var i=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(i),r[a]=Math.sin(i)}return{real:n,imag:r}}function yw(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}var bw="->",xw=/->/g,ww=",",kw="...";function Sw(e,t){var n=((e=e.replace(/\s/g,"")).length-e.replace(xw,"").length)/bw.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("'.concat(bw,'").'));var r=i(e.split(bw),2),a=r[0],o=r[1];ls(-1===a.indexOf(kw),(function(){return'The ellipsis notation ("'.concat(kw,'") is not supported yet.')}));var s=a.split(ww),u=s.length;if(t!==u)throw new Error("Expected ".concat(u," input tensors, received ").concat(t));if(u>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");for(var c=[],l=function(){var e=o[d];if(!s.some((function(t){return-1!==t.indexOf(e)})))throw new Error("Output subscripts contain the label ".concat(e," not present in the input subscripts."));-1===c.indexOf(e)&&c.push(e)},d=0;d<o.length;++d)l();for(var h=0;h<a.length;++h){var p=a[h];-1===c.indexOf(p)&&p!==ww&&c.push(p)}for(var f=new Array(s.length),m=0;m<u;++m){if(new Set(s[m].split("")).size!==s[m].length)throw new Error("Found duplicate axes in input component ".concat(s[m],". Support for duplicate axes in input is not implemented yet."));f[m]=[];for(var v=0;v<s[m].length;++v)f[m].push(c.indexOf(s[m][v]))}for(var g=c.length,y=[],b=o.length;b<g;++b)y.push(b);return{allDims:c,summedDims:y,idDims:f}}function Tw(e,t){var n=new Array(e);n.fill(-1);for(var r=0;r<t.length;++r)n[t[r]]=r;for(var a=[],i=0;i<e;++i)-1===n[i]&&a.push(i);return n=n.filter((function(e){return-1!==e})),{permutationIndices:n,expandDims:a}}function _w(e,t,n){for(var r=new Array(e),a=function(e){for(var a=n[e].shape,i=function(n){void 0===r[t[e][n]]?r[t[e][n]]=a[n]:ls(r[t[e][n]]===a[n],(function(){return"Expected dimension ".concat(r[t[e][n]]," at axis ").concat(n," of input shaped ").concat(JSON.stringify(a),", but got dimension ").concat(a[n])}))},o=0;o<t[e].length;++o)i(o)},i=0;i<n.length;++i)a(i)}function Iw(e,t){var n,r=e,a=[];0===e.length&&r.push(-1),n=e.length+1;for(var i=0;i<n;++i)a.push([]);for(var o=[],s=0;s<r.length;++s){var u,c=x(Cw(t,r[s]));try{for(c.s();!(u=c.n()).done;){var l=u.value;-1===o.indexOf(l)&&(a[s].push(l),o.push(l))}}catch(d){c.e(d)}finally{c.f()}}return{path:r,steps:a}}function Ew(e){return e.every((function(e,t){return e===t}))}function Cw(e,t){for(var n=[],r=0;r<e.length;++r)(0===e[r].length||-1!==e[r].indexOf(t)||-1===t)&&n.push(r);return n}function Mw(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];if("number"==typeof t)ls(e.shape[n]%t===0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(e.shape[n]/t);else{var a=t.reduce((function(e,t){return-1===t&&(e+=1),e}),0);ls(a<=1,(function(){return"There should be only one negative value in split array."}));var i=t.indexOf(-1);if(-1!==i){var o=t.reduce((function(e,t){return t>0?e+t:e}));t[i]=e.shape[n]-o}ls(e.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t}return r}function Nw(e){return"Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ".concat(e)}function Rw(e,t){return"indices(".concat(e,", 0) is invalid: ").concat(t," < 0")}function Lw(e,t,n){return"indices(".concat(e,", 0) is invalid: ").concat(t," >= ").concat(n)}function Aw(e,t){return"only one output dimension may be -1, not both ".concat(e," and ").concat(t)}function Pw(e,t){return"size ".concat(e," must be non-negative, not ").concat(t)}function Dw(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function Ow(e,t){var n=fs(e),r=fs(t);return"Input to reshape is a SparseTensor with ".concat(n,"\n  dense values, but the requested shape requires a multiple of ").concat(r,". inputShape=").concat(e," outputShape= ").concat(t)}function zw(e,t){var n=fs(e),r=fs(t);return"Input to reshape is a tensor with ".concat(n," dense values, but the requested shape has ").concat(r,". inputShape=").concat(e," outputShape=").concat(t)}function Fw(){return"segment ids must be >= 0"}function Gw(){return"segment ids are not increasing"}function Ww(e,t){return"Segment id ".concat(e," out of range [0, ").concat(t,"), possibly because segmentIds input is not sorted.")}function Vw(e,t,n){return"Bad: indices[".concat(e,"] == ").concat(t," out of range [0, ").concat(n,")")}function Uw(e,t){var n,r=!1;for(e<=Yx?(n=e,r=!0):n=Os(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=Os(e,n+1);return n}function Xw(e,t,n){for(var r=[],a=e.length,i=0;i<a;i++)i!==t?r.push(e[i]):r.push(n);return r}function Bw(e,t,n,r){var a=t.shape.length,i=e.shape.length;if(0!==r&&(r<-a||r>a))throw new Error("Expect batchDims in the range of [-".concat(a,", ").concat(a,"], but got ").concat(r));if(r<0&&(r+=a),r>i)throw new Error("batchDims (".concat(r,") must be less than rank(x) (\n    ").concat(i,")."));if(n<r)throw new Error("batchDims (".concat(r,") must be less than or equal to axis (").concat(n,")."));for(var o=0;o<r;++o)if(e.shape[o]!==t.shape[o])throw new Error("x.shape[".concat(o,"]: ").concat(e.shape[o]," should be equal to indices.shape[").concat(o,"]: ").concat(t.shape[o],"."));for(var s=e.shape[n],u=[],c=1,l=1,d=1,h=0;h<r;++h)u.push(e.shape[h]),c*=e.shape[h];for(var p=r;p<n;p++)u.push(e.shape[p]),l*=e.shape[p];for(var f=r;f<a;f++)u.push(t.shape[f]);for(var m=n+1;m<i;m++)u.push(e.shape[m]),d*=e.shape[m];return{batchSize:c,sliceSize:d,outerSize:l,dimSize:s,outputShape:u}}var Hw=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:Bw,computeOutShape:Xw,segOpComputeOptimalWindowSize:Uw},Symbol.toStringTag,{value:"Module"}));function Zw(e){try{return e.map((function(e){return sh(e)}))}catch(KZ){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat(KZ))}}function Kw(e){return e.map((function(e){return oh(e)}))}var jw=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:ow,ERF_A2:sw,ERF_A3:uw,ERF_A4:cw,ERF_A5:lw,ERF_P:iw,PARALLELIZE_THRESHOLD:Yx,get RowPartitionType(){return Fx},SELU_SCALE:aw,SELU_SCALEALPHA:rw,applyActivation:bb,assertAndGetBroadcastShape:Uf,assertAxesAreInnerMostDims:Yv,assertParamsConsistent:Xx,assignToTypedArray:vw,axesAreInnerMostDims:Hv,calculateShapes:nm,checkEinsumDimSizes:_w,checkPadOnDimRoundingMode:tv,combineLocations:Zv,combineRaggedTensorToTensorShapes:Hx,complexWithEvenIndex:pw,complexWithOddIndex:fw,computeConv2DInfo:Hm,computeConv3DInfo:Zm,computeDefaultPad:Km,computeDilation2DInfo:Um,computeOptimalWindowSize:Qx,computeOutAndReduceShapes:Kv,computeOutShape:Bx,computePool2DInfo:Xm,computePool3DInfo:Bm,convertConv2DDataFormat:ev,decodeEinsumEquation:Sw,eitherStridesOrDilationsAreOne:$m,expandShapeToKeepDim:jv,exponent:yw,exponents:gw,fromStringArrayToUint8:Kw,fromUint8ToStringArray:Zw,getAxesPermutation:Qv,getBroadcastDims:Wf,getComplexWithIndex:mw,getEinsumComputePath:Iw,getEinsumPermutation:Tw,getFusedBiasGradient:yb,getFusedDyActivation:gb,getImageCenter:Jx,getInnerMostAxes:qv,getPermuted:$x,getRaggedRank:Kx,getReductionAxes:Vf,getReshaped:qx,getReshapedPermuted:ew,getRowPartitionTypesHelper:Zx,getSliceBeginCoords:tw,getSliceSize:nw,getSparseFillEmptyRowsIndicesDenseShapeMismatch:Nw,getSparseFillEmptyRowsNegativeIndexErrorMessage:Rw,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:Lw,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:Dw,getSparseReshapeInputOutputMismatchErrorMessage:zw,getSparseReshapeInputOutputMultipleErrorMessage:Ow,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:Aw,getSparseReshapeNegativeOutputDimErrorMessage:Pw,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:Vw,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:Fw,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:Gw,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:Ww,getUndoAxesPermutation:Jv,isIdentityPermutation:Ew,log:function(){var e;Qs().getBool("IS_TEST")||Qs().getBool("PROD")||(e=console).log.apply(e,arguments)},mergeRealAndImagArrays:dw,prepareAndValidate:qf,prepareSplitSize:Mw,segment_util:Hw,shouldFuse:xb,slice_util:wm,splitRealAndImagArrays:hw,tupleValuesAreOne:qm,upcastType:Rh,validateDefaultValueShape:jx,validateInput:tm,validateUpdateShape:em,warn:cd},Symbol.toStringTag,{value:"Module"})),Yw={kernelName:tu,inputsToSave:["x"],gradFunc:function(e,t){var n=i(t,1)[0];return{x:function(){return Mm(e,tb(hf(n,"float32"),-1))}}}},Qw={kernelName:nu,inputsToSave:["x"],gradFunc:function(e,t){var n=i(t,1)[0];return{x:function(){var t=ag(hf(n,"float32")),r=rg(Lg(ng(1),t));return zf(Cm(e,r))}}}},Jw={kernelName:ru,inputsToSave:["x"],gradFunc:function(e,t){var n=i(t,1)[0];return{x:function(){var t=rg(Lg(ag(hf(n,"float32")),1));return Cm(e,t)}}}},qw={kernelName:au,inputsToSave:["a","b"],gradFunc:function(e,t){var n=i(t,2),r=n[0],a=n[1],o=Uf(r.shape,a.shape);return{a:function(){var t=e,n=Vf(r.shape,o);return n.length>0&&(t=ig(t,n)),nv(t,r.shape)},b:function(){var t=e,n=Vf(a.shape,o);return n.length>0&&(t=ig(t,n)),nv(t,a.shape)}}}},$w={kernelName:iu,saveAllInputs:!0,gradFunc:function(e,t){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}},ek={kernelName:uu,inputsToSave:["x"],gradFunc:function(e,t){var n=i(t,1)[0];return{x:function(){return Wv(n)}}}},tk={kernelName:cu,inputsToSave:["x"],gradFunc:function(e,t){var n=i(t,1)[0];return{x:function(){return Wv(n)}}}},nk={kernelName:lu,inputsToSave:["x"],gradFunc:function(e,t){var n=i(t,1)[0];return{x:function(){return Cm(e,rg(Lg(ng(1),ag(hf(n,"float32")))))}}}},rk={kernelName:du,inputsToSave:["x"],gradFunc:function(e,t){var n=i(t,1)[0];return{x:function(){var t=rg(Im(ng(1),ag(hf(n,"float32"))));return Cm(e,t)}}}},ak={kernelName:fu,inputsToSave:["a","b"],gradFunc:function(e,t){var n=i(t,2),r=n[0],a=n[1],o=Uf(r.shape,a.shape);return{a:function(){var t=Im(ag(r),ag(a)),n=Mm(e,Cm(a,t)),i=Vf(r.shape,o);return i.length>0&&(n=ig(n,i)),nv(n,r.shape)},b:function(){var t=Im(ag(r),ag(a)),n=zf(Mm(e,Cm(r,t))),i=Vf(a.shape,o);return i.length>0&&(n=ig(n,i)),nv(n,a.shape)}}}},ik={kernelName:hu,inputsToSave:["x"],gradFunc:function(e,t){var n=i(t,1)[0];return{x:function(){return Cm(e,Im(ag(hf(n,"float32")),1))}}}},ok={kernelName:pu,inputsToSave:["x"],gradFunc:function(e,t){var n=i(t,1)[0];return{x:function(){return Cm(e,Lg(ng(1),ag(hf(n,"float32"))))}}}};var sk=np({avgPool3dGrad_:function(e,t,n,r,a,i){var o=$h(e,"dy","avgPool3dGrad"),s=$h(t,"input","avgPool3dGrad"),u=o,c=s,l=!1;4===s.rank&&(l=!0,u=nv(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=nv(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),ls(5===u.rank,(function(){return"Error in avgPool3dGrad: dy must be rank 5 but got rank ".concat(u.rank,".")})),ls(5===c.rank,(function(){return"Error in avgPool3dGrad: input must be rank 5 but got rank ".concat(c.rank,".")})),tv("avgPool3dGrad",a,i);var d={dy:u,input:c},h={filterSize:n,strides:r,pad:a,dimRoundingMode:i},p=Bh.runKernel(yu,d,h);return l?nv(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}}),uk={kernelName:gu,inputsToSave:["x"],gradFunc:function(e,t,n){var r=i(t,1)[0],a=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode;return{x:function(){return sk(e,r,a,o,s,u)}}}};var ck=np({avgPoolGrad_:function(e,t,n,r,a){var i=$h(e,"dy","avgPoolGrad"),o=$h(t,"input","avgPoolGrad");ls(o.rank===i.rank,(function(){return"Rank of input (".concat(o.rank,") does not match rank of dy (").concat(i.rank,")")}));var s=o,u=i,c=!1;3===o.rank&&(c=!0,s=nv(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=nv(i,[1,i.shape[0],i.shape[1],i.shape[2]])),ls(4===u.rank,(function(){return"Error in avgPoolGrad: dy must be rank 4 but got rank ".concat(u.rank,".")})),ls(4===s.rank,(function(){return"Error in avgPoolGrad: input must be rank 4 but got rank ".concat(s.rank,".")}));var l={dy:u,input:s},d={filterSize:n,strides:r,pad:a},h=Bh.runKernel(vu,l,d);return c?nv(h,[h.shape[1],h.shape[2],h.shape[3]]):h}}),lk={kernelName:mu,inputsToSave:["x"],gradFunc:function(e,t,n){var r=i(t,1)[0],a=n.filterSize,o=n.strides,s=n.pad;return{x:function(){return ck(e,r,a,o,s)}}}},dk={kernelName:bu,inputsToSave:["a","b"],gradFunc:function(e,t,n){var r=i(t,2),a=r[0],o=r[1],s=n.transposeA,u=n.transposeB;return s||u?!s&&u?{a:function(){return Ef(e,o,!1,!1)},b:function(){return Ef(e,a,!0,!1)}}:s&&!u?{a:function(){return Ef(o,e,!1,!0)},b:function(){return Ef(a,e,!1,!1)}}:{a:function(){return Ef(o,e,!0,!0)},b:function(){return Ef(e,a,!0,!0)}}:{a:function(){return Ef(e,o,!1,!0)},b:function(){return Ef(a,e,!0,!1)}}}},hk={kernelName:xu,gradFunc:function(e,t,n){var r=n.blockShape,a=n.crops;return{x:function(){return qg(e,r,a)}}}},pk={kernelName:ku,gradFunc:function(e,t,n){for(var r=n,a=r.inputShape,i=r.shape,o=Array.from(i),s=a.length-1;s>=0;s--)if(a[s]===i[s])o[s]=1;else if(1!==a[s])throw new Error("broadcastTo(): [".concat(a,"] cannot be broadcast to [").concat(i,"]."));for(var u=[],c=0;c<o.length;c++)o[c]>1&&u.push(c);return{x:function(){return ig(e,u,!0)}}}},fk={kernelName:Tu,gradFunc:function(e){return{x:function(){return e.clone()}}}},mk={kernelName:_u,gradFunc:function(e){return{x:function(){return Wv(e)}}}},vk={kernelName:Iu,inputsToSave:["x"],gradFunc:function(e,t,n){var r=i(t,1)[0],a=n.clipValueMin,o=n.clipValueMax;return{x:function(){return Gv(Dg(gg(r,a),Sg(r,o)),e,Wv(e))}}}},gk={kernelName:Cu,inputsToSave:["x"],gradFunc:Yw.gradFunc},yk={kernelName:Mu,saveAllInputs:!0,gradFunc:function(e,t,n){var r=t.map((function(e){return e.shape})),a=ws(n.axis,t[0].shape)[0],i=r.map((function(e){return e[a]}));return Qy(e,i,a).map((function(e){return function(){return e}}))}},bk={kernelName:Nu,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=i(t,2),a=r[0],o=r[1],s=n.dilations,u=n.strides,c=n.pad,l=n.dataFormat;return ls(qm(s),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(s,"'")})),{x:function(){return Iv(a.shape,e,o,u,c,l)},filter:function(){return vb(a,e,o.shape,u,c,l)}}}},xk={kernelName:Lu,inputsToSave:["dy","filter"],gradFunc:function(e,t,n){var r=i(t,2),a=r[0],o=r[1],s=n.strides,u=n.pad,c=n.dataFormat,l=n.dimRoundingMode;return{dy:function(){return Tv(e,o,s,u,c,1,l)},filter:function(){return vb(e,a,o.shape,s,u,c,l)}}}};var wk=np({conv3DBackpropFilter_:function(e,t,n,r,a){var i=e;4===e.rank&&(i=nv(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));var o=t;4===o.rank&&(o=nv(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),ls(5===i.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape ".concat(i.shape,".")})),ls(5===o.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape ".concat(o.shape,".")})),ls(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got ".concat(n,".")})),ls(i.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must match input depth in filter (").concat(n[3],".")})),ls(o.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy (".concat(o.shape[4],") must match output depth for filter (").concat(n[4],").")}));var s={x:i,dy:o},u={strides:r,pad:a,filterShape:n};return Bh.runKernel(Pu,s,u)}}),kk={kernelName:Au,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,o=n.pad;ls(qm(r),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(r,"'")}));var s=i(t,2),u=s[0],c=s[1];return{x:function(){return Mv(u.shape,e,c,a,o)},filter:function(){return wk(u,e,c.shape,a,o)}}}},Sk={kernelName:Ou,inputsToSave:["x"],gradFunc:function(e,t){var n=i(t,1)[0];return{x:function(){return Mm(zf(Wy(hf(n,"float32"))),e)}}}},Tk={kernelName:zu,inputsToSave:["x"],gradFunc:function(e,t){var n=i(t,1)[0];return{x:function(){return Mm(Vy(hf(n,"float32")),e)}}}},_k={kernelName:Gu,inputsToSave:["x"],gradFunc:function(e,t,n){var r=i(t,1)[0],a=n.axis,o=n.exclusive,s=n.reverse;return{x:function(){var t=Qv([a],r.rank),n=Pv(e,a,o,!s);return null!=t&&(n=Gf(n,t)),n}}}},Ik={kernelName:Xu,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,o=n.pad,s=n.dimRoundingMode,u=null!==r&&void 0!==r?r:[1,1];ls(qm(u),(function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '".concat(u,"'")}));var c=i(t,2),l=c[0],d=c[1];return ls(4===l.rank,(function(){return"Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ".concat(l.rank,".")})),ls(4===d.rank,(function(){return"Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ".concat(d.rank,".")})),ls(l.shape[3]===d.shape[2],(function(){return"Error in gradient of depthwiseConv2d: number of input channels (".concat(l.shape[3],") must match the inChannels dimension in filter ").concat(d.shape[2],".")})),ls($m(a,u),(function(){return"Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ".concat(a," and dilations '").concat(u,"'.")})),tv("depthwiseConv2d",o,s),{x:function(){return Sb(l.shape,e,d,a,o,u,s)},filter:function(){return kb(l,e,d.shape,a,o,u,s)}}}},Ek={kernelName:Ku,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=i(t,2),a=r[0],o=r[1],s={x:a,filter:o,dy:e},u={x:a,filter:o,dy:e};return{x:function(){return Bh.runKernel(ju,s,n)},filter:function(){return Bh.runKernel(Yu,u,n)}}}},Ck={kernelName:qu,outputsToSave:[!0],gradFunc:function(e,t){var n={dy:e,y:i(t,1)[0]};return{x:function(){return Bh.runKernel($u,n)}}}},Mk={kernelName:ec,inputsToSave:["x"],gradFunc:function(e,t){var n=i(t,1)[0],r=Mm(cg(zf(ag(n))),2/Math.sqrt(Math.PI));return{x:function(){return Mm(e,r)}}}},Nk={kernelName:nc,outputsToSave:[!0],gradFunc:function(e,t){var n=i(t,1)[0];return{x:function(){return Mm(e,n)}}}},Rk={kernelName:rc,inputsToSave:["input"],gradFunc:function(e,t){var n=i(t,1)[0];return{input:function(){return nv(e,n.shape)}}}},Lk={kernelName:ac,inputsToSave:["x"],gradFunc:function(e,t){var n=i(t,1)[0];return{x:function(){return Mm(e,cg(n))}}}},Ak={kernelName:uc,gradFunc:function(e){return{x:function(){return Wv(e)}}}},Pk={kernelName:cc,inputsToSave:["a","b"],gradFunc:function(e,t){var n=i(t,2),r=n[0],a=n[1],o=Uf(r.shape,a.shape);return{a:function(){var t=Cm(e,hf(a,"float32")),n=Vf(r.shape,o);return n.length>0?nv(ig(t,n),r.shape):t},b:function(){var t=Mm(e,hf(r,"float32")),n=Vf(a.shape,o);n.length>0&&(t=nv(ig(t,n),a.shape));var i=ag(a);return zf(Cm(t,hf(i,"float32")))}}}},Dk={kernelName:lc,inputsToSave:["x","mean","variance","scale"],gradFunc:function(e,t,n){var r=n.varianceEpsilon,a=i(t,4),o=a[0],s=a[1],u=a[2],c=a[3],l=null!==c&&void 0!==c?c:ng(1),d=Vf(s.shape,o.shape),h=[];if(1===s.rank){for(var p=0;p<o.shape.length-1;++p)h.push(o.shape[p]);h.push(1)}var f=Lg(o,s),m=Mm(e,l),v=Oy(Im(u,ng(r))),g=Mm(Mm(Mm(v,v),v),ng(-.5));return{x:function(){return 1===s.rank?nv(Mm(Mm(e,hg(nv(v,[1,1,1,s.shape[0]]),h)),l),o.shape):nv(Mm(Mm(e,v),l),o.shape)},mean:function(){var e=Mm(Mm(v,ng(-1)),m);return 1===s.rank&&(e=ig(e,d)),nv(e,s.shape)},variance:function(){var e=Mm(Mm(g,f),m);return 1===s.rank&&(e=ig(e,d)),nv(e,s.shape)},scale:function(){var t=Mm(f,v),n=Mm(e,t);return 1===s.rank&&(n=ig(n,d)),nv(n,s.shape)},offset:function(){var t=e;return 1===s.rank&&(t=ig(t,d)),nv(t,s.shape)}}}},Ok={kernelName:dc,inputsToSave:["x","indices"],gradFunc:function(e,t,n){var r=i(t,2),a=r[0],o=r[1],s=n.axis,u=ws(s,a.shape)[0];return{x:function(){var t=a.shape,n=o.size,r=t.slice(0,u),i=r.length,c=t.slice(s,t.length).slice(1),l=c.length,d=zk(0,i),h=zk(i+1,i+1+l),p=Fk([r,[n],c]),f=nv(e,p),m=nv(o,[n]),v=Fk([[i],d,h]),g=Gf(f,v),y=cb(g,m,a.shape[u]),b=Jv(v);return y=Gf(y,b)},indices:function(){return o}}}};function zk(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function Fk(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var Gk={kernelName:fc,inputsToSave:["a","b"],gradFunc:function(e,t){var n=i(t,2),r=n[0],a=n[1];return{a:function(){return Wv(r)},b:function(){return Wv(a)}}}},Wk={kernelName:mc,gradFunc:function(e){return{x:function(){return hf(e,"float32")}}}},Vk={kernelName:yc,gradFunc:function(e){return{x:function(){return Wv(e)}}}},Uk={kernelName:bc,gradFunc:function(e){return{x:function(){return Wv(e)}}}},Xk={kernelName:xc,gradFunc:function(e){return{x:function(){return Wv(e)}}}},Bk={kernelName:wc,inputsToSave:["x"],gradFunc:function(e,t,n){var r=i(t,1)[0],a=n.alpha,o=vg(r,0);return{x:function(){return Gv(o,e,Mm(e,a))}}}},Hk={kernelName:Ic,inputsToSave:["x"],gradFunc:function(e,t){var n=i(t,1)[0];return{x:function(){return Cm(e,Im(n,1))}}}},Zk={kernelName:_c,inputsToSave:["x"],gradFunc:function(e,t){var n=i(t,1)[0];return{x:function(){return Cm(e,hf(n,"float32"))}}}},Kk={kernelName:Nc,inputsToSave:[],outputsToSave:[!0],gradFunc:function(e,t,n){var r=i(t,1)[0],a=n.axis;return{logits:function(){var t=cg(r);return Lg(e,Mm(ig(e,a,!0),t))}}}};var jk=np({localResponseNormalizationBackprop_:function(e,t,n){var r={x:e,y:t,dy:n},a={depthRadius:arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,bias:arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,alpha:arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,beta:arguments.length>6&&void 0!==arguments[6]?arguments[6]:.5};return Bh.runKernel(Lc,r,a)}}),Yk={kernelName:Rc,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=i(t,2),a=r[0],o=r[1],s=n.depthRadius,u=n.bias,c=n.alpha,l=n.beta;return{x:function(){return jk(a,o,e,s,u,c,l)}}}};function Qk(e,t,n,r){return t.rank<n.rank&&(t=nv(t,jv(t.shape,r))),e.rank<n.rank&&(e=nv(e,jv(e.shape,r))),{x:function(){return Mm(e,hf(Fv(n,t),e.dtype))}}}var Jk={kernelName:Ac,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.reductionIndices,a=t[0],i=Qk(e,t[1],a,ws(r,a.shape));return{x:function(){return i.x()}}}},qk={kernelName:Pc,inputsToSave:["a","b"],gradFunc:function(e,t){var n=i(t,2),r=n[0],a=n[1];return{a:function(){return Mm(e,hf(gg(r,a),"float32"))},b:function(){return Mm(e,hf(kg(r,a),"float32"))}}}};var $k=np({maxPool3dGrad_:function(e,t,n,r,a,i,o){var s=$h(e,"dy","maxPool3dGrad"),u=$h(t,"input","maxPool3dGrad"),c=$h(n,"output","maxPool3dGrad"),l=s,d=u,h=c,p=!1;4===u.rank&&(p=!0,l=nv(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),d=nv(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),h=nv(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),ls(5===l.rank,(function(){return"Error in maxPool3dGrad: dy must be rank 5 but got rank ".concat(l.rank,".")})),ls(5===d.rank,(function(){return"Error in maxPool3dGrad: input must be rank 5 but got rank ".concat(d.rank,".")})),ls(5===h.rank,(function(){return"Error in maxPool3dGrad: output must be rank 5 but got rank ".concat(h.rank,".")})),tv("maxPool3dGrad",i,o);var f={dy:l,input:d,output:h},m={filterSize:r,strides:a,pad:i,dimRoundingMode:o},v=Bh.runKernel(Fc,f,m);return p?nv(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}}),eS={kernelName:zc,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=i(t,2),a=r[0],o=r[1],s=n.filterSize,u=n.strides,c=n.pad,l=n.dimRoundingMode;return{x:function(){return $k(e,a,o,s,u,c,l)}}}};var tS=np({maxPoolGrad_:function(e,t,n,r,a,i,o){var s=$h(e,"dy","maxPoolGrad"),u=$h(t,"input","maxPoolGrad"),c=$h(n,"output","maxPoolGrad");ls(u.rank===s.rank,(function(){return"Rank of input (".concat(u.rank,") does not match rank of dy (").concat(s.rank,")")})),ls(4===s.rank,(function(){return"Error in maxPoolGrad: dy must be rank 4 but got rank ".concat(s.rank,".")})),ls(4===u.rank,(function(){return"Error in maxPoolGrad: input must be rank 4 but got rank ".concat(u.rank,".")})),tv("maxPoolGrad",i,o);var l={dy:s,input:u,output:c},d={filterSize:r,strides:a,pad:i,dimRoundingMode:o};return Bh.runKernel(Oc,l,d)}}),nS={kernelName:Dc,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=i(t,2),a=r[0],o=r[1],s=n.filterSize,u=n.strides,c=n.pad;return{x:function(){return tS(e,a,o,s,u,c)}}}},rS={kernelName:Wc,inputsToSave:["x"],gradFunc:function(e,t,n){var r=i(t,1)[0],a=ws(n.axis,r.shape),o=fs(Kv(r.shape,a)[1]);return{x:function(){var t=r.shape.slice();a.forEach((function(e){t[e]=1}));var n=nv(e,t);return Cm(Mm(n,Bg(r.shape,"float32")),o)}}}},aS={kernelName:Vc,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.axis,a=i(t,2),o=a[0],s=Qk(e,a[1],o,ws(r,o.shape));return{x:function(){return s.x()}}}},iS={kernelName:Uc,inputsToSave:["a","b"],gradFunc:function(e,t){var n=i(t,2),r=n[0],a=n[1];return{a:function(){return Mm(e,hf(Sg(r,a),"float32"))},b:function(){return Mm(e,hf(vg(r,a),"float32"))}}}},oS={kernelName:Xc,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return sv(e,a,r.shape)}}}},sS={kernelName:Bc,inputsToSave:["a","b"],gradFunc:function(e,t){var n=i(t,2),r=n[0],a=n[1],o=Uf(r.shape,a.shape);return{a:function(){var t=Vf(r.shape,o);return t.length>0?nv(ig(e,t),r.shape):e},b:function(){var t=Mm(e,zf(fg(Cm(r,a)))),n=Vf(a.shape,o);return n.length>0?nv(ig(t,n),a.shape):t}}}},uS={kernelName:Zc,inputsToSave:["a","b"],gradFunc:function(e,t){var n=i(t,2),r=n[0],a=n[1],o=Uf(r.shape,a.shape);return{a:function(){var t=Mm(e,hf(a,"float32")),n=Vf(r.shape,o);return n.length>0?nv(ig(t,n),r.shape):t},b:function(){var t=Mm(e,hf(r,"float32")),n=Vf(a.shape,o);return n.length>0?nv(ig(t,n),a.shape):t}}}},cS={kernelName:Kc,gradFunc:function(e){return{x:function(){return zf(e)}}}},lS={kernelName:$c,inputsToSave:["indices"],gradFunc:function(e,t){var n=t[0];return{indices:function(){return Xg(n.shape,"float32")}}}},dS={kernelName:qc,gradFunc:function(e){return{x:function(){return Wv(e)}}}},hS={kernelName:el,saveAllInputs:!0,gradFunc:function(e,t,n){var r=n.axis;return lb(e,r).map((function(e){return function(){return e}}))}},pS={kernelName:tl,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return sv(e,a,r.shape)}}}},fS={kernelName:nl,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(e,t){var n=i(t,3),r=n[0],a=n[1],o=n[2],s=r,u=a,c=Uf(s.shape,u.shape);return{a:function(){var t=hf(u,"float32"),n=Mm(e,Mm(t,tg(s,Lg(t,ng(1))))),r=Vf(s.shape,c);return r.length>0&&(n=ig(n,r)),nv(n,s.shape)},b:function(){var t=vg(s,0),n=Gv(t,_g(s),Wv(s)),r=Mm(e,Mm(o,n)),a=Vf(u.shape,c);return a.length>0&&(r=ig(r,a)),nv(r,u.shape)}}}},mS={kernelName:rl,inputsToSave:["x","alpha"],gradFunc:function(e,t){var n=i(t,2),r=n[0],a=n[1],o=vg(r,0);return{x:function(){return Gv(o,e,Mm(e,a))},alpha:function(){var t=Gv(o,Wv(e),Mm(e,r)),n=Vf(a.shape,e.shape);return n.length>0&&(t=ig(t,n)),nv(t,a.shape)}}}};function vS(e,t,n){var r=e.shape.length,a=r-n.length,i=Qv(n,r),o=e;null!=i&&(o=Gf(e,i));var s=o.shape.slice(),u=s.splice(r-n.length,n.length).reduce((function(e,t){return e*t}),1);s.push(u);var c=function(e,t,n){var r=e.shape.slice();r[n]=1;var a=nv(t,r),i=Av(e,n,!0,!1),o=Av(e,n,!0,!0),s=Mm(i,o);return Mm(a,s)}(o.reshape(s),t,a);if(c=c.reshape(o.shape),null!=i){var l=Jv(i);c=Gf(c,l)}return c}var gS={kernelName:al,inputsToSave:["x"],gradFunc:function(e,t,n){var r=i(t,1)[0],a=n.axis,o=[];return o=null==a?r.shape.map((function(e,t){return t})):"number"==typeof a?[a]:a,{x:function(){return vS(r,e,o)}}}},yS={kernelName:Qu,inputsToSave:["a","b"],gradFunc:function(e,t){var n=i(t,2),r=n[0],a=n[1],o=Uf(r.shape,a.shape);return{a:function(){var t=Cm(e,hf(a,"float32")),n=Vf(r.shape,o);return n.length>0?nv(ig(t,n),r.shape):t},b:function(){var t=Mm(e,hf(r,"float32")),n=Vf(a.shape,o);n.length>0&&(t=nv(ig(t,n),a.shape));var i=ag(a);return zf(Cm(t,hf(i,"float32")))}}}},bS={kernelName:cl,inputsToSave:["x"],gradFunc:function(e,t){var n=i(t,1)[0];return{x:function(){return Cm(e,zf(ag(n)))}}}},xS={kernelName:vl,inputsToSave:["x"],gradFunc:function(e,t){var n=i(t,1)[0],r=Mm(Sg(n,6),tb(n));return{x:function(){return Mm(e,hf(r,"float32"))}}}},wS={kernelName:ll,inputsToSave:["x"],gradFunc:function(e,t){var n=i(t,1)[0];return{x:function(){return Mm(e,hf(tb(n),"float32"))}}}},kS={kernelName:dl,inputsToSave:["x"],gradFunc:function(e,t){var n=i(t,1)[0];return{x:function(){return nv(e,n.shape)}}}},SS={kernelName:fl,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:i(t,1)[0]};return{images:function(){return Bh.runKernel(ml,r,n)}}}},TS={kernelName:hl,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:i(t,1)[0]};return{images:function(){return Bh.runKernel(pl,r,n)}}}},_S={kernelName:gl,gradFunc:function(e,t,n){var r=ws(n.dims,e.shape);return{x:function(){return Py(e,r)}}}},IS={kernelName:yl,gradFunc:function(e){return{x:function(){return Wv(e)}}}},ES={kernelName:bl,inputsToSave:["x"],gradFunc:function(e,t){var n=i(t,1)[0];return{x:function(){return zf(Cm(e,Mm(tg(n,1.5),2)))}}}},CS={kernelName:kl,inputsToSave:["condition"],gradFunc:function(e,t){var n=i(t,1)[0];return{condition:function(){return hf(Wv(n),"float32")},t:function(){return Mm(e,hf(n,e.dtype))},e:function(){return Mm(e,hf(Og(n),e.dtype))}}}},MS={kernelName:Sl,inputsToSave:["x"],gradFunc:function(e,t){var n=i(t,1)[0];return{x:function(){var t=vg(n,ng(0)),r=ng(rw),a=ng(aw),i=Mm(e,a),o=Mm(Mm(e,r),cg(hf(n,"float32")));return Gv(t,i,o)}}}},NS={kernelName:Cl,outputsToSave:[!0],gradFunc:function(e,t){var n=i(t,1)[0];return{x:function(){return Mm(e,Mm(n,Lg(ng(1),n)))}}}},RS={kernelName:El,gradFunc:function(e){return{x:function(){return Wv(e)}}}},LS={kernelName:_l,inputsToSave:["x"],gradFunc:function(e,t){var n=i(t,1)[0];return{x:function(){return Mm(Rv(hf(n,"float32")),e)}}}},AS={kernelName:Il,inputsToSave:["x"],gradFunc:function(e,t){var n=i(t,1)[0];return{x:function(){return Mm(Lv(hf(n,"float32")),e)}}}},PS={kernelName:Tl,inputsToSave:["x"],gradFunc:function(e,t,n){for(var r=i(t,1)[0],a=n.begin,o=n.size,s=r.shape,u=i(ym(r,a,o),2),c=u[0],l=u[1],d=[],h=0;h<e.rank;h++)d.push([c[h],s[h]-c[h]-l[h]]);return{x:function(){return Jg(e,d)}}}},DS={kernelName:Pl,outputsToSave:[!0],gradFunc:function(e,t,n){var r=i(t,1)[0],a=n.dim,o=Mm(e,r);return{logits:function(){return Lg(o,Mm(ig(o,[a],true),r))}}}},OS={kernelName:Ml,inputsToSave:["x"],gradFunc:function(e,t){var n=i(t,1)[0];return{x:function(){return Mm(e,ov(n))}}}},zS={kernelName:Ll,gradFunc:function(e,t,n){var r=n.blockShape,a=n.paddings;return{x:function(){return cv(e,r,a)}}}},FS={kernelName:Al,gradFunc:function(e,t,n){var r=n.axis;return{x:function(){return iv(e,r)}}}},GS={kernelName:Nl,inputsToSave:["x"],gradFunc:function(e,t){var n=i(t,1)[0];return{x:function(){return Cm(e,Mm(rg(hf(n,"float32")),2))}}}},WS={kernelName:Vl,inputsToSave:["x"],gradFunc:function(e,t){var n=i(t,1)[0];return{x:function(){return Mm(e,Mm(hf(n,"float32"),2))}}}},VS={kernelName:Wl,inputsToSave:["a","b"],gradFunc:function(e,t){var n=i(t,2),r=n[0],a=n[1],o=ng(2);return{a:function(){return Mm(e,Mm(o,Lg(r,a)))},b:function(){return Mm(e,Mm(o,Lg(a,r)))}}}},US={kernelName:rd,gradFunc:function(e){return{x:function(){return Wv(e)}}}},XS={kernelName:Zl,inputsToSave:["a","b"],gradFunc:function(e,t){var n=i(t,2),r=n[0],a=n[1],o=Uf(r.shape,a.shape);return{a:function(){var t=e,n=Vf(r.shape,o);return n.length>0&&(t=ig(t,n)),nv(t,r.shape)},b:function(){var t=e,n=Vf(a.shape,o);return n.length>0&&(t=ig(t,n)),nv(zf(t),a.shape)}}}},BS={kernelName:Rl,inputsToSave:["x"],gradFunc:function(e,t,n){var r=i(t,1)[0],a=r.shape.slice();ws(n.axis,r.shape).forEach((function(e){a[e]=1}));var o=nv(e,a),s=Mm(o,Bg(r.shape,"float32"));return{x:function(){return s}}}},HS={kernelName:Kl,inputsToSave:["x"],gradFunc:function(e,t){var n=i(t,1)[0];return{x:function(){return Cm(e,ag(Rv(n)))}}}},ZS={kernelName:jl,outputsToSave:[!0],gradFunc:function(e,t){var n=i(t,1)[0];return{x:function(){return Mm(Lg(ng(1),ag(n)),e)}}}},KS={kernelName:Yl,inputsToSave:["x"],gradFunc:function(e,t,n){var r=i(t,1)[0],a=n.reps;return{x:function(){var t=Wv(r);if(1===r.rank)for(var n=0;n<a[0];++n)t=Im(t,sv(e,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(var i=0;i<a[0];++i)for(var o=0;o<a[1];++o)t=Im(t,sv(e,[i*r.shape[0],o*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(var s=0;s<a[0];++s)for(var u=0;u<a[1];++u)for(var c=0;c<a[2];++c)t=Im(t,sv(e,[s*r.shape[0],u*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-".concat(r.rank," tensors yet."));for(var l=0;l<a[0];++l)for(var d=0;d<a[1];++d)for(var h=0;h<a[2];++h)for(var p=0;p<a[3];++p)t=Im(t,sv(e,[l*r.shape[0],d*r.shape[1],h*r.shape[2],p*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},jS={kernelName:ql,gradFunc:function(e,t,n){var r=Jv(n.perm);return{x:function(){return Gf(e,r)}}}},YS={kernelName:ed,gradFunc:function(e,t,n){var r=n.axis;return{value:function(){return eb(e,r)}}}},QS={kernelName:td,inputsToSave:["segmentIds"],gradFunc:function(e,t){var n=i(t,1)[0];return{x:function(){return function(e,t){for(var n=Vg(t,Wv(t)),r=mg(e,n),a=gg(t,ng(0,"int32")),i=r.rank-a.rank,o=0;o<i;++o)a=lg(a,o+1);a=Dg(a,Bg(r.shape,"bool"));var s=Wv(r);return Gv(a,r,s)}(e,n)}}}};for(var JS={kernelName:nd,gradFunc:function(e){return{x:function(){return Wv(e)}}}},qS=0,$S=[Yw,Qw,Jw,qw,$w,ek,tk,nk,rk,ak,ik,ok,uk,lk,dk,hk,pk,fk,mk,vk,gk,yk,xk,bk,kk,Sk,Tk,_k,Ik,Ek,yS,Ck,Mk,Nk,Rk,Lk,Pk,Ak,Dk,Ok,Gk,Wk,Vk,Uk,Xk,Bk,Hk,Zk,Kk,Yk,Jk,Jk,qk,eS,nS,rS,aS,iS,oS,sS,uS,cS,lS,dS,hS,pS,pS,fS,mS,gS,bS,xS,wS,kS,SS,TS,_S,IS,ES,CS,MS,NS,RS,LS,AS,PS,DS,OS,zS,zS,FS,FS,GS,VS,WS,US,XS,BS,HS,ZS,KS,jS,YS,QS,JS];qS<$S.length;qS++){vd($S[qS])}Sh().prototype.abs=function(){return this.throwIfDisposed(),Nm(this)},Sh().prototype.acos=function(){return this.throwIfDisposed(),Rm(this)},Sh().prototype.acosh=function(){return this.throwIfDisposed(),Lm(this)},Sh().prototype.add=function(e){return this.throwIfDisposed(),Im(this,e)},Sh().prototype.all=function(e,t){return this.throwIfDisposed(),Am(this,e,t)},Sh().prototype.any=function(e,t){return this.throwIfDisposed(),Pm(this,e,t)},Sh().prototype.argMax=function(e){return this.throwIfDisposed(),Dm(this,e)},Sh().prototype.argMin=function(e){return this.throwIfDisposed(),Om(this,e)},Sh().prototype.asScalar=function(){return this.throwIfDisposed(),ls(1===this.size,(function(){return"The array must have only 1 element."})),nv(this,[])},Sh().prototype.asType=function(e){return this.throwIfDisposed(),hf(this,e)},Sh().prototype.as1D=function(){return this.throwIfDisposed(),nv(this,[this.size])},Sh().prototype.as2D=function(e,t){return this.throwIfDisposed(),nv(this,[e,t])},Sh().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),nv(this,[e,t,n])},Sh().prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),nv(this,[e,t,n,r])},Sh().prototype.as5D=function(e,t,n,r,a){return this.throwIfDisposed(),nv(this,[e,t,n,r,a])},Sh().prototype.asin=function(){return this.throwIfDisposed(),zm(this)},Sh().prototype.asinh=function(){return this.throwIfDisposed(),Fm(this)},Sh().prototype.atan=function(){return this.throwIfDisposed(),Gm(this)},Sh().prototype.atan2=function(e){return this.throwIfDisposed(),Wm(this,e)},Sh().prototype.atanh=function(){return this.throwIfDisposed(),Vm(this)},Sh().prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),rv(this,e,t,n,r)},Sh().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),cv(this,e,t)},Sh().prototype.batchNorm=function(e,t,n,r,a){return this.throwIfDisposed(),dv(this,e,t,n,r,a)},Sh().prototype.broadcastTo=function(e){return this.throwIfDisposed(),vv(this,e)},Sh().prototype.cast=function(e){return this.throwIfDisposed(),hf(this,e)},Sh().prototype.ceil=function(){return this.throwIfDisposed(),gv(this)},Sh().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),bv(this,e,t)},Sh().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof kh&&(e=[e]),iv([this].concat(b(e)),t)},Sh().prototype.conv1d=function(e,t,n,r,a,i){return this.throwIfDisposed(),_v(this,e,t,n,r,a,i)},Sh().prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),Ev(this,e,t,n,r,a)},Sh().prototype.conv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),Tv(this,e,t,n,r,a,i)},Sh().prototype.cos=function(){return this.throwIfDisposed(),Rv(this)},Sh().prototype.cosh=function(){return this.throwIfDisposed(),Lv(this)},Sh().prototype.cumprod=function(e,t,n){return this.throwIfDisposed(),Av(this,e,t,n)},Sh().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),Pv(this,e,t,n)},Sh().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),Dv(this,e,t)},Sh().prototype.depthwiseConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),Ov(this,e,t,n,r,a,i)},Sh().prototype.dilation2d=function(e,t,n,r,a){return this.throwIfDisposed(),zv(this,e,t,n,r,a)},Sh().prototype.divNoNan=function(e){return this.throwIfDisposed(),Vv(this,e)},Sh().prototype.div=function(e){return this.throwIfDisposed(),Cm(this,e)},Sh().prototype.dot=function(e){return this.throwIfDisposed(),Uv(this,e)},Sh().prototype.elu=function(){return this.throwIfDisposed(),Xv(this)},Sh().prototype.equal=function(e){return this.throwIfDisposed(),Fv(this,e)},Sh().prototype.erf=function(){return this.throwIfDisposed(),Bv(this)},Sh().prototype.euclideanNorm=function(e,t){return this.throwIfDisposed(),ug(this,e,t)},Sh().prototype.exp=function(){return this.throwIfDisposed(),cg(this)},Sh().prototype.expandDims=function(e){return this.throwIfDisposed(),lg(this,e)},Sh().prototype.expm1=function(){return this.throwIfDisposed(),dg(this)},Sh().prototype.fft=function(){return this.throwIfDisposed(),Ky(this)},Sh().prototype.flatten=function(){return this.throwIfDisposed(),nv(this,[this.size])},Sh().prototype.floor=function(){return this.throwIfDisposed(),fg(this)},Sh().prototype.floorDiv=function(e){return this.throwIfDisposed(),Em(this,e)},Sh().prototype.gather=function(e,t){return this.throwIfDisposed(),mg(this,e,t)},Sh().prototype.greaterEqual=function(e){return this.throwIfDisposed(),gg(this,e)},Sh().prototype.greater=function(e){return this.throwIfDisposed(),vg(this,e)},Sh().prototype.ifft=function(){return this.throwIfDisposed(),jy(this)},Sh().prototype.irfft=function(){return this.throwIfDisposed(),Yy(this)},Sh().prototype.isFinite=function(){return this.throwIfDisposed(),yg(this)},Sh().prototype.isInf=function(){return this.throwIfDisposed(),bg(this)},Sh().prototype.isNaN=function(){return this.throwIfDisposed(),xg(this)},Sh().prototype.leakyRelu=function(e){return this.throwIfDisposed(),wg(this,e)},Sh().prototype.lessEqual=function(e){return this.throwIfDisposed(),Sg(this,e)},Sh().prototype.less=function(e){return this.throwIfDisposed(),kg(this,e)},Sh().prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),Tg(this,e,t,n,r)},Sh().prototype.logSigmoid=function(){return this.throwIfDisposed(),Rg(this)},Sh().prototype.logSoftmax=function(e){return this.throwIfDisposed(),Ag(this,e)},Sh().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),Pg(this,e,t)},Sh().prototype.log=function(){return this.throwIfDisposed(),_g(this)},Sh().prototype.log1p=function(){return this.throwIfDisposed(),Ig(this)},Sh().prototype.logicalAnd=function(e){return this.throwIfDisposed(),Dg(this,e)},Sh().prototype.logicalNot=function(){return this.throwIfDisposed(),Og(this)},Sh().prototype.logicalOr=function(e){return this.throwIfDisposed(),zg(this,e)},Sh().prototype.logicalXor=function(e){return this.throwIfDisposed(),Fg(this,e)},Sh().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),Ef(this,e,t,n)},Sh().prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),Gg(this,e,t,n,r)},Sh().prototype.max=function(e,t){return this.throwIfDisposed(),$v(this,e,t)},Sh().prototype.maximum=function(e){return this.throwIfDisposed(),Vg(this,e)},Sh().prototype.mean=function(e,t){return this.throwIfDisposed(),Ug(this,e,t)},Sh().prototype.min=function(e,t){return this.throwIfDisposed(),eg(this,e,t)},Sh().prototype.minimum=function(e){return this.throwIfDisposed(),Hg(this,e)},Sh().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),Zg(this,e,t)},Sh().prototype.mod=function(e){return this.throwIfDisposed(),Kg(this,e)},Sh().prototype.mul=function(e){return this.throwIfDisposed(),Mm(this,e)},Sh().prototype.neg=function(){return this.throwIfDisposed(),zf(this)},Sh().prototype.norm=function(e,t,n){return this.throwIfDisposed(),sg(this,e,t,n)},Sh().prototype.notEqual=function(e){return this.throwIfDisposed(),Yg(this,e)},Sh().prototype.oneHot=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.throwIfDisposed(),Cf(this,e,t,n)},Sh().prototype.onesLike=function(){return this.throwIfDisposed(),Qg(this)},Sh().prototype.pad=function(e,t){return this.throwIfDisposed(),Jg(this,e,t)},Sh().prototype.pool=function(e,t,n,r,a,i){return this.throwIfDisposed(),$g(this,e,t,n,r,a,i)},Sh().prototype.pow=function(e){return this.throwIfDisposed(),tg(this,e)},Sh().prototype.prelu=function(e){return this.throwIfDisposed(),ey(this,e)},Sh().prototype.prod=function(e,t){return this.throwIfDisposed(),ty(this,e,t)},Sh().prototype.reciprocal=function(){return this.throwIfDisposed(),Ry(this)},Sh().prototype.relu=function(){return this.throwIfDisposed(),Ly(this)},Sh().prototype.relu6=function(){return this.throwIfDisposed(),Ay(this)},Sh().prototype.reshapeAs=function(e){return this.throwIfDisposed(),nv(this,e.shape)},Sh().prototype.reshape=function(e){return this.throwIfDisposed(),nv(this,e)},Sh().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),qb(this,e,t,n)},Sh().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),$b(this,e,t,n)},Sh().prototype.reverse=function(e){return this.throwIfDisposed(),Py(this,e)},Sh().prototype.rfft=function(){return this.throwIfDisposed(),Jy(this)},Sh().prototype.round=function(){return this.throwIfDisposed(),Dy(this)},Sh().prototype.rsqrt=function(){return this.throwIfDisposed(),Oy(this)},Sh().prototype.selu=function(){return this.throwIfDisposed(),zy(this)},Sh().prototype.separableConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),Fy(this,e,t,n,r,a,i)},Sh().prototype.sigmoid=function(){return this.throwIfDisposed(),ov(this)},Sh().prototype.sign=function(){return this.throwIfDisposed(),Gy(this)},Sh().prototype.sin=function(){return this.throwIfDisposed(),Wy(this)},Sh().prototype.sinh=function(){return this.throwIfDisposed(),Vy(this)},Sh().prototype.slice=function(e,t){return this.throwIfDisposed(),sv(this,e,t)},Sh().prototype.softmax=function(e){return this.throwIfDisposed(),Zy(this,e)},Sh().prototype.softplus=function(){return this.throwIfDisposed(),Ng(this)},Sh().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),qg(this,e,t)},Sh().prototype.split=function(e,t){return this.throwIfDisposed(),Qy(this,e,t)},Sh().prototype.sqrt=function(){return this.throwIfDisposed(),rg(this)},Sh().prototype.square=function(){return this.throwIfDisposed(),ag(this)},Sh().prototype.squaredDifference=function(e){return this.throwIfDisposed(),qy(this,e)},Sh().prototype.squeeze=function(e){return this.throwIfDisposed(),$y(this,e)},Sh().prototype.stack=function(e,t){this.throwIfDisposed();var n=e instanceof kh?[this,e]:[this].concat(b(e));return eb(n,t)},Sh().prototype.step=function(e){return this.throwIfDisposed(),tb(this,e)},Sh().prototype.stridedSlice=function(e,t,n,r,a,i,o,s){return this.throwIfDisposed(),nb(this,e,t,n,r,a,i,o,s)},Sh().prototype.sub=function(e){return this.throwIfDisposed(),Lg(this,e)},Sh().prototype.sum=function(e,t){return this.throwIfDisposed(),ig(this,e,t)},Sh().prototype.tan=function(){return this.throwIfDisposed(),rb(this)},Sh().prototype.tanh=function(){return this.throwIfDisposed(),uv(this)},Sh().prototype.tile=function(e){return this.throwIfDisposed(),hg(this,e)},Sh().prototype.toBool=function(){return this.throwIfDisposed(),hf(this,"bool")},Sh().prototype.toFloat=function(){return this.throwIfDisposed(),hf(this,"float32")},Sh().prototype.toInt=function(){return this.throwIfDisposed(),hf(this,"int32")},Sh().prototype.topk=function(e,t){return this.throwIfDisposed(),ob(this,e,t)},Sh().prototype.transpose=function(e){return this.throwIfDisposed(),Gf(this,e)},Sh().prototype.unique=function(e){return this.throwIfDisposed(),ub(this,e)},Sh().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),cb(this,e,t)},Sh().prototype.unstack=function(e){return this.throwIfDisposed(),lb(this,e)},Sh().prototype.where=function(e,t){return this.throwIfDisposed(),Gv(e,this,t)},Sh().prototype.zerosLike=function(){return this.throwIfDisposed(),Wv(this)};var eT=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),r=t.call(this,e),Object.setPrototypeOf(h(r),n.prototype),r}return E(n)}(M(Error)),tT=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),r=t.call(this,e),Object.setPrototypeOf(h(r),n.prototype),r}return E(n)}(M(Error)),nT=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),r=t.call(this,e),Object.setPrototypeOf(h(r),n.prototype),r}return E(n)}(M(Error)),rT=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),r=t.call(this,e),Object.setPrototypeOf(h(r),n.prototype),r}return E(n)}(M(Error)),aT=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),r=t.call(this,e),Object.setPrototypeOf(h(r),n.prototype),r}return E(n)}(M(Error)),iT=function(){function e(t){T(this,e),this.maxEntries=t||100,this.cache=new Map}return E(e,[{key:"get",value:function(e){var t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}},{key:"put",value:function(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){var n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,t)}},{key:"getMaxEntries",value:function(){return this.maxEntries}},{key:"setMaxEntries",value:function(e){if(e<0)throw new Error("The maxEntries of LRU caches must be at least 0, but got ".concat(e,"."));if(this.maxEntries>e)for(var t=0;t<this.maxEntries-e;t++){var n=this.cache.keys().next().value;this.cache.delete(n)}this.maxEntries=e}}]),e}();function oT(e,t){if(Array.isArray(e)){for(var n=[],r=0;r<t;r++)n=n.concat(e);return n}var a=new Array(t);return a.fill(e),a}function sT(e,t){if(!e)throw new aT(t)}function uT(e,t){var n,r=0,a=x(e);try{for(a.s();!(n=a.n()).done;){n.value===t&&r++}}catch(i){a.e(i)}finally{a.f()}return r}function cT(e){return 1===e.length?e[0]:e}function lT(e){return Array.isArray(e)?e:[e]}function dT(e){var t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function hT(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,(function(e,t){return t.toUpperCase()}))}var pT={};function fT(e){if(null==e)return null;var t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function mT(e){if(null!=e&&"object"==typeof e)if(Array.isArray(e))e.forEach((function(e){return mT(e)}));else for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],a=e[r];null!=a&&"object"==typeof a&&(Array.isArray(a)||"ndarray"!==a.type||"number"!=typeof a.value?mT(a):e[r]=a.value)}}function vT(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"object",a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("string"==typeof e){var o,s=e;if(s in n)o=n[s];else if(s in pT)o=pT[s];else if(null==(o=t[s]))throw new nT("Unknown ".concat(r,": ").concat(e,". This may be due to one of the following reasons:\n1. The ").concat(r," is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ").concat(r," is defined in JavaScript, but is not registered properly with tf.serialization.registerClass()."));return o}var u,c,l,d=e;if(null==d.className||null==d.config)throw new nT("".concat(r,": Improper config format: ").concat(JSON.stringify(d),".\n'className' and 'config' must set."));var h,p,f=d.className;if(f in n?(h=(u=i(n[f],2))[0],p=u[1]):f in pT?(h=(c=i(pT.className,2))[0],p=c[1]):f in t&&(h=(l=i(t[f],2))[0],p=l[1]),null==h)throw new nT("Unknown ".concat(r,": ").concat(f,". This may be due to one of the following reasons:\n1. The ").concat(r," is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ").concat(r," is defined in JavaScript, but is not registered properly with tf.serialization.registerClass()."));if(null!=p){for(var m={},v=0,g=Object.keys(pT);v<g.length;v++){var y=g[v];m[y]=pT[y]}for(var b=0,x=Object.keys(n);b<x.length;b++){var w=x[b];m[w]=n[w]}d.config.customObjects=m;for(var k=Object.assign({},pT),S=0,T=Object.keys(n);S<T.length;S++){var _=T[S];pT[_]=n[_]}mT(d.config);var I=p(h,d.config,n,a);return pT=Object.assign({},k),I}for(var E=Object.assign({},pT),C=0,M=Object.keys(n);C<M.length;C++){var N=M[C];pT[N]=n[N]}var R=new h(d.config);return pT=Object.assign({},E),R}function gT(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function yT(e){if(null==e)return e;var t,n=[],r=x(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;-1===n.indexOf(a)&&n.push(a)}}catch(i){r.e(i)}finally{r.f()}return n}function bT(e){if(null==e)throw new nT("Invalid value in obj: ".concat(JSON.stringify(e)));for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function xT(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new nT("".concat(n," is not a valid ").concat(t,".  Valid values are ").concat(e," or null/undefined."))}function wT(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return sT(n>=0),sT(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every((function(e){return typeof e===t}))}function kT(e,t){Array.isArray(e)?(ls(e.length>0,(function(){return"".concat(t," is unexpectedly an empty array.")})),e.forEach((function(e,n){return kT(e,"element ".concat(n+1," of ").concat(t))}))):ls(Number.isInteger(e)&&e>0,(function(){return"Expected ".concat(t," to be a positive integer, but got ").concat(ST(e),".")}))}function ST(e){return null===e?"null":Array.isArray(e)?"["+e.map((function(e){return ST(e)})).join(",")+"]":"string"==typeof e?'"'.concat(e,'"'):"".concat(e)}function TT(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}var _T=0;function IT(){return _T++}var ET={};function CT(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e in ET||(ET[e]=0),ET[e]+=1,e+ET[e].toString()}var MT=["channelsFirst","channelsLast"],NT=["nearest","bilinear"],RT=["valid","same","causal"],LT=["max","avg"],AT=["sum","mul","concat","ave"],PT=new Map;function DT(e){xT(MT,"DataFormat",e)}function OT(e){xT(RT,"PaddingMode",e)}function zT(e){xT(LT,"PoolMode",e)}var FT=[],GT="/";function WT(e,t){FT.push(e);try{var n=t();return FT.pop(),n}catch(n){throw FT.pop(),n}}function VT(e){if(!HT(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===FT.length?"":FT.join(GT)+GT)+e}function UT(e){if(!HT(e))throw new Error("Not a valid tensor name: '"+e+"'");PT.has(e)||PT.set(e,0);var t=PT.get(e);if(PT.set(e,PT.get(e)+1),t>0){var n="".concat(e,"_").concat(t);return PT.set(n,1),n}return e}var XT,BT=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function HT(e){return!!e.match(BT)}function ZT(e){return e===parseInt(e.toString(),10)}function KT(e,t,n){null==t&&(t=0),null==n&&(n=e.length);for(var r=1,a=t;a<n;++a)r*=e[a];return r}function jT(e){if(0===e.length)return Number.NaN;for(var t=Number.POSITIVE_INFINITY,n=0;n<e.length;n++){var r=e[n];r<t&&(t=r)}return t}function YT(e){if(0===e.length)return Number.NaN;for(var t=Number.NEGATIVE_INFINITY,n=0;n<e.length;n++){var r=e[n];r>t&&(t=r)}return t}function QT(e,t){if(t<e)throw new nT("end (".concat(t,") < begin (").concat(e,") is forbidden."));for(var n=[],r=e;r<t;++r)n.push(r);return n}function JT(){return null==XT&&(XT=Df().epsilon()),XT}function qT(e,t){return hf(e,t)}function $T(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),nv(e,n)}function e_(e,t,n){return Rf((function(){switch(e.rank){case 1:return Uy(e,t,n);case 2:return Xy(e,[t,0],[n,e.shape[1]]);case 3:return By(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return Hy(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return sv(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return sv(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new nT("sliceAlongFirstAxis() received an unsupported tensor rank: ".concat(e.rank))}}))}function t_(e,t,n){return Rf((function(){switch(e.rank){case 1:return Uy(e,t,n);case 2:return Xy(e,[0,t],[e.shape[0],n]);case 3:return By(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return Hy(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new nT("sliceAlongLastAxis() received an unsupported tensor rank: ".concat(e.rank))}}))}function n_(e,t,n,r){return Rf((function(){switch(e.rank){case 1:return Uy(e,t,n);case 2:switch(r){case 1:return e_(e,t,n);case 2:return t_(e,t,n);default:throw new nT("The axis is not within the rank of the tensor ".concat(r))}case 3:switch(r){case 1:return e_(e,t,n);case 2:return By(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return t_(e,t,n);default:throw new nT("The axis is not within the rank of the tensor ".concat(r))}case 4:switch(r){case 1:return e_(e,t,n);case 2:return Hy(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return Hy(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return t_(e,t,n);default:throw new nT("The axis is not within the rank of the tensor ".concat(r))}default:throw new nT("sliceAlongLastAxis() received an unsupported tensor rank: ".concat(e.rank))}}))}function r_(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return n<0&&(n=0!==(t=e[0].rank)?t:0),n===e[0].rank&&(n=-1),iv(e,n)}function a_(e,t){switch(e.rank){case 1:return xv([e,t]);case 2:return wv([e,t],0);case 3:return kv([e,t],0);case 4:return Sv([e,t],0);default:throw new nT("concatAlongFirstAxis() received an unsupported tensor rank: ".concat(e.rank))}}function i_(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new nT("The length of input n (".concat(t.length,") does not match the number of dimensions in input x (").concat(e.rank,")"));return hg(e,t)}function o_(e){return Cy(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0)}function s_(e,t,n,r){if(e.rank<2||t.rank<2)throw new rT("dot requires both inputs to be rank >= 2 but got x shape = ".concat(e.shape," and y shape = ").concat(t.shape));if(t.rank>=3&&e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new rT("If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ".concat(e.shape," and  y shape = ").concat(t.shape));if(2===e.rank&&2===t.rank)return Tb({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?l_(e.rank,r,"channelsLast"):null,activation:n});var a=e.shape.slice(),i=a.pop();e=nv(e,[-1,i]);var o=t.shape.slice(),s=o.pop(),u=o.pop(),c=[].concat(b(o),[s]),l=Array.from({length:t.rank},(function(e,n){return 0===n?t.rank-2:n<=t.rank-2?n-1:n}));t=nv(Gf(t,l),[u,-1]);var d=[].concat(b(a),b(c));return nv(Tb({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?l_(e.rank,r,"channelsLast"):null,activation:n}),d)}function u_(e,t,n){return Rf((function(){return t=Array.isArray(t)?ab(t,"int32"):hf(t,"int32"),mg(e,t,n)}))}function c_(e){return Mm(e,e)}function l_(e,t,n){var r=t.shape;if(1!==t.rank&&t.rank!==e)throw new nT("Unexpected bias dimensions: ".concat(t.rank,"; expected it to be 1 or ").concat(e));if(5===e){if("channelsFirst"===n)return 1===r.length?nv(t,[1,r[0],1,1,1]):nv(t,[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return 1===r.length?nv(t,[1,1,1,1,r[0]]):nv(t,[1].concat(r))}else if(4===e){if("channelsFirst"===n)return 1===r.length?nv(t,[1,r[0],1,1]):nv(t,[1,r[2],r[0],r[1]]);if("channelsLast"===n)return 1===r.length?nv(t,[1,1,1,r[0]]):nv(t,[1].concat(r))}else if(3===e){if("channelsFirst"===n)return 1===r.length?nv(t,[1,r[0],1]):nv(t,[1,r[1],r[0]]);if("channelsLast"===n)return 1===r.length?nv(t,[1,1,r[0]]):nv(t,[1].concat(r))}else if(e<3)return t;throw new nT("Unsupported input rank by biasAdd: ".concat(t.rank))}function d_(e,t,n){return Rf((function(){return null==n&&(n="channelsLast"),DT(n),Im(e,l_(e.rank,t,n))}))}function h_(e,t,n,r){return Rf((function(){return pb(e,t,n,r)}))}function p_(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]?e():t()}var f_=["fanIn","fanOut","fanAvg"],m_=["normal","uniform","truncatedNormal"];var v_=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n,[{key:"fromConfigUsesCustomObjects",value:function(){return!1}},{key:"getConfig",value:function(){return{}}}]),n}(km),g_=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n,[{key:"apply",value:function(e,t){return Xg(e,t)}}]),n}(v_);g_.className="Zeros",Tm(g_);var y_=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n,[{key:"apply",value:function(e,t){return Bg(e,t)}}]),n}(v_);y_.className="Ones",Tm(y_);var b_=function(e){m(n,e);var t=y(n);function n(e){var r;if(T(this,n),r=t.call(this),"object"!=typeof e)throw new nT("Expected argument of type ConstantConfig but got ".concat(e));if(void 0===e.value)throw new nT("config must have value set but got ".concat(e));return r.value=e.value,p(r)}return E(n,[{key:"apply",value:function(e,t){var n=this;return Rf((function(){return Mm(ng(n.value),Bg(e,t))}))}},{key:"getConfig",value:function(){return{value:this.value}}}]),n}(v_);b_.className="Constant",Tm(b_);var x_=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this)).DEFAULT_MINVAL=-.05,r.DEFAULT_MAXVAL=.05,r.minval=e.minval||r.DEFAULT_MINVAL,r.maxval=e.maxval||r.DEFAULT_MAXVAL,r.seed=e.seed,r}return E(n,[{key:"apply",value:function(e,t){return My(e,this.minval,this.maxval,t)}},{key:"getConfig",value:function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}]),n}(v_);x_.className="RandomUniform",Tm(x_);var w_=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return E(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new rT("randomNormal does not support dType ".concat(t,"."));return o_(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(v_);w_.className="RandomNormal",Tm(w_);var k_=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return E(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new rT("truncatedNormal does not support dType ".concat(t,"."));return sb(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(v_);k_.className="TruncatedNormal",Tm(k_);var S_=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this)).gain=null!=e.gain?e.gain:1,r}return E(n,[{key:"apply",value:function(e,t){var n=this;return Rf((function(){if(2!==e.length||e[0]!==e[1])throw new nT("Identity matrix initializer can only be used for 2D square matrices.");return Mm(n.gain,pg(e[0]))}))}},{key:"getConfig",value:function(){return{gain:this.gain}}}]),n}(v_);S_.className="Identity",Tm(S_);var T_=function(e){m(n,e);var t=y(n);function n(e){var r;if(T(this,n),r=t.call(this),e.scale<0)throw new nT("scale must be a positive float. Got: ".concat(e.scale));return r.scale=null==e.scale?1:e.scale,r.mode=null==e.mode?"fanIn":e.mode,function(e){xT(f_,"FanMode",e)}(r.mode),r.distribution=null==e.distribution?"normal":e.distribution,function(e){xT(m_,"Distribution",e)}(r.distribution),r.seed=e.seed,p(r)}return E(n,[{key:"apply",value:function(e,t){var n=function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"channelsLast";if(DT(r),2===e.length)t=e[0],n=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===r){var a=KT(e,2);t=e[1]*a,n=e[0]*a}else if("channelsLast"===r){var i=KT(e,0,e.length-2);t=e[e.length-2]*i,n=e[e.length-1]*i}}else{var o=KT(e);t=Math.sqrt(o),n=Math.sqrt(o)}return[t,n]}(e),r=n[0],a=n[1],i=this.scale;if("fanIn"===this.mode?i/=Math.max(1,r):"fanOut"===this.mode?i/=Math.max(1,a):i/=Math.max(1,(r+a)/2),"normal"===this.distribution){var o=Math.sqrt(i);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new rT("".concat(this.getClassName()," does not support dType ").concat(t,"."));return sb(e,0,o,t,this.seed)}var s=Math.sqrt(3*i);return My(e,-s,s,t)}},{key:"getConfig",value:function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}]),n}(v_);T_.className="VarianceScaling",Tm(T_);var __=function(e){m(n,e);var t=y(n);function n(e){return T(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}return E(n,[{key:"getClassName",value:function(){return T_.className}}]),n}(T_);__.className="GlorotUniform",Tm(__);var I_=function(e){m(n,e);var t=y(n);function n(e){return T(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}return E(n,[{key:"getClassName",value:function(){return T_.className}}]),n}(T_);I_.className="GlorotNormal",Tm(I_);var E_=function(e){m(n,e);var t=y(n);function n(e){return T(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return E(n,[{key:"getClassName",value:function(){return T_.className}}]),n}(T_);E_.className="HeNormal",Tm(E_);var C_=function(e){m(n,e);var t=y(n);function n(e){return T(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return E(n,[{key:"getClassName",value:function(){return T_.className}}]),n}(T_);C_.className="HeUniform",Tm(C_);var M_=function(e){m(n,e);var t=y(n);function n(e){return T(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return E(n,[{key:"getClassName",value:function(){return T_.className}}]),n}(T_);M_.className="LeCunNormal",Tm(M_);var N_=function(e){m(n,e);var t=y(n);function n(e){return T(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return E(n,[{key:"getClassName",value:function(){return T_.className}}]),n}(T_);N_.className="LeCunNormal",Tm(N_);var R_=function(e){m(n,e);var t=y(n);function n(e){var r;if(T(this,n),(r=t.call(this)).DEFAULT_GAIN=1,r.gain=null==e.gain?r.DEFAULT_GAIN:e.gain,r.seed=e.seed,null!=r.seed)throw new rT("Random seed is not implemented for Orthogonal Initializer yet.");return p(r)}return E(n,[{key:"apply",value:function(e,t){var n=this;return Rf((function(){if(e.length<2)throw new rT("Shape must be at least 2D.");e[0]*e[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more than 2000 (".concat(e[0]*e[1],") elements: Slowness may result."));var t=o_(e[0]>e[1]?[e[1],e[0]]:e,0,1,"float32"),r=Ix.gramSchmidt(t);return e[0]>e[1]&&(r=Gf(r)),Mm(n.gain,r)}))}},{key:"getConfig",value:function(){return{gain:this.gain,seed:this.seed}}}]),n}(v_);R_.className="Orthogonal",Tm(R_);var L_={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function A_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return vT(e,Sm.getMap().classNameMap,t,"initializer")}function P_(e){return fT(e)}function D_(e){if("string"==typeof e){var t=e in L_?L_[e]:e;if("GlorotNormal"===t)return new I_;if("GlorotUniform"===t)return new __;if("HeNormal"===t)return new E_;if("HeUniform"===t)return new C_;if("LeCunNormal"===t)return new M_;if("LeCunUniform"===t)return new N_;var n={};return n.className=t,n.config={},A_(n)}return e instanceof v_?e:A_(e)}function O_(e){return Array.isArray(e)&&Array.isArray(e[0])}function z_(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function F_(e){var t;if(Array.isArray(e)){if(1!==e.length)throw new nT("Expected Tensor length to be 1; got ".concat(e.length));t=e[0]}else t=e;return t}function G_(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return e[0];throw new nT("Expected exactly 1 Shape; got ".concat(e.length))}return e}function W_(e){var t,n=0,r=x(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;0===a.shape.length?n+=1:n+=a.shape.reduce((function(e,t){return e*t}))}}catch(i){r.e(i)}finally{r.f()}return n}var V_="Variable",U_=function(){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V_,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;T(this,e),this.dtype=null!==r&&void 0!==r?r:"float32",this.shape=t.shape,this.id=IT(),a=null!==(n=a)&&void 0!==n?n:V_,this.originalName=VT(a),this.name=UT(this.originalName),this.trainable_=i,this.constraint=o,this.val=db(t,this.trainable_,this.name,this.dtype)}return E(e,[{key:"read",value:function(){return this.assertNotDisposed(),this.val}},{key:"write",value:function(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}},{key:"dispose",value:function(){this.assertNotDisposed(),this.val.dispose()}},{key:"assertNotDisposed",value:function(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.trainable_=e,this.val.trainable=e}}]),e}();function X_(e){return e.map((function(e){return e.read()}))}function B_(e){e.forEach((function(e){e[0].write(e[1])}))}var H_=E((function e(t){T(this,e),this.dtype=t.dtype,this.shape=t.shape,null!=t.shape?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}})),Z_=E((function e(t,n,r,a,i,o,s){T(this,e),this.dtype=t,this.shape=n,this.sourceLayer=r,this.inputs=a,this.callArgs=i,this.outputTensorIndex=s,this.id=IT(),null!=o&&(this.originalName=VT(o),this.name=UT(this.originalName)),this.rank=n.length})),K_=0,j_=function(){function e(t,n){T(this,e),this.callArgs=n,this.id=K_++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;var r,a=x(t.inboundLayers);try{for(a.s();!(r=a.n()).done;){var i=r.value;null!=i&&i.outboundNodes.push(this)}}catch(o){a.e(o)}finally{a.f()}t.outboundLayer.inboundNodes.push(this)}return E(e,[{key:"getConfig",value:function(){var e,t=[],n=x(this.inboundLayers);try{for(n.s();!(e=n.n()).done;){var r=e.value;null!=r?t.push(r.name):t.push(null)}}catch(a){n.e(a)}finally{n.f()}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}]),e}(),Y_=0,Q_=function(e){m(n,e);var t=y(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};T(this,n),(e=t.call(this))._callHook=null,e._addedWeightNames=[],e._stateful=!1,e.id=Y_++,e.activityRegularizer=null,e.inputSpec=null,e.supportsMasking=!1,e._trainableWeights=[],e._nonTrainableWeights=[],e._losses=[],e._updates=[],e._built=!1,e.inboundNodes=[],e.outboundNodes=[];var a=r.name;if(!a){var i=e.getClassName();a=dT(i)+"_"+CT(i)}if(e.name=a,e.trainable_=null==r.trainable||r.trainable,null!=r.inputShape||null!=r.batchInputShape){var o;if(null!=r.batchInputShape)o=r.batchInputShape;else if(null!=r.inputShape){var s=null;null!=r.batchSize&&(s=r.batchSize),o=[s].concat(r.inputShape)}e.batchInputShape=o;var u=r.dtype;null==u&&(u=r.inputDType),null==u&&(u="float32"),e.dtype=u}return null!=r.weights?e.initialWeights=r.weights:e.initialWeights=null,e._refCount=null,e.fastWeightInitDuringBuild=!1,e}return E(n,[{key:"getNodeAtIndex",value:function(e,t){if(0===this.inboundNodes.length)throw new tT("The layer has never been called and thus has no defined ".concat(t,"."));if(this.inboundNodes.length<=e)throw new nT("Asked to get ".concat(t," at node ").concat(e,", but the layer has only ").concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[e]}},{key:"getInputAt",value:function(e){return cT(this.getNodeAtIndex(e,"input").inputTensors)}},{key:"getOutputAt",value:function(e){return cT(this.getNodeAtIndex(e,"output").outputTensors)}},{key:"input",get:function(){if(this.inboundNodes.length>1)throw new eT("Layer ".concat(this.name,' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.'));if(0===this.inboundNodes.length)throw new eT("Layer ".concat(this.name," is not connected, no input to return."));return cT(this.getNodeAtIndex(0,"input").inputTensors)}},{key:"output",get:function(){if(0===this.inboundNodes.length)throw new eT("Layer ".concat(this.name," has no inbound nodes."));if(this.inboundNodes.length>1)throw new eT("Layer ".concat(this.name,' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.'));return cT(this.getNodeAtIndex(0,"output").outputTensors)}},{key:"losses",get:function(){return this._losses}},{key:"calculateLosses",value:function(){return this.losses.map((function(e){return e()}))}},{key:"updates",get:function(){return this._updates}},{key:"built",get:function(){return this._built},set:function(e){this._built=e}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this._trainableWeights.forEach((function(t){return t.trainable=e})),this.trainable_=e}},{key:"trainableWeights",get:function(){return this.trainable_?this._trainableWeights.filter((function(e){return e.trainable})):[]},set:function(e){this._trainableWeights=e}},{key:"nonTrainableWeights",get:function(){return this.trainable?this._trainableWeights.filter((function(e){return!e.trainable})).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(e){this._nonTrainableWeights=e}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"stateful",get:function(){return this._stateful}},{key:"resetStates",value:function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}},{key:"assertInputCompatibility",value:function(e){if(e=lT(e),null!=this.inputSpec&&0!==this.inputSpec.length){var t=lT(this.inputSpec);if(e.length!==t.length)throw new nT("Layer ".concat(this.name," expects ").concat(t.length," inputs, but it received ").concat(e.length," input tensors. Input received: ").concat(e));for(var n=0;n<e.length;n++){var r=e[n],a=t[n];if(null!=a){var i=r.rank;if(null!=a.ndim&&i!==a.ndim)throw new nT("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected ndim=").concat(a.ndim,", found ndim=").concat(i));if(null!=a.maxNDim&&i>a.maxNDim)throw new nT("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected max_ndim=").concat(a.maxNDim,", found ndim=").concat(i));if(null!=a.minNDim&&i<a.minNDim)throw new nT("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected min_ndim=").concat(a.minNDim,", found ndim=").concat(i,"."));if(null!=a.dtype&&r.dtype!==a.dtype)throw new nT("Input ".concat(n," is incompatible with layer ").concat(this.name," : expected dtype=").concat(a.dtype,", found dtype=").concat(r.dtype,"."));if(a.axes){var o=r.shape;for(var s in a.axes){var u=Number(s),c=a.axes[s],l=u>=0?o[u]:o[o.length+u];if(null!=c&&-1===[c,null].indexOf(l))throw new nT("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected axis ").concat(u," of input shape to have value ").concat(c," but got shape ").concat(o,"."))}}if(null!=a.shape)for(var d=0;d<a.shape.length;++d){var h=a.shape[d],p=r.shape[d];if(null!=h&&null!=p&&h!==p)throw new nT("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected shape=").concat(a.shape,", found shape=").concat(r.shape,"."))}}}}}},{key:"call",value:function(e,t){return e}},{key:"invokeCallHook",value:function(e,t){null!=this._callHook&&this._callHook(e,t)}},{key:"setCallHook",value:function(e){this._callHook=e}},{key:"clearCallHook",value:function(){this._callHook=null}},{key:"apply",value:function(e,t){var n=this;t=t||{},this.assertNotDisposed();var r,a=lT(e),i=!0,o=x(a);try{for(o.s();!(r=o.n()).done;){if(!(r.value instanceof Z_)){i=!1;break}}}catch(l){o.e(l)}finally{o.f()}var s,u=!0,c=x(a);try{for(c.s();!(s=c.n()).done;){if(s.value instanceof Z_){u=!1;break}}}catch(l){c.e(l)}finally{c.f()}if(i===u)throw new nT("Arguments to apply() must be all SymbolicTensors or all Tensors");return WT(this.name,(function(){if(!n.built){n.assertInputCompatibility(e);var r,i=[],o=x(lT(e));try{for(o.s();!(r=o.n()).done;){var s=r.value;i.push(s.shape)}}catch(l){o.e(l)}finally{o.f()}n.build(cT(i)),n.built=!0,n.initialWeights&&n.setWeights(n.initialWeights),null===n._refCount&&u&&(n._refCount=1)}if(n.assertInputCompatibility(e),u){var c,d=n.call(e,t),h=[],p=x(lT(d));try{for(p.s();!(c=p.n()).done;){var f=c.value;-1!==a.indexOf(f)&&(f=f.clone()),h.push(f)}}catch(l){p.e(l)}finally{p.f()}if(d=cT(h),null!=n.activityRegularizer)throw new rT("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return d}var m,v=function(e){e=lT(e);var t,n=[],r=x(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push(a.shape)}}catch(l){r.e(l)}finally{r.f()}return cT(n)}(e),g=n.computeOutputShape(v),y="float32";if(n.warnOnIncompatibleInputShape(Array.isArray(e)?v[0]:v),m=null!=g&&g.length>0&&Array.isArray(g[0])?g.map((function(r,a){return new Z_(y,r,n,lT(e),t,n.name,a)})):new Z_(y,g,n,lT(e),t,n.name),n.addInboundNode(e,m,null,null,v,g,t),n._refCount++,null!=n.activityRegularizer)throw new rT("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return m}))}},{key:"warnOnIncompatibleInputShape",value:function(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: ".concat(JSON.stringify(e),") does not match that of the batchInputShape (").concat(JSON.stringify(this.batchInputShape),") of the layer ").concat(this.name));else{var t=!1;this.batchInputShape.forEach((function(n,r){null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)})),t&&console.warn("The shape of the input tensor (".concat(JSON.stringify(e),") does not match the expectation of layer ").concat(this.name,": ").concat(JSON.stringify(this.batchInputShape)))}}},{key:"outputShape",get:function(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new eT("The layer ".concat(this.name," has never been called and thus has no defined output shape."));var e,t=[],n=x(this.inboundNodes);try{for(n.s();!(e=n.n()).done;){var r=e.value,a=JSON.stringify(r.outputShapes);-1===t.indexOf(a)&&t.push(a)}}catch(o){n.e(o)}finally{n.f()}if(1===t.length){var i=this.inboundNodes[0].outputShapes;return Array.isArray(i)&&Array.isArray(i[0])&&1===i.length?i[0]:i}throw new eT("The layer ".concat(this.name,' has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.'))}},{key:"countParams",value:function(){if(!this.built)throw new tT("You tried to call countParams() on ".concat(this.name,", but the layer is not built yet. Build it first by calling build(batchInputShape)."));return W_(this.weights)}},{key:"build",value:function(e){this.built=!0}},{key:"getWeights",value:function(){return X_(arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.trainableWeights:this.weights)}},{key:"setWeights",value:function(e){var t=this;Rf((function(){var n=t.weights;if(n.length!==e.length)throw new nT('You called setWeights(weights) on layer "'.concat(t.name,'" with a weight list of length ').concat(e.length,", but the layer was expecting ").concat(n.length," weights. Provided weights: ").concat(e,"..."));if(0!==n.length){for(var r=[],a=X_(n),i=0;i<a.length;++i){var o=a[i],s=n[i],u=e[i];if(!ms(o.shape,u.shape))throw new nT("Layer weight shape ".concat(o.shape," not compatible with provided weight shape ").concat(u.shape));r.push([s,u])}B_(r)}}))}},{key:"addWeight",value:function(e,t,n,r,a,i,o,s){if(-1!==this._addedWeightNames.indexOf(e))throw new nT("Duplicate weight name ".concat(e," for layer ").concat(this.name));this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=null!=s?s():D_("zeros"));var u=r.apply(t,n),c=new U_(u,n,e,i,o);return u.dispose(),null!=a&&this.addLoss((function(){return a.apply(c.read())})),null==i&&(i=!0),i?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}},{key:"setFastWeightInitDuringBuild",value:function(e){this.fastWeightInitDuringBuild=e}},{key:"addLoss",value:function(e){var t;null==e||Array.isArray(e)&&0===e.length||(e=lT(e),void 0!==this._losses&&null!==this._losses&&(t=this.losses).push.apply(t,b(e)))}},{key:"computeOutputShape",value:function(e){return e}},{key:"computeMask",value:function(e,t){var n=this;if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer ".concat(this.name," does not support masking, but was passed an inputMask."));t.forEach((function(e){if(null!=e)throw new TypeError("Layer ".concat(n.name," does not support masking, but was passed an inputMask."))}))}return null}return t}},{key:"addInboundNode",value:function(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=lT(e);t=lT(t),n=lT(n),r=lT(r),a=z_(a),i=z_(i);var u,c=[],l=[],d=[],h=x(s);try{for(h.s();!(u=h.n()).done;){var p=u.value;c.push(p.sourceLayer),l.push(p.nodeIndex),d.push(p.tensorIndex)}}catch(m){h.e(m)}finally{h.f()}new j_({outboundLayer:this,inboundLayers:c,nodeIndices:l,tensorIndices:d,inputTensors:s,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:a,outputShapes:i},o);for(var f=0;f<t.length;f++)t[f].sourceLayer=this,t[f].nodeIndex=this.inboundNodes.length-1,t[f].tensorIndex=f}},{key:"getConfig",value:function(){var e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}},{key:"disposeWeights",value:function(){return this.weights.forEach((function(e){return e.dispose()})),this.weights.length}},{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Layer '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been built yet."));if(null===this._refCount)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used yet."));this.assertNotDisposed();var e=0;return 0===--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}],[{key:"nodeKey",value:function(e,t){return e.name+"_ib-"+t.toString()}}]),n}(km);function J_(e,t,n){if((null==t||null!=n&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),0===t.inboundNodes.length)return[e];var r=t.inboundNodes[n];if(0===r.inboundLayers.length)return r.inputTensors;for(var a=[],i=0;i<r.inboundLayers.length;i++){var o,s=x(J_(r.inputTensors[i],r.inboundLayers[i],r.nodeIndices[i]));try{for(s.s();!(o=s.n()).done;){var u=o.value;-1===a.indexOf(u)&&a.push(u)}}catch(c){s.e(c)}finally{s.f()}}return a}var q_=function(e){m(n,e);var t=y(n);function n(e){var r;if(T(this,n),r=t.call(this,{dtype:e.dtype,name:null!=e.name?e.name:CT("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),r.trainable=!1,r.built=!0,r.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new nT("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var a=e.batchInputShape;if(null==a){if(null==e.inputShape)throw new nT("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");a=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new nT("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=e.dtype||"float32";r.batchInputShape=a,r.dtype=i,r.inputSpec=[{shape:a}];var o=new Z_(r.dtype,r.batchInputShape,h(r),[],{},r.name);return o.nodeIndex=0,o.tensorIndex=0,new j_({outboundLayer:h(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[a],outputShapes:[a]}),p(r)}return E(n,[{key:"apply",value:function(e,t){throw new nT("Cannot pass any input to an InputLayer's apply() method. InputLayer name: ".concat(this.name))}},{key:"dispose",value:function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}},{key:"getConfig",value:function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}]),n}(Q_);function $_(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new nT("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));var n=e.dtype;return null==n&&(n="float32"),new q_({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}q_.className="InputLayer",Tm(q_);var eI=function(){function e(t){if(T(this,e),this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof e)for(var n in t.id2Value)this.id2Value[n]=t.id2Value[n],n in t.id2Mask&&(this.id2Mask[n]=t.id2Mask[n]);else{if(null==t)return;var r,a=x(t);try{for(a.s();!(r=a.n()).done;){var i=r.value;this.add(i.key,i.value)}}catch(o){a.e(o)}finally{a.f()}}}return E(e,[{key:"add",value:function(e,t,n){if(null!=this.id2Value[e.id])throw new nT("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this.id2Value[e.id]=function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return hf(t,e.dtype)}catch(n){throw new nT("The dtype of the feed (".concat(t.dtype,") can not be cast to the dtype of the key '").concat(e.name,"' (").concat(e.dtype,")."))}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this}},{key:"addFeed",value:function(e){this.add(e.key,e.value)}},{key:"hasKey",value:function(e){return null!=this.id2Value[e.id]}},{key:"names",value:function(){return Object.keys(this.name2Id)}},{key:"getValue",value:function(e){if(e instanceof Z_){if(null==this.id2Value[e.id])throw new nT("Nonexistent key: ".concat(e.name));return this.id2Value[e.id]}var t=this.name2Id[e];if(null==t)throw new nT("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Value[t]}},{key:"getMask",value:function(e){if(e instanceof Z_){if(null==this.id2Value[e.id])throw new nT("Nonexistent key: ".concat(e.name));return this.id2Mask[e.id]}var t=this.name2Id[e];if(null==t)throw new nT("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Mask[t]}},{key:"disposeMasks",value:function(){null!=this.id2Mask&&Lf(this.id2Mask)}}]),e}(),tI=new iT,nI=new iT;function rI(e,t,n,r){var a,i=null!=n&&n.training,o=Array.isArray(e),s=o?e:[e],u=s.map((function(e){return e.name})),c=[],l=t.names(),d=x(u);try{for(d.s();!(a=d.n()).done;){var h=a.value;-1!==l.indexOf(h)?c.push(t.getValue(h)):c.push(null)}}catch(F){d.e(F)}finally{d.f()}null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);var p,f=u.join(",")+"|"+t.names().sort().join(","),m=tI.get(f);if(null==m){var v=function(e,t){ls(null!=e&&e.length>0,(function(){return"Expected at least one fetch, got none"}));var n=[],r={};if(1===e.length){var a=iI(e[0],t);n=a.sorted,r=a.recipientMap}else{var i,o=new Set,s=x(e);try{for(s.s();!(i=s.n()).done;){var u,c=iI(i.value,t),l=c.sorted,d=c.recipientMap,h=x(l);try{for(h.s();!(u=h.n()).done;){var p=u.value;o.has(p.name)||(n.push(p),o.add(p.name))}}catch(F){h.e(F)}finally{h.f()}var f=function(e){null==r[e]&&(r[e]=new Set),d[e].forEach((function(t){return r[e].add(t)}))};for(var m in d)f(m)}}catch(F){s.e(F)}finally{s.f()}}return{sorted:n,recipientCounts:aI(r)}}(s,t);m=v.sorted,p=v.recipientCounts,tI.put(f,m),nI.put(f,p)}p={},i||Object.assign(p,nI.get(f));for(var g=new eI(t),y=0;y<m.length;++y){if(null!=r){var b=Nf().numTensors;b>r.maxNumTensors&&(r.maxNumTensors=b),b<r.minNumTensors&&(r.minNumTensors=b)}var w=m[y],k=w.sourceLayer;if(!(k instanceof q_)){var S,T=[],_=[],I=[],E=!1,C=x(w.inputs);try{for(C.s();!(S=C.n()).done;){var M=S.value,N=g.getValue(M),R=g.getMask(M);T.push(N),_.push(R),null!=R&&(E=!0),i||(p[M.name]--,0===p[M.name]&&!t.hasKey(M)&&-1===u.indexOf(M.name)&&!N.isDisposed&&!0!==M.sourceLayer.stateful&&I.push(N))}}catch(F){C.e(F)}finally{C.f()}E&&((n=n||{}).mask=_[0]);var L=lT(k.apply(T,n)),A=null;k.supportsMasking&&(A=k.computeMask(T,_));for(var P=oI(w),D=Array.isArray(P)?P:[P],O=0;O<D.length;++O){g.hasKey(D[O])||g.add(D[O],L[O],Array.isArray(A)?A[0]:A);var z=u.indexOf(D[O].name);-1!==z&&(c[z]=L[O])}i||Lf(I)}}return g.disposeMasks(),o?c:c[0]}function aI(e){var t={};for(var n in e)t[n]=e[n].size;return t}function iI(e,t){var n,r=new Set,a=[],i={},o=x(t.names());try{for(o.s();!(n=o.n()).done;){var s=n.value;r.add(s)}}catch(m){o.e(m)}finally{o.f()}var u=[],c=[];for(u.push(e);u.length>0;){var l=u[u.length-1];if(r.has(l.name))u.pop();else{var d=c[c.length-1]===u.length-1;if(0===l.inputs.length||d)u.pop(),a.push(l),r.add(l.name),d&&c.pop();else{c.push(u.length-1);var h,p=x(l.inputs);try{for(p.s();!(h=p.n()).done;){var f=h.value;null==i[f.name]&&(i[f.name]=new Set),i[f.name].add(l.name),!r.has(f.name)&&u.push(f)}}catch(m){p.e(m)}finally{p.f()}}}}return{sorted:a,recipientMap:i}}function oI(e){var t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{for(var n=null,r=0;r<e.sourceLayer.inboundNodes.length;++r){var a,i=x(e.sourceLayer.inboundNodes[r].outputTensors);try{for(i.s();!(a=i.n()).done;){if(a.value.id===e.id){n=r;break}}}catch(o){i.e(o)}finally{i.f()}}t=e.sourceLayer.getOutputAt(n)}return t}function sI(e,t){return Rf((function(){return rg(ig(Mm(e,e),t,!0))}))}Qs().registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",(function(){return 100}),(function(e){null!=tI&&tI.setMaxEntries(e),null!=nI&&nI.setMaxEntries(e)}));var uI=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n,[{key:"getConfig",value:function(){return{}}}]),n}(km),cI=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this)).defaultMaxValue=2,r.defaultAxis=0,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return E(n,[{key:"apply",value:function(e){var t=this;return Rf((function(){var n=sI(e,t.axis),r=bv(n,0,t.maxValue);return Mm(e,Cm(r,Im(JT(),n)))}))}},{key:"getConfig",value:function(){return{maxValue:this.maxValue,axis:this.axis}}}]),n}(uI);cI.className="MaxNorm",Tm(cI);var lI=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this)).defaultAxis=0,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return E(n,[{key:"apply",value:function(e){var t=this;return Rf((function(){return Cm(e,Im(JT(),sI(e,t.axis)))}))}},{key:"getConfig",value:function(){return{axis:this.axis}}}]),n}(uI);lI.className="UnitNorm",Tm(lI);var dI=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n,[{key:"apply",value:function(e){return Ly(e)}}]),n}(uI);dI.className="NonNeg",Tm(dI);var hI=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this)).defaultMinValue=0,r.defaultMaxValue=1,r.defaultRate=1,r.defaultAxis=0,r.minValue=null!=e.minValue?e.minValue:r.defaultMinValue,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.rate=null!=e.rate?e.rate:r.defaultRate,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return E(n,[{key:"apply",value:function(e){var t=this;return Rf((function(){var n=sI(e,t.axis),r=Im(Mm(t.rate,bv(n,t.minValue,t.maxValue)),Mm(1-t.rate,n));return Mm(e,Cm(r,Im(JT(),n)))}))}},{key:"getConfig",value:function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}]),n}(uI);hI.className="MinMaxNorm",Tm(hI);var pI,fI={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function mI(e){return fT(e)}function vI(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return vT(e,Sm.getMap().classNameMap,t,"constraint")}function gI(e){return null==e?null:"string"==typeof e?vI({className:e in fI?fI[e]:e,config:{}}):e instanceof uI?e:vI(e)}function yI(e){return bI.apply(this,arguments)}function bI(){return bI=S(w().mark((function e(t){var n,r,a,i,o,s,u,c;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}return e.abrupt("return");case 2:for(i in n=[],r=[],a=[],t)"number"!=typeof(o=t[i])&&(s=o,n.push(s.data()),r.push(i),a.push(s));if(!(n.length>0)){e.next=10;break}return e.next=7,Promise.all(n);case 7:for(u=e.sent,c=0;c<u.length;++c)t[r[c]]=u[c][0];Lf(a);case 10:case"end":return e.stop()}}),e)}))),bI.apply(this,arguments)}function xI(e){if(null!=e)for(var t in e){var n=e[t];"number"!=typeof n&&n.dispose()}}!function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(pI||(pI={}));var wI=function(){function e(){T(this,e),this.validationData=null}return E(e,[{key:"setParams",value:function(e){this.params=e}},{key:"onEpochBegin",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"setModel",value:function(e){}}]),e}(),kI=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;T(this,e),null==t&&(t=[]),this.callbacks=t,this.queueLength=n}return E(e,[{key:"append",value:function(e){this.callbacks.push(e)}},{key:"setParams",value:function(e){var t,n=x(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setParams(e)}}catch(r){n.e(r)}finally{n.f()}}},{key:"setModel",value:function(e){var t,n=x(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setModel(e)}}catch(r){n.e(r)}finally{n.f()}}},{key:"onEpochBegin",value:function(){var e=S(w().mark((function e(t,n){var r,a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=x(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=S(w().mark((function e(t,n){var r,a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=x(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=S(w().mark((function e(t,n){var r,a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=x(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=S(w().mark((function e(t,n){var r,a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=x(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=S(w().mark((function e(t){var n,r,a;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=x(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainBegin(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=S(w().mark((function e(t){var n,r,a;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=x(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainEnd(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),SI=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.call(this)}return E(n,[{key:"onEpochBegin",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.seen=0,this.totals={};case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=S(w().mark((function e(t,n){var r,a,i,o=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=null==n.size?0:n.size,this.seen+=r,a=w().mark((function e(t){var a,i,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"number"==typeof(a=n[t])?(o.totals.hasOwnProperty(t)||(o.totals[t]=0),o.totals[t]=o.totals[t]+a*r):(t in o.totals?i=o.totals[t]:o.totals[t]=0,s=Rf((function(){return Im(o.totals[t],Mm(a,r))})),o.totals[t]=s,null!=i&&i.dispose());case 2:case"end":return e.stop()}}),e)})),e.t0=w().keys(n);case 5:if((e.t1=e.t0()).done){e.next=10;break}return i=e.t1.value,e.delegateYield(a(i),"t2",8);case 8:e.next=5;break;case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=S(w().mark((function e(t,n){var r,a,i,o=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n){e.next=17;break}r=x(this.params.metrics),e.prev=2,i=w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=a.value,null!=o.totals[t]&&("number"==typeof o.totals[t]?n[t]=o.totals[t]/o.seen:Rf((function(){var e=Mm(Cm(1,o.seen),o.totals[t]);n[t]=e,o.totals[t].dispose(),Af(n[t])})));case 2:case"end":return e.stop()}}),e)})),r.s();case 5:if((a=r.n()).done){e.next=9;break}return e.delegateYield(i(),"t0",7);case 7:e.next=5;break;case 9:e.next=14;break;case 11:e.prev=11,e.t1=e.catch(2),r.e(e.t1);case 14:return e.prev=14,r.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[2,11,14,17]])})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(wI),TI=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n,[{key:"onTrainBegin",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.epoch=[],this.history={};case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=S(w().mark((function e(t,n){var r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r in null==n&&(n={}),this.epoch.push(t),n)null==this.history[r]&&(this.history[r]=[]),this.history[r].push(n[r]);case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"syncData",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i,o,s,u,c;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a in t=[],n=[],r=[],this.history)for(i=this.history[a],o=0;o<i.length;++o)"number"!=typeof i[o]&&(s=i[o],t.push(s.data()),n.push(a),r.push(o));return e.next=4,Promise.all(t);case 4:for(u=e.sent,c=0;c<u.length;++c)this.history[n[c]][r[c]].dispose(),this.history[n[c]][r[c]]=u[c][0];case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(wI),_I=function(e){m(n,e);var t=y(n);function n(e,r){var a;if(T(this,n),(a=t.call(this)).currentEpoch=0,a.nowFunc=e.nowFunc,a.nextFrameFunc=e.nextFrameFunc||Ux,a.yieldEvery=r||"auto","auto"===a.yieldEvery&&(a.yieldEvery=125),"never"===a.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return As(a.yieldEvery)&&(a.maybeWait=function(e,t,n){var r,a=null!=n?n():ah();return function(){var i=null!=n?n():ah();return i-a<t||(a=i,r=e.apply(void 0,arguments)),r}}(a.maybeWait.bind(h(a)),a.yieldEvery,a.nowFunc)),a.trainBegin=e.onTrainBegin,a.trainEnd=e.onTrainEnd,a.epochBegin=e.onEpochBegin,a.epochEnd=e.onEpochEnd,a.batchBegin=e.onBatchBegin,a.batchEnd=e.onBatchEnd,a.yield=e.onYield,p(a)}return E(n,[{key:"maybeWait",value:function(){var e=S(w().mark((function e(t,n,r){var a;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],e.t0=null!=this.yield,!e.t0){e.next=6;break}return e.next=5,yI(r);case 5:a.push(this.yield(t,n,r));case 6:return a.push(this.nextFrameFunc()),e.next=9,Promise.all(a);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"onEpochBegin",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentEpoch=t,e.t0=null!=this.epochBegin,!e.t0){e.next=7;break}return e.next=5,yI(n);case 5:return e.next=7,this.epochBegin(t,n);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=S(w().mark((function e(t,n){var r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],e.t0=null!=this.epochEnd,!e.t0){e.next=6;break}return e.next=5,yI(n);case 5:r.push(this.epochEnd(t,n));case 6:return"epoch"===this.yieldEvery&&r.push(this.nextFrameFunc()),e.next=9,Promise.all(r);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=this.batchBegin,!e.t0){e.next=6;break}return e.next=4,yI(n);case 4:return e.next=6,this.batchBegin(t,n);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=S(w().mark((function e(t,n){var r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],e.t0=null!=this.batchEnd,!e.t0){e.next=6;break}return e.next=5,yI(n);case 5:r.push(this.batchEnd(t,n));case 6:return"batch"===this.yieldEvery?r.push(this.nextFrameFunc()):As(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,t,n)),e.next=9,Promise.all(r);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=this.trainBegin,!e.t0){e.next=6;break}return e.next=4,yI(t);case 4:return e.next=6,this.trainBegin(t);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=this.trainEnd,!e.t0){e.next=6;break}return e.next=4,yI(t);case 4:return e.next=6,this.trainEnd(t);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(wI);function II(e,t){return null==e&&(e={}),e instanceof wI?[e]:Array.isArray(e)&&e[0]instanceof wI?e:lT(e).map((function(e){return new _I(e,t)}))}var EI=function(){function e(){T(this,e)}return E(e,null,[{key:"registerCallbackConstructor",value:function(t,n){ls(t>=0&&Number.isInteger(t),(function(){return"Verbosity level is expected to be an integer >= 0, but got ".concat(t)})),e.checkForDuplicate(n),null==e.constructors[t]&&(e.constructors[t]=[]),e.constructors[t].push(n)}},{key:"checkForDuplicate",value:function(t){for(var n in e.constructors)e.constructors[+n].forEach((function(e){if(e===t)throw new nT("Duplicate callback constructor.")}))}},{key:"clear",value:function(){e.constructors={}}},{key:"createCallbacks",value:function(t){var n=[];for(var r in e.constructors){var a=+r;t>=a&&n.push.apply(n,b(e.constructors[a]))}return n.map((function(e){return new e}))}}]),e}();function CI(e,t,n,r,a,i,o,s,u){var c=new TI,l=[new SI].concat(b(EI.createCallbacks(t)));null!=e&&l.push.apply(l,b(e)),l.push(c);var d=new kI(l);return d.setParams({epochs:n,initialEpoch:r,samples:a,steps:i,batchSize:o,verbose:t,doValidation:s,metrics:u}),{callbackList:d,history:c}}function MI(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return vT(e,Sm.getMap().classNameMap,t,"layer",n)}function NI(e,t){return Rf((function(){"float32"!==e.dtype&&(e=hf(e,"float32"));var n=ig(c_(e),t,!0),r=yv(n.shape,JT()),a=rg(Vg(n,r));return Cm(e,a)}))}function RI(e,t){return Rf((function(){return Ug(c_(Lg(t,e)),-1)}))}function LI(e,t){return Rf((function(){return Ug(Nm(Lg(t,e)),-1)}))}function AI(e,t){return Rf((function(){var n=Lg(e,t),r=bv(Nm(e),JT(),Number.MAX_VALUE),a=Nm(Cm(n,r));return Mm(100,Ug(a,-1))}))}function PI(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Rf((function(){if(n)t=Zy(t);else{var r=ig(t,t.shape.length-1,!0);t=Cm(t,r)}return t=bv(t,JT(),1-JT()),zf(ig(Mm(hf(e,"float32"),_g(t)),t.shape.length-1))}))}function DI(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Rf((function(){var r=hf(fg(function(e){var t=[KT(e.shape)];return nv(e,t)}(e)),"int32"),a=(t=bv(t,JT(),1-JT())).shape;return PI(nv(Cf(r,a[a.length-1]),a),t,n)}))}function OI(e,t){return Rf((function(){var n;return n=bv(t,JT(),1-JT()),n=_g(Cm(n,Lg(1,n))),Ug(function(e,t){if(!ms(e.shape,t.shape))throw new nT("logits and labels must have the same shape, but got shapes ".concat(JSON.stringify(e.shape)," and ").concat(JSON.stringify(t.shape)));return Rf((function(){var n=Ly(t),r=zf(Nm(t));return Im(Lg(n,Mm(t,e)),Ig(cg(r)))}))}(e,n),-1)}))}function zI(e,t){return Rf((function(){var n=NI(e,-1),r=NI(t,-1),a=Mm(n,r);return zf(ig(a,-1))}))}EI.constructors={};var FI={meanSquaredError:RI,meanAbsoluteError:LI,meanAbsolutePercentageError:AI,meanSquaredLogarithmicError:function(e,t){return Rf((function(){var n=bv(t,JT(),Number.MAX_VALUE),r=_g(Im(1,n)),a=bv(e,JT(),Number.MAX_VALUE),i=_g(Im(1,a));return Ug(c_(Lg(r,i)),-1)}))},squaredHinge:function(e,t){return Rf((function(){var n=Vg(0,Lg(1,Mm(e,t)));return Ug(c_(n),-1)}))},hinge:function(e,t){return Rf((function(){var n=Vg(0,Lg(1,Mm(e,t)));return Ug(n,-1)}))},categoricalHinge:function(e,t){return Rf((function(){var n=ig(Mm(e,t),-1),r=$v(Mm(Lg(1,e),t),-1);return Vg(0,Im(1,Lg(r,n)))}))},logcosh:function(e,t){return Rf((function(){var n=Math.log(2),r=Lg(t,e),a=Lg(Im(r,Ng(Mm(-2,r))),n);return Ug(a,-1)}))},categoricalCrossentropy:PI,sparseCategoricalCrossentropy:DI,binaryCrossentropy:OI,kullbackLeiblerDivergence:function(e,t){return Rf((function(){var n=bv(e,JT(),1),r=bv(t,JT(),1);return ig(Mm(e,_g(Cm(n,r))),-1)}))},poisson:function(e,t){return Rf((function(){var n=_g(Im(JT(),t));return Ug(Lg(t,Mm(e,n)),-1)}))},cosineProximity:zI};function GI(e){if("string"==typeof e){if(e in FI)return FI[e];var t="Unknown loss ".concat(e);throw e.toLowerCase().includes("softmaxcrossentropy")&&(t="Unknown loss ".concat(e,'. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy')),new nT(t)}return e}function WI(e,t){return Rf((function(){var n=Mm(.5,Qg(t)),r=qT(vg(t,n),e.dtype);return Ug(Fv(e,r),-1)}))}function VI(e,t){return Rf((function(){return qT(Fv(Dm(e,-1),Dm(t,-1)),"float32")}))}function UI(e,t){return Rf((function(){return hf(ig(Dg(Fv(e,1),Fv(t,1))),"float32")}))}function XI(e,t){return Rf((function(){var n=UI(e,t),r=function(e,t){return Rf((function(){return hf(ig(Dg(Fv(e,0),Fv(t,1))),"float32")}))}(e,t),a=Im(n,r);return hf(Gv(vg(a,0),Cm(n,a),0),"float32")}))}function BI(e,t){return Rf((function(){var n=UI(e,t),r=function(e,t){return Rf((function(){return hf(ig(Dg(Fv(e,1),Fv(t,0))),"float32")}))}(e,t),a=Im(n,r);return hf(Gv(vg(a,0),Cm(n,a),0),"float32")}))}function HI(e,t){return OI(e,t)}function ZI(e,t){return e.rank===t.rank&&(e=$y(e,[e.rank-1])),(t=Dm(t,-1)).dtype!==e.dtype&&(t=hf(t,e.dtype)),hf(Fv(e,t),"float32")}var KI=PI,jI=DI,YI={binaryAccuracy:WI,categoricalAccuracy:VI,precision:XI,categoricalCrossentropy:KI,sparseCategoricalCrossentropy:jI,mse:RI,MSE:RI,mae:LI,MAE:LI,mape:AI,MAPE:AI,cosine:zI};function QI(e){if(sT(null!==e,"Unknown LossOrMetricFn ".concat(e)),"string"==typeof e)return e;for(var t,n=0,r=Object.keys(FI);n<r.length;n++){var a=r[n];if(FI[a]===e){t=a;break}}if(void 0!==t)return t;for(var i=0,o=Object.keys(YI);i<o.length;i++){var s=o[i];if(YI[s]===e){t=s;break}}return void 0!==t?t:e.name}var JI=1048576;function qI(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e||"object"!=typeof e||Object.getPrototypeOf(e)!==Object.prototype||!$I(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){var r=JSON.stringify(e);r.length>JI&&console.warn('User-defined metadata of model "'.concat(t,'" is too large in size (length=').concat(r.length," when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ").concat(JI,"."))}}function $I(e){if(null===e)return!0;if("object"==typeof e){if(Object.getPrototypeOf(e)===Object.prototype){for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t];if("string"!=typeof r||!$I(e[r]))return!1}return!0}if(Array.isArray(e)){var a,i=x(e);try{for(i.s();!(a=i.n()).done;){if(!$I(a.value))return!1}}catch(s){i.e(s)}finally{i.f()}return!0}return!1}var o=typeof e;return"string"===o||"number"===o||"boolean"===o}function eE(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:console.log,i=function(e){var t=!0,n=[],r=[];for(var a in e.nodesByDepth)n.push(e.nodesByDepth[a]);for(var i=0,o=n;i<o.length;i++){var s=o[i];if(s.length>1||1===s.length&&s[0].inboundLayers.length>1){t=!1;break}r.push.apply(r,b(s))}if(t){var u,c=x(e.layers);try{for(c.s();!(u=c.n()).done;){var l,d=u.value,h=!1,p=x(d.inboundNodes);try{for(p.s();!(l=p.n()).done;){var f=l.value;if(-1!==r.indexOf(f)){if(h){t=!1;break}h=!0}}}catch(m){p.e(m)}finally{p.f()}if(!t)break}}catch(m){c.e(m)}finally{c.f()}}return t}(e),o=["Layer (type)","Input Shape","Output shape","Param #"];if(i?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map((function(e){return Math.floor(t*e)}))),!i)for(var s in o.push("Receives inputs"),r=[],e.nodesByDepth){var u;(u=r).push.apply(u,b(e.nodesByDepth[s]))}a("_".repeat(t)),tE(o,n,a),a("=".repeat(t));for(var c=e.layers,l=0;l<c.length;++l)i?nE(c[l],n,a):rE(c[l],n,r,a),a((l===c.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();var d=function(e){var t;return t=null!=e.collectedTrainableWeights?W_(e.collectedTrainableWeights):W_(e.trainableWeights),t}(e),h=W_(e.nonTrainableWeights);a("Total params: ".concat(d+h)),a("Trainable params: ".concat(d)),a("Non-trainable params: ".concat(h)),a("_".repeat(t))}function tE(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log,r="",a=0;a<e.length;++a)a>0&&(r=r.slice(0,r.length-1)+" "),r=(r+=e[a]).slice(0,t[a]),r+=" ".repeat(t[a]-r.length);n(r)}function nE(e,t,n){var r,a;try{a=e.inboundNodes.map((function(e){return JSON.stringify(e.inputShapes)})).join(",")}catch(s){a="multiple"}try{r=JSON.stringify(e.outputShape)}catch(u){r="multiple"}var i=e.name,o=e.getClassName();tE(["".concat(i," (").concat(o,")"),a,r,e.countParams().toString()],t,n)}function rE(e,t,n,r){var a,i;try{i=e.inboundNodes.map((function(e){return JSON.stringify(e.inputShapes)})).join(",")}catch(y){i="multiple"}try{a=JSON.stringify(e.outputShape)}catch(b){a="multiple"}var o,s=[],u=x(e.inboundNodes);try{for(u.s();!(o=u.n()).done;){var c=o.value;if(!(null!=n&&n.length>0&&-1===n.indexOf(c)))for(var l=0;l<c.inboundLayers.length;++l){var d=c.inboundLayers[l].name,h=c.nodeIndices[l],p=c.tensorIndices[l];s.push("".concat(d,"[").concat(h,"][").concat(p,"]"))}}}catch(w){u.e(w)}finally{u.f()}var f=e.name,m=e.getClassName(),v=0===s.length?"":s[0];tE(["".concat(f," (").concat(m,")"),i,a,e.countParams().toString(),v],t,r);for(var g=1;g<s.length;++g)tE(["","","","",s[g]],t,r)}function aE(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"==typeof n}function iE(e,t){if(null===e)return null;if("string"==typeof e)return hT(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];aE(t,a,i)?n.push(i):n.push(iE(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c];if("name"===c&&"string"==typeof l)o[c]=l;else{var d=hT(c);o[d]=iE(l,d)}}return o}function oE(e,t){if(null==e)return null;if("string"==typeof e)return dT(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];aE(t,a,i)?n.push(i):n.push(oE(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c],d=dT(c);o[d]="name"!==c&&"className"!==c||"string"!=typeof l?oE(l,c):l}return o}var sE="3.21.0",uE=function(e){m(n,e);var t=y(n);function n(e){var r;if(T(this,n),(r=t.call(this,{})).containerNodes=new Set,r.name=e.name,null==r.name){var a=r.getClassName().toLowerCase();r.name=CT(a)}if(r.supportsMasking=!1,r.trainable_=!0,Array.isArray(e.inputs)?r.inputs=e.inputs.slice():r.inputs=[e.inputs],Array.isArray(e.outputs)?r.outputs=e.outputs.slice():r.outputs=[e.outputs],yT(r.inputs).length!==r.inputs.length)throw new nT("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ".concat(r.inputs.map((function(e){return e.name}))));yT(r.outputs).length!==r.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ".concat(r.outputs.map((function(e){return e.name})))),r.inputLayers=[],r.inputLayersNodeIndices=[],r.inputLayersTensorIndices=[],r.outputLayers=[],r.outputLayersNodeIndices=[],r.outputLayersTensorIndices=[],r.layers=[],r.internalContainerRefs=[];var i,o=x(r.outputs);try{for(o.s();!(i=o.n()).done;){var s=i.value,u=s.sourceLayer,c=s.nodeIndex,l=s.tensorIndex;r.outputLayers.push(u),r.outputLayersNodeIndices.push(c),r.outputLayersTensorIndices.push(l)}}catch(Te){o.e(Te)}finally{o.f()}var d,f=x(r.inputs);try{for(f.s();!(d=f.n()).done;){var m=d.value,v=m.sourceLayer,g=m.nodeIndex,y=m.tensorIndex;sT(0===g,"input layer has >1 nodes"),sT(0===y,"input layer has >1 tensors"),r.inputLayers.push(v),r.inputLayersNodeIndices.push(g),r.inputLayersTensorIndices.push(y)}}catch(Te){f.e(Te)}finally{f.f()}r.inputNames=[],r.outputNames=[],r.feedInputShapes=[],r.feedInputNames=[],r.feedOutputNames=[];for(var b=0;b<r.inputLayers.length;b++){var w=r.inputLayers[b];if(!(w instanceof q_))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. Received inputs: ".concat(e.inputs,". Input ").concat(b," (0-based) originates from layer type ").concat(w.getClassName(),"."));r.inputNames.push(w.name),r.feedInputShapes.push(w.batchInputShape),r.feedInputNames.push(w.name)}var k,S=x(r.outputLayers);try{for(S.s();!(k=S.n()).done;){var _=k.value;r.outputNames.push(_.name)}}catch(Te){S.e(Te)}finally{S.f()}r.internalInputShapes=r.inputs.map((function(e){return e.shape})),r.internalOutputShapes=r.outputs.map((function(e){return e.shape}));var I,E={},C={},M={},N={},R={},L=[],A=function e(t,a,i,o,s,u){(null==o||null==s||null==u)&&(o=t.sourceLayer,s=t.nodeIndex,u=t.tensorIndex);var c=o.inboundNodes[s];if(-1!==i.indexOf(c))throw new tT("The tensor ".concat(t.name,' at layer "').concat(o.name,'" is part of a cycle.'));if(-1===a.indexOf(c)){r.containerNodes.add(n.nodeKey(o,s)),o.id in R||(R[o.id]=Object.keys(R).length),-1===i.indexOf(c)&&i.push(c);for(var l=c.inboundLayers.length,d=0;d<l;d++){e(c.inputTensors[d],a,i,c.inboundLayers[d],c.nodeIndices[d],c.tensorIndices[d])}for(a.push(c);i.indexOf(c)>=0;)i.splice(i.indexOf(c),1);L.push(c)}},P=[],D=[],O=x(r.outputs);try{for(O.s();!(I=O.n()).done;){A(I.value,P,D)}}catch(Te){O.e(Te)}finally{O.f()}var z,F=x(L.slice().reverse());try{for(F.s();!(z=F.n()).done;){var G=z.value;C[G.id]=G,G.id in E||(E[G.id]=0);var W=E[G.id],V=null==M[G.outboundLayer.id]?0:M[G.outboundLayer.id];W=Math.max(W,V),M[G.outboundLayer.id]=W,N[G.outboundLayer.id]=G.outboundLayer,E[G.id]=W;for(var U=0;U<G.inboundLayers.length;U++){var X=G.inboundLayers[U],B=G.nodeIndices[U],H=X.inboundNodes[B],Z=null==E[H.id]?0:E[H.id];E[H.id]=Math.max(W+1,Z),C[H.id]=H}}}catch(Te){F.e(Te)}finally{F.f()}var K={};for(var j in E){var Y=E[j];Y in K||(K[Y]=[]),K[Y].push(C[j])}var Q={};for(var J in M){var q=M[J];q in Q||(Q[q]=[]),Q[q].push(N[J])}var $=Object.keys(Q).map((function(e){return parseInt(e,10)})).sort(gT);r.layers=[];var ee,te=x($);try{for(te.s();!(ee=te.n()).done;){var ne=Q[ee.value];ne.sort((function(e,t){var n=R[e.id],r=R[t.id];return n<r?-1:n>r?1:0}));var re,ae=x(ne);try{for(ae.s();!(re=ae.n()).done;){var ie=re.value;ie instanceof n&&r.internalContainerRefs.push(ie),r.layers.push(ie)}}catch(Te){ae.e(Te)}finally{ae.f()}}}catch(Te){te.e(Te)}finally{te.f()}r.layersByDepth=Q,$=Object.keys(K).map((function(e){return parseInt(e,10)})).sort(gT);var oe,se=r.inputs.slice(),ue=[],ce=x($);try{for(ce.s();!(oe=ce.n()).done;){var le,de=x(K[oe.value]);try{for(de.s();!(le=de.n()).done;){var he=le.value,pe=he.outboundLayer;if(null!=pe){var fe,me=x(he.inputTensors);try{for(me.s();!(fe=me.n()).done;){var ve=fe.value;if(-1===se.indexOf(ve))throw new tT("Graph disconnected: cannot obtain value for tensor ".concat(ve,' at layer "').concat(pe.name,'". The following previous layers were accessed without issue: ').concat(ue))}}catch(Te){me.e(Te)}finally{me.f()}var ge,ye=x(he.outputTensors);try{for(ye.s();!(ge=ye.n()).done;){var be=ge.value;se.push(be)}}catch(Te){ye.e(Te)}finally{ye.f()}ue.push(pe.name)}}}catch(Te){de.e(Te)}finally{de.f()}}}catch(Te){ce.e(Te)}finally{ce.f()}r.nodesByDepth=K;var xe,we=r.layers.map((function(e){return e.name})),ke=x(we);try{var Se=function(){var e=xe.value,t=we.filter((function(t){return t===e})).length;if(1!==t)throw new tT('The name "'.concat(e,'" is used ').concat(t," times in the model. All layer names should be unique. Layer names: ")+JSON.stringify(we))};for(ke.s();!(xe=ke.n()).done;)Se()}catch(Te){ke.e(Te)}finally{ke.f()}return r.outboundNodes=[],r.inboundNodes=[],new j_({outboundLayer:h(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:r.inputs,outputTensors:r.outputs,inputMasks:r.inputs.map((function(e){return null})),outputMasks:r.outputs.map((function(e){return null})),inputShapes:r.inputs.map((function(e){return e.shape})),outputShapes:r.outputs.map((function(e){return e.shape}))}),r.built=!0,r._refCount=1,p(r)}return E(n,[{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Container '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){this.assertNotDisposed();var e={refCountAfterDispose:null,numDisposedVariables:0};if(0===--this._refCount){var t,n=x(this.layers);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.numDisposedVariables+=r.dispose().numDisposedVariables}}catch(s){n.e(s)}finally{n.f()}var a,i=x(this.internalContainerRefs);try{for(i.s();!(a=i.n()).done;){var o=a.value;e.numDisposedVariables+=o.dispose().numDisposedVariables}}catch(s){i.e(s)}finally{i.f()}}return e.refCountAfterDispose=this._refCount,e}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.layers.forEach((function(t){t._trainableWeights.forEach((function(t){return t.trainable=e}))})),this.trainable_=e}},{key:"trainableWeights",get:function(){if(this._trainableWeights.length>0)throw new nT("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];var e,t=[],n=x(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t=t.concat(r.trainableWeights)}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=x(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,b(r.nonTrainableWeights))}}catch(u){n.e(u)}finally{n.f()}if(!this.trainable){var a,i=[],o=x(this.layers);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,b(s.trainableWeights))}}catch(u){o.e(u)}finally{o.f()}return i.concat(t)}return t}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"loadWeights",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r={},a=0,i=x(this.layers);try{for(i.s();!(t=i.n()).done;){var o,s=x(t.value.weights);try{for(s.s();!(o=s.n()).done;){var u=o.value;if(null!=r[u.originalName])throw new nT("Duplicate weight name: ".concat(u.originalName));r[u.originalName]=u,a++}}catch(m){s.e(m)}finally{s.f()}}}catch(m){i.e(m)}finally{i.f()}var c=[];for(var l in e){var d=l;if(null==r[l]){var h=l.split("/");d=h.slice(0,-2).concat([h[h.length-1]]).join("/")}if(null!=r[d])c.push([r[d],e[l]]);else if(n)throw new nT("Provided weight data has no target variable: ".concat(l));delete r[d]}if(n){var p=[];for(var f in r)p.push(f);if(p.length>0)throw new nT("".concat(p.length," of ").concat(a," weights are not set: ").concat(p))}B_(c)}},{key:"updatedConfig",value:function(){var e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers ".concat(sE),t.backend="TensorFlow.js",t}},{key:"toJSON",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=oE(this.updatedConfig());return t?JSON.stringify(n):n}},{key:"call",value:function(e,t){var n=this;return Rf((function(){e=lT(e);for(var r=new eI,a=0;a<n.inputs.length;++a)r.add(n.inputs[a],e[a]);return rI(n.outputs,r,t)}))}},{key:"computeMask",value:function(e,t){var n=this;return Rf((function(){var r;return e=lT(e),r=null==t?oT(null,e.length):lT(t),n.runInternalGraph(e,r)[1]}))}},{key:"computeOutputShape",value:function(e){var t=z_(e);if(t.length!==this.inputLayers.length)throw new nT("Invalid inputShape argument ".concat(e,": model has ").concat(this.inputLayers.length," tensor inputs."));for(var n={},r=0;r<t.length;r++){var a=this.inputLayers[r],i=t[r];n[a.name+"_0_0"]=i}var o=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(gT);if(o.length>1){var s,u=x(o);try{for(u.s();!(s=u.n()).done;){var c,l=s.value,d=x(this.nodesByDepth[l]);try{for(d.s();!(c=d.n()).done;){var h=c.value,p=h.outboundLayer;if(-1===this.inputLayers.map((function(e){return e.id})).indexOf(p.id)){for(var f=[],m=0;m<h.inboundLayers.length;m++){var v=h.inboundLayers[m],g=h.nodeIndices[m],y=h.tensorIndices[m],b=n["".concat(v.name,"_").concat(g,"_").concat(y)];f.push(b)}for(var w=z_(p.computeOutputShape(cT(f))),k=p.inboundNodes.indexOf(h),S=0;S<w.length;S++){n["".concat(p.name,"_").concat(k,"_").concat(S)]=w[S]}}}}catch(A){d.e(A)}finally{d.f()}}}catch(A){u.e(A)}finally{u.f()}}for(var T=[],_=[],I=0;I<this.outputLayers.length;I++){var E=this.outputLayers[I],C=this.outputLayersNodeIndices[I],M=this.outputLayersTensorIndices[I],N="".concat(E.name,"_").concat(C,"_").concat(M);_.push(N)}for(var R=0;R<_.length;R++){var L=_[R];sT(L in n),T.push(n[L])}return cT(T)}},{key:"runInternalGraph",value:function(e,t){null==t&&(t=oT(null,e.length));for(var n={},r=0;r<this.inputs.length;++r){var a=this.inputs[r],o=e[r],s=t[r];n[a.id]=[o,s]}var u,c=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(gT),l=x(c);try{for(l.s();!(u=l.n()).done;){var d,h=u.value,p=x(this.nodesByDepth[h]);try{for(p.s();!(d=p.n()).done;){var f,m=d.value,v=m.outboundLayer,g=m.inputTensors,y=m.outputTensors,b=new Array,w=x(g);try{for(w.s();!(f=w.n()).done;){var k=f.value;k.id in n&&b.push(n[k.id])}}catch(B){w.e(B)}finally{w.f()}if(b.length===g.length){var S={},T=void 0,_=void 0,I=void 0,E=void 0;if(null!=m.callArgs&&(S=m.callArgs),1===b.length){var C=i(b[0],2),M=C[0],N=C[1];null==S.mask&&(S.mask=N),I=lT(v.call(M,S)),E=lT(v.computeMask(M,N)),T=[M],_=[N]}else T=b.map((function(e){return e[0]})),_=b.map((function(e){return e[1]})),null==S.mask&&(S.mask=_),I=lT(v.call(T,S)),E=lT(v.computeMask(T,_));if(v.activityRegularizer)throw new rT("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(var R=0;R<y.length;++R){var L=y[R],A=I[R],P=E[R];n[L.id]=[A,P]}}}}catch(B){p.e(B)}finally{p.f()}}}catch(B){l.e(B)}finally{l.f()}var D,O=[],z=[],F=[],G=x(this.outputs);try{for(G.s();!(D=G.n()).done;){var W=D.value;sT(W.id in n,"Could not compute output ".concat(W.name," : ").concat(W.id));var V=i(n[W.id],2),U=V[0],X=V[1];F.push(U.shape),O.push(U),z.push(X)}}catch(B){G.e(B)}finally{G.f()}return[O,z,F]}},{key:"buildNodeConversionMap",value:function(e){var t,r,a={},i=x(this.layers);try{for(i.s();!(r=i.n()).done;){var o=r.value;t=o instanceof n?1:0;for(var s=0;s<o.inboundNodes.length;s++){var u=n.nodeKey(o,s);this.containerNodes.has(u)&&(a[u]=t,t+=1)}}}catch(c){i.e(c)}finally{i.f()}return a}},{key:"getLayer",value:function(e,t){if(null!=t){if(this.layers.length<=t)throw new nT("Was asked to retrieve layer at index ".concat(t,", but model only has ").concat(this.layers.length," layer(s)."));return this.layers[t]}if(null==e)throw new nT("Provide either a layer name or layer index");var n,r=x(this.layers);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.name===e)return a}}catch(i){r.e(i)}finally{r.f()}throw new nT("No such layer: ".concat(e))}},{key:"calculateLosses",value:function(){var e=this;return Rf((function(){var t,r=[],a=x(e.layers);try{for(a.s();!(t=a.n()).done;)for(var i=t.value,o=0;o<i.inboundNodes.length;++o){var s=n.nodeKey(i,o);e.containerNodes.has(s)&&r.push.apply(r,b(i.calculateLosses()))}}catch(u){a.e(u)}finally{a.f()}return r}))}},{key:"getConfig",value:function(){var e,t={name:this.name},r=this.buildNodeConversionMap(this.layers),a=[],i=x(this.layers);try{for(i.s();!(e=i.n()).done;){for(var o=e.value,s=o.getClassName(),u=o.getConfig(),c=[],l=0;l<o.inboundNodes.length;l++){var d=o.inboundNodes[l],h=n.nodeKey(o,l),p={};if(this.containerNodes.has(h)){if(d.callArgs)try{JSON.stringify(d.callArgs),p=d.callArgs}catch(O){console.warn("Layer ".concat(o.name," was passed non-serializable keyword arguments: ").concat(d.callArgs,". They will not be included in the serialized model (and thus will be missing at deserialization time).")),p={}}if(d.inboundLayers.length>0){for(var f=[],m=0;m<d.inboundLayers.length;m++){var v=d.inboundLayers[m],g=d.nodeIndices[m],y=d.tensorIndices[m],b=r[n.nodeKey(v,g)];null==b&&(b=0),f.push([v.name,b,y,p])}c.push(f)}}}var w={};w.name=o.name,w.className=s,w.config=u,w.inboundNodes=c,a.push(w)}}catch(z){i.e(z)}finally{i.f()}t.layers=a;for(var k=[],S=0;S<this.inputLayers.length;S++){var T=this.inputLayers[S],_=this.inputLayersNodeIndices[S],I=n.nodeKey(T,_);if(this.containerNodes.has(I)){var E=r[I];null==E&&(E=0);var C=this.inputLayersTensorIndices[S];k.push([T.name,E,C])}}t.inputLayers=k;for(var M=[],N=0;N<this.outputLayers.length;N++){var R=this.outputLayers[N],L=this.outputLayersNodeIndices[N],A=n.nodeKey(R,L);if(this.containerNodes.has(A)){var P=r[A];null==P&&(P=0);var D=this.outputLayersTensorIndices[N];M.push([R.name,P,D])}}return t.outputLayers=M,t}},{key:"stateful",get:function(){if(this._stateful)throw new nT("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");var e,t=x(this.layers);try{for(t.s();!(e=t.n()).done;){if(e.value.stateful)return!0}}catch(n){t.e(n)}finally{t.f()}return!1}},{key:"resetStates",value:function(){var e=this;Rf((function(){e.layers.forEach((function(e){e.stateful&&e.resetStates()}))}))}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r={},a={};function i(e,t){e.name in a?a[e.name].push(t):a[e.name]=[t]}function o(e,t){var n,a,o=[],s=x(t);try{for(s.s();!(a=s.n()).done;){var u=a.value,c=u[0],l=u[1],d=u[2];if(n=null==u[3]?{}:u[3],!(c in r))return void i(e,t);var h=r[c];if(h.inboundNodes.length<=l)return void i(e,t);var p=h.inboundNodes[l];o.push(p.outputTensors[d])}}catch(f){s.e(f)}finally{s.f()}o.length>0&&e.apply(cT(o),n)}function s(e){var a=e.name,o=MI(e,null!=t.customObjects?t.customObjects:{});o.setFastWeightInitDuringBuild(n),r[a]=o,e.inboundNodes.forEach((function(e){if(!(e instanceof Array))throw new nT("Corrupted configuration, expected array for nodeData: ".concat(e));i(o,e)}))}var u,c=t.name,l=t.layers,d=x(l);try{for(d.s();!(u=d.n()).done;){s(u.value)}}catch(O){d.e(O)}finally{d.f()}for(;!bT(a);){var h,p=x(l);try{for(p.s();!(h=p.n()).done;){var f=h.value,m=r[f.name];if(m.name in a){var v=a[m.name];delete a[m.name];var g,y=x(v);try{for(y.s();!(g=y.n()).done;){o(m,g.value)}}catch(O){y.e(O)}finally{y.f()}}}}catch(O){p.e(O)}finally{p.f()}}var b,w=[],k=[],S=x(t.inputLayers);try{for(S.s();!(b=S.n()).done;){var T=b.value,_=T[0],I=T[1],E=T[2];sT(_ in r);var C=r[_].inboundNodes[I].outputTensors;w.push(C[E])}}catch(O){S.e(O)}finally{S.f()}var M,N=x(t.outputLayers);try{for(N.s();!(M=N.n()).done;){var R=M.value,L=R[0],A=R[1],P=R[2];sT(L in r);var D=r[L].inboundNodes[A].outputTensors;k.push(D[P])}}catch(O){N.e(O)}finally{N.f()}return new e({inputs:w,outputs:k,name:c})}}]),n}(Q_);function cE(e,t){return function(e,t,n){var r=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return null}));if(1===r)return Array.isArray(e)&&1===e.length?e:"object"==typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error("Provided ".concat(n," is an array of ").concat(e.length," element(s), but the model has ").concat(r," outputs. Make sure a set of weights is provided for each model output."));return e}if("object"==typeof e&&Object.keys(e).length>0&&"object"==typeof e[Object.keys(e)[0]]){var a=[];return t.forEach((function(t){t in e?a.push(e[t]):a.push(null)})),a}throw new Error("The model has multiple (".concat(r,") outputs, so ").concat(n," must be either an array with ").concat(r," elements or an object with ").concat(t," keys. Provided ").concat(n," not understood: ").concat(JSON.stringify(e)))}(e,t,"classWeight")}function lE(e,t,n,r){return dE.apply(this,arguments)}function dE(){return dE=S(w().mark((function e(t,n,r,a){var i,o,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&null==a){e.next=2;break}throw new Error("Support sampleWeight is not implemented yet");case 2:if(null==r){e.next=14;break}return i=Rf((function(){if(1===t.shape.length)return pf(t);if(2===t.shape.length){if(t.shape[1]>1)return Dm(t,1);if(1===t.shape[1])return nv(t,[t.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(t.shape[1],") during handling of class weights. The size is expected to be >= 1."))}throw new Error("Unexpected rank of target (y) tensor (".concat(t.rank,") during handling of class weights. The rank is expected to be 1 or 2."))})),e.t0=Array,e.next=7,i.data();case 7:return e.t1=e.sent,o=e.t0.from.call(e.t0,e.t1),Lf(i),s=[],e.abrupt("return",(o.forEach((function(e){if(null==r[e])throw new Error("classWeight must contain all classes in the training data. The class ".concat(e," exists in the data but not in classWeight"));s.push(r[e])})),ab(s,"float32")));case 14:return e.abrupt("return",null);case 15:case"end":return e.stop()}}),e)}))),dE.apply(this,arguments)}function hE(e,t){return Mm(e,t)}var pE=32;function fE(e,t){var n,r,a=t;n=a.xs,r=a.ys,ls(null!=n&&null!=r,(function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ".concat(t)}));var i=mE("input",e.inputNames,n),o=mE("output",e.outputNames,r),s=i[0].shape[0];ls(i.length===e.inputs.length,(function(){return"LayersModel has ".concat(e.inputs.length," inputs, but the dataset provides ").concat(i.length," inputs.  (Expected input keys: ").concat(JSON.stringify(e.inputNames),")")})),ls(o.length===e.outputs.length,(function(){return"LayersModel has ".concat(e.outputs.length," outputs, but the dataset provides ").concat(o.length," outputs.  (Expected output keys: ").concat(JSON.stringify(e.outputNames),")")}));for(var u=function(t){ls(i[t].shape[0]===s,(function(){return"Batch size mismatch: input ".concat(e.inputNames[t]," has ").concat(i[t].shape[0],"; expected  ").concat(s," based on input ").concat(e.inputNames[0],".")}))},c=0;c<i.length;c++)u(c);for(var l=function(t){ls(o[t].shape[0]===s,(function(){return"Batch size mismatch: output ".concat(e.outputNames[t]," has ").concat(o[t].shape[0],"; expected  ").concat(s," based on input ").concat(e.inputNames[0],".")}))},d=0;d<o.length;d++)l(d);return{xs:i,ys:o}}function mE(e,t,n){if(n instanceof kh)return[n];if(Array.isArray(n))return ls(n.length===t.length,(function(){return"Received an array of ".concat(n.length," Tensors, but expected ").concat(t.length," to match the ").concat(e," keys ").concat(t,".")})),n;var r,a=[],i=x(t);try{for(i.s();!(r=i.n()).done;){var o=r.value;if(null==n[o])throw new nT("The feature data generated by the dataset lacks the required ".concat(e," key '").concat(o,"'."));a.push(n[o])}}catch(s){i.e(s)}finally{i.f()}return a}function vE(e){if(3===e.length)throw new rT("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}function gE(e,t,n){return yE.apply(this,arguments)}function yE(){return yE=S(w().mark((function e(t,n,r){var a,i,o,s,u,c,l,d,h,p,f,m,v,g,y,b,x,k,S,T,_,I,E,C,M,N,R,L,A,P,D,O,z;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!=r.batchesPerEpoch,ls(null!=t.optimizer,(function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."})),ls(null!=r,(function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."})),ls(null!=r.epochs&&r.epochs>0&&Number.isInteger(r.epochs),(function(){return"For fitDataset(), config.epochs is expected to be a positive integer, but got ".concat(r.epochs)})),ls(!a||r.batchesPerEpoch>0&&Number.isInteger(r.batchesPerEpoch),(function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ".concat(r.batchesPerEpoch)})),ls(null==r.validationSplit,(function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."})),!t.isTraining){e.next=3;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 3:return t.isTraining=!0,e.prev=4,(i=null!=r.validationData)&&(xE(r.validationData)?ls(null==r.validationBatches||r.validationBatches>0&&Number.isInteger(r.validationBatches),(function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ".concat(r.validationBatches)})):(u=vE(r.validationData),o=u.xs,s=u.ys)),c=t.makeTrainFunction(),l=t.getDedupedMetricsNames(),d=i?l.slice().concat(l.map((function(e){return"val_"+e}))):l.slice(),h=II(r.callbacks,r.yieldEvery),p=null==r.verbose?1:r.verbose,f=CI(h,p,r.epochs,null,null,bE(n,r),null,i,d),m=f.callbackList,v=f.history,m.setModel(t),t.history=v,e.next=14,m.onTrainBegin();case 14:return t.stopTraining_=!1,g=null==r.initialEpoch?0:r.initialEpoch,e.next=18,n.iterator();case 18:y=e.sent;case 19:if(!(g<r.epochs)){e.next=88;break}return b={},e.next=23,m.onEpochBegin(g);case 23:if(x=0,k=0,e.t0=a,e.t0){e.next=29;break}return e.next=28,n.iterator();case 28:y=e.sent;case 29:if(a&&!(x<r.batchesPerEpoch)){e.next=81;break}return e.next=32,y.next();case 32:if(S=e.sent,!a||!S.done){e.next=36;break}return console.warn("You provided `batchesPerEpoch` as ".concat(r.batchesPerEpoch,", but your dataset iterator ran out of data after ").concat(x," batches; interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, ").concat(r.batchesPerEpoch*r.epochs," batches). You may need to use the repeat() function when building your dataset.")),e.abrupt("break",81);case 36:if(null==S.value){e.next=63;break}return T=fE(t,S.value),_=T.xs,I=T.ys,(E={}).batch=k,E.size=_[0].shape[0],e.next=42,m.onBatchBegin(k,E);case 42:if(C=[],null==r.classWeight){e.next=55;break}M=cE(r.classWeight,t.outputNames),N=0;case 46:if(!(N<M.length)){e.next=55;break}return e.t1=C,e.next=50,lE(I[N],null,M[N]);case 50:e.t2=e.sent,e.t1.push.call(e.t1,e.t2);case 52:++N,e.next=46;break;case 55:for(R=_.concat(I).concat(C),L=c(R),Lf(R),A=0;A<l.length;++A)P=l[A],D=L[A],E[P]=D,Af(D);return e.next=60,m.onBatchEnd(k,E);case 60:xI(E),k++,x++;case 63:if(!(a?x>=r.batchesPerEpoch:S.done)){e.next=77;break}if(!i){e.next=76;break}if(O=void 0,!xE(r.validationData)){e.next=74;break}return e.t3=lT,e.next=70,t.evaluateDataset(r.validationData,{batches:r.validationBatches});case 70:e.t4=e.sent,O=(0,e.t3)(e.t4),e.next=75;break;case 74:O=lT(t.evaluate(o,s,{batchSize:null==r.validationBatchSize?pE:r.validationBatchSize,verbose:0}));case 75:for(z=0;z<t.metricsNames.length;++z)b["val_".concat(t.metricsNames[z])]=O[z];case 76:return e.abrupt("break",81);case 77:if(!t.stopTraining_){e.next=79;break}return e.abrupt("break",81);case 79:e.next=29;break;case 81:return e.next=83,m.onEpochEnd(g,b);case 83:if(g++,!t.stopTraining_){e.next=86;break}return e.abrupt("break",88);case 86:e.next=19;break;case 88:return e.next=90,m.onTrainEnd();case 90:return e.next=92,t.history.syncData();case 92:return e.abrupt("return",t.history);case 93:return e.prev=93,t.isTraining=!1,e.finish(93);case 96:case"end":return e.stop()}}),e,null,[[4,,93,96]])}))),yE.apply(this,arguments)}function bE(e,t){var n=null;return null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}function xE(e){return"function"==typeof e.iterator}function wE(e){return"function"==typeof e.next}function kE(e,t,n){return SE.apply(this,arguments)}function SE(){return SE=S(w().mark((function e(t,n,r){var a,i,o,s,u,c,l,d,h;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!=(r=r||{}).batches,i=t.testFunction,o=[],!(r.verbose>0)){e.next=5;break}throw new rT("Verbose mode is not implemented yet.");case 5:if(ls(!a||r.batches>0&&Number.isInteger(r.batches),(function(){return"Test loop expects `batches` to be a positive integer, but received ".concat(JSON.stringify(r.batches))})),!wE(n)){e.next=10;break}e.t0=n,e.next=13;break;case 10:return e.next=12,n.iterator();case 12:e.t0=e.sent;case 13:s=e.t0,u=0,c=0,l=w().mark((function e(){var n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.next();case 2:if(n=e.sent,o=Rf((function(){if(n.value){var e=fE(t,n.value),r=e.xs,a=e.ys,s=r.concat(a),l=Rf((function(){return i(s)}));if(Lf(s),0===c)for(var d=0;d<l.length;++d)o.push(ng(0));for(var h=s[0].shape[0],p=function(e){var t=l[e],n=o[e];o[e]=Rf((function(){return Im(o[e],Mm(h,t))})),c>0&&Lf(n)},f=0;f<l.length;++f)p(f);Lf(l),u+=h,++c}return o})),!n.done){e.next=6;break}return a&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` batches (in this case, ".concat(r.batches," batches). You may need to use the repeat() function when building your dataset.")),e.abrupt("return","break");case 6:case"end":return e.stop()}}),e)}));case 16:if(a&&!(c<r.batches)){e.next=23;break}return e.delegateYield(l(),"t1",18);case 18:if("break"!==e.t1){e.next=21;break}return e.abrupt("break",23);case 21:e.next=16;break;case 23:for(d=0;d<o.length;++d)h=o[d],o[d]=Cm(o[d],u),Lf(h);return e.abrupt("return",cT(o));case 25:case"end":return e.stop()}}),e)}))),SE.apply(this,arguments)}function TE(e){ls(e>0&&Number.isInteger(e),(function(){return"batchSize is required to be a positive integer, but got ".concat(e)}))}function _E(e,t,n){return null==e?[null]:Array.isArray(e)?e.map((function(e){return e_(e,t,n-t)})):e_(e,t,n-t)}function IE(e,t){return Rf((function(){return null==e?null:Array.isArray(e)?e.map((function(e){return IE(e,t)})):u_(e,"int32"===t.dtype?t:hf(t,"int32"))}))}function EE(e,t){for(var n=[],r=0,a=null;r<e;)(a=r+t)>=e&&(a=e),n.push([r,a]),r=a;return n}function CE(e,t,n,r,a,i,o,s,u,c,l,d,h,p,f){return ME.apply(this,arguments)}function ME(){return ME=S(w().mark((function e(t,n,r,a,i,o,s,u,c,l,d,h,p,f,m){var v,g,y,b,x,k,S,T;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==i&&(i=32),null==o&&(o=1),null==d&&(d=!0),null==p&&(p=0),v=!1,null!=c&&null!=l&&(v=!0),null==m||(v=!0,null!=f)){e.next=4;break}throw new nT("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");case 4:return null!=(g=t.checkNumSamples(r,i,f,"steps_per_epoch"))&&(y=QT(0,g)),null==s&&(s=1),b=CI(u,s,o,p,g,f,i,v,h),x=b.callbackList,k=b.history,x.setModel(t),t.history=k,e.next=11,x.onTrainBegin();case 11:t.stopTraining_=!1,S=w().mark((function e(){var o,s,u,h,p;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.onEpochBegin(T);case 2:if(o={},null==f){e.next=5;break}throw new rT("stepsPerEpoch mode is not implemented yet.");case 5:if("batch"!==d){e.next=7;break}throw new rT("batch shuffling is not implemneted yet");case 7:d&&is(y),s=ab(y),u=EE(g,i),h=w().mark((function e(d){var h;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h={},e.next=3,x.onBatchBegin(d,h);case 3:return Rf((function(){var e=u[d][0],p=u[d][1],f=e_(s,e,p-e);h.batch=d,h.size=p-e;for(var m=IE(r,f),g=n(m),y=0;y<a.length;++y){var b=a[y],x=g[y];h[b]=x,Af(x)}if(d===u.length-1&&v)for(var w=t.testLoop(c,l,i),k=0;k<a.length;++k){var S=a[k],T=w[k];Af(T),o["val_"+S]=T}})),e.next=6,x.onBatchEnd(d,h);case 6:if(xI(h),!t.stopTraining_){e.next=9;break}return e.abrupt("return","break");case 9:case"end":return e.stop()}}),e)})),p=0;case 11:if(!(p<u.length)){e.next=19;break}return e.delegateYield(h(p),"t0",13);case 13:if("break"!==e.t0){e.next=16;break}return e.abrupt("break",19);case 16:++p,e.next=11;break;case 19:return s.dispose(),e.next=22,x.onEpochEnd(T,o);case 22:if(!t.stopTraining_){e.next=24;break}return e.abrupt("return","break");case 24:case"end":return e.stop()}}),e)})),T=p;case 14:if(!(T<o)){e.next=22;break}return e.delegateYield(S(),"t0",16);case 16:if("break"!==e.t0){e.next=19;break}return e.abrupt("break",22);case 19:++T,e.next=14;break;case 22:return e.next=24,x.onTrainEnd();case 24:return e.next=26,t.history.syncData();case 26:return e.abrupt("return",t.history);case 27:case"end":return e.stop()}}),e)}))),ME.apply(this,arguments)}function NE(e,t,n){return RE.apply(this,arguments)}function RE(){return RE=S(w().mark((function e(t,n,r){var a,i,o,s,u,c,l,d,h,p,f,m,v,g,y,b,x,k,S,T,_,I,E,C=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=C.length>3&&void 0!==C[3]?C[3]:{},!t.isTraining){e.next=3;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 3:return t.isTraining=!0,e.prev=4,TE(f=null==a.batchSize?32:a.batchSize),!1,e.next=10,t.standardizeUserData(n,r,a.sampleWeight,a.classWeight,false,f);case 10:if(m=e.sent,i=m[0],o=m[1],p=m[2],v=!1,!(null!=a.validationData&&a.validationData.length>0)){e.next=26;break}if(v=!0,2!==a.validationData.length){e.next=18;break}c=a.validationData[0],l=a.validationData[1],e.next=19;break;case 18:throw 3===a.validationData.length?new rT("validationData including sample weights is not supported yet."):new nT("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ".concat(a.validationData," is invalid."));case 19:return!0,e.next=22,t.standardizeUserData(c,l,null,null,true,f);case 22:y=e.sent,d=y[0],h=y[1],g=d.concat(h),e.next=27;break;case 26:null!=a.validationSplit&&a.validationSplit>0&&a.validationSplit<1?(v=!0,b=Math.floor(i[0].shape[0]*(1-a.validationSplit)),x=i[0].shape[0],d=_E(i,b,x),s=i,i=_E(i,0,b),h=_E(o,b,x),u=o,o=_E(o,0,b),g=d.concat(h)):null!=a.validationSteps&&(v=!0);case 27:return k=i.concat(o).concat(p),t.checkTrainableWeightsConsistency(),S=t.makeTrainFunction(),T=t.getDedupedMetricsNames(),v?(t.makeTestFunction(),_=t.testFunction,I=T.slice().concat(T.map((function(e){return"val_"+e})))):(_=null,g=[],I=T.slice()),E=II(a.callbacks,a.yieldEvery),e.next=34,CE(t,S,k,T,f,a.epochs,a.verbose,E,_,g,a.shuffle,I,a.initialEpoch,null,null);case 34:return e.abrupt("return",e.sent);case 35:return e.prev=35,t.isTraining=!1,AE(i,n),AE(o,r),AE(s,n),AE(u,r),AE(d,c),AE(h,l),null!=p&&Lf(p),e.finish(35);case 38:case"end":return e.stop()}}),e,null,[[4,,35,38]])}))),RE.apply(this,arguments)}function LE(e){var t=[];e instanceof kh&&(e=[e]);for(var n=0;n<e.length;++n){var r=e[n];if(1===r.rank)t.push($T(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function AE(e,t){if(null!=e){var n=[];if(t instanceof kh)n.push(t.id);else if(Array.isArray(t))t.forEach((function(e){return n.push(e.id)}));else if(null!=t)for(var r in t){var a=t[r];n.push(a.id)}var i=[];if(e instanceof kh)-1===n.indexOf(e.id)&&i.push(e);else if(Array.isArray(e))e.forEach((function(e){-1===n.indexOf(e.id)&&i.push(e)}));else if(null!=e)for(var o in e){var s=e[o];-1===n.indexOf(s.id)&&i.push(s)}i.forEach((function(e){e.isDisposed||e.dispose()}))}}function PE(e){return Array.isArray(e)}function DE(e){return!function(e){return e instanceof kh}(e)&&!PE(e)}function OE(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(null==t||0===t.length){if(null!=e){var o=!1;if(PE(e)&&e.length>0)o=!0;else if(DE(e)){for(var s in e)if(e.hasOwnProperty(s)){o=!0;break}}else o=!0;if(o)throw new nT("Error when checking model ".concat(i," expected no data, but got ").concat(e))}return[]}if(null==e)return t.map((function(e){return null}));if(DE(e)){r=[];var u,c=x(t);try{for(c.s();!(u=c.n()).done;){var l=u.value;if(null==e[l])throw new nT('No data provided for "'.concat(l,'". Need data for each key in: ').concat(t));r.push(e[l])}}catch(v){c.e(v)}finally{c.f()}}else if(PE(e)){if(e.length!==t.length)throw new nT("Error when checking model ".concat(i,": the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ").concat(t.length," Tensor(s), but instead got the following list of Tensor(s): ").concat(e));r=e}else{if(t.length>1)throw new nT("The model ".concat(i," expects ").concat(t.length," Tensor(s), but only received one Tensor. Found: Tensor with shape ").concat(e.shape));r=[e]}if(r=LE(r),null!=n)for(var d=0;d<t.length;++d)if(null!=n[d]){var h=r[d];if(h.shape.length!==n[d].length)throw new nT("Error when checking ".concat(i,": expected ").concat(t[d]," to have ").concat(n[d].length," dimension(s). but got array with shape ").concat(h.shape));for(var p=0;p<n[d].length;++p)if(0!==p||a){var f=h.shape[p],m=n[d][p];if(null!=m&&m>=0&&f!==m)throw new nT("".concat(i," expected a batch of elements where each example has shape [").concat(n[d].slice(1,n[d].length),"] (i.e.,tensor shape [*,").concat(n[d].slice(1,n[d].length),"]) but the ").concat(i," received an input with ").concat(h.shape[0]," examples, each with shape [").concat(h.shape.slice(1,h.shape.length),"] (tensor shape [").concat(h.shape,"])"))}}return r}function zE(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(Array.isArray(e)){if(e.length!==t.length)throw new nT("Error when checking model ".concat(i,": the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ").concat(t.length," Tensor(s), but instead got ").concat(e.length," Tensors(s)."));r=e}else{if(t.length>1)throw new nT("The model expects ".concat(t.length," ").concat(i," Tensors, but only received one Tensor. Found: array with shape ").concat(JSON.stringify(e.shape),"."));r=[e]}if(null!=n)for(var o=0;o<t.length;++o)if(null!=n[o]){var s=r[o];if(s.shape.length!==n[o].length)throw new nT("Error when checking ".concat(i,": expected ").concat(t[o]," to have ").concat(n[o].length," dimension(s), but got array with shape ").concat(JSON.stringify(s.shape)));for(var u=0;u<n[o].length;++u)if(0!==u||a){var c=s.shape[u],l=n[o][u];if(null!=l&&l!==c)throw new nT("Error when checking ".concat(i,": expected ").concat(t[o]," to have shape ").concat(JSON.stringify(n[o])," but got array with shape ").concat(JSON.stringify(s.shape),"."))}}}var FE=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this,e)).isTraining=!1,r}return E(n,[{key:"summary",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;if(!this.built)throw new nT("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");eE(this,e,t,n)}},{key:"compile",value:function(e){var t=this;if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"==typeof e.optimizer)this.optimizer_=function(e){var t={Adagrad:function(){return Wx.adagrad(.01)},Adadelta:function(){return Wx.adadelta(1,.95,JT())},Adam:function(){return Wx.adam(.001,.9,.999,JT())},Adamax:function(){return Wx.adamax(.002,.9,.999,JT(),0)},RMSProp:function(){return Wx.rmsprop(.001,.9,0,JT())},SGD:function(){return Wx.sgd(.01)}};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new nT("Unknown Optimizer ".concat(e))}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Nx))throw new nT("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}var n=[];if(Array.isArray(e.loss)||"string"==typeof e.loss||"function"==typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new nT("When passing an Array as loss, it should have one entry per model output. The model has ".concat(this.outputs.length," output(s), but you passed loss=").concat(e.loss,"."));n=e.loss.map((function(e){return GI(e)}))}else{var r=GI(e.loss);this.outputs.forEach((function(e){n.push(r)}))}else{for(var a in e.loss=e.loss,e.loss)if(-1===this.outputNames.indexOf(a))throw new nT('Unknown entry in loss dictionary: "'.concat(a,'". Only expected the following keys: ').concat(this.outputNames));var i,o=x(this.outputNames);try{for(o.s();!(i=o.n()).done;){var s=i.value;null==e.loss[s]&&console.warn('Output "'.concat(s,'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ').concat(s," during training")),n.push(GI(e.loss[s]))}}catch(p){o.e(p)}finally{o.f()}}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var u=0;u<this.outputs.length;++u){var c=this.internalOutputShapes[u],l=this.outputNames[u];this.feedOutputNames.push(l),this.feedOutputShapes.push(c),this.feedLossFns.push(this.lossFunctions[u])}var d=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],WT("loss",(function(){for(var e=0;e<t.outputs.length;++e)if(-1===d.indexOf(e)){var n=t.lossFunctions[e];t.outputs.length>1&&(t.metricsTensors.push([n,e]),t.metricsNames.push(t.outputNames[e]+"_loss"))}}));var h=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return[]}));var n;if("string"==typeof e||"function"==typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!=typeof e)throw new TypeError("Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ".concat(e));n=e}if(Array.isArray(n))return t.map((function(e){return n}));var r,a=[],i=x(t);try{for(i.s();!(r=i.n()).done;){var o=r.value,s=n.hasOwnProperty(o)?n[o]:[];Array.isArray(s)||(s=[s]),a.push(s)}}catch(p){i.e(p)}finally{i.f()}return a}(e.metrics,this.outputNames);WT("metric",(function(){for(var e=function(e){if(-1!==d.indexOf(e))return"continue";!function(n){var r,a,i,o,s=x(n);try{var u=function(){var n,s=o.value;if("string"==typeof s&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(s)){var u,c=t.internalOutputShapes[e];1===c[c.length-1]||t.lossFunctions[e]===OI?-1!==["accuracy","acc"].indexOf(s)?a=WI:-1!==["crossentropy","ce"].indexOf(s)&&(a=HI):t.lossFunctions[e]===DI?-1!==["accuracy","acc"].indexOf(s)?a=ZI:-1!==["crossentropy","ce"].indexOf(s)&&(a=jI):-1!==["accuracy","acc"].indexOf(s)?a=VI:-1!==["crossentropy","ce"].indexOf(s)&&(a=KI),-1!==["accuracy","acc"].indexOf(s)?u="acc":-1!==["crossentropy","ce"].indexOf(s)&&(u="ce"),i=a,r=""+u}else i=function(e){if("string"==typeof e&&e in YI)return YI[e];if("string"!=typeof e&&null!=e)return e;throw new nT("Unknown metric ".concat(e))}(s),r=""+QI(s);WT(r,(function(){n=i})),function(e,n,r){t.outputNames.length>1&&(n=t.outputNames[e]+"_"+n),t.metricsNames.push(n),t.metricsTensors.push([r,e])}(e,r,n)};for(s.s();!(o=s.n()).done;)u()}catch(p){s.e(p)}finally{s.f()}}(h[e])},n=0;n<t.outputs.length;++n)e(n)})),this.collectedTrainableWeights=this.trainableWeights}},{key:"checkTrainableWeightsConsistency",value:function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=null==n.batchSize?32:n.batchSize;TE(r);var a=this.standardizeUserDataXY(e,t,!0,r);try{var i=a[0].concat(a[1]);this.makeTestFunction();var o=this.testFunction;return cT(this.testLoop(o,i,r,n.verbose,n.steps))}finally{AE(a[0],e),AE(a[1],t)}}},{key:"evaluateDataset",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.makeTestFunction(),kE(this,t,n)));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"checkNumSamples",value:function(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"steps";if(null!=n){if(r=null,null!=t)throw new nT("If ".concat(a," is set, batchSize must be null or undefined.Got batchSize = ").concat(t))}else{if(null==e)throw new nT("Either the input data should have a defined shape, or ".concat(a," shoud be specified."));r=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return r}},{key:"execute",value:function(e,t){if(Array.isArray(t)&&0===t.length)throw new nT("`outputs` is an empty Array, which is not allowed.");var n=Array.isArray(t),r=n?t:[t],a=this.retrieveSymbolicTensors(r),i=new eI;if(e instanceof kh&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new nT("The number of inputs provided (".concat(e.length,") does not match the number of inputs of this model (").concat(this.inputs.length,")."));for(var o=0;o<this.inputs.length;++o)i.add(this.inputs[o],e[o])}else{var s,u=x(this.inputs);try{for(u.s();!(s=u.n()).done;){var c=s.value,l=e[c.name];if(null==l)throw new nT("No value is provided for the model's input ".concat(c.name));i.add(c,l)}}catch(h){u.e(h)}finally{u.f()}}var d=rI(a,i);return n?d:d[0]}},{key:"retrieveSymbolicTensors",value:function(e){var t,n=oT(null,e.length),r=e.length,a=x(this.layers);try{for(a.s();!(t=a.n()).done;){for(var i=t.value,o=Array.isArray(i.output)?i.output:[i.output],s=o.map((function(e){return e.name})),u=0;u<e.length;++u){var c=s.indexOf(e[u]);if(-1!==c&&(n[u]=o[c],r--),0===r)break}if(0===r)break}}catch(d){a.e(d)}finally{a.f()}if(r>0){var l=[];throw n.forEach((function(t,n){null==t&&l.push(e[n])})),new nT("Cannot find SymbolicTensors for output name(s): ".concat(JSON.stringify(l)))}return n}},{key:"predictLoop",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Rf((function(){var a=t.checkNumSamples(e);if(r)throw new rT("Verbose predictLoop() is not implemented yet.");for(var i=EE(a,n),o=t.outputs.map((function(e){return[]})),s=function(n){Rf((function(){var r=i[n][0],a=i[n][1],o=_E(e,r,a),s=[];if(Array.isArray(o))for(var u=0;u<o.length;++u)s.push({key:t.inputs[u],value:o[u]});else s.push({key:t.inputs[0],value:o});var c=new eI(s);return rI(t.outputs,c)})).forEach((function(e,t){return o[t].push(e)}))},u=0;u<i.length;++u)s(u);return cT(o.map((function(e){return iv(e,0)})))}))}},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=LE(e);zE(n,this.inputNames,this.feedInputShapes,!1);try{var r=null==t.batchSize?32:t.batchSize;return TE(r),this.predictLoop(n,r)}finally{AE(n,e)}}},{key:"predictOnBatch",value:function(e){zE(e,this.inputNames,this.feedInputShapes,!0);var t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}},{key:"standardizeUserDataXY",value:function(e,t){var n=arguments.length>3?arguments[3]:void 0;if(null==this.optimizer_)throw new tT("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var r=[],a=0;a<this.feedOutputShapes.length;++a){var i=this.feedOutputShapes[a];this.feedLossFns[a]===DI?r.push(i.slice(0,i.length-1).concat([1])):r.push(i)}if(function(e,t,n){var r=yT(e.map((function(e){return e.shape[0]})));r.sort();var a=yT(t.map((function(e){return e.shape[0]})));if(a.sort(),r.length>1)throw new nT("All input Tensors (x) should have the same number of samples. Got array shapes: ".concat(JSON.stringify(e.map((function(e){return e.shape})))));if(a.length>1)throw new nT("All target Tensors (y) should have the same number of samples. Got array shapes: ".concat(JSON.stringify(t.map((function(e){return e.shape})))));if(r.length>0&&a.length>0&&!ms(r,a))throw new nT("Input Tensors should have the same number of samples as target Tensors. Found ".concat(r[0]," input sample(s) and ").concat(a[0]," target sample(s)."))}(e=OE(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=OE(t,this.feedOutputNames,r,!1,"target")),function(e,t,n){for(var r=[RI,OI,PI],a=0;a<e.length;++a){var i=e[a],o=t[a],s=n[a];if(null!=o){if(o===PI&&1===i.shape[i.shape.length-1])throw new nT("You are passing a target array of shape ".concat(i.shape," while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes]."));if(-1!==r.indexOf(o))for(var u=i.shape.slice(1),c=s.slice(1),l=0;l<u.length;++l){var d=u[l],h=c[l];if(null!=h&&d!==h)throw new nT("A target Tensor with shape ".concat(i.shape," was passed for an output of shape ").concat(s,", while using a loss function that expects targets to have the same shape as the output."))}}}}(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=n&&n>0&&e[0].shape[0]%n!==0)throw new nT("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ".concat(n,". Found: ").concat(e[0].shape[0]," sample(s)."));return[e,t]}},{key:"standardizeUserData",value:function(){var e=S(w().mark((function e(t,n,r,a){var o,s,u,c,l,d,h,p,f,m=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=!(m.length>4&&void 0!==m[4])||m[4],s=m.length>5?m[5]:void 0,u=this.standardizeUserDataXY(t,n,o,s),c=i(u,2),l=c[0],d=c[1],null==r){e.next=5;break}throw new Error("sample weight is not supported yet.");case 5:if(h=null,null==a){e.next=19;break}p=cE(a,this.outputNames),h=[],f=0;case 10:if(!(f<p.length)){e.next=19;break}return e.t0=h,e.next=14,lE(d[f],null,p[f]);case 14:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 16:++f,e.next=10;break;case 19:return e.abrupt("return",[l,d,h]);case 20:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"testLoop",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0;return Rf((function(){var o=r.checkNumSamples(t,n,i,"steps"),s=[];if(a>0)throw new rT("Verbose mode is not implemented yet.");if(null!=i)throw new rT("steps mode in testLoop() is not implemented yet");for(var u=EE(o,n),c=ab(QT(0,o)),l=0;l<u.length;++l){var d=u[l][0],h=u[l][1],p=e_(c,d,h-d),f=IE(t,p),m=e(f);if(0===l)for(var v=0;v<m.length;++v)s.push(ng(0));for(var g=0;g<m.length;++g){var y=m[g];s[g]=Im(s[g],Mm(h-d,y))}}for(var b=0;b<s.length;++b)s[b]=Cm(s[b],o);return s}))}},{key:"getDedupedMetricsNames",value:function(){for(var e=this.metricsNames,t=[],n=0;n<e.length;++n){var r=e[n],a=r;if(uT(e,r)>1){var i=uT(e.slice(0,n),r);a+="_".concat(i)}t.push(a)}return t}},{key:"makeTrainFunction",value:function(){var e=this;return function(t){var n=[],r=t.slice(0,e.inputs.length),a=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),i=t.slice(e.inputs.length+e.outputs.length,e.inputs.length+2*e.outputs.length),o=[],s=e.collectedTrainableWeights.map((function(e){return e.read()}));return[e.optimizer_.minimize((function(){for(var t=[],s=0;s<e.inputs.length;++s)t.push({key:e.inputs[s],value:r[s]});for(var u,c=new eI(t),l=rI(e.outputs,c,{training:!0}),d=0;d<e.lossFunctions.length;++d){var h=(0,e.lossFunctions[d])(a[d],l[d]);null!=i[d]&&(h=hE(h,i[d]));var p=Ug(h);n.push(p),u=0===d?h:Im(u,h)}for(var f=0;f<e.metricsTensors.length;++f){var m=void 0;if(e.outputs.length>1&&f<e.outputs.length)m=n[f];else{var v=e.metricsTensors[f][0],g=e.metricsTensors[f][1];m=Ug(v(a[g],l[g]))}Af(m),o.push(m)}return u=Ug(u),e.calculateLosses().forEach((function(e){u=Im(u,e)})),u}),!0,s)].concat(o)}}},{key:"makeTestFunction",value:function(){var e=this;this.testFunction=function(t){return Rf((function(){for(var n,r=[],a=t.slice(0,e.inputs.length),i=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),o=[],s=0;s<e.inputs.length;++s)o.push({key:e.inputs[s],value:a[s]});for(var u=new eI(o),c=rI(e.outputs,u),l=0;l<e.lossFunctions.length;++l){var d=e.lossFunctions[l],h=Ug(d(i[l],c[l]));n=0===l?h:Im(n,h),r.push(n)}for(var p=0;p<e.metricsTensors.length;++p){var f=e.metricsTensors[p][0],m=e.metricsTensors[p][1],v=Ug(f(i[m],c[m]));r.push(v)}return r}))}}},{key:"fit",value:function(){var e=S(w().mark((function e(t,n){var r,a=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:{},e.abrupt("return",NE(this,t,n,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fitDataset",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",gE(this,t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"trainOnBatch",value:function(){var e=S(w().mark((function e(t,n){var r,a,i,o,s,u,c,l,d;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.standardizeUserData(t,n);case 2:r=e.sent,a=r[0],i=r[1],o=this.makeTrainFunction()(a.concat(i)),s=[],u=x(o),e.prev=8,u.s();case 10:if((c=u.n()).done){e.next=18;break}return l=c.value,e.next=14,l.data();case 14:d=e.sent,s.push(d[0]);case 16:e.next=10;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(8),u.e(e.t0);case 23:return e.prev=23,u.f(),e.finish(23);case 26:return e.abrupt("return",(Lf(o),AE(r[0],t),AE(r[1],n),cT(s)));case 27:case"end":return e.stop()}}),e,this,[[8,20,23,26]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getNamedWeights",value:function(e){for(var t=[],n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,a=this.getWeights(n),i=0;i<r.length;++i)n&&!r[i].trainable||t.push({name:r[i].originalName,tensor:a[i]});return t}},{key:"stopTraining",get:function(){return this.stopTraining_},set:function(e){this.stopTraining_=e}},{key:"optimizer",get:function(){return this.optimizer_},set:function(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}},{key:"dispose",value:function(){var e=N(v(n.prototype),"dispose",this).call(this);if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){var t=Nf().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-Nf().numTensors}return e}},{key:"getLossIdentifiers",value:function(){var e;if("string"==typeof this.loss)e=dT(this.loss);else if(Array.isArray(this.loss)){var t,n=x(this.loss);try{for(n.s();!(t=n.n()).done;){if("string"!=typeof t.value)throw new Error("Serialization of non-string loss is not supported.")}}catch(u){n.e(u)}finally{n.f()}e=this.loss.map((function(e){return dT(e)}))}else{var r=Object.keys(this.loss);e={};for(var a=this.loss,i=0,o=r;i<o.length;i++){var s=o[i];if("string"!=typeof a[s])throw new Error("Serialization of non-string loss is not supported.");e[s]=dT(a[s])}}return e}},{key:"getMetricIdentifiers",value:function(){if("string"==typeof this.metrics||"function"==typeof this.metrics)return[dT(QI(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((function(e){return dT(QI(e))}));var e={};for(var t in this.metrics)e[t]=dT(QI(this.metrics[t]));return e}},{key:"getTrainingConfig",value:function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}},{key:"loadTrainingConfig",value:function(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");var t,n,r=MI(iE(e.optimizer_config));if("string"==typeof e.loss)t=hT(e.loss);else if(Array.isArray(e.loss))t=e.loss.map((function(e){return hT(e)}));else if(null!=e.loss)for(var a in t={},e.loss)t[a]=hT(e.loss[a]);if(Array.isArray(e.metrics))n=e.metrics.map((function(e){return hT(e)}));else if(null!=e.metrics)for(var i in n={},e.metrics)n[i]=hT(e.metrics[i]);this.compile({loss:t,metrics:n,optimizer:r})}},{key:"save",value:function(){var e=S(w().mark((function e(t,n){var r,a,i,o,s,u,c,l;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=7;break}if(0!==(r=Ip(t)).length){e.next=4;break}throw new nT("Cannot find any save handlers for URL '".concat(t,"'"));case 4:if(!(r.length>1)){e.next=6;break}throw new nT("Found more than one (".concat(r.length,") save handlers for URL '").concat(t,"'"));case 6:t=r[0];case 7:if(null!=t.save){e.next=9;break}throw new nT("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 9:return e.next=11,up(this.getNamedWeights(n));case 11:if(a=e.sent,!1,null,i={modelTopology:this.toJSON(null,false),format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v".concat(sE),convertedBy:null},null==n||!n.includeOptimizer||null==this.optimizer){e.next=29;break}return i.trainingConfig=this.getTrainingConfig(),s="optimizer",e.t0=up,e.next=21,this.optimizer.getWeights();case 21:return e.t1=e.sent,e.t2=s,e.next=25,(0,e.t0)(e.t1,e.t2);case 25:u=e.sent,c=u.data,l=u.specs,(o=a.specs).push.apply(o,b(l)),a.data=vp([a.data,c]);case 29:return e.abrupt("return",(null!=this.userDefinedMetadata&&(qI(this.userDefinedMetadata,this.name,!0),i.userDefinedMetadata=this.userDefinedMetadata),i.weightData=a.data,i.weightSpecs=a.specs,t.save(i)));case 30:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setUserDefinedMetadata",value:function(e){qI(e,this.name),this.userDefinedMetadata=e}},{key:"getUserDefinedMetadata",value:function(){return this.userDefinedMetadata}}]),n}(uE);FE.className="Model",Tm(FE);var GE=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n)}(FE);function WE(){return WE=S(w().mark((function e(t,n){var r,a,i,o,s,u,c,l;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("modelTopology"in t||(t={modelTopology:t}),null!=(r=t.modelTopology).model_config&&(r=r.model_config),a=iE(r),i=MI(a,n),null==t.weightsManifest){e.next=12;break}return e.next=7,yf(t.weightsManifest,t.pathPrefix,i.weights.map((function(e){return e.originalName})));case 7:o=e.sent,s={},u=x(i.weights);try{for(u.s();!(c=u.n()).done;)l=c.value,s[l.originalName]=o[l.originalName]}catch(d){u.e(d)}finally{u.f()}i.loadWeights(s),Lf(o);case 12:return e.abrupt("return",i);case 13:case"end":return e.stop()}}),e)}))),WE.apply(this,arguments)}function VE(){return VE=S(w().mark((function e(t,n){var r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),"string"!=typeof t){e.next=9;break}if(0!==(r=Ep(t,n)).length){e.next=6;break}r.push(If(t,n)),e.next=8;break;case 6:if(!(r.length>1)){e.next=8;break}throw new nT("Found more than one (".concat(r.length,") load handlers for URL '").concat(t,"'"));case 8:t=r[0];case 9:return e.abrupt("return",UE(t,void 0,n));case 10:case"end":return e.stop()}}),e)}))),VE.apply(this,arguments)}function UE(e,t,n){return XE.apply(this,arguments)}function XE(){return XE=S(w().mark((function e(t,n,r){var a,i,o,s,u,c,l,d,h;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==r&&(r={}),null!=t.load){e.next=2;break}throw new nT("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");case 2:return e.next=4,t.load();case 4:if(a=e.sent,null!=(i=a.modelTopology).model_config&&(i=i.model_config),o=null==r.strict||r.strict,s=null!=a.weightData&&null!=a.weightSpecs&&o,u=MI(iE(i),n,s),null!=(c=a.trainingConfig)&&u.loadTrainingConfig(c),null!=a.userDefinedMetadata&&u.setUserDefinedMetadata(a.userDefinedMetadata),null==a.weightData){e.next=19;break}if(null!=a.weightSpecs){e.next=11;break}throw new nT("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");case 11:if(l=BE(a.weightData,a.weightSpecs),d=l.modelWeights,h=l.optimizerWeights,u.loadWeights(d,o),e.t0=null!=u.optimizer&&h.length>0,!e.t0){e.next=17;break}return e.next=17,u.optimizer.setWeights(h);case 17:Lf(d),Lf(h.map((function(e){return e.tensor})));case 19:return e.abrupt("return",u);case 20:case"end":return e.stop()}}),e)}))),XE.apply(this,arguments)}function BE(e,t){var n=lp(e,t),r={},a=[];return t.forEach((function(e){"optimizer"===e.group?a.push({name:e.name,tensor:n[e.name]}):r[e.name]=n[e.name]})),{modelWeights:r,optimizerWeights:a}}GE.className="Functional",Tm(GE);var HE=function(e){m(n,e);var t=y(n);function n(e){var r;if(T(this,n),e=e||{},(r=t.call(this,{inputs:[],outputs:[]})).trainable=!0,r.built=!1,r.name=null!=e.name?e.name:CT("sequential_"),null!=e.layers){var a,i=x(e.layers);try{for(i.s();!(a=i.n()).done;){var o=a.value;r.add(o)}}catch(s){i.e(s)}finally{i.f()}}return p(r)}return E(n,[{key:"checkShape",value:function(e){if(e.inboundNodes[0].outputTensors[0].shape.some((function(e){return e<0})))throw new nT("Negative dimension size caused by adding layer ".concat(e.name," with input shape [").concat(e.inboundNodes[0].inputTensors[0].shape,"]"))}},{key:"add",value:function(e){var t,r=e instanceof n||e instanceof FE;if(r){if(1!==(t=e).outputs.length)throw new nT("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==t.inputs.length)throw new nT("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new nT("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var a=$_({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(a)}if(r)this.outputs=t.outputs,this.inputs=t.inputs;else{if(1!==e.inboundNodes.length)throw new nT("A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ".concat(e.name," which has ").concat(e.inboundNodes.length," pre-existing inbound connections."));if(1!==e.inboundNodes[0].outputTensors.length)throw new nT("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=J_(this.outputs[0])}this.inboundNodes=[],new j_({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:oT(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((function(e){return e.shape})),outputShapes:this.outputs[0].shape})}else{var i=e.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}},{key:"pop",value:function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}},{key:"call",value:function(e,t){return null==this.model&&this.build(),this.model.call(e,t)}},{key:"build",value:function(e){if(G_(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new FE({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}},{key:"countParams",value:function(){return this.built||this.build(),N(v(n.prototype),"countParams",this).call(this)}},{key:"summary",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;this.built||this.build(),N(v(n.prototype),"summary",this).call(this,e,t,r)}},{key:"setWeights",value:function(e){null==this.model&&this.build(),this.model.setWeights(e)}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new tT("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}},{key:"evaluateDataset",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new tT("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.evaluateDataset(t,n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null==this.model&&this.build(),this.model.predict(e,t)}},{key:"predictOnBatch",value:function(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}},{key:"compile",value:function(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}},{key:"optimizer",get:function(){return null==this.model?void 0:this.model.optimizer},set:function(e){this.model.optimizer=e}},{key:"fit",value:function(){var e=S(w().mark((function e(t,n){var r,a=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.length>2&&void 0!==a[2]?a[2]:{},this.built){e.next=3;break}throw new tT("The model needs to be compiled before being used.");case 3:return e.abrupt("return",this.model.fit(t,n,r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fitDataset",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new tT("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.fitDataset(t,n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"trainOnBatch",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.model.trainOnBatch(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"stopTraining",get:function(){if(null==this.model)throw new nT("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(e){if(null==this.model)throw new nT("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}},{key:"getConfig",value:function(){var e,t=[],n=x(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value,a={};a.className=r.getClassName(),a.config=r.getConfig(),t.push(a)}}catch(i){n.e(i)}finally{n.f()}return{name:this.name,layers:t}}}],[{key:"fromConfig",value:function(e,t){var r,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i={};if(t instanceof Array){if(null==t[0].className||"Merge"===t[0].className)throw new nT("Legacy serialization format not supported yet.");r=t}else ls(null!=t.layers,(function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."})),r=t.layers,delete t.layers,i=t;var o=new e(i);if(!(o instanceof n))throw new rT("Sequential.fromConfig called on non-Sequential input: ".concat(o));var s,u=x(r);try{for(u.s();!(s=u.n()).done;){var c=MI(s.value,void 0,a);a&&c.setFastWeightInitDuringBuild(!0),o.add(c)}}catch(l){u.e(l)}finally{u.f()}return o}}]),n}(FE);HE.className="Sequential",Tm(HE);var ZE=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n,[{key:"getConfig",value:function(){return{}}}]),n}(km),KE=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n,[{key:"apply",value:function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(1!==t)throw new rT("Support for alpha values other than 1 (".concat(t,") is not implemented yet."));return Xv(e)}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}}]),n}(ZE);KE.className="elu",Tm(KE);var jE=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n,[{key:"apply",value:function(e){return zy(e)}}]),n}(ZE);jE.className="selu",Tm(jE);var YE=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n,[{key:"apply",value:function(e){return Ly(e)}}]),n}(ZE);YE.className="relu",Tm(YE);var QE=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n,[{key:"apply",value:function(e){return Rf((function(){return Hg(6,Ly(e))}))}}]),n}(ZE);QE.className="relu6",Tm(QE);var JE=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n,[{key:"apply",value:function(e){return e}}]),n}(ZE);JE.className="linear",Tm(JE);var qE=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n,[{key:"apply",value:function(e){return ov(e)}}]),n}(ZE);qE.className="sigmoid",Tm(qE);var $E=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n,[{key:"apply",value:function(e){return function(e){return Rf((function(){var t=Im(.5,Mm(.2,e));return bv(t,0,1)}))}(e)}}]),n}(ZE);$E.className="hardSigmoid",Tm($E);var eC=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n,[{key:"apply",value:function(e){return Ng(e)}}]),n}(ZE);eC.className="softplus",Tm(eC);var tC=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n,[{key:"apply",value:function(e){return function(e){return Rf((function(){return Cm(e,Im(Nm(e),1))}))}(e)}}]),n}(ZE);tC.className="softsign",Tm(tC);var nC=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n,[{key:"apply",value:function(e){return uv(e)}}]),n}(ZE);nC.className="tanh",Tm(nC);var rC=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n,[{key:"apply",value:function(e){return Zy(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1)}}]),n}(ZE);rC.className="softmax",Tm(rC);var aC=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n,[{key:"apply",value:function(e){return Ag(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1)}}]),n}(ZE);aC.className="logSoftmax",Tm(aC);var iC=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Rf((function(){return Mm(ov(Mm(e,t)),e)}))}}]),n}(ZE);iC.className="swish",Tm(iC);var oC=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n,[{key:"apply",value:function(e){return Rf((function(){return Mm(e,uv(Ng(e)))}))}}]),n}(ZE);function sC(e){return e.getClassName()}function uC(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return vT(e,Sm.getMap().classNameMap,t,"activation")}function cC(e){if(null==e){var t={className:"linear",config:{}};return uC(t)}if("string"==typeof e){var n={};return n.className=e,n.config={},uC(n)}return e instanceof ZE?e:uC(e)}function lC(e){if(null!=e&&"object"!=typeof e)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an object, but received: ".concat(e))}oC.className="mish",Tm(oC);var dC=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n)}(km),hC=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),r=t.call(this),lC(e),r.l1=null==e||null==e.l1?.01:e.l1,r.l2=null==e||null==e.l2?.01:e.l2,r.hasL1=0!==r.l1,r.hasL2=0!==r.l2,r}return E(n,[{key:"apply",value:function(e){var t=this;return Rf((function(){var n=Xg([1]);return t.hasL1&&(n=Im(n,ig(Mm(t.l1,Nm(e))))),t.hasL2&&(n=Im(n,ig(Mm(t.l2,c_(e))))),nv(n,[])}))}},{key:"getConfig",value:function(){return{l1:this.l1,l2:this.l2}}}],[{key:"fromConfig",value:function(e,t){return new e({l1:t.l1,l2:t.l2})}}]),n}(dC);hC.className="L1L2",Tm(hC);var pC={l1l2:"L1L2"};function fC(e){return fT(e)}function mC(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return vT(e,Sm.getMap().classNameMap,t,"regularizer")}function vC(e){return null==e?null:"string"==typeof e?mC({className:e in pC?pC[e]:e,config:{}}):e instanceof dC?e:mC(e)}var gC=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this,null!==e&&void 0!==e?e:{})).supportsMasking=!0,null!=e&&(r.maxValue=e.maxValue),r}return E(n,[{key:"call",value:function(e,t){e=F_(e);var n=Ly(e);return null!=this.maxValue&&(n=bv(n,0,this.maxValue)),n}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={maxValue:this.maxValue},t=N(v(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Q_);gC.className="ReLU",Tm(gC);var yC=function(e){m(n,e);var t=y(n);function n(e){var r,a;return T(this,n),(a=t.call(this,null!==(r=e)&&void 0!==r?r:{})).DEFAULT_ALPHA=.3,null==e&&(e={}),a.alpha=null==e.alpha?a.DEFAULT_ALPHA:e.alpha,a}return E(n,[{key:"call",value:function(e,t){var n=F_(e);return wg(n,this.alpha)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=N(v(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Q_);yC.className="LeakyReLU",Tm(yC);var bC=function(e){m(n,e);var t=y(n);function n(e){var r,a;if(T(this,n),(a=t.call(this,null!==(r=e)&&void 0!==r?r:{})).DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),a.supportsMasking=!0,a.alphaInitializer=D_(e.alphaInitializer||a.DEFAULT_ALPHA_INITIALIZER),a.alphaRegularizer=vC(e.alphaRegularizer),a.alphaConstraint=gI(e.alphaConstraint),null==e.sharedAxes)a.sharedAxes=null;else if(Array.isArray(e.sharedAxes))a.sharedAxes=e.sharedAxes;else{if("number"!=typeof e.sharedAxes)throw new nT("Expected sharedAxes to be a number or an array of numbers, but got ".concat(e.sharedAxes));a.sharedAxes=[e.sharedAxes]}return p(a)}return E(n,[{key:"build",value:function(e){var t=(e=G_(e)).slice(1);if(null!=this.sharedAxes){var n,r=x(this.sharedAxes);try{for(r.s();!(n=r.n()).done;){t[n.value-1]=1}}catch(o){r.e(o)}finally{r.f()}}this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var a={};if(null!=this.sharedAxes)for(var i=1;i<e.length;++i)a[i]=e[i];this.inputSpec=[new H_({ndim:e.length,axes:a})],this.built=!0}},{key:"call",value:function(e,t){return e=F_(e),ey(e,this.alpha.read())}},{key:"getConfig",value:function(){var e={alphaInitializer:P_(this.alphaInitializer),alphaRegularizer:fC(this.alphaRegularizer),alphaConstraint:mI(this.alphaConstraint),sharedAxes:this.sharedAxes},t=N(v(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Q_);bC.className="PReLU",Tm(bC);var xC=function(e){m(n,e);var t=y(n);function n(e){var r,a;if(T(this,n),(a=t.call(this,null!==(r=e)&&void 0!==r?r:{})).DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==a.DEFAULT_ALPHA)throw new rT("Non-default alpha value (".concat(e.alpha,") is not supported by the ELU layer yet."));return a.alpha=null==e.alpha?a.DEFAULT_ALPHA:e.alpha,p(a)}return E(n,[{key:"call",value:function(e,t){var n=F_(e);return Xv(n)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=N(v(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Q_);xC.className="ELU",Tm(xC);var wC=function(e){m(n,e);var t=y(n);function n(e){var r,a;return T(this,n),(a=t.call(this,null!==(r=e)&&void 0!==r?r:{})).DEFAULT_THETA=1,null==e&&(e={}),a.theta=null==e.theta?a.DEFAULT_THETA:e.theta,a}return E(n,[{key:"call",value:function(e,t){var n=F_(e);return Mm(n,hf(vg(n,this.theta),"float32"))}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={theta:this.theta},t=N(v(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Q_);wC.className="ThresholdedReLU",Tm(wC);var kC=function(e){m(n,e);var t=y(n);function n(e){var r,a;return T(this,n),(a=t.call(this,null!==(r=e)&&void 0!==r?r:{})).DEFAULT_AXIS=1,null==e&&(e={}),a.softmax=(new rC).apply,a.axis=null==e.axis?a.DEFAULT_AXIS:e.axis,a}return E(n,[{key:"call",value:function(e,t){var n=F_(e);return this.softmax(n,this.axis)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={axis:this.axis},t=N(v(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Q_);function SC(e,t,n){if("number"==typeof e)return oT(e,t);if(e.length!==t)throw new nT("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers. Received: ").concat(e.length," elements."));for(var r=0;r<t;++r){var a=e[r];if(!ZT(a))throw new nT("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers. Received: ").concat(JSON.stringify(e)," including a non-integer number ").concat(a))}return e}function TC(e,t,n,r){var a;return null==e?e:(a="same"===n?e:e-(t+(t-1)*((arguments.length>4&&void 0!==arguments[4]?arguments[4]:1)-1))+1,Math.floor((a+r-1)/r))}function _C(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+YT([n-t,0]);else{if("same"!==r)throw new nT("Unsupport padding mode: ".concat(r,"."));e*=t}return e}function IC(e,t){return Rf((function(){return DT(t),"channelsFirst"===t?Gf(e,[0,2,3,1]):e}))}function EC(e,t){return Rf((function(){return DT(t),"channelsFirst"===t?Gf(e,[0,2,3,4,1]):e}))}function CC(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;return Rf((function(){if(null==i&&(i="channelsLast"),DT(i),3!==e.rank&&4!==e.rank)throw new nT("conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ".concat(e.rank,"."));if(3!==t.rank&&4!==t.rank)throw new nT("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ".concat(e.rank,"."));var u=IC(e,i);if("causal"===a)throw new rT("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=wb({x:u,filter:t,strides:r,pad:"same"===a?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:s}),"channelsFirst"===i&&(u=Gf(u,[0,3,1,2])),u}))}kC.className="Softmax",Tm(kC);var MC=function(e){m(n,e);var t=y(n);function n(e,r){var a;if(T(this,n),(a=t.call(this,r)).bias=null,a.DEFAULT_KERNEL_INITIALIZER="glorotNormal",a.DEFAULT_BIAS_INITIALIZER="zeros",n.verifyArgs(r),a.rank=e,kT(a.rank,"rank"),1!==a.rank&&2!==a.rank&&3!==a.rank)throw new rT("Convolution layer for rank other than 1, 2, or 3 (".concat(a.rank,") is not implemented yet."));if(a.kernelSize=SC(r.kernelSize,e,"kernelSize"),a.strides=SC(null==r.strides?1:r.strides,e,"strides"),a.padding=null==r.padding?"valid":r.padding,OT(a.padding),a.dataFormat=null==r.dataFormat?"channelsLast":r.dataFormat,DT(a.dataFormat),a.activation=cC(r.activation),a.useBias=null==r.useBias||r.useBias,a.biasInitializer=D_(r.biasInitializer||a.DEFAULT_BIAS_INITIALIZER),a.biasConstraint=gI(r.biasConstraint),a.biasRegularizer=vC(r.biasRegularizer),a.activityRegularizer=vC(r.activityRegularizer),a.dilationRate=SC(null==r.dilationRate?1:r.dilationRate,e,"dilationRate"),1===a.rank&&Array.isArray(a.dilationRate)&&1!==a.dilationRate.length)throw new nT("dilationRate must be a number or an array of a single number for 1D convolution, but received ".concat(JSON.stringify(a.dilationRate)));if(2===a.rank){if("number"==typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate];else if(2!==a.dilationRate.length)throw new nT("dilationRate must be a number or array of two numbers for 2D convolution, but received ".concat(JSON.stringify(a.dilationRate)))}else if(3===a.rank)if("number"==typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate,a.dilationRate];else if(3!==a.dilationRate.length)throw new nT("dilationRate must be a number or array of three numbers for 3D convolution, but received ".concat(JSON.stringify(a.dilationRate)));return p(a)}return E(n,[{key:"getConfig",value:function(){var e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:sC(this.activation),useBias:this.useBias,biasInitializer:P_(this.biasInitializer),biasRegularizer:fC(this.biasRegularizer),activityRegularizer:fC(this.activityRegularizer),biasConstraint:mI(this.biasConstraint)},t=N(v(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(sT("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!=typeof e.kernelSize&&!wT(e.kernelSize,"number",1,3))throw new nT("BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(Q_),NC=function(e){m(n,e);var t=y(n);function n(e,r){var a;return T(this,n),(a=t.call(this,e,r)).kernel=null,n.verifyArgs(r),a.filters=r.filters,kT(a.filters,"filters"),a.kernelInitializer=D_(r.kernelInitializer||a.DEFAULT_KERNEL_INITIALIZER),a.kernelConstraint=gI(r.kernelConstraint),a.kernelRegularizer=vC(r.kernelRegularizer),a}return E(n,[{key:"build",value:function(e){e=G_(e);var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new nT("The channel dimension of the input should be defined. Found ".concat(e[t]));var n=e[t],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:R({},t,n)}],this.built=!0}},{key:"call",value:function(e,t){var n=this;return Rf((function(){var t;e=F_(e);var r=null==n.bias?null:n.bias.read(),a=TT(n.activation.getClassName());if(null!=a&&2===n.rank)t=CC(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate,a);else{if(1===n.rank)t=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return Rf((function(){if(null==i&&(i="channelsLast"),DT(i),3!==e.shape.length)throw new nT("The input of a conv1dWithBias operation should be 3, but is ".concat(e.shape.length," instead."));if(3!==t.shape.length)throw new nT("The kernel for a conv1dWithBias operation should be 3, but is ".concat(t.shape.length," instead"));if(null!=n&&1!==n.shape.length)throw new nT("The bias for a conv1dWithBias operation should be 1, but is ".concat(t.shape.length," instead"));if("channelsFirst"===i&&(e=Gf(e,[0,2,1])),"causal"===a)throw new rT("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=_v(e,t,r,"same"===a?"same":"valid","NWC",o);return null!=n&&(s=d_(s,n)),s}))}(e,n.kernel.read(),r,n.strides[0],n.padding,n.dataFormat,n.dilationRate[0]);else if(2===n.rank)t=CC(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate);else{if(3!==n.rank)throw new rT("convolutions greater than 3D are not implemented yet.");t=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;return Rf((function(){if(null==i&&(i="channelsLast"),DT(i),4!==e.rank&&5!==e.rank)throw new nT("conv3dWithBias expects input to be of rank 4 or 5, but received ".concat(e.rank,"."));if(4!==t.rank&&5!==t.rank)throw new nT("conv3dWithBias expects kernel to be of rank 4 or 5, but received ".concat(e.rank,"."));var s=EC(e,i);if("causal"===a)throw new rT("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=Cv(s,t,r,"same"===a?"same":"valid","NDHWC",o),null!=n&&(s=d_(s,n)),"channelsFirst"===i&&(s=Gf(s,[0,4,1,2,3])),s}))}(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate)}null!=n.activation&&(t=n.activation.apply(t))}return t}))}},{key:"computeOutputShape",value:function(e){e=G_(e);for(var t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2),r=0;r<n.length;++r){var a=TC(n[r],this.kernelSize[r],this.padding,this.strides[r],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[r]);t.push(a)}var i=[e[0]];return"channelsLast"===this.dataFormat?(i=i.concat(t)).push(this.filters):(i.push(this.filters),i=i.concat(t)),i}},{key:"getConfig",value:function(){var e={filters:this.filters,kernelInitializer:P_(this.kernelInitializer),kernelRegularizer:fC(this.kernelRegularizer),kernelConstraint:mI(this.kernelConstraint)},t=N(v(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(!("filters"in e)||"number"!=typeof e.filters||e.filters<1)throw new nT("Convolution layer expected config.filters to be a 'number' > 0 but got ".concat(JSON.stringify(e.filters)))}}]),n}(MC),RC=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),r=t.call(this,2,e),n.verifyArgs(e),r}return E(n,[{key:"getConfig",value:function(){var e=N(v(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!=typeof e.kernelSize&&!wT(e.kernelSize,"number",1,2))throw new nT("Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(NC);RC.className="Conv2D",Tm(RC);var LC=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),r=t.call(this,3,e),n.verifyArgs(e),r}return E(n,[{key:"getConfig",value:function(){var e=N(v(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!=typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new nT("Conv3D expects config.kernelSize to be number or [number, number, number], but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(NC);LC.className="Conv3D",Tm(LC);var AC=function(e){m(n,e);var t=y(n);function n(e){var r;if(T(this,n),(r=t.call(this,e)).inputSpec=[new H_({ndim:4})],"same"!==r.padding&&"valid"!==r.padding)throw new nT("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ".concat(r.padding));return p(r)}return E(n,[{key:"build",value:function(e){if(4!==(e=G_(e)).length)throw new nT("Input should have rank 4; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new nT("The channel dimension of the inputs should be defined. Found `None`.");var n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new H_({ndim:4,axes:R({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return Rf((function(){var t=F_(e);if(4!==t.shape.length)throw new nT("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-".concat(t.shape.length));var r,a,i=t.shape,o=i[0];"channelsFirst"===n.dataFormat?(r=2,a=3):(r=1,a=2);var s=i[r],u=i[a],c=n.kernelSize[0],l=n.kernelSize[1],d=n.strides[0],h=n.strides[1],p=[o,_C(s,d,c,n.padding),_C(u,h,l,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=Gf(t,[0,2,3,1]));var f=Ev(t,n.kernel.read(),p,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(f=Gf(f,[0,3,1,2])),null!=n.bias&&(f=d_(f,n.bias.read(),n.dataFormat)),null!=n.activation&&(f=n.activation.apply(f)),f}))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=(e=G_(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3):(t=3,n=1,r=2);var i=this.kernelSize[0],o=this.kernelSize[1],s=this.strides[0],u=this.strides[1];return a[t]=this.filters,a[n]=_C(a[n],s,i,this.padding),a[r]=_C(a[r],u,o,this.padding),a}},{key:"getConfig",value:function(){var e=N(v(n.prototype),"getConfig",this).call(this);return delete e.dilationRate,e}}]),n}(RC);AC.className="Conv2DTranspose",Tm(AC);var PC=function(e){m(n,e);var t=y(n);function n(e){var r;if(T(this,n),(r=t.call(this,e)).inputSpec=[new H_({ndim:5})],"same"!==r.padding&&"valid"!==r.padding)throw new nT("Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ".concat(r.padding));return p(r)}return E(n,[{key:"build",value:function(e){if(5!==(e=G_(e)).length)throw new nT("Input should have rank 5; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new nT("The channel dimension of the inputs should be defined. Found `None`.");var n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new H_({ndim:5,axes:R({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return Rf((function(){var t=F_(e);if(5!==t.shape.length)throw new nT("Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-".concat(t.shape.length));var r,a,i,o=t.shape,s=o[0];"channelsFirst"===n.dataFormat?(i=2,r=3,a=4):(i=1,r=2,a=3);var u=o[i],c=o[r],l=o[a],d=n.kernelSize[0],h=n.kernelSize[1],p=n.kernelSize[2],f=n.strides[0],m=n.strides[1],v=n.strides[2],g=[s,_C(u,f,d,n.padding),_C(c,m,h,n.padding),_C(l,v,p,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=Gf(t,[0,2,3,4,1]));var y=Nv(t,n.kernel.read(),g,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(y=Gf(y,[0,4,1,2,3])),null!==n.bias&&(y=d_(y,n.bias.read(),n.dataFormat)),null!==n.activation&&(y=n.activation.apply(y)),y}))}},{key:"computeOutputShape",value:function(e){var t,n,r,a,i=(e=G_(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3,a=4):(t=4,n=1,r=2,a=3);var o=this.kernelSize[0],s=this.kernelSize[1],u=this.kernelSize[2],c=this.strides[0],l=this.strides[1],d=this.strides[2];return i[t]=this.filters,i[n]=_C(i[n],c,o,this.padding),i[r]=_C(i[r],l,s,this.padding),i[a]=_C(i[a],d,u,this.padding),i}},{key:"getConfig",value:function(){var e=N(v(n.prototype),"getConfig",this).call(this);return delete e.dilationRate,e}}]),n}(LC);PC.className="Conv3DTranspose",Tm(PC);var DC=function(e){m(n,e);var t=y(n);function n(e,r){var a;if(T(this,n),(a=t.call(this,e,r)).DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",a.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",a.depthwiseKernel=null,a.pointwiseKernel=null,null==r.filters)throw new nT("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=r.kernelInitializer||null!=r.kernelRegularizer||null!=r.kernelConstraint)throw new nT("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=r.padding&&"same"!==r.padding&&"valid"!==r.padding)throw new nT("SeparableConv".concat(a.rank,"D supports only padding modes: 'same' and 'valid', but received ").concat(JSON.stringify(r.padding)));return a.depthMultiplier=null==r.depthMultiplier?1:r.depthMultiplier,a.depthwiseInitializer=D_(r.depthwiseInitializer||a.DEFAULT_DEPTHWISE_INITIALIZER),a.depthwiseRegularizer=vC(r.depthwiseRegularizer),a.depthwiseConstraint=gI(r.depthwiseConstraint),a.pointwiseInitializer=D_(r.depthwiseInitializer||a.DEFAULT_POINTWISE_INITIALIZER),a.pointwiseRegularizer=vC(r.pointwiseRegularizer),a.pointwiseConstraint=gI(r.pointwiseConstraint),p(a)}return E(n,[{key:"build",value:function(e){if((e=G_(e)).length<this.rank+2)throw new nT("Inputs to SeparableConv".concat(this.rank,"D should have rank ").concat(this.rank+2,", but received input shape: ").concat(JSON.stringify(e)));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new nT("The channel dimension of the inputs should be defined, but found ".concat(JSON.stringify(e[t])));for(var n=e[t],r=this.kernelSize.concat([n,this.depthMultiplier]),a=[],i=0;i<this.rank;++i)a.push(1);a.push(n*this.depthMultiplier,this.filters);var o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new H_({ndim:this.rank+2,axes:R({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return Rf((function(){var t;if(e=F_(e),1===n.rank)throw new rT("1D separable convolution is not implemented yet.");return 2===n.rank&&("channelsFirst"===n.dataFormat&&(e=Gf(e,[0,2,3,1])),t=Fy(e,n.depthwiseKernel.read(),n.pointwiseKernel.read(),n.strides,n.padding,n.dilationRate,"NHWC")),n.useBias&&(t=d_(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),"channelsFirst"===n.dataFormat&&(t=Gf(t,[0,3,1,2])),t}))}},{key:"getConfig",value:function(){var e=N(v(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=P_(this.depthwiseInitializer),e.pointwiseInitializer=P_(this.pointwiseInitializer),e.depthwiseRegularizer=fC(this.depthwiseRegularizer),e.pointwiseRegularizer=fC(this.pointwiseRegularizer),e.depthwiseConstraint=mI(this.depthwiseConstraint),e.pointwiseConstraint=mI(this.pointwiseConstraint),e}}]),n}(NC);DC.className="SeparableConv";var OC=function(e){m(n,e);var t=y(n);function n(e){return T(this,n),t.call(this,2,e)}return E(n)}(DC);OC.className="SeparableConv2D",Tm(OC);var zC=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),r=t.call(this,1,e),n.verifyArgs(e),r.inputSpec=[{ndim:3}],r}return E(n,[{key:"getConfig",value:function(){var e=N(v(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.dataFormat,e}}],[{key:"verifyArgs",value:function(e){if("number"!=typeof e.kernelSize&&!wT(e.kernelSize,"number",1,1))throw new nT("Conv1D expects config.kernelSize to be number or number[] with length 1, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(NC);zC.className="Conv1D",Tm(zC);var FC=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),r=t.call(this,e),"number"==typeof e.cropping?r.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"==typeof e.cropping[0]?r.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:r.cropping=e.cropping,r.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,r.inputSpec=[{ndim:4}],r}return E(n,[{key:"computeOutputShape",value:function(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}},{key:"call",value:function(e,t){var n=this;return Rf((function(){if(e=F_(e),"channelsLast"===n.dataFormat){var t=n_(e,n.cropping[0][0],e.shape[1]-n.cropping[0][0]-n.cropping[0][1],2);return n_(t,n.cropping[1][0],e.shape[2]-n.cropping[1][1]-n.cropping[1][0],3)}var r=n_(e,n.cropping[0][0],e.shape[2]-n.cropping[0][0]-n.cropping[0][1],3);return n_(r,n.cropping[1][0],e.shape[3]-n.cropping[1][1]-n.cropping[1][0],4)}))}},{key:"getConfig",value:function(){var e={cropping:this.cropping,dataFormat:this.dataFormat},t=N(v(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Q_);FC.className="Cropping2D",Tm(FC);var GC=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this,e)).DEFAULT_SIZE=[2,2],r.inputSpec=[{ndim:4}],r.size=null==e.size?r.DEFAULT_SIZE:e.size,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,DT(r.dataFormat),r.interpolation=null==e.interpolation?"nearest":e.interpolation,function(e){xT(NT,"InterpolationFormat",e)}(r.interpolation),r}return E(n,[{key:"computeOutputShape",value:function(e){if("channelsFirst"===this.dataFormat){var t=null==e[2]?null:this.size[0]*e[2],n=null==e[3]?null:this.size[1]*e[3];return[e[0],e[1],t,n]}var r=null==e[1]?null:this.size[0]*e[1],a=null==e[2]?null:this.size[1]*e[2];return[e[0],r,a,e[3]]}},{key:"call",value:function(e,t){var n=this;return Rf((function(){var t=F_(e),r=t.shape;if("channelsFirst"===n.dataFormat){t=Gf(t,[0,2,3,1]);var a=n.size[0]*r[2],i=n.size[1]*r[3],o="nearest"===n.interpolation?_x.resizeNearestNeighbor(t,[a,i]):_x.resizeBilinear(t,[a,i]);return Gf(o,[0,3,1,2])}var s=n.size[0]*r[1],u=n.size[1]*r[2];return"nearest"===n.interpolation?_x.resizeNearestNeighbor(t,[s,u]):_x.resizeBilinear(t,[s,u])}))}},{key:"getConfig",value:function(){var e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=N(v(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Q_);GC.className="UpSampling2D",Tm(GC);var WC=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this,2,e)).depthwiseKernel=null,r.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,r.depthwiseInitializer=D_(e.depthwiseInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.depthwiseConstraint=gI(e.depthwiseConstraint),r.depthwiseRegularizer=vC(e.depthwiseRegularizer),r}return E(n,[{key:"build",value:function(e){if((e=G_(e)).length<4)throw new nT("Inputs to DepthwiseConv2D should have rank 4. Received input shape: ".concat(JSON.stringify(e),"."));var t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new nT("The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (".concat(e[t],")."));var n=e[t],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return Rf((function(){var t=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"valid",a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;return Rf((function(){null==a&&(a="channelsLast"),DT(a);var o=IC(e,a);if(4!==e.rank)throw new nT("Input for depthwiseConv2d is required to be 4-D, but is instead ".concat(e.rank,"-D"));if(4!==t.rank)throw new nT("depthwiseKernel is required to be 4-D, but is instead ".concat(t.rank,"-D"));return o=Ov(o,t,n,"same"===r?"same":"valid","NHWC",i),"channelsFirst"===a&&(o=Gf(o,[0,3,1,2])),o}))}(e=F_(e),n.depthwiseKernel.read(),n.strides,n.padding,n.dataFormat,null);return n.useBias&&(t=d_(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),t}))}},{key:"computeOutputShape",value:function(e){e=G_(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,a=TC(t,this.kernelSize[0],this.padding,this.strides[0]),i=TC(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],r,a,i]:[e[0],a,i,r]}},{key:"getConfig",value:function(){var e=N(v(n.prototype),"getConfig",this).call(this);return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=P_(this.depthwiseInitializer),e.depthwiseRegularizer=fC(this.depthwiseRegularizer),e.depthwiseConstraint=mI(this.depthwiseRegularizer),e}}]),n}(MC);function VC(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new nT("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function a(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=a(t),constants:n=a(n)}}function UC(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return Rf((function(){var u=t.shape.length;if(u<3)throw new nT("Input should be at least 3D, but is ".concat(u,"D."));var c=[1,0].concat(QT(2,u));if(t=Gf(t,c),null!=i)throw new rT("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=a&&((a=hf(hf(a,"bool"),"float32")).rank===u-1&&(a=lg(a,-1)),a=Gf(a,c)),r&&(t=Py(t,0),null!=a&&(a=Py(a,0)));var l,d,h=[],p=n,f=t.shape[0],m=lb(t);null!=a&&(d=lb(a));for(var v,g=function(t){var n=m[t],r=Rf((function(){return e(n,p)}));if(null==a)l=r[0],p=r[1];else{var i=Rf((function(){var e=d[t],n=Lg(Qg(e),e);return{output:Im(Mm(r[0],e),Mm(p[0],n)),newStates:p.map((function(t,a){return Im(Mm(r[1][a],e),Mm(t,n))}))}}));l=i.output,p=i.newStates}s&&h.push(l)},y=0;y<f;++y)g(y);return s&&(v=eb(h,1)),[l,v,p]}))}WC.className="DepthwiseConv2D",Tm(WC);var XC=function(e){m(n,e);var t=y(n);function n(e){var r,a;if(T(this,n),r=t.call(this,e),null==e.cell)throw new nT("cell property is missing for the constructor of RNN.");if(null==(a=Array.isArray(e.cell)?new JC({cells:e.cell}):e.cell).stateSize)throw new nT("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return r.cell=a,r.returnSequences=null!=e.returnSequences&&e.returnSequences,r.returnState=null!=e.returnState&&e.returnState,r.goBackwards=null!=e.goBackwards&&e.goBackwards,r._stateful=null!=e.stateful&&e.stateful,r.unroll=null!=e.unroll&&e.unroll,r.supportsMasking=!0,r.inputSpec=[new H_({ndim:3})],r.stateSpec=null,r.states_=null,r.numConstants=null,r.keptStates=[],r}return E(n,[{key:"getStates",value:function(){return null==this.states_?QT(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((function(e){return null})):this.states_}},{key:"setStates",value:function(e){this.states_=e}},{key:"computeOutputShape",value:function(e){O_(e)&&(e=e[0]);var t=this.cell.stateSize;Array.isArray(t)||(t=[t]);var n,r=t[0];if(n=this.returnSequences?[e[0],e[1],r]:[e[0],r],this.returnState){var a,i=[],o=x(t);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push([e[0],s])}}catch(u){o.e(u)}finally{o.f()}return[n].concat(i)}return n}},{key:"computeMask",value:function(e,t){var n=this;return Rf((function(){Array.isArray(t)&&(t=t[0]);var e=n.returnSequences?t:null;if(n.returnState){var r=n.states.map((function(e){return null}));return[e].concat(r)}return e}))}},{key:"states",get:function(){if(null==this.states_){for(var e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[],n=0;n<e;++n)t.push(null);return t}return this.states_},set:function(e){this.states_=e}},{key:"build",value:function(e){if(null!=this.numConstants)throw new rT("Constants support is not implemented in RNN yet.");O_(e)&&(e=e[0]);var t=this.stateful?e[0]:null,n=e.slice(2);this.inputSpec[0]=new H_({shape:[t,null].concat(b(n))});var r,a=[e[0]].concat(e.slice(2));if(this.cell.build(a),r=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!ms(this.stateSpec.map((function(e){return e.shape[e.shape.length-1]})),r))throw new nT("An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; However cell.stateSize is ").concat(this.cell.stateSize))}else this.stateSpec=r.map((function(e){return new H_({shape:[null,e]})}));this.stateful&&this.resetStates()}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Rf((function(){if(!t.stateful)throw new eT("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=t.inputSpec[0].shape[0];if(null==r)throw new nT("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.states_)Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(e){return Xg([r,e])})):t.states_=[Xg([r,t.cell.stateSize])];else if(null==e)Lf(t.states_),null!=t.keptStates&&(Lf(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(e){return Xg([r,e])})):t.states_[0]=Xg([r,t.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new nT("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), but it received ").concat(e.length," state value(s). Input received: ").concat(e));!0===n?t.keptStates.push(t.states_.slice()):Lf(t.states_);for(var a=0;a<t.states_.length;++a){var i=e[a],o=Array.isArray(t.cell.stateSize)?t.cell.stateSize[a]:t.cell.stateSize,s=[r,o];if(!ms(i.shape,s))throw new nT("State ".concat(a," is incompatible with layer ").concat(t.name,": expected shape=").concat(s,", received shape=").concat(i.shape));t.states_[a]=i}}t.states_=t.states_.map((function(e){return Af(e.clone())}))}))}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=VC(e,r,a,this.numConstants);e=i.inputs,r=i.initialState,a=i.constants;var o=[],s=[];if(null!=r){t.initialState=r,o=o.concat(r),this.stateSpec=[];var u,c=x(r);try{for(c.s();!(u=c.n()).done;){var l=u.value;this.stateSpec.push(new H_({shape:l.shape}))}}catch(m){c.e(m)}finally{c.f()}s=s.concat(this.stateSpec)}if(null!=a&&(t.constants=a,o=o.concat(a),this.numConstants=a.length),o[0]instanceof Z_){var d=[e].concat(o),h=this.inputSpec.concat(s),p=this.inputSpec;this.inputSpec=h;var f=N(v(n.prototype),"apply",this).call(this,d,t);return this.inputSpec=p,f}return N(v(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return Rf((function(){var r=null==t?null:t.mask,a=null==t?null:t.training,i=null==t?null:t.initialState;e=F_(e),null==i&&(i=n.stateful?n.states_:n.getInitialState(e));var o=Array.isArray(n.cell.stateSize)?n.cell.stateSize.length:1;if(i.length!==o)throw new nT("RNN Layer has ".concat(o," state(s) but was passed ").concat(i.length," initial state(s)."));n.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var s={training:a},u=UC((function(e,t){var r=n.cell.call([e].concat(t),s);return[r[0],r.slice(1)]}),e,i,n.goBackwards,r,null,n.unroll,n.returnSequences),c=u[0],l=u[1],d=u[2];n.stateful&&n.resetStates(d,a);var h=n.returnSequences?l:c;return n.returnState?[h].concat(d):h}))}},{key:"getInitialState",value:function(e){var t=this;return Rf((function(){var n=Xg(e.shape);return n=$T(n=ig(n,[1,2])),Array.isArray(t.cell.stateSize)?t.cell.stateSize.map((function(e){return e>1?i_(n,[1,e]):n})):t.cell.stateSize>1?[i_(n,[1,t.cell.stateSize])]:[n]}))}},{key:"trainableWeights",get:function(){return this.trainable?this.cell.trainableWeights:[]}},{key:"nonTrainableWeights",get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}},{key:"setFastWeightInitDuringBuild",value:function(e){N(v(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e=N(v(n.prototype),"getConfig",this).call(this),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);var r=this.cell.getConfig();return this.getClassName()===n.className&&(t.cell={className:this.cell.getClassName(),config:r}),Object.assign({},r,e,t)}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=MI(t.cell,n);return new e(Object.assign(t,{cell:r}))}}]),n}(Q_);XC.className="RNN",Tm(XC);var BC=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n)}(Q_),HC=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,kT(r.units,"units"),r.activation=cC(null==e.activation?r.DEFAULT_ACTIVATION:e.activation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=D_(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=D_(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=D_(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=vC(e.kernelRegularizer),r.recurrentRegularizer=vC(e.recurrentRegularizer),r.biasRegularizer=vC(e.biasRegularizer),r.kernelConstraint=gI(e.kernelConstraint),r.recurrentConstraint=gI(e.recurrentConstraint),r.biasConstraint=gI(e.biasConstraint),r.dropout=jT([1,YT([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=jT([1,YT([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return E(n,[{key:"build",value:function(e){e=G_(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return Rf((function(){if(2!==e.length)throw new nT("SimpleRNNCell expects 2 input Tensors, got ".concat(e.length,"."));var r=e[1];e=e[0];var a,i=null!=t.training&&t.training;0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=qC({ones:function(){return Qg(e)},rate:n.dropout,training:i,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=qC({ones:function(){return Qg(r)},rate:n.recurrentDropout,training:i,dropoutFunc:n.dropoutFunc}));var o=n.dropoutMask,s=n.recurrentDropoutMask;a=s_(null!=o?Mm(e,o):e,n.kernel.read()),null!=n.bias&&(a=d_(a,n.bias.read())),null!=s&&(r=Mm(r,s));var u=Im(a,s_(r,n.recurrentKernel.read()));return null!=n.activation&&(u=n.activation.apply(u)),[u,u]}))}},{key:"getConfig",value:function(){var e=N(v(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:sC(this.activation),useBias:this.useBias,kernelInitializer:P_(this.kernelInitializer),recurrentInitializer:P_(this.recurrentInitializer),biasInitializer:P_(this.biasInitializer),kernelRegularizer:fC(this.kernelRegularizer),recurrentRegularizer:fC(this.recurrentRegularizer),biasRegularizer:fC(this.biasRegularizer),activityRegularizer:fC(this.activityRegularizer),kernelConstraint:mI(this.kernelConstraint),recurrentConstraint:mI(this.recurrentConstraint),biasConstraint:mI(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},e,t)}}]),n}(BC);HC.className="SimpleRNNCell",Tm(HC);var ZC=function(e){m(n,e);var t=y(n);function n(e){return T(this,n),e.cell=new HC(e),t.call(this,e)}return E(n,[{key:"call",value:function(e,t){var r=this;return Rf((function(){null!=r.cell.dropoutMask&&(Lf(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Lf(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return N(v(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(XC);ZC.className="SimpleRNN",Tm(ZC);var KC=function(e){m(n,e);var t=y(n);function n(e){var r;if(T(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new nT("GRUCell does not support reset_after parameter set to true.");return r.units=e.units,kT(r.units,"units"),r.activation=cC(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=cC(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=D_(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=D_(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=D_(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=vC(e.kernelRegularizer),r.recurrentRegularizer=vC(e.recurrentRegularizer),r.biasRegularizer=vC(e.biasRegularizer),r.kernelConstraint=gI(e.kernelConstraint),r.recurrentConstraint=gI(e.recurrentConstraint),r.biasConstraint=gI(e.biasConstraint),r.dropout=jT([1,YT([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=jT([1,YT([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.implementation=e.implementation,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,p(r)}return E(n,[{key:"build",value:function(e){var t=(e=G_(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return Rf((function(){if(2!==e.length)throw new nT("GRUCell expects 2 input Tensors (inputs, h, c), got ".concat(e.length,"."));var r=null!=t.training&&t.training,a=e[1];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=qC({ones:function(){return Qg(e)},rate:n.dropout,training:r,count:3,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=qC({ones:function(){return Qg(a)},rate:n.recurrentDropout,training:r,count:3,dropoutFunc:n.dropoutFunc}));var o,s,u,c=n.dropoutMask,l=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=Mm(e,c[0]));var d=s_(e,n.kernel.read());n.useBias&&(d=d_(d,n.bias.read())),0<n.recurrentDropout&&n.recurrentDropout<1&&(a=Mm(a,l[0]));var h=n.recurrentKernel.read(),p=i(Qy(h,[2*n.units,n.units],h.rank-1),2),f=p[0],m=p[1],v=s_(a,f),g=i(Qy(d,3,d.rank-1),3),y=g[0],b=g[1],x=g[2],w=i(Qy(v,2,v.rank-1),2),k=w[0],S=w[1];o=n.recurrentActivation.apply(Im(y,k)),s=n.recurrentActivation.apply(Im(b,S));var T=s_(Mm(s,a),m);u=n.activation.apply(Im(x,T));var _=Im(Mm(o,a),Mm(Im(1,zf(o)),u));return[_,_]}))}},{key:"getConfig",value:function(){var e=N(v(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:sC(this.activation),recurrentActivation:sC(this.recurrentActivation),useBias:this.useBias,kernelInitializer:P_(this.kernelInitializer),recurrentInitializer:P_(this.recurrentInitializer),biasInitializer:P_(this.biasInitializer),kernelRegularizer:fC(this.kernelRegularizer),recurrentRegularizer:fC(this.recurrentRegularizer),biasRegularizer:fC(this.biasRegularizer),activityRegularizer:fC(this.activityRegularizer),kernelConstraint:mI(this.kernelConstraint),recurrentConstraint:mI(this.recurrentConstraint),biasConstraint:mI(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},e,t)}}]),n}(BC);KC.className="GRUCell",Tm(KC);var jC=function(e){m(n,e);var t=y(n);function n(e){return T(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new KC(e),t.call(this,e)}return E(n,[{key:"call",value:function(e,t){var r=this;return Rf((function(){null!=r.cell.dropoutMask&&(Lf(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Lf(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return N(v(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(XC);jC.className="GRU",Tm(jC);var YC=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,kT(r.units,"units"),r.activation=cC(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=cC(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=D_(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=D_(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=D_(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.unitForgetBias=e.unitForgetBias,r.kernelRegularizer=vC(e.kernelRegularizer),r.recurrentRegularizer=vC(e.recurrentRegularizer),r.biasRegularizer=vC(e.biasRegularizer),r.kernelConstraint=gI(e.kernelConstraint),r.recurrentConstraint=gI(e.recurrentConstraint),r.biasConstraint=gI(e.biasConstraint),r.dropout=jT([1,YT([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=jT([1,YT([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.implementation=e.implementation,r.stateSize=[r.units,r.units],r.dropoutMask=null,r.recurrentDropoutMask=null,r}return E(n,[{key:"build",value:function(e){var t,n,r=(e=G_(e))[e.length-1];if(this.kernel=this.addWeight("kernel",[r,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var a=this.biasInitializer,i=this.units;n=new(t=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n,[{key:"apply",value:function(e,t){var n=a.apply([i]),r=(new y_).apply([i]),o=a.apply([2*i]);return a_(a_(n,r),o)}}]),n}(v_),t.className="CustomInit",t)}else n=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,n,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}},{key:"call",value:function(e,t){var n=this;return Rf((function(){var r=null!=t.training&&t.training;if(3!==e.length)throw new nT("LSTMCell expects 3 input Tensors (inputs, h, c), got ".concat(e.length,"."));var a=e[1],o=e[2];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=qC({ones:function(){return Qg(e)},rate:n.dropout,training:r,count:4,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=qC({ones:function(){return Qg(a)},rate:n.recurrentDropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var s,u,c,l,d=n.dropoutMask,h=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=Mm(e,d[0]));var p=s_(e,n.kernel.read());0<n.recurrentDropout&&n.recurrentDropout<1&&(a=Mm(a,h[0])),p=Im(p,s_(a,n.recurrentKernel.read())),n.useBias&&(p=d_(p,n.bias.read()));var f=i(Qy(p,4,p.rank-1),4),m=f[0],v=f[1],g=f[2],y=f[3];s=n.recurrentActivation.apply(m),u=n.recurrentActivation.apply(v),c=Im(Mm(u,o),Mm(s,n.activation.apply(g))),l=n.recurrentActivation.apply(y);var b=Mm(l,n.activation.apply(c));return[b,b,c]}))}},{key:"getConfig",value:function(){var e=N(v(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:sC(this.activation),recurrentActivation:sC(this.recurrentActivation),useBias:this.useBias,kernelInitializer:P_(this.kernelInitializer),recurrentInitializer:P_(this.recurrentInitializer),biasInitializer:P_(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:fC(this.kernelRegularizer),recurrentRegularizer:fC(this.recurrentRegularizer),biasRegularizer:fC(this.biasRegularizer),activityRegularizer:fC(this.activityRegularizer),kernelConstraint:mI(this.kernelConstraint),recurrentConstraint:mI(this.recurrentConstraint),biasConstraint:mI(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},e,t)}}]),n}(BC);YC.className="LSTMCell",Tm(YC);var QC=function(e){m(n,e);var t=y(n);function n(e){return T(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new YC(e),t.call(this,e)}return E(n,[{key:"call",value:function(e,t){var r=this;return Rf((function(){null!=r.cell.dropoutMask&&(Lf(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Lf(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return N(v(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(XC);QC.className="LSTM",Tm(QC);var JC=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this,e)).cells=e.cells,r}return E(n,[{key:"stateSize",get:function(){var e,t=[],n=x(this.cells.slice().reverse());try{for(n.s();!(e=n.n()).done;){var r=e.value;Array.isArray(r.stateSize)?t.push.apply(t,b(r.stateSize)):t.push(r.stateSize)}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"call",value:function(e,t){var n=this;return Rf((function(){var r,a=e.slice(1),i=[],o=x(n.cells.slice().reverse());try{for(o.s();!(r=o.n()).done;){var s=r.value;Array.isArray(s.stateSize)?i.push(a.splice(0,s.stateSize.length)):i.push(a.splice(0,1))}}catch(v){o.e(v)}finally{o.f()}i.reverse();for(var u,c=[],l=0;l<n.cells.length;++l){var d=n.cells[l];a=i[l],u=0===l?[e[0]].concat(a):[u[0]].concat(a),u=d.call(u,t),c.push(u.slice(1))}a=[];var h,p=x(c.slice().reverse());try{for(p.s();!(h=p.n()).done;){var f,m=h.value;(f=a).push.apply(f,b(m))}}catch(v){p.e(v)}finally{p.f()}return[u[0]].concat(a)}))}},{key:"build",value:function(e){var t;O_(e)&&(e=e[0]),this.cells.forEach((function(n,r){WT("RNNCell_".concat(r),(function(){n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]}))})),this.built=!0}},{key:"getConfig",value:function(){var e=N(v(n.prototype),"getConfig",this).call(this),t={cells:this.cells.map((function(e){return{className:e.getClassName(),config:e.getConfig()}}))};return Object.assign({},e,t)}},{key:"trainableWeights",get:function(){if(!this.trainable)return[];var e,t=[],n=x(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,b(r.trainableWeights))}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=x(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,b(r.nonTrainableWeights))}}catch(u){n.e(u)}finally{n.f()}if(!this.trainable){var a,i=[],o=x(this.cells);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,b(s.trainableWeights))}}catch(u){o.e(u)}finally{o.f()}return i.concat(t)}return t}},{key:"getWeights",value:function(){var e,t=[],n=x(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,b(r.weights))}}catch(a){n.e(a)}finally{n.f()}return X_(t)}},{key:"setWeights",value:function(e){var t,n=[],r=x(this.cells);try{for(r.s();!(t=r.n()).done;)for(var a=t.value,i=a.weights.length,o=e.splice(i),s=0;s<a.weights.length;++s)n.push([a.weights[s],o[s]])}catch(u){r.e(u)}finally{r.f()}B_(n)}}],[{key:"fromConfig",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=[],i=x(t.cells);try{for(i.s();!(n=i.n()).done;){var o=n.value;a.push(MI(o,r))}}catch(s){i.e(s)}finally{i.f()}return new e({cells:a})}}]),n}(BC);function qC(e){var t=e.ones,n=e.rate,r=e.training,a=void 0!==r&&r,i=e.count,o=void 0===i?1:i,s=e.dropoutFunc,u=function(){return null!=s?s(t(),n):h_(t(),n)},c=function(){return p_(u,t,a)};return!o||o<=1?Af(c().clone()):Array(o).fill(void 0).map(c).map((function(e){return Af(e.clone())}))}JC.className="StackedRNNCells",Tm(JC);var $C=globalThis&&globalThis.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n},eM=function(e){m(n,e);var t=y(n);function n(e){var r;if(T(this,n),e.unroll)throw new rT("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new rT("It is not possible at the moment to stack convolutional cells.");return(r=t.call(this,e)).inputSpec=[new H_({ndim:5})],r}return E(n,[{key:"call",value:function(e,t){var r=this;return Rf((function(){if(null!=r.cell.dropoutMask&&(Lf(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Lf(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),t&&t.constants)throw new nT("ConvRNN2D cell does not support constants");var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return N(v(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}},{key:"computeOutputShape",value:function(e){var t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0]].concat(b(t.slice(2)))),this.returnState&&(t=[t].concat(b(Array(2).fill([e[0]].concat(b(t.slice(-3))))))),t}},{key:"getInitialState",value:function(e){var t=this;return Rf((function(){var n=t.cell.stateSize,r=e.shape,a=t.computeSingleOutputShape(r),i=Xg([a[0]].concat(b(a.slice(2))));return Array.isArray(n)?Array(n.length).fill(i):[i]}))}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Rf((function(){if(!t.stateful)throw new eT("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=t.inputSpec[0].shape,a=t.computeSingleOutputShape(r),i=[a[0]].concat(b(a.slice(2)));if(null==r[0])throw new nT("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.getStates())Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(){return Xg(i)})):t.states_=[Xg(i)];else if(null==e)Lf(t.states_),null!=t.keptStates&&(Lf(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(){return Xg(i)})):t.states_[0]=Xg(i);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new nT("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), but it received ").concat(e.length," state value(s). Input received: ").concat(e));n?t.keptStates.push(t.states_.slice()):Lf(t.states_);for(var o=0;o<t.states_.length;++o){var s=e[o],u=i;if(!ms(s.shape,u))throw new nT("State ".concat(o," is incompatible with layer ").concat(t.name,": expected shape=").concat(u,", received shape=").concat(s.shape));t.states_[o]=s}}t.states_=t.states_.map((function(e){return Af(e.clone())}))}))}},{key:"computeSingleOutputShape",value:function(e){var t=this.cell,n=t.dataFormat,r=t.filters,a=t.kernelSize,i=t.padding,o=t.strides,s=t.dilationRate,u="channelsFirst"===n,c=e[u?3:2],l=e[u?4:3],d=TC(c,a[0],i,o[0],s[0]),h=TC(l,a[1],i,o[1],s[1]);return[].concat(b(e.slice(0,2)),b(u?[r,d,h]:[d,h,r]))}}]),n}(XC);eM.className="ConvRNN2D";var tM=function(e){m(n,e);var t=y(n);function n(e){var r;T(this,n);var a=e.filters,i=e.kernelSize,o=e.strides,s=e.padding,u=e.dataFormat,c=e.dilationRate;return(r=t.call(this,Object.assign({},e,{units:a}))).filters=a,kT(r.filters,"filters"),r.kernelSize=SC(i,2,"kernelSize"),r.kernelSize.forEach((function(e){return kT(e,"kernelSize")})),r.strides=SC(o||1,2,"strides"),r.strides.forEach((function(e){return kT(e,"strides")})),r.padding=s||"valid",OT(r.padding),r.dataFormat=u||"channelsLast",DT(r.dataFormat),r.dilationRate=SC(c||1,2,"dilationRate"),r.dilationRate.forEach((function(e){return kT(e,"dilationRate")})),r}return E(n,[{key:"build",value:function(e){var t;e=G_(e);var n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new nT("The channel dimension of the input should be defined. Found ".concat(e[n]));var r=e[n],a=this.kernelSize.concat([r,4*this.filters]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);var i=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",i,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){var o;if(this.unitForgetBias){var s=this.biasInitializer,u=this.filters;o=new(t=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n,[{key:"apply",value:function(e,t){return r_([s.apply([u]),Bg([u]),s.apply([2*u])])}}]),n}(v_),t.className="CustomInit",t)}else o=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,o,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}},{key:"call",value:function(e,t){var n=this;return Rf((function(){if(3!==e.length)throw new nT("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ".concat(e.length,"."));var r=t.training||!1,a=e[0],o=e[1],s=e[2];0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=qC({ones:function(){return Qg(a)},rate:n.dropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var u=n.dropoutMask,c=function(e,t,n){return t&&t[n]?Mm(t[n],e):e},l=c(a,u,0),d=c(a,u,1),h=c(a,u,2),p=c(a,u,3);0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=qC({ones:function(){return Qg(o)},rate:n.recurrentDropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var f=n.recurrentDropoutMask,m=c(o,f,0),v=c(o,f,1),g=c(o,f,2),y=c(o,f,3),b=i(Qy(n.kernel.read(),4,3),4),x=b[0],w=b[1],k=b[2],S=b[3],T=i(n.useBias?Qy(n.bias.read(),4):[null,null,null,null],4),_=T[0],I=T[1],E=T[2],C=T[3];l=n.inputConv(l,x,_,n.padding),d=n.inputConv(d,w,I,n.padding),h=n.inputConv(h,k,E,n.padding),p=n.inputConv(p,S,C,n.padding);var M=i(Qy(n.recurrentKernel.read(),4,3),4),N=M[0],R=M[1],L=M[2],A=M[3];m=n.recurrentConv(m,N),v=n.recurrentConv(v,R),g=n.recurrentConv(g,L),y=n.recurrentConv(y,A);var P=n.recurrentActivation.apply(Im(l,m)),D=n.recurrentActivation.apply(Im(d,v)),O=Im(Mm(D,s),Mm(P,n.activation.apply(Im(h,g)))),z=Mm(n.recurrentActivation.apply(Im(p,y)),n.activation.apply(O));return[z,z,O]}))}},{key:"getConfig",value:function(){var e=N(v(n.prototype),"getConfig",this).call(this),t=$C(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign({},t,r)}},{key:"inputConv",value:function(e,t,n,r){var a=Tv(e,t,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?d_(a,n,this.dataFormat):a}},{key:"recurrentConv",value:function(e,t){return Tv(e,t,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}]),n}(YC);tM.className="ConvLSTM2DCell",Tm(tM);var nM=function(e){m(n,e);var t=y(n);function n(e){T(this,n);var r=new tM(e);return t.call(this,Object.assign({},e,{cell:r}))}return E(n,null,[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(eM);nM.className="ConvLSTM2D",Tm(nM);var rM=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this,e)).rate=Math.max(Math.min(e.rate,1),0),r.noiseShape=e.noiseShape,r.seed=e.seed,r.supportsMasking=!0,r}return E(n,[{key:"getNoiseShape",value:function(e){if(null==this.noiseShape)return this.noiseShape;for(var t=e.shape,n=[],r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?t[r]:this.noiseShape[r]);return n}},{key:"call",value:function(e,t){var n=this;return Rf((function(){n.invokeCallHook(e,t);var r=F_(e);if(0<n.rate&&n.rate<1){var a=null!=t.training&&t.training,i=n.getNoiseShape(r);return p_((function(){return h_(r,n.rate,i,n.seed)}),(function(){return r}),a)}return e}))}},{key:"getConfig",value:function(){var e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=N(v(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"dispose",value:function(){return N(v(n.prototype),"dispose",this).call(this)}}]),n}(Q_);rM.className="Dropout",Tm(rM);var aM=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this,e)).inputSpec=[{ndim:3}],r}return E(n,[{key:"getNoiseShape",value:function(e){var t=e.shape;return[t[0],1,t[2]]}}]),n}(rM);aM.className="SpatialDropout1D",Tm(aM);var iM=function(e){m(n,e);var t=y(n);function n(e){var r;if(T(this,n),(r=t.call(this,e)).activation=null,r.useBias=!0,r.kernel=null,r.bias=null,r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){var a=null;null!=e.batchSize&&(a=e.batchSize),r.batchInputShape=[a,e.inputDim]}return r.units=e.units,kT(r.units,"units"),r.activation=cC(e.activation),null!=e.useBias&&(r.useBias=e.useBias),r.kernelInitializer=D_(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.biasInitializer=D_(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelConstraint=gI(e.kernelConstraint),r.biasConstraint=gI(e.biasConstraint),r.kernelRegularizer=vC(e.kernelRegularizer),r.biasRegularizer=vC(e.biasRegularizer),r.activityRegularizer=vC(e.activityRegularizer),r.supportsMasking=!0,r.inputSpec=[{minNDim:2}],p(r)}return E(n,[{key:"build",value:function(e){var t=(e=G_(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:R({},-1,t)}],this.built=!0}},{key:"computeOutputShape",value:function(e){var t=(e=G_(e)).slice();return t[t.length-1]=this.units,t}},{key:"call",value:function(e,t){var n=this;return Rf((function(){n.invokeCallHook(e,t);var r,a=F_(e),i=TT(n.activation.getClassName());return null!=i?r=s_(a,n.kernel.read(),i,n.bias?n.bias.read():null):(r=s_(a,n.kernel.read()),null!=n.bias&&(r=d_(r,n.bias.read())),null!=n.activation&&(r=n.activation.apply(r))),r}))}},{key:"getConfig",value:function(){var e={units:this.units,activation:sC(this.activation),useBias:this.useBias,kernelInitializer:P_(this.kernelInitializer),biasInitializer:P_(this.biasInitializer),kernelRegularizer:fC(this.kernelRegularizer),biasRegularizer:fC(this.biasRegularizer),activityRegularizer:fC(this.activityRegularizer),kernelConstraint:mI(this.kernelConstraint),biasConstraint:mI(this.biasConstraint)},t=N(v(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Q_);iM.className="Dense",Tm(iM);var oM=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),e=e||{},(r=t.call(this,e)).inputSpec=[{minNDim:3}],r.dataFormat=e.dataFormat,r}return E(n,[{key:"computeOutputShape",value:function(e){var t,n=x((e=G_(e)).slice(1));try{for(n.s();!(t=n.n()).done;){if(null==t.value)throw new nT('The shape of the input to "Flatten" is not fully defined (got '.concat(e.slice(1),'). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.'))}}catch(r){n.e(r)}finally{n.f()}return[e[0],KT(e,1)]}},{key:"call",value:function(e,t){var n=this;return Rf((function(){n.invokeCallHook(e,t);var r=F_(e);if("channelsFirst"===n.dataFormat&&r.rank>1){for(var a=[0],i=2;i<r.rank;++i)a.push(i);a.push(1),r=Gf(r,a)}return function(e){if(e.rank<=1)throw new nT("batchFlatten requires a minimum rank of 2. Got rank: ".concat(e.rank,"."));var t=[e.shape[0],KT(e.shape,1)];return nv(e,t)}(r)}))}},{key:"getConfig",value:function(){var e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);var t=N(v(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Q_);oM.className="Flatten",Tm(oM);var sM=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this,e)).supportsMasking=!0,r.activation=cC(e.activation),r}return E(n,[{key:"call",value:function(e,t){var n=this;return Rf((function(){n.invokeCallHook(e,t);var r=F_(e);return n.activation.apply(r)}))}},{key:"getConfig",value:function(){var e={activation:sC(this.activation)},t=N(v(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Q_);sM.className="Activation",Tm(sM);var uM=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this,e)).n=e.n,r.inputSpec=[{ndim:2}],r}return E(n,[{key:"computeOutputShape",value:function(e){return[e[0],this.n,e[1]]}},{key:"call",value:function(e,t){var n=this;return Rf((function(){return function(e,t){return Rf((function(){if(2!==e.shape.length)throw new nT("repeat() expects a rank-2 tensor, but received a rank-".concat(e.shape.length," tensor."));return i_($T(e,1),[1,t,1])}))}(e=F_(e),n.n)}))}},{key:"getConfig",value:function(){var e={n:this.n},t=N(v(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Q_);uM.className="RepeatVector",Tm(uM);var cM=function(e){m(n,e);var t=y(n);function n(e){var r;T(this,n),(r=t.call(this,e)).targetShape=e.targetShape;for(var a=0;a<r.targetShape.length;++a)r.isUnknown(r.targetShape[a])&&(r.targetShape[a]=null);return r}return E(n,[{key:"isUnknown",value:function(e){return e<0||null==e}},{key:"fixUnknownDimension",value:function(e,t){for(var n="Total size of new array must be unchanged.",r=t.slice(),a=1,i=null,o=0;o<r.length;++o){var s=r[o];if(this.isUnknown(s)){if(null!==i)throw new nT("Can only specifiy one unknown dimension.");i=o}else a*=s}var u=KT(e);if(null!==i){if(0===a||u%a!==0)throw new nT(n);r[i]=u/a}else if(u!==a)throw new nT(n);return r}},{key:"computeOutputShape",value:function(e){for(var t=!1,n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}},{key:"call",value:function(e,t){var n=this;return Rf((function(){n.invokeCallHook(e,t);var r=F_(e),a=r.shape,i=a.slice(0,1).concat(n.fixUnknownDimension(a.slice(1),n.targetShape));return nv(r,i)}))}},{key:"getConfig",value:function(){var e={targetShape:this.targetShape},t=N(v(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Q_);cM.className="Reshape",Tm(cM);var lM=function(e){m(n,e);var t=y(n);function n(e){var r;if(T(this,n),r=t.call(this,e),null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received ".concat(e.dims," instead."));var a=QT(1,e.dims.length+1);if(!ms(e.dims.slice().sort(),a))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");return r.dims=e.dims,r.dimsIncludingBatch=[0].concat(r.dims),r.inputSpec=[new H_({ndim:r.dims.length+1})],p(r)}return E(n,[{key:"computeOutputShape",value:function(e){var t=(e=G_(e)).slice();return this.dims.forEach((function(n,r){t[r+1]=e[n]})),t}},{key:"call",value:function(e,t){return Gf(F_(e),this.dimsIncludingBatch)}},{key:"getConfig",value:function(){var e={dims:this.dims},t=N(v(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Q_);lM.className="Permute",Tm(lM);var dM=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this,null!==e&&void 0!==e?e:{})).supportsMasking=!0,r.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0,r}return E(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=N(v(n.prototype),"getConfig",this).call(this),t={maskValue:this.maskValue};return Object.assign(t,e),t}},{key:"computeMask",value:function(e,t){var n=F_(e);return Pm(Yg(n,this.maskValue),-1)}},{key:"call",value:function(e,t){var n=this;return Rf((function(){n.invokeCallHook(e,t);var r=F_(e),a=Pm(Yg(r,n.maskValue),-1,!0);return Mm(r,hf(a,r.dtype))}))}}]),n}(Q_);dM.className="Masking",Tm(dM);var hM=function(e){m(n,e);var t=y(n);function n(e){var r;if(T(this,n),(r=t.call(this,e)).embeddings=null,r.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){var a=null;null!=e.batchSize&&(a=e.batchSize),null==e.inputLength?r.batchInputShape=[a,null]:r.batchInputShape=[a].concat(lT(e.inputLength))}return r.inputDim=e.inputDim,kT(r.inputDim,"inputDim"),r.outputDim=e.outputDim,kT(r.outputDim,"outputDim"),r.embeddingsInitializer=D_(e.embeddingsInitializer||r.DEFAULT_EMBEDDINGS_INITIALIZER),r.embeddingsRegularizer=vC(e.embeddingsRegularizer),r.activityRegularizer=vC(e.activityRegularizer),r.embeddingsConstraint=gI(e.embeddingsConstraint),r.maskZero=e.maskZero,r.supportsMasking=e.maskZero,r.inputLength=e.inputLength,p(r)}return E(n,[{key:"build",value:function(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}},{key:"warnOnIncompatibleInputShape",value:function(e){}},{key:"computeMask",value:function(e,t){var n=this;return Rf((function(){return n.maskZero?(e=F_(e),Yg(e,Wv(e))):null}))}},{key:"computeOutputShape",value:function(e){if(e=G_(e),null==this.inputLength)return[].concat(b(e),[this.outputDim]);var t=lT(this.inputLength);if(t.length!==e.length-1)throw new nT('"inputLength" is '.concat(this.inputLength,", but received input shape has shape ").concat(e));for(var n=0,r=0;r<t.length;++r){var a=t[r],i=e[r+1];if(null!=a&&null!=i&&a!==i)throw new nT('"inputLength" is '.concat(this.inputLength,", but received input shape has shape ").concat(e));null==a&&(t[n]=i),n++}return[e[0]].concat(b(t),[this.outputDim])}},{key:"call",value:function(e,t){var n=this;return Rf((function(){n.invokeCallHook(e,t);var r=F_(e);"int32"!==r.dtype&&(r=qT(r,"int32"));var a=u_(n.embeddings.read(),nv(r,[r.size]));return nv(a,G_(n.computeOutputShape(r.shape)))}))}},{key:"getConfig",value:function(){var e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:P_(this.embeddingsInitializer),embeddingsRegularizer:fC(this.embeddingsRegularizer),activityRegularizer:fC(this.activityRegularizer),embeddingsConstraint:mI(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=N(v(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Q_);hM.className="Embedding",Tm(hM);var pM=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this,e||{})).supportsMasking=!0,r}return E(n,[{key:"mergeFunction",value:function(e){throw new rT}},{key:"computeElementwiseOpOutputShape",value:function(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;for(var n=e.slice(0,e.length-t.length),r=0;r<t.length;++r){var a=e[e.length-t.length+r],i=t[r];if(null==a||null==i||a<0||i<0)n.push(null);else if(1===a)n.push(i);else if(1===i)n.push(a);else{if(a!==i)throw new nT("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(a)}}return n}},{key:"build",value:function(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[G_(e)]),e.length<2)throw new nT("A merge layer should be called on an Array of at least 2 inputs. Got ".concat(e.length," input(s)."));var t,n=[],r=x(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;null!=a&&null!==a[0]&&n.push(a[0])}}catch(c){r.e(c)}finally{r.f()}if((n=yT(n)).length>1)throw new nT("Can not merge tensors with different batch sizes. Got tensors with shapes: ".concat(JSON.stringify(e),"."));for(var i=null==e[0]?null:e[0].slice(1),o=1;o<e.length;++o){var s=null==e[o]?null:e[o].slice(1);i=this.computeElementwiseOpOutputShape(i,s)}var u=e.map((function(e){return e.length}));-1===e.indexOf(null)&&1===yT(u).length?this.reshapeRequired=!1:this.reshapeRequired=!0}},{key:"call",value:function(e,t){var n=this;return Rf((function(){if(n.reshapeRequired){var t=[],r=e.map((function(e){return e.rank}));if(-1===r.indexOf(null)){var a,i=YT(r),o=x(e);try{for(o.s();!(a=o.n()).done;){for(var s=a.value,u=s.rank,c=0;c<i-u;++c)s=$T(s,1);t.push(s)}}catch(E){o.e(E)}finally{o.f()}return n.mergeFunction(t)}var l,d=!1,h=x(e);try{for(h.s();!(l=h.n()).done;){var p=l.value,f=p.rank;if(null==f){var m=p.shape,v=m[0],g=m.slice(1).concat([v]),y=nv(p,[v].concat(KT(m.slice(1))));y=Gf(y,[1,0]),y=nv(y,g),t.push(y),d=!0}else if(f>1){var b=QT(1,f).concat([0]);t.push(Gf(p,b)),d=!0}else t.push(p)}}catch(E){h.e(E)}finally{h.f()}var w=n.mergeFunction(t),k=w.rank;if(d)if(null==k){var S=w.shape,T=S[S.length-1],_=[T].concat(S.slice(0,S.length-1));w=nv(Gf(nv(w,[-1,T]),[1,0]),_)}else if(k>1){var I=[k-1].concat(QT(0,k-1));w=Gf(w,I)}return w}return n.mergeFunction(e)}))}},{key:"computeOutputShape",value:function(e){var t;t=null==e[0]?null:e[0].slice(1);for(var n=1;n<e.length;++n){var r=null==e[n]?null:e[n].slice(1);t=this.computeElementwiseOpOutputShape(t,r)}var a,i=[],o=x(e);try{for(o.s();!(a=o.n()).done;){var s=a.value;null!=s&&null!==s[0]&&i.push(s[0])}}catch(u){o.e(u)}finally{o.f()}return t=1===(i=yT(i)).length?i.concat(t):[null].concat(t)}},{key:"computeMask",value:function(e,t){return Rf((function(){if(null==t)return null;if(!Array.isArray(t))throw new nT("`mask` should be an Array");if(!Array.isArray(e))throw new nT("`inputs` should be an Array");if(t.length!==e.length)throw new nT("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (".concat(e.length," vs ").concat(t.length,")"));if(t.every((function(e){return null==e})))return null;t=t.map((function(e){return null==e?e:lg(e,0)}));for(var n=t[0],r=1;r<t.length-1;++r)n=Dg(n,t[r]);return n}))}}]),n}(Q_),fM=function(e){m(n,e);var t=y(n);function n(e){return T(this,n),t.call(this,e)}return E(n,[{key:"mergeFunction",value:function(e){return Rf((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=Im(t,e[n]);return t}))}}]),n}(pM);fM.className="Add",Tm(fM);var mM=function(e){m(n,e);var t=y(n);function n(e){return T(this,n),t.call(this,e)}return E(n,[{key:"mergeFunction",value:function(e){return Rf((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=Mm(t,e[n]);return t}))}}]),n}(pM);mM.className="Multiply",Tm(mM);var vM=function(e){m(n,e);var t=y(n);function n(e){return T(this,n),t.call(this,e)}return E(n,[{key:"mergeFunction",value:function(e){return Rf((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=Im(t,e[n]);return Mm(1/e.length,t)}))}}]),n}(pM);vM.className="Average",Tm(vM);var gM=function(e){m(n,e);var t=y(n);function n(e){return T(this,n),t.call(this,e)}return E(n,[{key:"mergeFunction",value:function(e){return Rf((function(){for(var t=e[0],n=1;n<e.length;++n)t=Vg(t,e[n]);return t}))}}]),n}(pM);gM.className="Maximum",Tm(gM);var yM=function(e){m(n,e);var t=y(n);function n(e){return T(this,n),t.call(this,e)}return E(n,[{key:"mergeFunction",value:function(e){return Rf((function(){for(var t=e[0],n=1;n<e.length;++n)t=Hg(t,e[n]);return t}))}}]),n}(pM);yM.className="Minimum",Tm(yM);var bM=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this,e)).DEFAULT_AXIS=-1,null==e&&(e={}),r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r.supportsMasking=!0,r.reshapeRequired=!1,r}return E(n,[{key:"build",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new nT("A `Concatenate` layer should be called on a list of at least 2 inputs");var t,n=!0,r=x(e);try{for(r.s();!(t=r.n()).done;){if(null!=t.value){n=!1;break}}}catch(l){r.e(l)}finally{r.f()}if(!n){for(var a=[],i=0;i<e.length;++i){var o=e[i].slice();o.splice(this.axis,1);var s,u=!1,c=x(a);try{for(c.s();!(s=c.n()).done;){if(ms(s.value,o)){u=!0;break}}}catch(l){c.e(l)}finally{c.f()}u||a.push(o)}if(a.length>1)throw new nT("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}}},{key:"mergeFunction",value:function(e){var t=this;return Rf((function(){return r_(e,t.axis)}))}},{key:"computeOutputShape",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new nT("A `Concatenate` layer should be called on a list of inputs.");var t,n=e,r=n[0].slice(),a=this.axis<0?r.length+this.axis:this.axis,i=x(n.slice(1));try{for(i.s();!(t=i.n()).done;){var o=t.value;if(null==r[a]||null==o[a]){r[a]=null;break}r[a]+=o[a]}}catch(s){i.e(s)}finally{i.f()}return r}},{key:"computeMask",value:function(e,t){var n=this;if(null==t)return null;if(!Array.isArray(t))throw new nT("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new nT("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new nT("Mismatch in the length of mask (".concat(t.length,") and the legnth of inputs (").concat(e.length,")"));return Rf((function(){var r=!0;if(t.forEach((function(e){null==e||(r=!1)})),r)return null;for(var a=[],i=0;i<e.length;++i)null==t[i]?a.push(hf(Qg(e[i]),"bool")):t[i].rank<e[i].rank?a.push(lg(t[i],-1)):a.push(t[i]);var o=iv(a,n.axis);return Am(o,-1,!1)}))}},{key:"getConfig",value:function(){var e={axis:this.axis},t=N(v(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(pM);function xM(e,t){for(;e<0;)e+=t;return e}bM.className="Concatenate",Tm(bM);var wM=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this,e)).axes=e.axes,r.normalize=null!=e.normalize&&e.normalize,r.supportsMasking=!0,r.reshapeRequired=!1,r}return E(n,[{key:"build",value:function(e){ls(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0],n=e[1];if(t.length>3||n.length>3)throw new rT("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);if(t[r[0]]!==n[r[1]])throw new nT("Dimension incompatibility: ".concat(t[r[0]]," !== ").concat(n[r[1]]))}},{key:"mergeFunction",value:function(e){if(2!==e.length)throw new nT("A `Dot` layer must be called on exactly 2 inputs, but received ".concat(e.length," input(s)."));var t,n=e[0],r=e[1];return t=Array.isArray(this.axes)?this.axes.map((function(t,n){return xM(t,e[n].shape.length)})):[xM(this.axes,n.shape.length),xM(this.axes,r.shape.length)],this.normalize&&(n=NI(n,t[0]),r=NI(r,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new rT("batchDot is not implemented for tensors of 4D or higher rank yet");if(ls(e.shape.length>=2,(function(){return"batchDot requires the rank of x to be >= 2, but got ".concat(e.shape.length)})),ls(e.shape.length>=2,(function(){return"batchDot requires the rank of y to be >= 2, but got ".concat(t.shape.length)})),"number"==typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new rT("batchDot is not implemented for complex64-type Tensors yet.");var r=e.shape.length,a=t.shape.length;null==n&&(n=[r-1,a-2]);var i=n;return Rf((function(){var n,o;if(r>a){n=r-a;for(var s=[],u=0;u<n;++u)s.push(1);t=nv(t,t.shape.concat(s))}else if(a>r){n=a-r;for(var c=[],l=0;l<n;++l)c.push(1);e=nv(e,e.shape.concat(c))}else n=0;if(2===e.shape.length&&2===t.shape.length)o=i[0]===i[1]?ig(Mm(e,t),i[0]):ig(Mm(Gf(e,[1,0]),t),i[1]);else{var d=i[0]!==e.shape.length-1,h=i[1]===t.shape.length-1;o=Ef(e,t,d,h)}if(n>0){for(var p,f=[],m=p=r>a?r+a-3:r-1;m<p+n;++m)f.push(m);o=$y(o,f)}return 1===o.shape.length&&(o=lg(o,1)),o}))}(n,r,t)}},{key:"interpretAxes",value:function(e,t){return Array.isArray(this.axes)?this.axes:[xM(this.axes,e.length),xM(this.axes,t.length)]}},{key:"computeOutputShape",value:function(e){ls(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new rT("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);t.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);var a=t.concat(n);return 1===a.length&&a.push(1),a}},{key:"computeMask",value:function(e,t){return null}},{key:"getConfig",value:function(){var e={axes:this.axes,normalize:this.normalize},t=N(v(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(pM);wM.className="Dot",Tm(wM);var kM=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this,e)).supportsMasking=!0,r.stddev=e.stddev,r}return E(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=N(v(n.prototype),"getConfig",this).call(this),t={stddev:this.stddev};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return Rf((function(){n.invokeCallHook(e,t);var r=F_(e);return p_((function(){return Im(o_(r.shape,0,n.stddev),r)}),(function(){return r}),t.training||!1)}))}}]),n}(Q_);kM.className="GaussianNoise",Tm(kM);var SM=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r}return E(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=N(v(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return Rf((function(){n.invokeCallHook(e,t);var r=F_(e);return n.rate>0&&n.rate<1?p_((function(){var e=Math.sqrt(n.rate/(1-n.rate));return Mm(r,o_(r.shape,1,e))}),(function(){return r}),t.training||!1):r}))}}]),n}(Q_);SM.className="GaussianDropout",Tm(SM);var TM=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r.noiseShape=e.noiseShape,r}return E(n,[{key:"_getNoiseShape",value:function(e){return this.noiseShape||F_(e).shape}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=N(v(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return Rf((function(){if(n.rate<1&&n.rate>0){var r=n._getNoiseShape(e);return p_((function(){var t=F_(e),a=-1.7580993408473766,i=gg(My(r),n.rate);i=qT(i,"float32");var o=Math.pow((1-n.rate)*(1+n.rate*Math.pow(a,2)),-.5),s=-o*a*n.rate,u=Im(Mm(t,i),Mm(Im(i,-1),a));return Im(Mm(u,o),s)}),(function(){return F_(e)}),t.training||!1)}return e}))}}]),n}(Q_);function _M(e,t,n,r,a){var i,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.001;if(2===e.rank)i=hv(e,t,n,r,a,o);else if(3===e.rank)i=pv(e,t,n,r,a,o);else{if(4!==e.rank)throw new rT("batchNormalization is not implemented for array of rank ".concat(e.rank," yet"));i=fv(e,t,n,r,a,o)}return i}function IM(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return ms(r.slice().sort(),QT(0,e.rank-1))?function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return Rf((function(){var i=jg(e,r),o=i.mean,s=i.variance;return[_M(e,o,s,n,t,a),o,s]}))}(e,t,n,r,a):function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return Rf((function(){var i,o=jg(e,r),s=o.mean,u=o.variance,c=[],l=x(QT(0,e.rank));try{for(l.s();!(i=l.n()).done;){var d=i.value;-1!==r.indexOf(d)?c.push(1):c.push(e.shape[d])}}catch(v){l.e(v)}finally{l.f()}var h=nv(s,c),p=nv(u,c),f=null==t?null:nv(t,c),m=null==n?null:nv(n,c);return[_M(e,h,p,m,f,a),s,u]}))}(e,t,n,r,a)}TM.className="AlphaDropout",Tm(TM);var EM=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),null==e&&(e={}),(r=t.call(this,e)).supportsMasking=!0,r.axis=null==e.axis?-1:e.axis,r.momentum=null==e.momentum?.99:e.momentum,r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=D_(e.betaInitializer||"zeros"),r.gammaInitializer=D_(e.gammaInitializer||"ones"),r.movingMeanInitializer=D_(e.movingMeanInitializer||"zeros"),r.movingVarianceInitializer=D_(e.movingVarianceInitializer||"ones"),r.betaConstraint=gI(e.betaConstraint),r.gammaConstraint=gI(e.gammaConstraint),r.betaRegularizer=vC(e.betaRegularizer),r.gammaRegularizer=vC(e.gammaRegularizer),r}return E(n,[{key:"build",value:function(e){e=G_(e);var t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new nT("Axis ".concat(t," of input tensor should have a defined dimension but the layer received an input with shape ").concat(JSON.stringify(e),"."));this.inputSpec=[new H_({ndim:e.length,axes:R({},t,n)})];var r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}},{key:"call",value:function(e,t){var n=this;return Rf((function(){var r=null!=t.training&&t.training,a=F_(e),o=a.shape,s=o.length,u=QT(0,s),c=n.axis>=0?n.axis:n.axis+s;u.splice(c,1);var l=oT(1,s);l[c]=o[c];var d=u.slice();d.sort();var h=!ms(d,QT(0,s).slice(0,s-1));if(!r)return function(){if(h){var e=nv(n.movingMean.read(),l),t=nv(n.movingVariance.read(),l),r=n.center?nv(n.beta.read(),l):null,i=n.scale?nv(n.gamma.read(),l):null;return _M(a,e,t,r,i,n.epsilon)}return _M(a,n.movingMean.read(),n.movingVariance.read(),null==n.beta?null:n.beta.read(),null==n.gamma?null:n.gamma.read(),n.epsilon)}();var p=i(IM(a,n.gamma.read(),n.beta.read(),u,n.epsilon),3),f=p[0],m=p[1],v=p[2],g=function(e,t,n){Rf((function(){var r=1-n,a=e.read(),i=Mm(Lg(a,t),r);e.write(Lg(a,i))}))};return g(n.movingMean,m,n.momentum),g(n.movingVariance,v,n.momentum),f}))}},{key:"getConfig",value:function(){var e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:P_(this.betaInitializer),gammaInitializer:P_(this.gammaInitializer),movingMeanInitializer:P_(this.movingMeanInitializer),movingVarianceInitializer:P_(this.movingVarianceInitializer),betaRegularizer:fC(this.betaRegularizer),gammaRegularizer:fC(this.gammaRegularizer),betaConstraint:mI(this.betaConstraint),gammaConstraint:mI(this.gammaConstraint)},t=N(v(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Q_);EM.className="BatchNormalization",Tm(EM);var CM=function(e){m(n,e);var t=y(n);function n(e){var r;if(T(this,n),null==e&&(e={}),(r=t.call(this,e)).axis=null==e.axis?-1:e.axis,"number"==typeof r.axis){if(!Number.isInteger(r.axis))throw new Error("Expected axis to be an integer, but received ".concat(r.axis))}else{if(!Array.isArray(r.axis))throw new Error("Expected axis to be an integer or an array of integers, but received ".concat(JSON.stringify(r.axis)));var a,i=x(r.axis);try{for(i.s();!(a=i.n()).done;){var o=a.value;if(!Number.isInteger(o))throw new Error("Expected axis to be an array of integers, but received ".concat(JSON.stringify(r.axis)))}}catch(s){i.e(s)}finally{i.f()}}return r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=D_(e.betaInitializer||"zeros"),r.gammaInitializer=D_(e.gammaInitializer||"ones"),r.betaRegularizer=vC(e.betaRegularizer),r.gammaRegularizer=vC(e.gammaRegularizer),r.supportsMasking=!0,p(r)}return E(n,[{key:"build",value:function(e){var t=(e=G_(e)).length;"number"==typeof this.axis&&(this.axis=[this.axis]);for(var n=0;n<this.axis.length;++n)this.axis[n]<0&&(this.axis[n]+=t);var r,a=x(this.axis);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i<0||i>=t)throw new Error("Invalid axis: ".concat(i))}}catch(s){a.e(s)}finally{a.f()}if(this.axis.length!==yT(this.axis).length)throw new Error("Found duplicate axes in: ".concat(this.axis));var o=this.axis.map((function(t){return e[t]}));this.scale?this.gamma=this.addWeight("gamma",o,"float32",this.gammaInitializer,this.gammaRegularizer,true):this.gamma=null,this.center?this.beta=this.addWeight("beta",o,"float32",this.betaInitializer,this.betaRegularizer,true):this.beta=null,this.built=!0}},{key:"call",value:function(e,t){var n=this,r=F_(e),a=r.shape,i=a.length;return Rf((function(){var e,t=jg(r,n.axis,!0),o=t.mean,s=t.variance,u=oT(1,i),c=x(n.axis);try{for(c.s();!(e=c.n()).done;){var l=e.value;u[l]=a[l]}}catch(g){c.e(g)}finally{c.f()}for(var d=function(e){return null!=e&&e.shape.length!==i?nv(e,u):e},h=n.scale?d(n.gamma.read()):null,p=n.center?d(n.beta.read()):null,f=[],m=[],v=0;v<i;++v)-1!==n.axis.indexOf(v)?(f.push(a[v]),m.push(1)):(f.push(1),m.push(a[v]));return o=hg(o,f),s=hg(s,f),null!=h&&(h=hg(h,m)),null!=p&&(p=hg(p,m)),_M(r,o,s,p,h,n.epsilon)}))}},{key:"getConfig",value:function(){var e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:P_(this.betaInitializer),gammaInitializer:P_(this.gammaInitializer),betaRegularizer:fC(this.betaRegularizer),gammaRegularizer:fC(this.gammaRegularizer)},t=N(v(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Q_);CM.className="LayerNormalization",Tm(CM);var MM=function(e){m(n,e);var t=y(n);function n(e){var r;if(T(this,n),null==e&&(e={}),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)r.padding=[[1,1],[1,1]];else if("number"==typeof e.padding)r.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new nT("ZeroPadding2D expects padding to be a length-2 array, but received a length-".concat(e.padding.length," array."));var a,i;if("number"==typeof e.padding[0])a=[e.padding[0],e.padding[0]],i=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new nT("ZeroPadding2D expects height padding to be a length-2 array, but received a length-".concat(e.padding[0].length," array."));if(a=e.padding[0],2!==e.padding[1].length)throw new nT("ZeroPadding2D expects width padding to be a length-2 array, but received a length-".concat(e.padding[1].length," array."));i=e.padding[1]}r.padding=[a,i]}return r.inputSpec=[new H_({ndim:4})],p(r)}return E(n,[{key:"computeOutputShape",value:function(e){var t,n;return e=G_(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}},{key:"call",value:function(e,t){var n=this;return Rf((function(){return function(e,t,n){return Rf((function(){if(4!==e.rank)throw new nT("temporalPadding expects input tensor to be 4-D, but received a ".concat(e.rank,"-D tensor."));if(null==t&&(t=[[1,1],[1,1]]),2!==t.length||2!==t[0].length||2!==t[1].length)throw new nT("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==n&&(n="channelsLast"),"channelsLast"!==n&&"channelsFirst"!==n)throw new nT("Unknown data format: ".concat(n,". Supported data formats are 'channelsLast' and 'channelsFirst."));var r;return r="channelsFirst"===n?[[0,0],[0,0],t[0],t[1]]:[[0,0],t[0],t[1],[0,0]],Jg(e,r)}))}(F_(e),n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={padding:this.padding,dataFormat:this.dataFormat},t=N(v(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Q_);function NM(e,t,n,r,a,i){return Rf((function(){var o;DT(a),zT(i),OT(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=IC(e,a);var s="same"===r?"same":"valid";return o="max"===i?Gg(e,t,n,s):rv(e,t,n,s),"channelsFirst"===a&&(o=Gf(o,[0,3,1,2])),o}))}function RM(e,t,n,r,a,i){return Rf((function(){var o;DT(a),zT(i),OT(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=EC(e,a);var s="same"===r?"same":"valid";return o="max"===i?Wg(e,t,n,s):av(e,t,n,s),"channelsFirst"===a&&(o=Gf(o,[0,4,1,2,3])),o}))}MM.className="ZeroPadding2D",Tm(MM);var LM=function(e){m(n,e);var t=y(n);function n(e){var r;if(T(this,n),null==e.poolSize&&(e.poolSize=2),r=t.call(this,e),"number"==typeof e.poolSize)r.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!=typeof e.poolSize[0])throw new nT("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ".concat(JSON.stringify(e.poolSize)));r.poolSize=e.poolSize}if(kT(r.poolSize,"poolSize"),null==e.strides)r.strides=r.poolSize;else if("number"==typeof e.strides)r.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!=typeof e.strides[0])throw new nT("strides for 1D convolutional layer must be a number or an Array of a single number, but received ".concat(JSON.stringify(e.strides)));r.strides=e.strides}return kT(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,OT(r.padding),r.inputSpec=[new H_({ndim:3})],p(r)}return E(n,[{key:"computeOutputShape",value:function(e){var t=TC((e=G_(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}},{key:"call",value:function(e,t){var n=this;return Rf((function(){n.invokeCallHook(e,t),e=$T(F_(e),2);var r=n.poolingFunction(F_(e),[n.poolSize[0],1],[n.strides[0],1],n.padding,"channelsLast");return $y(r,[2])}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=N(v(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Q_),AM=function(e){m(n,e);var t=y(n);function n(e){return T(this,n),t.call(this,e)}return E(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return DT(a),OT(r),NM(e,t,n,r,a,"max")}}]),n}(LM);AM.className="MaxPooling1D",Tm(AM);var PM=function(e){m(n,e);var t=y(n);function n(e){return T(this,n),t.call(this,e)}return E(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return DT(a),OT(r),NM(e,t,n,r,a,"avg")}}]),n}(LM);PM.className="AveragePooling1D",Tm(PM);var DM=function(e){m(n,e);var t=y(n);function n(e){var r;if(T(this,n),null==e.poolSize&&(e.poolSize=[2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new nT("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides];return kT(r.poolSize,"poolSize"),kT(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,DT(r.dataFormat),OT(r.padding),r.inputSpec=[new H_({ndim:4})],p(r)}return E(n,[{key:"computeOutputShape",value:function(e){e=G_(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=TC(t,this.poolSize[0],this.padding,this.strides[0]),n=TC(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}},{key:"call",value:function(e,t){var n=this;return Rf((function(){return n.invokeCallHook(e,t),n.poolingFunction(F_(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=N(v(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Q_),OM=function(e){m(n,e);var t=y(n);function n(e){return T(this,n),t.call(this,e)}return E(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return DT(a),OT(r),NM(e,t,n,r,a,"max")}}]),n}(DM);OM.className="MaxPooling2D",Tm(OM);var zM=function(e){m(n,e);var t=y(n);function n(e){return T(this,n),t.call(this,e)}return E(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return DT(a),OT(r),NM(e,t,n,r,a,"avg")}}]),n}(DM);zM.className="AveragePooling2D",Tm(zM);var FM=function(e){m(n,e);var t=y(n);function n(e){var r;if(T(this,n),null==e.poolSize&&(e.poolSize=[2,2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new nT("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides,e.strides];return kT(r.poolSize,"poolSize"),kT(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,DT(r.dataFormat),OT(r.padding),r.inputSpec=[new H_({ndim:5})],p(r)}return E(n,[{key:"computeOutputShape",value:function(e){e=G_(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[4]:e[3];return t=TC(t,this.poolSize[0],this.padding,this.strides[0]),n=TC(n,this.poolSize[1],this.padding,this.strides[1]),r=TC(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]}},{key:"call",value:function(e,t){var n=this;return Rf((function(){return n.invokeCallHook(e,t),n.poolingFunction(F_(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=N(v(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Q_),GM=function(e){m(n,e);var t=y(n);function n(e){return T(this,n),t.call(this,e)}return E(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return DT(a),OT(r),RM(e,t,n,r,a,"max")}}]),n}(FM);GM.className="MaxPooling3D",Tm(GM);var WM=function(e){m(n,e);var t=y(n);function n(e){return T(this,n),t.call(this,e)}return E(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return DT(a),OT(r),RM(e,t,n,r,a,"avg")}}]),n}(FM);WM.className="AveragePooling3D",Tm(WM);var VM=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this,e)).inputSpec=[new H_({ndim:3})],r}return E(n,[{key:"computeOutputShape",value:function(e){return[e[0],e[2]]}},{key:"call",value:function(e,t){throw new rT}}]),n}(Q_),UM=function(e){m(n,e);var t=y(n);function n(e){return T(this,n),t.call(this,e||{})}return E(n,[{key:"call",value:function(e,t){return Rf((function(){var t=F_(e);return Ug(t,1)}))}}]),n}(VM);UM.className="GlobalAveragePooling1D",Tm(UM);var XM=function(e){m(n,e);var t=y(n);function n(e){return T(this,n),t.call(this,e||{})}return E(n,[{key:"call",value:function(e,t){return Rf((function(){var t=F_(e);return $v(t,1)}))}}]),n}(VM);XM.className="GlobalMaxPooling1D",Tm(XM);var BM=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,DT(r.dataFormat),r.inputSpec=[new H_({ndim:4})],r}return E(n,[{key:"computeOutputShape",value:function(e){return"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}},{key:"call",value:function(e,t){throw new rT}},{key:"getConfig",value:function(){var e={dataFormat:this.dataFormat},t=N(v(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Q_),HM=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n,[{key:"call",value:function(e,t){var n=this;return Rf((function(){var t=F_(e);return"channelsLast"===n.dataFormat?Ug(t,[1,2]):Ug(t,[2,3])}))}}]),n}(BM);HM.className="GlobalAveragePooling2D",Tm(HM);var ZM=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n,[{key:"call",value:function(e,t){var n=this;return Rf((function(){var t=F_(e);return"channelsLast"===n.dataFormat?$v(t,[1,2]):$v(t,[2,3])}))}}]),n}(BM);ZM.className="GlobalMaxPooling2D",Tm(ZM);var KM=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this,e)).layer=e.layer,r}return E(n,[{key:"build",value:function(e){this.built=!0}},{key:"trainable",get:function(){return null!=this.layer&&this.layer.trainable},set:function(e){null!=this.layer&&(this.layer.trainable=e)}},{key:"trainableWeights",get:function(){return this.layer.trainableWeights}},{key:"nonTrainableWeights",get:function(){return this.layer.nonTrainableWeights}},{key:"updates",get:function(){return this.layer._updates}},{key:"losses",get:function(){return this.layer.losses}},{key:"getWeights",value:function(){return this.layer.getWeights()}},{key:"setWeights",value:function(e){this.layer.setWeights(e)}},{key:"getConfig",value:function(){var e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=N(v(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"setFastWeightInitDuringBuild",value:function(e){N(v(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=MI(t.layer,n);delete t.layer;var a={layer:r};return Object.assign(a,t),new e(a)}}]),n}(Q_),jM=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this,e)).supportsMasking=!0,r}return E(n,[{key:"build",value:function(e){if((e=G_(e)).length<3)throw new nT("TimeDistributed layer expects an input shape >= 3D, but received input shape ".concat(JSON.stringify(e)));this.inputSpec=[{shape:e}];var t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),N(v(n.prototype),"build",this).call(this,e)}},{key:"computeOutputShape",value:function(e){var t=[(e=G_(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),r=e[1];return[n[0],r].concat(n.slice(1))}},{key:"call",value:function(e,t){var n=this;return Rf((function(){return UC((function(e,r){return[F_(n.layer.call(e,t)),[]]}),e=F_(e),[],!1,null,null,!1,!0)[1]}))}}]),n}(KM);jM.className="TimeDistributed",Tm(jM);var YM=function(e){m(n,e);var t=y(n);function n(e){var r;T(this,n),r=t.call(this,e);var a=e.layer.getConfig(),i={};i.className=e.layer.getClassName(),i.config=a,r.forwardLayer=MI(i),a.goBackwards=!0!==a.goBackwards;var o={};if(o.className=e.layer.getClassName(),o.config=a,r.backwardLayer=MI(o),r.forwardLayer.name="forward_"+r.forwardLayer.name,r.backwardLayer.name="backward_"+r.backwardLayer.name,r.mergeMode=void 0===e.mergeMode?"concat":e.mergeMode,function(e){xT(AT,"BidirectionalMergeMode",e)}(r.mergeMode),e.weights)throw new rT("weights support is not implemented for Bidirectional layer yet.");return r._stateful=e.layer.stateful,r.returnSequences=e.layer.returnSequences,r.returnState=e.layer.returnState,r.supportsMasking=!0,r._trainable=!0,r.inputSpec=e.layer.inputSpec,r.numConstants=null,r}return E(n,[{key:"trainable",get:function(){return this._trainable},set:function(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}},{key:"getWeights",value:function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}},{key:"setWeights",value:function(e){var t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=this.forwardLayer.computeOutputShape(e);return Array.isArray(a)&&Array.isArray(a[0])||(a=[a]),this.returnState&&(r=a.slice(1)),t=a[0],"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):cT(n)}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=VC(e,r,a,this.numConstants);if(e=i.inputs,r=i.initialState,a=i.constants,Array.isArray(e)&&(r=e.slice(1),e=e[0]),(null==r||0===r.length)&&null==a)return N(v(n.prototype),"apply",this).call(this,e,t);var o=[],s=[];if(null!=r){var u=r.length;if(u%2>0)throw new nT("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=r,o.push.apply(o,b(r));var c=r.map((function(e){return new H_({shape:e.shape})}));this.forwardLayer.stateSpec=c.slice(0,u/2),this.backwardLayer.stateSpec=c.slice(u/2),s.push.apply(s,b(c))}if(null!=a)throw new rT("Support for constants in Bidirectional layers is not implemented yet.");for(var l=o[0]instanceof Z_,d=0,h=o;d<h.length;d++){if(h[d]instanceof Z_!==l)throw new nT("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}if(l){var p=[e].concat(o),f=this.inputSpec.concat(s),m=this.inputSpec;this.inputSpec=f;var g=N(v(n.prototype),"apply",this).call(this,p,t);return this.inputSpec=m,g}return N(v(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return Rf((function(){var r,a,i,o,s=t.initialState;if(null==s)r=n.forwardLayer.call(e,t),a=n.backwardLayer.call(e,t);else{var u=s.slice(0,s.length/2),c=s.slice(s.length/2);r=n.forwardLayer.call(e,Object.assign(t,{initialState:u})),a=n.backwardLayer.call(e,Object.assign(t,{initialState:c}))}return n.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(a.slice(1))),r=r[0],a=a[0]),n.returnSequences&&(a=Py(a,1)),"concat"===n.mergeMode?o=r_([r,a]):"sum"===n.mergeMode?o=Im(r,a):"ave"===n.mergeMode?o=Mm(.5,Im(r,a)):"mul"===n.mergeMode?o=Mm(r,a):null==n.mergeMode&&(o=[r,a]),n.returnState?null==n.mergeMode?o.concat(i):[o].concat(i):o}))}},{key:"resetStates",value:function(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}},{key:"build",value:function(e){var t=this;WT(this.forwardLayer.name,(function(){t.forwardLayer.build(e)})),WT(this.backwardLayer.name,(function(){t.backwardLayer.build(e)})),this.built=!0}},{key:"computeMask",value:function(e,t){var n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){var r=this.forwardLayer.states.map((function(e){return null}));return Array.isArray(n)?n.concat(r).concat(r):[n].concat(r).concat(r)}return n}},{key:"trainableWeights",get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}},{key:"nonTrainableWeights",get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}},{key:"setFastWeightInitDuringBuild",value:function(e){N(v(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e={mergeMode:this.mergeMode},t=N(v(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"fromConfig",value:function(e,t){var n=MI(t.layer);if(delete t.layer,null!=t.numConstants)throw new rT("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var r=t;return r.layer=n,new e(r)}}]),n}(KM);YM.className="Bidirectional",Tm(YM);var QM,JM,qM=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this,e)).scale=e.scale,e.offset?r.offset=e.offset:r.offset=0,r}return E(n,[{key:"getConfig",value:function(){var e={scale:this.scale,offset:this.offset},t=N(v(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"call",value:function(e,t){var n=this;return Rf((function(){return"float32"!==(e=F_(e)).dtype&&(e=qT(e,"float32")),Im(Mm(e,n.scale),n.offset)}))}}]),n}(Q_);function $M(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Set;if(null==e)return null;if("function"==typeof Blob&&e instanceof Blob)return e.slice();if(r.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);var a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse){if(iN(e)){var i=Array.isArray(e)?[]:{};for(var o in r.add(e),e){var s=$M(e[o],t,n,r);i[o]=s}return r.delete(e),e.__proto__&&(i.__proto__=e.__proto__),i}throw new Error("Can't recurse into non-iterable type: ".concat(e))}return n.set(e,a.value),a.value}function eN(e){return tN(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:nN)}function tN(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set,r=e[0];if(n.has(r))throw new Error("Circular references are not supported.");var a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse){if(iN(r)){var i=Array.isArray(r)?[]:{};n.add(r);var o=function(r){var a=tN(e.map((function(e){return e[r]})),t,n);i[r]=a};for(var s in r)o(s);return n.delete(r),i}throw new Error("Can't recurse into non-iterable type: ".concat(r))}return a.value}function nN(e){return null===e?null:iN(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}function rN(e,t){return aN.apply(this,arguments)}function aN(){return aN=S(w().mark((function e(t,n){var r,a,i,o,s,u;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:$M(t,n,r=new Map),a=0,i=Array.from(r.keys());case 3:if(!(a<i.length)){e.next=14;break}if(o=i[a],!Zs(s=r.get(o))){e.next=11;break}return e.next=9,s;case 9:u=e.sent,r.set(o,u);case 11:a++,e.next=3;break;case 14:return e.abrupt("return",$M(t,n,r));case 15:case"end":return e.stop()}}),e)}))),aN.apply(this,arguments)}function iN(e){var t=!1;Qs().get("IS_BROWSER")?t=e instanceof TextDecoder:t=e instanceof require("string_decoder").StringDecoder;return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"==typeof e&&!(e instanceof kh)&&!(e instanceof Promise)&&!t)}function oN(e){return function(e,t){return $M(e,t)}(e,sN)}function sN(e){return e instanceof kh?{value:e.clone(),recurse:!1}:iN(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}qM.className="Rescaling",Tm(qM),Qs().registerFlag("KEEP_INTERMEDIATE_TENSORS",(function(){return!1}),(function(e){e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"}(QM||(QM={})),function(e){!function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))}(JM||(JM={}));var uN=function(){function e(t){if(T(this,e),this.capacity=t,this.begin=0,this.end=0,null==t)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}return E(e,[{key:"wrap",value:function(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}},{key:"get",value:function(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}},{key:"set",value:function(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}},{key:"length",value:function(){var e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}},{key:"isFull",value:function(){return this.length()===this.capacity}},{key:"isEmpty",value:function(){return 0===this.length()}},{key:"push",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}},{key:"pushAll",value:function(e){var t,n=x(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.push(r)}}catch(a){n.e(a)}finally{n.f()}}},{key:"pop",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var e=this.get(this.end);return this.set(this.end,void 0),e}},{key:"unshift",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}},{key:"shift",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}},{key:"shuffleExcise",value:function(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}}]),e}(),cN=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.call(this,n.INITIAL_CAPACITY)}return E(n,[{key:"isFull",value:function(){return!1}},{key:"push",value:function(e){N(v(n.prototype),"isFull",this).call(this)&&this.expand(),N(v(n.prototype),"push",this).call(this,e)}},{key:"unshift",value:function(e){N(v(n.prototype),"isFull",this).call(this)&&this.expand(),N(v(n.prototype),"unshift",this).call(this,e)}},{key:"expand",value:function(){for(var e=2*this.capacity,t=new Array(e),n=this.length(),r=0;r<n;r++)t[r]=this.get(this.wrap(this.begin+r));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}]),n}(uN);function lN(e){return new vN(e)}function dN(e){return new gN(e)}function hN(e,t){return new CN(e,t)}function pN(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:fN.FAIL;return new MN(e,t)}cN.INITIAL_CAPACITY=32;var fN,mN=function(){function e(){T(this,e)}return E(e,[{key:"toArray",value:function(){var e=S(w().mark((function e(){var t,n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,this.next();case 3:n=e.sent;case 4:if(n.done){e.next=11;break}return t.push(n.value),e.next=8,this.next();case 8:n=e.sent;case 9:e.next=4;break;case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toArrayForTest",value:function(){var e=S(w().mark((function e(){var t,n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.prefetch(100),n=[],e.next=3,t.next();case 3:r=e.sent;case 4:if(r.done){e.next=11;break}return n.push(r.value),e.next=8,t.next();case 8:r=e.sent;case 9:e.next=4;break;case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resolveFully",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:t=e.sent;case 3:if(t.done){e.next=9;break}return e.next=6,this.next();case 6:t=e.sent;case 7:e.next=3;break;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resolveWhile",value:function(){var e=S(w().mark((function e(t){var n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:n=e.sent,r=t(n.value);case 4:if(n.done||!r){e.next=11;break}return e.next=7,this.next();case 7:n=e.sent,r=t(n.value);case 9:e.next=4;break;case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleErrors",value:function(e){return new TN(this,e)}},{key:"filter",value:function(e){return new kN(this,e)}},{key:"map",value:function(e){return new SN(this,e)}},{key:"mapAsync",value:function(e){return new _N(this,e)}},{key:"serialMapAsync",value:function(e){return new _N(this,e).serial()}},{key:"flatmap",value:function(e){return new EN(this,e)}},{key:"forEachAsync",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.map(t).resolveFully());case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"serialForEach",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.serialMapAsync(t).resolveWhile((function(e){return!0===e})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"rowMajorBatch",value:function(e){return new wN(this,e,!(arguments.length>1&&void 0!==arguments[1])||arguments[1])}},{key:"columnMajorBatch",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:nN;return this.rowMajorBatch(e,t).map((function(e){return eN(e,n)}))}},{key:"concatenate",value:function(e,t){return new CN(lN([this,e]),t)}},{key:"take",value:function(e){return e<0||null==e?this:new xN(this,e)}},{key:"skip",value:function(e){return e<0||null==e?this:new bN(this,e)}},{key:"prefetch",value:function(e){return new NN(this,e)}},{key:"shuffle",value:function(e,t){return new RN(this,e,t)}},{key:"serial",value:function(){return new yN(this)}}]),e}(),vN=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this)).items=e,r.trav=0,r}return E(n,[{key:"summary",value:function(){return"Array of ".concat(this.items.length," items")}},{key:"next",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.trav>=this.items.length)){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return t=this.items[this.trav],e.abrupt("return",(this.trav++,{value:oN(t),done:!1}));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(mN),gN=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this)).nextFn=e,r}return E(n,[{key:"summary",value:function(){return"Function call"}},{key:"next",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",this.nextFn());case 4:throw e.prev=4,e.t0=e.catch(0),e.t0.message="Error thrown while iterating through a dataset: ".concat(e.t0.message),e.t0;case 7:case"end":return e.stop()}}),e,this,[[0,4]])})));return function(){return e.apply(this,arguments)}}()}]),n}(mN),yN=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this)).upstream=e,r.lastRead=Promise.resolve({value:null,done:!1}),r}return E(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Serial")}},{key:"next",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.upstream.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(mN),bN=function(e){m(n,e);var t=y(n);function n(e,r){var a;return T(this,n),(a=t.call(this)).upstream=e,a.maxCount=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return E(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Skip")}},{key:"next",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.count++<this.maxCount)){e.next=9;break}return e.next=3,this.upstream.next();case 3:if(!(t=e.sent).done){e.next=6;break}return e.abrupt("return",t);case 6:Lf(t.value);case 7:e.next=0;break;case 9:return e.abrupt("return",this.upstream.next());case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(mN),xN=function(e){m(n,e);var t=y(n);function n(e,r){var a;return T(this,n),(a=t.call(this)).upstream=e,a.maxCount=r,a.count=0,a}return E(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Take")}},{key:"next",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(mN),wN=function(e){m(n,e);var t=y(n);function n(e,r){var a,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return T(this,n),(a=t.call(this)).upstream=e,a.batchSize=r,a.enableSmallLastBatch=i,a.lastRead=Promise.resolve({value:null,done:!1}),a}return E(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> RowMajorBatch")}},{key:"next",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=S(w().mark((function e(){var t,n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[];case 1:if(!(t.length<this.batchSize)){e.next=10;break}return e.next=4,this.upstream.next();case 4:if(!(n=e.sent).done){e.next=7;break}return e.abrupt("return",this.enableSmallLastBatch&&t.length>0?{value:t,done:!1}:{value:null,done:!0});case 7:t.push(n.value);case 8:e.next=1;break;case 10:return e.abrupt("return",{value:t,done:!1});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(mN),kN=function(e){m(n,e);var t=y(n);function n(e,r){var a;return T(this,n),(a=t.call(this)).upstream=e,a.predicate=r,a.lastRead=Promise.resolve({value:null,done:!1}),a}return E(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Filter")}},{key:"next",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done&&!this.predicate(t.value)){e.next=5;break}return e.abrupt("return",t);case 5:Lf(t.value);case 6:e.next=0;break;case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(mN),SN=function(e){m(n,e);var t=y(n);function n(e,r){var a;return T(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return E(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Map")}},{key:"next",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i,o,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:n=Oh(t.value),r=this.transform(t.value),a=Oh(r),i=x(n);try{for(i.s();!(o=i.n()).done;)Dh(s=o.value,a)||s.dispose()}catch(u){i.e(u)}finally{i.f()}return e.abrupt("return",{value:r,done:!1});case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(mN),TN=function(e){m(n,e);var t=y(n);function n(e,r){var a;return T(this,n),(a=t.call(this)).upstream=e,a.handler=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return E(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> handleErrors")}},{key:"next",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.upstream.next();case 3:return e.abrupt("return",e.sent);case 6:if(e.prev=6,e.t0=e.catch(0),this.handler(e.t0)){e.next=10;break}return e.abrupt("return",{value:null,done:!0});case 10:e.next=0;break;case 12:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}()}]),n}(mN),_N=function(e){m(n,e);var t=y(n);function n(e,r){var a;return T(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return E(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> AsyncMap")}},{key:"next",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i,o,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:return n=Oh(t.value),e.next=8,this.transform(t.value);case 8:r=e.sent,a=Oh(r),i=x(n);try{for(i.s();!(o=i.n()).done;)Dh(s=o.value,a)||s.dispose()}catch(u){i.e(u)}finally{i.f()}return e.abrupt("return",{value:r,done:!1});case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(mN),IN=function(e){m(n,e);var t=y(n);function n(){var e;return T(this,n),(e=t.call(this)).outputQueue=new cN,e.lastRead=Promise.resolve({value:null,done:!1}),e}return E(n,[{key:"next",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.outputQueue.length()){e.next=7;break}return e.next=3,this.pump();case 3:if(e.sent){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:e.next=0;break;case 7:return e.abrupt("return",{value:this.outputQueue.shift(),done:!1});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(mN),EN=function(e){m(n,e);var t=y(n);function n(e,r){var a;return T(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return E(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Flatmap")}},{key:"pump",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i,o,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",!1);case 5:n=Oh(t.value),r=this.transform(t.value),a=Oh(r),this.outputQueue.pushAll(r),i=x(n);try{for(i.s();!(o=i.n()).done;)Dh(s=o.value,a)||s.dispose()}catch(u){i.e(u)}finally{i.f()}return e.abrupt("return",!0);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(IN),CN=function(e){m(n,e);var t=y(n);function n(e,r){var a;return T(this,n),(a=t.call(this)).baseErrorHandler=r,a.lastRead=null,a.iterator=null,a.moreIterators=e,a}return E(n,[{key:"summary",value:function(){return"TODO: fill in upstream of chained summaries -> Chained"}},{key:"next",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.readFromChain(this.lastRead),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"readFromChain",value:function(){var e=S(w().mark((function e(t){var n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:if(null!=this.iterator){e.next=9;break}return e.next=5,this.moreIterators.next();case 5:if(!(n=e.sent).done){e.next=8;break}return e.abrupt("return",{value:null,done:!0});case 8:this.iterator=n.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler));case 9:return e.next=11,this.iterator.next();case 11:return r=e.sent,e.abrupt("return",r.done?(this.iterator=null,this.readFromChain(t)):r);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(mN);!function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"}(fN||(fN={}));var MN=function(e){m(n,e);var t=y(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:fN.FAIL;return T(this,n),(r=t.call(this)).iterators=e,r.mismatchMode=a,r.count=0,r.currentPromise=null,r}return E(n,[{key:"summary",value:function(){return"{TODO: fill in upstream of zip summaries} -> Zip"}},{key:"nextState",value:function(){var e=S(w().mark((function e(t){var n,r,a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(e){return e instanceof mN?{value:e.next().then((function(e){return n++,e.done&&r++,e.value})),recurse:!1}:{value:null,recurse:!0}},e.next=3,t;case 3:return n=0,r=0,e.next=6,rN(this.iterators,a);case 6:if(i=e.sent,n!==r){e.next=9;break}return e.abrupt("return",{value:null,done:!0});case 9:if(!(r>0)){e.next=15;break}e.t0=this.mismatchMode,e.next=e.t0===fN.FAIL?13:e.t0===fN.SHORTEST?14:(e.t0,fN.LONGEST,15);break;case 13:throw new Error("Zipped streams should have the same length. Mismatched at element ".concat(this.count,"."));case 14:return e.abrupt("return",{value:null,done:!0});case 15:return e.abrupt("return",(this.count++,{value:i,done:!1}));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"next",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.currentPromise=this.nextState(this.currentPromise),this.currentPromise));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(mN),NN=function(e){m(n,e);var t=y(n);function n(e,r){var a;return T(this,n),(a=t.call(this)).upstream=e,a.bufferSize=r,a.buffer=new uN(r),a}return E(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Prefetch")}},{key:"refill",value:function(){for(;!this.buffer.isFull();){var e=this.upstream.next();this.buffer.push(e)}}},{key:"next",value:function(){return this.refill(),this.buffer.shift()}}]),n}(mN),RN=function(e){m(n,e);var t=y(n);function n(e,r,a){var i;return T(this,n),(i=t.call(this,e,r)).upstream=e,i.windowSize=r,i.upstreamExhausted=!1,i.random=Ty.alea(a||ah().toString()),i.lastRead=Promise.resolve({value:null,done:!1}),i}return E(n,[{key:"next",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"randomInt",value:function(e){return Math.floor(this.random()*e)}},{key:"chooseIndex",value:function(){return this.randomInt(this.buffer.length())}},{key:"serialNext",value:function(){var e=S(w().mark((function e(){var t,n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.upstreamExhausted||this.refill();case 1:if(this.buffer.isEmpty()){e.next=13;break}return t=this.chooseIndex(),e.next=5,this.buffer.shuffleExcise(t);case 5:if(!(n=e.sent).done){e.next=10;break}this.upstreamExhausted=!0,e.next=11;break;case 10:return e.abrupt("return",(this.refill(),n));case 11:e.next=1;break;case 13:return e.abrupt("return",{value:null,done:!0});case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(NN),LN=function(){function e(){T(this,e),this.size=null}return E(e,[{key:"batch",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this;return ls(e>0,(function(){return"batchSize needs to be positive, but it is\n      ".concat(e)})),t=this.size===1/0||null==this.size?this.size:n?Math.ceil(this.size/e):Math.floor(this.size/e),AN(S(w().mark((function t(){return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.iterator();case 2:return t.abrupt("return",t.sent.columnMajorBatch(e,n,PN));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"concatenate",value:function(e){var t,n=this;return t=this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null,AN(S(w().mark((function t(){return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.t0=t.sent,t.next=5,e.iterator();case 5:return t.t1=t.sent,t.abrupt("return",t.t0.concatenate.call(t.t0,t.t1));case 7:case"end":return t.stop()}}),t)}))),t)}},{key:"filter",value:function(e){var t,n=this;return t=this.size===1/0?1/0:null,AN(S(w().mark((function t(){return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.filter((function(t){return Rf((function(){return e(t)}))})));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"forEachAsync",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.iterator();case 2:return e.abrupt("return",e.sent.forEachAsync(t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"map",value:function(e){var t=this;return AN(S(w().mark((function n(){return w().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.map((function(t){return Rf((function(){return e(t)}))})));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"mapAsync",value:function(e){var t=this;return AN(S(w().mark((function n(){return w().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.mapAsync(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"prefetch",value:function(e){if(null==e)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var t=this;return AN(S(w().mark((function n(){return w().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.prefetch(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"repeat",value:function(e){var t,n=this;return t=null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null,AN(S(w().mark((function t(){var r;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=dN(S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.iterator();case 2:return e.t0=e.sent,e.t1=!1,e.abrupt("return",{value:e.t0,done:e.t1});case 5:case"end":return e.stop()}}),e)})))),t.abrupt("return",hN(r.take(e)));case 2:case"end":return t.stop()}}),t)}))),t)}},{key:"skip",value:function(e){var t,n=this;return t=null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null,AN(S(w().mark((function t(){return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.skip(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"shuffle",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null==e||e<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting bufferSize to the dataset size (".concat(this.size," elements)"));var r=this,a=Ty.alea(t||ah().toString());return AN(S(w().mark((function t(){var i;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=a.int32(),n&&(i+=a.int32()),t.next=4,r.iterator();case 4:return t.abrupt("return",t.sent.shuffle(e,i.toString()));case 5:case"end":return t.stop()}}),t)}))),this.size)}},{key:"take",value:function(e){var t,n=this;return t=null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null,AN(S(w().mark((function t(){return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.take(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"toArray",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArray());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toArrayForTest",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArrayForTest());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function AN(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new(function(n){m(a,n);var r=y(a);function a(){var e;return T(this,a),(e=r.apply(this,arguments)).size=t,e}return E(a,[{key:"iterator",value:function(){var t=S(w().mark((function t(){return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e());case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}]),a}(LN))}function PN(e){return null===e?null:function(e){return null==e||function(e){return null===e||"object"!=typeof e&&"function"!=typeof e}(e)||Array.isArray(e)||"object"==typeof e&&e instanceof kh||Cs(e)}(e[0])?{value:DN(e),recurse:!1}:{value:null,recurse:!0}}function DN(e){if(0===e.length)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof kh?eb(e):ip(e)}function ON(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&ls("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors in the CPU backend.")}))}))}LN.MAX_BUFFER_SIZE=1e4;var zN=hb,FN=function(e){m(n,e);var t=y(n);function n(){var e;return T(this,n),(e=t.call(this)).blockSize=48,e.firstUse=!0,e.data=new ns(h(e),Mf()),e}return E(n,[{key:"nextDataId",value:function(){return n.nextDataId++}},{key:"write",value:function(e,t,n){this.firstUse&&(this.firstUse=!1,Qs().get("IS_NODE")&&cd("\n============================\nHi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. \n============================"));var r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&Rs(n[0])){var a=n.map((function(e){return oh(e)}));r=this.write(a,e,t)}else r=this.write(n,e,t);return{dataId:r,shape:e,dtype:t}}},{key:"refCount",value:function(e){return this.data.has(e)?this.data.get(e).refCount:0}},{key:"incRef",value:function(e){this.data.get(e).refCount++}},{key:"decRef",value:function(e){this.data.has(e)&&this.data.get(e).refCount--}},{key:"move",value:function(e,t,n,r,a){this.data.set(e,{values:t,dtype:r,refCount:a})}},{key:"numDataIds",value:function(){return this.data.numDataIds()}},{key:"read",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readSync(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readSync",value:function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensorInfos;return"complex64"===n?dw(this.readSync(r.real.dataId),this.readSync(r.imag.dataId)):this.data.get(e).values}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId);if("string"===e.dtype)try{var n=t.map((function(e){return sh(e)}));return df(e.shape,e.dtype,n)}catch(r){throw new Error("Failed to decode encoded string bytes into utf-8")}return df(e.shape,e.dtype,t)}},{key:"makeOutput",value:function(e,t,n){return Mf().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,e),this)}},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;var n=this.data.get(e).complexTensorInfos;null!=n&&(this.disposeData(n.real.dataId,!0),this.disposeData(n.imag.dataId,!0)),this.data.delete(e)}return!0}},{key:"disposeIntermediateTensorInfo",value:function(e){this.disposeData(e.dataId)}},{key:"time",value:function(){var e=S(w().mark((function e(t){var n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=ah(),e.abrupt("return",(t(),{kernelMs:ah()-n}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"memory",value:function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}},{key:"where",value:function(e){ON([e],"where");var t=this.readSync(e.dataId);return zN(e.shape,t)}},{key:"dispose",value:function(){}},{key:"floatPrecision",value:function(){return 32}},{key:"epsilon",value:function(){return N(v(n.prototype),"epsilon",this).call(this)}}]),n}(rs);FN.nextDataId=0;var GN={kernelName:tu,backendName:"cpu",kernelFunc:function(e){var t=e.inputs.x,n=e.backend;ON(t,"abs");var r=new Float32Array(fs(t.shape));return r=function(e){for(var t=new Float32Array(e.length),n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}(n.data.get(t.dataId).values),n.makeOutput(r,t.shape,t.dtype)}};function WN(e){return function(t,n,r,a,i){var o=Uf(t,n),s=o.length,u=zs(o),c=Ss(i,fs(o)),l=t.length,d=n.length,h=zs(t),p=zs(n),f=Wf(t,o),m=Wf(n,o);if(f.length+m.length===0)for(var v=0;v<c.length;++v)c[v]=e(r[v%r.length],a[v%a.length]);else for(var g=function(){var t=Hs(y,s,u),n=t.slice(-l);f.forEach((function(e){return n[e]=0}));var i=Bs(n,l,h),o=t.slice(-d);m.forEach((function(e){return o[e]=0}));var v=Bs(o,d,p);c[y]=e(r[i],a[v])},y=0;y<c.length;++y)g();return[c,o]}}function VN(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=n.makeTensorInfo(r.shape,"complex64");return n.data.get(s.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",i),imag:n.makeTensorInfo(a.shape,"float32",o)},s}var UN={kernelName:Eu,backendName:"cpu",kernelFunc:VN};function XN(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"float32";if("complex64"===n)return VN({inputs:{real:XN(e,t,"float32"),imag:XN(e,t,"float32")},backend:e});var r=Vs(fs(t),n);return e.makeTensorInfo(t,n,r)}function BN(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var HN={kernelName:mc,backendName:"cpu",kernelFunc:BN};function ZN(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.real,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var KN={kernelName:ul,backendName:"cpu",kernelFunc:ZN};function jN(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.dtype;if("complex64"===o){if("complex64"===a.dtype)return BN({inputs:{x:a},backend:n});var s=XN(n,a.shape,a.dtype),u=jN({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),c=VN({inputs:{real:u,imag:s},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(u),c}if("complex64"===a.dtype){var l=ZN({inputs:{input:a},backend:n}),d=jN({inputs:{x:l},backend:n,attrs:{dtype:o}});return n.disposeIntermediateTensorInfo(l),d}if(!Es(a.dtype,o)){var h=BN({inputs:{x:a},backend:n});return{dataId:h.dataId,shape:h.shape,dtype:o}}var p=function(e,t,n,r){if("int32"===r)return[t,"int32",Int32Array.from(e)];if("bool"===r){var a=rh([0],n),o=i(WN((function(e,t){return e!==t?1:0}))(t,[],e,a,"bool"),2),s=o[0];return[o[1],"bool",s]}throw new Error("Error in Cast: failed to cast ".concat(n," to ").concat(r))}(n.data.get(a.dataId).values,a.shape,a.dtype,o),f=i(p,3),m=f[0],v=f[1],g=f[2];return n.makeTensorInfo(m,v,g)}var YN={kernelName:Tu,backendName:"cpu",kernelFunc:jN};function QN(e,t,n,r){return null==n?function(n){var a=n.inputs,o=n.backend,s=a.a,u=a.b,c=o;ON([s,u],e);var l=c.data.get(s.dataId).values,d=c.data.get(u.dataId).values,h="string"===s.dtype?Zw(l):l,p="string"===s.dtype?Zw(d):d,f=r||s.dtype,m=i(t(s.shape,u.shape,h,p,f),2),v=m[0],g=m[1];return c.makeTensorInfo(g,f,v)}:function(e){var a=e.inputs,o=e.backend,s=a.a,u=a.b,c=o;if("complex64"===s.dtype||"complex64"===u.dtype){var l=jN({inputs:{x:s},backend:c,attrs:{dtype:"complex64"}}),d=c.data.get(l.dataId),h=d.complexTensorInfos.real,p=d.complexTensorInfos.imag,f=c.data.get(h.dataId).values,m=c.data.get(p.dataId).values,v=jN({inputs:{x:u},backend:c,attrs:{dtype:"complex64"}}),g=c.data.get(v.dataId),y=g.complexTensorInfos.real,b=g.complexTensorInfos.imag,x=c.data.get(y.dataId).values,w=c.data.get(b.dataId).values,k=i(n(s.shape,u.shape,f,m,x,w),3),S=k[0],T=k[1],_=k[2],I=c.makeTensorInfo(_,"float32",S),E=c.makeTensorInfo(_,"float32",T),C=VN({inputs:{real:I,imag:E},backend:c});return c.disposeIntermediateTensorInfo(l),c.disposeIntermediateTensorInfo(v),c.disposeIntermediateTensorInfo(I),c.disposeIntermediateTensorInfo(E),C}var M=c.data.get(s.dataId).values,N=c.data.get(u.dataId).values,R=r||s.dtype,L=i(t(s.shape,u.shape,M,N,R),2),A=L[0],P=L[1];return c.makeTensorInfo(P,R,A)}}function JN(e){return function(t,n,r,a,i,o){var s=Uf(t,n),u=fs(s),c=s.length,l=zs(s),d=Ss("float32",u),h=Ss("float32",u),p=Wf(t,s),f=Wf(n,s),m=dw(r,a),v=dw(i,o),g=t.length,y=zs(t),b=n.length,x=zs(n);if(p.length+f.length===0)for(var w=0;w<d.length;w++){var k=w%m.length,S=w%v.length,T=e(m[2*k],m[2*k+1],v[2*S],v[2*S+1]);d[w]=T.real,h[w]=T.imag}else for(var _=function(){var t=Hs(I,c,l),n=t.slice(-g);p.forEach((function(e){return n[e]=0}));var r=Bs(n,g,y),a=t.slice(-b);f.forEach((function(e){return a[e]=0}));var i=Bs(a,b,x),o=e(m[2*r],m[2*r+1],v[2*i],v[2*i+1]);d[I]=o.real,h[I]=o.imag},I=0;I<d.length;I++)_();return[d,h,s]}}var qN=WN((function(e,t){return e+t})),$N=JN((function(e,t,n,r){return{real:e+n,imag:t+r}})),eR=QN(au,qN,$N),tR={kernelName:au,backendName:"cpu",kernelFunc:eR};function nR(e,t,n,r,a){for(var i=fs(r),o=Vs(a,n),s=0;s<e.length;s++){var u=e[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(o[u]+=i>0?t[s]:1)}return o}function rR(e){return function(t,n,r){for(var a=Ss(n,t.length),i=0;i<t.length;++i)a[i]=e(t[i],r);return a}}function aR(e,t,n){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;if(ON(s,e),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");for(var u=o,c=u.data.get(s.dataId).values,l=fs(s.shape),d=n||s.dtype,h=Ts(d,l),p=0;p<l;++p)h[p]=t(c[p],i);return u.makeTensorInfo(s.shape,d,h)}}function iR(e,t,n){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;if(ON(s,e),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");var u=o,c=u.data.get(s.dataId).values,l=n||s.dtype,d=t(c,l,i);return u.makeTensorInfo(s.shape,l,d)}}var oR=rR((function(e){return Math.ceil(e)})),sR=iR(_u,oR),uR={kernelName:_u,backendName:"cpu",kernelFunc:sR};var cR=WN((function(e,t){return e===t?1:0})),lR=QN(tc,cR,null,"bool"),dR={kernelName:tc,backendName:"cpu",kernelFunc:lR},hR=rR((function(e){return Math.exp(e)})),pR=iR(nc,hR,"float32"),fR={kernelName:nc,backendName:"cpu",kernelFunc:pR},mR=rR((function(e){return Math.expm1(e)})),vR=iR(ac,mR),gR={kernelName:ac,backendName:"cpu",kernelFunc:vR},yR=rR((function(e){return Math.floor(e)})),bR=iR(uc,yR),xR={kernelName:uc,backendName:"cpu",kernelFunc:bR};var wR=WN((function(e,t){return e>t?1:0})),kR=QN(pc,wR,null,"bool"),SR={kernelName:pc,backendName:"cpu",kernelFunc:kR},TR=WN((function(e,t){return e>=t?1:0})),_R=QN(fc,TR,null,"bool"),IR={kernelName:fc,backendName:"cpu",kernelFunc:_R},ER=WN((function(e,t){return e<t?1:0})),CR=QN(kc,ER,null,"bool"),MR={kernelName:kc,backendName:"cpu",kernelFunc:CR},NR=WN((function(e,t){return e<=t?1:0})),RR=QN(Sc,NR,null,"bool"),LR={kernelName:Sc,backendName:"cpu",kernelFunc:RR};var AR=rR((function(e){return Math.log(e)})),PR=iR(_c,AR),DR={kernelName:_c,backendName:"cpu",kernelFunc:PR};var OR=WN((function(e,t){return Math.max(e,t)})),zR=QN(Pc,OR),FR={kernelName:Pc,backendName:"cpu",kernelFunc:zR},GR=WN((function(e,t){return Math.min(e,t)})),WR=QN(Uc,GR),VR={kernelName:Uc,backendName:"cpu",kernelFunc:WR},UR=WN((function(e,t){return e*t})),XR=JN((function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})),BR=QN(Zc,UR,XR),HR={kernelName:Zc,backendName:"cpu",kernelFunc:BR};var ZR={kernelName:Kc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x;ON(r,"neg");var a=function(e,t,n){var r=nh(-1,n);return UR([],t,r,e,n)}(n.data.get(r.dataId).values,r.shape,r.dtype),o=i(a,2),s=o[0],u=o[1];return n.makeTensorInfo(u,r.dtype,s)}},KR=WN((function(e,t){return e!==t?1:0})),jR=QN(jc,KR,null,"bool"),YR={kernelName:jc,backendName:"cpu",kernelFunc:jR};function QR(e,t,n,r,a){for(var i=t.length,o=fs(t),s=zs(t),u=zs(a),c=Ss(n,fs(a)),l=0;l<o;++l){for(var d=Hs(l,i,s),h=new Array(d.length),p=0;p<h.length;p++)h[p]=d[r[p]];c[Bs(h,i,u)]=e[l]}return c}function JR(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.perm;ON(a,"transpose");for(var o=a.shape.length,s=new Array(o),u=0;u<s.length;u++)s[u]=a.shape[i[u]];var c=QR(r.data.get(a.dataId).values,a.shape,a.dtype,i,s);return{dataId:r.write(c,s,a.dtype),shape:s,dtype:a.dtype}}var qR={kernelName:ql,backendName:"cpu",kernelFunc:JR};var $R={kernelName:al,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.keepDims;ON(a,"prod");var u=a.shape.length,c=ws(o,a.shape),l=Qv(c,u),d=c,h=a,p=[];null!=l&&(h=JR({inputs:{x:a},backend:n,attrs:{perm:l}}),p.push(h),d=qv(d.length,u));var f=n.data.get(h.dataId).values,m=function(e,t,n,r){for(var a=i(Kv(e,r),2),o=a[0],s=a[1],u=Rh(t,"int32"),c=Vs(fs(o),u),l=fs(s),d=0;d<c.length;++d){for(var h=d*l,p=1,f=0;f<l;++f)p*=n[h+f];c[d]=p}return{outVals:c,outShape:o,outDtype:u}}(h.shape,h.dtype,f,d),v=m.outVals,g=m.outShape,y=m.outDtype,b=g;return s&&(b=jv(g,c)),p.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(b,y,v)}};function eL(e,t,n,r){var a=[],i=0,o=t.length-1+n.length,s=new Array(o).fill(null).map((function(){return[0]}));!function(e,t){for(var n=0;n<e.length;++n){var r=e[n],a=n===e.length-1?t:e[n+1].length;if(0===r.length)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>a)throw new Error("Ragged splits must not point past values");for(var i=1;i<r.length;++i)if(r[i-1]>r[i])throw new Error("Ragged splits must be sorted in ascending order")}}(n,r);for(var u=1,c=0;c<t.length-1;++c){u*=t[c];for(var l=t[c+1],d=1;d<u+1;++d)s[c].push(d*l)}for(var h=0;h<e.length;++h){for(var p=e[h],f=e[h]+1,m=0;m<n.length;++m){var v=n[m],g=m+t.length-1;if(g>=0)for(var y=s[g],b=y[y.length-1]-v[p],x=p;x<f;++x)s[g].push(v[x+1]+b);p=v[p],f=v[f]}f!==p&&(a.push([p,f]),i+=f-p)}return{outSplits:s,valueSlices:a,numValues:i}}function tL(e,t){for(var n=e.slice(0,t);n.length<t;)n.push(1);for(var r=t;r<e.length;r++)n[t-1]*=e[r];return n}function nL(e,t,n,r,a){var i=t.slice();i[0]=a;var o=Ts(n,fs(i)),s=e.length;return function(e,t,n,r,a,i){var o,s=tL(t,2)[1],u=tL(i,2)[1],c=0,l=x(n);try{for(l.s();!(o=l.n()).done;)for(var d=o.value,h=d[0];h<d[1];++h){for(var p=0;p<r;++p)a[c*u+p]=e[h*s+p];++c}}catch(f){l.e(f)}finally{l.f()}}(e,t,r,0===s?0:s/t[0],o,i),[o,i]}function rL(e,t,n,r,a,i,o,s){if(0===e.length)throw new Error("paramsNestedSplits must be non empty");if(0===t[0].length)throw new Error("Split tensors must not be scalars");if(function(e,t,n){e.forEach((function(e,r){if(e<0||e>=n){var a=Hs(r,t.length,zs(t)).join(",");throw new Error("indices[".concat(a,"] = ").concat(e," is not in [0, ").concat(n,")"))}}))}(i,o,t[0][0]-1),0===r.length)throw new Error("params.rank must be nonzero");var u=eL(i,o,e,r[0]),c=u.outSplits,l=u.valueSlices,d=u.numValues,h=function(e){for(var t=[],n=function(){var n=Ts("int32",e[r].length);t.push(n),e[r].forEach((function(e,t){return n[t]=e}))},r=0;r<e.length;++r)n();return t}(c),p=nL(n,r,a,l,d);return[h,p[0],p[1]]}var aL=Fx,iL=function(){function e(t,n,r,a,i,o,s,u,c,l){T(this,e),this.shape=t,this.shapeShape=n,this.values=r,this.valuesShape=a,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=Zx(l),this.raggedRank=Kx(this.rowPartitionTypes)}return E(e,[{key:"getRowPartitionTypeByDimension",value:function(e){return this.rowPartitionTypes[0]===aL.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}},{key:"getRowPartitionTensor",value:function(e){return this.rowPartitionTypes[0]===aL.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}},{key:"getMaxWidth",value:function(t){var n=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case aL.VALUE_ROWIDS:return e.getMaxWidthValueRowID(n);case aL.ROW_SPLITS:return e.getMaxWidthRowSplit(n);default:throw new Error("Cannot handle partition type ".concat(aL[this.getRowPartitionTypeByDimension(t-1)]))}}},{key:"tensorShapeFromTensor",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(0===t.length){if(-1===e[0])return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return sL(e,n)}},{key:"calculateOutputSize",value:function(e){var t=this.valuesShape;jx(this.defaultValueShape,t);var n=this.tensorShapeFromTensor(this.shape,this.shapeShape),r=Hx(this.raggedRank,n,t);r[0]<0&&(r[0]=e);for(var a=1;a<=this.raggedRank;++a)r[a]<0&&(r[a]=this.getMaxWidth(a));return r}},{key:"calculateFirstParentOutputIndex",value:function(e,t,n){for(var r=Math.min(e,n),a=[],i=0,o=0;o<r;++o,i+=t)a.push(i);for(var s=r;s<e;++s)a.push(-1);return ls(a.length===e,(function(){return"Final length of result must be equal to firstDimension."})),a}},{key:"calculateOutputIndexRowSplit",value:function(e,t,n,r){for(var a=e.length,i=[],o=0;o<a-1;++o){var s=e[o+1]-e[o],u=Math.min(r,s),c=t[o];-1===c&&(u=0);for(var l=0;l<u;++l)i.push(c),c+=n;for(var d=0;d<s-u;++d)i.push(-1)}if(a>0&&i.length!==e[a-1])throw new Error("Invalid row split size.");return i}},{key:"calculateOutputIndexValueRowID",value:function(e,t,n,r){var a=e.length,i=[];if(0===a)return[];var o=0,s=e[0];if(s>=t.length)throw new Error("Got currentValueRowId=".concat(s,", which is not less than ").concat(t.length));var u=t[s];i.push(u);for(var c=1;c<a;++c){var l=e[c];if(l===s)u>=0&&(++o<r?u+=n:u=-1);else{if(o=0,s=l,l>=t.length)throw new Error("Got nextValueRowId=".concat(l," which is not less than ").concat(t.length));u=t[l]}i.push(u)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}},{key:"calculateOutputIndex",value:function(e,t,n,r){var a=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case aL.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(a,t,n,r);case aL.ROW_SPLITS:if(a.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(a.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(a,t,n,r);default:throw new Error("Unsupported partition type: ".concat(aL[i]))}}},{key:"getFirstDimensionSize",value:function(){var e=this.rowPartitionValues[0];if(0===this.rowPartitionTypes.length)throw new Error("No row_partition_types given.");var t=this.rowPartitionTypes[0];switch(t){case aL.FIRST_DIM_SIZE:return e[0];case aL.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case aL.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(aL[t]))}}},{key:"compute",value:function(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var e=this.getFirstDimensionSize(),t=this.calculateOutputSize(e),n=new Array(this.raggedRank+1);n[n.length-1]=1;for(var r=n.length-2;r>=0;--r)n[r]=n[r+1]*t[r+1];var a=sL(t,!1),i=Ts(this.valuesDType,fs(a));if(n[0]*t[0]>0){for(var o=this.calculateFirstParentOutputIndex(e,n[0],t[0]),s=1;s<=this.raggedRank;++s)o=this.calculateOutputIndex(s-1,o,n[s],t[s]);this.setOutput(this.raggedRank,o,i,a)}return[a,i]}},{key:"setOutput",value:function(e,t,n,r){if(0!==n.length){var a=this.values,i=n,o=r.slice(),s=fs(o=o.slice(e+1)),u=t.length,c=this.defaultValue;if(c.length!==s&&1!==c.length){var l=this.defaultValueShape;Rf((function(){var e=nv(c,l);c=vv(e,o).dataSync()}))}for(var d=0,h=0,p=0,f=0;f<=u;++f){var m=f<u?t[f]:-1;if(m!==p){if(h<p){var v=a.subarray(d*s);oL(i.subarray(h*s),v,(p-h)*s)}if(f>=u){var g=n.length;m=Math.floor(g/s)}if(m>p)if(1===this.defaultValue.length)i.subarray(p*s,m*s).fill(this.defaultValue[0]),p=m;else for(;m>p;){oL(i.slice(p*s),c,s),++p}m<0?(d=f+1,h=p):(d=f,p=(h=p)+1)}else++p}}}}],[{key:"getMaxWidthRowSplit",value:function(e){var t=e.length;if(0===t||1===t)return 0;for(var n=0,r=0;r<t-1;++r){var a=e[r+1]-e[r];a>n&&(n=a)}return n}},{key:"getMaxWidthValueRowID",value:function(e){var t=e.length;if(0===t)return 0;for(var n=0,r=e[0],a=0,i=1;i<t;++i){var o=e[i];o!==r&&(r=o,a=Math.max(i-n,a),n=i)}return Math.max(t-n,a)}}]),e}();function oL(e,t,n){for(var r=0;r<n;r++)e[r]=t[r]}function sL(e,t){var n,r=[],a=x(e);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i<0){if(!t)throw new Error("Dimension ".concat(i," must be >= 0"));if(i<-1)throw new Error("Dimension ".concat(i," must be >= -1"));i=-1}r.push(i)}}catch(o){a.e(o)}finally{a.f()}return r}var uL=rR((function(e){return 1/Math.sqrt(e)})),cL=iR(bl,uL),lL={kernelName:bl,backendName:"cpu",kernelFunc:cL};function dL(e,t,n,r,a,i,o,s,u,c){var l=[r/a,a],d=e.values,h=t.values;if(0===r)return df(n,t.dtype);var p=df(l,t.dtype);"string"==typeof u||"number"==typeof u?p.values.fill(u):"boolean"==typeof u&&p.values.fill(+u);for(var f=0;f<i;f++){for(var m=[],v=0,g=0;g<o;g++){var y=d[f*o+g];m.push(y),v+=y*s[g]}if(v<0||v>=r/a)throw new Error("Invalid indices: ".concat(m," does not index into ").concat(n));for(var b=0;b<a;b++)c?p.values[v*a+b]+=h[f*a+b]:p.values[v*a+b]=0===t.rank?h[0]:h[f*a+b]}return p}var hL=aR(Cl,(function(e){return 1/(1+Math.exp(-e))})),pL={kernelName:Cl,backendName:"cpu",kernelFunc:hL};function fL(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.begin,s=r.size;ON(a,"slice");var u=i(ym(a,o,s),2),c=u[0],l=u[1];om(a,c,l);var d=function(e,t,n,r,a){var i=vm(r,t,n),o=fs(n),s=zs(r);if(i){var u=gm(t,s);return"string"===a?e.slice(u,u+o):e.subarray(u,u+o)}for(var c=df(r,a,"string"===a?Zw(e):e),l=df(n,a),d=0;d<l.size;++d){var h=l.indexToLoc(d),p=h.map((function(e,n){return e+t[n]}));l.set.apply(l,[c.get.apply(c,b(p))].concat(b(h)))}return"string"===a?Kw(l.values):l.values}(n.data.get(a.dataId).values,c,l,a.shape,a.dtype);return n.makeTensorInfo(l,a.dtype,d)}var mL={kernelName:Tl,backendName:"cpu",kernelFunc:fL};function vL(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=r.length,u=[t[0],e.length/t[0]],c=u[1],l=s>0?a[s-1]+1:0;if(l<0)throw new Error("segment ids must be >= 0");var d=t.slice();d[0]=l;var h=d.reduce((function(e,t){return e*t}),1),p=Ts(n,h);if(0===s)return l>0&&p.fill(o),[p,d];if(l<=0)throw new Error("segment ids must be >= 0");for(var f=0,m=1,v=0,g=a[f];;){var y=0;if(m<s){if(g===(y=a[m])){++m;continue}if(g>=y)throw new Error("segment ids are not increasing")}if(g<0||g>=l)throw new Error(Ww(g,l));g>v&&p.fill(o,v*c,g*c);for(var b=f;b<m;++b){var x=r[b];if(x<0||x>=u[0])throw new Error(Vw(b,r[b],u[0]));for(var w=0;w<c;w++)p[g*c+w]+=e[x*c+w]}if(i)for(var k=0;k<c;k++)p[g*c+k]/=m-f;if(f=m,v=g+1,g=y,++m>s)break}return v<l&&p.fill(o,v*c,l*c),[p,d]}var gL=aR(Nl,(function(e){return Math.sqrt(e)})),yL={kernelName:Nl,backendName:"cpu",kernelFunc:gL},bL=WN((function(e,t){var n=e-t;return n*n})),xL=QN(Wl,bL),wL={kernelName:Wl,backendName:"cpu",kernelFunc:xL};var kL=function(){function e(t,n,r,a,i,o){T(this,e),this.separator=oh(t),this.nGramWidths=n,this.leftPad=oh(r),this.rightPad=oh(a),this.padWidth=i,this.preserveShort=o}return E(e,[{key:"getPadWidth",value:function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}},{key:"getNumNGrams",value:function(e,t){var n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}},{key:"createNGrams",value:function(e,t,n,r,a,i){for(var o=this,s=function(){var s=o.getPadWidth(i),c=Math.max(0,s-u),l=Math.max(0,s-(a-(u+1))),d=i-(c+l),h=t+(c>0?0:u-s),p=0;p+=c*o.leftPad.length;for(var f=0;f<d;++f)p+=e[h+f].length;p+=l*o.rightPad.length,p+=(c+l+d-1)*o.separator.length,n[r+u]=new Uint8Array(p);for(var m=n[r+u],v=0,g=function(e){return e.forEach((function(e){return m[v++]=e}))},y=0;y<c;++y)g(o.leftPad),g(o.separator);for(var b=0;b<d-1;++b)g(e[h+b]),g(o.separator);if(d>0){g(e[h+d-1]);for(var x=0;x<l;++x)g(o.separator),g(o.rightPad)}else{for(var w=0;w<l-1;++w)g(o.rightPad),g(o.separator);g(o.rightPad)}},u=0;u<a;++u)s()}},{key:"compute",value:function(e,t){var n=this,r=e.length,a=t.length;if(a>0){var i=t[0];if(0!==i)throw new Error("First split value must be 0, got ".concat(i));for(var o=1;o<a;++o){var s=t[o]>=i;if(!(s=s&&t[o]<=r))throw new Error("Invalid split value ".concat(t[o],", must be in [").concat(i,", ").concat(r,"]"));i=t[o]}if(i!==r)throw new Error("Last split value must be data size. Expected ".concat(r,", got ").concat(i))}var u=a-1,c=Ts("int32",a);if(0===r||0===a){for(var l=new Array(r),d=0;d<=u;++d)c[d]=0;return[l,c]}c[0]=0;for(var h=function(){var e=t[p]-t[p-1],r=0;n.nGramWidths.forEach((function(t){r+=n.getNumNGrams(e,t)})),n.preserveShort&&e>0&&0===r&&(r=1),c[p]=c[p-1]+r},p=1;p<=u;++p)h();for(var f=new Array(c[u]),m=function(r){var a=t[r],i=c[r];if(n.nGramWidths.forEach((function(o){var s=t[r+1]-t[r],u=n.getNumNGrams(s,o);n.createNGrams(e,a,f,i,u,o),i+=u})),n.preserveShort&&i===c[r]){var o=t[r+1]-t[r];if(0===o)return"continue";var s=o+2*n.padWidth;n.createNGrams(e,a,f,i,1,s)}},v=0;v<u;++v)m(v);return[f,c]}}]),e}();function SL(e,t,n,r){if(e.length)if(0!==t.length)if(1!==t.length){for(var a=0,i=0;i<e.length+1;i++)if(i===e.length||-1!==t.indexOf(e[i])){var o=e.subarray(a,i);(!n||0!==o.length)&&r.push(o),a=i+1}}else{for(var s=t[0],u=e.indexOf(s);-1!==u;){var c=e.subarray(0,u);(!n||0!==c.length)&&r.push(c),u=(e=e.subarray(u+1)).indexOf(s)}(!n||0!==e.length)&&r.push(e)}else for(var l=0;l<e.length;++l)r.push(e.subarray(l,l+1))}var TL=WN((function(e,t){return e-t})),_L=JN((function(e,t,n,r){return{real:e-n,imag:t-r}})),IL=QN(Zl,TL,_L),EL={kernelName:Zl,backendName:"cpu",kernelFunc:IL};var CL=function(e,t){var n=t.value-e.value;return 0===n?e.index-t.index:n};function ML(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length-1;r>n;){if(r-n>600){var a=r-n+1,i=t-n+1,o=Math.log(a),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2);ML(e,t,Math.max(n,Math.floor(t-i*s/a+u)),Math.min(r,Math.floor(t+(a-i)*s/a+u)))}var c=e[t],l=n,d=r;for(us(e,n,t),CL(e[r],c)>0&&us(e,n,r);l<d;){for(us(e,l,d),l++,d--;CL(e[l],c)<0;)l+=1;for(;CL(e[d],c)>0;)d-=1}0===CL(e[n],c)?us(e,n,d):us(e,d+=1,r),d<=t&&(n=d+1),t<=d&&(r=d-1)}}function NL(e,t,n,r,a){for(var i=t[t.length-1],o=e.length/i,s=i,u=Ss(n,o*r),c=Ss("int32",o*r),l=function(){var t=d*s,n=e.subarray(t,t+s),i=new Array(n.length);n.forEach((function(e,t){return i[t]={value:e,index:t}})),r<i.length&&(ML(i,r),i=i.slice(0,r)),a&&i.sort(CL);for(var o=d*r,l=u.subarray(o,o+r),h=c.subarray(o,o+r),p=0;p<r;p++)l[p]=i[p].value,h[p]=i[p].index},d=0;d<o;d++)l();var h=t.slice();return h[h.length-1]=r,[df(h,n,u),df(h,"int32",c)]}Pf("cpu",(function(){return new FN}),1);var RL=aR(qu,(function(e){return e>=0?e:Math.exp(e)-1})),LL={kernelName:qu,backendName:"cpu",kernelFunc:RL};function AL(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.alpha;ON([a],"leakyRelu");for(var o=fs(a.shape),s=n.data.get(a.dataId).values,u=Ss("float32",o),c=0;c<s.length;c++)u[c]=s[c]<0?i*s[c]:s[c];return n.makeTensorInfo(a.shape,"float32",u)}var PL={kernelName:wc,backendName:"cpu",kernelFunc:AL},DL=WN((function(e,t){return e<0?t*e:e}));function OL(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha;ON([r,a],"prelu");var o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,u=i(DL(r.shape,a.shape,o,s,"float32"),2),c=u[0],l=u[1];return n.makeTensorInfo(l,"float32",c)}var zL={kernelName:rl,backendName:"cpu",kernelFunc:OL},FL=aR(ll,(function(e){return Math.max(0,e)})),GL={kernelName:ll,backendName:"cpu",kernelFunc:FL},WL=aR(vl,(function(e){return Math.min(Math.max(0,e),6)})),VL={kernelName:vl,backendName:"cpu",kernelFunc:WL};function UL(e,t,n,r,a){if("linear"===n)return BN({inputs:{x:t},backend:e});if("relu"===n)return FL({inputs:{x:t},backend:e});if("elu"===n)return RL({inputs:{x:t},backend:e});if("relu6"===n)return WL({inputs:{x:t},backend:e});if("prelu"===n)return OL({inputs:{x:t,alpha:r},backend:e});if("leakyrelu"===n)return AL({inputs:{x:t},backend:e,attrs:{alpha:a}});if("sigmoid"===n)return hL({inputs:{x:t},backend:e});throw new Error("Activation ".concat(n," has not been implemented for the CPU backend."))}function XL(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.shape,o=fs(a.shape),s=xs(i,o),u=fs(s);ls(o===u,(function(){return"The new shape (".concat(s,") has ").concat(u," elements and the old shape (").concat(a.shape,") has ").concat(o," elements. The new shape and old shape must have the same number of elements.")})),n.incRef(a.dataId);var c=n.data.get(a.dataId);if(null!=c.complexTensorInfos){var l=c.complexTensorInfos.real,d=c.complexTensorInfos.imag;l.shape=s,d.shape=s}return{dataId:a.dataId,shape:s,dtype:a.dtype}}var BL={kernelName:dl,backendName:"cpu",kernelFunc:XL};function HL(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,o=t.b,s=r.transposeA,u=r.transposeB;ON([a,o],"matMul");var c=a.shape.length,l=o.shape.length,d=s?a.shape[c-2]:a.shape[c-1],h=u?o.shape[l-1]:o.shape[l-2],p=s?a.shape[c-1]:a.shape[c-2],f=u?o.shape[l-2]:o.shape[l-1],m=a.shape.slice(0,-2),v=o.shape.slice(0,-2),g=fs(m),y=fs(v),b=Uf(a.shape.slice(0,-2),o.shape.slice(0,-2)).concat([p,f]);ls(d===h,(function(){return"Error in matMul: inner shapes (".concat(d,") and (").concat(h,") of Tensors with shapes ").concat(a.shape," and ").concat(o.shape," and transposeA=").concat(s," and transposeB=").concat(u," must match.")}));for(var x=u?[y,f,h]:[y,h,f],w=XL({inputs:{x:a},backend:n,attrs:{shape:s?[g,d,p]:[g,p,d]}}),k=XL({inputs:{x:o},backend:n,attrs:{shape:x}}),S=s?w.shape[1]:w.shape[2],T=s?w.shape[2]:w.shape[1],_=u?k.shape[1]:k.shape[2],I=Math.max(g,y),E=n.data.get(w.dataId).values,C=n.data.get(k.dataId).values,M=zs(w.shape),N=zs(k.shape),R=i(s?[M[0],1,M[1]]:[M[0],M[1],1],3),L=R[0],A=R[1],P=R[2],D=i(u?[1,N[1],N[0]]:[N[1],1,N[0]],3),O=D[0],z=D[1],F=D[2],G=T*_,W=df([I,T,_],w.dtype),V=W.values,U=n.blockSize,X=0;X<I;X++)for(var B=0;B<T;B+=U)for(var H=0;H<_;H+=U)for(var Z=0;Z<S;Z+=U)for(var K=Math.min(B+U,T),j=Math.min(H+U,_),Y=Math.min(Z+U,S),Q=B;Q<K;Q++)for(var J=H;J<j;J++){for(var q=0,$=Z;$<Y;$++){var ee=Math.min(X,g-1)*L,te=Math.min(X,y-1)*F;q+=E[ee+Q*A+$*P]*C[$*O+J*z+te]}V[X*G+(Q*_+J)]+=q}return n.disposeIntermediateTensorInfo(w),n.disposeIntermediateTensorInfo(k),n.makeTensorInfo(b,W.dtype,W.values)}var ZL={kernelName:bu,backendName:"cpu",kernelFunc:HL};var KL={kernelName:od,backendName:"cpu",kernelFunc:function(e){var t,n,r,a=e.inputs,i=e.backend,o=e.attrs,s=a.a,u=a.b,c=a.bias,l=a.preluActivationWeights,d=o.transposeA,h=o.transposeB,p=o.activation,f=o.leakyreluAlpha,m=[];t=HL({inputs:{a:s,b:u},attrs:{transposeA:d,transposeB:h},backend:i}),c&&(n=eR({inputs:{a:t,b:c},backend:i}),m.push(t),t=n),p&&(r=UL(i,t,p,l,f),m.push(t),t=r);for(var v=0,g=m;v<g.length;v++){var y=g[v];i.disposeIntermediateTensorInfo(y)}return t}},jL=aR(nu,(function(e){return Math.acos(e)})),YL={kernelName:nu,backendName:"cpu",kernelFunc:jL},QL=aR(ru,(function(e){return Math.acosh(e)})),JL={kernelName:ru,backendName:"cpu",kernelFunc:QL};var qL={kernelName:iu,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t;ON(t,"addN");for(var a=r.map((function(e){return n.data.get(e.dataId).values})),i=df(r[0].shape,r[0].dtype),o=i.values,s=0;s<r.length;s++)for(var u=a[s],c=0;c<o.length;c++)o[c]+=u[c];return n.makeTensorInfo(i.shape,i.dtype,i.values)}};var $L={kernelName:ou,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.keepDims;ON(a,"all");var u=ws(o,a.shape),c=u,l=Qv(c,a.shape.length),d=a;null!=l&&(d=JR({inputs:{x:a},backend:n,attrs:{perm:l}}),c=qv(c.length,a.shape.length)),Yv("all",c,d.shape.length);for(var h=i(Kv(d.shape,c),2),p=h[0],f=fs(h[1]),m=Vs(fs(p),d.dtype),v=n.data.get(d.dataId).values,g=0;g<m.length;++g){for(var y=g*f,b=v[y],x=0;x<f;++x){var w=v[y+x];b=b&&w}m[g]=b}null!=l&&n.disposeIntermediateTensorInfo(d);var k=n.makeTensorInfo(p,d.dtype,m);if(s){var S=XL({inputs:{x:k},backend:n,attrs:{shape:jv(p,u)}});return n.disposeIntermediateTensorInfo(k),S}return k}};var eA={kernelName:su,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.keepDims;ON(a,"any");var u=ws(o,a.shape),c=u,l=Qv(c,a.shape.length),d=a;null!=l&&(d=JR({inputs:{x:a},backend:n,attrs:{perm:l}}),c=qv(c.length,a.shape.length)),Yv("any",c,d.shape.length);for(var h=i(Kv(d.shape,c),2),p=h[0],f=fs(h[1]),m=Vs(fs(p),d.dtype),v=n.data.get(d.dataId).values,g=0;g<m.length;++g){for(var y=g*f,b=v[y],x=0;x<f;++x){var w=v[y+x];b=b||w}m[g]=b}null!=l&&n.disposeIntermediateTensorInfo(d);var k=n.makeTensorInfo(p,d.dtype,m);if(s){var S=XL({inputs:{x:k},backend:n,attrs:{shape:jv(p,u)}});return n.disposeIntermediateTensorInfo(k),S}return k}};var tA={kernelName:uu,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis;ON(a,"argMax");var s=ws(o,a.shape),u=Qv(s,a.shape.length),c=a,l=[];null!=u&&(c=JR({inputs:{x:a},backend:n,attrs:{perm:u}}),l.push(c),s=qv(s.length,c.shape.length)),Yv("argMax",s=[s[0]],c.shape.length);for(var d=i(Kv(c.shape,s),2),h=d[0],p=d[1],f=Vs(fs(h),"int32"),m=fs(p),v=n.data.get(c.dataId).values,g=0;g<f.length;++g){for(var y=g*m,b=v[y],x=0,w=0;w<m;++w){var k=v[y+w];k>b&&(b=k,x=w)}f[g]=x}return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(h,"int32",f)}};var nA={kernelName:cu,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis;ON(a,"argMin");var s=ws(o,a.shape),u=Qv(s,a.shape.length),c=a,l=[];null!=u&&(c=JR({inputs:{x:a},backend:n,attrs:{perm:u}}),l.push(c),s=qv(s.length,c.shape.length)),Yv("argMin",s=[s[0]],c.shape.length);for(var d=i(Kv(c.shape,s),2),h=d[0],p=d[1],f=Vs(fs(h),"int32"),m=fs(p),v=n.data.get(c.dataId).values,g=0;g<f.length;++g){for(var y=g*m,b=v[y],x=0,w=0;w<m;++w){var k=v[y+w];k<b&&(b=k,x=w)}f[g]=x}return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(h,"int32",f)}},rA=aR(lu,(function(e){return Math.asin(e)})),aA={kernelName:lu,backendName:"cpu",kernelFunc:rA},iA=aR(du,(function(e){return Math.asinh(e)})),oA={kernelName:du,backendName:"cpu",kernelFunc:iA},sA=aR(hu,(function(e){return Math.atan(e)})),uA={kernelName:hu,backendName:"cpu",kernelFunc:sA},cA=WN((function(e,t){return Math.atan2(e,t)})),lA=QN(fu,cA),dA={kernelName:fu,backendName:"cpu",kernelFunc:lA},hA=aR(pu,(function(e){return Math.atanh(e)})),pA={kernelName:pu,backendName:"cpu",kernelFunc:hA};function fA(e,t,n,r,a,i){for(var o=a.strideHeight,s=a.strideWidth,u=a.dilationHeight,c=a.dilationWidth,l=a.effectiveFilterHeight,d=a.effectiveFilterWidth,h=a.padInfo.top,p=a.padInfo.left,f="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=df(a.outShape,n),v=m.values,g=a.outShape[1]*a.outShape[2]*a.outShape[3],y=a.outShape[2]*a.outShape[3],b=a.outShape[3],x=0;x<a.batchSize;++x)for(var w=x*g,k=x*r[0],S=0;S<a.inChannels;++S)for(var T=0;T<a.outHeight;++T)for(var _=T*o-h,I=Math.max(0,_),E=Math.min(a.inHeight,l+_),C=w+T*y,M=0;M<a.outWidth;++M){for(var N=M*s-p,R=Math.max(0,N),L=Math.min(a.inWidth,d+N),A=f,P=0,D=0,O=I;O<E;O+=u){for(var z=k+O*r[1],F=R;F<L;F+=c){var G=e[z+F*r[2]+S];"max"===i&&G>A?A=G:"avg"===i&&(P+=G,D++)}if(isNaN(A))break}v[C+M*b+S]="avg"===i?P/D:A}return m}function mA(e,t,n,r){for(var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=df(r.outShape,"int32"),s=r.strideHeight,u=r.strideWidth,c=r.dilationHeight,l=r.dilationWidth,d=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.top,f=r.padInfo.left,m=df(t,n,e),v=0;v<r.batchSize;++v)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.outHeight;++y){for(var b=y*s-p,x=b;x<0;)x+=c;for(var w=Math.min(r.inHeight,d+b),k=0;k<r.outWidth;++k){for(var S=k*u-f,T=S;T<0;)T+=l;for(var _=Math.min(r.inWidth,h+S),I=Number.NEGATIVE_INFINITY,E=-1,C=x;C<w;C+=c)for(var M=C-b,N=T;N<_;N+=l){var R=N-S,L=m.get(v,C,N,g);L>I&&(I=L,E=a?i?((v*r.inHeight+C)*r.inWidth+N)*r.inChannels+g:(C*r.inWidth+N)*r.inChannels+g:M*h+R)}o.set(E,v,y,k,g)}}return o}function vA(e,t,n,r,a,i){for(var o=a.strideDepth,s=a.strideHeight,u=a.strideWidth,c=a.dilationDepth,l=a.dilationHeight,d=a.dilationWidth,h=a.effectiveFilterDepth,p=a.effectiveFilterHeight,f=a.effectiveFilterWidth,m=a.padInfo.front,v=a.padInfo.top,g=a.padInfo.left,y="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=df(a.outShape,n),x=b.values,w=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],k=a.outShape[2]*a.outShape[3]*a.outShape[4],S=a.outShape[3]*a.outShape[4],T=a.outShape[4],_=0;_<a.batchSize;++_)for(var I=_*w,E=_*r[0],C=0;C<a.inChannels;++C)for(var M=0;M<a.outDepth;++M){for(var N=M*o-m,R=N;R<0;)R+=c;for(var L=Math.min(a.inDepth,h+N),A=I+M*k,P=0;P<a.outHeight;++P){for(var D=P*s-v,O=D;O<0;)O+=l;for(var z=Math.min(a.inHeight,p+D),F=A+P*S,G=0;G<a.outWidth;++G){for(var W=G*u-g,V=W;V<0;)V+=d;for(var U=Math.min(a.inWidth,f+W),X=F+G*T,B=y,H=0,Z=0,K=R;K<L;K+=c){for(var j=E+K*r[1],Y=O;Y<z;Y+=l){for(var Q=j+Y*r[2],J=V;J<U;J+=d){var q=e[Q+J*r[3]+C];if("max"===i&&q>B?B=q:"avg"===i&&(H+=q,Z++),isNaN(B))break}if(isNaN(B))break}if(isNaN(B))break}x[X+C]="avg"===i?H/Z:B}}}return b}var gA={kernelName:mu,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;ON(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;ls($m(o,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(1,"'")}));var c,l=Xm(a.shape,i,o,1,s,u);if(1===l.filterWidth&&1===l.filterHeight&&ms(l.inShape,l.outShape))c=BN({inputs:{x:a},backend:n});else{var d=n.data.get(a.dataId).values,h=zs(a.shape),p=fA(d,a.shape,a.dtype,h,l,"avg");c=n.makeTensorInfo(l.outShape,a.dtype,p.values)}return c}};var yA={kernelName:gu,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat;ON(a,"avgPool3d");var l=Bm(a.shape,i,o,1,s,u,c),d=vA(n.data.get(a.dataId).values,a.shape,a.dtype,zs(a.shape),l,"avg");return n.makeTensorInfo(d.shape,"float32",d.values)}};var bA={kernelName:yu,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;ON([a,i],"avgPool3DGrad");for(var l=Bm(i.shape,o,s,1,u,c),d=l.strideDepth,h=l.strideHeight,p=l.strideWidth,f=l.filterDepth,m=l.filterHeight,v=l.filterWidth,g=l.dilationDepth,y=l.dilationHeight,b=l.dilationWidth,x=l.effectiveFilterDepth,w=l.effectiveFilterHeight,k=l.effectiveFilterWidth,S=x-1-l.padInfo.front,T=k-1-l.padInfo.left,_=w-1-l.padInfo.top,I=df(i.shape,"float32"),E=1/(f*m*v),C=n.bufferSync(a),M=0;M<l.batchSize;++M)for(var N=0;N<l.inChannels;++N)for(var R=0;R<l.inDepth;++R)for(var L=0;L<l.inHeight;++L)for(var A=0;A<l.inWidth;++A){for(var P=R-S,D=L-_,O=A-T,z=0,F=0;F<x;F+=g){var G=(P+F)/d;if(!(G<0||G>=l.outDepth||Math.floor(G)!==G))for(var W=0;W<w;W+=y){var V=(D+W)/h;if(!(V<0||V>=l.outHeight||Math.floor(V)!==V))for(var U=0;U<k;U+=b){var X=(O+U)/p;if(!(X<0||X>=l.outWidth||Math.floor(X)!==X))z+=C.get(M,G,V,X,N)}}}I.set(z*E,M,R,L,A,N)}return n.makeTensorInfo(I.shape,I.dtype,I.values)}};var xA={kernelName:vu,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;ON([a,i],"avgPoolGrad");for(var s=r.filterSize,u=r.strides,c=r.pad,l=Xm(o.shape,s,u,1,c),d=l.strideHeight,h=l.strideWidth,p=l.filterHeight,f=l.filterWidth,m=l.dilationHeight,v=l.dilationWidth,g=l.effectiveFilterHeight,y=l.effectiveFilterWidth,b=y-1-l.padInfo.left,x=g-1-l.padInfo.top,w=df(o.shape,"float32"),k=1/(p*f),S=n.data.get(a.dataId).values,T=df(a.shape,"float32",S),_=0;_<l.batchSize;++_)for(var I=0;I<l.inChannels;++I)for(var E=0;E<l.inHeight;++E)for(var C=0;C<l.inWidth;++C){for(var M=E-x,N=C-b,R=0,L=0;L<g;L+=m){var A=(M+L)/d;if(!(A<0||A>=l.outHeight||Math.floor(A)!==A))for(var P=0;P<y;P+=v){var D=(N+P)/h;if(!(D<0||D>=l.outWidth||Math.floor(D)!==D))R+=T.get(_,A,D,I)}}w.set(R*k,_,E,C,I)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}};var wA={kernelName:lc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.scale,o=t.offset,s=t.mean,u=t.variance;ls(s.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),ls(null==o||s.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),ls(null==i||s.shape.length===i.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),ON([a,s,u,i,o],"batchNorm");var c=r.varianceEpsilon;null==c&&(c=.001);for(var l=n.data.get(a.dataId).values,d=n.data.get(s.dataId).values,h=n.data.get(u.dataId).values,p=i?n.data.get(i.dataId).values:new Float32Array([1]),f=o?n.data.get(o.dataId).values:new Float32Array([0]),m=new Float32Array(l.length),v=f.length,g=p.length,y=h.length,b=d.length,x=0,w=0,k=0,S=0,T=0;T<l.length;++T)m[T]=f[x++]+(l[T]-d[w++])*p[k++]/Math.sqrt(h[S++]+c),x>=v&&(x=0),w>=b&&(w=0),k>=g&&(k=0),S>=y&&(S=0);return n.makeTensorInfo(a.shape,a.dtype,m)}};var kA={kernelName:xu,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops;ON([a],"batchToSpaceND");var s=i.reduce((function(e,t){return e*t})),u=qx(a.shape,i,s),c=$x(u.length,i.length),l=ew(a.shape,i,s),d=tw(o,i.length),h=nw(l,o,i.length),p=XL({inputs:{x:a},backend:n,attrs:{shape:u}}),f=JR({inputs:{x:p},backend:n,attrs:{perm:c}}),m=XL({inputs:{x:f},backend:n,attrs:{shape:l}}),v=fL({inputs:{x:m},backend:n,attrs:{begin:d,size:h}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),v}};var SA={kernelName:wu,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=nR(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,s)}};var TA={kernelName:Su,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.s0,a=t.s1,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=Uf(Array.from(i),Array.from(o));return n.makeTensorInfo([s.length],"int32",Int32Array.from(s))}},_A=aR(Iu,(function(e,t){var n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e})),IA={kernelName:Iu,backendName:"cpu",kernelFunc:_A},EA={kernelName:Cu,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs.x,n=e.backend,r=new Float32Array(fs(t.shape)),a=n.data.get(t.dataId),i=a.complexTensorInfos.real,o=a.complexTensorInfos.imag,s=n.data.get(i.dataId).values,u=n.data.get(o.dataId).values,c=0;c<s.length;c++){var l=s[c],d=u[c];r[c]=Math.hypot(l,d)}return n.makeOutput(r,t.shape,"float32")}};function CA(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.imag,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var MA={kernelName:gc,backendName:"cpu",kernelFunc:CA};function NA(e){var t=e.inputs,n=e.backend,r=ws(e.attrs.axis,t[0].shape)[0],a=t.map((function(e){return e.shape}));Xx(a,r);var i=Bx(t.map((function(e){return e.shape})),r);if(0===fs(i))return n.makeTensorInfo(i,t[0].dtype,[]);var o=t.filter((function(e){return fs(e.shape)>0}));if(1===o.length)return BN({inputs:{x:o[0]},backend:n});if("complex64"===o[0].dtype){var s=o.map((function(e){return ZN({inputs:{input:e},backend:n})})),u=o.map((function(e){return CA({inputs:{input:e},backend:n})})),c=NA({inputs:s,backend:n,attrs:{axis:r}}),l=NA({inputs:u,backend:n,attrs:{axis:r}}),d=VN({inputs:{real:c,imag:l},backend:n});return s.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),d}var h=o.map((function(e){var t=[-1,fs(e.shape.slice(r))];return XL({inputs:{x:e},backend:n,attrs:{shape:t}})})),p=h.map((function(e){return{vals:n.data.get(e.dataId).values,shape:e.shape}}));i=Bx(h.map((function(e){return e.shape})),1);var f=1===h[0].shape[0],m=function(e,t,n,r){var a=Ts(n,fs(t));if(r&&"string"!==n){var i=0;e.forEach((function(e){var t=fs(e.shape);a.set(e.vals,i),i+=t}))}else{var o=0;e.forEach((function(e){for(var r="string"===n?Zw(e.vals):e.vals,i=0,s=0;s<e.shape[0];++s)for(var u=s*t[1]+o,c=0;c<e.shape[1];++c)a[u+c]=r[i++];o+=e.shape[1]}))}return a}(p,i,t[0].dtype,f),v=Bx(o.map((function(e){return e.shape})),r),g=n.makeTensorInfo(v,t[0].dtype,m);return h.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}var RA={kernelName:Mu,backendName:"cpu",kernelFunc:NA};function LA(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dilations,l=r.dimRoundingMode;ON([a,i],"conv2d");for(var d=ev(u),h=Hm(a.shape,i.shape,o,c,s,l,!1,d),p=h.filterHeight,f=h.filterWidth,m=h.dilationHeight,v=h.dilationWidth,g=h.padInfo.left,y=h.padInfo.top,b="channelsLast"===h.dataFormat,x=new bh(h.outShape,a.dtype),w=zs(a.shape),k=zs(i.shape),S=w[0],T=b?w[1]:w[2],_=b?w[2]:1,I=b?1:w[1],E=x.strides[0],C=b?x.strides[1]:x.strides[2],M=b?x.strides[2]:1,N=b?1:x.strides[1],R=n.data.get(a.dataId).values,L=n.data.get(i.dataId).values,A=x.values,P=0;P<h.batchSize;++P)for(var D=P*S,O=P*E,z=0;z<h.outHeight;++z)for(var F=O+z*C,G=z*h.strideHeight-y,W=0;W<p;++W){var V=G+W*m;if(!(V<0||V>=h.inHeight))for(var U=W*k[0],X=D+V*T,B=0;B<h.outWidth;++B)for(var H=F+B*M,Z=B*h.strideWidth-g,K=0;K<f;++K){var j=Z+K*v;if(!(j<0||j>=h.inWidth))for(var Y=X+j*_,Q=U+K*k[1],J=0;J<h.inChannels;++J){for(var q=R[Y+J*I],$=0;$<h.outChannels;++$)A[H+$*N]+=q*L[Q+$];Q+=h.outChannels}}}return n.makeTensorInfo(x.shape,x.dtype,A)}var AA={kernelName:Nu,backendName:"cpu",kernelFunc:LA};var PA={kernelName:Ru,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape;ON([a,i],"conv2dBackpropFilter");for(var d=ev(u),h=Hm(a.shape,l,o,1,s,c,!1,d),p=h.strideHeight,f=h.strideWidth,m=h.filterHeight,v=h.filterWidth,g="channelsLast"===h.dataFormat,y=new bh(h.filterShape,"float32"),b=h.padInfo.left,x=h.padInfo.top,w=n.data.get(a.dataId).values,k=n.data.get(i.dataId).values,S=new bh(a.shape,a.dtype,w),T=new bh(i.shape,i.dtype,k),_=0;_<m;++_)for(var I=Math.max(0,Math.ceil((x-_)/p)),E=Math.min(h.outHeight,(h.inHeight+x-_)/p),C=0;C<v;++C)for(var M=Math.max(0,Math.ceil((b-C)/f)),N=Math.min(h.outWidth,(h.inWidth+b-C)/f),R=0;R<h.inChannels;++R)for(var L=0;L<h.outChannels;++L){for(var A=0,P=0;P<h.batchSize;++P)for(var D=I;D<E;++D)for(var O=_+D*p-x,z=M;z<N;++z){var F=C+z*f-b;A+=g?S.get(P,O,F,R)*T.get(P,D,z,L):S.get(P,R,O,F)*T.get(P,L,D,z)}y.set(A,_,C,R,L)}return n.makeTensorInfo(y.shape,y.dtype,y.values)}};var DA={kernelName:Lu,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.filter,s=r.inputShape,u=r.strides,c=r.pad,l=r.dataFormat,d=r.dimRoundingMode;ON([a,o],"conv2dBackpropInput");var h=zs(o.shape),p=zs(a.shape),f=ev(l),m=Hm(s,o.shape,u,1,c,d,!1,f),v=new bh(m.inShape,"float32"),g=v.values,y=n.data.get(a.dataId).values,b=n.data.get(o.dataId).values,x=i(h,3),w=x[0],k=x[1],S=x[2],T=m.batchSize,_=m.filterHeight,I=m.filterWidth,E=m.inChannels,C=m.inHeight,M=m.inWidth,N=m.outChannels,R=m.outHeight,L=m.outWidth,A=m.strideHeight,P=m.strideWidth;f=m.dataFormat;for(var D=_-1-m.padInfo.top,O=I-1-m.padInfo.left,z="channelsLast"===f,F=v.strides[0],G=z?v.strides[1]:v.strides[2],W=z?v.strides[2]:1,V=z?1:v.strides[1],U=p[0],X=z?p[1]:p[2],B=z?p[2]:1,H=z?1:p[1],Z=0;Z<T;++Z)for(var K=0;K<E;++K)for(var j=0;j<C;++j)for(var Y=j-D,Q=Math.max(0,Math.ceil(Y/A)),J=Math.min(R,(_+Y)/A),q=0;q<M;++q){for(var $=q-O,ee=Math.max(0,Math.ceil($/P)),te=Math.min(L,(I+$)/P),ne=0,re=Q;re<J;++re)for(var ae=re*A-Y,ie=ee;ie<te;++ie)for(var oe=U*Z+X*re+B*ie,se=w*(_-1-ae)+k*(I-1-(ie*P-$))+S*K,ue=0;ue<N;++ue){ne+=y[oe+H*ue]*b[se+ue]}g[F*Z+G*j+W*q+V*K]=ne}return n.makeTensorInfo(v.shape,v.dtype,v.values)}};var OA={kernelName:Au,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations;ON([a,i],"conv3d");for(var c=Zm(a.shape,i.shape,o,u,s),l=c.filterDepth,d=c.filterHeight,h=c.filterWidth,p=c.dilationDepth,f=c.dilationHeight,m=c.dilationWidth,v=c.padInfo,g=v.front,y=v.left,b=v.top,x=new bh(c.outShape,a.dtype),w=n.data.get(a.dataId).values,k=n.data.get(i.dataId).values,S=x.values,T=zs(a.shape),_=zs(i.shape),I=0;I<c.batchSize;++I)for(var E=I*T[0],C=I*x.strides[0],M=0;M<c.outDepth;++M)for(var N=C+M*x.strides[1],R=M*c.strideDepth-g,L=0;L<l;++L){var A=R+L*p;if(!(A<0||A>=c.inDepth))for(var P=L*_[0],D=E+A*T[1],O=0;O<c.outHeight;++O)for(var z=N+O*x.strides[2],F=O*c.strideHeight-b,G=0;G<d;++G){var W=F+G*f;if(!(W<0||W>=c.inHeight))for(var V=P+G*_[1],U=D+W*T[2],X=0;X<c.outWidth;++X)for(var B=z+X*c.outChannels,H=X*c.strideWidth-y,Z=0;Z<h;++Z){var K=H+Z*m;if(!(K<0||K>=c.inWidth))for(var j=V+Z*_[2],Y=U+K*c.inChannels,Q=j,J=0;J<c.inChannels;++J){for(var q=w[Y+J],$=0;$<c.outChannels;++$)S[B+$]+=q*k[Q+$];Q+=c.outChannels}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}};var zA={kernelName:Pu,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.dy,s=r.strides,u=r.pad,c=r.filterShape;ON([a,o],"conv3dBackpropFilterV2");for(var l=zs(a.shape),d=zs(o.shape),h=Zm(a.shape,c,s,1,u),p=h.strideDepth,f=h.strideHeight,m=h.strideWidth,v=h.filterDepth,g=h.filterHeight,y=h.filterWidth,b=new bh(h.filterShape,"float32"),x=b.values,w=i(b.strides,4),k=w[0],S=w[1],T=w[2],_=w[3],I=n.data.get(o.dataId).values,E=i(d,4),C=E[0],M=E[1],N=E[2],R=E[3],L=n.data.get(a.dataId).values,A=i(l,4),P=A[0],D=A[1],O=A[2],z=A[3],F=h.padInfo.front,G=h.padInfo.left,W=h.padInfo.top,V=0;V<v;++V)for(var U=Math.max(0,Math.ceil((F-V)/p)),X=Math.min(h.outDepth,(h.inDepth+F-V)/p),B=V*k,H=0;H<g;++H)for(var Z=Math.max(0,Math.ceil((W-H)/f)),K=Math.min(h.outHeight,(h.inHeight+W-H)/f),j=H*S+B,Y=0;Y<y;++Y)for(var Q=Math.max(0,Math.ceil((G-Y)/m)),J=Math.min(h.outWidth,(h.inWidth+G-Y)/m),q=Y*T+j,$=0;$<h.inChannels;++$)for(var ee=$*_+q,te=0;te<h.outChannels;++te){for(var ne=0,re=0;re<h.batchSize;++re)for(var ae=re*P,ie=re*C,oe=U;oe<X;++oe)for(var se=(V+oe*p-F)*D+ae,ue=oe*M+ie,ce=Z;ce<K;++ce)for(var le=(H+ce*f-W)*O+se,de=ce*N+ue,he=Q;he<J;++he){var pe=he*R+de;ne+=L[(Y+he*m-G)*z+le+$]*I[pe+te]}x[ee+te]=ne}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};var FA={kernelName:Du,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.filter,s=r.pad,u=r.strides,c=r.inputShape;ON([a],"conv3dBackpropInputV2");for(var l=zs(a.shape),d=zs(o.shape),h=Zm(c,o.shape,u,1,s),p=new bh(h.inShape,"float32"),f=p.values,m=i(p.strides,4),v=m[0],g=m[1],y=m[2],b=m[3],x=n.data.get(a.dataId).values,w=i(l,4),k=w[0],S=w[1],T=w[2],_=w[3],I=n.data.get(o.dataId).values,E=i(d,4),C=E[0],M=E[1],N=E[2],R=E[3],L=h.batchSize,A=h.filterDepth,P=h.filterHeight,D=h.filterWidth,O=h.inChannels,z=h.inDepth,F=h.inHeight,G=h.inWidth,W=h.outChannels,V=h.outDepth,U=h.outHeight,X=h.outWidth,B=h.strideDepth,H=h.strideHeight,Z=h.strideWidth,K=A-1-h.padInfo.front,j=P-1-h.padInfo.top,Y=D-1-h.padInfo.left,Q=0;Q<L;++Q)for(var J=0;J<O;++J)for(var q=0;q<z;++q)for(var $=q-K,ee=Math.max(0,Math.ceil($/B)),te=Math.min(V,(A+$)/B),ne=0;ne<F;++ne)for(var re=ne-j,ae=Math.max(0,Math.ceil(re/H)),ie=Math.min(U,(P+re)/H),oe=0;oe<G;++oe){for(var se=oe-Y,ue=Math.max(0,Math.ceil(se/Z)),ce=Math.min(X,(D+se)/Z),le=0,de=ee;de<te;++de)for(var he=de*B-$,pe=ae;pe<ie;++pe)for(var fe=pe*H-re,me=ue;me<ce;++me)for(var ve=k*Q+S*de+T*pe+_*me,ge=C*(A-1-he)+M*(P-1-fe)+N*(D-1-(me*Z-se))+R*J,ye=0;ye<W;++ye){le+=x[ve+ye]*I[ge+ye]}f[v*Q+g*q+y*ne+b*oe+J]=le}return n.makeTensorInfo(p.shape,p.dtype,p.values)}},GA=aR(Ou,(function(e){return Math.cos(e)})),WA={kernelName:Ou,backendName:"cpu",kernelFunc:GA},VA=aR(zu,(function(e){return Math.cosh(e)})),UA={kernelName:zu,backendName:"cpu",kernelFunc:VA};var XA={kernelName:Wu,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,o=t.boxes,s=t.boxInd,u=r.cropSize,c=r.method,l=r.extrapolationValue,d=i(a.shape,4),h=d[0],p=d[1],f=d[2],m=d[3],v=o.shape[0],g=i(u,2),y=g[0],b=g[1],x=df([v,y,b,m],"float32"),w=n.data.get(o.dataId).values,k=n.data.get(s.dataId).values,S=n.data.get(a.dataId).values,T=zs(a.shape),_=zs(x.shape),I=0;I<v;I++){var E=4*I,C=w[E],M=w[E+1],N=w[E+2],R=w[E+3],L=k[I];if(!(L>=h))for(var A=y>1?(N-C)*(p-1)/(y-1):0,P=b>1?(R-M)*(f-1)/(b-1):0,D=0;D<y;D++){var O=y>1?C*(p-1)+D*A:.5*(C+N)*(p-1);if(O<0||O>p-1)for(var z=0;z<b;z++)for(var F=0;F<m;F++){var G=F+z*_[2]+D*_[1]+I*_[0];x.values[G]=l}else if("bilinear"===c)for(var W=Math.floor(O),V=Math.ceil(O),U=O-W,X=0;X<b;X++){var B=b>1?M*(f-1)+X*P:.5*(M+R)*(f-1);if(B<0||B>f-1)for(var H=0;H<m;H++){var Z=H+X*_[2]+D*_[1]+I*_[0];x.values[Z]=l}else for(var K=Math.floor(B),j=Math.ceil(B),Y=B-K,Q=0;Q<m;Q++){var J=Q+K*T[2]+W*T[1]+L*T[0],q=S[J],$=S[J=Q+j*T[2]+W*T[1]+L*T[0]],ee=S[J=Q+K*T[2]+V*T[1]+L*T[0]],te=q+($-q)*Y,ne=ee+(S[J=Q+j*T[2]+V*T[1]+L*T[0]]-ee)*Y;J=Q+X*_[2]+D*_[1]+I*_[0],x.values[J]=te+(ne-te)*U}}else for(var re=0;re<b;++re){var ae=b>1?M*(f-1)+re*P:.5*(M+R)*(f-1);if(ae<0||ae>f-1)for(var ie=0;ie<m;ie++){var oe=ie+re*_[2]+D*_[1]+I*_[0];x.values[oe]=l}else for(var se=Math.round(ae),ue=Math.round(O),ce=0;ce<m;ce++){var le=ce+se*T[2]+ue*T[1]+L*T[0],de=ce+re*_[2]+D*_[1]+I*_[0];x.values[de]=S[le]}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}};var BA={kernelName:Fu,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;ON(a,"cumprod");var u=Qv([i],a.shape.length),c=a;null!=u&&(c=JR({inputs:{x:a},backend:n,attrs:{perm:u}}));var l=qv(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumprod in CPU expects an inner-most axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var d=Rh(c.dtype,"int32"),h=Ws(fs(c.shape),d),p=n.data.get(c.dataId).values,f=c.shape[c.shape.length-1],m=s?function(e,t){return e+f-t-1}:function(e,t){return e+t},v=0;v<p.length;v+=f)for(var g=0;g<f;g++){var y=m(v,g);if(0===g)h[y]=o?1:p[y];else{var b=m(v,g-1);h[y]=o?p[b]*h[b]:p[y]*h[b]}}var x=n.makeTensorInfo(c.shape,d,h);if(null!=u){var w=JR({inputs:{x:x},backend:n,attrs:{perm:Jv(u)}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(c),w}return x}};var HA={kernelName:Gu,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;ON(a,"cumsum");var u=Qv([i],a.shape.length),c=a;null!=u&&(c=JR({inputs:{x:a},backend:n,attrs:{perm:u}}));var l=qv(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var d=Rh(c.dtype,"int32"),h=Vs(fs(c.shape),d),p=n.data.get(c.dataId).values,f=c.shape[c.shape.length-1],m=s?function(e,t){return e+f-t-1}:function(e,t){return e+t},v=0;v<p.length;v+=f)for(var g=0;g<f;g++){var y=m(v,g);if(0===g)h[y]=o?0:p[y];else{var b=m(v,g-1);h[y]=o?p[b]+h[b]:p[y]+h[b]}}var x=n.makeTensorInfo(c.shape,d,h);if(null!=u){var w=JR({inputs:{x:x},backend:n,attrs:{perm:Jv(u)}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(c),w}return x}};var ZA={kernelName:Vu,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=nR(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,u)}if(2===a.shape.length){var c=function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.shape[0],i=e.shape[1],o=df([a,n],t.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var c=e.get(s,u);if(c<0)throw new Error("Input x must be non-negative!");c>=n||(r?o.set(1,s,c):t.size>0?o.set(o.get(s,c)+t.get(s,u),s,c):o.set(o.get(s,c)+1,s,c))}return o}(n.bufferSync(a),n.bufferSync(i),o,s);return n.makeTensorInfo(c.shape,i.dtype,c.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank".concat(a.shape.length,"."))}};var KA={kernelName:Uu,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockSize,o=r.dataFormat;ls("NHWC"===o,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(o)}));for(var s=a.shape[0],u=a.shape[1],c=a.shape[2],l=a.shape[3],d=u*i,h=c*i,p=l/(i*i),f=n.data.get(a.dataId).values,m=new Float32Array(s*d*h*p),v=0,g=0;g<s;++g)for(var y=0;y<d;++y)for(var b=Math.floor(y/i),x=y%i,w=0;w<h;++w)for(var k=Math.floor(w/i),S=(x*i+w%i)*p,T=0;T<p;++T){var _=T+S+l*(k+c*(b+u*g));m[v++]=f[_]}return n.makeTensorInfo([s,d,h,p],a.dtype,m)}};function jA(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode;ON([a,i],"depthwiseConv2DNative");var l=zs(a.shape),d=zs(i.shape),h=u;null==h&&(h=[1,1]),ls($m(o,h),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(h,"'")}));for(var p=Hm(a.shape,i.shape,o,h,s,c,!0),f=p.filterHeight,m=p.filterWidth,v=p.dilationHeight,g=p.dilationWidth,y=p.padInfo,b=y.left,x=y.top,w=p.outChannels/p.inChannels,k=new bh(p.outShape,a.dtype),S=n.data.get(a.dataId).values,T=n.data.get(i.dataId).values,_=k.values,I=0;I<p.batchSize;++I)for(var E=I*l[0],C=I*k.strides[0],M=0;M<p.outHeight;++M)for(var N=C+M*k.strides[1],R=M*p.strideHeight-x,L=0;L<f;++L){var A=R+L*v;if(!(A<0||A>=p.inHeight))for(var P=L*d[0],D=E+A*l[1],O=0;O<p.outWidth;++O)for(var z=N+O*k.strides[2],F=O*p.strideWidth-b,G=0;G<m;++G){var W=F+G*g;if(!(W<0||W>=p.inWidth))for(var V=P+G*d[1],U=D+W*p.inChannels,X=z,B=V,H=0;H<p.inChannels;++H){for(var Z=S[U+H],K=0;K<w;++K)_[X+K]+=Z*T[B+K];X+=w,B+=w}}}return n.makeTensorInfo(k.shape,k.dtype,k.values)}var YA={kernelName:Xu,backendName:"cpu",kernelFunc:jA};var QA={kernelName:Bu,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape;ON([a,i],"depthwiseConv2dNativeBackpropFilter");for(var d=Hm(a.shape,l,o,s,u,c,!0),h=d.strideHeight,p=d.strideWidth,f=d.filterHeight,m=d.filterWidth,v=new bh(d.filterShape,"float32"),g=d.padInfo.left,y=d.padInfo.top,b=d.outChannels/d.inChannels,x=n.data.get(a.dataId).values,w=new bh(a.shape,a.dtype,x),k=n.data.get(i.dataId).values,S=new bh(i.shape,i.dtype,k),T=0;T<f;++T)for(var _=Math.max(0,Math.ceil((y-T)/h)),I=Math.min(d.outHeight,(d.inHeight+y-T)/h),E=0;E<m;++E)for(var C=Math.max(0,Math.ceil((g-E)/p)),M=Math.min(d.outWidth,(d.inWidth+g-E)/p),N=0;N<d.outChannels;++N){for(var R=Math.trunc(N/b),L=N%b,A=0,P=0;P<d.batchSize;++P)for(var D=_;D<I;++D)for(var O=T+D*h-y,z=C;z<M;++z){var F=E+z*p-g;A+=w.get(P,O,F,R)*S.get(P,D,z,N)}v.set(A,T,E,R,L)}return n.makeTensorInfo(v.shape,v.dtype,v.values)}};var JA={kernelName:Hu,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.filter,s=r.strides,u=r.dilations,c=r.pad,l=r.dimRoundingMode,d=r.inputShape;ON([a,o],"depthwiseConv2DNativeBackpropInput");for(var h=zs(a.shape),p=zs(o.shape),f=Hm(d,o.shape,s,u,c,l,!0),m=new bh(f.inShape,"float32"),v=m.values,g=i(m.strides,3),y=g[0],b=g[1],x=g[2],w=n.data.get(a.dataId).values,k=i(h,3),S=k[0],T=k[1],_=k[2],I=n.data.get(o.dataId).values,E=i(p,3),C=E[0],M=E[1],N=E[2],R=f.batchSize,L=f.filterHeight,A=f.filterWidth,P=f.inChannels,D=f.inHeight,O=f.inWidth,z=f.outChannels,F=f.outHeight,G=f.outWidth,W=f.strideHeight,V=f.strideWidth,U=L-1-f.padInfo.top,X=A-1-f.padInfo.left,B=z/P,H=0;H<R;++H)for(var Z=0;Z<P;++Z)for(var K=0;K<D;++K)for(var j=K-U,Y=Math.max(0,Math.ceil(j/W)),Q=Math.min(F,(L+j)/W),J=0;J<O;++J){for(var q=J-X,$=Math.max(0,Math.ceil(q/V)),ee=Math.min(G,(A+q)/V),te=0,ne=Y;ne<Q;++ne)for(var re=ne*W-j,ae=$;ae<ee;++ae)for(var ie=S*H+T*ne+_*ae,oe=C*(L-1-re)+M*(A-1-(ae*V-q))+N*Z,se=0;se<B;++se){te+=w[ie+(Z*B+se)]*I[oe+se]}v[y*H+b*K+x*J+Z]=te}return n.makeTensorInfo(m.shape,m.dtype,m.values)}};var qA={kernelName:Zu,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=t.x,a=fs(r.shape),i=n.data.get(r.dataId).values,o=df([a,a],r.dtype),s=o.values,u=0;u<i.length;u++)s[u*a+u]=i[u];var c=[].concat(b(r.shape),b(r.shape));return n.makeTensorInfo(c,o.dtype,o.values)}},$A={kernelName:Ku,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=n,l=c.data.get(a.dataId).values,d=a.shape.length,h=c.data.get(i.dataId).values,p=i.shape.length,f=Um(a.shape,i.shape,o,s,"NHWC",u),m=f.batchSize,v=f.inHeight,g=f.inWidth,y=f.inChannels,b=f.outHeight,x=f.outWidth,w=f.padInfo,k=f.strideHeight,S=f.strideWidth,T=f.filterHeight,_=f.filterWidth,I=f.dilationHeight,E=f.dilationWidth,C=f.outShape,M=fs(C),N=C.length,R=Ts(a.dtype,M),L=0;L<m;++L)for(var A=0;A<b;++A)for(var P=A*k-w.top,D=0;D<x;++D)for(var O=D*S-w.left,z=0;z<y;++z){for(var F=Number.MIN_SAFE_INTEGER,G=0;G<T;++G){var W=P+G*I;if(W>=0&&W<v)for(var V=0;V<_;++V){var U=O+V*E;if(U>=0&&U<g){var X=Bs([L,W,U,z],d,zs(a.shape)),B=Bs([G,V,z],p,zs(i.shape)),H=l[X]+h[B];H>F&&(F=H)}}}R[Bs([L,A,D,z],N,zs(C))]=F}return{dataId:c.write(rh(R,a.dtype),C,a.dtype),shape:C,dtype:a.dtype}}},eP={kernelName:Yu,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,c=r.dilations,l=n,d=Gs(a.shape,l.data.get(a.dataId).values),h=Gs(i.shape,l.data.get(i.dataId).values),p=Um(a.shape,i.shape,s,u,"NHWC",c),f=p.batchSize,m=p.inHeight,v=p.inWidth,g=p.inChannels,y=p.outHeight,b=p.outWidth,x=p.padInfo,w=p.strideHeight,k=p.strideWidth,S=p.filterHeight,T=p.filterWidth,_=p.dilationHeight,I=p.dilationWidth,E=p.outShape;ls(o.rank===E.length,(function(){return"Error in ".concat(Yu,", dy must have the same rank as output ").concat(E.length,", but got ").concat(o.rank)}));for(var C=Gs(E,l.data.get(o.dataId).values),M=Us(i.shape,i.dtype),N=0;N<f;++N)for(var R=0;R<y;++R)for(var L=R*w-x.top,A=0;A<b;++A)for(var P=A*k-x.left,D=0;D<g;++D){for(var O=Number.MIN_SAFE_INTEGER,z=0,F=0,G=0;G<S;++G){var W=L+G*_;if(W>=0&&W<m)for(var V=0;V<T;++V){var U=P+V*I;if(U>=0&&U<v){var X=d[N][W][U][D]+h[G][V][D];X>O&&(O=X,z=G,F=V)}}}M[z][F][D]+=C[N][R][A][D]}return{dataId:l.write(rh(M,a.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},tP={kernelName:ju,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,c=r.dilations,l=n,d=Gs(a.shape,l.data.get(a.dataId).values),h=Gs(i.shape,l.data.get(i.dataId).values),p=Um(a.shape,i.shape,s,u,"NHWC",c),f=p.batchSize,m=p.inHeight,v=p.inWidth,g=p.inChannels,y=p.outHeight,b=p.outWidth,x=p.padInfo,w=p.strideHeight,k=p.strideWidth,S=p.filterHeight,T=p.filterWidth,_=p.dilationHeight,I=p.dilationWidth,E=p.outShape;ls(o.rank===E.length,(function(){return"Error in ".concat(ju,", dy must have the same rank as output ").concat(E.length,", but got ").concat(o.rank)}));for(var C=Gs(E,l.data.get(o.dataId).values),M=Us(a.shape,a.dtype),N=0;N<f;++N)for(var R=0;R<y;++R)for(var L=R*w-x.top,A=0;A<b;++A)for(var P=A*k-x.left,D=0;D<g;++D){for(var O=Number.MIN_SAFE_INTEGER,z=L<0?0:L,F=P<0?0:P,G=0;G<S;++G){var W=L+G*_;if(W>=0&&W<m)for(var V=0;V<T;++V){var U=P+V*I;if(U>=0&&U<v){var X=d[N][W][U][D]+h[G][V][D];X>O&&(O=X,z=W,F=U)}}}M[N][z][F][D]+=C[N][R][A][D]}return{dataId:l.write(rh(M,a.dtype),a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}};function nP(e){var t,n=e.inputs,r=e.backend,a=e.attrs,o=n.x,s=a.axis,u=a.keepDims;ON(o,"sum");var c=(t="bool"===o.dtype?jN({inputs:{x:o},backend:r,attrs:{dtype:"int32"}}):BN({inputs:{x:o},backend:r})).shape.length,l=ws(s,t.shape),d=Qv(l,c),h=l,p=t;null!=d&&(p=JR({inputs:{x:t},backend:r,attrs:{perm:d}}),h=qv(h.length,c)),Yv("sum",h,p.shape.length);for(var f=i(Kv(p.shape,h),2),m=f[0],v=f[1],g=XN(r,m,Rh(p.dtype,"int32")),y=fs(v),b=r.data.get(g.dataId).values,x=r.data.get(p.dataId).values,w=0;w<b.length;++w){for(var k=w*y,S=0,T=0;T<y;++T)S+=x[k+T];b[w]=S}if(u){var _=g;g=XL({inputs:{x:g},backend:r,attrs:{shape:jv(g.shape,l)}}),r.disposeIntermediateTensorInfo(_)}return r.disposeIntermediateTensorInfo(t),null!=d&&r.disposeIntermediateTensorInfo(p),g}var rP={kernelName:Rl,backendName:"cpu",kernelFunc:nP};var aP={kernelName:Ju,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,a=Sw(e.attrs.equation,r.length),i=a.allDims,o=a.summedDims,s=a.idDims;_w(i.length,s,r);for(var u=Iw(o,s),c=u.path,l=u.steps,d=l.length,h=null,p=i.length,f=[],m=0;m<d;++m){var v,g=x(l[m]);try{for(g.s();!(v=g.n()).done;){var y=v.value,b=Tw(p,s[y]),w=b.permutationIndices,k=b.expandDims,S=void 0;Ew(w)?S=r[y]:(S=JR({inputs:{x:r[y]},backend:n,attrs:{perm:w}}),f.push(S));for(var T=S.shape.slice(),_=0;_<k.length;++_)T.splice(k[_],0,1);ms(S.shape,T)||(S=XL({inputs:{x:S},backend:n,attrs:{shape:T}}),f.push(S)),null===h?h=S:(h=BR({inputs:{a:S,b:h},backend:n}),f.push(h))}}catch(M){g.e(M)}finally{g.f()}m<d-1&&(c[m]>=0&&(h=nP({inputs:{x:h},backend:n,attrs:{axis:c[m]-(i.length-p),keepDims:!1}}),f.push(h)),p--)}for(var I=0,E=f;I<E.length;I++){var C=E[I];C!==h&&n.disposeIntermediateTensorInfo(C)}return h}};var iP={kernelName:$u,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y;ON([r,a],"eluGrad");for(var i=new Float32Array(fs(a.shape)),o=n.data.get(a.dataId).values,s=n.data.get(r.dataId).values,u=0;u<o.length;++u){var c=o[u];i[u]=c>=1?s[u]:s[u]*(c+1)}return n.makeTensorInfo(a.shape,"float32",i)}},oP=aR(ec,(function(e){var t=Math.sign(e),n=Math.abs(e),r=1/(1+.3275911*n);return t*(1-((((1.061405429*r-1.453152027)*r+1.421413741)*r-.284496736)*r+.254829592)*r*Math.exp(-n*n))})),sP={kernelName:ec,backendName:"cpu",kernelFunc:oP};function uP(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.input,i=r.dim,o=a.shape.length,s=a.shape.slice(),u=i;return i<0&&(ls(-(o+1)<=i,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+i+1),s.splice(u,0,1),XL({inputs:{x:a},backend:n,attrs:{shape:s}})}var cP={kernelName:rc,backendName:"cpu",kernelFunc:uP},lP=WN((function(e,t){return e/t})),dP=QN(Qu,lP),hP={kernelName:Qu,backendName:"cpu",kernelFunc:dP};function pP(e,t,n){for(var r=e.shape,a=r[0],i=r[1],o=n.data.get(e.dataId),s=o.complexTensorInfos.real,u=o.complexTensorInfos.imag,c=[a,i],l=fs(c),d=Ss("float32",l),h=Ss("float32",l),p=0;p<a;p++){for(var f=fL({inputs:{x:s},backend:n,attrs:{begin:[p,0],size:[1,i]}}),m=fL({inputs:{x:u},backend:n,attrs:{begin:[p,0],size:[1,i]}}),v=VN({inputs:{real:f,imag:m},backend:n}),g=fP(v,t,n),y=dw(g.real,g.imag),b=0;b<i;b++){var x=mw(y,b);d[p*i+b]=x.real,h[p*i+b]=x.imag}n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v)}var w=n.makeTensorInfo(c,"float32",d),k=n.makeTensorInfo(c,"float32",h),S=VN({inputs:{real:w,imag:k},backend:n});return n.disposeIntermediateTensorInfo(w),n.disposeIntermediateTensorInfo(k),S}function fP(e,t,n){var r=fs(e.shape),a=n.data.get(e.dataId),i=n.data.get(a.complexTensorInfos.real.dataId).values,o=n.data.get(a.complexTensorInfos.imag.dataId).values;if(function(e){return 0===(e&e-1)}(r)){var s=mP(i,o,r,t,n),u=[e.shape[0],e.shape[1]];if(t){var c=n.makeTensorInfo(u,"float32",s.real),l=n.makeTensorInfo(u,"float32",s.imag),d=n.makeTensorInfo([],"float32",nh(r,"float32")),h=BN({inputs:{x:d},backend:n}),p=hP.kernelFunc({inputs:{a:c,b:d},backend:n}),f=hP.kernelFunc({inputs:{a:l,b:h},backend:n}),m=n.data.get(p.dataId).values,v=n.data.get(f.dataId).values;return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),{real:m,imag:v}}return s}var g=function(e,t,n){for(var r=new Float32Array(2*t),a=0;a<t;a++){for(var i=0,o=0,s=0;s<t;s++){var u=yw(a*s,t,n),c=mw(e,s);i+=c.real*u.real-c.imag*u.imag,o+=c.real*u.imag+c.imag*u.real}n&&(i/=t,o/=t),vw(r,i,o,a)}return r}(dw(i,o),r,t);return hw(g)}function mP(e,t,n,r,a){if(1===n)return{real:e,imag:t};var i=dw(e,t),o=n/2,s=pw(i),u=s.real,c=s.imag,l=[u.length],d=a.makeTensorInfo(l,"float32",u),h=a.makeTensorInfo(l,"float32",c),p=VN({inputs:{real:d,imag:h},backend:a}),f=fw(i),m=f.real,v=f.imag,g=[m.length],y=a.makeTensorInfo(g,"float32",m),b=a.makeTensorInfo(g,"float32",v),x=VN({inputs:{real:y,imag:b},backend:a}),w=mP(u,c,o,r,a),k=w.real,S=w.imag,T=[k.length],_=a.makeTensorInfo(T,"float32",k),I=a.makeTensorInfo(T,"float32",S),E=VN({inputs:{real:_,imag:I},backend:a}),C=mP(m,v,o,r,a),M=C.real,N=C.imag,R=[M.length],L=a.makeTensorInfo(R,"float32",M),A=a.makeTensorInfo(R,"float32",N),P=VN({inputs:{real:L,imag:A},backend:a}),D=gw(n,r),O=[D.real.length],z=a.makeTensorInfo(O,"float32",D.real),F=a.makeTensorInfo(O,"float32",D.imag),G=VN({inputs:{real:z,imag:F},backend:a}),W=BR({inputs:{a:G,b:P},backend:a}),V=eR({inputs:{a:E,b:W},backend:a}),U=IL({inputs:{a:E,b:W},backend:a}),X=ZN({inputs:{input:V},backend:a}),B=ZN({inputs:{input:U},backend:a}),H=CA({inputs:{input:V},backend:a}),Z=CA({inputs:{input:U},backend:a}),K=NA({inputs:[X,B],backend:a,attrs:{axis:0}}),j=NA({inputs:[H,Z],backend:a,attrs:{axis:0}}),Y=a.data.get(K.dataId).values,Q=a.data.get(j.dataId).values;return a.disposeIntermediateTensorInfo(d),a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(p),a.disposeIntermediateTensorInfo(y),a.disposeIntermediateTensorInfo(b),a.disposeIntermediateTensorInfo(x),a.disposeIntermediateTensorInfo(_),a.disposeIntermediateTensorInfo(I),a.disposeIntermediateTensorInfo(E),a.disposeIntermediateTensorInfo(L),a.disposeIntermediateTensorInfo(A),a.disposeIntermediateTensorInfo(P),a.disposeIntermediateTensorInfo(z),a.disposeIntermediateTensorInfo(F),a.disposeIntermediateTensorInfo(G),a.disposeIntermediateTensorInfo(W),a.disposeIntermediateTensorInfo(V),a.disposeIntermediateTensorInfo(U),a.disposeIntermediateTensorInfo(X),a.disposeIntermediateTensorInfo(H),a.disposeIntermediateTensorInfo(B),a.disposeIntermediateTensorInfo(Z),a.disposeIntermediateTensorInfo(K),a.disposeIntermediateTensorInfo(j),{real:Y,imag:Q}}var vP={kernelName:ic,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.input,a=fs(r.shape),i=r.shape[r.shape.length-1],o=XL({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=pP(o,!1,n),u=XL({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}};function gP(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,i=n.dtype||Ps(a),o=Ts(i,fs(r));return function(e,t,n){e.fill(t)}(o,a),t.makeTensorInfo(r,i,o)}var yP={kernelName:oc,backendName:"cpu",kernelFunc:gP};var bP={kernelName:sc,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=(e.attrs,e.backend),r=t.image,a=n,o=Ss(r.dtype,fs(r.shape)),s=i(r.shape,4),u=s[0],c=s[1],l=s[2],d=s[3],h=a.data.get(r.dataId).values,p=0;p<u;p++)for(var f=p*l*c*d,m=0;m<c;m++)for(var v=m*(l*d),g=0;g<l;g++)for(var y=g*d,b=0;b<d;b++){var x=Math.round(l-g-1),w=f+v+y+b,k=h[w];if(x>=0&&x<l)k=h[f+v+x*d+b];o[w]=k}return{dataId:a.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},xP=WN((function(e,t){return Math.floor(e/t)})),wP=QN(cc,xP,null,"int32"),kP={kernelName:cc,backendName:"cpu",kernelFunc:wP};var SP={kernelName:sd,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,d=r.dilations,h=r.dimRoundingMode,p=r.activation,f=r.leakyreluAlpha,m=LA({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:d,dimRoundingMode:h}});if(o){var v=m;if("NCHW"===l&&1===o.shape.length&&1!==o.shape[0]){var g=XL({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});m=eR({inputs:{a:m,b:g},backend:n}),n.disposeIntermediateTensorInfo(g)}else m=eR({inputs:{a:m,b:o},backend:n});n.disposeIntermediateTensorInfo(v)}if(p){var y=m;if("NCHW"===l&&"prelu"===p&&1===s.shape.length&&1!==s.shape[0]){var b=XL({inputs:{x:s},backend:n,attrs:{shape:[s.shape[0],1,1]}});m=UL(n,m,p,b,f),n.disposeIntermediateTensorInfo(b)}else m=UL(n,m,p,s,f);n.disposeIntermediateTensorInfo(y)}return m}};var TP={kernelName:ud,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,d=r.dilations,h=r.dimRoundingMode,p=r.activation,f=r.leakyreluAlpha,m=jA({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:d,dimRoundingMode:h}});if(o){var v=m;m=eR({inputs:{a:m,b:o},backend:n}),n.disposeIntermediateTensorInfo(v)}if(p){var g=m;m=UL(n,m,p,s,f),n.disposeIntermediateTensorInfo(g)}return m}};var _P={kernelName:hc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,o=fs(r.shape),s=a.shape,u=s[s.length-1],c=i(qf(r,a),4),l=c[0],d=c[1],h=c[2],p=c[3];if(0===d)return n.makeTensorInfo(l,r.dtype,[]);var f=function(e,t,n,r,a,i,o,s,u){for(var c=df([r,i],n),l=0;l<r;l++){for(var d=[],h=0,p=0;p<a;p++){var f=e[l*a+p];h+=f*o[p],d.push(f)}if(h<0||h>=u/i)throw new Error("Invalid indices: ".concat(d," does not index into ").concat(s));for(var m=0;m<i;m++)c.values[l*i+m]=t.get.apply(t,b(t.indexToLoc(h*i+m)))}return c}(n.data.get(a.dataId).values,n.bufferSync(r),r.dtype,d,u,h,p,r.shape,o);return n.makeTensorInfo(l,r.dtype,f.values)}};var IP={kernelName:dc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.indices,o=r.axis,s=r.batchDims;ON([a,i],"gatherV2");for(var u=ws(o,a.shape)[0],c=n.data.get(i.dataId).values,l=a.shape[u],d=function(){var e=c[h];ls(e<=l-1&&e>=0,(function(){return"GatherV2: the index value ".concat(e," is not in [0, ").concat(l-1,"]")}))},h=0;h<c.length;++h)d();var p=s;null==s&&(p=0);var f=fs(i.shape),m=Bw(a,i,u,p),v=XL({inputs:{x:a},backend:n,attrs:{shape:[m.batchSize,m.outerSize,m.dimSize,m.sliceSize]}}),g=XL({inputs:{x:i},backend:n,attrs:{shape:[m.batchSize,f/m.batchSize]}}),y=[m.batchSize,m.outerSize,f/m.batchSize,m.sliceSize],b=n.bufferSync(g),x=function(e,t,n){for(var r=df(n,e.dtype),a=0;a<r.size;++a){var i=r.indexToLoc(a).slice(),o=i[0],s=i[2],u=t.locToIndex([o,s]);i[2]=t.values[u];var c=e.locToIndex(i);0<=c&&c<e.values.length&&(r.values[a]=e.values[c])}return r}(n.bufferSync(v),b,y);return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),n.makeTensorInfo(m.outputShape,x.dtype,x.values)}};var EP={kernelName:vc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.input,a=fs(r.shape),i=r.shape[r.shape.length-1],o=XL({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=pP(o,!0,n),u=XL({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}},CP=aR(yc,(function(e){return Number.isFinite(e)?1:0}),"bool"),MP={kernelName:yc,backendName:"cpu",kernelFunc:CP},NP=aR(bc,(function(e){return Math.abs(e)===1/0?1:0}),"bool"),RP={kernelName:bc,backendName:"cpu",kernelFunc:NP},LP=aR(xc,(function(e){return Number.isNaN(e)?1:0}),"bool"),AP={kernelName:xc,backendName:"cpu",kernelFunc:LP};var PP={kernelName:Tc,backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=function(e,t,n){var r=(t-e)/(n-1),a=Vs(n,"float32");a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+r;return a}(n.start,n.stop,n.num);return t.makeTensorInfo([r.length],"float32",r)}},DP=aR(Ic,(function(e){return Math.log1p(e)})),OP={kernelName:Ic,backendName:"cpu",kernelFunc:DP},zP=WN((function(e,t){return e&&t})),FP=QN(Ec,zP,null,"bool"),GP={kernelName:Ec,backendName:"cpu",kernelFunc:FP},WP=aR(Cc,(function(e){return e?0:1}),"bool"),VP={kernelName:Cc,backendName:"cpu",kernelFunc:WP},UP=WN((function(e,t){return e||t})),XP=QN(Mc,UP,null,"bool"),BP={kernelName:Mc,backendName:"cpu",kernelFunc:XP};var HP={kernelName:Rc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta;ON(a,"LRN");var c=a.shape[3],l=c-1,d=n.data.get(a.dataId).values,h=fs(a.shape),p=new Float32Array(h);function f(e){for(var t=e%c,n=e-t+Math.max(0,t-i),r=e-t+Math.min(t+i,l),a=0;n<=r;n++){var o=d[n];a+=o*o}return a}for(var m=0;m<h;m++){var v=f(m),g=d[m]*Math.pow(o+s*v,-u);p[m]=g}return n.makeTensorInfo(a.shape,a.dtype,p)}};var ZP={kernelName:Lc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta;ON(o,"LRNGrad");for(var d=fs(o.shape),h=o.shape[3],p=n.data.get(o.dataId).values,f=n.data.get(a.dataId).values,m=n.data.get(i.dataId).values,v=new Float32Array(d),g=d,y=0;y<g;y++){for(var b=y%h,x=y-b+Math.max(0,b-s),w=y-b+Math.min(h,b+s+1),k=0,S=x;S<w;S++)k+=Math.pow(f[S],2);k=c*k+u;for(var T=x;T<w;T++){var _=-2*c*l*f[T]*m[y]/k;y===T&&(_+=Math.pow(k,-l)),_*=p[y],v[T]+=_}}return n.makeTensorInfo(o.shape,a.dtype,v)}};function KP(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.reductionIndices,s=r.keepDims,u=n,c=a.shape,l=c.length,d=ws(o,c),h=d,p=Qv(h,l),f=u.data.get(a.dataId).values;if(null!=p){for(var m=new Array(l),v=0;v<m.length;v++)m[v]=c[p[v]];f=QR(f,c,a.dtype,p,m),h=qv(h.length,l),c=m}ON(a,"max"),Yv("max",h,l);var g=i(Kv(c,h),2),y=g[0],b=function(e,t,n,r){for(var a=Ss(r,fs(n)),i=0;i<a.length;++i){for(var o=i*t,s=e[o],u=0;u<t;++u){var c=e[o+u];(Number.isNaN(c)||c>s)&&(s=c)}a[i]=s}return a}(f,fs(g[1]),y,a.dtype),x=u.write(b,y,a.dtype),w=y;return s&&(w=jv(y,d)),{dataId:x,shape:w,dtype:a.dtype}}var jP={kernelName:Ac,backendName:"cpu",kernelFunc:KP};var YP={kernelName:Dc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;ON(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;ls($m(o,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(1,"'")}));var c,l=Xm(a.shape,i,o,1,s,u);if(1===l.filterWidth&&1===l.filterHeight&&ms(l.inShape,l.outShape))c=BN({inputs:{x:a},backend:n});else{var d=n.data.get(a.dataId).values,h=zs(a.shape),p=fA(d,a.shape,a.dtype,h,l,"max");c=n.makeTensorInfo(l.outShape,a.dtype,p.values)}return c}};var QP={kernelName:zc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat;ON(a,"maxPool3d");var l=Bm(a.shape,i,o,1,s,u,c),d=vA(n.data.get(a.dataId).values,a.shape,a.dtype,zs(a.shape),l,"max");return n.makeTensorInfo(d.shape,"float32",d.values)}};var JP={kernelName:Fc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;ON([a,i],"maxPool3DGrad");for(var l=Bm(i.shape,o,s,1,u,c),d=function(e,t){for(var n=df(t.outShape,"int32"),r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,d=t.effectiveFilterWidth,h=t.padInfo.front,p=t.padInfo.top,f=t.padInfo.left,m=0;m<t.batchSize;++m)for(var v=0;v<t.inChannels;++v)for(var g=0;g<t.outDepth;++g){for(var y=g*r-h,b=y;b<0;)b+=o;for(var x=Math.min(t.inDepth,c+y),w=0;w<t.outHeight;++w){for(var k=w*a-p,S=k;S<0;)S+=s;for(var T=Math.min(t.inHeight,l+k),_=0;_<t.outWidth;++_){for(var I=_*i-f,E=I;E<0;)E+=u;for(var C=Math.min(t.inWidth,d+I),M=Number.NEGATIVE_INFINITY,N=-1,R=b;R<x;R+=o)for(var L=R-y,A=S;A<T;A+=s)for(var P=A-k,D=E;D<C;D+=u){var O=D-I,z=e.get(m,R,A,D,v);z>=M&&(M=z,N=L*l*d+P*l+O)}n.set(N,m,g,w,_,v)}}}return n}(n.bufferSync(i),l),h=l.strideDepth,p=l.strideHeight,f=l.strideWidth,m=l.dilationDepth,v=l.dilationHeight,g=l.dilationWidth,y=l.effectiveFilterDepth,b=l.effectiveFilterHeight,x=l.effectiveFilterWidth,w=y-1-l.padInfo.front,k=x-1-l.padInfo.left,S=b-1-l.padInfo.top,T=df(i.shape,"float32"),_=n.bufferSync(a),I=0;I<l.batchSize;++I)for(var E=0;E<l.inChannels;++E)for(var C=0;C<l.inDepth;++C)for(var M=0;M<l.inHeight;++M)for(var N=0;N<l.inWidth;++N){for(var R=C-w,L=M-S,A=N-k,P=0,D=0;D<y;D+=m){var O=(R+D)/h;if(!(O<0||O>=l.outDepth||Math.floor(O)!==O))for(var z=0;z<b;z+=v){var F=(L+z)/p;if(!(F<0||F>=l.outHeight||Math.floor(F)!==F))for(var G=0;G<x;G+=g){var W=(A+G)/f;if(!(W<0||W>=l.outWidth||Math.floor(W)!==W)){var V=y*b*x-1-d.get(I,O,F,W,E)===D*b*x+z*x+G?1:0;if(0!==V)P+=_.get(I,O,F,W,E)*V}}}}T.set(P,I,C,M,N,E)}return n.makeTensorInfo(T.shape,T.dtype,T.values)}};var qP={kernelName:Oc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;ON([i,t.output],"maxPoolGrad");for(var s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,d=Xm(o.shape,s,u,1,c,l),h=n.data.get(o.dataId).values,p=df(d.outShape,o.dtype,mA(h,o.shape,o.dtype,d).values),f=d.strideHeight,m=d.strideWidth,v=d.dilationHeight,g=d.dilationWidth,y=d.effectiveFilterHeight,b=d.effectiveFilterWidth,x=b-1-d.padInfo.left,w=y-1-d.padInfo.top,k=df(o.shape,"float32"),S=n.data.get(a.dataId).values,T=df(a.shape,"float32",S),_=0;_<d.batchSize;++_)for(var I=0;I<d.inChannels;++I)for(var E=0;E<d.inHeight;++E)for(var C=0;C<d.inWidth;++C){for(var M=E-w,N=C-x,R=0,L=0;L<y;L+=v){var A=(M+L)/f;if(!(A<0||A>=d.outHeight||Math.floor(A)!==A))for(var P=0;P<b;P+=g){var D=(N+P)/m;if(!(D<0||D>=d.outWidth||Math.floor(D)!==D)){var O=y*b-1-p.get(_,A,D,I)===L*b+P?1:0;if(0!==O)R+=T.get(_,A,D,I)*O}}}k.set(R,_,E,C,I)}return n.makeTensorInfo(k.shape,k.dtype,k.values)}};var $P={kernelName:Gc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,o=n.filterSize,s=n.strides,u=n.pad,c=n.includeBatchInIndex,l=r;ON(a,"MaxPoolWithArgmax");var d=l.data.get(a.dataId).values,h=Xm(a.shape,o,s,[1,1],u),p=function(e,t,n,r,a){var i=fA(e,0,n,zs(t),a,"max"),o=mA(e,t,n,a,!0,r);return[i.values,o.values]}(d,a.shape,a.dtype,c,h),f=i(p,2),m=f[0],v=f[1],g=l.write(m,h.outShape,a.dtype),y=l.write(v,h.outShape,a.dtype);return[{dataId:g,shape:h.outShape,dtype:a.dtype},{dataId:y,shape:h.outShape,dtype:"int32"}]}};var eD={kernelName:Wc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=ws(i,a.shape),u=fs(Kv(a.shape,s)[1]),c=[],l=n.makeTensorInfo([],"float32",new Float32Array([u]));c.push(l);var d=jN({inputs:{x:a},backend:n,attrs:{dtype:"float32"}});c.push(d);var h=dP({inputs:{a:d,b:l},backend:n});c.push(h);var p=nP({inputs:{x:h},backend:n,attrs:{axis:i,keepDims:o}});return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),p}};var tD={kernelName:Vc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.keepDims;ON(a,"min");var u=ws(o,a.shape),c=u,l=Qv(c,a.shape.length),d=a;null!=l&&(d=JR({inputs:{x:a},backend:n,attrs:{perm:l}}),c=qv(c.length,a.shape.length)),Yv("min",c,d.shape.length);for(var h=i(Kv(d.shape,c),2),p=h[0],f=fs(h[1]),m=Vs(fs(p),d.dtype),v=n.data.get(d.dataId).values,g=0;g<m.length;++g){for(var y=g*f,b=v[y],x=0;x<f;++x){var w=v[y+x];(Number.isNaN(w)||w<b)&&(b=w)}m[g]=b}null!=l&&n.disposeIntermediateTensorInfo(d);var k=n.makeTensorInfo(p,d.dtype,m);if(s){var S=XL({inputs:{x:k},backend:n,attrs:{shape:jv(p,u)}});return n.disposeIntermediateTensorInfo(k),S}return k}};var nD={kernelName:Xc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode;ON(a,"mirrorPad");for(var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]})),u=i.map((function(e){return e[0]})),c=i.map((function(e,t){return e[0]+a.shape[t]})),l="reflect"===o?0:1,d=n.data.get(a.dataId).values,h=a.shape.length,p=zs(a.shape),f=fs(s),m=s.length,v=zs(s),g=Ss(a.dtype,f),y=0;y<f;y++){for(var b=Hs(y,m,v),x=0;x<m;x++)b[x]<u[x]?b[x]=2*u[x]-b[x]-l:b[x]>=c[x]&&(b[x]=2*(c[x]-1)-b[x]+l);b=b.map((function(e,t){return e-u[t]}));var w=Bs(b,h,p);g[y]=d[w]}return{dataId:n.write(g,s,a.dtype),shape:s,dtype:a.dtype}}},rD=WN((function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})),aD=QN(Bc,rD),iD={kernelName:Bc,backendName:"cpu",kernelFunc:aD};function oD(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.dim,o=a.shape.length,s=i;if(-1===s&&(s=o-1),s!==o-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(o," and dim was ").concat(s));var u=ws([s],a.shape),c=KP({inputs:{x:a},backend:n,attrs:{reductionIndices:u,keepDims:!1}}),l=jv(c.shape,u),d=XL({inputs:{x:c},backend:n,attrs:{shape:l}}),h=IL({inputs:{a:a,b:d},backend:n}),p=pR({inputs:{x:h},backend:n}),f=nP({inputs:{x:p},backend:n,attrs:{axis:u,keepDims:!1}}),m=XL({inputs:{x:f},backend:n,attrs:{shape:l}}),v=dP({inputs:{a:p,b:m},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),v}var sD={kernelName:Pl,backendName:"cpu",kernelFunc:oD};var uD={kernelName:Hc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized;ON(a,"multinomial");for(var u=s?a:oD({inputs:{logits:a},backend:n,attrs:{dim:-1}}),c=u.shape[0],l=u.shape[1],d=n.data.get(u.dataId).values,h=[c,i],p=Vs(fs(h),"int32"),f=0;f<c;++f){var m=f*l,v=new Float32Array(l-1);v[0]=d[m];for(var g=1;g<v.length;++g)v[g]=v[g-1]+d[m+g];for(var y=Ty.alea(o.toString()),b=f*i,x=0;x<i;++x){var w=y();p[b+x]=v.length;for(var k=0;k<v.length;k++)if(w<v[k]){p[b+x]=k;break}}}return s||n.disposeIntermediateTensorInfo(u),n.makeTensorInfo(h,"int32",p)}},cD=zb;var lD={kernelName:Yc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold;ON(a,"NonMaxSuppression");var c=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,d=cD(c,l,o,s,u).selectedIndices;return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}},dD=Fb;var hD={kernelName:Qc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize;ON(a,"NonMaxSuppressionPadded");var l=n.data.get(a.dataId).values,d=n.data.get(i.dataId).values,h=dD(l,d,o,s,u,c),p=h.selectedIndices,f=h.validOutputs;return[n.makeTensorInfo([p.length],"int32",new Int32Array(p)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}},pD=Gb;var fD={kernelName:Jc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma;ON(a,"NonMaxSuppressionWithScore");var l=n.data.get(a.dataId).values,d=n.data.get(i.dataId).values,h=pD(l,d,o,s,u,c),p=h.selectedIndices,f=h.selectedScores;return[n.makeTensorInfo([p.length],"int32",new Int32Array(p)),n.makeTensorInfo([f.length],"float32",new Float32Array(f))]}};var mD={kernelName:$c,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.dtype,o=r.depth,s=r.onValue,u=r.offValue;ON(a,"oneHot");var c=fs(a.shape),l=new Float32Array(c*o);l.fill(u);for(var d=n.data.get(a.dataId).values,h=0;h<c;++h)d[h]>=0&&d[h]<o&&(l[h*o+d[h]]=s);return n.makeTensorInfo([].concat(b(a.shape),[o]),i,l)}};function vD(e){var t=e.inputs,n=e.backend,r=t.x;if("string"===r.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===r.dtype){var a=ZN({inputs:{input:r},backend:n}),i=vD({inputs:{x:a},backend:n}),o=CA({inputs:{input:r},backend:n}),s=vD({inputs:{x:o},backend:n}),u=VN({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return gP({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var gD={kernelName:nd,backendName:"cpu",kernelFunc:vD};var yD={kernelName:qc,backendName:"cpu",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===a.dtype){var i=ZN({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=CA({inputs:{input:a},backend:r}),u=vD({inputs:{x:s},backend:r}),c=VN({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return gP({backend:r,attrs:{shape:a.shape,value:1,dtype:a.dtype}})}};function bD(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return uP({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){ds(a,e.shape,"All tensors passed to stack must have matching shapes"),ls(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=t.map((function(e){var t=uP({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),u=NA({inputs:s,backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),u}var xD={kernelName:el,backendName:"cpu",kernelFunc:bD};var wD={kernelName:tl,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.constantValue;ON(a,"pad");var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]})),u=i.map((function(e){return e[0]})),c=n.data.get(a.dataId).values,l=fs(a.shape),d=a.shape.length,h=zs(a.shape),p=fs(s),f=s.length,m=zs(s),v=Ss(a.dtype,p);0!==o&&v.fill(o);for(var g=0;g<l;g++){var y=Hs(g,d,h).map((function(e,t){return e+u[t]}));v[Bs(y,f,m)]=c[g]}return{dataId:n.write(v,s,a.dtype),shape:s,dtype:a.dtype}}},kD=WN((function(e,t){return Math.pow(e,t)})),SD=QN(nl,kD),TD={kernelName:nl,backendName:"cpu",kernelFunc:SD};var _D={kernelName:il,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=(e.attrs,t.paramsNestedSplits),a=t.paramsDenseValues,o=t.indices,s=r.map((function(e){return n.data.get(e.dataId).values})),u=r.map((function(e){return e.shape})),c=n.data.get(a.dataId).values,l=n.data.get(o.dataId).values,d=i(rL(s,u,c,a.shape,a.dtype,l,o.shape),3),h=d[0],p=d[1],f=d[2],m=h.map((function(e){return n.makeTensorInfo([e.length],"int32",e)})),v=n.makeTensorInfo(f,a.dtype,p);return m.concat([v])}};var ID={kernelName:ol,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.shape,o=t.values,s=t.defaultValue,u=t.rowPartitionTensors,c=r.rowPartitionTypes,l=n.data.get(a.dataId).values,d=n.data.get(o.dataId).values,h=n.data.get(s.dataId).values,p=u.map((function(e){return n.data.get(e.dataId).values})),f=u.map((function(e){return e.shape})),m=function(e,t,n,r,a,i,o,s,u,c){return new iL(e,t,n,r,a,i,o,s,u,c).compute()}(l,a.shape,d,o.shape,o.dtype,h,s.shape,p,f,c),v=i(m,2),g=v[0],y=v[1];return n.makeTensorInfo(g,o.dtype,y)}};var ED={kernelName:sl,backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.dtype,o=function(e,t,n,r){if(e===t||e<t&&n<0||t<e&&n>1)return Vs(0,r);var a=Vs(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+n;return a}(r,a,n.step,i);return t.makeTensorInfo([o.length],i,o)}},CD=aR(cl,(function(e){return 1/e})),MD={kernelName:cl,backendName:"cpu",kernelFunc:CD};var ND={kernelName:fl,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,o=r.alignCorners,s=r.halfPixelCenters,u=r.size;ON(a,"resizeBilinear");for(var c=zs(a.shape),l=i(u,2),d=l[0],h=l[1],p=i(a.shape,4),f=p[0],m=p[1],v=p[2],g=p[3],y=n.data.get(a.dataId).values,b=new Float32Array(fs([f,d,h,g])),x=[o&&d>1?m-1:m,o&&h>1?v-1:v],w=[o&&d>1?d-1:d,o&&h>1?h-1:h],k=0,S=x[0]/w[0],T=x[1]/w[1],_=0;_<f;_++)for(var I=0;I<d;I++){var E=void 0;E=s?S*(I+.5)-.5:S*I;for(var C=Math.max(0,Math.floor(E)),M=E-C,N=Math.min(m-1,Math.ceil(E)),R=_*c[0]+C*c[1],L=_*c[0]+N*c[1],A=0;A<h;A++){var P=void 0;P=s?T*(A+.5)-.5:T*A;for(var D=Math.max(0,Math.floor(P)),O=P-D,z=Math.min(v-1,Math.ceil(P)),F=R+D*c[2],G=L+D*c[2],W=R+z*c[2],V=L+z*c[2],U=0;U<g;U++){var X=y[F+U],B=y[G+U],H=X+(y[W+U]-X)*O,Z=H+(B+(y[V+U]-B)*O-H)*M;b[k++]=Z}}}return n.makeTensorInfo([f,d,h,g],"float32",b)}};var RD={kernelName:ml,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,o=t.dy,s=r.alignCorners;ON([o,a],"resizeBilinearGrad");for(var u=zs(a.shape),c=i(a.shape,4),l=c[0],d=c[1],h=c[2],p=c[3],f=i(o.shape,3),m=f[1],v=f[2],g=new Float32Array(l*d*h*p),y=[s&&m>1?d-1:d,s&&v>1?h-1:h],b=[s&&m>1?m-1:m,s&&v>1?v-1:v],x=y[0]/b[0],w=y[1]/b[1],k=n.data.get(o.dataId).values,S=0,T=0;T<l;T++)for(var _=T*u[0],I=0;I<m;I++)for(var E=I*x,C=Math.floor(E),M=Math.min(Math.ceil(E),d-1),N=_+C*u[1],R=_+M*u[1],L=E-C,A=1-L,P=0;P<v;P++)for(var D=P*w,O=Math.floor(D),z=Math.min(Math.ceil(D),h-1),F=D-O,G=1-F,W=N+O*u[2],V=N+z*u[2],U=R+O*u[2],X=R+z*u[2],B=A*G,H=A*F,Z=L*G,K=L*F,j=0;j<p;j++){var Y=k[S++];g[W+j]+=Y*B,g[V+j]+=Y*H,g[U+j]+=Y*Z,g[X+j]+=Y*K}return n.makeTensorInfo([l,h,d,p],"float32",g)}};var LD={kernelName:hl,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,o=r.alignCorners,s=r.halfPixelCenters,u=r.size;ON(a,"resizeNearestNeighbor");for(var c=zs(a.shape),l=i(u,2),d=l[0],h=l[1],p=i(a.shape,4),f=p[0],m=p[1],v=p[2],g=p[3],y=n.data.get(a.dataId).values,b=new Float32Array(f*d*h*g),x=[o&&d>1?m-1:m,o&&h>1?v-1:v],w=[o&&d>1?d-1:d,o&&h>1?h-1:h],k=x[0]/w[0],S=x[1]/w[1],T=0,_=0;_<f;_++)for(var I=_*c[0],E=0;E<d;E++){var C=s?k*(E+.5):k*E,M=Math.min(m-1,o?Math.round(C):Math.floor(C));s&&(M=Math.max(0,M));for(var N=I+M*c[1],R=0;R<h;R++){var L=s?S*(R+.5):S*R,A=Math.min(v-1,o?Math.round(L):Math.floor(L));s&&(A=Math.max(0,A));for(var P=N+A*c[2],D=0;D<g;D++){var O=y[P+D];b[T++]=O}}}return n.makeTensorInfo([f,d,h,g],a.dtype,b)}};var AD={kernelName:pl,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,o=t.dy,s=r.alignCorners;ON([o,a],"resizeNearestNeighborGrad");for(var u=zs(a.shape),c=zs(o.shape),l=i(a.shape,4),d=l[0],h=l[1],p=l[2],f=l[3],m=i(o.shape,3),v=m[1],g=m[2],y=new Float32Array(d*h*p*f),b=n.data.get(o.dataId).values,x=[s&&v>1?h-1:h,s&&g>1?p-1:p],w=[s&&v>1?v-1:v,s&&g>1?g-1:g],k=x[0]/w[0],S=x[1]/w[1],T=1/k,_=1/S,I=2*Math.ceil(T)+2,E=2*Math.ceil(_)+2,C=0;C<d;C++)for(var M=C*u[0],N=0;N<h;N++)for(var R=M+N*u[1],L=Math.floor(N*T),A=Math.floor(L-I/2),P=0;P<p;P++)for(var D=R+P*u[2],O=Math.floor(P*_),z=Math.floor(O-E/2),F=0;F<f;F++){for(var G=0,W=0;W<I;W++){var V=W+A;if(!(V<0||V>=v)){var U=M+V*c[1],X=V*k;if(N===Math.min(h-1,s?Math.round(X):Math.floor(X)))for(var B=0;B<E;B++){var H=B+z;if(!(H<0||H>=g)){var Z=U+H*c[2],K=H*S;P===Math.min(p-1,s?Math.round(K):Math.floor(K))&&(G+=b[Z+F])}}}}y[D+F]=G}return n.makeTensorInfo(a.shape,a.dtype,y)}};var PD={kernelName:gl,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims;ON(a,"reverse");var o=a.shape.length,s=ws(i,a.shape);if(0===o)return BN({inputs:{x:a},backend:n});for(var u=new bh(a.shape,a.dtype),c=n.bufferSync(a),l=function(){var e=u.indexToLoc(d),t=e.slice();s.forEach((function(e){return t[e]=a.shape[e]-1-t[e]})),u.set.apply(u,[c.get.apply(c,b(t))].concat(b(e)))},d=0;d<u.size;d++)l();return n.makeTensorInfo(u.shape,u.dtype,u.values)}},DD={kernelName:id,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,o=n.radians,s=n.fillValue,u=n.center,c=r,l=Ss(a.dtype,fs(a.shape)),d=i(a.shape,4),h=d[0],p=d[1],f=d[2],m=d[3],v=i(Jx(u,p,f),2),g=v[0],y=v[1],b=Math.sin(o),x=Math.cos(o),w=c.data.get(a.dataId).values,k=0;k<h;k++)for(var S=k*f*p*m,T=0;T<p;T++)for(var _=T*(f*m),I=0;I<f;I++)for(var E=I*m,C=0;C<m;C++){var M=[h,T,I,C],N=M[2],R=M[1],L=(N-g)*x-(R-y)*b,A=(N-g)*b+(R-y)*x;L=Math.round(L+g),A=Math.round(A+y);var P=s;if("number"!=typeof s&&(P=3===C?255:s[C]),L>=0&&L<f&&A>=0&&A<p)P=w[S+A*(f*m)+L*m+C];l[S+_+E+C]=P}return{dataId:c.write(l,a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},OD=aR(yl,(function(e){var t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2===0?t:t+1})),zD={kernelName:yl,backendName:"cpu",kernelFunc:OD};var FD={kernelName:xl,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=nm(0,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,d=s.strides,h=s.outputSize,p=dL(n.bufferSync(a),n.bufferSync(i),o,h,l,c,u,d,0,!0);return n.makeTensorInfo(o,p.dtype,p.values)}};function GD(e,t){for(var n=0,r=e.length,a=0;n<r;)e[a=Math.floor((n+r)/2)]<t?n=a+1:r=a;return r}function WD(e,t){for(var n=0,r=e.length,a=0;n<r;)e[a=Math.floor((n+r)/2)]<=t?n=a+1:r=a;return r}var VD={kernelName:wl,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sortedSequence,i=t.values,o=r.side,s=function(e,t,n,r,a,i){for(var o=Ts("int32",n*a),s=0;s<n;++s)for(var u=e.slice(s*r,(s+1)*r),c=s*a,l=0;l<a;++l)o[c+l]="left"===i?GD(u,t[l+c]):WD(u,t[l+c]);return o}(n.data.get(a.dataId).values,n.data.get(i.dataId).values,a.shape[0],a.shape[1],i.shape[1],o);return n.makeTensorInfo(i.shape,"int32",s)}};var UD={kernelName:kl,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e;ON([r,a,i],"select");for(var o=r.shape.length,s=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,l=Rh(a.dtype,i.dtype),d=Vs(fs(a.shape),l),h=0,p=0===o||o>1||1===a.shape.length?1:fs(a.shape.slice(1)),f=0;f<s.length;f++)for(var m=0;m<p;m++)1===s[f]?d[h++]=u[f]:d[h++]=c[f];return n.makeTensorInfo(a.shape,l,d)}},XD=aR(Sl,(function(e){return e>=0?1.0507009873554805*e:1.7580993408473768*(Math.exp(e)-1)})),BD={kernelName:Sl,backendName:"cpu",kernelFunc:XD},HD=aR(El,(function(e){return e<0?-1:e>0?1:0})),ZD={kernelName:El,backendName:"cpu",kernelFunc:HD},KD=aR(_l,(function(e){return Math.sin(e)})),jD={kernelName:_l,backendName:"cpu",kernelFunc:KD},YD=aR(Il,(function(e){return Math.sinh(e)})),QD={kernelName:Il,backendName:"cpu",kernelFunc:YD},JD=Math.log(1.1920928955078125e-7)+2,qD=aR(Ml,(function(e){var t=e>-JD,n=e<JD,r=Math.exp(e);return n?r:t?e:Math.log(1+r)})),$D={kernelName:Ml,backendName:"cpu",kernelFunc:qD};var eO={kernelName:Ll,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings;ON([a],"spaceToBatchND");var s=fs(i),u=[[0,0]];u.push.apply(u,b(o));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=wD.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),d=qx(l.shape,i,s,!1),h=$x(d.length,i.length,!1),p=ew(l.shape,i,s,!1),f=XL({inputs:{x:l},backend:n,attrs:{shape:d}}),m=JR({inputs:{x:f},backend:n,attrs:{perm:h}}),v=XL({inputs:{x:m},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),v}};var tO={kernelName:Dl,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.indices,a=t.values,o=t.denseShape,s=t.defaultValue;if(1!==o.shape.length)throw new Error("Dense shape must be a vector, saw:\n        ".concat(o.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n        ".concat(a.shape));if(0!==s.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(s.shape));var u=n.data.get(r.dataId).values,c=n.data.get(a.dataId).values,l=n.data.get(o.dataId).values,d=n.data.get(s.dataId).values[0],h=function(e,t,n,r,a,i,o){var s=t[0],u=i[0],c=new Array(u),l=new Array(s),d=t[1];if(0===u){if(0!==s)throw new Error(Nw(s));return[Ts(n,0),[0,d],Ts(a,0),c,l]}for(var h=!0,p=0,f=new Array(u).fill(0),m=0;m<s;++m){var v=e[m*d];if(v<0)throw new Error(Rw(m,v));if(v>=u)throw new Error(Lw(m,v,u));++f[v],h=h&&v>=p,p=v}for(var g=!0,y=0;y<u;++y){var b=0===f[y];c[y]=b,g=g&&!b,f[y]=Math.max(f[y],1),y>0&&(f[y]+=f[y-1])}if(g&&h){for(var x=e,w=r,k=0;k<s;++k)l[k]=k;return[x,[s,d],w,c,l]}for(var S=f[u-1],T=Ts(n,S*d),_=Ts(a,S),I=new Array(u).fill(0),E=0;E<s;++E){var C=e[E*d],M=I[C],N=(0===C?0:f[C-1])+M;I[C]++;for(var R=0;R<d;++R)T[N*d+R]=e[E*d+R];_[N]=r[E],l[E]=N}for(var L=0;L<u;++L)if(0===I[L]){var A=0===L?0:f[L-1];T[A*d+0]=L;for(var P=1;P<d;++P)T[A*d+P]=0;_[A]=o}return[T,[S,d],_,c,l]}(u,r.shape,r.dtype,c,a.dtype,l,d),p=i(h,5),f=p[0],m=p[1],v=p[2],g=p[3],y=p[4];return[n.makeTensorInfo(m,r.dtype,f),n.makeTensorInfo([m[0]],a.dtype,v),n.makeTensorInfo([g.length],"bool",new Uint8Array(g.map((function(e){return Number(e)})))),n.makeTensorInfo([y.length],r.dtype,new Int32Array(y))]}};var nO={kernelName:Ol,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.inputIndices,a=t.inputShape,o=t.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape\n        ".concat(a.shape));if(1!==o.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(o.shape));var s=Array.from(n.data.get(a.dataId).values),u=n.data.get(r.dataId).values,c=Array.from(n.data.get(o.dataId).values),l=function(e,t,n,r,a){for(var i=fs(r),o=t[0],s=a.length,u=[],c=1,l=-1,d=0;d<s;++d){var h=a[d];if(-1===h){if(-1!==l)throw new Error(Aw(l,d));l=d,u.push(1)}else{if(h<0)throw new Error(Pw(d,h));c*=h,u.push(h)}}if(-1!==l){if(c<=0)throw new Error("reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero");var p=Math.trunc(i/c);if(c*p!==i)throw new Error(Ow(r,u));u[l]=p}if(fs(u)!==i)throw new Error(zw(r,u));var f=r.length,m=[];if(f>0){m[f-1]=1;for(var v=f-2;v>=0;--v)m[v]=m[v+1]*r[v+1]}var g=[];if(s>0){g[s-1]=1;for(var y=s-2;y>=0;--y)g[y]=g[y+1]*u[y+1]}for(var b=Ts(n,o*s),x=0;x<o;++x){for(var w=0,k=0;k<f;++k)w+=e[x*f+k]*m[k];for(var S=0;S<s;++S)b[x*s+S]=Math.trunc(w/g[S]),w%=g[S]}return[b,[o,s],u]}(u,r.shape,r.dtype,s,c),d=i(l,3),h=d[0],p=d[1],f=d[2];return[n.makeTensorInfo(p,r.dtype,h),n.makeTensorInfo([f.length],o.dtype,new Int32Array(f))]}};var rO={kernelName:zl,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,o=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n          ".concat(a.shape));if(1!==o.shape.length)throw new Error("Segment ids should be a vector but received shape\n          ".concat(o.shape));if(a.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");var s=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,c=n.data.get(o.dataId).values,l=i(vL(s,r.shape,r.dtype,u,c,!0),2),d=l[0],h=l[1];return n.makeTensorInfo(h,r.dtype,d)}};var aO={kernelName:Fl,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,o=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n         ".concat(a.shape));if(1!==o.shape.length)throw new Error("Segment ids should be a vector but received shape\n         ".concat(o.shape));if(a.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");var s=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,c=n.data.get(o.dataId).values,l=i(vL(s,r.shape,r.dtype,u,c),2),d=l[0],h=l[1];return n.makeTensorInfo(h,r.dtype,d)}};var iO={kernelName:Gl,backendName:"cpu",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.sparseIndices,o=n.sparseValues,s=n.defaultValue,u=a.outputShape,c=nm(0,i,u),l=c.sliceRank,d=c.numUpdates,h=c.sliceSize,p=c.strides,f=c.outputSize,m=!1,v=r.bufferSync(i);switch(o.dtype){case"bool":t=dL(v,r.bufferSync(o),u,f,h,d,l,p,Boolean(r.data.get(s.dataId).values[0]),m);break;case"float32":t=dL(v,r.bufferSync(o),u,f,h,d,l,p,r.data.get(s.dataId).values[0],m);break;case"int32":t=dL(v,r.bufferSync(o),u,f,h,d,l,p,r.data.get(s.dataId).values[0],m);break;case"string":t=dL(v,r.bufferSync(o),u,f,h,d,l,p,sh(r.data.get(s.dataId).values[0]),m);break;default:throw new Error("Unsupported type ".concat(o.dtype))}return r.makeTensorInfo(u,t.dtype,t.values)}};var oO={kernelName:Al,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.numOrSizeSplits,o=ws(r.axis,a.shape)[0],s=Mw(a,i,o),u=new Array(a.shape.length).fill(0),c=a.shape.slice();return s.map((function(e){var t=b(c);t[o]=e;var r=fL({inputs:{x:a},backend:n,attrs:{begin:u,size:t}});return u[o]+=e,r}))}},sO={kernelName:Vl,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n;ON(r,"square");for(var i=a.data.get(r.dataId).values,o=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];o[s]=u*u}return{dataId:a.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},uO=aR(rd,(function(e,t){var n=t;return isNaN(e)?NaN:e>0?1:n.alpha})),cO={kernelName:rd,backendName:"cpu",kernelFunc:uO};var lO={kernelName:Ul,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.end,s=r.strides,u=r.beginMask,c=r.endMask,l=r.ellipsisMask,d=r.newAxisMask,h=r.shrinkAxisMask;ON(a,"stridedSlice");var p,f=bm(a.shape,i,o,s,u,c,l,d,h),m=f.finalShapeSparse,v=f.finalShape,g=f.isIdentity,y=f.sliceDim0,x=f.isSimpleSlice,w=f.begin,k=f.end,S=f.strides;if(g)p=XL({inputs:{x:a},backend:n,attrs:{shape:v}});else if(y||x){ls(a.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(a.shape.length)}));var T=sm(w,k,S),_=fL({inputs:{x:a},backend:n,attrs:{begin:w,size:T}});p=XL({inputs:{x:_},backend:n,attrs:{shape:v}}),n.disposeIntermediateTensorInfo(_)}else{var I=function(e,t,n,r){for(var a=df(e,t.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*n[u]+r[u];a.set.apply(a,[t.get.apply(t,s)].concat(b(o)))}return a}(m,n.bufferSync(a),S,w);p=n.makeTensorInfo(v,I.dtype,I.values)}return p}};var dO={kernelName:Xl,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=r.separator,o=r.nGramWidths,s=r.leftPad,u=r.rightPad,c=r.padWidth,l=r.preserveShortSequences,d=t.data,h=t.dataSplits,p=function(e,t,n,r,a,i,o,s){return new kL(n,r,a,i,o,s).compute(e,t)}(n.data.get(d.dataId).values,n.data.get(h.dataId).values,a,o,s,u,c,l),f=i(p,2),m=f[0],v=f[1];return[n.makeTensorInfo([m.length],"string",m),n.makeTensorInfo(h.shape,"int32",v)]}};var hO={kernelName:Bl,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.skipEmpty,a=t.input,o=t.delimiter;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(1!==a.shape.length)throw new Error("Input must be a vector, got shape: ".concat(a.shape));if(0!==o.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(o.shape));var s=function(e,t,n){for(var r=e.length,a=[],i=0,o=0,s=new Array(r),u=0;u<r;++u){var c=a.length;SL(e[u],t,n,a);var l=a.length-c;s[u]=l,i+=l,o=Math.max(o,l)}for(var d=Ts("int32",2*i),h=new Array(i),p=[r,o],f=0,m=0;m<r;++m)for(var v=0;v<s[m];++v)d[2*f]=m,d[2*f+1]=v,h[f]=a[f],++f;return[d,h,p]}(n.data.get(a.dataId).values,n.data.get(o.dataId).values[0],r),u=i(s,3),c=u[0],l=u[1],d=u[2],h=l.length;return[n.makeTensorInfo([h,2],"int32",c),n.makeTensorInfo([h],"string",l),n.makeTensorInfo([2],"int32",new Int32Array(d))]}};var pO={kernelName:Hl,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.numBuckets,a=t.input;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");var i=function(e,t){for(var n=Ts("int32",e.length),r=0;r<e.length;++r)n[r]=th(e[r]).modulo(t).getLowBitsUnsigned();return n}(n.data.get(a.dataId).values,r);return n.makeTensorInfo(a.shape,"int32",i)}},fO=aR(Kl,(function(e){return Math.tan(e)})),mO={kernelName:Kl,backendName:"cpu",kernelFunc:fO},vO=aR(jl,(function(e){return Math.tanh(e)}));var gO={kernelName:Yl,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;ON(a,"tile");var o=function(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];for(var a=df(n,e.dtype),i=0;i<a.values.length;++i){for(var o=a.indexToLoc(i),s=new Array(e.rank),u=0;u<s.length;u++)s[u]=o[u]%e.shape[u];var c=e.locToIndex(s);a.values[i]=e.values[c]}return a}(n.bufferSync(a),i);return n.makeTensorInfo(o.shape,o.dtype,o.values)}};var yO={kernelName:Ql,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.k,s=r.sorted;ON(a,"topk");var u=i(NL(n.data.get(a.dataId).values,a.shape,a.dtype,o,s),2),c=u[0],l=u[1];return[n.makeTensorInfo(c.shape,c.dtype,c.values),n.makeTensorInfo(l.shape,l.dtype,l.values)]}};var bO={kernelName:Jl,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,o=t.transforms,s=n.interpolation,u=n.fillMode,c=n.fillValue,l=n.outputShape,d=i(a.shape,4),h=d[0],p=d[1],f=d[2],m=d[3],v=i(null!==l&&void 0!==l?l:[p,f],2),g=v[0],y=v[1],b=[h,g,y,m],x=zs(a.shape),w=x[0],k=x[1],S=x[2],T=zs(b),_=T[0],I=T[1],E=T[2],C=Ss(a.dtype,fs(b));C.fill(c);for(var M=r.data.get(a.dataId).values,N=r.data.get(o.dataId).values,R=0;R<h;++R){for(var L=1===o.shape[0]?N:N.subarray(8*R,8*R+8),A=0;A<g;++A)for(var P=0;P<y;++P)for(var D=0;D<m;++D){var O=void 0,z=L[6]*P+L[7]*A+1;if(0!==z){var F=(L[0]*P+L[1]*A+L[2])/z,G=(L[3]*P+L[4]*A+L[5])/z,W=xO(F,f,u),V=xO(G,p,u);switch(s){case"nearest":O=kO(M,p,f,w,k,S,R,V,W,D,c);break;case"bilinear":O=SO(M,p,f,w,k,S,R,V,W,D,c);break;default:throw new Error("Error in Transform: Expect 'nearest' or 'bilinear', but got ".concat(s))}C[R*_+A*I+P*E+D]=O}}return r.makeTensorInfo(b,a.dtype,C)}return{dataId:r.write(C,b,a.dtype),shape:a.shape,dtype:a.dtype}}};function xO(e,t,n){switch(n){case"reflect":return function(e,t){var n=e;if(n<0)if(t<=1)n=0;else{var r=2*t;n<r&&(n=r*Math.trunc(-n/r)+n),n=n<-t?n+r:-n-1}else if(n>t-1)if(t<=1)n=0;else{var a=2*t;(n-=a*Math.trunc(n/a))>=t&&(n=a-n-1)}return os(0,n,t-1)}(e,t);case"wrap":return function(e,t){var n=e;if(n<0)if(t<=1)n=0;else{var r=t-1;n+=t*(Math.trunc(-n/r)+1)}else if(n>t-1)if(t<=1)n=0;else{var a=t-1;n-=t*Math.trunc(n/a)}return os(0,n,t-1)}(e,t);case"nearest":return function(e,t){return os(0,e,t-1)}(e,t);default:return function(e,t){return e}(e)}}function wO(e,t,n,r,a,i,o,s,u,c,l){return 0<=s&&s<t&&0<=u&&u<n?e[o*r+s*a+u*i+c]:l}function kO(e,t,n,r,a,i,o,s,u,c,l){return wO(e,t,n,r,a,i,o,Math.round(s),Math.round(u),c,l)}function SO(e,t,n,r,a,i,o,s,u,c,l){var d=Math.floor(s),h=Math.floor(u),p=d+1,f=h+1;return(p-s)*((f-u)*wO(e,t,n,r,a,i,o,d,h,c,l)+(u-h)*wO(e,t,n,r,a,i,o,d,f,c,l))+(s-d)*((f-u)*wO(e,t,n,r,a,i,o,p,h,c,l)+(u-h)*wO(e,t,n,r,a,i,o,p,f,c,l))}var TO={kernelName:$l,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;ON(i,"unique");var o=function(e,t,n,r){for(var a=ws(t,n)[0],i=[1,n[0],1],o=0;o<a;o++)i[0]*=n[o];i[1]=n[a];for(var s=a+1;s<n.length;s++)i[2]*=n[s];for(var u={},c=new Int32Array(n[a]),l=new bh(i,r,e),d=[],h=1===i[0]&&1===i[2],p=0;p<n[a];p++){var f=void 0;if(h)f=e[p].toString();else{for(var m=[],v=0;v<i[0];v++)for(var g=0;g<i[2];g++)m.push(l.get(v,p,g));f=m.join(",")}if(void 0!==u[f])c[p]=u[f];else{var y=Object.keys(u).length;u[f]=y,c[p]=y,d.push(p)}}var b=i.slice();b[1]=Object.keys(u).length;var x=new bh(b,r);d.forEach((function(e,t){for(var n=0;n<i[0];n++)for(var r=0;r<i[2];r++)x.set(l.get(n,e,r),n,t,r)}));var w=n.slice();return w[a]=b[1],{outputValues:x.values,outputShape:w,indices:c}}(r.data.get(i.dataId).values,a,i.shape,i.dtype),s=o.outputValues,u=o.outputShape,c=o.indices;return[r.makeTensorInfo(u,i.dtype,s),r.makeTensorInfo([c.length],"int32",c)]}};var _O={kernelName:ed,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a.shape.length,s=a.shape[i],u=new Array(o-1),c=0,l=0;l<o;l++)l!==i&&(u[c++]=a.shape[l]);var d=new Array(o).fill(0),h=a.shape.slice();h[i]=1;for(var p=new Array(s),f=0;f<p.length;f++){d[i]=f;var m=fL({inputs:{x:a},backend:n,attrs:{begin:d,size:h}});p[f]=XL({inputs:{x:m},backend:n,attrs:{shape:u}}),n.disposeIntermediateTensorInfo(m)}return p}};for(var IO={kernelName:td,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.segmentIds,o=r.numSegments;ON(a,"unsortedSegmentSum");for(var s=[],u=[],c=a.shape.length-i.shape.length,l=i,d=0;d<c;++d){var h=uP({inputs:{input:l},backend:n,attrs:{dim:d+1}});l=h,u.push(h)}for(var p=0;p<o;++p){var f=nh(p,"int32"),m=n.makeTensorInfo([],"int32",f),v=lR({inputs:{a:m,b:l},backend:n}),g=jN({inputs:{x:v},backend:n,attrs:{dtype:"float32"}}),y=BR({inputs:{a:g,b:a},backend:n}),b=nP({inputs:{x:y},backend:n,attrs:{axis:0,keepDims:!1}});s.push(b),u.push(m),u.push(v),u.push(g),u.push(y),u.push(b)}var x=bD({inputs:s,backend:n,attrs:{axis:0}});return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),x}},EO=0,CO=[KL,GN,YL,JL,tR,qL,$L,eA,tA,nA,aA,oA,uA,dA,pA,gA,yA,bA,xA,ZL,wA,kA,SA,TA,YN,uR,IA,UN,EA,RA,AA,PA,DA,OA,zA,FA,WA,UA,XA,BA,HA,ZA,KA,YA,QA,JA,qA,$A,eP,tP,aP,LL,iP,dR,sP,fR,cP,gR,vP,yP,bP,xR,kP,SP,TP,_P,IP,SR,IR,HN,EP,MA,MP,RP,AP,PL,MR,LR,PP,DR,OP,GP,VP,BP,HP,ZP,jP,FR,YP,QP,JP,qP,$P,eD,tD,VR,nD,iD,uD,HR,ZR,lD,hD,fD,YR,mD,yD,xD,wD,TD,zL,$R,_D,ID,ED,KN,hP,MD,GL,VL,BL,ND,RD,LD,AD,PD,DD,zD,lL,FD,VD,UD,BD,pL,ZD,jD,QD,mL,sD,$D,eO,tO,nO,rO,aO,iO,oO,yL,sO,wL,cO,lO,dO,hO,pO,EL,rP,mO,{kernelName:jl,backendName:"cpu",kernelFunc:vO},gO,yO,bO,qR,TO,_O,IO,gD];EO<CO.length;EO++){md(CO[EO])}var MO,NO,RO,LO={},AO={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function PO(e,t){if(!(e in LO)||null!=t){var n=function(e,t){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var n=null!==t&&void 0!==t?t:function(e){if(typeof OffscreenCanvas<"u"&&2===e)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return n.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete LO[e]}),!1),Qs().getBool("SOFTWARE_WEBGL_ENABLED")&&(AO.failIfMajorPerformanceCaveat=!1),1===e?n.getContext("webgl",AO)||n.getContext("experimental-webgl",AO):n.getContext("webgl2",AO)}(e,t);if(null===n)return console.log("Could not get context for WebGL version",e),null;LO[e]=n}var r=LO[e];return null==r||r.isContextLost()?(delete LO[e],PO(e)):(r.disable(r.DEPTH_TEST),r.disable(r.STENCIL_TEST),r.disable(r.BLEND),r.disable(r.DITHER),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SAMPLE_COVERAGE),r.enable(r.SCISSOR_TEST),r.enable(r.CULL_FACE),r.cullFace(r.BACK),LO[e])}function DO(e,t){return[t,e]}function OO(e){var t=fs(e);return gs(Math.ceil(t/4))}function zO(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function FO(e,t){var n,r,a,i,o,s,u,c,l,d,h=e;return 2===Qs().getNumber("WEBGL_VERSION")?(n=h.R32F,r=h.R16F,a=h.RGBA16F,i=h.RGBA32F,o=h.RED,u=4,c=1,l=h.HALF_FLOAT,d=h.FLOAT,s=h.RGBA8):(n=e.RGBA,r=e.RGBA,a=e.RGBA,i=h.RGBA,o=e.RGBA,u=4,c=4,l=null!=t?t.HALF_FLOAT_OES:null,d=e.FLOAT,s=e.RGBA),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:i,textureFormatFloat:o,downloadTextureFormat:s,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:l,textureTypeFloat:d}}function GO(e,t){var n=t();return Qs().getBool("DEBUG")&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(t)}}(e,t))}(e),n}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(MO||(MO={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(NO||(NO={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(RO||(RO={}));function WO(e){return!!(Qs().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function VO(e,t){return qO(e,(function(){return e.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')}var UO,XO,BO=/ERROR: [0-9]+:([0-9]+):/g;function HO(e,t){var n=BO.exec(t);if(null==n)return console.log("Couldn't parse line number in error: ".concat(t)),void console.log(e);for(var r=+n[1],a=e.split("\n"),i=a.length.toString().length+2,o=a.map((function(e,t){return ys((t+1).toString(),i)+e})),s=0,u=0;u<o.length;u++)s=Math.max(o[u].length,s);var c=o.slice(0,r-1),l=o.slice(r-1,r),d=o.slice(r);console.log(c.join("\n")),console.log(t.split("\n")[0]),console.log("%c ".concat(ys(l[0],s)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(d.join("\n"))}function ZO(e,t){if(GO(e,(function(){return e.validateProgram(t)})),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function KO(e,t,n,r,a,i,o){var s=e.getAttribLocation(t,n);return-1!==s&&(GO(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),GO(e,(function(){return e.vertexAttribPointer(s,a,e.FLOAT,!1,i,o)})),GO(e,(function(){return e.enableVertexAttribArray(s)})),!0)}function jO(e,t,n){(function(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n){var a="[gl.TEXTURE0, gl.TEXTURE".concat(n,"]");throw new Error("textureUnit must be in ".concat(a,"."))}})(e,n),GO(e,(function(){return e.activeTexture(e.TEXTURE0+n)})),GO(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)}))}function YO(e,t,n){GO(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),GO(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}))}function QO(e,t){GO(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)})),GO(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function JO(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(t)}}(e,t))}function qO(e,t,n){var r=GO(e,(function(){return t()}));if(null==r)throw new Error(n);return r}function $O(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return fs(e.slice(0,e.length-t))}function ez(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function tz(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[$O(e)].concat(b(ez(e)))),t}function nz(e){return e%2===0}function rz(e,t){if(ms(e=e.slice(-2),t=t.slice(-2))||!e.length||!t.length||0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r||nz(n)&&nz(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&nz(e[0])&&nz(t[0])}function az(e,t){return null!=e.getExtension(t)}function iz(e){try{if(null!=PO(e))return!0}catch(KZ){return console.log("Error when getting WebGL context: ",KZ),!1}return!1}function oz(e){if(0===e)return!1;var t=PO(e);if(1!==e){if(az(t,"EXT_color_buffer_float"))return sz(t);var n="EXT_color_buffer_half_float";if(az(t,n)){var r=t.getExtension(n);return function(e,t){var n=FO(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);var a=1,i=1;e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,a,i,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var o=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var s=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(o),s}(t,r)}return!1}return!(!az(t,"OES_texture_float")||!az(t,"WEBGL_color_buffer_float"))&&sz(t)}function sz(e){var t=FO(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function uz(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&ls("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors in the WebGL backend.")}))}))}var cz=Qs();function lz(){var e,t,n,r,a,i,o,s,u,c;return 2===Qs().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",i="outputColor",o="out vec4 outputColor;",s=Qs().getBool("WEBGL2_ISNAN_CUSTOM")?"\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ":"",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",i="gl_FragColor",o="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function dz(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=zs(t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / ").concat(t),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * ").concat(t):"index -= ".concat(e[a]," * ").concat(t);return"".concat(i,"; ").concat(o,";")})).join("")}function hz(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=zs(t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / outShapeStrides[").concat(a,"]"),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * outShapeStrides[").concat(a,"]"):"index -= ".concat(e[a]," * outShapeStrides[").concat(a,"]");return"".concat(i,"; ").concat(o,";")})).join("")}function pz(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=e.map((function(e,t){return t})),a=function(e,t){var n=e.length,r=e.map((function(e){return"".concat(t,"[").concat(e,"]")})),a=new Array(n-1);a[n-2]=r[n-1];for(var i=n-3;i>=0;--i)a[i]="(".concat(a[i+1]," * ").concat(r[i+1],")");return a}(r,t);return a.map((function(t,r){var i="int ".concat(e[r]," = ").concat(n," / ").concat(a[r]),o=r===a.length-1?"int ".concat(e[r+1]," = ").concat(n," - ").concat(e[r]," * ").concat(a[r]):"index -= ".concat(e[r]," * ").concat(a[r]);return"".concat(i,"; ").concat(o,";")})).join("")}function fz(e){var t=zs(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ".concat(t[0]," + coords.y * ").concat(t[1]," + coords.z;\n  }\n")}cz.registerFlag("HAS_WEBGL",(function(){return cz.getNumber("WEBGL_VERSION")>0})),cz.registerFlag("WEBGL_VERSION",(function(){return iz(2)?2:iz(1)?1:0})),cz.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(function(){return!1})),cz.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===cz.get("WEBGL_VERSION")})),cz.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),cz.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),cz.registerFlag("WEBGL_PACK",(function(){return cz.getBool("HAS_WEBGL")})),cz.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return cz.getBool("WEBGL_PACK")})),cz.registerFlag("WEBGL_PACK_CLIP",(function(){return cz.getBool("WEBGL_PACK")})),cz.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return cz.getBool("WEBGL_PACK")})),cz.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return cz.getBool("WEBGL_PACK")})),cz.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return cz.getBool("WEBGL_PACK")})),cz.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return cz.getBool("WEBGL_PACK")})),cz.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return cz.getBool("WEBGL_PACK")})),cz.registerFlag("WEBGL_PACK_REDUCE",(function(){return cz.getBool("WEBGL_PACK")})),cz.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return cz.getBool("WEBGL_PACK")})),cz.registerFlag("WEBGL_CONV_IM2COL",(function(){return cz.getBool("WEBGL_PACK")})),cz.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return function(e){if(null==UO){var t=PO(e);UO=t.getParameter(t.MAX_TEXTURE_SIZE)}return UO}(cz.getNumber("WEBGL_VERSION"))})),cz.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return function(e){if(null==XO){var t=PO(e);XO=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,XO)}(cz.getNumber("WEBGL_VERSION"))})),cz.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=cz.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;var t=PO(e);return az(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:az(t,"EXT_disjoint_timer_query")?1:0}(e)})),cz.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return cz.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Zh()})),cz.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return function(e){if(0===e)return!1;var t=PO(e);if(1===e){if(!az(t,"OES_texture_float"))return!1}else if(!az(t,"EXT_color_buffer_float"))return!1;return sz(t)}(cz.getNumber("WEBGL_VERSION"))})),cz.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!cz.getBool("WEBGL_FORCE_F16_TEXTURES")&&cz.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),cz.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return oz(cz.getNumber("WEBGL_VERSION"))})),cz.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return function(e){return 2===e&&null!=PO(e).fenceSync}(cz.getNumber("WEBGL_VERSION"))})),cz.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return cz.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),cz.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(function(){return-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ".concat(e,"."))})),cz.registerFlag("WEBGL_FLUSH_THRESHOLD",(function(){return Zh()?1:-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ".concat(e,"."))})),cz.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(function(){return 128})),cz.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",(function(){return!1})),cz.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",(function(){return 1e5})),cz.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",(function(){return 128})),cz.registerFlag("WEBGL_EXP_CONV",(function(){return!1})),cz.registerFlag("SOFTWARE_WEBGL_ENABLED",(function(){return cz.getBool("IS_TEST")})),cz.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",(function(){return 1/0})),cz.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",(function(){return!1})),cz.registerFlag("WEBGL2_ISNAN_CUSTOM",(function(){return!1}));var mz="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",vz=jw.getBroadcastDims;function gz(e,t,n){var r=[];if(e.forEach((function(e){var t=fs(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform?r.push("uniform float ".concat(e.name).concat(t>1?"[".concat(t,"]"):"",";")):(r.push("uniform sampler2D ".concat(e.name,";")),r.push("uniform int offset".concat(e.name,";"))),n.enableShapeUniforms){switch(Ez(n.packedInputs,e.shapeInfo.logicalShape,e.shapeInfo.texShape).uniformShape.length){case 1:r.push("uniform int ".concat(e.name,"Shape;"));break;case 2:r.push("uniform ivec2 ".concat(e.name,"Shape;"));break;case 3:r.push("uniform ivec3 ".concat(e.name,"Shape;"));break;case 4:r.push("uniform ivec4 ".concat(e.name,"Shape;"))}r.push("uniform ivec2 ".concat(e.name,"TexShape;"))}})),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;")}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach((function(e){r.push("uniform ".concat(e.type," ").concat(e.name).concat(e.arrayIndex?"[".concat(e.arrayIndex,"]"):"",";"))}));var a,i,o=r.join("\n"),s=e.map((function(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,a="";a+=n?bz(e,r):yz(e,r);var i=e.shapeInfo.logicalShape,o=t.logicalShape;return i.length<=o.length&&(a+=n?function(e,t){var n,r=e.name,a=r.charAt(0).toUpperCase()+r.slice(1),i="get"+a+"AtOutCoords",o=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,u=vz(e.shapeInfo.logicalShape,t.logicalShape),c=Iz(s),l=s-o,d=["x","y","z","w","u","v"];n=0===o?"":s<2&&u.length>=1?"coords = 0;":u.map((function(e){return"coords.".concat(d[e+l]," = 0;")})).join("\n");var h="";h=s<2&&o>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(d[t+l])})).join(", ");var p="return outputValue;",f=1===fs(e.shapeInfo.logicalShape),m=1===fs(t.logicalShape);if(1!==o||f||m){if(f&&!m)p=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){var v=o-2,g=o-1;u.indexOf(v)>-1&&u.indexOf(g)>-1?p="return vec4(outputValue.x);":u.indexOf(v)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(g)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}}else p="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 ".concat(i,"() {\n      ").concat(c," coords = getOutputCoords();\n      ").concat(n,"\n      vec4 outputValue = get").concat(a,"(").concat(h,");\n      ").concat(p,"\n    }\n  ")}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",i=t.texShape,o=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===u&&null==e.shapeInfo.flatOffset&&ms(o,i))return"\n      float ".concat(a,"() {\n        return sampleTexture(").concat(n,", resultUV);\n      }\n    ");var c,l=Iz(u),d=vz(e.shapeInfo.logicalShape,t.logicalShape),h=u-s,p=["x","y","z","w","u","v"];c=0===s?"":u<2&&d.length>=1?"coords = 0;":d.map((function(e){return"coords.".concat(p[e+h]," = 0;")})).join("\n");var f="";return f=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(p[t+h])})).join(", "),"\n    float ".concat(a,"() {\n      ").concat(l," coords = getOutputCoords();\n      ").concat(c,"\n      return get").concat(r,"(").concat(f,");\n    }\n  ")}(e,t)),a}(e,t,n.packedInputs,n.enableShapeUniforms)})).join("\n"),u=t.texShape,c=lz(),l=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ".concat(e.texture2D,"(textureSampler, uv).r;\n    }\n  ")}(c),d=function(e){return"".concat(e.version,"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ").concat(e.varyingFs," vec2 resultUV;\n    ").concat(e.defineOutput,"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ").concat(e.defineSpecialNaN,"\n    ").concat(e.defineSpecialInf,"\n    ").concat(e.defineRound,"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ").concat(xz,"\n    ").concat(wz,"\n    ").concat(kz,"\n  ")}(c);return t.isPacked?(a=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===r[0]?n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ".concat(r[1],".0);\n      }\n    "):1===r[1]?n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ".concat(r[0],".0);\n      }\n    "):n?"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      return 2 * (resTexRC.x * ").concat(r[1]," + resTexRC.y);\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(ms(e,t))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(".concat(r[0],", ").concat(r[1],"));\n      }\n    ");var a=Math.ceil(e[1]/2);return n?"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[2]/2),i=a*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ")}(e,t,n);default:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";for(var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[e.length-1]/2),i=a*Math.ceil(e[e.length-2]/2),o=i,s="",u="b, r, c",c=2;c<e.length-1;c++)o*=e[e.length-c-1],s="\n      int b".concat(c," = index / ").concat(o,";\n      index -= b").concat(c," * ").concat(o,";\n    ")+s,u="b".concat(c,", ")+u;return"\n    ivec".concat(e.length," getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(").concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      ").concat(s,"\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec").concat(e.length,"(").concat(u,");\n    }\n  ")}(e,t,n)}}(t.logicalShape,u,n.enableShapeUniforms),i=function(e){return"\n    void setOutput(vec4 val) {\n      ".concat(e.output," = val;\n    }\n  ")}(c)):(a=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){return 1===t[0]?n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.x * ".concat(t[1],".0);\n      }\n    "):1===t[1]?n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.y * ".concat(t[0],".0);\n      }\n    "):n?"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      return resTexRC.x * ").concat(t[1]," + resTexRC.y;\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){return ms(e,t)?n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(".concat(t[0],", ").concat(t[1],"));\n      }\n    "):1===e[1]?n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    "):1===e[0]?n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(0, index);\n      }\n    "):n?"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      int r = index / ").concat(e[1],";\n      int c = index - r * ").concat(e[1],";\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n)return"\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ".concat(hz(["r","c","d"],e),"\n    return ivec3(r, c, d);\n  }\n");var r=dz(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(r,"\n      return ivec3(r, c, d);\n    }\n  ")}(e,t,n);case 4:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ".concat(hz(["r","c","d","d2"],e),"\n      return ivec4(r, c, d, d2);\n    }\n  ");var r=dz(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(r,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}(e,t,n);case 5:return function(e,t){var n=dz(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(".concat(t[0],",\n                             ").concat(t[1],"));\n\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ")}(e,t);case 6:return function(e,t){var n=dz(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ")}(e,t);default:throw new Error("".concat(e.length,"-D output sampling is not yet supported"))}}(t.logicalShape,u,n.enableShapeUniforms),i=function(e){return"\n    void setOutput(float val) {\n      ".concat(e.output," = vec4(val, 0, 0, 0);\n    }\n  ")}(c)),n.packedInputs&&(d+=Sz),[d,l,i,o,a,s,n.userCode].join("\n")}function yz(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.shapeInfo.logicalShape;switch(n.length){case 0:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"float ".concat(r,"() {return ").concat(n,";}");var a=i(e.shapeInfo.texShape,2),o=a[0],s=a[1];if(1===o&&1===s)return"\n      float ".concat(r,"() {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");var u=Tz(n);if(t)return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], ").concat(u,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");var c=i(e.shapeInfo.texShape,2),l=c[0],d=c[1];return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(l,", ").concat(d,", ").concat(u,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e,t);case 1:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int index) {\n        ").concat(_z(e),"\n      }\n    ");var a=e.shapeInfo.texShape,i=a[0],o=a[1];if(1===o&&1===i)return"\n      float ".concat(r,"(int index) {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");var s=Tz(n);return 1===o?t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[0]));\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / ").concat(i,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):1===i?t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / ").concat(o,".0, 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):t?"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  "):"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(i,", ").concat(o,", index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape;if(null!=i&&ms(n,i)){if(t)return"\n      float ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");var o=i[0],s=i[1];return"\n    float ".concat(a,"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}var u=ks(n),c=u.newShape,l=u.keptDims,d=c;if(d.length<n.length){var h=Cz(e,d),p=["row","col"];return"\n      ".concat(yz(h,t),"\n      float ").concat(a,"(int row, int col) {\n        return ").concat(a,"(").concat(Mz(p,l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(").concat(n[1],", 1)));\n        ").concat(_z(e),"\n      }\n    ");var f=i[0],m=i[1],v=Tz(r);return 1===m?t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(").concat(r,"TexShape[0]));\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ").concat(f,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):1===f?t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(").concat(r,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2((index + 0.5) / ").concat(m,".0, 0.5);\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):t?"\n      float ".concat(a,"(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(r,"Shape[1] + col + ").concat(v,";\n        vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n  float ".concat(a,"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ").concat(n[1]," + col + ").concat(v,";\n    vec2 uv = uvFromFlat(").concat(f,", ").concat(m,", index);\n    return sampleTexture(").concat(r,", uv);\n  }\n")}(e,t);case 3:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[1]*n[2],o=n[2],s=ks(n),u=s.newShape,c=s.keptDims,l=u;if(l.length<n.length){var d=Cz(e,l),h=["row","col","depth"];return"\n        ".concat(yz(d,t),"\n        float ").concat(a,"(int row, int col, int depth) {\n          return ").concat(a,"(").concat(Mz(h,c),");\n        }\n      ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(").concat(i,", ").concat(o,", 1)));\n        ").concat(_z(e),"\n      }\n    ");var p=e.shapeInfo.texShape,f=p[0],m=p[1],v=e.shapeInfo.flatOffset;if(m===i&&null==v)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        int stride1 = ").concat(r,"Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n        float ".concat(a,"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(").concat(o,", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(").concat(m,".0, ").concat(f,".0);\n          return sampleTexture(").concat(r,", uv);\n        }\n      ");if(m===o&&null==v)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(").concat(r,"Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(").concat(n[1],", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(m,".0, ").concat(f,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");var g=Tz(r);return t?"\n    float ".concat(a,"(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ").concat(r,"Shape[1] * ").concat(r,"Shape[2];\n      int stride1 = ").concat(r,"Shape[2];\n      int index = row * stride0 + col * stride1 + depth + ").concat(g,";\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n      return sampleTexture(").concat(r,", uv);\n    }\n    "):"\n      float ".concat(a,"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(i," + col * ").concat(o," + depth + ").concat(g,";\n        vec2 uv = uvFromFlat(").concat(f,", ").concat(m,", index);\n        return sampleTexture(").concat(r,", uv);\n      }\n  ")}(e,t);case 4:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[3],o=n[2]*i,s=n[1]*o,u=ks(n),c=u.newShape,l=u.keptDims;if(c.length<n.length){var d=Cz(e,c),h=["row","col","depth","depth2"];return"\n      ".concat(yz(d,t),"\n      float ").concat(a,"(int row, int col, int depth, int depth2) {\n        return ").concat(a,"(").concat(Mz(h,l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(").concat(s,", ").concat(o,", ").concat(i,", 1)));\n        ").concat(_z(e),"\n      }\n    ");var p=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,m=f[0],v=f[1],g="int stride2 = ".concat(r,"Shape[3];"),y="int stride1 = ".concat(r,"Shape[2] * stride2;"),b="int stride0 = ".concat(r,"Shape[1] * stride1;");if(v===s&&null==p)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        ").concat(g,"\n        ").concat(y,"\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(").concat(o,", ").concat(i,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");if(v===i&&null==p)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(r,"Shape[1] * ").concat(r,"Shape[2], ").concat(r,"Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(n[1]*n[2],", ").concat(n[2],", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");var x=Tz(r);return t?"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ").concat(g,"\n      ").concat(y,"\n      ").concat(b,"\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index + ").concat(x,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," +\n          depth * ").concat(i," + depth2;\n      vec2 uv = uvFromFlat(").concat(m,", ").concat(v,", index + ").concat(x,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}(e,t);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],i=t[3]*a,o=t[2]*i,s=t[1]*o,u=ks(t),c=u.newShape,l=u.keptDims;if(c.length<t.length){var d=Cz(e,c),h=["row","col","depth","depth2","depth3"];return"\n      ".concat(yz(d),"\n      float ").concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        return ").concat(r,"(").concat(Mz(h,l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(s,", ").concat(o,", ").concat(i,", ").concat(a,")) +\n          depth3;\n        ").concat(_z(e),"\n      }\n    ");var p=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,m=f[0],v=f[1];if(v===s&&null==p)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(").concat(o,", ").concat(i,", ").concat(a,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(v===a&&null==p)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3],",\n               ").concat(t[2]*t[3],", ").concat(t[3],", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var g=Tz(n);return"\n    float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," + depth * ").concat(i," +\n          depth2 * ").concat(a," + depth3 + ").concat(g,";\n      vec2 uv = uvFromFlat(").concat(m,", ").concat(v,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=ks(t),i=a.newShape,o=a.keptDims;if(i.length<t.length){var s=Cz(e,i),u=["row","col","depth","depth2","depth3","depth4"];return"\n      ".concat(yz(s),"\n      float ").concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ").concat(r,"(").concat(Mz(u,o),");\n      }\n    ")}var c=t[5],l=t[4]*c,d=t[3]*l,h=t[2]*d,p=t[1]*h;if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(p,", ").concat(h,", ").concat(d,", ").concat(l,")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(").concat(c,", 1)));\n        ").concat(_z(e),"\n      }\n    ");var f=e.shapeInfo.flatOffset,m=e.shapeInfo.texShape,v=m[0],g=m[1];if(g===p&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(").concat(h,", ").concat(d,", ").concat(l,", ").concat(c,")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(g,".0, ").concat(v,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(g===c&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3]*t[4],",\n               ").concat(t[2]*t[3]*t[4],",\n               ").concat(t[3]*t[4],",\n               ").concat(t[4],")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(g,".0, ").concat(v,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var y=Tz(n);return"\n    float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(p," + col * ").concat(h," + depth * ").concat(d," +\n          depth2 * ").concat(l," + depth3 * ").concat(c," + depth4 + ").concat(y,";\n      vec2 uv = uvFromFlat(").concat(v,", ").concat(g,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);default:throw new Error("".concat(n.length,"-D input sampling is not yet supported"))}}function bz(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=lz();return"\n    vec4 ".concat(n,"() {\n      return ").concat(r.texture2D,"(").concat(t,", halfCR);\n    }\n  ")}(e);case 1:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=lz();if(t)return"\n    vec4 ".concat(r,"(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ");var o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return"\n    vec4 ".concat(r,"(int index) {\n      vec2 uv = packedUVfrom1D(\n        ").concat(o[0],", ").concat(o[1],", index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=i[0],s=i[1],u=lz();if(null!=i&&ms(n,i))return t?"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n\n        return ").concat(u.texture2D,"(").concat(r,", uv);\n      }\n    "):"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n\n        return ").concat(u.texture2D,"(").concat(r,", uv);\n      }\n    ");if(t)return"\n    vec4 ".concat(a,"(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ").concat(u.texture2D,"(").concat(r,", uv);\n    }\n  ");var c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],l=Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int row, int col) {\n      vec2 uv = packedUVfrom2D(").concat(l,", ").concat(c[0],", ").concat(c[1],", row, col);\n      return ").concat(u.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===n[0]){var s=[1,2],u=Cz(e,n.slice(1)),c=["b","row","col"];return"\n        ".concat(bz(u,t),"\n        vec4 ").concat(a,"(int b, int row, int col) {\n          return ").concat(a,"(").concat(Mz(c,s),");\n        }\n      ")}var l=lz();if(t)return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ").concat(l.texture2D,"(").concat(r,", uv);\n    }\n  ");var d=o[0],h=o[1],p=Math.ceil(n[2]/2),f=p*Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ").concat(d,", ").concat(h,", ").concat(f,", ").concat(p,", b, row, col);\n      return ").concat(l.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);default:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=lz();if(t)return"\n    vec4 ".concat(r,"(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(").concat(n,"Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(n,"Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ").concat(n,"Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ");for(var i=e.shapeInfo.logicalShape,o=i.length,s=e.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=u[0],l=u[1],d=Math.ceil(i[o-1]/2),h=d*Math.ceil(i[o-2]/2),p="int b, int row, int col",f="b * ".concat(h," + (row / 2) * ").concat(d," + (col / 2)"),m=2;m<o-1;m++)p="int b".concat(m,", ")+p,h*=i[o-m-1],f="b".concat(m," * ").concat(h," + ")+f;return"\n    vec4 ".concat(r,"(").concat(p,") {\n      int index = ").concat(f,";\n      int texR = index / ").concat(l,";\n      int texC = index - texR * ").concat(l,";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(l,", ").concat(c,");\n      return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t)}}var xz="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",wz="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",kz="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Sz="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Tz(e){return"offset".concat(e)}function _z(e){var t=e.name,n=fs(e.shapeInfo.logicalShape);return n<2?"return ".concat(t,";"):"\n    for (int i = 0; i < ".concat(n,"; i++) {\n      if (i == index) {\n        return ").concat(t,"[i];\n      }\n    }\n  ")}function Iz(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function Ez(e,t,n){var r=ks(t),a=r.newShape,i=r.keptDims,o=t.length,s=e&&3===o&&1===t[0],u=s?t.slice(1):a,c=!e&&o>1&&!ms(t,n)&&a.length<o||s;return{useSqueezeShape:c,uniformShape:c?u:t,keptDims:i}}function Cz(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function Mz(e,t){return t.map((function(t){return e[t]})).join(", ")}function Nz(e,t,n,r){var a=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),i=a.map((function(e){return e.shapeInfo})),o={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},s=gz(a,o,t),u=function(e,t){var n=qO(e,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(GO(e,(function(){return e.shaderSource(n,t)})),GO(e,(function(){return e.compileShader(n)})),Qs().get("ENGINE_COMPILE_ONLY"))return n;if(!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw HO(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}(e.gl,s),c=e.createProgram(u);return Qs().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o,uniformLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,inShapesLocations:null,inTexShapesLocations:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:t,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o},Rz(e,t,c))}function Rz(e,t,n){var r,a,i,o,s={},u={},c={},l=[],d=null;o=e.getUniformLocation(n,"NAN",!1),1===Qs().getNumber("WEBGL_VERSION")&&(d=e.getUniformLocation(n,"INFINITY",!1));for(var h=!1,p=0;p<t.variableNames.length;p++){var f=t.variableNames[p];s[f]=e.getUniformLocation(n,f,h),s["offset".concat(f)]=e.getUniformLocation(n,"offset".concat(f),h),t.enableShapeUniforms&&(u["".concat(f,"Shape")]=e.getUniformLocation(n,"".concat(f,"Shape"),h),c["".concat(f,"TexShape")]=e.getUniformLocation(n,"".concat(f,"TexShape"),h))}return t.enableShapeUniforms&&(r=e.getUniformLocation(n,"outShape",h),i=e.getUniformLocation(n,"outShapeStrides",h),a=e.getUniformLocation(n,"outTexShape",h)),t.customUniforms&&t.customUniforms.forEach((function(t,r){l[r]=e.getUniformLocation(n,t.name,h)})),{uniformLocations:s,customUniformLocations:l,infLoc:d,nanLoc:o,inShapesLocations:u,inTexShapesLocations:c,outShapeLocation:r,outShapeStridesLocation:i,outTexShapeLocation:a}}function Lz(e,t){if(e.length!==t.length)throw Error("Binary was compiled with ".concat(e.length," inputs, but was executed with ").concat(t.length," inputs"));e.forEach((function(e,n){var r=e.logicalShape,a=t[n],i=a.shape;if(!ms(r,i))throw Error("Binary was compiled with different shapes than the current args. Shapes ".concat(r," and ").concat(i," must match"));if(!e.isUniform||!a.isUniform){var o=e.texShape,s=a.isUniform?null:a.texData.texShape;if(!ms(o,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape ".concat(o," and ").concat(s," must match"))}}))}function Az(e){return Qs().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}var Pz=E((function e(t){T(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=MO.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=lz();this.outputShape=t,this.enableShapeUniforms=Az(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?hz(["r","c","d"],t):dz(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),Dz=E((function e(t){T(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=MO.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=lz();this.outputShape=t,this.enableShapeUniforms=Az(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?hz(["r","c","d"],t):dz(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),Oz=E((function e(t){T(this,e),this.variableNames=["A"],this.outTexUsage=NO.DOWNLOAD;var n=lz();this.outputShape=t,this.userCode="\n      ".concat(mz,"\n\n      void main() {\n        float x = getAAtOutCoords();\n        ").concat(n.output," = encode_float(x);\n      }\n    ")})),zz=E((function e(t){T(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=NO.DOWNLOAD;var n=lz();this.outputShape=t,this.userCode="\n      ".concat(mz,"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ").concat(n.output," = encode_float(x);\n      }\n    ")})),Fz=E((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];T(this,e),this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];var r=lz();this.outputShape=t,this.enableShapeUniforms=Az(this.outputShape.length);var a="result";n&&(a="floor(result * 255. + 0.5)"),this.userCode="\n      ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":fz(t),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n\n        int r = flatIndex / texShape[1];\n        int c = imod(flatIndex, texShape[1]);\n        vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n        vec4 values = ").concat(r.texture2D,"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        ").concat(r.output," = vec4(").concat(a,", 0., 0., 0.);\n      }\n    ")})),Gz=E((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];T(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];var r=lz();this.outputShape=t,this.enableShapeUniforms=Az(this.outputShape.length);var a="",i="result";n&&(i="floor(result * 255. + 0.5)");for(var o=0;o<=1;o++)for(var s=0;s<=1;s++){var u=2*o+s;a+="\n          localCoords = coords;\n          if(localCoords[2] + ".concat(s," < ").concat(this.enableShapeUniforms?"outShape[2]":"".concat(t[2]),") {\n          localCoords[2] += ").concat(s,";\n          if (localCoords[1] + ").concat(o," < ").concat(this.enableShapeUniforms?"outShape[1]":"".concat(t[1]),") {\n            localCoords[1] += ").concat(o,";\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ").concat(r.texture2D,"(A, uv);\n\n            if (offset == 0) {\n              result[").concat(u,"] = values[0];\n            } else if (offset == 1) {\n              result[").concat(u,"] = values[1];\n            } else if (offset == 2) {\n              result[").concat(u,"] = values[2];\n            } else {\n              result[").concat(u,"] = values[3];\n            }\n          }\n        }\n        ")}this.userCode="\n        ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":fz(t),"\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ").concat(a,"\n\n          ").concat(r.output," = ").concat(i,";\n        }\n    ")}));function Wz(e){var t=lz();return function(e,t){var n=qO(e,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(GO(e,(function(){return e.shaderSource(n,t)})),GO(e,(function(){return e.compileShader(n)})),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(e,"".concat(t.version,"\n    precision highp float;\n    ").concat(t.attribute," vec3 clipSpacePos;\n    ").concat(t.attribute," vec2 uv;\n    ").concat(t.varyingVs," vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }"))}function Vz(e){return function(e,t){var n=qO(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return GO(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),GO(e,(function(){return e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function Uz(e){return function(e,t){var n=qO(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return GO(e,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)})),GO(e,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Uint16Array([0,1,2,2,1,3]))}function Xz(e,t,n,r,a,i){!function(e,t){var n=Qs().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="[".concat(e,"x").concat(t,"]");throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n){var a="[".concat(e,"x").concat(t,"]"),i="[".concat(n,"x").concat(n,"]");throw new Error("Requested texture size "+a+" greater than WebGL maximum on this browser / GPU "+i+".")}}(t,n);var o=function(e){return qO(e,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}(e),s=e.TEXTURE_2D;return GO(e,(function(){return e.bindTexture(s,o)})),GO(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),GO(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),GO(e,(function(){return e.texParameteri(s,e.TEXTURE_MIN_FILTER,e.NEAREST)})),GO(e,(function(){return e.texParameteri(s,e.TEXTURE_MAG_FILTER,e.NEAREST)})),1===Qs().getNumber("WEBGL_VERSION")?GO(e,(function(){return e.texImage2D(s,0,r,t,n,0,a,i,null)})):GO(e,(function(){return e.texStorage2D(s,1,r,t,n)})),GO(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),{texture:o,texShape:[n,t]}}function Bz(e){return e.internalFormatFloat}function Hz(e){return e.internalFormatHalfFloat}function Zz(e){return e.downloadTextureFormat}function Kz(e){return e.internalFormatPackedFloat}function jz(e){return e.internalFormatPackedHalfFloat}function Yz(e,t,n,r,a,o,s,u){var c=e,l=new Float32Array(function(e,t){var n=i(zO(e,t),2);return n[0]*n[1]*4}(o,s));return c.bindBuffer(c.PIXEL_PACK_BUFFER,t),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,l),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),l}var Qz=function(){function e(t){T(this,e),this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var n=Qs().getNumber("WEBGL_VERSION");null!=t?(this.gl=t,function(e,t){LO[e]=t}(n,t)):this.gl=PO(n);var r="WEBGL_color_buffer_float",a="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===Qs().getNumber("WEBGL_VERSION")){var i="OES_texture_half_float";if(this.textureFloatExtension=VO(this.gl,"OES_texture_float"),az(this.gl,i))this.textureHalfFloatExtension=VO(this.gl,i);else if(Qs().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),az(this.gl,a))this.colorBufferHalfFloatExtension=VO(this.gl,a);else if(Qs().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",az(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!az(this.gl,a))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(a)}this.vertexBuffer=Vz(this.gl),this.indexBuffer=Uz(this.gl),this.framebuffer=function(e){return qO(e,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=FO(this.gl,this.textureHalfFloatExtension)}return E(e,[{key:"debug",get:function(){return Qs().getBool("DEBUG")}},{key:"dispose",value:function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;GO(t,(function(){return t.finish()})),GO(t,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),GO(t,(function(){return t.deleteFramebuffer(e.framebuffer)})),GO(t,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),GO(t,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),GO(t,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}}},{key:"createFloat32MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=i(DO(t,n),2);return Xz(e,a[0],a[1],Bz(r),r.textureFormatFloat,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"createFloat16MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=i(DO(t,n),2);return Xz(e,a[0],a[1],Hz(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createUnsignedBytesMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=i(DO(t,n),2);return Xz(e,a[0],a[1],Zz(r),e.RGBA,e.UNSIGNED_BYTE)}(this.gl,e,t,this.textureConfig)}},{key:"uploadPixelDataToTexture",value:function(e,t){this.throwIfDisposed(),function(e,t,n){GO(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),n.data instanceof Uint8Array?2===Qs().getNumber("WEBGL_VERSION")?GO(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data)})):GO(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)})):2===Qs().getNumber("WEBGL_VERSION")?GO(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n)})):GO(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)})),GO(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t)}},{key:"uploadDenseMatrixToTexture",value:function(e,t,n,r){this.throwIfDisposed(),function(e,t,n,r,a,i){var o,s,u;GO(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),a instanceof Uint8Array?(o=new Uint8Array(n*r*4),s=e.UNSIGNED_BYTE,u=e.RGBA):(o=new Float32Array(n*r*4),s=e.FLOAT,u=i.internalFormatPackedFloat),o.set(a),2===Qs().getNumber("WEBGL_VERSION")?GO(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,e.RGBA,s,o)})):GO(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,u,n,r,0,e.RGBA,s,o)})),GO(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t,n,r,this.textureConfig)}},{key:"createFloat16PackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=i(zO(t,n),2);return Xz(e,a[0],a[1],jz(r),e.RGBA,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createPackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=i(zO(t,n),2);return Xz(e,a[0],a[1],Kz(r),e.RGBA,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"deleteMatrixTexture",value:function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(QO(this.gl,this.framebuffer),this.outputTexture=null),GO(this.gl,(function(){return t.gl.deleteTexture(e)}))}},{key:"downloadByteEncodedFloatMatrixFromOutputTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n,r){var a=i(DO(t,n),2),o=a[0],s=a[1],u=new Uint8Array(function(e,t){return e*4}(t*n));return GO(e,(function(){return e.readPixels(0,0,o,s,r.downloadTextureFormat,e.UNSIGNED_BYTE,u)})),new Float32Array(u.buffer)}(r.gl,t,n,r.textureConfig)}))}},{key:"downloadPackedMatrixFromBuffer",value:function(e,t,n,r,a,i){return Yz(this.gl,e,0,0,0,a,i,this.textureConfig)}},{key:"downloadFloat32MatrixFromBuffer",value:function(e,t){return function(e,t,n){var r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}(this.gl,e,t)}},{key:"createBufferFromTexture",value:function(e,t,n){this.bindTextureToFrameBuffer(e);var r=function(e,t,n,r){var a=e.createBuffer();GO(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)}));var i=16*t*n;return GO(e,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ)})),GO(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)})),GO(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),a}(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}},{key:"createAndWaitForFence",value:function(){var e=this.createFence(this.gl);return this.pollFence(e)}},{key:"createFence",value:function(e){var t,n,r=this;if(Qs().getBool("WEBGL_FENCE_API_ENABLED")){var a=e,i=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=a.clientWaitSync(i,0,0);return e===a.ALREADY_SIGNALED||e===a.CONDITION_SATISFIED},t=i}else Qs().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,Qs().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}}},{key:"downloadMatrixFromPackedTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n){var r=new Float32Array(t*n*4);return GO(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)})),r}(r.gl,t,n)}))}},{key:"createProgram",value:function(e){var t=this;this.throwIfDisposed();var n=this.gl;null==this.vertexShader&&(this.vertexShader=Wz(n));var r=function(e){return qO(e,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}(n);return GO(n,(function(){return n.attachShader(r,t.vertexShader)})),GO(n,(function(){return n.attachShader(r,e)})),function(e,t){if(GO(e,(function(){return e.linkProgram(t)})),!Qs().get("ENGINE_COMPILE_ONLY")&&!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}(n,r),this.debug&&ZO(n,r),this.vertexAttrsAreBound||(this.setProgram(r),this.vertexAttrsAreBound=function(e,t,n){return GO(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),KO(e,t,"clipSpacePos",n,3,20,0)&&KO(e,t,"uv",n,2,20,12)}(n,this.program,this.vertexBuffer)),r}},{key:"deleteProgram",value:function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&GO(this.gl,(function(){return t.gl.deleteProgram(e)}))}},{key:"setProgram",value:function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&ZO(this.gl,this.program),GO(this.gl,(function(){return t.gl.useProgram(e)}))}},{key:"getUniformLocation",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.throwIfDisposed(),n?function(e,t,n){return qO(e,(function(){return e.getUniformLocation(t,n)}),'uniform "'+n+'" not present in program.')}(this.gl,e,t):function(e,t,n){return e.getUniformLocation(t,n)}(this.gl,e,t)}},{key:"getAttributeLocation",value:function(e,t){var n=this;return this.throwIfDisposed(),GO(this.gl,(function(){return n.gl.getAttribLocation(e,t)}))}},{key:"getUniformLocationNoThrow",value:function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}},{key:"setInputMatrixTexture",value:function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),function(e,t,n,r){GO(e,(function(){return jO(e,t,r)})),GO(e,(function(){return e.uniform1i(n,r)}))}(this.gl,e,t,n)}},{key:"setOutputMatrixTexture",value:function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}},{key:"setOutputPackedMatrixTexture",value:function(e,t,n){this.throwIfDisposed();var r=i(zO(t,n),2),a=r[0],o=r[1];this.setOutputMatrixTextureDriver(e,a,o)}},{key:"setOutputMatrixWriteRegion",value:function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}},{key:"setOutputPackedMatrixWriteRegion",value:function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}},{key:"debugValidate",value:function(){null!=this.program&&ZO(this.gl,this.program),JO(this.gl)}},{key:"executeProgram",value:function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),GO(e,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))}},{key:"blockUntilAllProgramsCompleted",value:function(){var e=this;this.throwIfDisposed(),GO(this.gl,(function(){return e.gl.finish()}))}},{key:"getQueryTimerExtension",value:function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=VO(this.gl,2===Qs().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}},{key:"getQueryTimerExtensionWebGL2",value:function(){return this.getQueryTimerExtension()}},{key:"getQueryTimerExtensionWebGL1",value:function(){return this.getQueryTimerExtension()}},{key:"beginQuery",value:function(){if(2===Qs().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),a=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,a),a}},{key:"endQuery",value:function(){if(2!==Qs().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}}},{key:"waitForQueryAndGetTime",value:function(){var e=S(w().mark((function e(t){var n=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,bs((function(){return n.disposed||n.isQueryAvailable(t,Qs().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}));case 2:return e.abrupt("return",this.getQueryTime(t,Qs().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getQueryTime",value:function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}},{key:"isQueryAvailable",value:function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint}var i=this.getQueryTimerExtensionWebGL1(),o=i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}},{key:"pollFence",value:function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))}},{key:"pollItems",value:function(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t){(0,this.itemsToPoll[t].resolveFn)()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}},{key:"addItemToPoll",value:function(e,t){var n,r=this;(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)||("setTimeoutCustom"in Qs().platform&&(n=Qs().platform.setTimeoutCustom.bind(Qs().platform)),bs((function(){return r.pollItems(),0===r.itemsToPoll.length}),(function(){return 0}),null,n))}},{key:"bindTextureToFrameBuffer",value:function(e){this.throwIfDisposed(),YO(this.gl,e,this.framebuffer),this.debug&&JO(this.gl)}},{key:"unbindTextureToFrameBuffer",value:function(){null!=this.outputTexture?(YO(this.gl,this.outputTexture,this.framebuffer),this.debug&&JO(this.gl)):QO(this.gl,this.framebuffer)}},{key:"downloadMatrixDriver",value:function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n}},{key:"setOutputMatrixTextureDriver",value:function(e,t,n){this.throwIfDisposed();var r=this.gl;YO(r,e,this.framebuffer),this.debug&&JO(r),this.outputTexture=e,GO(r,(function(){return r.viewport(0,0,t,n)})),GO(r,(function(){return r.scissor(0,0,t,n)}))}},{key:"setOutputMatrixWriteRegionDriver",value:function(e,t,n,r){var a=this;this.throwIfDisposed(),GO(this.gl,(function(){return a.gl.scissor(e,t,n,r)}))}},{key:"throwIfDisposed",value:function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}},{key:"throwIfNoProgram",value:function(){if(null==this.program)throw new Error("No GPU program is currently set.")}}]),e}();function Jz(e){return function(t,n,r,a,i){var o=Uf(t,n),s=o.length,u=zs(o),c=Ss(i,fs(o)),l=t.length,d=n.length,h=zs(t),p=zs(n),f=Wf(t,o),m=Wf(n,o);if(f.length+m.length===0)for(var v=0;v<c.length;++v)c[v]=e(r[v%r.length],a[v%a.length]);else for(var g=function(){var t=Hs(y,s,u),n=t.slice(-l);f.forEach((function(e){return n[e]=0}));var i=Bs(n,l,h),o=t.slice(-d);m.forEach((function(e){return o[e]=0}));var v=Bs(o,d,p);c[y]=e(r[i],a[v])},y=0;y<c.length;++y)g();return[c,o]}}var qz=Jz((function(e,t){return e+t}));function $z(e){return function(t,n,r){for(var a=Ss(n,t.length),i=0;i<t.length;++i)a[i]=e(t[i],r);return a}}var eF=$z((function(e){return Math.ceil(e)}));var tF=Jz((function(e,t){return e===t?1:0})),nF=$z((function(e){return Math.exp(e)})),rF=$z((function(e){return Math.expm1(e)})),aF=$z((function(e){return Math.floor(e)}));var iF=Jz((function(e,t){return e>t?1:0})),oF=Jz((function(e,t){return e>=t?1:0})),sF=Jz((function(e,t){return e<t?1:0})),uF=Jz((function(e,t){return e<=t?1:0}));var cF=$z((function(e){return Math.log(e)}));var lF=Jz((function(e,t){return Math.max(e,t)})),dF=Jz((function(e,t){return Math.min(e,t)})),hF=Jz((function(e,t){return e*t}));var pF=Jz((function(e,t){return e!==t?1:0}));function fF(e,t,n,r){var a=[],i=0,o=t.length-1+n.length,s=new Array(o).fill(null).map((function(){return[0]}));!function(e,t){for(var n=0;n<e.length;++n){var r=e[n],a=n===e.length-1?t:e[n+1].length;if(0===r.length)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>a)throw new Error("Ragged splits must not point past values");for(var i=1;i<r.length;++i)if(r[i-1]>r[i])throw new Error("Ragged splits must be sorted in ascending order")}}(n,r);for(var u=1,c=0;c<t.length-1;++c){u*=t[c];for(var l=t[c+1],d=1;d<u+1;++d)s[c].push(d*l)}for(var h=0;h<e.length;++h){for(var p=e[h],f=e[h]+1,m=0;m<n.length;++m){var v=n[m],g=m+t.length-1;if(g>=0)for(var y=s[g],b=y[y.length-1]-v[p],x=p;x<f;++x)s[g].push(v[x+1]+b);p=v[p],f=v[f]}f!==p&&(a.push([p,f]),i+=f-p)}return{outSplits:s,valueSlices:a,numValues:i}}function mF(e,t){for(var n=e.slice(0,t);n.length<t;)n.push(1);for(var r=t;r<e.length;r++)n[t-1]*=e[r];return n}function vF(e,t,n,r,a){var i=t.slice();i[0]=a;var o=Ts(n,fs(i)),s=e.length;return function(e,t,n,r,a,i){var o,s=mF(t,2)[1],u=mF(i,2)[1],c=0,l=x(n);try{for(l.s();!(o=l.n()).done;)for(var d=o.value,h=d[0];h<d[1];++h){for(var p=0;p<r;++p)a[c*u+p]=e[h*s+p];++c}}catch(f){l.e(f)}finally{l.f()}}(e,t,r,0===s?0:s/t[0],o,i),[o,i]}var gF=Fx,yF=function(){function e(t,n,r,a,i,o,s,u,c,l){T(this,e),this.shape=t,this.shapeShape=n,this.values=r,this.valuesShape=a,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=Zx(l),this.raggedRank=Kx(this.rowPartitionTypes)}return E(e,[{key:"getRowPartitionTypeByDimension",value:function(e){return this.rowPartitionTypes[0]===gF.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}},{key:"getRowPartitionTensor",value:function(e){return this.rowPartitionTypes[0]===gF.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}},{key:"getMaxWidth",value:function(t){var n=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case gF.VALUE_ROWIDS:return e.getMaxWidthValueRowID(n);case gF.ROW_SPLITS:return e.getMaxWidthRowSplit(n);default:throw new Error("Cannot handle partition type ".concat(gF[this.getRowPartitionTypeByDimension(t-1)]))}}},{key:"tensorShapeFromTensor",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(0===t.length){if(-1===e[0])return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return xF(e,n)}},{key:"calculateOutputSize",value:function(e){var t=this.valuesShape;jx(this.defaultValueShape,t);var n=this.tensorShapeFromTensor(this.shape,this.shapeShape),r=Hx(this.raggedRank,n,t);r[0]<0&&(r[0]=e);for(var a=1;a<=this.raggedRank;++a)r[a]<0&&(r[a]=this.getMaxWidth(a));return r}},{key:"calculateFirstParentOutputIndex",value:function(e,t,n){for(var r=Math.min(e,n),a=[],i=0,o=0;o<r;++o,i+=t)a.push(i);for(var s=r;s<e;++s)a.push(-1);return ls(a.length===e,(function(){return"Final length of result must be equal to firstDimension."})),a}},{key:"calculateOutputIndexRowSplit",value:function(e,t,n,r){for(var a=e.length,i=[],o=0;o<a-1;++o){var s=e[o+1]-e[o],u=Math.min(r,s),c=t[o];-1===c&&(u=0);for(var l=0;l<u;++l)i.push(c),c+=n;for(var d=0;d<s-u;++d)i.push(-1)}if(a>0&&i.length!==e[a-1])throw new Error("Invalid row split size.");return i}},{key:"calculateOutputIndexValueRowID",value:function(e,t,n,r){var a=e.length,i=[];if(0===a)return[];var o=0,s=e[0];if(s>=t.length)throw new Error("Got currentValueRowId=".concat(s,", which is not less than ").concat(t.length));var u=t[s];i.push(u);for(var c=1;c<a;++c){var l=e[c];if(l===s)u>=0&&(++o<r?u+=n:u=-1);else{if(o=0,s=l,l>=t.length)throw new Error("Got nextValueRowId=".concat(l," which is not less than ").concat(t.length));u=t[l]}i.push(u)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}},{key:"calculateOutputIndex",value:function(e,t,n,r){var a=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case gF.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(a,t,n,r);case gF.ROW_SPLITS:if(a.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(a.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(a,t,n,r);default:throw new Error("Unsupported partition type: ".concat(gF[i]))}}},{key:"getFirstDimensionSize",value:function(){var e=this.rowPartitionValues[0];if(0===this.rowPartitionTypes.length)throw new Error("No row_partition_types given.");var t=this.rowPartitionTypes[0];switch(t){case gF.FIRST_DIM_SIZE:return e[0];case gF.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case gF.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(gF[t]))}}},{key:"compute",value:function(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var e=this.getFirstDimensionSize(),t=this.calculateOutputSize(e),n=new Array(this.raggedRank+1);n[n.length-1]=1;for(var r=n.length-2;r>=0;--r)n[r]=n[r+1]*t[r+1];var a=xF(t,!1),i=Ts(this.valuesDType,fs(a));if(n[0]*t[0]>0){for(var o=this.calculateFirstParentOutputIndex(e,n[0],t[0]),s=1;s<=this.raggedRank;++s)o=this.calculateOutputIndex(s-1,o,n[s],t[s]);this.setOutput(this.raggedRank,o,i,a)}return[a,i]}},{key:"setOutput",value:function(e,t,n,r){if(0!==n.length){var a=this.values,i=n,o=r.slice(),s=fs(o=o.slice(e+1)),u=t.length,c=this.defaultValue;if(c.length!==s&&1!==c.length){var l=this.defaultValueShape;Rf((function(){var e=nv(c,l);c=vv(e,o).dataSync()}))}for(var d=0,h=0,p=0,f=0;f<=u;++f){var m=f<u?t[f]:-1;if(m!==p){if(h<p){var v=a.subarray(d*s);bF(i.subarray(h*s),v,(p-h)*s)}if(f>=u){var g=n.length;m=Math.floor(g/s)}if(m>p)if(1===this.defaultValue.length)i.subarray(p*s,m*s).fill(this.defaultValue[0]),p=m;else for(;m>p;){bF(i.slice(p*s),c,s),++p}m<0?(d=f+1,h=p):(d=f,p=(h=p)+1)}else++p}}}}],[{key:"getMaxWidthRowSplit",value:function(e){var t=e.length;if(0===t||1===t)return 0;for(var n=0,r=0;r<t-1;++r){var a=e[r+1]-e[r];a>n&&(n=a)}return n}},{key:"getMaxWidthValueRowID",value:function(e){var t=e.length;if(0===t)return 0;for(var n=0,r=e[0],a=0,i=1;i<t;++i){var o=e[i];o!==r&&(r=o,a=Math.max(i-n,a),n=i)}return Math.max(t-n,a)}}]),e}();function bF(e,t,n){for(var r=0;r<n;r++)e[r]=t[r]}function xF(e,t){var n,r=[],a=x(e);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i<0){if(!t)throw new Error("Dimension ".concat(i," must be >= 0"));if(i<-1)throw new Error("Dimension ".concat(i," must be >= -1"));i=-1}r.push(i)}}catch(o){a.e(o)}finally{a.f()}return r}var wF=$z((function(e){return 1/Math.sqrt(e)}));var kF=$z((function(e){return 1/(1+Math.exp(-e))}));var SF=$z((function(e){return Math.sqrt(e)})),TF=Jz((function(e,t){var n=e-t;return n*n}));var _F=function(){function e(t,n,r,a,i,o){T(this,e),this.separator=oh(t),this.nGramWidths=n,this.leftPad=oh(r),this.rightPad=oh(a),this.padWidth=i,this.preserveShort=o}return E(e,[{key:"getPadWidth",value:function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}},{key:"getNumNGrams",value:function(e,t){var n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}},{key:"createNGrams",value:function(e,t,n,r,a,i){for(var o=this,s=function(){var s=o.getPadWidth(i),c=Math.max(0,s-u),l=Math.max(0,s-(a-(u+1))),d=i-(c+l),h=t+(c>0?0:u-s),p=0;p+=c*o.leftPad.length;for(var f=0;f<d;++f)p+=e[h+f].length;p+=l*o.rightPad.length,p+=(c+l+d-1)*o.separator.length,n[r+u]=new Uint8Array(p);for(var m=n[r+u],v=0,g=function(e){return e.forEach((function(e){return m[v++]=e}))},y=0;y<c;++y)g(o.leftPad),g(o.separator);for(var b=0;b<d-1;++b)g(e[h+b]),g(o.separator);if(d>0){g(e[h+d-1]);for(var x=0;x<l;++x)g(o.separator),g(o.rightPad)}else{for(var w=0;w<l-1;++w)g(o.rightPad),g(o.separator);g(o.rightPad)}},u=0;u<a;++u)s()}},{key:"compute",value:function(e,t){var n=this,r=e.length,a=t.length;if(a>0){var i=t[0];if(0!==i)throw new Error("First split value must be 0, got ".concat(i));for(var o=1;o<a;++o){var s=t[o]>=i;if(!(s=s&&t[o]<=r))throw new Error("Invalid split value ".concat(t[o],", must be in [").concat(i,", ").concat(r,"]"));i=t[o]}if(i!==r)throw new Error("Last split value must be data size. Expected ".concat(r,", got ").concat(i))}var u=a-1,c=Ts("int32",a);if(0===r||0===a){for(var l=new Array(r),d=0;d<=u;++d)c[d]=0;return[l,c]}c[0]=0;for(var h=function(){var e=t[p]-t[p-1],r=0;n.nGramWidths.forEach((function(t){r+=n.getNumNGrams(e,t)})),n.preserveShort&&e>0&&0===r&&(r=1),c[p]=c[p-1]+r},p=1;p<=u;++p)h();for(var f=new Array(c[u]),m=function(r){var a=t[r],i=c[r];if(n.nGramWidths.forEach((function(o){var s=t[r+1]-t[r],u=n.getNumNGrams(s,o);n.createNGrams(e,a,f,i,u,o),i+=u})),n.preserveShort&&i===c[r]){var o=t[r+1]-t[r];if(0===o)return"continue";var s=o+2*n.padWidth;n.createNGrams(e,a,f,i,1,s)}},v=0;v<u;++v)m(v);return[f,c]}}]),e}();function IF(e,t,n,r){if(e.length)if(0!==t.length)if(1!==t.length){for(var a=0,i=0;i<e.length+1;i++)if(i===e.length||-1!==t.indexOf(e[i])){var o=e.subarray(a,i);(!n||0!==o.length)&&r.push(o),a=i+1}}else{for(var s=t[0],u=e.indexOf(s);-1!==u;){var c=e.subarray(0,u);(!n||0!==c.length)&&r.push(c),u=(e=e.subarray(u+1)).indexOf(s)}(!n||0!==e.length)&&r.push(e)}else for(var l=0;l<e.length;++l)r.push(e.subarray(l,l+1))}var EF=Jz((function(e,t){return e-t}));var CF=function(e,t){var n=t.value-e.value;return 0===n?e.index-t.index:n};function MF(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length-1;r>n;){if(r-n>600){var a=r-n+1,i=t-n+1,o=Math.log(a),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2);MF(e,t,Math.max(n,Math.floor(t-i*s/a+u)),Math.min(r,Math.floor(t+(a-i)*s/a+u)))}var c=e[t],l=n,d=r;for(us(e,n,t),CF(e[r],c)>0&&us(e,n,r);l<d;){for(us(e,l,d),l++,d--;CF(e[l],c)<0;)l+=1;for(;CF(e[d],c)>0;)d-=1}0===CF(e[n],c)?us(e,n,d):us(e,d+=1,r),d<=t&&(n=d+1),t<=d&&(r=d-1)}}var NF=Object.freeze(Object.defineProperty({__proto__:null,addImpl:qz,bincountImpl:function(e,t,n,r,a){for(var i=fs(r),o=Vs(a,n),s=0;s<e.length;s++){var u=e[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(o[u]+=i>0?t[s]:1)}return o},bincountReduceImpl:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.shape[0],i=e.shape[1],o=df([a,n],t.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var c=e.get(s,u);if(c<0)throw new Error("Input x must be non-negative!");c>=n||(r?o.set(1,s,c):t.size>0?o.set(o.get(s,c)+t.get(s,u),s,c):o.set(o.get(s,c)+1,s,c))}return o},castImpl:function(e,t,n,r){if("int32"===r)return[t,"int32",Int32Array.from(e)];if("bool"===r){var a=rh([0],n),o=i(Jz((function(e,t){return e!==t?1:0}))(t,[],e,a,"bool"),2),s=o[0];return[o[1],"bool",s]}throw new Error("Error in Cast: failed to cast ".concat(n," to ").concat(r))},ceilImpl:eF,concatImpl:function(e,t,n,r){var a=Ts(n,fs(t));if(r&&"string"!==n){var i=0;e.forEach((function(e){var t=fs(e.shape);a.set(e.vals,i),i+=t}))}else{var o=0;e.forEach((function(e){for(var r="string"===n?Zw(e.vals):e.vals,i=0,s=0;s<e.shape[0];++s)for(var u=s*t[1]+o,c=0;c<e.shape[1];++c)a[u+c]=r[i++];o+=e.shape[1]}))}return a},equalImpl:tF,expImpl:nF,expm1Impl:rF,floorImpl:aF,gatherNdImpl:function(e,t,n,r,a,i,o,s,u){for(var c=df([r,i],n),l=0;l<r;l++){for(var d=[],h=0,p=0;p<a;p++){var f=e[l*a+p];h+=f*o[p],d.push(f)}if(h<0||h>=u/i)throw new Error("Invalid indices: ".concat(d," does not index into ").concat(s));for(var m=0;m<i;m++)c.values[l*i+m]=t.get.apply(t,b(t.indexToLoc(h*i+m)))}return c},gatherV2Impl:function(e,t,n){for(var r=df(n,e.dtype),a=0;a<r.size;++a){var i=r.indexToLoc(a).slice(),o=i[0],s=i[2],u=t.locToIndex([o,s]);i[2]=t.values[u];var c=e.locToIndex(i);0<=c&&c<e.values.length&&(r.values[a]=e.values[c])}return r},greaterEqualImpl:oF,greaterImpl:iF,lessEqualImpl:uF,lessImpl:sF,linSpaceImpl:function(e,t,n){var r=(t-e)/(n-1),a=Vs(n,"float32");a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+r;return a},logImpl:cF,maxImpl:function(e,t,n,r){for(var a=Ss(r,fs(n)),i=0;i<a.length;++i){for(var o=i*t,s=e[o],u=0;u<t;++u){var c=e[o+u];(Number.isNaN(c)||c>s)&&(s=c)}a[i]=s}return a},maximumImpl:lF,minimumImpl:dF,multiplyImpl:hF,negImpl:function(e,t,n){var r=nh(-1,n);return hF([],t,r,e,n)},notEqualImpl:pF,prodImpl:function(e,t,n,r){for(var a=i(Kv(e,r),2),o=a[0],s=a[1],u=Rh(t,"int32"),c=Vs(fs(o),u),l=fs(s),d=0;d<c.length;++d){for(var h=d*l,p=1,f=0;f<l;++f)p*=n[h+f];c[d]=p}return{outVals:c,outShape:o,outDtype:u}},raggedGatherImpl:function(e,t,n,r,a,i,o,s){if(0===e.length)throw new Error("paramsNestedSplits must be non empty");if(0===t[0].length)throw new Error("Split tensors must not be scalars");if(function(e,t,n){e.forEach((function(e,r){if(e<0||e>=n){var a=Hs(r,t.length,zs(t)).join(",");throw new Error("indices[".concat(a,"] = ").concat(e," is not in [0, ").concat(n,")"))}}))}(i,o,t[0][0]-1),0===r.length)throw new Error("params.rank must be nonzero");var u=fF(i,o,e,r[0]),c=u.outSplits,l=u.valueSlices,d=u.numValues,h=function(e){for(var t=[],n=function(){var n=Ts("int32",e[r].length);t.push(n),e[r].forEach((function(e,t){return n[t]=e}))},r=0;r<e.length;++r)n();return t}(c),p=vF(n,r,a,l,d);return[h,p[0],p[1]]},raggedTensorToTensorImpl:function(e,t,n,r,a,i,o,s,u,c){return new yF(e,t,n,r,a,i,o,s,u,c).compute()},rangeImpl:function(e,t,n,r){if(e===t||e<t&&n<0||t<e&&n>1)return Vs(0,r);var a=Vs(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+n;return a},rsqrtImpl:wF,scatterImpl:function(e,t,n,r,a,i,o,s,u,c){var l=[r/a,a],d=e.values,h=t.values;if(0===r)return df(n,t.dtype);var p=df(l,t.dtype);"string"==typeof u||"number"==typeof u?p.values.fill(u):"boolean"==typeof u&&p.values.fill(+u);for(var f=0;f<i;f++){for(var m=[],v=0,g=0;g<o;g++){var y=d[f*o+g];m.push(y),v+=y*s[g]}if(v<0||v>=r/a)throw new Error("Invalid indices: ".concat(m," does not index into ").concat(n));for(var b=0;b<a;b++)c?p.values[v*a+b]+=h[f*a+b]:p.values[v*a+b]=0===t.rank?h[0]:h[f*a+b]}return p},sigmoidImpl:kF,simpleAbsImpl:function(e){for(var t=new Float32Array(e.length),n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t},sliceImpl:function(e,t,n,r,a){var i=vm(r,t,n),o=fs(n),s=zs(r);if(i){var u=gm(t,s);return"string"===a?e.slice(u,u+o):e.subarray(u,u+o)}for(var c=df(r,a,"string"===a?Zw(e):e),l=df(n,a),d=0;d<l.size;++d){var h=l.indexToLoc(d),p=h.map((function(e,n){return e+t[n]}));l.set.apply(l,[c.get.apply(c,b(p))].concat(b(h)))}return"string"===a?Kw(l.values):l.values},sparseFillEmptyRowsImpl:function(e,t,n,r,a,i,o){var s=t[0],u=i[0],c=new Array(u),l=new Array(s),d=t[1];if(0===u){if(0!==s)throw new Error(Nw(s));return[Ts(n,0),[0,d],Ts(a,0),c,l]}for(var h=!0,p=0,f=new Array(u).fill(0),m=0;m<s;++m){var v=e[m*d];if(v<0)throw new Error(Rw(m,v));if(v>=u)throw new Error(Lw(m,v,u));++f[v],h=h&&v>=p,p=v}for(var g=!0,y=0;y<u;++y){var b=0===f[y];c[y]=b,g=g&&!b,f[y]=Math.max(f[y],1),y>0&&(f[y]+=f[y-1])}if(g&&h){for(var x=e,w=r,k=0;k<s;++k)l[k]=k;return[x,[s,d],w,c,l]}for(var S=f[u-1],T=Ts(n,S*d),_=Ts(a,S),I=new Array(u).fill(0),E=0;E<s;++E){var C=e[E*d],M=I[C],N=(0===C?0:f[C-1])+M;I[C]++;for(var R=0;R<d;++R)T[N*d+R]=e[E*d+R];_[N]=r[E],l[E]=N}for(var L=0;L<u;++L)if(0===I[L]){var A=0===L?0:f[L-1];T[A*d+0]=L;for(var P=1;P<d;++P)T[A*d+P]=0;_[A]=o}return[T,[S,d],_,c,l]},sparseReshapeImpl:function(e,t,n,r,a){for(var i=fs(r),o=t[0],s=a.length,u=[],c=1,l=-1,d=0;d<s;++d){var h=a[d];if(-1===h){if(-1!==l)throw new Error(Aw(l,d));l=d,u.push(1)}else{if(h<0)throw new Error(Pw(d,h));c*=h,u.push(h)}}if(-1!==l){if(c<=0)throw new Error("reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero");var p=Math.trunc(i/c);if(c*p!==i)throw new Error(Ow(r,u));u[l]=p}if(fs(u)!==i)throw new Error(zw(r,u));var f=r.length,m=[];if(f>0){m[f-1]=1;for(var v=f-2;v>=0;--v)m[v]=m[v+1]*r[v+1]}var g=[];if(s>0){g[s-1]=1;for(var y=s-2;y>=0;--y)g[y]=g[y+1]*u[y+1]}for(var b=Ts(n,o*s),x=0;x<o;++x){for(var w=0,k=0;k<f;++k)w+=e[x*f+k]*m[k];for(var S=0;S<s;++S)b[x*s+S]=Math.trunc(w/g[S]),w%=g[S]}return[b,[o,s],u]},sparseSegmentReductionImpl:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=r.length,u=[t[0],e.length/t[0]],c=u[1],l=s>0?a[s-1]+1:0;if(l<0)throw new Error("segment ids must be >= 0");var d=t.slice();d[0]=l;var h=d.reduce((function(e,t){return e*t}),1),p=Ts(n,h);if(0===s)return l>0&&p.fill(o),[p,d];if(l<=0)throw new Error("segment ids must be >= 0");for(var f=0,m=1,v=0,g=a[f];;){var y=0;if(m<s){if(g===(y=a[m])){++m;continue}if(g>=y)throw new Error("segment ids are not increasing")}if(g<0||g>=l)throw new Error(Ww(g,l));g>v&&p.fill(o,v*c,g*c);for(var b=f;b<m;++b){var x=r[b];if(x<0||x>=u[0])throw new Error(Vw(b,r[b],u[0]));for(var w=0;w<c;w++)p[g*c+w]+=e[x*c+w]}if(i)for(var k=0;k<c;k++)p[g*c+k]/=m-f;if(f=m,v=g+1,g=y,++m>s)break}return v<l&&p.fill(o,v*c,l*c),[p,d]},sqrtImpl:SF,squaredDifferenceImpl:TF,stridedSliceImpl:function(e,t,n,r){for(var a=df(e,t.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*n[u]+r[u];a.set.apply(a,[t.get.apply(t,s)].concat(b(o)))}return a},stringNGramsImpl:function(e,t,n,r,a,i,o,s){return new _F(n,r,a,i,o,s).compute(e,t)},stringSplitImpl:function(e,t,n){for(var r=e.length,a=[],i=0,o=0,s=new Array(r),u=0;u<r;++u){var c=a.length;IF(e[u],t,n,a);var l=a.length-c;s[u]=l,i+=l,o=Math.max(o,l)}for(var d=Ts("int32",2*i),h=new Array(i),p=[r,o],f=0,m=0;m<r;++m)for(var v=0;v<s[m];++v)d[2*f]=m,d[2*f+1]=v,h[f]=a[f],++f;return[d,h,p]},stringToHashBucketFastImpl:function(e,t){for(var n=Ts("int32",e.length),r=0;r<e.length;++r)n[r]=th(e[r]).modulo(t).getLowBitsUnsigned();return n},subImpl:EF,tileImpl:function(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];for(var a=df(n,e.dtype),i=0;i<a.values.length;++i){for(var o=a.indexToLoc(i),s=new Array(e.rank),u=0;u<s.length;u++)s[u]=o[u]%e.shape[u];var c=e.locToIndex(s);a.values[i]=e.values[c]}return a},topKImpl:function(e,t,n,r,a){for(var i=t[t.length-1],o=e.length/i,s=i,u=Ss(n,o*r),c=Ss("int32",o*r),l=function(){var t=d*s,n=e.subarray(t,t+s),i=new Array(n.length);n.forEach((function(e,t){return i[t]={value:e,index:t}})),r<i.length&&(MF(i,r),i=i.slice(0,r)),a&&i.sort(CF);for(var o=d*r,l=u.subarray(o,o+r),h=c.subarray(o,o+r),p=0;p<r;p++)l[p]=i[p].value,h[p]=i[p].index},d=0;d<o;d++)l();var h=t.slice();return h[h.length-1]=r,[df(h,n,u),df(h,"int32",c)]},transposeImpl:function(e,t,n,r,a){for(var i=t.length,o=fs(t),s=zs(t),u=zs(a),c=Ss(n,fs(a)),l=0;l<o;++l){for(var d=Hs(l,i,s),h=new Array(d.length),p=0;p<h.length;p++)h[p]=d[r[p]];c[Bs(h,i,u)]=e[l]}return c},uniqueImpl:function(e,t,n,r){for(var a=ws(t,n)[0],i=[1,n[0],1],o=0;o<a;o++)i[0]*=n[o];i[1]=n[a];for(var s=a+1;s<n.length;s++)i[2]*=n[s];for(var u={},c=new Int32Array(n[a]),l=new bh(i,r,e),d=[],h=1===i[0]&&1===i[2],p=0;p<n[a];p++){var f=void 0;if(h)f=e[p].toString();else{for(var m=[],v=0;v<i[0];v++)for(var g=0;g<i[2];g++)m.push(l.get(v,p,g));f=m.join(",")}if(void 0!==u[f])c[p]=u[f];else{var y=Object.keys(u).length;u[f]=y,c[p]=y,d.push(p)}}var b=i.slice();b[1]=Object.keys(u).length;var x=new bh(b,r);d.forEach((function(e,t){for(var n=0;n<i[0];n++)for(var r=0;r<i[2];r++)x.set(l.get(n,e,r),n,t,r)}));var w=n.slice();return w[a]=b[1],{outputValues:x.values,outputShape:w,indices:c}}},Symbol.toStringTag,{value:"Module"})),RF=NF.addImpl,LF=NF.bincountImpl,AF=NF.bincountReduceImpl,PF=NF.castImpl,DF=NF.ceilImpl,OF=NF.concatImpl,zF=NF.equalImpl,FF=NF.expImpl,GF=NF.expm1Impl,WF=NF.floorImpl,VF=NF.gatherNdImpl,UF=NF.gatherV2Impl,XF=NF.greaterImpl,BF=NF.greaterEqualImpl,HF=NF.lessImpl,ZF=NF.lessEqualImpl,KF=NF.linSpaceImpl,jF=NF.logImpl,YF=NF.maxImpl,QF=NF.maximumImpl,JF=NF.minimumImpl,qF=NF.multiplyImpl,$F=NF.negImpl,eG=NF.notEqualImpl,tG=NF.prodImpl,nG=NF.raggedGatherImpl,rG=NF.raggedTensorToTensorImpl,aG=NF.rangeImpl,iG=NF.rsqrtImpl,oG=NF.scatterImpl,sG=NF.sigmoidImpl,uG=NF.simpleAbsImpl,cG=NF.sliceImpl,lG=NF.sparseFillEmptyRowsImpl,dG=NF.sparseReshapeImpl,hG=NF.sparseSegmentReductionImpl,pG=NF.sqrtImpl,fG=NF.stridedSliceImpl,mG=NF.stringNGramsImpl,vG=NF.stringSplitImpl,gG=NF.stringToHashBucketFastImpl,yG=NF.subImpl,bG=NF.tileImpl,xG=NF.topKImpl,wG=NF.transposeImpl,kG=NF.uniqueImpl;function SG(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return"".concat(e,".").concat(t)}))}function TG(e,t){return 1===t?[e]:SG(e,t)}var _G=function(){function e(t){if(T(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=Az(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=TG("rc",this.rank),r=Iz(this.rank),a=this.getOutOfBoundsCondition(n),i=this.getSetup(n),o=this.getOutput(n);this.userCode="\n        void main() {\n          ".concat(r," rc = getOutputCoords();\n\n          if(").concat(a,") {\n            setOutput(vec4(0));\n          } else {\n            ").concat(i,"\n\n            setOutput(vec4(").concat(o,"));\n          }\n        }\n      ")}}return E(e,[{key:"getSourceCoordsArr",value:function(e){for(var t=[],n=0;n<=1;n++)for(var r=0;r<=1;r++){for(var a="".concat(0===n?"r":"rp1",", ").concat(0===r?"c":"cp1"),i=2;i<this.rank;i++)a="".concat(e[e.length-1-i],",")+a;t.push(a)}return t}},{key:"getOutOfBoundsCondition",value:function(e){if(1===this.rank)return"rc > ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]);for(var t="",n=this.rank-2;n<this.rank;n++)t+="".concat(e[n]," >= ").concat(this.enableShapeUniforms?"outShape[".concat(n,"]"):this.outputShape[n]),n<this.rank-1&&(t+="||");return t}},{key:"getSetup",value:function(e){if(1===this.rank)return"";var t=e.slice(-2),n=this.enableShapeUniforms?"outShape[".concat(this.rank," - 1]"):this.outputShape[this.rank-1],r=this.enableShapeUniforms?"outShape[".concat(this.rank," - 2]"):this.outputShape[this.rank-2];return"\n      int r = ".concat(t[0],";\n      int c = ").concat(t[1],";\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ").concat(n,";\n      bool rEdge = rp1 >= ").concat(r,";\n    ")}},{key:"getOutput",value:function(e){var t=this.getSourceCoordsArr(e);return 1===this.rank?"getA(rc), (rc + 1 >= ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]," ? 0. : getA(rc + 1)), 0, 0"):"getA(".concat(t[0],"),\n            cEdge ? 0. : getA(").concat(t[1],"),\n            rEdge ? 0. : getA(").concat(t[2],"),\n            rEdge || cEdge ? 0. : getA(").concat(t[3],")")}}]),e}(),IG=E((function e(t,n){T(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=Az(this.outputShape.length);for(var r="",a=0;a<4;a++){var i="thisRC = rc;";a%2===1&&(i+="thisRC.z += 1;"),a>1&&(i+="thisRC.y += 1;"),r+="\n        ".concat(i,"\n        ").concat(a>0?"if(thisRC.y < rows && thisRC.z < cols){":"","\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[").concat(a,"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ").concat(a>0?"}":"","\n      ")}this.userCode="\n      ".concat(function(e,t){return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ".concat(t?pz(["r","c","d"],"inputShape"):dz(["r","c","d"],e),"\n      return ivec3(r, c, d);\n    }\n  ")}(n,this.enableShapeUniforms),"\n      ").concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":fz(t),"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ").concat(this.enableShapeUniforms?"outShape[1]":t[1],";\n        int cols = ").concat(this.enableShapeUniforms?"outShape[2]":t[2],";\n\n        ").concat(r,"\n\n        setOutput(result);\n      }\n    ")}));var EG=function(){function e(t){T(this,e),this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return E(e,[{key:"acquireTexture",value:function(e,t,n){var r=MG(t,n),a=NG(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);var i,o=CG(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return r===RO.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===RO.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===RO.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===RO.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===RO.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),i}},{key:"releaseTexture",value:function(e,t,n,r){if(null!=this.freeTextures){var a=MG(n,r),i=NG(t,a,r);i in this.freeTextures||(this.freeTextures[i]=[]);var o=CG(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),s=Qs().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==s&&this._numBytesAllocated>s?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=o):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;var u=this.usedTextures[i],c=u.indexOf(e);if(c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u.splice(c,1),this.log()}}},{key:"log",value:function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));var t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}}},{key:"numBytesAllocated",get:function(){return this._numBytesAllocated}},{key:"numBytesFree",get:function(){return this._numBytesFree}},{key:"getNumUsedTextures",value:function(){return this.numUsedTextures}},{key:"getNumFreeTextures",value:function(){return this.numFreeTextures}},{key:"dispose",value:function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t.texture)}));for(var n in this.usedTextures)this.usedTextures[n].forEach((function(t){e.gpgpu.deleteMatrixTexture(t.texture)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}]),e}();function CG(e,t,n,r,a){var o,s=function(e,t){switch(e){case RO.PACKED_2X2_FLOAT32:return Kz(t);case RO.PACKED_2X2_FLOAT16:return jz(t);case RO.UNPACKED_FLOAT32:return Bz(t);case RO.UNPACKED_FLOAT16:return Hz(t);case RO.PACKED_4X1_UNSIGNED_BYTE:return Zz(t);default:throw new Error("Unknown physical texture type ".concat(e))}}(t,r);if(a){var u=i(zO(e[0],e[1]),2);o=u[0]*u[1]}else{var c=i(DO(e[0],e[1]),2);o=c[0]*c[1]}var l=function(e,t){var n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error("Unknown internal format ".concat(t))}(n,s);return o*l}function MG(e,t){if(e===NO.UPLOAD)return RO.PACKED_2X2_FLOAT32;if(e===NO.RENDER||null==e)return function(e){return Qs().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?RO.PACKED_2X2_FLOAT32:RO.UNPACKED_FLOAT32:e?RO.PACKED_2X2_FLOAT16:RO.UNPACKED_FLOAT16}(t);if(e===NO.DOWNLOAD||e===NO.PIXELS)return RO.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(e))}function NG(e,t,n){return"".concat(e[0],"_").concat(e[1],"_").concat(t,"_").concat(n)}var RG=E((function e(t,n){T(this,e),this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=Az(this.outputShape.length),this.userCode="\n      float unaryOperation(float x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")})),LG="if (isnan(x)) return x;",AG="return x;",PG="return abs(x);",DG="return (x >= 0.0) ? x : (exp(x) - 1.0);",OG=LG+"\n  return (x < 0.0) ? 0.0 : x;\n",zG=LG+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",FG="return x;",GG="return 1.0 / (1.0 + exp(-1.0 * x));",WG="return x;",VG="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",UG="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",XG="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",BG="return 1.0 / (1.0 + exp(-1.0 * x));",HG=E((function e(t,n){T(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=Az(this.outputShape.length),this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")})),ZG=E((function e(t){T(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=Az(this.outputShape.length);var n=t.length,r=TG("rc",n),a=Iz(n),i=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(n,r),o=r.slice(-2),s=n<=1?"rc":"vec2(".concat(o.join(","),")");this.userCode="\n      void main() {\n        ".concat(a," rc = getOutputCoords();\n        vec4 packedInput = getA(").concat(i,");\n\n        setOutput(getChannel(packedInput, ").concat(s,"));\n      }\n    ")})),KG=hb,jG={};var YG=Qs().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");var QG=function(e){m(n,e);var t=y(n);function n(e){var r,a;if(T(this,n),(r=t.call(this)).pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.lastGlFlushTime=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!Qs().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null!=e){if(e instanceof Qz)a=e;else{var i=PO(Qs().getNumber("WEBGL_VERSION"),e);a=new Qz(i)}r.binaryCache={},r.gpgpuCreatedLocally=!1}else{var o=PO(Qs().getNumber("WEBGL_VERSION"));a=new Qz(o),r.binaryCache=function(e){return e in jG||(jG[e]={}),jG[e]}(Qs().getNumber("WEBGL_VERSION")),r.gpgpuCreatedLocally=!0}return r.gpgpu=a,r.canvas=r.gpgpu.gl.canvas,r.textureManager=new EG(r.gpgpu),r.numMBBeforeWarning=null==Qs().global.screen?1024:Qs().global.screen.height*Qs().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new ns(h(r),Mf()),p(r)}return E(n,[{key:"nextDataId",value:function(){return n.nextDataId++}},{key:"numDataIds",value:function(){return this.texData.numDataIds()-this.pendingDeletes}},{key:"write",value:function(e,t,n){if((Qs().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||Qs().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:NO.UPLOAD,refCount:1}),r}},{key:"refCount",value:function(e){return this.texData.has(e)?this.texData.get(e).refCount:0}},{key:"incRef",value:function(e){this.texData.get(e).refCount++}},{key:"decRef",value:function(e){this.texData.has(e)&&this.texData.get(e).refCount--}},{key:"move",value:function(e,t,n,r,a){if(Qs().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:NO.UPLOAD,refCount:a})}},{key:"disposeIntermediateTensorInfo",value:function(e){this.disposeData(e.dataId)}},{key:"readSync",value:function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,a=t.complexTensorInfos,i=t.slice,o=t.shape,s=t.isPacked;if(null!=i){var u;u=s?new HG(o,FG):new RG(o,FG);var c=this.runWebGLProgram(u,[{dataId:e,shape:o,dtype:r}],r),l=this.readSync(c.dataId);return this.disposeIntermediateTensorInfo(c),l}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var d,h,p=null!=this.activeTimers;(p&&(d=ah()),"complex64"===r)?h=dw(this.readSync(a.real.dataId),this.readSync(a.imag.dataId)):h=this.getValuesFromTexture(e);return p&&(this.downloadWaitMs+=ah()-d),this.convertAndCacheOnCPU(e,h)}},{key:"read",value:function(){var e=S(w().mark((function e(t){var n,r,a,i,o,s,u,c,l,d,h,p,f,m,v,g,y,x,k,S,T,_,I;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pendingRead.has(t)){e.next=3;break}return n=this.pendingRead.get(t),e.abrupt("return",new Promise((function(e){return n.push(e)})));case 3:if(r=this.texData.get(t),a=r.values,i=r.shape,o=r.slice,s=r.dtype,u=r.complexTensorInfos,c=r.isPacked,null==o){e.next=8;break}return l=c?new HG(i,FG):new RG(i,FG),d=this.runWebGLProgram(l,[{dataId:t,shape:i,dtype:s}],s),h=this.read(d.dataId),e.abrupt("return",(this.disposeIntermediateTensorInfo(d),h));case 8:if(null==a){e.next=10;break}return e.abrupt("return",this.convertAndCacheOnCPU(t));case 10:if(!Qs().getBool("DEBUG")||Qs().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")||2!==Qs().getNumber("WEBGL_VERSION")){e.next=12;break}throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");case 12:if(p=null,"complex64"!==s&&Qs().get("WEBGL_BUFFER_SUPPORTED")&&(f=this.decode(t),v=this.texData.get(f.dataId),p=(m=this.gpgpu).createBufferFromTexture.apply(m,[v.texture.texture].concat(b(OO(i))))),this.pendingRead.set(t,[]),e.t0="complex64"!==s,!e.t0){e.next=19;break}return e.next=19,this.gpgpu.createAndWaitForFence();case 19:if("complex64"!==s){e.next=28;break}return e.next=22,Promise.all([this.read(u.real.dataId),this.read(u.imag.dataId)]);case 22:y=e.sent,x=y[0],k=y[1],g=dw(x,k),e.next=29;break;case 28:null==p?g=this.getValuesFromTexture(t):(S=fs(i),g=this.gpgpu.downloadFloat32MatrixFromBuffer(p,S));case 29:return null!=f&&this.disposeIntermediateTensorInfo(f),null!=p&&GO(T=this.gpgpu.gl,(function(){return T.deleteBuffer(p)})),_=this.convertAndCacheOnCPU(t,g),I=this.pendingRead.get(t),e.abrupt("return",(this.pendingRead.delete(t),I.forEach((function(e){return e(_)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&Mf().removeDataId(t,this),this.pendingDeletes--),_));case 32:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readToGPU",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.texData.get(e),r=n.values,a=n.shape,i=n.slice,o=n.dtype,s=n.isPacked,u=n.texture;if("complex64"===o)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=i){var c;c=s?new HG(a,FG):new RG(a,FG);var l=this.runWebGLProgram(c,[{dataId:e,shape:a,dtype:o}],o),d=this.readToGPU(l,t);return this.disposeIntermediateTensorInfo(l),d}if(null==u)throw null!=r?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");var h=this.decode(e,t.customTexShape),p=Mf().makeTensorFromTensorInfo(h),f=this.texData.get(h.dataId);return Object.assign({tensorRef:p},f.texture)}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId);if("string"===e.dtype)try{var n=t.map((function(e){return sh(e)}));return df(e.shape,e.dtype,n)}catch(r){throw new Error("Failed to decode encoded string bytes into utf-8")}return df(e.shape,e.dtype,t)}},{key:"checkNumericalProblems",value:function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!WO(n))throw Qs().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value ".concat(n," cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'")):Error("The value ".concat(n," cannot be represented on this device."))}}},{key:"getValuesFromTexture",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.isPacked,i=fs(n);if(Qs().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var o,s=this.decode(e),u=this.texData.get(s.dataId),c=(o=this.gpgpu).downloadMatrixFromPackedTexture.apply(o,[u.texture.texture].concat(b(OO(n)))).subarray(0,i);return this.disposeIntermediateTensorInfo(s),c}var l=Qs().getBool("WEBGL_PACK")&&!0===a,d=l?tz(n):n,h=l?new zz(d):new Oz(d),p=this.runWebGLProgram(h,[{shape:d,dtype:r,dataId:e}],"float32"),f=this.texData.get(p.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(f.texture.texture,f.texShape[0],f.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(p),m}},{key:"timerAvailable",value:function(){return Qs().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}},{key:"time",value:function(e){var t=this,n=this.activeTimers,r=[],a=!1;null==this.programTimersStack?(this.programTimersStack=r,a=!0):this.activeTimers.push(r),this.activeTimers=r,e();var i=ps(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),o=ps(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e}));this.activeTimers=n,a&&(this.programTimersStack=null);var s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return S(w().mark((function e(){var n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Qs().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=7;break}return e.next=3,Promise.all(i);case 3:n=e.sent,s.kernelMs=cs(n),s.getExtraProfileInfo=function(){return n.map((function(e,t){return{name:o[t],ms:e}})).map((function(e){return"".concat(e.name,": ").concat(e.ms)})).join(", ")},e.next=8;break;case 7:s.kernelMs={error:"WebGL query timers are not supported in this environment."};case 8:return e.abrupt("return",(t.uploadWaitMs=0,t.downloadWaitMs=0,s));case 9:case"end":return e.stop()}}),e)})))()}},{key:"memory",value:function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}},{key:"startTimer",value:function(){return Qs().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:ah(),endMs:null}}},{key:"endTimer",value:function(e){return Qs().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=ah(),e)}},{key:"getQueryTime",value:function(){var e=S(w().mark((function e(t){var n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Qs().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=2;break}return e.abrupt("return",this.gpgpu.waitForQueryAndGetTime(t));case 2:return n=t,e.abrupt("return",n.endMs-n.startMs);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);var n=this.texData.get(e).complexTensorInfos;return null!=n&&(this.disposeData(n.real.dataId,t),this.disposeData(n.imag.dataId,t)),this.texData.delete(e),!0}},{key:"releaseGPUData",value:function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,a=t.texShape,i=t.usage,o=t.isPacked,s=t.slice,u=s&&s.origDataId||e,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(a,r),this.textureManager.releaseTexture(n,a,i,o)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null}},{key:"getTexture",value:function(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}},{key:"getDataInfo",value:function(e){return this.texData.get(e)}},{key:"shouldExecuteOnCPU",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:YG;return Qs().getBool("WEBGL_CPU_FORWARD")&&e.every((function(e){return null==t.texData.get(e.dataId).texture&&fs(e.shape)<n}))}},{key:"getGPGPUContext",value:function(){return this.gpgpu}},{key:"where",value:function(e){cd("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return KG(e.shape,t)}},{key:"packedUnaryOp",value:function(e,t,n){var r=new HG(e.shape,t),a=this.compileAndRun(r,[e],n);return Mf().makeTensorFromTensorInfo(a)}},{key:"abs",value:function(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){var t=uG(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(Qs().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,PG,e.dtype);var n=new RG(e.shape,PG),r=this.compileAndRun(n,[e]);return Mf().makeTensorFromTensorInfo(r)}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&Rs(n[0])){var a=n.map((function(e){return oh(e)}));r=this.write(a,e,t)}else r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}},{key:"makeOutput",value:function(e,t,n){return Mf().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,n),this)}},{key:"unpackTensor",value:function(e){var t=new ZG(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}},{key:"packTensor",value:function(e){var t=new _G(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}},{key:"packedReshape",value:function(e,t){var n=[$O(e.shape)].concat(b(ez(e.shape))),r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[$O(t)].concat(b(ez(t))),i=new IG(a,n),o=[n],s=this.runWebGLProgram(i,[r],e.dtype,o,!0);return{dataId:s.dataId,shape:t,dtype:s.dtype}}},{key:"decode",value:function(e,t){var n=this.texData.get(e),r=n.isPacked,a=n.shape,i=n.dtype;null!=t&&ls(fs(a)<=t[0]*t[1]*4,(function(){return"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."}));var o,s=tz(a);o=r?new Dz(s):new Pz(s);var u=[null!==t&&void 0!==t?t:OO(s)];return{dtype:i,shape:a,dataId:this.runWebGLProgram(o,[{shape:s,dtype:i,dataId:e}],i,u,!0,t).dataId}}},{key:"runWebGLProgram",value:function(e,t,n,r){var a=this,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0,s=this.makeTensorInfo(e.outputShape,n),u=this.texData.get(s.dataId);if(e.packedOutput&&(u.isPacked=!0),e.outPackingScheme===MO.DENSE){var c=null!==o&&void 0!==o?o:OO(e.outputShape);u.texShape=c.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(u.usage=e.outTexUsage),0===fs(s.shape))return u.values=Ss(s.dtype,0),s;var l=[],d=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&fs(t.shape)<=Qs().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}if(a.uploadToGPU(t.dataId),!!n.isPacked!=!!e.packedInputs)t=n.isPacked?a.unpackTensor(t):a.packTensor(t),l.push(t),n=a.texData.get(t.dataId);else if(n.isPacked&&!rz(n.shape,t.shape)){var r=t,i=t.shape;t.shape=n.shape,t=a.packedReshape(t,i),l.push(t),n=a.texData.get(t.dataId),r.shape=i}return{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(s.dataId);var h,p={shape:s.shape,texData:u,isUniform:!1},f=function(e,t,n){var r="";t.concat(n).forEach((function(t){var a=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!t.isUniform){var i=t.texData.texShape,o=Ez(e.packedInputs,t.shape,i),s=o.useSqueezeShape,u=o.uniformShape,c=o.keptDims,l="",d="",h="";if(1===u.length&&e.packedInputs){var p=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];l="".concat(p[0]>1,"_").concat(p[1]>1)}else if(2!==u.length||e.packedInputs){if(u.length>2&&!e.packedInputs){var f=zs(u);h="".concat(f[0]===i[1],"_").concat(f[f.length-1]===i[1])}}else d="".concat(u[0]>1,"_").concat(u[1]>1);var m=t.shape.length,v=2===u.length&&ms(t.shape,i),g=1===fs(t.shape),y=Wf(t.shape,n.shape),b=!e.packedInputs&&m===n.shape.length&&ms(i,n.texData.texShape),x=e.packedInputs||u.length>2?"":"".concat(i[0]>1,"_").concat(i[1]>1);r+="".concat(m,"_").concat(b,"_").concat(s?c:"","_").concat(u.length,"_").concat(g,"_").concat(y,"_").concat(v,"_").concat(l,"_").concat(d,"_").concat(h,"_").concat(x,"_").concat(a)}else{var w=t.isUniform?"uniform":t.texData.texShape;r+="".concat(t.shape,"_").concat(w,"_").concat(a)}}));var a=e.userCode,i=e.constructor.name;return i+"_"+r+"_"+a+"".concat(Qs().getNumber("WEBGL_VERSION"))}(e,d,p),m=this.getAndSaveBinary(f,(function(){return Nz(a.gpgpu,e,d,p)})),v=null!=this.activeTimers;v&&(h=this.startTimer()),Qs().get("ENGINE_COMPILE_ONLY")||function(e,t,n,r,a){t.program.enableShapeUniforms||(Lz(t.inShapeInfos,n),Lz([t.outShapeInfo],[r]));var i=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):e.setOutputMatrixTexture(i.texture,o[0],o[1]),e.setProgram(t.webGLProgram),1===Qs().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((function(n,r){var a=t.program.variableNames[r],i=t.uniformLocations[a],o=t.uniformLocations["offset".concat(a)],s=t.inShapesLocations["".concat(a,"Shape")],u=t.inTexShapesLocations["".concat(a,"TexShape")];if(s){var c=Ez(t.program.packedInputs,n.shape,n.texData.texShape).uniformShape;switch(c.length){case 1:e.gl.uniform1iv(s,new Int32Array(c));break;case 2:e.gl.uniform2iv(s,new Int32Array(c));break;case 3:e.gl.uniform3iv(s,new Int32Array(c));break;case 4:e.gl.uniform4iv(s,new Int32Array(c))}}if(u&&e.gl.uniform2i(u,n.texData.texShape[0],n.texData.texShape[1]),null!=i){if(n.isUniform){if(fs(n.shape)<2)e.gl.uniform1f(i,n.uniformValues[0]);else{var l=n.uniformValues;l instanceof Float32Array||(l=new Float32Array(l)),e.gl.uniform1fv(i,l)}return}null!=n.texData.slice&&null!=o&&e.gl.uniform1i(o,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture.texture,i,r)}}));var s=t.outShapeLocation;if(s)switch(r.shape.length){case 1:e.gl.uniform1iv(s,new Int32Array(r.shape));break;case 2:e.gl.uniform2iv(s,new Int32Array(r.shape));break;case 3:e.gl.uniform3iv(s,new Int32Array(r.shape));break;case 4:e.gl.uniform4iv(s,new Int32Array(r.shape))}if(t.outShapeStridesLocation){var u=zs(r.shape);switch(r.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(u));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(u));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(u))}}t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&a&&t.program.customUniforms.forEach((function(n,r){var i=t.customUniformLocations[r],o=a[r];if("float"===n.type)e.gl.uniform1fv(i,o);else if("vec2"===n.type)e.gl.uniform2fv(i,o);else if("vec3"===n.type)e.gl.uniform3fv(i,o);else if("vec4"===n.type)e.gl.uniform4fv(i,o);else if("int"===n.type)e.gl.uniform1iv(i,o);else if("ivec2"===n.type)e.gl.uniform2iv(i,o);else if("ivec3"===n.type)e.gl.uniform3iv(i,o);else{if("ivec4"!==n.type)throw Error("uniform type ".concat(n.type," is not supported yet."));e.gl.uniform4iv(i,o)}})),e.executeProgram()}(this.gpgpu,m,d,p,r),l.forEach((function(e){return a.disposeIntermediateTensorInfo(e)})),v&&(h=this.endTimer(h),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(h)}));var g=Qs().get("WEBGL_FLUSH_THRESHOLD");if(g>0){var y=ah();y-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!Qs().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&!1===i){var b=this.unpackTensor(s);return this.disposeIntermediateTensorInfo(s),b}return s}},{key:"compileAndRun",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return n=n||t[0].dtype,this.runWebGLProgram(e,t,n,r,a)}},{key:"getAndSaveBinary",value:function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}},{key:"getTextureManager",value:function(){return this.textureManager}},{key:"dispose",value:function(){var e=this;this.disposed||(Qs().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]})),this.textureManager.dispose(),null!=this.canvas&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}},{key:"floatPrecision",value:function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Rf((function(){if(!Qs().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=Qs().getBool("DEBUG");Qs().set("DEBUG",!1);var n=e.abs(ng(1e-8)).dataSync()[0];if(Qs().set("DEBUG",t),n>0)return 32}return 16}))),this.floatPrecisionValue}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"uploadToGPU",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.values,o=t.texture,s=t.usage,u=t.isPacked;if(null==o){var c,l=null!=this.activeTimers;l&&(c=ah());var d=t.texShape;if(null==d&&(d=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Qs().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=Qs().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");r===1/0&&Qs().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=n/2),t&&(n*=2,r*=2,e=e.map((function(t,n){return n>=e.length-2?ss(e[n]):e[n]})),1===e.length&&(e=[2,e[0]])),2!==e.length&&(e=ks(e).newShape);var a=fs(e),o=null;e.length<=1&&a<=n?o=[1,a]:2===e.length&&e[0]<=n&&e[1]<=n?o=e:3===e.length&&e[0]*e[1]<=n&&e[2]<=n?o=[e[0]*e[1],e[2]]:3===e.length&&e[0]<=n&&e[1]*e[2]<=n?o=[e[0],e[1]*e[2]]:4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n?o=[e[0]*e[1]*e[2],e[3]]:4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n&&(o=[e[0],e[1]*e[2]*e[3]]);var s=null!=o&&Math.max.apply(Math,b(o))>r&&Math.min.apply(Math,b(o))<=(t?2:1)&&Math.min.apply(Math,b(o))>0;if(null==o||s)if(t){var u,c=$O(e),l=2,d=2;e.length&&(l=(u=i(ez(e),2))[0],d=u[1]),o=gs(a=c*(l/2)*(d/2)).map((function(e){return 2*e}))}else o=gs(a);return o}(n,u),t.texShape=d),null!=a){var h,p,f=tz(n),m=d[1],v=d[0],g=a instanceof Uint8Array||a instanceof Uint8ClampedArray;(u||!g)&&(m=(h=i(zO(d[0],d[1]),2))[0],v=h[1]),p=u?new Gz(f,g):new Fz(f,g);var y=g?[v,m]:d,x=this.makeTensorInfo(y,r),w=this.texData.get(x.dataId);w.usage=g?NO.PIXELS:NO.UPLOAD,w.texShape=y,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(x.dataId),m,v,a);var k=[[v,m]],S=this.runWebGLProgram(p,[x],r,k,!0),T=this.texData.get(S.dataId);t.texShape=T.texShape,t.isPacked=T.isPacked,t.usage=T.usage,Qs().get("ENGINE_COMPILE_ONLY")?this.disposeData(S.dataId):(t.texture=T.texture,t.values=null,this.texData.delete(S.dataId)),this.disposeIntermediateTensorInfo(x),l&&(this.uploadWaitMs+=ah()-c)}else{var _=this.acquireTexture(d,s,r,u);t.texture=_}}}},{key:"convertAndCacheOnCPU",value:function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype ".concat(t))}(t,r)),n.values}},{key:"acquireTexture",value:function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(a," MB, most likely due to a memory leak"))}return this.textureManager.acquireTexture(e,t,r)}},{key:"computeBytes",value:function(e,t){return e[0]*e[1]*Ms(t)}},{key:"checkCompileCompletion",value:function(){for(var e=0,t=Object.entries(this.binaryCache);e<t.length;e++){var n=i(t[e],2)[1];this.checkCompletion_(n)}}},{key:"checkCompileCompletionAsync",value:function(){var e=S(w().mark((function e(){var t,n,r,a,o,s,u,c,l=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],!this.gpgpu.parallelCompilationExtension){e.next=6;break}for(n=0,r=Object.entries(this.binaryCache);n<r.length;n++)a=i(r[n],2),o=a[1],t.push(this.checkCompletionAsync_(o));return e.abrupt("return",Promise.all(t));case 6:s=w().mark((function e(){var n,r,a;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=i(c[u],2),r=n[1],a=new Promise((function(e){try{l.checkCompletion_(r),e(!0)}catch(t){throw t}})),t.push(a);case 3:case"end":return e.stop()}}),e)})),u=0,c=Object.entries(this.binaryCache);case 8:if(!(u<c.length)){e.next=13;break}return e.delegateYield(s(),"t0",10);case 10:u++,e.next=8;break;case 13:return e.abrupt("return",Promise.all(t));case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"checkCompletionAsync_",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)){e.next=4;break}e.t0=this.checkCompletion_(t),e.next=7;break;case 4:return e.next=6,Ux();case 6:e.t0=this.checkCompletionAsync_(t);case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkCompletion_",value:function(e){if(!1===this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS))throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)?(HO(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}},{key:"getUniformLocations",value:function(){for(var e=0,t=Object.entries(this.binaryCache);e<t.length;e++){var n=i(t[e],2)[1],r=Rz(this.gpgpu,n.program,n.webGLProgram),a=r.uniformLocations,o=r.customUniformLocations,s=r.infLoc,u=r.nanLoc,c=r.inShapesLocations,l=r.inTexShapesLocations,d=r.outShapeLocation,h=r.outShapeStridesLocation,p=r.outTexShapeLocation;n.uniformLocations=a,n.customUniformLocations=o,n.infLoc=s,n.nanLoc=u,n.inShapesLocations=c,n.inTexShapesLocations=l,n.outShapeLocation=d,n.outShapeStridesLocation=h,n.outTexShapeLocation=p}}}]),n}(rs);QG.nextDataId=0,Kh()&&Pf("webgl",(function(){return new QG}),2);var JG="\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n",qG=E((function e(t,n,r){T(this,e),this.variableNames=["A","B"],this.outputShape=Uf(n,r),this.enableShapeUniforms=Az(this.outputShape.length),this.userCode="\n      float binaryOperation(float a, float b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    ")})),$G="\n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n",eW=E((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];T(this,e),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Uf(n,r);var i=this.outputShape.length;this.enableShapeUniforms=Az(i);var o="";if(a)if(0===i||1===fs(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(o="\n          ".concat(Iz(i)," coords = getOutputCoords();\n        "),1===i)this.enableShapeUniforms?o+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":o+="\n            result.y = (coords + 1) >= ".concat(this.outputShape[0]," ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ");else{var s=TG("coords",i);this.enableShapeUniforms?o+="\n            bool nextRowOutOfBounds =\n              (".concat(s[i-2]," + 1) >= outShape[").concat(i," - 2];\n            bool nextColOutOfBounds =\n              (").concat(s[i-1]," + 1) >= outShape[").concat(i," - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "):o+="\n            bool nextRowOutOfBounds =\n              (".concat(s[i-2]," + 1) >= ").concat(this.outputShape[i-2],";\n            bool nextColOutOfBounds =\n              (").concat(s[i-1]," + 1) >= ").concat(this.outputShape[i-1],";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          ")}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ").concat(o,"\n\n        setOutput(result);\n      }\n    ")}));function tW(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var nW={kernelName:mc,backendName:"webgl",kernelFunc:tW};function rW(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(i.dataId),s=tW({inputs:{x:r},backend:n}),u=tW({inputs:{x:a},backend:n});return o.complexTensorInfos={real:s,imag:u},i}var aW={kernelName:Eu,backendName:"webgl",kernelFunc:rW},iW="return (a < 0.) ? b * a : a;",oW="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";var sW={kernelName:wc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.alpha,o=n.makeTensorInfo([],"float32",nh(i,"float32")),s=Qs().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new eW(oW,a.shape,o.shape):new qG(iW,a.shape,o.shape),u=n.runWebGLProgram(s,[a,o],"float32");return n.disposeIntermediateTensorInfo(o),u}},uW="return (a < 0.) ? b * a : a;",cW="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";var lW={kernelName:rl,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha,i=Qs().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new eW(cW,r.shape,a.shape):new qG(uW,r.shape,a.shape);return n.runWebGLProgram(i,[r,a],"float32")}},dW="if (isnan(x)) return x;";function hW(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.cpuKernelImpl,a=e.dtype;return function(e){var i,o=e.inputs,s=e.backend,u=o.x,c=s,l=a||u.dtype;if(c.shouldExecuteOnCPU([u])&&null!=r){var d=c.texData.get(u.dataId),h=r(d.values,l);return c.makeTensorInfo(u.shape,l,h)}return i=Qs().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=n?new HG(u.shape,n):new RG(u.shape,t),c.runWebGLProgram(i,[u],l)}}function pW(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.checkOutOfBounds,a=void 0!==r&&r,o=e.supportsComplex,s=void 0!==o&&o,u=e.cpuKernelImpl,c=e.dtype;return function(e){var r=e.inputs,o=e.backend,l=r.a,d=r.b,h=o;if(s&&"complex64"===l.dtype){var p=h.texData.get(l.dataId),f=h.texData.get(d.dataId),m=[[p.complexTensorInfos.real,f.complexTensorInfos.real],[p.complexTensorInfos.imag,f.complexTensorInfos.imag]].map((function(e){var n=i(e,2),r=n[0],a=n[1],o={dataId:r.dataId,dtype:r.dtype,shape:l.shape},s={dataId:a.dataId,dtype:a.dtype,shape:d.shape},u=new qG(t,l.shape,d.shape);return h.runWebGLProgram(u,[o,s],Rh(r.dtype,a.dtype))})),v=i(m,2),g=v[0],y=v[1],b=rW({inputs:{real:g,imag:y},backend:h});return h.disposeIntermediateTensorInfo(g),h.disposeIntermediateTensorInfo(y),b}var x,w=c||Rh(l.dtype,d.dtype);if(("string"===l.dtype||"string"===d.dtype||h.shouldExecuteOnCPU([l,d]))&&null!=u){var k=h.texData.get(l.dataId).values,S=h.texData.get(d.dataId).values,T="string"===l.dtype?Zw(k):k,_="string"===l.dtype?Zw(S):S,I=i(u(l.shape,d.shape,T,_,w),2),E=I[0],C=I[1],M=h.makeTensorInfo(C,w);return h.texData.get(M.dataId).values=E,M}return x=Qs().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=n?new eW(n,l.shape,d.shape,a):new qG(t,l.shape,d.shape),h.runWebGLProgram(x,[l,d],w)}}function fW(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("linear"===e)return t?WG:AG;if("relu"===e)return t?UG:OG;if("elu"===e)return t?VG:DG;if("relu6"===e)return t?XG:zG;if("prelu"===e)return t?cW:uW;if("leakyrelu"===e)return t?oW:iW;if("sigmoid"===e)return t?BG:GG;throw new Error("Activation ".concat(e," has not been implemented for the WebGL backend."))}var mW=E((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]&&arguments[8];T(this,e),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=Az(this.outputShape.length);var l=a?t[1]:t[2],d=Math.ceil(l/2),h=a?"i * 2, rc.y":"rc.y, i * 2",p=i?"rc.z, i * 2":"i * 2, rc.z",f=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],v="",g="";s&&(v=u?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(s,"\n        }"):c?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(s,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(s,"\n        }"),g="result = activation(result);");var y=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");var b="rc.x",x="rc.x";t[0]<n[0]?b="int(min(float(rc.x), ".concat(t[0]-1,".))"):n[0]<t[0]&&(x="int(min(float(rc.x), ".concat(n[0]-1,".))")),this.userCode="\n      ".concat(v,"\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ").concat(d,".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < ").concat(d,"; i++) {\n          int batchA = ").concat(b,";\n          int batchB = ").concat(x,";\n          vec4 a = getMatrixA(batchA, ").concat(h,");\n          vec4 b = getMatrixB(batchB, ").concat(p,");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (").concat(f[0]," * ").concat(m[0],");\n          result += (").concat(f[1]," * ").concat(m[1],");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ").concat(y,"\n\n        ").concat(g,"\n\n        setOutput(result);\n      }\n    ")})),vW={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},gW=E((function e(t,n,r){T(this,e),this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Uf(n,r),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    ")})),yW="return a * b;";function bW(e){var t,n=e.inputs,r=e.backend,a=n.a,o=n.b,s=Rh(a.dtype,o.dtype);if("complex64"===a.dtype){var u=r.texData.get(a.dataId),c=r.texData.get(o.dataId),l=new gW(vW.REAL,a.shape,o.shape),d=new gW(vW.IMAG,a.shape,o.shape),h=[{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:a.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:a.shape},{dataId:c.complexTensorInfos.real.dataId,dtype:c.complexTensorInfos.real.dtype,shape:o.shape},{dataId:c.complexTensorInfos.imag.dataId,dtype:c.complexTensorInfos.imag.dtype,shape:o.shape}],p=r.runWebGLProgram(l,h,"float32"),f=r.runWebGLProgram(d,h,"float32"),m=rW({inputs:{real:p,imag:f},backend:r});return r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(f),m}if(r.shouldExecuteOnCPU([a,o])){var v=r.texData.get(a.dataId),g=r.texData.get(o.dataId),y=i(qF(a.shape,o.shape,v.values,g.values,s),2),b=y[0],x=y[1],w=r.makeTensorInfo(x,s);return r.texData.get(w.dataId).values=b,w}return t=Qs().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new eW(yW,a.shape,o.shape):new qG(yW,a.shape,o.shape),r.runWebGLProgram(t,[a,o],s)}var xW={kernelName:Zc,backendName:"webgl",kernelFunc:bW};function wW(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.shape,o=n,s=fs(a.shape),u=xs(i,s),c=fs(u);ls(s===c,(function(){return"The new shape (".concat(u,") has ").concat(c," elements and the old shape (").concat(a.shape,") has ").concat(s," elements. The new shape and old shape must have the same number of elements.")}));var l=o.texData.get(a.dataId);return!l.isPacked||rz(a.shape,u)||null!==l.texture&&rz(l.shape,u)?(o.incRef(a.dataId),{dataId:a.dataId,shape:u,dtype:a.dtype}):function(e,t,n){var r=[$O(e.shape)].concat(b(ez(e.shape))),a={dtype:e.dtype,shape:r,dataId:e.dataId},i=[$O(t)].concat(b(ez(t))),o=new IG(i,r),s=[r],u=n.runWebGLProgram(o,[a],e.dtype,s,!0);return{dataId:u.dataId,shape:t,dtype:u.dtype}}(a,u,o)}var kW={kernelName:dl,backendName:"webgl",kernelFunc:wW},SW=E((function e(t,n){T(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s=4*Math.floor(r/4),u=r%4,c="sumValue += dot(values, ones);";if(null!=n){var l=1/n;c="sumValue += dot(values * ".concat(vs(l)?l.toPrecision(2):l,", ones);")}var d="";i%r>0&&(d="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return 0.0;\n        }\n      ")),this.userCode="\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ".concat(d,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(s,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(c,"\n        }\n\n        int inIdx = inOffset + ").concat(s,";\n        if (").concat(1===u,") {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(2===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(3===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ").concat(c,"\n        }\n        setOutput(sumValue);\n      }\n    ")})),TW=E((function e(t,n){T(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s="0.0",u="";"prod"===n?s="1.0":"min"===n?(s="1.0 / 1e-20",u="min"):"max"===n&&(s="-1.0 / 1e-20",u="max");var c="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"sum"===n?c="sumValue":"prod"===n?c="prodValue":"all"===n?c="allValue":"any"===n&&(c="anyValue");var l=4*Math.floor(r/4),d=r%4,h="\n      if (".concat("sum"===n,") {\n        sumValue += dot(values, ones);\n      } else if (").concat("prod"===n,") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ").concat(u,"(values, minMaxValue);\n        if (").concat("min"===n," || ").concat("max"===n,") {\n          minMaxValue = ").concat(u,"(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    "),p="vec4";"all"===n?(s="1.0",h="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",p="bvec4"):"any"===n&&(s="0.0",h="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",p="bvec4");var f="";i%r>0&&(f="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat(s,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ").concat(f,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        vec4 minMaxValue = vec4(").concat(s,");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ").concat(l,"; i += 4) {\n          int inIdx = inOffset + i;\n          ").concat(p," values = ").concat(p,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(h,"\n        }\n\n        int inIdx = inOffset + ").concat(l,";\n        if (").concat(1===d,") {\n          ").concat(p," values = ").concat(p,"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(h,"\n        } else if (").concat(2===d,") {\n          ").concat(p," values = ").concat(p,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(h,"\n        } else if (").concat(3===d,") {\n          ").concat(p," values = ").concat(p,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ").concat(h,"\n        }\n        setOutput(").concat(c,");\n      }\n    ")}));function _W(e,t,n,r){for(var a=function(e){for(var t=[];0===t.length||1!==t[t.length-1].outSize;){var n=t.length?t[t.length-1].outSize:e[1],r=Qx(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}(e.shape),i=e,o=0;o<a.length;o++){var s,u=a[o],c=u.inSize,l=u.windowSize,d=u.outSize,h=void 0;h="mean"===n?0===o?new SW({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:d},c):new SW({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:d}):new TW({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:d},n),s=i,i=r.runWebGLProgram(h,[i],t),s.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(s)}return i}var IW=E((function e(t,n){T(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];this.outputShape=r,this.rank=r.length;var i=Iz(this.rank),o=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank ".concat(t," is not yet supported"));for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}(n);this.userCode="\n    void main() {\n      ".concat(i," resRC = getOutputCoords();\n      setOutput(getA(").concat(o,"));\n    }\n    ")}));var EW=E((function e(t,n){T(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));for(var i=Iz(this.rank),o=SG("rc",this.rank),s=new Array(this.rank),u=0;u<n.length;u++)s[n[u]]=o[u];var c="vec2(".concat(s.slice(-2).join(),")"),l="++".concat(o[this.rank-1]," < ").concat(r[this.rank-1]),d="getChannel(getA(".concat(s.join(),"), ").concat(c,")");this.userCode="\n    void main() {\n      ".concat(i," rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ").concat(d,";\n      if(").concat(l,") {\n        result[1] = ").concat(d,";\n      }\n      --").concat(o[this.rank-1],";\n      if(++").concat(o[this.rank-2]," < ").concat(r[this.rank-2],") {\n        result[2] = ").concat(d,";\n        if(").concat(l,") {\n          result[3] = ").concat(d,";\n        }\n      }\n      setOutput(result);\n    }\n    ")}));function CW(e,t,n){var r=Qs().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new EW(e.shape,t):new IW(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function MW(e){var t=e.inputs,n=e.backend,r=e.attrs;return function(e,t,n,r){var a=t,o=e.shape.length,s=ws(a,e.shape),u=s,c=Qv(u,o),l=null!=c,d=e;l&&(d=CW(e,c,r),u=qv(u.length,o)),Yv("sum",u,o);var h=i(Kv(d.shape,u),2),p=h[0],f=h[1],m=p;n&&(m=jv(p,s));var v=fs(f),g=wW({inputs:{x:d},attrs:{shape:[fs(e.shape)/v,v]},backend:r}),y=_W(g,Lh(e.dtype),"sum",r),b=wW({inputs:{x:y},attrs:{shape:m},backend:r});return r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(y),l&&r.disposeIntermediateTensorInfo(d),b}(t.x,r.axis,r.keepDims,n)}var NW={kernelName:Rl,backendName:"webgl",kernelFunc:MW};function RW(e){for(var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.perm,s=r,u=i.shape.length,c=new Array(u),l=0;l<c.length;l++)c[l]=i.shape[o[l]];if(s.shouldExecuteOnCPU([i])){var d=s.texData.get(i.dataId).values,h=wG(d,i.shape,i.dtype,o,c);t=s.makeTensorInfo(c,i.dtype),s.texData.get(t.dataId).values=h}else t=CW(i,o,s);return t}var LW={kernelName:ql,backendName:"webgl",kernelFunc:RW},AW=1e3;function PW(e){var t=e.a,n=e.b,r=e.transposeA,a=e.transposeB,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,c=void 0===u?null:u,l=e.leakyreluAlpha,d=void 0===l?0:l,h=e.activation,p=void 0===h?null:h,f=t.shape.length,m=n.shape.length,v=r?t.shape[f-2]:t.shape[f-1],g=a?n.shape[m-1]:n.shape[m-2],y=r?t.shape[f-1]:t.shape[f-2],b=a?n.shape[m-2]:n.shape[m-1],x=t.shape.slice(0,-2),w=n.shape.slice(0,-2),k=fs(x),S=fs(w),T=Uf(t.shape.slice(0,-2),n.shape.slice(0,-2)).concat([y,b]);ls(v===g,(function(){return"Error in matMul: inner shapes (".concat(v,") and (").concat(g,") of Tensors with shapes ").concat(t.shape," and ").concat(n.shape," and transposeA=").concat(r," and transposeB=").concat(a," must match.")}));var _,I=r?[k,v,y]:[k,y,v],E=a?[S,b,g]:[S,g,b],C=wW({inputs:{x:t},backend:i,attrs:{shape:I}}),M=wW({inputs:{x:n},backend:i,attrs:{shape:E}}),N=[C,M],R=Math.max(k,S),L=r?C.shape[1]:C.shape[2],A=null!=s,P=null!=c,D="leakyrelu"===p,O=null!=p?fW(p,!0):null;if((1===y||1===b)&&L>AW&&!1===(A||P||D||null!=O)){var z=C,F=M;r&&(z=RW({inputs:{x:C},backend:i,attrs:{perm:[0,2,1]}}),N.push(z)),a&&(F=RW({inputs:{x:M},backend:i,attrs:{perm:[0,2,1]}}),N.push(F));var G=1===b,W=z;1!==b&&(W=wW({inputs:{x:z},backend:i,attrs:{shape:[R,L,1]}}),N.push(W));var V=1===b?2:1,U=F;G&&(U=wW({inputs:{x:F},backend:i,attrs:{shape:[R,1,L]}}),N.push(U));var X=bW({inputs:{a:W,b:U},backend:i});_=MW({inputs:{x:X},backend:i,attrs:{axis:V,keepDims:!0}}),N.push(X)}else{var B=Rh(t.dtype,n.dtype),H=new mW(I,E,[R,y,b],r,a,A,O,P,D),Z=[C,M];if(null!=s&&Z.push(s),P&&Z.push(c),D){var K=i.makeTensorInfo([],"float32",nh(d,"float32"));Z.push(K),N.push(K)}_=i.runWebGLProgram(H,Z,B)}var j=wW({inputs:{x:_},backend:i,attrs:{shape:T}});N.push(_);for(var Y=0,Q=N;Y<Q.length;Y++){var J=Q[Y];i.disposeIntermediateTensorInfo(J)}return j}var DW={kernelName:od,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=t.bias,s=t.preluActivationWeights,u=r.transposeA,c=r.transposeB,l=r.activation;return PW({a:a,b:i,transposeA:u,transposeB:c,backend:n,bias:o,preluActivationWeights:s,leakyreluAlpha:r.leakyreluAlpha,activation:l})}},OW="return abs(x);";var zW={kernelName:tu,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])&&"complex64"!==a.dtype){var i=r.texData.get(a.dataId),o=uG(i.values);return r.makeTensorInfo(a.shape,a.dtype,o)}return t=Qs().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new HG(a.shape,OW):new RG(a.shape,OW),r.runWebGLProgram(t,[a],a.dtype)}},FW=hW({opSnippet:LG+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"}),GW={kernelName:nu,backendName:"webgl",kernelFunc:FW},WW=hW({opSnippet:LG+"\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"}),VW={kernelName:ru,backendName:"webgl",kernelFunc:WW},UW="return a + b;",XW=pW({opSnippet:UW,packedOpSnippet:UW,supportsComplex:!0,cpuKernelImpl:RF}),BW={kernelName:au,backendName:"webgl",kernelFunc:XW},HW=E((function e(t,n){T(this,e),this.outputShape=[],this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("float v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        float result = ").concat(a,";\n        setOutput(result);\n      }\n    ")})),ZW=E((function e(t,n){T(this,e),this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("vec4 v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        vec4 result = ").concat(a,";\n        setOutput(result);\n      }\n    ")}));var KW={kernelName:iu,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n;if(1===a.length)return tW({inputs:{x:a[0]},backend:r});if(a.length>Qs().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(a.length/2),o=e({inputs:a.slice(0,i),backend:r}),s=e({inputs:a.slice(i),backend:r});return e({inputs:[o,s],backend:r})}var u=a.map((function(e){return e.dtype})).reduce((function(e,t){return Rh(e,t)})),c=a.map((function(e){return e.shape})),l=Qs().getBool("WEBGL_PACK")?new ZW(a[0].shape,c):new HW(a[0].shape,c);return r.runWebGLProgram(l,a,u)}};var jW={kernelName:ou,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.keepDims,u=a.shape.length,c=ws(o,a.shape),l=c,d=Qv(l,u),h=a;null!=d&&(h=RW({inputs:{x:a},backend:n,attrs:{perm:d}}),l=qv(l.length,u)),Yv("all",l,u);var p,f=i(Kv(h.shape,l),2),m=f[0],v=wW({inputs:{x:h},backend:n,attrs:{shape:[-1,fs(f[1])]}}),g=_W(v,v.dtype,"all",n);return p=wW(s?{inputs:{x:g},backend:n,attrs:{shape:jv(m,c)}}:{inputs:{x:g},backend:n,attrs:{shape:m}}),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),null!=d&&n.disposeIntermediateTensorInfo(h),p}};var YW={kernelName:su,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.keepDims,u=a.shape.length,c=ws(o,a.shape),l=c,d=Qv(l,u),h=a;null!=d&&(h=RW({inputs:{x:a},backend:n,attrs:{perm:d}}),l=qv(l.length,u)),Yv("any",l,u);var p,f=i(Kv(h.shape,l),2),m=f[0],v=wW({inputs:{x:h},backend:n,attrs:{shape:[-1,fs(f[1])]}}),g=_W(v,v.dtype,"any",n);return p=wW(s?{inputs:{x:g},backend:n,attrs:{shape:jv(m,c)}}:{inputs:{x:g},backend:n,attrs:{shape:m}}),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),null!=d&&n.disposeIntermediateTensorInfo(h),p}},QW=E((function e(t,n,r){T(this,e),this.variableNames=["A"];var a=t.windowSize,i=t.batchSize,o=t.outSize;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var s="max"===n?">":"<",u=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ".concat(a,";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          int inIdx = ").concat(u,";\n          float candidate = getA(batch, inIdx);\n          if (candidate ").concat(s," bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    ")})),JW=E((function e(t,n,r,a){T(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,ls(t.length>2,(function(){return"Packed arg".concat(r.charAt(0).toUpperCase()+r.slice(1)," supports only inputs with rank above 2.")}));var i=t[t.length-1],o=Math.ceil(i/n);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),a||this.variableNames.push("bestIndicesA");var s,u,c=this.outputShape,l=c.length,d=Iz(l),h=TG("coords",l);if(1===o){var p=Iz(u=l+1);s="\n        ".concat(p," sourceLocR = ").concat(p,"(").concat(h.join(),", 0);\n        ++").concat(h[l-1],";\n        ").concat(p," sourceLocG = ").concat(p,"(").concat(h.join(),", 0);\n        ++").concat(h[l-2],";\n        ").concat(p," sourceLocA = ").concat(p,"(").concat(h.join(),", 0);\n        --").concat(h[l-1],";\n        ").concat(p," sourceLocB = ").concat(p,"(").concat(h.join(),", 0);\n        --").concat(h[l-2],";")}else u=l,s="\n        ".concat(d," sourceLocR = coords;\n        ++").concat(h[l-1],";\n        ").concat(d," sourceLocG = coords;\n        ++").concat(h[l-2],";\n        ").concat(d," sourceLocA = coords;\n        --").concat(h[l-1],";\n        ").concat(d," sourceLocB = coords;\n        --").concat(h[l-2],";");var f=["x","y","z","w","u","v"].slice(0,u),m="."+f[u-1],v=f.map((function(e){return"int "+e})),g=TG("sourceLocR",u-1).concat("inIdx.r"),y=TG("sourceLocG",u-1).concat("inIdx.g"),b=TG("sourceLocB",u-1).concat("inIdx.b"),x=TG("sourceLocA",u-1).concat("inIdx.a"),w="max"===r?"greaterThan":"lessThan",k=a?"":"\n          inIdx = round(vec4(getBestIndicesAChannel(".concat(g.join(),"),\n                             getBestIndicesAChannel(").concat(y.join(),"),\n                             getBestIndicesAChannel(").concat(b.join(),"),\n                             getBestIndicesAChannel(").concat(x.join(),")));"),S="vec4(\n            getAChannel(".concat(g.join(),"),\n            hasNextCol ? getAChannel(").concat(y.join(),") : 0.,\n            hasNextRow ? getAChannel(").concat(b.join(),") : 0.,\n            hasNextRow && hasNextCol ? getAChannel(").concat(x.join(),") : 0.)"),_=a?"":"\n      float getBestIndicesAChannel(".concat(v.join(),") {\n        return getChannel(getBestIndicesA(").concat(f.join(),"),\n                                          vec2(").concat(f.slice(-2).join(),"));\n      }");this.userCode="\n      float getAChannel(".concat(v.join(),") {\n        return getChannel(getA(").concat(f.join(),"),\n                               vec2(").concat(f.slice(-2).join(),"));\n      }\n      ").concat(_,"\n      void main() {\n        ").concat(d," coords = getOutputCoords();\n        bool hasNextCol = ").concat(h[l-1]," < ").concat(c[l-1]-1,";\n        bool hasNextRow = ").concat(h[l-2]," < ").concat(c[l-2]-1,";\n        ").concat(s,"\n        ivec4 srcIdx = ivec4(sourceLocR").concat(m,", sourceLocG").concat(m,",\n          sourceLocB").concat(m,", sourceLocA").concat(m,") * ").concat(n,";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ").concat(S,";\n\n        for (int i = 0; i < ").concat(n,"; i++) {\n          inIdx = srcIdx;\n          ").concat(k,"\n          vec4 candidate = ").concat(S,";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(").concat(w,"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    ")}));function qW(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=t.shape[0],i=t.shape[1];null!=r&&(a=r.shape[0],i=r.shape[1]);var o=Qx(i),s={windowSize:o,inSize:i,batchSize:a,outSize:Math.ceil(i/o)},u=new QW(s,n,null==r),c=[t];null!=r&&c.push(r);var l=e.runWebGLProgram(u,c,"int32");if(1===l.shape[1])return l;var d=qW(e,t,n,l);return e.disposeIntermediateTensorInfo(l),d}function $W(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=null!=r?r.shape:t.shape,i=Qx(a[a.length-1]),o=new JW(a,i,n,null==r),s=null==r?[t]:[t,r],u=e.runWebGLProgram(o,s,"int32");if(u.shape.length===t.shape.length){var c=$W(e,t,n,u);return e.disposeIntermediateTensorInfo(u),c}return u}function eV(e,t,n,r){var a=[n];if(Yv("arg"+r.charAt(0).toUpperCase()+r.slice(1),a,t.shape.length),!Qs().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){var o=[],s=e.texData.get(t.dataId),u=t;null!==s&&s.isPacked&&(u=e.unpackTensor(t),o.push(u));var c=i(Kv(u.shape,a),2),l=c[0],d=fs(c[1]),h=wW({inputs:{x:u},backend:e,attrs:{shape:[-1,d]}});o.push(h);var p=qW(e,h,r);o.push(p);var f=wW({inputs:{x:p},backend:e,attrs:{shape:l}});return o.forEach((function(t){return e.disposeIntermediateTensorInfo(t)})),f}return $W(e,t,r)}var tV={kernelName:uu,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=ws(r.axis,a.shape),o=Qv(i,a.shape.length),s=a,u=[];null!=o&&(s=RW({inputs:{x:a},backend:n,attrs:{perm:o}}),u.push(s),i=qv(i.length,s.shape.length)),Yv("argMax",[i[0]],s.shape.length);var c=eV(n,s,i[0],"max");return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),c}};var nV={kernelName:cu,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=ws(r.axis,a.shape),o=Qv(i,a.shape.length),s=a,u=[];null!=o&&(s=RW({inputs:{x:a},backend:n,attrs:{perm:o}}),u.push(s),i=qv(i.length,s.shape.length)),Yv("argMin",[i[0]],s.shape.length);var c=eV(n,s,i[0],"min");return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),c}},rV=hW({opSnippet:LG+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"}),aV={kernelName:lu,backendName:"webgl",kernelFunc:rV},iV=hW({opSnippet:LG+"return log(x + sqrt(x * x + 1.0));"}),oV={kernelName:du,backendName:"webgl",kernelFunc:iV},sV=hW({opSnippet:LG+"\n  return atan(x);\n"}),uV={kernelName:hu,backendName:"webgl",kernelFunc:sV},cV=pW({opSnippet:JG+"\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+$G+"\n  return result;\n"}),lV={kernelName:fu,backendName:"webgl",kernelFunc:cV},dV=hW({opSnippet:LG+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"}),hV={kernelName:pu,backendName:"webgl",kernelFunc:dV},pV=E((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(T(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideHeight,u=t.strideWidth,c=t.dilationHeight,l=t.dilationWidth,d=t.effectiveFilterHeight,h=t.effectiveFilterWidth,p=t.padInfo.top,f=t.padInfo.left;this.outputShape=t.outShape;var m="avg"===n,v="((batch  * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),g="(xR * ".concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),y="0.0";if(m||(y="-1.0 / 1e-20"),r){this.userCode="\n        const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n        const ivec2 pads = ivec2(").concat(p,", ").concat(f,");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ").concat(d,";\n              wR += ").concat(c,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(h,";\n                wC += ").concat(l,") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ").concat(">="," currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ").concat(a?i?v:g:"wR * ".concat(h," + wC"),";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var b="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"avg"===n&&(b="avgValue / count");var x=4*Math.floor(o/4),w=o%4,k="\n      if (".concat(m,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat("max","(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n      const ivec2 pads = ivec2(").concat(p,", ").concat(f,");\n      const float initializationValue = ").concat(y,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(y,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ").concat(d,";\n            wR += ").concat(c,") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(x,"; wC += 4) {\n            int xC = xCCorner + wC * ").concat(l,";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              getValue(batch, xR, xC + 3 * ").concat(l,", d)\n            );\n\n            ").concat(k,"\n          }\n\n          int xC = xCCorner + ").concat(x,";\n          if (").concat(1===w,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(k,"\n          } else if (").concat(2===w,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(k,"\n          } else if (").concat(3===w,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              initializationValue\n            );\n\n            ").concat(k,"\n          }\n        }\n        setOutput(").concat(b,");\n      }\n    ")}})),fV=E((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(T(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideDepth,u=t.strideHeight,c=t.strideWidth,l=t.dilationDepth,d=t.dilationHeight,h=t.dilationWidth,p=t.effectiveFilterDepth,f=t.effectiveFilterHeight,m=t.effectiveFilterWidth,v=t.padInfo.front,g=t.padInfo.top,y=t.padInfo.left;this.outputShape=t.outShape;var b="avg"===n,x="0.0";if(b||(x="-1.0 / 1e-20"),r){this.userCode="\n        const ivec3 strides =\n            ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n        const ivec3 pads = ivec3(").concat(v,", ").concat(g,", ").concat(y,");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ").concat(p,";\n              wD += ").concat(l,") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int wR = 0; wR < ").concat(f,";\n                wR += ").concat(d,") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int wC = 0; wC < ").concat(m,";\n                  wC += ").concat(h,") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ").concat(">="," currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ").concat(a?i?"(((batch * ".concat(t.inDepth," + xD) * ").concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"((xD * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"wD * ".concat(f," * ").concat(m," +\n                      wR * ").concat(m," + wC"),";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var w="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"avg"===n&&(w="avgValue / count");var k=4*Math.floor(o/4),S=o%4,_="\n      if (".concat(b,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat("max","(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec3 strides =\n        ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n      const ivec3 pads = ivec3(").concat(v,", ").concat(g,", ").concat(y,");\n      const float initializationValue = ").concat(x,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(x,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ").concat(p,";\n            wD += ").concat(l,") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(f,";\n            wR += ").concat(d,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(k,"; wC += 4) {\n              int xC = xCCorner + wC * ").concat(h,";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(h,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(h,", ch),\n                getValue(batch, xD, xR, xC + 3 * ").concat(h,", ch)\n              );\n\n              ").concat(_,"\n            }\n\n            int xC = xCCorner + ").concat(k,";\n            if (").concat(1===S,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(_,"\n            } else if (").concat(2===S,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(h,", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(_,"\n            } else if (").concat(3===S,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(h,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(h,", ch),\n                initializationValue\n              );\n\n              ").concat(_,"\n            }\n          }\n          setOutput(").concat(w,");\n        }\n      }\n    ")}}));var mV={kernelName:mu,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;uz(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;ls($m(o,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(1,"'")}));var c=Xm(a.shape,i,o,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&ms(c.inShape,c.outShape))return tW({inputs:{x:a},backend:n});var l=new pV(c,"avg",!1);return n.runWebGLProgram(l,[a],"float32")}};var vV={kernelName:gu,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat,l=Bm(a.shape,i,o,[1,1,1],s,u,c),d=new fV(l,"avg",!1);return n.runWebGLProgram(d,[a],"float32")}},gV=E((function e(t){T(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=u-1-t.padInfo.top,d=c-1-t.padInfo.left,h=1/(n*r);this.userCode="\n      const ivec2 pads = ivec2(".concat(l,", ").concat(d,");\n      const float avgMultiplier = float(").concat(h,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(u,";\n            wR += ").concat(o,") {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(c,";\n            wC+= ").concat(s,") {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),yV=E((function e(t){T(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,d=t.effectiveFilterDepth,h=t.effectiveFilterHeight,p=t.effectiveFilterWidth,f=d-1-t.padInfo.front,m=h-1-t.padInfo.top,v=p-1-t.padInfo.left,g=1/(n*r*a);this.userCode="\n      const ivec3 pads = ivec3(".concat(f,", ").concat(m,", ").concat(v,");\n      const float avgMultiplier = float(").concat(g,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(d,";\n            wD += ").concat(u,") {\n          float dyD = float(dyDCorner + wD) / ").concat(i,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(h,";\n              wR += ").concat(c,") {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(p,";\n                wC += ").concat(l,") {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var bV={kernelName:yu,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=Bm(i.shape,o,s,[1,1,1],u,c),d=new yV(l);return n.runWebGLProgram(d,[a],i.dtype)}};var xV={kernelName:vu,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;uz([a,i],"avgPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=Xm(o.shape,s,u,1,c),d=new gV(l);return n.runWebGLProgram(d,[a],o.dtype)}};var wV={kernelName:bu,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;return PW({a:t.a,b:t.b,transposeA:r.transposeA,transposeB:r.transposeB,backend:n})}},kV=E((function e(t,n,r,a,i,o){T(this,e),this.outputShape=[],this.variableNames=["x","mean","variance"],Uf(t,n),Uf(t,r);var s="0.0";null!=a&&(Uf(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";null!=i&&(Uf(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ".concat(s,";\n        float scale = ").concat(u,";\n        float inv = scale * inversesqrt(variance + float(").concat(o,"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    ")})),SV=E((function e(t,n,r,a,i,o){T(this,e),this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Uf(t,n),Uf(t,r);var s="vec4(0.0)";null!=a&&(Uf(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="vec4(1.0)";null!=i&&(Uf(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = ".concat(s,";\n        vec4 scale = ").concat(u,";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(").concat(o,"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    ")})),TV={kernelName:lc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.mean,o=t.variance,s=t.offset,u=t.scale;ls(i.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),ls(null==s||i.shape.length===s.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),ls(null==u||i.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var c=r.varianceEpsilon;null==c&&(c=.001);var l=[a,i,o],d=null;null!=s&&(d=s.shape,l.push(s));var h=null;null!=u&&(h=u.shape,l.push(u));var p=Qs().getBool("WEBGL_PACK_NORMALIZATION")?new SV(a.shape,i.shape,o.shape,d,h,c):new kV(a.shape,i.shape,o.shape,d,h,c);return n.runWebGLProgram(p,l,l[0].dtype)}},_V=E((function e(t){T(this,e),this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var n=Iz(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var r,a=function(e){if(1===e)return"sourceLoc";if(e<=6)return IV.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank ".concat(e," is not yet supported"))}(this.rank),i=t.map((function(e,t){return"sourceLoc.".concat(IV[t]," = start[").concat(t,"] + coords.").concat(IV[t],";")}));r="\n        ".concat(n," sourceLoc;\n        ").concat(n," coords = getOutputCoords();\n        ").concat(i.join("\n"),"\n      "),this.userCode="\n      void main() {\n        ".concat(r,"\n        setOutput(getSource(").concat(a,"));\n      }\n    ")})),IV=["x","y","z","w","u","v"];var EV=E((function e(t){T(this,e),this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var n=Iz(this.rank),r=TG("coords",this.rank),a=TG("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2(".concat(a.slice(-2).join(),")"),o="getChannel(getSource(".concat(a.join(),"), ").concat(i,")"),s="\n      result.x = ".concat(o,";\n      if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n        ++").concat(a[this.rank-1],";\n        result.y = ").concat(o,";\n        --").concat(a[this.rank-1],";\n      }\n    "),u=1===this.rank?"":"\n      --".concat(r[this.rank-1],";\n      if (++").concat(r[this.rank-2]," < ").concat(t[this.rank-2],") {\n        ++").concat(a[this.rank-2],";\n        result.z = ").concat(o,";\n        if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n          ++").concat(a[this.rank-1],";\n          result.w = ").concat(o,";\n        }\n      }\n    "),c=this.rank<=4?"sourceLoc = coords +\n            ".concat(n,"(").concat(t.map((function(e,t){return"start[".concat(t,"]")})).join(),");"):t.map((function(e,t){return"".concat(a[t]," = ").concat(r[t]," + start[").concat(t,"];")})).join("\n");this.userCode="\n      void main() {\n        ".concat(n," coords = getOutputCoords();\n        ").concat(n," sourceLoc;\n        ").concat(c,"\n        vec4 result = vec4(0.);\n        ").concat(s,"\n        ").concat(u,"\n        setOutput(result);\n      }\n    ")}));function CV(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=i(ym(a,r.begin,r.size),2),s=o[0],u=o[1];if(om(a,s,u),0===fs(u))return n.makeTensorInfo(u,a.dtype,[]);if(n.shouldExecuteOnCPU([a])||"string"===a.dtype){var c=n.texData.get(a.dataId),l=cG(c.values,s,u,a.shape,a.dtype);return n.makeTensorInfo(u,a.dtype,l)}var d=n.texData.get(a.dataId).isPacked,h=vm(a.shape,s,u);if(d||!h){var p=Qs().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new EV(u):new _V(u),f=[s];return n.runWebGLProgram(p,[a],a.dtype,f)}return n.uploadToGPU(a.dataId),function(e,t,n,r){var a=r.texData.get(e.dataId),i=r.makeTensorInfo(n,e.dtype),o=r.texData.get(i.dataId);Object.assign(o,a),o.refCount=1,o.shape=n,o.dtype=e.dtype;var s=gm(t,zs(e.shape));a.slice&&(s+=a.slice.flatOffset),o.slice={flatOffset:s,origDataId:a.slice&&a.slice.origDataId||e.dataId};var u=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,u+1),i}(a,s,u,n)}var MV={kernelName:Tl,backendName:"webgl",kernelFunc:CV},NV={kernelName:xu,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops;ls(a.shape.length<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var s=i.reduce((function(e,t){return e*t})),u=qx(a.shape,i,s),c=$x(u.length,i.length),l=ew(a.shape,i,s),d=tw(o,i.length),h=nw(l,o,i.length),p=[],f=wW({inputs:{x:a},backend:n,attrs:{shape:u}}),m=RW({inputs:{x:f},backend:n,attrs:{perm:c}}),v=wW({inputs:{x:m},backend:n,attrs:{shape:l}}),g=CV({inputs:{x:v},backend:n,attrs:{begin:d,size:h}});return p.push(f),p.push(m),p.push(v),p.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}};var RV={kernelName:wu,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=LF(s,u,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,c)}};var LV={kernelName:Su,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.s0,a=t.s1,i=n.readSync(r.dataId),o=n.readSync(a.dataId),s=Uf(Array.from(i),Array.from(o));return n.makeTensorInfo([s.length],"int32",Int32Array.from(s))}},AV=pW({opSnippet:"return float(a != b);",cpuKernelImpl:eG,dtype:"bool"}),PV={kernelName:jc,backendName:"webgl",kernelFunc:AV};function DV(e){var t=e.inputs,n=e.backend,r=t.input;return tW({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}var OV={kernelName:ul,backendName:"webgl",kernelFunc:DV},zV="return float(int(x));";var FV={kernelName:Tu,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=t.attrs,o=n.x,s=a.dtype;if("complex64"===s){if("complex64"===o.dtype)return tW({inputs:{x:o},backend:r});var u=Xg(o.shape),c=e({inputs:{x:o},backend:r,attrs:{dtype:"float32"}}),l=rW({inputs:{real:c,imag:u},backend:r});return u.dispose(),r.disposeIntermediateTensorInfo(c),l}if("complex64"===o.dtype){var d=DV({inputs:{input:o},backend:r}),h=e({inputs:{x:d},backend:r,attrs:{dtype:s}});return r.disposeIntermediateTensorInfo(d),h}if(!Es(o.dtype,s)){var p=tW({inputs:{x:o},backend:r});return{dataId:p.dataId,shape:p.shape,dtype:s}}if(r.shouldExecuteOnCPU([o])){var f=r.texData.get(o.dataId).values,m=i(PF(f,o.shape,o.dtype,s),3),v=m[0],g=m[1],y=m[2];return r.makeTensorInfo(v,g,y)}if("int32"===s)return function(e,t){var n=new RG(e.shape,zV),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(o,r);if("bool"===s){var b=r.makeTensorInfo([],"bool",Ss("bool",1)),x=AV({inputs:{a:o,b:b},backend:r});return r.disposeIntermediateTensorInfo(b),x}throw new Error("Error in Cast: failed to cast ".concat(o.dtype," to ").concat(s))}},GV="return ceil(x);",WV=hW({opSnippet:GV,packedOpSnippet:GV,cpuKernelImpl:DF}),VV={kernelName:_u,backendName:"webgl",kernelFunc:WV},UV=E((function e(t){T(this,e),this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "})),XV=E((function e(t){T(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}));var BV={kernelName:Iu,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.clipValueMin,s=a.clipValueMax;t=Qs().getBool("WEBGL_PACK_CLIP")?new XV(i.shape):new UV(i.shape);var u=[[o],[s]];return r.runWebGLProgram(t,[i],i.dtype,u)}},HV=E((function e(t){T(this,e),this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}));function ZV(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}var KV={kernelName:Cu,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n.texData.get(r.dataId),i=new HV(r.shape),o=[ZV(r,a.complexTensorInfos.real),ZV(r,a.complexTensorInfos.imag)];return n.runWebGLProgram(i,o,o[0].dtype)}},jV=E((function e(t){T(this,e),this.outputShape=[],this.outputShape=Bx(t,1),this.variableNames=t.map((function(e,t){return"T".concat(t)}));var n=new Array(t.length-1);n[0]=t[0][1];for(var r=1;r<n.length;r++)n[r]=n[r-1]+t[r][1];for(var a=["if (yC < ".concat(n[0],") setOutput(getT0(yR, yC));")],i=1;i<n.length;i++){var o=n[i-1];a.push("else if (yC < ".concat(n[i],") setOutput(getT").concat(i,"(yR, yC-").concat(o,"));"))}var s=n.length,u=n[n.length-1];a.push("else setOutput(getT".concat(s,"(yR, yC-").concat(u,"));")),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ".concat(a.join("\n        "),"\n      }\n    ")})),YV=E((function e(t,n){T(this,e),this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Bx(t,n);var r=this.outputShape,a=r.length,i=Iz(a),o=TG("coords",a),s=["x","y","z","w","u","v"].slice(0,a);this.variableNames=t.map((function(e,t){return"T".concat(t)}));var u=new Array(t.length-1);u[0]=t[0][n];for(var c=1;c<u.length;c++)u[c]=u[c-1]+t[c][n];for(var l=s[n],d=s.slice(-2),h=s.join(),p="if (".concat(l," < ").concat(u[0],") {\n        return getChannel(\n            getT0(").concat(h,"), vec2(").concat(d.join(),"));\n        }"),f=1;f<u.length;f++){var m=u[f-1];p+="\n        if (".concat(l," < ").concat(u[f],"  && ").concat(l," >= ").concat(u[f-1],") {\n          return getChannel(\n            getT").concat(f,"(").concat(QV(s,l,m),"),\n            vec2(").concat(QV(d,l,m),"));\n        }")}var v=u.length,g=u[u.length-1];p+="\n        return getChannel(\n          getT".concat(v,"(").concat(QV(s,l,g),"),\n          vec2(").concat(QV(d,l,g),"));"),this.userCode="\n      float getValue(".concat(s.map((function(e){return"int "+e})),") {\n        ").concat(p,"\n      }\n\n      void main() {\n        ").concat(i," coords = getOutputCoords();\n        vec4 result = vec4(getValue(").concat(o,"), 0., 0., 0.);\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," + 1;\n        if (").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.g = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-2]," = ").concat(o[a-2]," + 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2],") {\n          result.a = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," - 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2]," &&\n            ").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.b = getValue(").concat(o,");\n        }\n        setOutput(result);\n      }\n    ")}));function QV(e,t,n){var r=e.indexOf(t);return e.map((function(e,t){return t===r?"".concat(e," - ").concat(n):e})).join()}function JV(e){var t=e.inputs,n=e.backend,r=t.input;return tW({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}var qV={kernelName:gc,backendName:"webgl",kernelFunc:JV};function $V(e,t,n){var r=e[0].dtype;if("complex64"===r){var a=e.map((function(e){return DV({inputs:{input:e},backend:n})})),i=e.map((function(e){return JV({inputs:{input:e},backend:n})})),o=$V(a,t,n),s=$V(i,t,n),u=rW({inputs:{real:o,imag:s},backend:n});return a.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),i.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}var c=n.shouldExecuteOnCPU(e);if("string"===r&&(c=!0),c){var l=e.map((function(e){var r=[-1,fs(e.shape.slice(t))];return wW({inputs:{x:e},backend:n,attrs:{shape:r}})})),d=l.map((function(e){return{vals:n.readSync(e.dataId),shape:e.shape}})),h=Bx(l.map((function(e){return e.shape})),1),p=1===l[0].shape[0],f=OF(d,h,r,p),m=Bx(e.map((function(e){return e.shape})),t),v=n.makeTensorInfo(m,r,f);return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),v}var g=Qs().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(e.length>g){for(var y=[],b=0;b<e.length;b+=g){var x=e.slice(b,b+g);y.push($V(x,t,n))}for(var w=$V(y,t,n),k=0,S=y;k<S.length;k++){var T=S[k];n.disposeIntermediateTensorInfo(T)}return w}if(Qs().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].shape.length>1){var _=new YV(e.map((function(e){return e.shape})),t);return n.runWebGLProgram(_,e,r)}var I=function(e,t,n){var r=Bx(e.map((function(e){return e.shape})),t);return{tensors2D:e.map((function(e){return wW({inputs:{x:e},attrs:{shape:[-1,fs(e.shape.slice(t))]},backend:n})})),outShape:r}}(e,t,n),E=I.tensors2D,C=I.outShape,M=new jV(E.map((function(e){return e.shape}))),N=n.runWebGLProgram(M,E,r);E.forEach((function(e){return n.disposeIntermediateTensorInfo(e)}));var R=wW({inputs:{x:N},attrs:{shape:C},backend:n});return n.disposeIntermediateTensorInfo(N),R}function eU(e){var t=e.inputs,n=e.backend,r=ws(e.attrs.axis,t[0].shape)[0];Xx(t.map((function(e){return e.shape})),r);var a=Bx(t.map((function(e){return e.shape})),r);if(0===fs(a))return n.makeTensorInfo(a,t[0].dtype,[]);var i=t.filter((function(e){return fs(e.shape)>0}));return 1===i.length?tW({inputs:{x:i[0]},backend:n}):$V(i,r,n)}var tU={kernelName:Mu,backendName:"webgl",kernelFunc:eU},nU=E((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];T(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,d=t.dilationWidth,h=t.filterHeight,p=t.filterWidth,f=4*Math.floor(t.inChannels/4),m=t.inChannels%4,v="channelsLast"===t.dataFormat,g=v?1:2,y=v?2:3,b=v?3:1,x="",w="";r&&(x=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),w="result = activation(result);");var k=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(x,"\n\n      const ivec2 strides = ivec2(").concat(u,", ").concat(c,");\n      const ivec2 pads = ivec2(").concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[").concat(b,"];\n\n        ivec2 xRCCorner =\n            ivec2(coords[").concat(g,"], coords[").concat(y,"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(h,"; wR++) {\n          int xR = xRCorner + wR * ").concat(l,";\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(p,"; wC++) {\n            int xC = xCCorner + wC * ").concat(d,";\n\n            if (xC < 0 || xC >= ").concat(t.inWidth,") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ").concat(f,"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (").concat(v,") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (").concat(1===m,") {\n\n              if (").concat(v,") {\n                dotProd +=\n                    getX(batch, xR, xC, ").concat(f,") *\n                    getW(wR, wC, ").concat(f,", d2);\n              } else {\n                dotProd +=\n                    getX(batch, ").concat(f,", xR, xC) *\n                    getW(wR, wC, ").concat(f,", d2);\n              }\n\n            } else if (").concat(2===m,") {\n              vec2 wValues = vec2(\n                getW(wR, wC, ").concat(f,", d2),\n                getW(wR, wC, ").concat(f," + 1, d2)\n              );\n\n              if (").concat(v,") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ").concat(f,"),\n                  getX(batch, xR, xC, ").concat(f," + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ").concat(f,", xR, xC),\n                  getX(batch, ").concat(f," + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (").concat(3===m,") {\n              vec3 wValues = vec3(\n                getW(wR, wC, ").concat(f,", d2),\n                getW(wR, wC, ").concat(f," + 1, d2),\n                getW(wR, wC, ").concat(f," + 2, d2)\n              );\n\n              if (").concat(v,") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ").concat(f,"),\n                  getX(batch, xR, xC, ").concat(f," + 1),\n                  getX(batch, xR, xC, ").concat(f," + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ").concat(f,", xR, xC),\n                  getX(batch, ").concat(f," + 1, xR, xC),\n                  getX(batch, ").concat(f," + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ").concat(k,"\n        ").concat(w,"\n        setOutput(result);\n      }\n    ")})),rU=E((function e(t){T(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.padInfo.front,r=t.padInfo.top,a=t.padInfo.left,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,d=t.filterDepth,h=t.filterHeight,p=t.filterWidth,f=4*Math.floor(t.inChannels/4),m=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3(".concat(i,", ").concat(o,", ").concat(s,");\n      const ivec3 pads = ivec3(").concat(n,", ").concat(r,", ").concat(a,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(d,"; wF++) {\n          int xF = xFCorner + wF * ").concat(u,";\n\n          if (xF < 0 || xF >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(h,"; wR++) {\n            int xR = xRCorner + wR * ").concat(c,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(p,"; wC++) {\n              int xC = xCCorner + wC * ").concat(l,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ").concat(f,"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (").concat(1===m,") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ").concat(f,") *\n                  getW(wF, wR, wC, ").concat(f,", d2);\n              } else if (").concat(2===m,") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ").concat(f,"),\n                  getX(batch, xF, xR, xC, ").concat(f," + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ").concat(f,", d2),\n                  getW(wF, wR, wC, ").concat(f," + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (").concat(3===m,") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ").concat(f,"),\n                  getX(batch, xF, xR, xC, ").concat(f," + 1),\n                  getX(batch, xF, xR, xC, ").concat(f," + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ").concat(f,", d2),\n                  getW(wF, wR, wC, ").concat(f," + 1, d2),\n                  getW(wF, wR, wC, ").concat(f," + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),aU=E((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];T(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Az(this.outputShape.length);for(var o=t.padInfo.left,s=t.strideWidth,u=t.dilationWidth,c=t.filterHeight,l=t.filterWidth,d=l,h="\n       int xR; int xC; int xCOffset;\n       vec4 wTexel; vec4 previous; vec4 final;",p=0;p<l;p++)h+="\n           vec4 xTexelC".concat(2*p,";\n           int xTexelC").concat(2*p,"Ready;\n           vec4 xTexelC").concat(2*p+1,";\n           int xTexelC").concat(2*p+1,"Ready;\n           vec4 xC").concat(p,";");h+="\n     for (int r = 0; r < ".concat(c,"; r++) {\n      for (int d1 = 0; d1 < ").concat(t.inChannels,"; d1 += 2) {\n       ");for(var f=0;f<l;f++)h+="\n           xTexelC".concat(2*f," = vec4(0.0);\n           xTexelC").concat(2*f,"Ready = 0;\n           xTexelC").concat(2*f+1," = vec4(0.0);\n           xTexelC").concat(2*f+1,"Ready = 0;\n           xC").concat(f," = vec4(0.0);");h+="\n         xR = xRCorner + r * dilations[0];\n         if (xR >=0 && xR < inDims[0]) {\n       ";for(var m=0;m<(d+1)/2;m++){var v=2*m;if(h+="\n           xC = xCCorner + ".concat(v*u,";\n           "),1===s){if(v<l&&(o%2===1?(h+="\n                 xCOffset = xC + 1;\n                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(v,"Ready == 0) {\n                   xTexelC").concat(v," = getX(batch, xR, xCOffset, d1);\n\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(v,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(v,"Ready = 1;\n                 }\n               "),h+=1===u&&v>0?"\n                 xC".concat(v," = vec4(xTexelC").concat(v-2,".zw, xTexelC").concat(v,".xy);\n                 "):"\n                   xCOffset = xC + 1 - 2;\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       previous.zw = vec2(0.0);\n                     }\n\n                     xC".concat(v," = vec4(previous.zw, xTexelC").concat(v,".xy);\n                   } else {\n                     xC").concat(v," = vec4(0.0, 0.0, xTexelC").concat(v,".xy);\n                   }\n                   ")):h+="\n                 if (xC >= 0 && xC < inDims[1] && xTexelC".concat(v,"Ready == 0) {\n                   xTexelC").concat(v," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(v,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(v,"Ready = 1;\n                 }\n\n                 xC").concat(v," = xTexelC").concat(v,";\n                 "),v+1<l)){var g=o%2===0?ss(u):u;u%2===0&&o%2===1||u%2!==0&&o%2!==1?(h+="\n                   xCOffset = xC + imod(pads[1], 2) + ".concat(g,";\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(v+1,"Ready == 0) {\n                     xTexelC").concat(v+1," = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       xTexelC").concat(v+1,".zw = vec2(0.0);\n                     }\n                     xTexelC").concat(v+1,"Ready = 1;\n                   }\n                   "),h+=u>1?"\n                     xCOffset -= 2;\n                     if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                      previous = getX(batch, xR, xCOffset, d1);\n                      xC".concat(v+1," = vec4(previous.zw, xTexelC").concat(v+1,".xy);\n                     } else {\n                      xC").concat(v+1," = vec4(0.0, 0.0, xTexelC").concat(v+1,".xy);\n                     }\n                     "):"\n                     xC".concat(v+1," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,".xy);\n                     ")):h+=1===g?"\n                     xC".concat(v+1," = xTexelC").concat(v,";\n                     "):"\n                     xCOffset = xC + ".concat(g,";\n\n                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(v+1,"Ready == 0) {\n                       xTexelC").concat(v+1," = getX(batch, xR, xCOffset, d1);\n                       if (xCOffset + 1 >= inDims[1]) {\n                         xTexelC").concat(v+1,".zw = vec2(0.0);\n                       }\n                       xTexelC").concat(v+1,"Ready = 1;\n                     }\n\n                     xC").concat(v+1," = xTexelC").concat(v+1,";\n                     ")}}else v<l&&(o%2===1?(h+="\n                 xCOffset = xC + 1 - strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(v,"Ready == 0) {\n                   xTexelC").concat(v," = getX(batch, xR, xCOffset, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(v,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(v,"Ready = 1;\n                 }\n\n                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(v+1,"Ready == 0) {\n                   xTexelC").concat(v+1," = getX(batch, xR, xC + 1, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xC + 2 >= inDims[1]) {\n                     xTexelC").concat(v+1,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(v+1,"Ready = 1;\n                 }\n\n                 xC").concat(v," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,".zw);\n               "),v+1<l&&(h+="\n                   final = vec4(0.0);\n                   xCOffset = xC + 1 + strides[1];\n                   if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                     final = getX(batch, xR, xCOffset, d1);\n                   }\n                   xC".concat(v+1," = vec4(xTexelC").concat(v+1,".xy, final.xy);\n                 "))):(h+="\n                 if(xC >= 0 && xC < inDims[1] && xTexelC".concat(v,"Ready == 0) {\n                   xTexelC").concat(v," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(v,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(v,"Ready = 1;\n                 }\n\n                 xCOffset = xC + strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(v+1,"Ready == 0) {\n                   xTexelC").concat(v+1," = getX(batch, xR, xCOffset, d1);\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(v+1,".zw = vec2(0.);\n                   }\n                   xTexelC").concat(v+1,"Ready = 1;\n                 }\n\n                 xC").concat(v," = vec4(\n                   xTexelC").concat(v,".xy, xTexelC").concat(v+1,".xy);\n               "),v+1<l&&(h+="\n                   xC".concat(v+1," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,".zw);\n                 "))));v<l&&(h+="\n             wTexel = getW(r, ".concat(v,", d1, d2);\n             dotProd += xC").concat(v,".xxzz * vec4(wTexel.xy, wTexel.xy);\n             if(d1 + 1 < ").concat(t.inChannels,") {\n               dotProd += xC").concat(v,".yyww * vec4(wTexel.zw, wTexel.zw);\n             }\n           "),v+1<l&&(h+="\n               wTexel = getW(r, ".concat(v+1,", d1, d2);\n               dotProd += xC").concat(v+1,".xxzz * vec4(wTexel.xy, wTexel.xy);\n               if(d1 + 1 < ").concat(t.inChannels,") {\n                 dotProd += xC").concat(v+1,".yyww * vec4(wTexel.zw, wTexel.zw);\n               }\n             ")))}h+="\n     }\n   ",h+="\n     }\n   ",h+="\n     }\n   ";var y="",b="";r&&(y=a?"vec4 activation(vec4 a) {\n           vec4 b = getPreluActivationWeightsAtOutCoords();\n           ".concat(r,"\n         }"):i?"vec4 activation(vec4 a) {\n           vec4 b = getLeakyreluAlphaAtOutCoords();\n           ".concat(r,"\n         }"):"vec4 activation(vec4 x) {\n           ".concat(r,"\n         }"),b="result = activation(result);");var x=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n       ".concat(y,"\n\n       void main() {\n         ivec4 coords = getOutputCoords();\n         int batch = coords.x;\n         ivec2 xRCCorner = coords.yz * strides - pads;\n         int d2 = coords.w;\n         int xRCorner = xRCCorner.x;\n         int xCCorner = xRCCorner.y;\n\n         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n         vec4 dotProd = vec4(0.000000000000001);\n\n         ").concat(h,"\n\n         vec4 result = dotProd - vec4(0.000000000000001);\n         ").concat(x,"\n         ").concat(b,"\n         setOutput(result);\n       }\n     ")})),iU=E((function e(t,n){T(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=Az(this.outputShape.length);for(var r=n.dataFormat,a=lz(),i="channelsLast"===r,o=i?1:2,s=i?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":"if(blockIndex < ".concat(t[2]," && pos < ").concat(t[1],") {"),c="",l=0;l<=1;l++)for(var d=0;d<=1;d++)c+="\n          blockIndex = rc.z + ".concat(d,";\n          pos = rc.y + ").concat(l,";\n\n          ").concat(u,"\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[").concat(o,"] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[").concat(s,"] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (").concat(i,") {\n                  innerDims = vec2(d1, ch);\n                  result[").concat(2*l+d,"] = getChannel(\n                    getA(rc.x, d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[").concat(2*l+d,"] = getChannel(\n                    getA(rc.x, ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ");this.userCode="\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ".concat(c,"\n\n        ").concat(a.output," = result;\n      }\n    ")}));function oU(e,t){var n=e.length;return n>=3?[].concat(b(e.slice(0,-3)),t?[e[n-3]*e[n-2],e[n-1]]:[e[n-3],e[n-2]*e[n-1]]):!t&&1===n&&e[0]>1?[e[0],1]:null}function sU(e){var t,n=e.x,r=e.filter,a=e.convInfo,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,c=void 0===u?null:u,l=e.leakyreluAlpha,d=void 0===l?0:l,h=e.activation,p=void 0===h?null:h,f=n.shape,m=i.texData.get(n.dataId),v=a.inChannels,g=f[0]*f[1]*f[2],y=a.outChannels,b="channelsLast"===a.dataFormat,x=[];if(null!=c){var w=oU(c.shape,b);null!=w&&(c=wW({inputs:{x:c},backend:i,attrs:{shape:w}}),x.push(c))}if(null!=s){var k=oU(s.shape,b);null!=k&&(s=wW({inputs:{x:s},backend:i,attrs:{shape:k}}),x.push(s))}if((1!==g&&1!==y||!(v>AW))&&m.isPacked&&b&&null!=m.texture&&f[2]%2!==0&&ms(m.shape.slice(-3),f.slice(-3))){var S=f[0]*f[1]*(f[2]+1),T={dataId:n.dataId,shape:[1,S,a.inChannels],dtype:n.dtype},_=m.shape;m.shape=m.shape.slice(),m.shape[m.shape.length-2]++,ls(rz(m.shape,T.shape),(function(){return"packed reshape ".concat(m.shape," to ").concat(T.shape," isn't free")}));var I=wW({inputs:{x:r},backend:i,attrs:{shape:[1,a.inChannels,a.outChannels]}});x.push(I);var E=PW({a:T,b:I,backend:i,transposeA:!1,transposeB:false,bias:s,activation:p,preluActivationWeights:c,leakyreluAlpha:d}),C=i.texData.get(E.dataId);ls(C.isPacked,(function(){return"batchMatMul result is expected to be packed"})),m.shape=_,C.shape=a.outShape,(t=tW({inputs:{x:E},backend:i})).shape=a.outShape,x.push(E)}else{var M=a.outHeight*a.outWidth,N=wW({inputs:{x:n},backend:i,attrs:{shape:b?[a.batchSize,M,a.inChannels]:[a.batchSize,a.inChannels,M]}}),R=wW({inputs:{x:r},backend:i,attrs:{shape:[1,a.inChannels,a.outChannels]}}),L=PW({a:b?N:R,b:b?R:N,transposeA:!b,transposeB:false,backend:i,bias:s,activation:p,preluActivationWeights:c,leakyreluAlpha:d});t=wW({inputs:{x:L},backend:i,attrs:{shape:a.outShape}}),x.push(N),x.push(R),x.push(L)}for(var A=0,P=x;A<P.length;A++){var D=P[A];i.disposeIntermediateTensorInfo(D)}return t}function uU(e){var t=e.x,n=e.filter,r=e.convInfo,a=e.backend,i=e.bias,o=void 0===i?null:i,s=e.preluActivationWeights,u=void 0===s?null:s,c=e.leakyreluAlpha,l=void 0===c?0:c,d=e.activation,h=void 0===d?null:d,p=r.filterWidth,f=r.filterHeight,m=r.inChannels,v=r.outWidth,g=r.outHeight,y="channelsLast"===r.dataFormat,b=p*f*m,x=g*v,w=[r.batchSize,b,x],k=[];if(null!=u){var S=oU(u.shape,y);null!=S&&(u=wW({inputs:{x:u},backend:a,attrs:{shape:S}}),k.push(u))}if(null!=o){var T=oU(o.shape,y);null!=T&&(o=wW({inputs:{x:o},backend:a,attrs:{shape:T}}),k.push(o))}var _=wW({inputs:{x:n},backend:a,attrs:{shape:[1,b,fs(n.shape)/b]}});k.push(_);var I=new iU(w,r),E=[t.shape,[r.padInfo.top,r.padInfo.left],[r.strideHeight,r.strideWidth],[r.dilationHeight,r.dilationWidth],[r.inChannels],[r.filterWidth*r.inChannels],[r.outWidth]],C=a.runWebGLProgram(I,[t],"float32",E),M=wW({inputs:{x:C},backend:a,attrs:{shape:w}});k.push(C),k.push(M);var N=null!=o,R=null!=u,L="leakyrelu"===h,A=h?fW(h,!0):null,P=new mW(y?M.shape:_.shape,y?_.shape:M.shape,y?[r.batchSize,x,r.outChannels]:[r.batchSize,r.outChannels,x],!0,!1,N,A,R,L),D=y?[M,_]:[_,M];if(o&&D.push(o),R&&D.push(u),L){var O=a.makeTensorInfo([],"float32",nh(l,"float32"));D.push(O),k.push(O)}var z=a.runWebGLProgram(P,D,"float32"),F=wW({inputs:{x:z},backend:a,attrs:{shape:r.outShape}});k.push(z);for(var G=0,W=k;G<W.length;G++){var V=W[G];a.disposeIntermediateTensorInfo(V)}return F}var cU={kernelName:Nu,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,c=a.dataFormat,l=a.dilations,d=a.dimRoundingMode,h=ev(c),p=Hm(i.shape,o.shape,s,l,u,d,!1,h);if(1!==p.filterHeight||1!==p.filterWidth||1!==p.dilationHeight||1!==p.dilationWidth||1!==p.strideHeight||1!==p.strideWidth||"SAME"!==p.padInfo.type&&"VALID"!==p.padInfo.type)if(p.strideWidth<=2&&"channelsLast"===h&&Qs().getBool("WEBGL_EXP_CONV")){var f=new aU(p),m=[[p.padInfo.top,p.padInfo.left],[p.strideHeight,p.strideWidth],[p.dilationHeight,p.dilationWidth],[p.inHeight,p.inWidth]];t=r.runWebGLProgram(f,[i,o],"float32",m)}else if(Qs().getBool("WEBGL_CONV_IM2COL"))t=uU({x:i,filter:o,convInfo:p,backend:r});else{var v=new nU(p);t=r.runWebGLProgram(v,[i,o],"float32")}else t=sU({x:i,filter:o,convInfo:p,backend:r});var g=wW({inputs:{x:t},backend:r,attrs:{shape:p.outShape}});return r.disposeIntermediateTensorInfo(t),g}},lU=E((function e(t){T(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,i=t.padInfo.left,o="channelsLast"===t.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              if (").concat(o,") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),dU=E((function e(t){T(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o="channelsLast"===t.dataFormat,s=n-1-t.padInfo.top,u=r-1-t.padInfo.left,c=o?1:2,l=o?2:3,d=o?3:1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[").concat(d,"];\n\n        ivec2 dyCorner = ivec2(coords[").concat(c,"], coords[").concat(l,"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n\n              if (").concat(o,") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),hU=E((function e(t){T(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,i=t.padInfo.front,o=t.padInfo.top,s=t.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yF = 0; yF < ").concat(t.outDepth,"; yF++) {\n            int xF = wF + yF * ").concat(n," - ").concat(i,";\n\n            if (xF < 0 || xF >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n              int xR = wR + yR * ").concat(r," - ").concat(o,";\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n                int xC = wC + yC * ").concat(a," - ").concat(s,";\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),pU=E((function e(t){T(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=n-1-t.padInfo.front,c=r-1-t.padInfo.top,l=a-1-t.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3(".concat(u,", ").concat(c,", ").concat(l,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(n,"; wF++) {\n          float dyF = float(dyFCorner + wF) / ").concat(i,".0;\n\n          if (dyF < 0.0 || dyF >= ").concat(t.outDepth,".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ").concat(n," - 1 - wF;\n\n          for (int wR = 0; wR < ").concat(r,"; wR++) {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ").concat(r," - 1 - wR;\n\n            for (int wC = 0; wC < ").concat(a,"; wC++) {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ").concat(a," - 1 - wC;\n\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var fU={kernelName:Ru,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape,d=ev(u),h=Hm(a.shape,l,o,1,s,c,!1,d),p=new lU(h);return n.runWebGLProgram(p,[a,i],"float32")}};var mU={kernelName:Lu,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode,d=ev(c),h=Hm(o,i.shape,s,1,u,l,!1,d),p=new dU(h);return n.runWebGLProgram(p,[a,i],"float32")}};var vU={kernelName:Au,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=Zm(a.shape,i.shape,o,u,s),l=new rU(c);return n.runWebGLProgram(l,[a,i],"float32")}};var gU={kernelName:Pu,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.filterShape,c=Zm(a.shape,u,o,1,s),l=new hU(c);return n.runWebGLProgram(l,[a,i],"float32")}};var yU,bU={kernelName:Du,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.pad,s=r.strides,u=Zm(r.inputShape,i.shape,s,1,o),c=new pU(u);return n.runWebGLProgram(c,[a,i],"float32")}},xU=hW({opSnippet:dW+"\n  return cos(x);\n"}),wU={kernelName:Ou,backendName:"webgl",kernelFunc:xU},kU=hW({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"}),SU={kernelName:zu,backendName:"webgl",kernelFunc:kU},TU=E((function e(t,n,r,a,o){T(this,e),this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var s=i(t,4),u=s[0],c=s[1],l=s[2],d=s[3],h=i(n,1)[0],p=i(r,2),f=p[0],m=p[1];this.outputShape=[h,f,m,d];var v="bilinear"===a?1:0,g="".concat(c-1,".0"),y="".concat(l-1,".0"),b=i(f>1?["".concat((c-1)/(f-1)),"(y2-y1) * height_ratio","y1*".concat(g," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(g)],3),x=b[0],w=b[1],k=b[2],S=i(m>1?["".concat((l-1)/(m-1)),"(x2-x1) * width_ratio","x1*".concat(y," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(y)],3),_=S[0],I=S[1],E=S[2];this.userCode="\n      const float height_ratio = float(".concat(x,");\n      const float width_ratio = float(").concat(_,");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ").concat(u,") {\n          return;\n        }\n\n        float height_scale = ").concat(w,";\n        float width_scale = ").concat(I,";\n\n        float in_y = ").concat(k,";\n        if( in_y < 0.0 || in_y > ").concat(g," ) {\n          setOutput(float(").concat(o,"));\n          return;\n        }\n        float in_x = ").concat(E,";\n        if( in_x < 0.0 || in_x > ").concat(y," ) {\n          setOutput(float(").concat(o,"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(").concat(v," == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    ")})),_U={kernelName:Wu,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.boxes,o=t.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=new TU(a.shape,i.shape,s,u,c);return n.runWebGLProgram(l,[a,i,o],"float32")}};!function(e){e.Prod="*",e.Sum="+"}(yU||(yU={}));var IU=E((function e(t,n,r,a){T(this,e),this.op=t,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];var i=this.outputShape.length,o=this.op===yU.Prod?"1.0":"0.0",s=r?o:"getX(".concat(EU(i,"coords",this.op),")"),u=this.outputShape[this.outputShape.length-1],c="",l="";r?(c=a?"end != ".concat(u-1):"end != 0",l=a?"end + 1":"end - 1"):(c=a?"end + pow2 < ".concat(u):"end >= pow2",l=a?"end + pow2":"end - pow2"),this.userCode="\n      void main() {\n        ".concat(Iz(i)," coords = getOutputCoords();\n        int end = ").concat(CU(i,"coords",this.op),";\n        float val = ").concat(s,";\n        int pow2 = int(pow(2.0, index));\n        if (").concat(c,") {\n          int idx = ").concat(l,";\n          ").concat(CU(i,"coords",this.op)," = idx;\n          val ").concat(this.op,"= getX(").concat(EU(i,"coords",this.op),");\n        }\n        setOutput(val);\n      }\n    ")}));function EU(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function CU(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".y");if(3===e)return"".concat(t,".z");if(4===e)return"".concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function MU(e,t,n,r,a,i){var o=t.shape.length,s=Qv([r],o),u=t;null!=s&&(u=RW({inputs:{x:t},backend:n,attrs:{perm:s}}));var c=qv(1,o)[0];if(c!==o-1)throw new Error("WebGL cumprod shader expects an inner-most axis=".concat(t.shape.length-1," but got axis=").concat(r));for(var l=u.shape[c],d=tW({inputs:{x:u},backend:n}),h=0;h<=Math.ceil(Math.log2(l))-1;h++){var p=new IU(e,u.shape,!1,i),f=[[h]],m=d;d=n.runWebGLProgram(p,[d],d.dtype,f),n.disposeIntermediateTensorInfo(m)}if(a){var v=new IU(e,u.shape,a,i),g=d;d=n.runWebGLProgram(v,[d],d.dtype),n.disposeIntermediateTensorInfo(g)}if(null!=s){var y=RW({inputs:{x:d},backend:n,attrs:{perm:Jv(s)}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(u),y}return d}var NU={kernelName:Fu,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;return MU(yU.Prod,a,n,i,o,s)}};var RU={kernelName:Gu,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;return MU(yU.Sum,a,n,i,o,s)}};var LU={kernelName:Vu,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=n.readSync(a.dataId),c=n.readSync(i.dataId),l=LF(u,c,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,l)}if(2===a.shape.length){var d=n.bufferSync(a),h=n.bufferSync(i),p=AF(d,h,o,s);return n.makeTensorInfo(p.shape,i.dtype,p.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank".concat(a.shape.length,"."))}},AU=function(){function e(t,n,r){T(this,e),this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ".concat(this.getHeightCoordString(),";\n      int w = ").concat(this.getWidthCoordString(),";\n      int d = ").concat(this.getDepthCoordString(),";\n\n      int in_h = h / ").concat(n,";\n      int offset_h = imod(h, ").concat(n,");\n      int in_w = w / ").concat(n,";\n      int offset_w = imod(w, ").concat(n,");\n      int offset_d = (offset_h * ").concat(n," + offset_w) *\n        ").concat(this.getOutputDepthSize(),";\n      int in_d = d + offset_d;\n\n      float result = ").concat(this.getInputSamplingString(),";\n      setOutput(result);\n    }\n  ")}return E(e,[{key:"getHeightCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}},{key:"getWidthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}},{key:"getDepthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}},{key:"getOutputDepthSize",value:function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}},{key:"getInputSamplingString",value:function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}]),e}();var PU={kernelName:Uu,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockSize,o=r.dataFormat,s=a.shape[0],u=("NHWC"===o?a.shape[1]:a.shape[2])*i,c=("NHWC"===o?a.shape[2]:a.shape[3])*i,l=("NHWC"===o?a.shape[3]:a.shape[1])/(i*i),d=new AU("NHWC"===o?[s,u,c,l]:[s,l,u,c],i,o);return n.runWebGLProgram(d,[a],a.dtype)}},DU=E((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];T(this,e),this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Az(this.outputShape.length);var o=t.filterHeight,s=t.filterWidth,u=t.outChannels/t.inChannels,c="",l="";r&&(c=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),l="result = activation(result);");var d=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(c,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(u,";\n        int q = d2 - d1 * ").concat(u,";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ").concat(o,"; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(s,"; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ").concat(d,"\n        ").concat(l,"\n        setOutput(result);\n      }\n    ")})),OU=E((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];T(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Az(this.outputShape.length);for(var o=t.outChannels/t.inChannels,s=t.padInfo.left,u=t.strideWidth,c=t.dilationWidth,l=t.filterHeight,d=t.filterWidth,h=d,p="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;",f=0;f<d;f++)p+="\n          vec4 xTexelC".concat(2*f,";\n          int xTexelC").concat(2*f,"Ready;\n          vec4 xTexelC").concat(2*f+1,";\n          int xTexelC").concat(2*f+1,"Ready;\n          vec4 xC").concat(f,";");p+="\n    for (int r = 0; r < ".concat(l,"; r++) {\n      ");for(var m=0;m<d;m++)p+="\n          xTexelC".concat(2*m," = vec4(0.0);\n          xTexelC").concat(2*m,"Ready = 0;\n          xTexelC").concat(2*m+1," = vec4(0.0);\n          xTexelC").concat(2*m+1,"Ready = 0;\n          xC").concat(m," = vec4(0.0);");p+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(var v=0;v<(h+1)/2;v++){var g=2*v;if(p+="\n          xC = xCCorner + ".concat(g*c,";\n          "),1===u){if(g<d&&(s%2===1?(p+="\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n              "),p+=1===c&&g>0?"\n                xC".concat(g," = vec4(xTexelC").concat(g-2,".zw, xTexelC").concat(g,".xy);\n                "):"\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC".concat(g," = vec4(previous.zw, xTexelC").concat(g,".xy);\n                  } else {\n                    xC").concat(g," = vec4(0.0, 0.0, xTexelC").concat(g,".xy);\n                  }\n                  ")):p+="\n                if (xC >= 0 && xC < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n\n                xC").concat(g," = xTexelC").concat(g,";\n                "),g+1<d)){var y=s%2===0?ss(c):c;c%2===0&&s%2===1||c%2!==0&&s%2!==1?(p+="\n                  xCOffset = xC + imod(pads[1], 2) + ".concat(y,";\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                    xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC").concat(g+1,".zw = vec2(0.0);\n                    }\n                    xTexelC").concat(g+1,"Ready = 1;\n                  }\n                  "),p+=c>1?"\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n                     xC".concat(g+1," = vec4(previous.zw, xTexelC").concat(g+1,".xy);\n                    } else {\n                     xC").concat(g+1," = vec4(0.0, 0.0, xTexelC").concat(g+1,".xy);\n                    }\n                    "):"\n                    xC".concat(g+1," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".xy);\n                    ")):p+=1===y?"\n                    xC".concat(g+1," = xTexelC").concat(g,";\n                    "):"\n                    xCOffset = xC + ".concat(y,";\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                      xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC").concat(g+1,".zw = vec2(0.0);\n                      }\n                      xTexelC").concat(g+1,"Ready = 1;\n                    }\n\n                    xC").concat(g+1," = xTexelC").concat(g+1,";\n                    ")}}else g<d&&(s%2===1?(p+="\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                  xTexelC").concat(g+1," = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC").concat(g+1,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g+1,"Ready = 1;\n                }\n\n                xC").concat(g," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".zw);\n              "),g+1<d&&(p+="\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC".concat(g+1," = vec4(xTexelC").concat(g+1,".xy, final.xy);\n                "))):(p+="\n                if(xC >= 0 && xC < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                  xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(g+1,".zw = vec2(0.);\n                  }\n                  xTexelC").concat(g+1,"Ready = 1;\n                }\n\n                xC").concat(g," = vec4(\n                  xTexelC").concat(g,".xy, xTexelC").concat(g+1,".xy);\n              "),g+1<d&&(p+="\n                  xC".concat(g+1," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".zw);\n                "))));g<d&&(p+="\n            wTexel = getW(r, ".concat(g,", d1, q);\n            dotProd += xC").concat(g," * vec4(wTexel.xz, wTexel.xz);\n          "),g+1<d&&(p+="\n              wTexel = getW(r, ".concat(g+1,", d1, q);\n              dotProd += xC").concat(g+1," * vec4(wTexel.xz, wTexel.xz);\n            ")))}p+="\n    }\n  ",p+="\n      }\n    ";var b="",x="";r&&(b=a?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(r,"\n        }"),x="result = activation(result);");var w=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(b,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(o,";\n        int q = d2 - d1 * ").concat(o,";\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ").concat(p,"\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ").concat(w,"\n        ").concat(x,"\n        setOutput(result);\n      }\n    ")}));var zU={kernelName:Xu,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode,l=u;null==l&&(l=[1,1]),ls($m(o,l),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(l,"'")}));var d,h=Hm(a.shape,i.shape,o,l,s,c,!0);d=Qs().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels===1?new OU(h):new DU(h);var p=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return n.runWebGLProgram(d,[a,i],"float32",p)}},FU=E((function e(t){T(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,i=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ".concat(o," + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ").concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),GU=E((function e(t){T(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o=n-1-t.padInfo.top,s=r-1-t.padInfo.left,u=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2(".concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ").concat(u,"; dm++) {\n              int d2 = d1 * ").concat(u," + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var WU={kernelName:Bu,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape,d=Hm(a.shape,l,o,s,u,c,!0),h=new FU(d);return n.runWebGLProgram(h,[a,i],"float32")}};var VU={kernelName:Hu,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=Hm(r.inputShape,i.shape,o,s,u,c,!0),d=new GU(l);return n.runWebGLProgram(d,[a,i],"float32")}},UU=E((function e(t){T(this,e),this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}));var XU={kernelName:Zu,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=[].concat(b(r.shape),b(r.shape)),i=fs(r.shape),o=wW({inputs:{x:r},backend:n,attrs:{shape:[i]}}),s=new UU(i),u=n.runWebGLProgram(s,[o],o.dtype),c=wW({inputs:{x:u},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),c}},BU=E((function e(t){T(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.inHeight,r=t.inWidth,a=t.padInfo,i=t.strideHeight,o=t.strideWidth,s=t.filterHeight,u=t.filterWidth,c=t.dilationHeight,l=t.dilationWidth,d=a.top,h=a.left;this.userCode="\n      const ivec2 strides = ivec2(".concat(i,", ").concat(o,");\n      const ivec2 pads = ivec2(").concat(d,", ").concat(h,");\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ").concat(s,"; h++) {\n          int hIn = hBeg + h * ").concat(c,";\n\n          if (hIn >= 0 && hIn < ").concat(n,") {\n            for (int w = 0; w < ").concat(u,"; w++) {\n              int wIn = wBeg + w * ").concat(l,";\n\n              if (wIn >= 0 && wIn < ").concat(r,") {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    ")}));var HU={kernelName:Ku,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,c=a.dilations,l=Um(i.shape,o.shape,s,u,"NHWC",c),d=new BU(l),h=wW({inputs:{x:t=r.runWebGLProgram(d,[i,o],"float32")},backend:r,attrs:{shape:l.outShape}});return r.disposeIntermediateTensorInfo(t),h}};var ZU={kernelName:Ju,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,a=Sw(e.attrs.equation,r.length),i=a.allDims,o=a.summedDims,s=a.idDims;_w(i.length,s,r);for(var u=Iw(o,s),c=u.path,l=u.steps,d=l.length,h=null,p=i.length,f=[],m=0;m<d;++m){var v,g=x(l[m]);try{for(g.s();!(v=g.n()).done;){var y=v.value,b=Tw(p,s[y]),w=b.permutationIndices,k=b.expandDims,S=void 0;Ew(w)?S=r[y]:(S=RW({inputs:{x:r[y]},backend:n,attrs:{perm:w}}),f.push(S));for(var T=S.shape.slice(),_=0;_<k.length;++_)T.splice(k[_],0,1);ms(S.shape,T)||(S=wW({inputs:{x:S},backend:n,attrs:{shape:T}}),f.push(S)),null===h?h=S:(h=bW({inputs:{a:S,b:h},backend:n}),f.push(h))}}catch(M){g.e(M)}finally{g.f()}m<d-1&&(c[m]>=0&&(h=MW({inputs:{x:h},backend:n,attrs:{axis:c[m]-(i.length-p),keepDims:!1}}),f.push(h)),p--)}for(var I=0,E=f;I<E.length;I++){var C=E[I];C!==h&&n.disposeIntermediateTensorInfo(C)}return h}},KU=hW({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"}),jU={kernelName:qu,backendName:"webgl",kernelFunc:KU},YU={kernelName:$u,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y,i=Qs().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new eW("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,a.shape):new qG("return (b >= 1.0) ? a : a * (b + 1.0);",r.shape,a.shape);return n.runWebGLProgram(i,[r,a],r.dtype)}},QU=pW({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool",cpuKernelImpl:zF}),JU={kernelName:tc,backendName:"webgl",kernelFunc:QU},qU=hW({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '.concat(iw,";\n  float a1 = ").concat(ow,";\n  float a2 = ").concat(sw,";\n  float a3 = ").concat(uw,";\n  float a4 = ").concat(cw,";\n  float a5 = ").concat(lw,";\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n")}),$U={kernelName:ec,backendName:"webgl",kernelFunc:qU},eX=hW({opSnippet:dW+"\n  return exp(x);\n",packedOpSnippet:"\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:FF,dtype:"float32"}),tX={kernelName:nc,backendName:"webgl",kernelFunc:eX};function nX(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.dim,i=t.input,o=i.shape.length,s=i.shape.slice(),u=a;return a<0&&(ls(-(o+1)<=a,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+a+1),s.splice(u,0,1),wW({inputs:{x:i},backend:r,attrs:{shape:s}})}var rX={kernelName:rc,backendName:"webgl",kernelFunc:nX},aX="return exp(x) - 1.0;",iX=hW({opSnippet:aX,packedOpSnippet:aX,cpuKernelImpl:GF}),oX={kernelName:ac,backendName:"webgl",kernelFunc:iX},sX=E((function e(t,n,r){T(this,e),this.variableNames=["real","imag"];var a=n[1];this.outputShape=n;var i,o=r?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),s=r?"".concat(a,".0"):"1.0";if("real"===t)i="return real * expR - imag * expI;";else{if("imag"!==t)throw new Error('FFT component must be either "real" or "imag", got '.concat(t,"."));i="return real * expI + imag * expR;"}this.userCode="\n      const float exponentMultiplier = ".concat(o,";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ").concat(i,"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(").concat(a,");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ").concat(s,";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    ")}));function uX(e,t,n){var r=n.texData.get(e.dataId),a=fs(e.shape),i=e.shape[e.shape.length-1],o=wW({inputs:{x:e},backend:n,attrs:{shape:[a/i,i]}}),s=o.shape,u=new sX("real",s,t),c=new sX("imag",s,t),l=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:s},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:s}],d=n.runWebGLProgram(u,l,"float32"),h=n.runWebGLProgram(c,l,"float32"),p=rW({inputs:{real:d,imag:h},backend:n});n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h);var f=wW({inputs:{x:p},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(p),f}var cX={kernelName:ic,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return uX(t.input,!1,n)}},lX=E((function e(t,n){T(this,e),this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}));function dX(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,i=n.dtype;if("string"===(i=i||Ps(a))){var o=Ts(i,fs(r));return o.fill(a),t.makeTensorInfo(r,i,o)}var s=new lX(r,a),u=[[a]];return t.runWebGLProgram(s,[],i,u)}var hX,pX={kernelName:oc,backendName:"webgl",kernelFunc:dX},fX=E((function e(t){T(this,e),this.variableNames=["Image"],this.outputShape=[];var n=t[2];this.outputShape=t,this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ".concat(n," - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ").concat(n,") {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")})),mX={kernelName:sc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.image,a=n,i=new fX(r.shape);return a.runWebGLProgram(i,[r],r.dtype)}},vX="return floor(x);",gX=hW({opSnippet:vX,packedOpSnippet:vX,cpuKernelImpl:WF}),yX={kernelName:uc,backendName:"webgl",kernelFunc:gX},bX=pW({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),xX={kernelName:cc,backendName:"webgl",kernelFunc:bX},wX=E((function e(t){T(this,e),this.variableNames=["A"];var n=lz(),r=i(t,2),a=r[0],o=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(o,".0, ").concat(a,".0);\n\n        vec4 values = ").concat(n.texture2D,"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    ")})),kX=E((function e(t){T(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=lz(),r=i(t,2),a=r[0],o=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(".concat(o,".0, ").concat(a,".0);\n            vec4 values = ").concat(n.texture2D,"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),SX={kernelName:ad,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.pixels,o=r.numChannels,s=typeof HTMLVideoElement<"u"&&a instanceof HTMLVideoElement,u=typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement,c=s?[a.videoWidth,a.videoHeight]:[a.width,a.height],l=i(c,2),d=l[0],h=l[1],p=[h,d],f=[h,d,o];if(u||s){var m=Qs().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(null==hX||m!==TX)&&(TX=m,hX=document.createElement("canvas").getContext("2d",{willReadFrequently:TX})),hX.canvas.width=d,hX.canvas.height=h,hX.drawImage(a,0,0,d,h),a=hX.canvas}var v=n.makeTensorInfo(p,"int32");n.texData.get(v.dataId).usage=NO.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(v.dataId),a);var g=Qs().getBool("WEBGL_PACK")?new kX(f):new wX(f),y=n.runWebGLProgram(g,[v],"int32");return n.disposeData(v.dataId),y}},TX=Qs().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");var _X={kernelName:sd,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=n.bias,u=n.preluActivationWeights,c=a.strides,l=a.pad,d=a.dataFormat,h=a.dilations,p=a.dimRoundingMode,f=a.activation,m=a.leakyreluAlpha,v=ev(d),g=Hm(i.shape,o.shape,c,h,l,p,!1,v),y=[],b=null!=s,x=null!=u,w="leakyrelu"===f,k=function(){var e=[i,o],t=function(e,t){if("NCHW"===t&&1===e.shape.length&&1!==e.shape[0]){var n=wW({inputs:{x:e},backend:r,attrs:{shape:[e.shape[0],1,1]}});return y.push(n),n}return e};if(b&&e.push(t(s,d)),x&&e.push(t(u,d)),w){var n=r.makeTensorInfo([],"float32",nh(m,"float32"));e.push(n),y.push(n)}return e};if(1!==g.filterHeight||1!==g.filterWidth||1!==g.dilationHeight||1!==g.dilationWidth||1!==g.strideHeight||1!==g.strideWidth||"SAME"!==g.padInfo.type&&"VALID"!==g.padInfo.type)if(g.strideWidth<=2&&"channelsLast"===v&&Qs().getBool("WEBGL_EXP_CONV")){var S=f?fW(f,!0):null,T=new aU(g,b,S,x,w),_=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],I=k();t=r.runWebGLProgram(T,I,"float32",_)}else if(Qs().getBool("WEBGL_CONV_IM2COL"))t=uU({x:i,filter:o,convInfo:g,backend:r,bias:s,activation:f,preluActivationWeights:u,leakyreluAlpha:m});else{var E=f?fW(f,!1):null,C=new nU(g,b,E,x,w),M=k();t=r.runWebGLProgram(C,M,"float32")}else t=sU({x:i,filter:o,convInfo:g,backend:r,bias:s,activation:f,preluActivationWeights:u,leakyreluAlpha:m});var N=wW({inputs:{x:t},backend:r,attrs:{shape:g.outShape}});return y.push(t),y.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),N}};var IX={kernelName:ud,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dilations,d=r.dimRoundingMode,h=r.activation,p=r.leakyreluAlpha,f=[],m=l;null==m&&(m=[1,1]),ls($m(u,m),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(u," and dilations '").concat(m,"'")}));var v,g=Hm(a.shape,i.shape,u,m,c,d,!0),y=Qs().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,b=h?fW(h,y):null,x=[a,i],w=null!=o,k=null!=s,S="leakyrelu"===h;if(w&&x.push(o),k&&x.push(s),S){var T=n.makeTensorInfo([],"float32",nh(p,"float32"));x.push(T),f.push(T)}v=y?new OU(g,w,b,k,S):new DU(g,w,b,k,S);var _=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],I=n.runWebGLProgram(v,x,"float32",_);return f.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),I}},EX=E((function e(t,n,r,a){T(this,e),this.sliceDim=t,this.strides=n,this.paramsShape=a,this.variableNames=["x","indices"],this.outputShape=r;for(var i=Iz(r.length),o="\n    int index;",s=0;s<this.sliceDim;s++)o+="\n          index = round(getIndices(coords[0], ".concat(s,"));\n          out_of_bounds = out_of_bounds || index < 0;\n          out_of_bounds = out_of_bounds || index >= ").concat(this.paramsShape[s],";\n          flattenIndex += index * ").concat(this.strides[s],";");this.userCode="\n         void main() {\n          ".concat(i," coords = getOutputCoords();\n          int flattenIndex = 0;\n          bool out_of_bounds = false;\n\n          ").concat(o,"\n\n          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));\n        }\n      ")}));var CX={kernelName:hc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,o=a.shape,s=o[o.length-1],u=fs(r.shape),c=i(qf(r,a),4),l=c[0],d=c[1],h=c[2],p=c[3],f=wW({inputs:{x:a},backend:n,attrs:{shape:[d,s]}}),m=wW({inputs:{x:r},backend:n,attrs:{shape:[fs(r.shape)/h,h]}});if(n.shouldExecuteOnCPU([r,a])||"string"===r.dtype){var v=n.readSync(a.dataId),g=n.bufferSync(r),y=VF(v,g,r.dtype,d,s,h,p,r.shape,u);return n.makeTensorInfo(l,r.dtype,y.values)}var b=new EX(s,p,[d,h],r.shape),x=n.runWebGLProgram(b,[m,f],m.dtype),w=wW({inputs:{x:x},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(x),w}},MX=E((function e(t,n){T(this,e),this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;var r=Iz(this.rank),a=function(e,t){for(var n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[],a=0;a<e.length;a++)2===a?r.push("index"):r.push("".concat(n[a]));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(r," resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ").concat(t[2],") ? 1.0 : 0.0;\n        setOutput(inBounds * getA(").concat(a,"));\n      }\n    ")}));function NX(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.indices,o=r.axis,s=r.batchDims,u=ws(o,a.shape)[0];if(Qs().get("DEBUG"))for(var c=n.readSync(i.dataId),l=a.shape[u],d=function(){var e=c[h];ls(e<=l-1&&e>=0,(function(){return"GatherV2: the index value ".concat(e," is not in [0, ").concat(l-1,"]")}))},h=0;h<c.length;++h)d();var p=Bw(a,i,u,s),f=fs(i.shape),m=[],v=wW({inputs:{x:a},backend:n,attrs:{shape:[p.batchSize,p.outerSize,p.dimSize,p.sliceSize]}}),g=wW({inputs:{x:i},backend:n,attrs:{shape:[p.batchSize,f/p.batchSize]}});m.push(v),m.push(g);var y=[p.batchSize,p.outerSize,f/p.batchSize,p.sliceSize];if(n.shouldExecuteOnCPU([a,i])||"string"===a.dtype){var b=n.bufferSync(g),x=n.bufferSync(v),w=UF(x,b,y);return m.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(p.outputShape,w.dtype,w.values)}var k=new MX(v.shape,y),S=n.runWebGLProgram(k,[v,g],v.dtype);m.push(S);var T=wW({inputs:{x:S},backend:n,attrs:{shape:p.outputShape}});return m.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),T}var RX={kernelName:dc,backendName:"webgl",kernelFunc:NX},LX=pW({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:XF,dtype:"bool"}),AX={kernelName:pc,backendName:"webgl",kernelFunc:LX},PX=pW({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool",cpuKernelImpl:BF}),DX={kernelName:fc,backendName:"webgl",kernelFunc:PX};var OX={kernelName:vc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return uX(t.input,!0,n)}},zX=hW({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),FX={kernelName:yc,backendName:"webgl",kernelFunc:zX},GX=hW({opSnippet:"return float(isinf(x));",dtype:"bool"}),WX={kernelName:bc,backendName:"webgl",kernelFunc:GX},VX=hW({opSnippet:"return float(isnan(x));",dtype:"bool"}),UX={kernelName:xc,backendName:"webgl",kernelFunc:VX},XX=pW({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:HF,dtype:"bool"}),BX={kernelName:kc,backendName:"webgl",kernelFunc:XX},HX=pW({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",cpuKernelImpl:ZF,dtype:"bool"}),ZX={kernelName:Sc,backendName:"webgl",kernelFunc:HX};var KX={kernelName:Tc,backendName:"webgl",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.num,o=KF(r,a,i);return t.makeTensorInfo([o.length],"float32",o)}},jX=hW({opSnippet:dW+"\n  return x < 0.0 ? 0./0. : log(x);\n",packedOpSnippet:"\n  vec4 result = log(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);\n  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);\n  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);\n  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);\n  return result;\n",cpuKernelImpl:jF}),YX={kernelName:_c,backendName:"webgl",kernelFunc:jX},QX=hW({opSnippet:dW+"\n  return log(1.0 + x);\n"}),JX={kernelName:Ic,backendName:"webgl",kernelFunc:QX},qX=pW({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"}),$X={kernelName:Ec,backendName:"webgl",kernelFunc:qX},eB=hW({opSnippet:"return float(!(x >= 1.0));"}),tB={kernelName:Cc,backendName:"webgl",kernelFunc:eB},nB=pW({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"}),rB={kernelName:Mc,backendName:"webgl",kernelFunc:nB},aB=E((function e(t,n,r,a,i){T(this,e),this.variableNames=["x"],this.outputShape=[];var o,s=n,u=t[3]-1;this.outputShape=t;var c="float(".concat(r,") + float(").concat(a,") * sum");o=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -".concat(s,"; j <= ").concat(s,"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ").concat(u,") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ").concat(o,";\n        setOutput(val);\n      }\n    ")})),iB=E((function e(t,n,r,a,i){T(this,e),this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,s=n,u=t[3]-1;this.outputShape=t;var c="float(".concat(r,") + float(").concat(a,") * sum");o=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ".concat(this.outputShape[3],";\n        bool hasNextRow = c < ").concat(this.outputShape[2],";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ").concat(s,";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ").concat(s,"; j <= ").concat(s,"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(").concat(u,"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ").concat(o,";\n        setOutput(result);\n      }\n    ")})),oB={kernelName:Rc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta,c=Qs().getBool("WEBGL_PACK_NORMALIZATION")?new iB(a.shape,i,o,s,u):new aB(a.shape,i,o,s,u);return n.runWebGLProgram(c,[a],a.dtype)}},sB=E((function e(t,n,r,a,i){T(this,e),this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=r,this.alpha=a,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ".concat(this.depth,"; ++d) {\n          int depthBegin = int(max(0.0, float(d - ").concat(n,")));\n          int depthEnd = int(min(float(").concat(this.depth,"),\n              float(d + ").concat(n," + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ").concat(this.depth,";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(").concat(a,") * norm + float(").concat(r,");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(").concat(a,")\n                * float(").concat(i,")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ").concat(i,");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    ")})),uB={kernelName:Lc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta,d=new sB(a.shape,s,u,c,l);return n.runWebGLProgram(d,[a,i,o],a.dtype)}};function cB(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.reductionIndices,s=r.keepDims,u=a.shape.length,c=ws(o,a.shape),l=c,d=Qv(l,u),h=null!=d,p=n.shouldExecuteOnCPU([a]),f=a;if(h){if(p){for(var m=n.texData.get(f.dataId).values,v=new Array(u),g=0;g<v.length;g++)v[g]=a.shape[d[g]];var y=wG(m,a.shape,a.dtype,d,v);f=n.makeTensorInfo(v,a.dtype),n.texData.get(f.dataId).values=y}else f=CW(a,d,n);l=qv(l.length,u)}Yv("max",l,u);var b,x=i(Kv(f.shape,l),2),w=x[0],k=x[1],S=w;if(s&&(S=jv(w,c)),p){var T=n.texData.get(f.dataId).values,_=YF(T,fs(k),S,a.dtype);b=n.makeTensorInfo(S,a.dtype),n.texData.get(b.dataId).values=_}else b=function(e,t,n,r){var a=fs(t),i=wW({inputs:{x:e},attrs:{shape:[fs(e.shape)/a,a]},backend:r}),o=_W(i,e.dtype,"max",r),s=wW({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(f,k,S,n);return h&&n.disposeIntermediateTensorInfo(f),b}var lB={kernelName:Ac,backendName:"webgl",kernelFunc:cB},dB=pW({opSnippet:JG+"\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+$G+"\n  return result;\n",cpuKernelImpl:QF}),hB={kernelName:Pc,backendName:"webgl",kernelFunc:dB};var pB={kernelName:Dc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;uz(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;ls($m(o,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(1,"'")}));var c=Xm(a.shape,i,o,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&ms(c.inShape,c.outShape))return tW({inputs:{x:a},backend:n});var l=new pV(c,"max",!1);return n.runWebGLProgram(l,[a],a.dtype)}};var fB={kernelName:zc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=Bm(a.shape,i,o,[1,1,1],s,c,u),d=new fV(l,"max",!1);return n.runWebGLProgram(d,[a],a.dtype)}},mB=E((function e(t){T(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideHeight,r=t.strideWidth,a=t.dilationHeight,i=t.effectiveFilterHeight,o=t.effectiveFilterWidth,s=i-1-t.padInfo.top,u=o-1-t.padInfo.left,c=i*o-1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(i,";\n          wR += ").concat(a,") {\n          float dyR = float(dyRCorner + wR) / ").concat(n,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(o,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(r,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ").concat(c," - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ").concat(o," + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),vB=E((function e(t){T(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,i=t.dilationDepth,o=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterDepth,c=t.effectiveFilterHeight,l=t.effectiveFilterWidth,d=u-1-t.padInfo.front,h=c-1-t.padInfo.top,p=l-1-t.padInfo.left,f=u*c*l-1;this.userCode="\n      const ivec3 pads = ivec3(".concat(d,", ").concat(h,", ").concat(p,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(u,";\n           wD += ").concat(i,") {\n          float dyD = float(dyDCorner + wD) / ").concat(n,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(c,";\n              wR += ").concat(o,") {\n            float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(l,";\n                wC += ").concat(s,") {\n              float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ").concat(f," -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ").concat(c," * ").concat(l," +\n                  wR * ").concat(l," + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var gB={kernelName:Fc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=Bm(i.shape,o,s,[1,1,1],u,c),d=new fV(l,"max",!0),h=n.runWebGLProgram(d,[i],i.dtype),p=new vB(l),f=n.runWebGLProgram(p,[a,h],i.dtype);return n.disposeIntermediateTensorInfo(h),f}};var yB={kernelName:Oc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;uz([i,t.output],"maxPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,d=Xm(o.shape,s,u,1,c,l),h=new pV(d,"max",!0),p=n.runWebGLProgram(h,[o],o.dtype),f=new mB(d),m=n.runWebGLProgram(f,[a,p],o.dtype);return n.disposeIntermediateTensorInfo(p),m}};var bB={kernelName:Gc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,o=n.filterSize,s=n.strides,u=n.pad,c=n.includeBatchInIndex,l=r;ls(4===a.shape.length,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(a.shape.length,".")}));var d=[1,1];ls($m(s,d),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(s," and dilations '").concat(d,"'")}));var h=Xm(a.shape,o,s,d,u),p=function(e,t,n,r){var a=new pV(n,"max",!1),i=r.runWebGLProgram(a,[e],"float32");return a=new pV(n,"max",!0,!0,t),[i,r.runWebGLProgram(a,[e],"float32")]}(a,c,h,l),f=i(p,2);return[f[0],f[1]]}};var xB={kernelName:Wc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,o=n.keepDims,s=n.axis,u=r,c=a.shape.length,l=ws(s,a.shape),d=l,h=Qv(d,c),p=null!=h,f=u.shouldExecuteOnCPU([a]),m=[],v=a;if(p){if(f){for(var g=u.texData.get(v.dataId).values,y=new Array(c),b=0;b<y.length;b++)y[b]=a.shape[h[b]];var x=wG(g,a.shape,a.dtype,h,y);v=u.makeTensorInfo(y,a.dtype),u.texData.get(v.dataId).values=x}else v=CW(a,h,u);m.push(v),d=qv(d.length,c)}Yv("sum",d,c);var w=i(Kv(v.shape,d),2),k=w[0],S=w[1],T=k;o&&(T=jv(k,l));for(var _=function(e,t,n,r){var a=fs(t),i=wW({inputs:{x:e},attrs:{shape:[fs(e.shape)/a,a]},backend:r}),o=_W(i,"float32","mean",r),s=wW({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(v,S,T,u),I=0,E=m;I<E.length;I++){var C=E[I];u.disposeIntermediateTensorInfo(C)}return _}};var wB={kernelName:Vc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,s=r.keepDims,u=a.shape.length,c=ws(o,a.shape),l=c,d=Qv(l,u),h=a;null!=d&&(h=RW({inputs:{x:a},backend:n,attrs:{perm:d}}),l=qv(l.length,a.shape.length)),Yv("min",l,u);var p,f=i(Kv(h.shape,l),2),m=f[0],v=wW({inputs:{x:h},backend:n,attrs:{shape:[-1,fs(f[1])]}}),g=_W(v,v.dtype,"min",n);return p=wW(s?{inputs:{x:g},backend:n,attrs:{shape:jv(m,c)}}:{inputs:{x:g},backend:n,attrs:{shape:m}}),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),null!=d&&n.disposeIntermediateTensorInfo(h),p}},kB=pW({opSnippet:JG+"\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+$G+"\n  return result;\n",cpuKernelImpl:JF}),SB={kernelName:Uc,backendName:"webgl",kernelFunc:kB},TB=E((function e(t,n,r){T(this,e),this.variableNames=["x"],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=Iz(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a),c="reflect"===r?0:1;this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        for (int i = 0; i < ").concat(a,"; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ").concat(c,";\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ").concat(c,";\n          }\n        }\n        ").concat(i," coords = outC - start;\n        setOutput(getX(").concat(u,"));\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ").concat(c,";\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ").concat(c,";\n          }\n          setOutput(getX(outC - start));\n        }\n      ")})),_B=E((function e(t,n,r){T(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=Iz(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=TG("rc",a),c=TG("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),d=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),h="reflect"===r?0:1,p="";if(1===a){var f="\n        ".concat(i," source = rc;\n        if (source < start) {\n          source = start * 2 - source - ").concat(h,";\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ").concat(h,";\n        }\n        source -= start;\n      ");p="\n        ".concat(i," rc = outputLoc;\n        ").concat(f,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(d,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(f,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(d,");\n        }\n      ")}else{var m="\n        ".concat(i," source = rc;\n        ").concat(i," lt = ").concat(i,"(lessThan(source, start));\n        ").concat(i," gte = ").concat(i,"(greaterThanEqual(source, end));\n        ").concat(i," orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ").concat(h,") +\n                gte * ((end - 1) * 2 - source + ").concat(h,");\n        source -= start;\n      ");p="\n        ".concat(i," rc = outputLoc;\n        ").concat(m,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(d,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(m,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(d,");\n        }\n        rc = outputLoc;\n        ").concat(u[a-2]," += 1;\n        if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {\n          ").concat(m,"\n          result[2] = getChannel(getX(").concat(c.join(),"), ").concat(d,");\n          ").concat(u[a-1]," += 1;\n          if(").concat(l,") {\n            ").concat(m,"\n            result[3] = getChannel(getX(").concat(c.join(),"), ").concat(d,");\n          }\n        }\n      ")}this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(p,"\n        setOutput(result);\n      }\n    ")})),IB={kernelName:Xc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode,s=Qs().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new _B(a.shape,i,o):new TB(a.shape,i,o);return n.runWebGLProgram(s,[a],a.dtype)}},EB=pW({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  bvec4 isNaN = equal(b, vec4(0.0));\n  "+$G+"\n  return result;\n"}),CB={kernelName:Bc,backendName:"webgl",kernelFunc:EB},MB=E((function e(t,n,r){T(this,e),this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,r],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ".concat(n-1,"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(").concat(n-1,"));\n      }\n    ")})),NB=pW({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),RB={kernelName:Qu,backendName:"webgl",kernelFunc:NB},LB="return a - b;",AB=pW({opSnippet:LB,packedOpSnippet:LB,supportsComplex:!0,cpuKernelImpl:yG}),PB={kernelName:Zl,backendName:"webgl",kernelFunc:AB};function DB(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=ws([r.dim],a.shape),o=cB({inputs:{x:a},backend:n,attrs:{reductionIndices:i,keepDims:!1}}),s=jv(o.shape,i),u=wW({inputs:{x:o},backend:n,attrs:{shape:s}}),c=AB({inputs:{a:a,b:u},backend:n}),l=eX({inputs:{x:c},backend:n}),d=MW({inputs:{x:l},backend:n,attrs:{axis:i,keepDims:!1}}),h=wW({inputs:{x:d},backend:n,attrs:{shape:s}}),p=NB({inputs:{a:l,b:h},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),p}var OB={kernelName:Pl,backendName:"webgl",kernelFunc:DB};var zB={kernelName:Hc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized,u=s?a:DB({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),c=u.shape[0],l=u.shape[1],d=new MB(c,l,i),h=[[o]],p=n.runWebGLProgram(d,[u],"int32",h);return s||n.disposeIntermediateTensorInfo(u),p}},FB=LG+"\n  return -x;\n";var GB={kernelName:Kc,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])){var o=r.texData.get(a.dataId),s=i($F(o.values,a.shape,a.dtype),2),u=s[0],c=s[1];return r.makeTensorInfo(c,a.dtype,u)}return t=Qs().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new HG(a.shape,"\n  vec4 result = -x;\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"):new RG(a.shape,FB),r.runWebGLProgram(t,[a],a.dtype)}},WB=zb;var VB={kernelName:Yc,backendName:"webgl",kernelFunc:function(e){cd("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=n.readSync(a.dataId),l=n.readSync(i.dataId),d=WB(c,l,o,s,u).selectedIndices;return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}},UB=Fb;var XB={kernelName:Qc,backendName:"webgl",kernelFunc:function(e){cd("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize,l=n.readSync(a.dataId),d=n.readSync(i.dataId),h=UB(l,d,o,s,u,c),p=h.selectedIndices,f=h.validOutputs;return[n.makeTensorInfo([p.length],"int32",new Int32Array(p)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}},BB=Gb;var HB={kernelName:Jc,backendName:"webgl",kernelFunc:function(e){cd("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma,l=n.readSync(a.dataId),d=n.readSync(i.dataId),h=BB(l,d,o,s,u,c),p=h.selectedIndices,f=h.selectedScores;return[n.makeTensorInfo([p.length],"int32",new Int32Array(p)),n.makeTensorInfo([f.length],"float32",new Float32Array(f))]}},ZB=E((function e(t,n,r,a){T(this,e),this.variableNames=["indices"],this.outputShape=[t,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(".concat(a,"), float(").concat(r,"),\n                      float(index == coords.y)));\n      }\n    ")})),KB={kernelName:$c,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.dtype,o=r.depth,s=r.onValue,u=r.offValue,c=fs(a.shape),l=new ZB(c,o,s,u),d=wW({inputs:{x:a},backend:n,attrs:{shape:[c]}}),h=n.runWebGLProgram(l,[d],i);n.disposeIntermediateTensorInfo(d);var p=wW({inputs:{x:h},backend:n,attrs:{shape:[].concat(b(a.shape),[o])}});return n.disposeIntermediateTensorInfo(h),p}};function jB(e){var t=e.inputs,n=e.backend,r=t.x;if("complex64"===r.dtype){var a=DV({inputs:{input:r},backend:n}),i=jB({inputs:{x:a},backend:n}),o=JV({inputs:{input:r},backend:n}),s=jB({inputs:{x:o},backend:n}),u=rW({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return dX({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}var YB={kernelName:nd,backendName:"webgl",kernelFunc:jB};var QB={kernelName:qc,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===a.dtype){var i=DV({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=JV({inputs:{input:a},backend:r}),u=jB({inputs:{x:s},backend:r}),c=rW({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return dX({attrs:{shape:a.shape,dtype:a.dtype,value:1},backend:r})}};var JB={kernelName:el,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return nX({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){ds(a,e.shape,"All tensors passed to stack must have matching shapes"),ls(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=t.map((function(e){var t=nX({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),u=eU({inputs:s,backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),u}},qB=E((function e(t,n,r){T(this,e),this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=Iz(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ").concat(i," coords = outC - start;\n          setOutput(getX(").concat(u,"));\n        }\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ")})),$B=E((function e(t,n,r){T(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));for(var a=t.length,i=Iz(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=TG("rc",a),c=TG("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),d=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),h=["".concat(i," rc = outputLoc;"),"".concat(u[a-1]," += 1;\n       if(").concat(l,") {\n      "),1===a?"":"}\n       rc = outputLoc;\n       ".concat(u[a-2]," += 1;\n       if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {"),1===a?"":"  ".concat(u[a-1]," += 1;\n         if(").concat(l,") {")],p=1===a?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",f="",m=0,v=1===a?2:4;m<v;m++)f+="\n        ".concat(h[m],"\n        if (").concat(p,") {\n          result[").concat(m,"] = float(value);\n        } else {\n          ").concat(i," source = rc - start;\n          result[").concat(m,"] = getChannel(getX(").concat(c.join(),"), ").concat(d,");\n        }\n      ");f+=1===a?"} ":"}}",this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(f,"\n        setOutput(result);\n      }\n    ")})),eH=function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.constantValue;if(0===fs(a.shape)){var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]}));return dX({backend:n,attrs:{shape:s,value:o,dtype:a.dtype}})}var u=Qs().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new $B(a.shape,i,o):new qB(a.shape,i,o),c=[[o]];return n.runWebGLProgram(u,[a],a.dtype,c)},tH={kernelName:tl,backendName:"webgl",kernelFunc:eH},nH=pW({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  bvec4 isNaN1 = lessThan(a, vec4(0.0));\n  bvec4 isNaN2 = lessThan(floor(b), b);\n  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);\n  "+$G+"\n  return result;\n"}),rH={kernelName:nl,backendName:"webgl",kernelFunc:nH};var aH={kernelName:al,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,o=n.x,s=a.axis,u=a.keepDims,c=o.shape.length,l=[],d=ws(s,o.shape),h=d,p=Qv(h,c),f=o;if(null!=p&&(f=RW({inputs:{x:o},backend:r,attrs:{perm:p}}),h=qv(h.length,c),l.push(f)),Yv("prod",h,c),r.shouldExecuteOnCPU([f])){var m=r.texData.get(f.dataId).values,v=tG(f.shape,f.dtype,m,h),g=v.outVals,y=v.outShape,b=v.outDtype;t=r.makeTensorInfo(y,b,g)}else{var x=i(Kv(f.shape,h),2),w=x[0],k=fs(x[1]),S=wW({inputs:{x:f},backend:r,attrs:{shape:[-1,k]}}),T=_W(S,Lh(o.dtype),"prod",r);t=wW({inputs:{x:T},backend:r,attrs:{shape:w}}),l.push(S),l.push(T)}if(u){l.push(t);var _=jv(t.shape,d);t=wW({inputs:{x:t},backend:r,attrs:{shape:_}})}return l.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),t}};var iH={kernelName:il,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.paramsNestedSplits,o=t.paramsDenseValues,s=t.indices,u=r.outputRaggedRank,c=a.map((function(e){return n.readSync(e.dataId)})),l=a.map((function(e){return e.shape})),d=n.readSync(o.dataId),h=n.readSync(s.dataId),p=i(nG(c,l,d,o.shape,o.dtype,h,s.shape,u),3),f=p[0],m=p[1],v=p[2],g=f.map((function(e){return n.makeTensorInfo([e.length],"int32",e)})),y=n.makeTensorInfo(v,o.dtype,m);return g.concat([y])}};var oH={kernelName:ol,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.shape,o=t.values,s=t.defaultValue,u=t.rowPartitionTensors,c=r.rowPartitionTypes,l=n.readSync(a.dataId),d=n.readSync(o.dataId),h=n.readSync(s.dataId),p=u.map((function(e){return n.readSync(e.dataId)})),f=u.map((function(e){return e.shape})),m=i(rG(l,a.shape,d,o.shape,o.dtype,h,s.shape,p,f,c),2),v=m[0],g=m[1];return n.makeTensorInfo(v,o.dtype,g)}},sH=function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.step,o=n.dtype,s=aG(r,a,i,o);return t.makeTensorInfo([s.length],o,s)},uH={kernelName:sl,backendName:"webgl",kernelFunc:sH},cH=hW({opSnippet:"return 1.0 / x;"}),lH={kernelName:cl,backendName:"webgl",kernelFunc:cH},dH=hW({opSnippet:LG+"\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),hH={kernelName:ll,backendName:"webgl",kernelFunc:dH},pH=hW({opSnippet:LG+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),fH={kernelName:vl,backendName:"webgl",kernelFunc:pH},mH=E((function e(t,n,r,a,o){T(this,e),this.variableNames=["A"],this.outputShape=[];var s=i(t,4),u=s[0],c=s[1],l=s[2],d=s[3];this.outputShape=[u,n,r,d];var h,p=[a&&n>1?c-1:c,a&&r>1?l-1:l],f=[a&&n>1?n-1:n,a&&r>1?r-1:r];h=o?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(p[0]/f[0],",\n          ").concat(p[1]/f[1],");\n      const vec2 inputShapeRC = vec2(").concat(c,".0, ").concat(l,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    ")})),vH=E((function e(t,n,r,a,o){T(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var s=i(t,4),u=s[0],c=s[1],l=s[2],d=s[3];this.outputShape=[u,n,r,d];var h,p=[a&&n>1?c-1:c,a&&r>1?l-1:l],f=[a&&n>1?n-1:n,a&&r>1?r-1:r];h=o?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(p[0]/f[0],",\n          ").concat(p[1]/f[1],",\n          ").concat(p[1]/f[1],");\n      const vec3 inputShapeRC = vec3(").concat(c,".0, ").concat(l,".0,\n                                     ").concat(l,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(d-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    ")}));var gH={kernelName:fl,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,o=r.alignCorners,s=r.halfPixelCenters,u=i(r.size,2),c=u[0],l=u[1],d=Qs().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new vH(a.shape,c,l,o,s):new mH(a.shape,c,l,o,s);return n.runWebGLProgram(d,[a],"float32")}},yH=E((function e(t,n,r){T(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=i(n,3),o=a[1],s=a[2],u=i(t,3),c=u[1],l=u[2],d=[r&&c>1?o-1:o,r&&l>1?s-1:s],h=[r&&c>1?c-1:c,r&&l>1?l-1:l],p=d[0]/h[0],f=d[1]/h[1],m=1/p,v=1/f,g=2*Math.ceil(m)+2,y=2*Math.ceil(v)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(p,");\n        const float widthScale = float(").concat(f,");\n\n        const float invHeightScale = float(").concat(m,");\n        const float invWidthScale = float(").concat(v,");\n\n        const int winHeight = int(").concat(g,");\n        const int winWidth = int(").concat(y,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(c,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(l,") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ").concat(o-1,".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ").concat(s-1,".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}));var bH={kernelName:ml,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new yH(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},xH=E((function e(t,n,r,a,o){T(this,e),this.variableNames=["A"],this.outputShape=[];var s=i(t,4),u=s[0],c=s[1],l=s[2],d=s[3];this.outputShape=[u,n,r,d];var h,p=[a&&n>1?c-1:c,a&&r>1?l-1:l],f=[a&&n>1?n-1:n,a&&r>1?r-1:r],m=a?"0.5":"0.0";h=o?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(p[0]/f[0],",\n          ").concat(p[1]/f[1],");\n      const vec2 inputShapeRC = vec2(").concat(c,".0, ").concat(l,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(m,")));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    ")})),wH=E((function e(t,n,r,a,o){T(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var s=i(t,4),u=s[0],c=s[1],l=s[2],d=s[3];this.outputShape=[u,n,r,d];var h,p=[a&&n>1?c-1:c,a&&r>1?l-1:l],f=[a&&n>1?n-1:n,a&&r>1?r-1:r],m=a?"0.5":"0.0";h=o?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(p[0]/f[0],",\n          ").concat(p[1]/f[1],",\n          ").concat(p[1]/f[1],");\n      const vec3 inputShapeRC = vec3(").concat(c,".0, ").concat(l,".0,\n                                     ").concat(l,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(m,")));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(d-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    ")}));var kH={kernelName:hl,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,o=r.alignCorners,s=r.halfPixelCenters,u=i(r.size,2),c=u[0],l=u[1],d=Qs().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new wH(a.shape,c,l,o,s):new xH(a.shape,c,l,o,s);return n.runWebGLProgram(d,[a],a.dtype)}},SH=E((function e(t,n,r){T(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=i(n,3),o=a[1],s=a[2],u=i(t,3),c=u[1],l=u[2],d=[r&&c>1?o-1:o,r&&l>1?s-1:s],h=[r&&c>1?c-1:c,r&&l>1?l-1:l],p=d[0]/h[0],f=d[1]/h[1],m=1/p,v=1/f,g=2*Math.ceil(m)+2,y=2*Math.ceil(v)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(p,");\n        const float widthScale = float(").concat(f,");\n\n        const float invHeightScale = float(").concat(m,");\n        const float invWidthScale = float(").concat(v,");\n\n        const int winHeight = int(").concat(g,");\n        const int winWidth = int(").concat(y,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(c,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(l,") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(").concat(d[0],") *\n                (float(dyR) / float(").concat(h[0],"));\n\n            float sourceFracCol =\n                float(").concat(d[1],") *\n                  (float(dyC) / float(").concat(h[1],"));\n\n            int sourceNearestRow = int(min(\n                float(int(").concat(o,") - 1),\n                ").concat(r," ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(").concat(s,") - 1),\n                ").concat(r," ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}));var TH={kernelName:pl,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new SH(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},_H=E((function e(t,n){T(this,e),this.variableNames=["x"];var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));if(this.outputShape=t,1!==r){var a=t.map((function(e,r){return function(e){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - coords[").concat(e,"] - 1"):"coords[".concat(e,"]")}(r)})).join(","),i=Iz(r);this.userCode="\n      void main() {\n        ".concat(i," coords = getOutputCoords();\n        setOutput(getX(").concat(a,"));\n      }\n    ")}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(".concat(t[0]," - coord - 1));\n        }\n      ")})),IH=E((function e(t,n){T(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));this.outputShape=t;var a=TG("rc",r),i="".concat(a[r-1]," + 1 < ").concat(this.outputShape[r-1]),o="".concat(a[r-2]," + 1 < ").concat(this.outputShape[r-2]),s=Iz(r);function u(e){var r=t.map((function(r,a){return function(e,r){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - ").concat(r[e]," - 1"):"".concat(r[e])}(a,e)})),a=r.join(","),i=r.slice(-2).join(",");return"getChannel(getX(".concat(a,"), vec2(").concat(i,"))")}this.userCode=1===r?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(".concat(t[0]," - rc - 1),\n            ").concat(t[0]," - rc - 1);\n          if(").concat(i,"){\n              result.g = getChannel(getX(").concat(t[0]," - (rc  + 1) - 1),\n                ").concat(t[0]," - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      "):"\n        void main() {\n          ".concat(s," rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ").concat(function(e){return u(e)}(a.slice()),";\n          if(").concat(i,"){\n            result.g = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",u(e)}(a.slice()),";\n          }\n          if(").concat(o,") {\n            result.b = ").concat(function(e){return e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            if(").concat(i,") {\n              result.a = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            }\n          }\n          setOutput(result);\n        }\n    ")}));var EH={kernelName:gl,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims,o=a.shape.length,s=ws(i,a.shape);if(0===o)return tW({inputs:{x:a},backend:n});var u=Qs().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new IH(a.shape,s):new _H(a.shape,s);return n.runWebGLProgram(u,[a],a.dtype)}},CH=E((function e(t,n){T(this,e),this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];var r=t[1],a=t[2];this.outputShape=t;var i="";i="number"==typeof n?"float outputValue = ".concat(n.toFixed(2),";"):"\n        vec3 fill = vec3(".concat(n.join(","),");\n        float outputValue = fill[coords[3]];"),this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ".concat(i,"\n          if(coordX >= 0 && coordX < ").concat(a," && coordY >= 0 && coordY < ").concat(r,") {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")})),MH={kernelName:id,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,o=n.radians,s=n.fillValue,u=n.center,c=r,l=new CH(a.shape,s),d=i(Jx(u,a.shape[1],a.shape[2]),2),h=[[d[0],d[1],Math.sin(o),Math.cos(o)]];return c.runWebGLProgram(l,[a],a.dtype,h)}},NH=hW({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),RH={kernelName:yl,backendName:"webgl",kernelFunc:NH},LH=hW({opSnippet:"return inversesqrt(x);",cpuKernelImpl:iG}),AH={kernelName:bl,backendName:"webgl",kernelFunc:LH},PH=E((function e(t,n,r,a,i,o){T(this,e),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var s=Iz(i.length),u=Iz(o.length),c="";1===r?c="i":2===r&&(c="i, j");var l="getIndices(".concat(c,")"),d="";1===a?d="i":2===a&&(d="i, coords[1]");var h="getUpdates(".concat(d,")"),p=n>1?"strides[j]":"strides";this.userCode="\n        ".concat(s," strides = ").concat(s,"(").concat(i,");\n\n        void main() {\n          ").concat(u," coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ").concat(t,"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ").concat(n,"; j++) {\n              int index = round(").concat(l,");\n              flattenedIndex += index * ").concat(p,";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ").concat(h,";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      ")}));var DH={kernelName:xl,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=nm(0,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,d=s.strides,h=s.outputSize,p=[h/l,l];if(0===h)return n.makeTensorInfo(o,a.dtype);var f=wW({inputs:{x:a},backend:n,attrs:{shape:[c,u]}}),m=wW({inputs:{x:i},backend:n,attrs:{shape:[c,l]}}),v=n.makeTensorInfo([],"float32",new Float32Array([0])),g=new PH(c,u,f.shape.length,m.shape.length,d,p),y=n.runWebGLProgram(g,[m,f,v],m.dtype),b=wW({inputs:{x:y},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(v),b}},OH=E((function e(t,n,r,a){T(this,e),this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,r];var i="for (int i = 0; i < ".concat(Math.ceil(Math.log2(n+1)),"; ++i) { if (left >= right) break;"),o=2===Qs().getNumber("WEBGL_VERSION")?"while (left < right) {":i,s="left"===a?"<":"<=";this.userCode="\n       int findBound(int batch, float value) {\n         int left = 0;\n         int right = numInputs;\n         int mid;\n         ".concat(o,"\n           mid = (left + right) / 2;\n           if (getSortedSequence(batch, mid) ").concat(s," value) {\n             left = mid + 1;\n           } else {\n             right = mid;\n           }\n         }\n         return right;\n       }\n\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int valueIndex = coords[1];\n\n         float value = getValues(batch, valueIndex);\n\n         setOutput(float(findBound(batch, value)));\n       }\n     ")}));var zH={kernelName:wl,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sortedSequence,i=t.values,o=r.side,s=new OH(a.shape[0],a.shape[1],i.shape[1],o),u=[[a.shape[1]]];return n.runWebGLProgram(s,[a,i],"int32",u)}},FH=E((function e(t,n,r){var a,i;if(T(this,e),this.variableNames=["c","a","b"],this.outputShape=n,r>4)throw Error("Where for rank ".concat(r," is not yet supported"));if(1===r)i="resRC",a="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],c=0;c<n.length;c++)u.push("".concat(o[c])),c<t&&s.push("".concat(o[c]));a=s.join(),i=u.join()}var l=Iz(r);this.userCode="\n      void main() {\n        ".concat(l," resRC = getOutputCoords();\n        float cVal = getC(").concat(a,");\n        if (cVal >= 1.0) {\n          setOutput(getA(").concat(i,"));\n        } else {\n          setOutput(getB(").concat(i,"));\n        }\n      }\n    ")}));var GH={kernelName:kl,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e,o=new FH(r.shape.length,a.shape,a.shape.length);return n.runWebGLProgram(o,[r,a,i],Rh(a.dtype,i.dtype))}},WH=hW({opSnippet:"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ".concat(rw,";\n  float scale = ").concat(aw,";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n")}),VH={kernelName:Sl,backendName:"webgl",kernelFunc:WH},UH=hW({opSnippet:dW+"\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",packedOpSnippet:"\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:sG}),XH={kernelName:Cl,backendName:"webgl",kernelFunc:UH},BH=hW({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"}),HH={kernelName:El,backendName:"webgl",kernelFunc:BH},ZH=hW({opSnippet:dW+"\n  return sin(x);\n"}),KH={kernelName:_l,backendName:"webgl",kernelFunc:ZH},jH=hW({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"}),YH={kernelName:Il,backendName:"webgl",kernelFunc:jH},QH=hW({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"}),JH={kernelName:Ml,backendName:"webgl",kernelFunc:QH},qH={kernelName:Ll,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings;ls(a.shape.length<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var s=i.reduce((function(e,t){return e*t})),u=[[0,0]];u.push.apply(u,b(o));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=[],d=eH({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),h=qx(d.shape,i,s,!1),p=$x(h.length,i.length,!1),f=ew(d.shape,i,s,!1),m=wW({inputs:{x:d},backend:n,attrs:{shape:h}}),v=RW({inputs:{x:m},backend:n,attrs:{perm:p}}),g=wW({inputs:{x:v},backend:n,attrs:{shape:f}});return l.push(d),l.push(m),l.push(v),l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}};var $H={kernelName:Dl,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.indices,a=t.values,o=t.denseShape,s=t.defaultValue;if(1!==o.shape.length)throw new Error("Dense shape must be a vector, saw:\n         ".concat(o.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n         ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n         ".concat(a.shape));if(0!==s.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(s.shape));var u=n.readSync(r.dataId),c=n.readSync(a.dataId),l=n.readSync(o.dataId),d=n.readSync(s.dataId)[0],h=i(lG(u,r.shape,r.dtype,c,a.dtype,l,d),5),p=h[0],f=h[1],m=h[2],v=h[3],g=h[4];return[n.makeTensorInfo(f,r.dtype,p),n.makeTensorInfo([f[0]],a.dtype,m),n.makeTensorInfo([v.length],"bool",new Uint8Array(v.map((function(e){return Number(e)})))),n.makeTensorInfo([g.length],r.dtype,new Int32Array(g))]}};var eZ={kernelName:Ol,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.inputIndices,a=t.inputShape,o=t.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape ".concat(a.shape));if(1!==o.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(o.shape));var s=Array.from(n.readSync(a.dataId)),u=n.readSync(r.dataId),c=Array.from(n.readSync(o.dataId)),l=i(dG(u,r.shape,r.dtype,s,c),3),d=l[0],h=l[1],p=l[2];return[n.makeTensorInfo(h,r.dtype,d),n.makeTensorInfo([p.length],o.dtype,new Int32Array(p))]}};var tZ={kernelName:zl,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,o=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n              ".concat(a.shape));if(1!==o.shape.length)throw new Error("Segment ids should be a vector but received shape\n              ".concat(o.shape));var s=n.readSync(r.dataId),u=n.readSync(a.dataId),c=n.readSync(o.dataId),l=i(hG(s,r.shape,r.dtype,u,c,!0),2),d=l[0],h=l[1];return n.makeTensorInfo(h,r.dtype,d)}};var nZ={kernelName:Fl,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,o=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n             ".concat(a.shape));if(1!==o.shape.length)throw new Error("Segment ids should be a vector but received shape\n             ".concat(o.shape));var s=n.readSync(r.dataId),u=n.readSync(a.dataId),c=n.readSync(o.dataId),l=i(hG(s,r.shape,r.dtype,u,c),2),d=l[0],h=l[1];return n.makeTensorInfo(h,r.dtype,d)}};var rZ={kernelName:Gl,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sparseIndices,i=t.sparseValues,o=t.defaultValue,s=r.outputShape,u=nm(0,a,s),c=u.sliceRank,l=u.numUpdates,d=u.sliceSize,h=u.strides,p=u.outputSize;if("string"===i.dtype){var f=n.bufferSync(a),m=n.bufferSync(i),v=sh(n.readSync(o.dataId)[0]),g=oG(f,m,s,p,d,l,c,h,v,false);return n.makeTensorInfo(s,g.dtype,g.values)}var y=new PH(l,c,a.shape.length,i.shape.length,h,[p,1],false),b=n.runWebGLProgram(y,[i,a,o],i.dtype),x=wW({inputs:{x:b},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(b),x}};var aZ={kernelName:Al,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.numOrSizeSplits,o=ws(r.axis,a.shape)[0],s=Mw(a,i,o),u=a.shape.length,c=new Array(u).fill(0),l=a.shape.slice();return s.map((function(e){var t=b(l);t[o]=e;var r=CV({inputs:{x:a},backend:n,attrs:{begin:c,size:t}});return c[o]+=e,r}))}},iZ="return sqrt(x);",oZ=hW({opSnippet:iZ,packedOpSnippet:iZ,cpuKernelImpl:pG}),sZ={kernelName:Nl,backendName:"webgl",kernelFunc:oZ},uZ={kernelName:Vl,backendName:"webgl",kernelFunc:hW({opSnippet:"return x * x;"})},cZ="return (a - b) * (a - b);",lZ=pW({opSnippet:cZ,packedOpSnippet:cZ}),dZ={kernelName:Wl,backendName:"webgl",kernelFunc:lZ};var hZ={kernelName:rd,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=LG+"\n    return x > 0.0 ? 1.0 : float(".concat(n.alpha,");\n  "),o=new RG(a.shape,i);return r.runWebGLProgram(o,[a],a.dtype)}},pZ=E((function e(t,n,r){T(this,e),this.variableNames=["x"],this.outputShape=r;var a=r.length,i=Iz(r.length),o=Iz(r.length),s="";if(1===a)s="coords * strides + begin";else{var u=0;s=r.map((function(e,t){return u++,1===r.length?"coords * strides[".concat(t,"] + begin[").concat(t,"]"):"coords[".concat(u-1,"] * strides[").concat(t,"] + begin[").concat(t,"]")})).join(",")}this.userCode="\n      ".concat(i," begin = ").concat(i,"(").concat(t,");\n      ").concat(i," strides = ").concat(i,"(").concat(n,");\n\n      void main() {\n        ").concat(o," coords = getOutputCoords();\n        setOutput(getX(").concat(s,"));\n      }\n    ")}));var fZ={kernelName:Ul,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.begin,s=a.end,u=a.strides,c=a.beginMask,l=a.endMask,d=a.ellipsisMask,h=a.newAxisMask,p=a.shrinkAxisMask,f=bm(i.shape,o,s,u,c,l,d,h,p),m=f.finalShapeSparse,v=f.finalShape,g=f.isIdentity,y=f.sliceDim0,b=f.isSimpleSlice,x=f.begin,w=f.end,k=f.strides;if(g)t=wW({inputs:{x:i},backend:r,attrs:{shape:v}});else if(y||b){ls(i.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(i.shape.length)}));var S=sm(x,w,k),T=CV({inputs:{x:i},backend:r,attrs:{begin:x,size:S}});t=wW({inputs:{x:T},backend:r,attrs:{shape:v}}),r.disposeIntermediateTensorInfo(T)}else if(r.shouldExecuteOnCPU([i])){var _=r.readSync(i.dataId),I=df(i.shape,i.dtype,_),E=fG(m,I,k,x);t=r.makeTensorInfo(v,i.dtype,E.values)}else{var C=new pZ(x,k,m);t=r.runWebGLProgram(C,[i],i.dtype)}var M=wW({inputs:{x:t},backend:r,attrs:{shape:v}});return r.disposeIntermediateTensorInfo(t),M}};var mZ={kernelName:Xl,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=r.separator,o=r.nGramWidths,s=r.leftPad,u=r.rightPad,c=r.padWidth,l=r.preserveShortSequences,d=t.data,h=t.dataSplits,p=n.readSync(d.dataId),f=n.readSync(h.dataId),m=i(mG(p,f,a,o,s,u,c,l),2),v=m[0],g=m[1];return[n.makeTensorInfo([v.length],"string",v),n.makeTensorInfo(h.shape,"int32",g)]}};var vZ={kernelName:Bl,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.skipEmpty,a=t.input,o=t.delimiter;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(1!==a.shape.length)throw new Error("Input must be a vector, got shape: ".concat(a.shape));if(0!==o.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(o.shape));var s=n.readSync(a.dataId),u=n.readSync(o.dataId)[0],c=i(vG(s,u,r),3),l=c[0],d=c[1],h=c[2],p=d.length;return[n.makeTensorInfo([p,2],"int32",l),n.makeTensorInfo([p],"string",d),n.makeTensorInfo([2],"int32",new Int32Array(h))]}};var gZ={kernelName:Hl,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.numBuckets,a=t.input;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");var i=n.readSync(a.dataId),o=gG(i,r);return n.makeTensorInfo(a.shape,"int32",o)}},yZ=hW({opSnippet:"return tan(x);"}),bZ={kernelName:Kl,backendName:"webgl",kernelFunc:yZ},xZ=hW({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"}),wZ={kernelName:jl,backendName:"webgl",kernelFunc:xZ},kZ=E((function e(t,n){T(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[a]*n[a];this.outputShape=r,this.rank=r.length;var i=Iz(this.rank),o=function(e){var t=e.length;if(t>5)throw Error("Tile for rank ".concat(t," is not yet supported"));if(1===t)return"imod(resRC, ".concat(e[0],")");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],a=0;a<e.length;a++)r.push("imod(".concat(n[a],", ").concat(e[a],")"));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(i," resRC = getOutputCoords();\n        setOutput(getA(").concat(o,"));\n      }\n    ")}));function SZ(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;if("string"===a.dtype||a.shape.length>5){var o=n.readSync(a.dataId),s="string"===a.dtype?o.map((function(e){return sh(e)})):o,u=df(a.shape,a.dtype,s),c=bG(u,i);return n.makeTensorInfo(c.shape,c.dtype,c.values)}var l=new kZ(a.shape,i);return n.runWebGLProgram(l,[a],a.dtype)}var TZ={kernelName:Yl,backendName:"webgl",kernelFunc:SZ},_Z=E((function e(t){T(this,e),this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode="\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // We compare elements pair-wise within a group of size 2 * inc.\n         // The comparing rule for each group alternates between ascending\n         // and descending. Within each group, we compare each pair at\n         // positions i and i+inc. To decide whether an element at position i\n         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n         // inc, it is in the first half of the group, we denote it as x0,\n         // otherwise we denote it as x1.\n         // For example, as shown in the Bitonic top K paper referenced above,\n         // Figure5(a) shows that element[1] is in the\n         // second half of the group when group size is 2, but it is in the\n         // first half of the group when group size is 4.\n\n         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;\n         int i = isFirstInPair ? elemIdx : elemIdx - inc;\n\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));\n         float x0 = i0 < n ? getX(batch, i0) : negativeInf;\n         float x1 = i1 < n ? getX(batch, i1) : negativeInf;\n\n         // Denotes which direction indices are in (ascending or descending).\n         bool reverse = imod(elemIdx, 2 * dir) >= dir;\n         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n         if (reverse == isGreater) { // Elements in opposite order of direction\n           int iTemp = i0;\n           i0 = i1;\n           i1 = iTemp;\n         }\n         if (isFirstInPair) {\n            setOutput(float(i0));\n         } else {\n            setOutput(float(i1));\n         }\n       }\n     "})),IZ=E((function e(t){T(this,e),this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode="\n    void main() {\n         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // The output size is half of the previous size.\n         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),\n         // we only need to output the indices at positions |, the indices at\n         // positions _ can be thrown away, see Figure5(b) After Phase 2\n         // (Merge phase) in the Bitonic Top K paper referenced above.\n         // For example, the paper shows we only need to output the orange bars.\n         // The output sequence should look like this | | | | | | | |.\n         // Because the sequence is halved, to map the output index back\n         // to the previous sequence to find the corresponding value,\n         // we need to double the index. When we double the index,\n         // we basically interpolate a position, so 2i looks like\n         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position\n         // of each 2k positions by - elemIdx % k. E.g. for output at\n         // index 4,5,6,7, we want to get the corresponding element at\n         // original index 8,9,10,11, for output at index 8,9,10,11,\n         // we want to get the corresponding element at original index\n         // 16,17,18,19, so on and so forth.\n\n         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));\n\n         float x0 = getX(batch, i0);\n         float x1 = i1 < n ? getX(batch, i1) : x0;\n\n         setOutput(x0 >= x1 ? float(i0) : float(i1));\n       }\n     "}));function EZ(e,t){null!==t&&e.disposeIntermediateTensorInfo(t)}function CZ(e){for(var t=1;t<e;)t*=2;return t}var MZ={kernelName:Ql,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.k,s=r.sorted,u=Qs().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),c=Qs().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),l=a.shape,d=l[l.length-1];if(n.shouldExecuteOnCPU([a])||d<u||o>c){var h=n.readSync(a.dataId),p=i(xG(h,l,a.dtype,o,s),2),f=p[0],m=p[1];return[n.makeTensorInfo(f.shape,f.dtype,f.values),n.makeTensorInfo(m.shape,m.dtype,m.values)]}if(0===o)return l[l.length-1]=0,[n.makeTensorInfo(l,a.dtype,[]),n.makeTensorInfo(l,"int32",[])];if(1===d)return[a,dX({attrs:{shape:l,dtype:"int32",value:0},backend:n})];var v=n.texData.get(a.dataId),g=null!==v&&v.isPacked,y=g?n.unpackTensor(a):a,b=fs(l)/d,x=wW({inputs:{x:y},attrs:{shape:[b,d]},backend:n});g&&EZ(n,y);for(var w=CZ(o),k=CZ(d),S=null,T=function(){return null===S?[x,x]:[x,S]},_=function(e,t,r){var a=T(),i=new _Z(r),o=[[d],[null===S?1:0],[Number.NEGATIVE_INFINITY],[e],[t]],s=S;S=n.runWebGLProgram(i,a,"int32",o),EZ(n,s)},I=1;I<w;I*=2)for(var E=2*I,C=I;C>=1;C/=2)_(E,C,[b,k]);for(var M=k;M>w;M/=2){var N=T(),R=new IZ([b,M/2]),L=[[d],[null===S?1:0],[w]],A=S;S=n.runWebGLProgram(R,N,"int32",L),EZ(n,A);for(var P=w/2,D=2*P,O=P;O>=1;O/=2)_(D,O,S.shape)}var z=S;S=CV({inputs:{x:S},backend:n,attrs:{begin:0,size:[b,o]}}),EZ(n,z);var F=NX({inputs:{x:x,indices:S},backend:n,attrs:{axis:1,batchDims:1}});EZ(n,x);var G=l.slice(0,-1);G.push(o),z=S,S=wW({inputs:{x:S},attrs:{shape:G},backend:n}),EZ(n,z);var W=F;return F=wW({inputs:{x:F},attrs:{shape:G},backend:n}),EZ(n,W),[F,S]}},NZ=E((function e(t,n,r,a,i,o){T(this,e),this.variableNames=["Image","Transforms"],this.outputShape=o;var s,u="nearest"===r?1:2;switch(a){case"constant":default:s=1;break;case"reflect":s=2;break;case"wrap":s=3;break;case"nearest":s=4}this.userCode="\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(".concat(s," == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ").concat(t," && 0 <= coordX && coordX < ").concat(n,") {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(").concat(i,");\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(").concat(i,");\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(").concat(n,"));\n                float mapY = mapCoord(inY, float(").concat(t,"));\n\n                if (").concat(u," == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        ")}));var RZ={kernelName:Jl,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,o=t.transforms,s=r.interpolation,u=r.fillMode,c=r.fillValue,l=r.outputShape,d=i(a.shape,4),h=d[0],p=d[1],f=d[2],m=d[3],v=i(null!==l&&void 0!==l?l:[p,f],2),g=v[0],y=v[1],b=new NZ(p,f,s,u,c,[h,g,y,m]);return n.runWebGLProgram(b,[a,o],"float32")}};var LZ={kernelName:$l,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;uz(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");var o=r.readSync(i.dataId),s=kG(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[r.makeTensorInfo(c,i.dtype,u),r.makeTensorInfo([l.length],"int32",l)]}};var AZ={kernelName:ed,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a,s=o.shape.length,u=a.shape[i],c=new Array(s-1),l=0,d=0;d<s;d++)d!==i&&(c[l++]=o.shape[d]);var h=[],p=new Array(s).fill(0),f=o.shape.slice();f[i]=1;for(var m=new Array(u),v=0;v<m.length;v++){p[i]=v;var g=CV({inputs:{x:o},backend:n,attrs:{begin:p,size:f}}),y=wW({inputs:{x:g},backend:n,attrs:{shape:c}});m[v]=y,h.push(g)}return h.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),m}},PZ=E((function e(t,n){T(this,e),this.variableNames=["x","segmentIds"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.numSegments,s=o*Math.ceil(i/r);this.outputShape=[a,s];var u=4*Math.floor(r/4),c=r%4,l="\n        sumValue += dot(values, segFilter);\n    ",d="";i%r>0&&(d="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      "));var h="";i%r>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return -1.0;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat("0.0",";\n\n      float getValue(int batch, int inIdx) {\n        ").concat(d,"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ").concat(h,"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ").concat(o,")) * float(").concat(r,"));\n        int currentSeg = int(mod(float(outIdx), float(").concat(o,")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(u,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(u,";\n        if (").concat(1===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ").concat(l,"\n        } else if (").concat(2===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ").concat(l,"\n        } else if (").concat(3===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ").concat(l,"\n        }\n        setOutput(").concat("sumValue",");\n      }\n    ")}));for(var DZ={kernelName:td,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.segmentIds,o=r.numSegments,s=a.shape.length,u=[],c=0,l=Qv([c],s),d=a;null!=l&&(d=RW({inputs:{x:a},backend:n,attrs:{perm:l}}),u.push(d),c=qv(1,s)[0]);var h=Xw(d.shape,c,o),p=fs([d.shape[c]]),f=wW({inputs:{x:d},backend:n,attrs:{shape:[-1,p]}});u.push(f);var m=function e(t,r,a,i,o){var s=t.shape[0],c=t.shape[1],l=Uw(c,o),d=new PZ({windowSize:l,inSize:c,batchSize:s,numSegments:o},r),h=n.compileAndRun(d,[t,a],i);if(u.push(h),h.shape[1]===o)return h;var p=sH({backend:n,attrs:{start:0,stop:o,step:1,dtype:"float32"}}),f=SZ({inputs:{x:p},backend:n,attrs:{reps:[c/l]}});return u.push(p),u.push(f),e(h,r,f,i,o)}(f,"unsortedSegmentSum",i,Lh(a.dtype),o),v=wW({inputs:{x:m},backend:n,attrs:{shape:h}}),g=v;if(null!=l){u.push(v);var y=Jv(l);g=RW({inputs:{x:g},backend:n,attrs:{perm:y}})}return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}},OZ=0,zZ=[DW,zW,GW,VW,BW,KW,jW,YW,tV,nV,aV,oV,uV,lV,hV,mV,vV,bV,xV,wV,TV,NV,RV,LV,FV,VV,BV,aW,KV,tU,cU,fU,mU,vU,gU,bU,wU,SU,_U,NU,RU,LU,PU,zU,WU,VU,XU,HU,ZU,jU,YU,JU,$U,tX,rX,oX,cX,pX,mX,yX,xX,SX,_X,IX,CX,RX,AX,DX,nW,OX,qV,FX,WX,UX,sW,BX,ZX,KX,YX,JX,$X,tB,rB,oB,uB,lB,hB,pB,fB,gB,yB,bB,xB,wB,SB,IB,CB,zB,xW,GB,VB,XB,HB,PV,KB,QB,JB,tH,rH,lW,aH,iH,oH,uH,OV,RB,lH,hH,fH,kW,gH,bH,kH,TH,EH,MH,RH,AH,DH,zH,GH,VH,XH,HH,KH,YH,MV,OB,JH,qH,$H,eZ,tZ,nZ,rZ,aZ,sZ,uZ,dZ,hZ,fZ,mZ,vZ,gZ,PB,NW,bZ,wZ,TZ,MZ,RZ,LW,LZ,AZ,DZ,YB];OZ<zZ.length;OZ++){md(zZ[OZ])}var FZ="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2NsYXNzIEd0e2NvbnN0cnVjdG9yKGU9W10sbj1RdCl7aWYodGhpcy5kYXRhPWUsdGhpcy5sZW5ndGg9dGhpcy5kYXRhLmxlbmd0aCx0aGlzLmNvbXBhcmU9bix0aGlzLmxlbmd0aD4wKWZvcihsZXQgdD0odGhpcy5sZW5ndGg+PjEpLTE7dD49MDt0LS0pdGhpcy5fZG93bih0KX1wdXNoKGUpe3RoaXMuZGF0YS5wdXNoKGUpLHRoaXMubGVuZ3RoKyssdGhpcy5fdXAodGhpcy5sZW5ndGgtMSl9cG9wKCl7aWYodGhpcy5sZW5ndGg9PT0wKXJldHVybjtjb25zdCBlPXRoaXMuZGF0YVswXSxuPXRoaXMuZGF0YS5wb3AoKTtyZXR1cm4gdGhpcy5sZW5ndGgtLSx0aGlzLmxlbmd0aD4wJiYodGhpcy5kYXRhWzBdPW4sdGhpcy5fZG93bigwKSksZX1wZWVrKCl7cmV0dXJuIHRoaXMuZGF0YVswXX1fdXAoZSl7Y29uc3R7ZGF0YTpuLGNvbXBhcmU6dH09dGhpcyxzPW5bZV07Zm9yKDtlPjA7KXtjb25zdCByPWUtMT4+MSxpPW5bcl07aWYodChzLGkpPj0wKWJyZWFrO25bZV09aSxlPXJ9bltlXT1zfV9kb3duKGUpe2NvbnN0e2RhdGE6bixjb21wYXJlOnR9PXRoaXMscz10aGlzLmxlbmd0aD4+MSxyPW5bZV07Zm9yKDtlPHM7KXtsZXQgaT0oZTw8MSkrMSxoPW5baV07Y29uc3QgbD1pKzE7aWYobDx0aGlzLmxlbmd0aCYmdChuW2xdLGgpPDAmJihpPWwsaD1uW2xdKSx0KGgscik+PTApYnJlYWs7bltlXT1oLGU9aX1uW2VdPXJ9fWZ1bmN0aW9uIFF0KG8sZSl7cmV0dXJuIG88ZT8tMTpvPmU/MTowfWNvbnN0IHl0PW89Pntjb25zdHt2MTplLHYyOm59PW87bGV0IHQ9MDtmb3IobGV0IHM9MDtzPGUubGVuZ3RoO3MrKyl7bGV0IHI9KGVbc11ebltzXSk+Pj4wO3QrPVd0KHIpfXJldHVybiB0fSxXdD1vPT57dmFyIGU9by0obz4+MSYxNDMxNjU1NzY1KTtyZXR1cm4gZT0oZT4+MiY4NTg5OTM0NTkpKyhlJjg1ODk5MzQ1OSksZT0oZT4+NCkrZSYyNTI2NDUxMzUsZT0oZT4+OCkrZSYxNjcxMTkzNSxlPShlPj4xNikrZSY2NTUzNSxlfSx1dD0xLE50PW89Pntjb25zdHtrZXl3aWR0aDplLGtleWhlaWdodDpuLHF1ZXJ5d2lkdGg6dCxxdWVyeWhlaWdodDpzLG1hdGNoZXM6cn09byxpPXQqMS4yLGg9LWksbD1zKjEuMix1PS1sLGY9MTIsZz0xMCxhPS0xLGo9MSx5PTEvTWF0aC5sb2coMTApLG09TWF0aC5tYXgoZSxuKSxNPU1hdGguZmxvb3IoZS8yKSx6PU1hdGguZmxvb3Iobi8yKSxFPVtdO2ZvcihsZXQgdj0wO3Y8ci5sZW5ndGg7disrKXtjb25zdCBWPXJbdl0ucXVlcnlwb2ludC5zY2FsZSxKPXJbdl0ua2V5cG9pbnQuc2NhbGU7Sj09MCYmY29uc29sZS5sb2coIkVSUk9SIGRpdmlkZSB6ZXJvIik7Y29uc3QgTj1WL0o7RS5wdXNoKE4qbSl9RS5zb3J0KCh2LFYpPT52LVYpO2NvbnN0IFI9LjI1KkVbTWF0aC5mbG9vcihFLmxlbmd0aC8yKS0oRS5sZW5ndGglMj09MD8xOjApLTFdLHE9TWF0aC5tYXgoNSxNYXRoLmNlaWwoKGktaCkvUikpLGI9TWF0aC5tYXgoNSxNYXRoLmNlaWwoKGwtdSkvUikpLEY9cSpiLFg9RipmLGM9W10scD1bXSxTPXt9O2ZvcihsZXQgdj0wO3Y8ci5sZW5ndGg7disrKXtjb25zdCBWPXJbdl0ucXVlcnlwb2ludCxKPXJbdl0ua2V5cG9pbnQse3g6Tix5OkIsc2NhbGU6JCxhbmdsZTpDfT1adCh7cXVlcnlwb2ludDpWLGtleXBvaW50Okosa2V5Y2VudGVyWDpNLGtleWNlbnRlclk6eixzY2FsZU9uZU92ZXJMb2dLOnl9KTtpZihOPGh8fE4+PWl8fEI8dXx8Qj49bHx8Qzw9LU1hdGguUEl8fEM+TWF0aC5QSXx8JDxhfHwkPj1qKXtjW3ZdPSExO2NvbnRpbnVlfWxldCBVPXEqKE4taCkvKGktaCksd3Q9YiooQi11KS8obC11KSxwdD1mKihDK01hdGguUEkpLygyKk1hdGguUEkpLGR0PWcqKCQtYSkvKGotYSk7cFt2XT17YmluWDpVLGJpblk6d3QsYmluQW5nbGU6cHQsYmluU2NhbGU6ZHR9O2xldCBydD1NYXRoLmZsb29yKFUtLjUpLGl0PU1hdGguZmxvb3Iod3QtLjUpLGx0PU1hdGguZmxvb3IoZHQtLjUpLGp0PShNYXRoLmZsb29yKHB0LS41KStmKSVmO2lmKHJ0PDB8fHJ0KzE+PXF8fGl0PDB8fGl0KzE+PWJ8fGx0PDB8fGx0KzE+PWcpe2Nbdl09ITE7Y29udGludWV9Zm9yKGxldCBodD0wO2h0PDI7aHQrKyl7bGV0IGt0PXJ0K2h0O2ZvcihsZXQgYnQ9MDtidDwyO2J0Kyspe2xldCBobj1pdCtidDtmb3IobGV0IEl0PTA7SXQ8MjtJdCsrKXtsZXQgdW49KGp0K0l0KSVmO2ZvcihsZXQgUnQ9MDtSdDwyO1J0Kyspe2xldCBjbj1sdCtSdDtjb25zdCB2dD1rdCtobipxK3VuKkYrY24qWDtTW3Z0XT09PXZvaWQgMCYmKFNbdnRdPTApLFNbdnRdKz0xfX19fWNbdl09ITB9bGV0IGQ9MCxQPS0xO2lmKE9iamVjdC5rZXlzKFMpLmZvckVhY2godj0+e1Nbdl0+ZCYmKGQ9U1t2XSxQPXYpfSksZDwzKXJldHVybltdO2NvbnN0IE89TWF0aC5mbG9vcihQJVglRiVxKSxUPU1hdGguZmxvb3IoKFAtTyklWCVGL3EpLEQ9TWF0aC5mbG9vcigoUC1PLVQqcSklWC9GKSxZPU1hdGguZmxvb3IoKFAtTy1UKnEtRCpGKS9YKSxHPVtdO2ZvcihsZXQgdj0wO3Y8ci5sZW5ndGg7disrKXtpZighY1t2XSljb250aW51ZTtjb25zdCBWPXBbdl07aWYoTWF0aC5hYnMoVi5iaW5YLShPKy41KSk+PXV0fHxNYXRoLmFicyhWLmJpblktKFQrLjUpKT49dXR8fE1hdGguYWJzKFYuYmluU2NhbGUtKFkrLjUpKT49dXQpY29udGludWU7Y29uc3QgJD1NYXRoLmFicyhWLmJpbkFuZ2xlLShEKy41KSk7TWF0aC5taW4oJCxmLSQpPj11dHx8Ry5wdXNoKHJbdl0pfXJldHVybiBHfSxadD0oe3F1ZXJ5cG9pbnQ6byxrZXlwb2ludDplLGtleWNlbnRlclg6bixrZXljZW50ZXJZOnQsc2NhbGVPbmVPdmVyTG9nSzpzfSk9PntsZXQgcj1vLmFuZ2xlLWUuYW5nbGU7cjw9LU1hdGguUEk/cis9MipNYXRoLlBJOnI+TWF0aC5QSSYmKHItPTIqTWF0aC5QSSk7Y29uc3QgaT1vLnNjYWxlL2Uuc2NhbGUsaD1pKk1hdGguY29zKHIpLGw9aSpNYXRoLnNpbihyKSx1PVtoLC1sLGwsaF0sZj1bdVswXSplLngrdVsxXSplLnksdVsyXSplLngrdVszXSplLnldLGc9by54LWZbMF0sYT1vLnktZlsxXTtyZXR1cm57eDp1WzBdKm4rdVsxXSp0K2cseTp1WzJdKm4rdVszXSp0K2EsYW5nbGU6cixzY2FsZTpNYXRoLmxvZyhpKSpzfX0seHQ9T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZztmdW5jdGlvbiBjdChvKXtyZXR1cm4geHQuY2FsbChvKS5lbmRzV2l0aCgiQXJyYXldIil9ZnVuY3Rpb24gQXQobyl7dmFyIGU9YXJndW1lbnRzLmxlbmd0aD4xJiZhcmd1bWVudHNbMV0hPT12b2lkIDA/YXJndW1lbnRzWzFdOnt9O2lmKCFjdChvKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJpbnB1dCBtdXN0IGJlIGFuIGFycmF5Iik7aWYoby5sZW5ndGg9PT0wKXRocm93IG5ldyBUeXBlRXJyb3IoImlucHV0IG11c3Qgbm90IGJlIGVtcHR5Iik7dmFyIG49ZS5mcm9tSW5kZXgsdD1uPT09dm9pZCAwPzA6bixzPWUudG9JbmRleCxyPXM9PT12b2lkIDA/by5sZW5ndGg6cztpZih0PDB8fHQ+PW8ubGVuZ3RofHwhTnVtYmVyLmlzSW50ZWdlcih0KSl0aHJvdyBuZXcgRXJyb3IoImZyb21JbmRleCBtdXN0IGJlIGEgcG9zaXRpdmUgaW50ZWdlciBzbWFsbGVyIHRoYW4gbGVuZ3RoIik7aWYocjw9dHx8cj5vLmxlbmd0aHx8IU51bWJlci5pc0ludGVnZXIocikpdGhyb3cgbmV3IEVycm9yKCJ0b0luZGV4IG11c3QgYmUgYW4gaW50ZWdlciBncmVhdGVyIHRoYW4gZnJvbUluZGV4IGFuZCBhdCBtb3N0IGVxdWFsIHRvIGxlbmd0aCIpO2Zvcih2YXIgaT1vW3RdLGg9dCsxO2g8cjtoKyspb1toXT5pJiYoaT1vW2hdKTtyZXR1cm4gaX1mdW5jdGlvbiB0ZShvKXt2YXIgZT1hcmd1bWVudHMubGVuZ3RoPjEmJmFyZ3VtZW50c1sxXSE9PXZvaWQgMD9hcmd1bWVudHNbMV06e307aWYoIWN0KG8pKXRocm93IG5ldyBUeXBlRXJyb3IoImlucHV0IG11c3QgYmUgYW4gYXJyYXkiKTtpZihvLmxlbmd0aD09PTApdGhyb3cgbmV3IFR5cGVFcnJvcigiaW5wdXQgbXVzdCBub3QgYmUgZW1wdHkiKTt2YXIgbj1lLmZyb21JbmRleCx0PW49PT12b2lkIDA/MDpuLHM9ZS50b0luZGV4LHI9cz09PXZvaWQgMD9vLmxlbmd0aDpzO2lmKHQ8MHx8dD49by5sZW5ndGh8fCFOdW1iZXIuaXNJbnRlZ2VyKHQpKXRocm93IG5ldyBFcnJvcigiZnJvbUluZGV4IG11c3QgYmUgYSBwb3NpdGl2ZSBpbnRlZ2VyIHNtYWxsZXIgdGhhbiBsZW5ndGgiKTtpZihyPD10fHxyPm8ubGVuZ3RofHwhTnVtYmVyLmlzSW50ZWdlcihyKSl0aHJvdyBuZXcgRXJyb3IoInRvSW5kZXggbXVzdCBiZSBhbiBpbnRlZ2VyIGdyZWF0ZXIgdGhhbiBmcm9tSW5kZXggYW5kIGF0IG1vc3QgZXF1YWwgdG8gbGVuZ3RoIik7Zm9yKHZhciBpPW9bdF0saD10KzE7aDxyO2grKylvW2hdPGkmJihpPW9baF0pO3JldHVybiBpfWZ1bmN0aW9uIHF0KG8pe3ZhciBlPWFyZ3VtZW50cy5sZW5ndGg+MSYmYXJndW1lbnRzWzFdIT09dm9pZCAwP2FyZ3VtZW50c1sxXTp7fTtpZihjdChvKSl7aWYoby5sZW5ndGg9PT0wKXRocm93IG5ldyBUeXBlRXJyb3IoImlucHV0IG11c3Qgbm90IGJlIGVtcHR5Iil9ZWxzZSB0aHJvdyBuZXcgVHlwZUVycm9yKCJpbnB1dCBtdXN0IGJlIGFuIGFycmF5Iik7dmFyIG47aWYoZS5vdXRwdXQhPT12b2lkIDApe2lmKCFjdChlLm91dHB1dCkpdGhyb3cgbmV3IFR5cGVFcnJvcigib3V0cHV0IG9wdGlvbiBtdXN0IGJlIGFuIGFycmF5IGlmIHNwZWNpZmllZCIpO249ZS5vdXRwdXR9ZWxzZSBuPW5ldyBBcnJheShvLmxlbmd0aCk7dmFyIHQ9dGUobykscz1BdChvKTtpZih0PT09cyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigibWluaW11bSBhbmQgbWF4aW11bSBpbnB1dCB2YWx1ZXMgYXJlIGVxdWFsLiBDYW5ub3QgcmVzY2FsZSBhIGNvbnN0YW50IGFycmF5Iik7dmFyIHI9ZS5taW4saT1yPT09dm9pZCAwP2UuYXV0b01pbk1heD90OjA6cixoPWUubWF4LGw9aD09PXZvaWQgMD9lLmF1dG9NaW5NYXg/czoxOmg7aWYoaT49bCl0aHJvdyBuZXcgUmFuZ2VFcnJvcigibWluIG9wdGlvbiBtdXN0IGJlIHNtYWxsZXIgdGhhbiBtYXggb3B0aW9uIik7Zm9yKHZhciB1PShsLWkpLyhzLXQpLGY9MDtmPG8ubGVuZ3RoO2YrKyluW2ZdPShvW2ZdLXQpKnUraTtyZXR1cm4gbn1jb25zdCBmdD0iICIucmVwZWF0KDIpLF90PSIgIi5yZXBlYXQoNCk7ZnVuY3Rpb24gZWUoKXtyZXR1cm4genQodGhpcyl9ZnVuY3Rpb24genQobyxlPXt9KXtjb25zdHttYXhSb3dzOm49MTUsbWF4Q29sdW1uczp0PTEwLG1heE51bVNpemU6cz04fT1lO3JldHVybmAke28uY29uc3RydWN0b3IubmFtZX0gewoke2Z0fVsKJHtfdH0ke25lKG8sbix0LHMpfQoke2Z0fV0KJHtmdH1yb3dzOiAke28ucm93c30KJHtmdH1jb2x1bW5zOiAke28uY29sdW1uc30KfWB9ZnVuY3Rpb24gbmUobyxlLG4sdCl7Y29uc3R7cm93czpzLGNvbHVtbnM6cn09byxpPU1hdGgubWluKHMsZSksaD1NYXRoLm1pbihyLG4pLGw9W107Zm9yKGxldCB1PTA7dTxpO3UrKyl7bGV0IGY9W107Zm9yKGxldCBnPTA7ZzxoO2crKylmLnB1c2goc2Uoby5nZXQodSxnKSx0KSk7bC5wdXNoKGAke2Yuam9pbigiICIpfWApfXJldHVybiBoIT09ciYmKGxbbC5sZW5ndGgtMV0rPWAgLi4uICR7ci1ufSBtb3JlIGNvbHVtbnNgKSxpIT09cyYmbC5wdXNoKGAuLi4gJHtzLWV9IG1vcmUgcm93c2ApLGwuam9pbihgCiR7X3R9YCl9ZnVuY3Rpb24gc2UobyxlKXtjb25zdCBuPVN0cmluZyhvKTtpZihuLmxlbmd0aDw9ZSlyZXR1cm4gbi5wYWRFbmQoZSwiICIpO2NvbnN0IHQ9by50b1ByZWNpc2lvbihlLTIpO2lmKHQubGVuZ3RoPD1lKXJldHVybiB0O2NvbnN0IHM9by50b0V4cG9uZW50aWFsKGUtMikscj1zLmluZGV4T2YoImUiKSxpPXMuc2xpY2Uocik7cmV0dXJuIHMuc2xpY2UoMCxlLWkubGVuZ3RoKStpfWZ1bmN0aW9uIG9lKG8sZSl7by5wcm90b3R5cGUuYWRkPWZ1bmN0aW9uKHQpe3JldHVybiB0eXBlb2YgdD09Im51bWJlciI/dGhpcy5hZGRTKHQpOnRoaXMuYWRkTSh0KX0sby5wcm90b3R5cGUuYWRkUz1mdW5jdGlvbih0KXtmb3IobGV0IHM9MDtzPHRoaXMucm93cztzKyspZm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXRoaXMuc2V0KHMscix0aGlzLmdldChzLHIpK3QpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5hZGRNPWZ1bmN0aW9uKHQpe2lmKHQ9ZS5jaGVja01hdHJpeCh0KSx0aGlzLnJvd3MhPT10LnJvd3N8fHRoaXMuY29sdW1ucyE9PXQuY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiTWF0cmljZXMgZGltZW5zaW9ucyBtdXN0IGJlIGVxdWFsIik7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKSt0LmdldChzLHIpKTtyZXR1cm4gdGhpc30sby5hZGQ9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IGUodCkuYWRkKHMpfSxvLnByb3RvdHlwZS5zdWI9ZnVuY3Rpb24odCl7cmV0dXJuIHR5cGVvZiB0PT0ibnVtYmVyIj90aGlzLnN1YlModCk6dGhpcy5zdWJNKHQpfSxvLnByb3RvdHlwZS5zdWJTPWZ1bmN0aW9uKHQpe2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMsciktdCk7cmV0dXJuIHRoaXN9LG8ucHJvdG90eXBlLnN1Yk09ZnVuY3Rpb24odCl7aWYodD1lLmNoZWNrTWF0cml4KHQpLHRoaXMucm93cyE9PXQucm93c3x8dGhpcy5jb2x1bW5zIT09dC5jb2x1bW5zKXRocm93IG5ldyBSYW5nZUVycm9yKCJNYXRyaWNlcyBkaW1lbnNpb25zIG11c3QgYmUgZXF1YWwiKTtmb3IobGV0IHM9MDtzPHRoaXMucm93cztzKyspZm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXRoaXMuc2V0KHMscix0aGlzLmdldChzLHIpLXQuZ2V0KHMscikpO3JldHVybiB0aGlzfSxvLnN1Yj1mdW5jdGlvbih0LHMpe3JldHVybiBuZXcgZSh0KS5zdWIocyl9LG8ucHJvdG90eXBlLnN1YnRyYWN0PW8ucHJvdG90eXBlLnN1YixvLnByb3RvdHlwZS5zdWJ0cmFjdFM9by5wcm90b3R5cGUuc3ViUyxvLnByb3RvdHlwZS5zdWJ0cmFjdE09by5wcm90b3R5cGUuc3ViTSxvLnN1YnRyYWN0PW8uc3ViLG8ucHJvdG90eXBlLm11bD1mdW5jdGlvbih0KXtyZXR1cm4gdHlwZW9mIHQ9PSJudW1iZXIiP3RoaXMubXVsUyh0KTp0aGlzLm11bE0odCl9LG8ucHJvdG90eXBlLm11bFM9ZnVuY3Rpb24odCl7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKSp0KTtyZXR1cm4gdGhpc30sby5wcm90b3R5cGUubXVsTT1mdW5jdGlvbih0KXtpZih0PWUuY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscikqdC5nZXQocyxyKSk7cmV0dXJuIHRoaXN9LG8ubXVsPWZ1bmN0aW9uKHQscyl7cmV0dXJuIG5ldyBlKHQpLm11bChzKX0sby5wcm90b3R5cGUubXVsdGlwbHk9by5wcm90b3R5cGUubXVsLG8ucHJvdG90eXBlLm11bHRpcGx5Uz1vLnByb3RvdHlwZS5tdWxTLG8ucHJvdG90eXBlLm11bHRpcGx5TT1vLnByb3RvdHlwZS5tdWxNLG8ubXVsdGlwbHk9by5tdWwsby5wcm90b3R5cGUuZGl2PWZ1bmN0aW9uKHQpe3JldHVybiB0eXBlb2YgdD09Im51bWJlciI/dGhpcy5kaXZTKHQpOnRoaXMuZGl2TSh0KX0sby5wcm90b3R5cGUuZGl2Uz1mdW5jdGlvbih0KXtmb3IobGV0IHM9MDtzPHRoaXMucm93cztzKyspZm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXRoaXMuc2V0KHMscix0aGlzLmdldChzLHIpL3QpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5kaXZNPWZ1bmN0aW9uKHQpe2lmKHQ9ZS5jaGVja01hdHJpeCh0KSx0aGlzLnJvd3MhPT10LnJvd3N8fHRoaXMuY29sdW1ucyE9PXQuY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiTWF0cmljZXMgZGltZW5zaW9ucyBtdXN0IGJlIGVxdWFsIik7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKS90LmdldChzLHIpKTtyZXR1cm4gdGhpc30sby5kaXY9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IGUodCkuZGl2KHMpfSxvLnByb3RvdHlwZS5kaXZpZGU9by5wcm90b3R5cGUuZGl2LG8ucHJvdG90eXBlLmRpdmlkZVM9by5wcm90b3R5cGUuZGl2UyxvLnByb3RvdHlwZS5kaXZpZGVNPW8ucHJvdG90eXBlLmRpdk0sby5kaXZpZGU9by5kaXYsby5wcm90b3R5cGUubW9kPWZ1bmN0aW9uKHQpe3JldHVybiB0eXBlb2YgdD09Im51bWJlciI/dGhpcy5tb2RTKHQpOnRoaXMubW9kTSh0KX0sby5wcm90b3R5cGUubW9kUz1mdW5jdGlvbih0KXtmb3IobGV0IHM9MDtzPHRoaXMucm93cztzKyspZm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXRoaXMuc2V0KHMscix0aGlzLmdldChzLHIpJXQpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5tb2RNPWZ1bmN0aW9uKHQpe2lmKHQ9ZS5jaGVja01hdHJpeCh0KSx0aGlzLnJvd3MhPT10LnJvd3N8fHRoaXMuY29sdW1ucyE9PXQuY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiTWF0cmljZXMgZGltZW5zaW9ucyBtdXN0IGJlIGVxdWFsIik7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKSV0LmdldChzLHIpKTtyZXR1cm4gdGhpc30sby5tb2Q9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IGUodCkubW9kKHMpfSxvLnByb3RvdHlwZS5tb2R1bHVzPW8ucHJvdG90eXBlLm1vZCxvLnByb3RvdHlwZS5tb2R1bHVzUz1vLnByb3RvdHlwZS5tb2RTLG8ucHJvdG90eXBlLm1vZHVsdXNNPW8ucHJvdG90eXBlLm1vZE0sby5tb2R1bHVzPW8ubW9kLG8ucHJvdG90eXBlLmFuZD1mdW5jdGlvbih0KXtyZXR1cm4gdHlwZW9mIHQ9PSJudW1iZXIiP3RoaXMuYW5kUyh0KTp0aGlzLmFuZE0odCl9LG8ucHJvdG90eXBlLmFuZFM9ZnVuY3Rpb24odCl7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKSZ0KTtyZXR1cm4gdGhpc30sby5wcm90b3R5cGUuYW5kTT1mdW5jdGlvbih0KXtpZih0PWUuY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscikmdC5nZXQocyxyKSk7cmV0dXJuIHRoaXN9LG8uYW5kPWZ1bmN0aW9uKHQscyl7cmV0dXJuIG5ldyBlKHQpLmFuZChzKX0sby5wcm90b3R5cGUub3I9ZnVuY3Rpb24odCl7cmV0dXJuIHR5cGVvZiB0PT0ibnVtYmVyIj90aGlzLm9yUyh0KTp0aGlzLm9yTSh0KX0sby5wcm90b3R5cGUub3JTPWZ1bmN0aW9uKHQpe2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscil8dCk7cmV0dXJuIHRoaXN9LG8ucHJvdG90eXBlLm9yTT1mdW5jdGlvbih0KXtpZih0PWUuY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscil8dC5nZXQocyxyKSk7cmV0dXJuIHRoaXN9LG8ub3I9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IGUodCkub3Iocyl9LG8ucHJvdG90eXBlLnhvcj1mdW5jdGlvbih0KXtyZXR1cm4gdHlwZW9mIHQ9PSJudW1iZXIiP3RoaXMueG9yUyh0KTp0aGlzLnhvck0odCl9LG8ucHJvdG90eXBlLnhvclM9ZnVuY3Rpb24odCl7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKV50KTtyZXR1cm4gdGhpc30sby5wcm90b3R5cGUueG9yTT1mdW5jdGlvbih0KXtpZih0PWUuY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMsciledC5nZXQocyxyKSk7cmV0dXJuIHRoaXN9LG8ueG9yPWZ1bmN0aW9uKHQscyl7cmV0dXJuIG5ldyBlKHQpLnhvcihzKX0sby5wcm90b3R5cGUubGVmdFNoaWZ0PWZ1bmN0aW9uKHQpe3JldHVybiB0eXBlb2YgdD09Im51bWJlciI/dGhpcy5sZWZ0U2hpZnRTKHQpOnRoaXMubGVmdFNoaWZ0TSh0KX0sby5wcm90b3R5cGUubGVmdFNoaWZ0Uz1mdW5jdGlvbih0KXtmb3IobGV0IHM9MDtzPHRoaXMucm93cztzKyspZm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXRoaXMuc2V0KHMscix0aGlzLmdldChzLHIpPDx0KTtyZXR1cm4gdGhpc30sby5wcm90b3R5cGUubGVmdFNoaWZ0TT1mdW5jdGlvbih0KXtpZih0PWUuY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscik8PHQuZ2V0KHMscikpO3JldHVybiB0aGlzfSxvLmxlZnRTaGlmdD1mdW5jdGlvbih0LHMpe3JldHVybiBuZXcgZSh0KS5sZWZ0U2hpZnQocyl9LG8ucHJvdG90eXBlLnNpZ25Qcm9wYWdhdGluZ1JpZ2h0U2hpZnQ9ZnVuY3Rpb24odCl7cmV0dXJuIHR5cGVvZiB0PT0ibnVtYmVyIj90aGlzLnNpZ25Qcm9wYWdhdGluZ1JpZ2h0U2hpZnRTKHQpOnRoaXMuc2lnblByb3BhZ2F0aW5nUmlnaHRTaGlmdE0odCl9LG8ucHJvdG90eXBlLnNpZ25Qcm9wYWdhdGluZ1JpZ2h0U2hpZnRTPWZ1bmN0aW9uKHQpe2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscik+PnQpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5zaWduUHJvcGFnYXRpbmdSaWdodFNoaWZ0TT1mdW5jdGlvbih0KXtpZih0PWUuY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscik+PnQuZ2V0KHMscikpO3JldHVybiB0aGlzfSxvLnNpZ25Qcm9wYWdhdGluZ1JpZ2h0U2hpZnQ9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IGUodCkuc2lnblByb3BhZ2F0aW5nUmlnaHRTaGlmdChzKX0sby5wcm90b3R5cGUucmlnaHRTaGlmdD1mdW5jdGlvbih0KXtyZXR1cm4gdHlwZW9mIHQ9PSJudW1iZXIiP3RoaXMucmlnaHRTaGlmdFModCk6dGhpcy5yaWdodFNoaWZ0TSh0KX0sby5wcm90b3R5cGUucmlnaHRTaGlmdFM9ZnVuY3Rpb24odCl7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKT4+PnQpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5yaWdodFNoaWZ0TT1mdW5jdGlvbih0KXtpZih0PWUuY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscik+Pj50LmdldChzLHIpKTtyZXR1cm4gdGhpc30sby5yaWdodFNoaWZ0PWZ1bmN0aW9uKHQscyl7cmV0dXJuIG5ldyBlKHQpLnJpZ2h0U2hpZnQocyl9LG8ucHJvdG90eXBlLnplcm9GaWxsUmlnaHRTaGlmdD1vLnByb3RvdHlwZS5yaWdodFNoaWZ0LG8ucHJvdG90eXBlLnplcm9GaWxsUmlnaHRTaGlmdFM9by5wcm90b3R5cGUucmlnaHRTaGlmdFMsby5wcm90b3R5cGUuemVyb0ZpbGxSaWdodFNoaWZ0TT1vLnByb3RvdHlwZS5yaWdodFNoaWZ0TSxvLnplcm9GaWxsUmlnaHRTaGlmdD1vLnJpZ2h0U2hpZnQsby5wcm90b3R5cGUubm90PWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsfnRoaXMuZ2V0KHQscykpO3JldHVybiB0aGlzfSxvLm5vdD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IGUodCkubm90KCl9LG8ucHJvdG90eXBlLmFicz1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGguYWJzKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5hYnM9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBlKHQpLmFicygpfSxvLnByb3RvdHlwZS5hY29zPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5hY29zKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5hY29zPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgZSh0KS5hY29zKCl9LG8ucHJvdG90eXBlLmFjb3NoPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5hY29zaCh0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8uYWNvc2g9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBlKHQpLmFjb3NoKCl9LG8ucHJvdG90eXBlLmFzaW49ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmFzaW4odGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmFzaW49ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBlKHQpLmFzaW4oKX0sby5wcm90b3R5cGUuYXNpbmg9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmFzaW5oKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5hc2luaD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IGUodCkuYXNpbmgoKX0sby5wcm90b3R5cGUuYXRhbj1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGguYXRhbih0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8uYXRhbj1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IGUodCkuYXRhbigpfSxvLnByb3RvdHlwZS5hdGFuaD1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGguYXRhbmgodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmF0YW5oPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgZSh0KS5hdGFuaCgpfSxvLnByb3RvdHlwZS5jYnJ0PWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5jYnJ0KHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5jYnJ0PWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgZSh0KS5jYnJ0KCl9LG8ucHJvdG90eXBlLmNlaWw9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmNlaWwodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmNlaWw9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBlKHQpLmNlaWwoKX0sby5wcm90b3R5cGUuY2x6MzI9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmNsejMyKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5jbHozMj1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IGUodCkuY2x6MzIoKX0sby5wcm90b3R5cGUuY29zPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5jb3ModGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmNvcz1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IGUodCkuY29zKCl9LG8ucHJvdG90eXBlLmNvc2g9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmNvc2godGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmNvc2g9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBlKHQpLmNvc2goKX0sby5wcm90b3R5cGUuZXhwPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5leHAodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmV4cD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IGUodCkuZXhwKCl9LG8ucHJvdG90eXBlLmV4cG0xPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5leHBtMSh0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8uZXhwbTE9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBlKHQpLmV4cG0xKCl9LG8ucHJvdG90eXBlLmZsb29yPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5mbG9vcih0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8uZmxvb3I9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBlKHQpLmZsb29yKCl9LG8ucHJvdG90eXBlLmZyb3VuZD1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGguZnJvdW5kKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5mcm91bmQ9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBlKHQpLmZyb3VuZCgpfSxvLnByb3RvdHlwZS5sb2c9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmxvZyh0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8ubG9nPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgZSh0KS5sb2coKX0sby5wcm90b3R5cGUubG9nMXA9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmxvZzFwKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5sb2cxcD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IGUodCkubG9nMXAoKX0sby5wcm90b3R5cGUubG9nMTA9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmxvZzEwKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5sb2cxMD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IGUodCkubG9nMTAoKX0sby5wcm90b3R5cGUubG9nMj1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGgubG9nMih0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8ubG9nMj1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IGUodCkubG9nMigpfSxvLnByb3RvdHlwZS5yb3VuZD1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGgucm91bmQodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLnJvdW5kPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgZSh0KS5yb3VuZCgpfSxvLnByb3RvdHlwZS5zaWduPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5zaWduKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5zaWduPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgZSh0KS5zaWduKCl9LG8ucHJvdG90eXBlLnNpbj1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGguc2luKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5zaW49ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBlKHQpLnNpbigpfSxvLnByb3RvdHlwZS5zaW5oPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5zaW5oKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5zaW5oPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgZSh0KS5zaW5oKCl9LG8ucHJvdG90eXBlLnNxcnQ9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLnNxcnQodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLnNxcnQ9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBlKHQpLnNxcnQoKX0sby5wcm90b3R5cGUudGFuPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC50YW4odGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLnRhbj1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IGUodCkudGFuKCl9LG8ucHJvdG90eXBlLnRhbmg9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLnRhbmgodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLnRhbmg9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBlKHQpLnRhbmgoKX0sby5wcm90b3R5cGUudHJ1bmM9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLnRydW5jKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby50cnVuYz1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IGUodCkudHJ1bmMoKX0sby5wb3c9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IGUodCkucG93KHMpfSxvLnByb3RvdHlwZS5wb3c9ZnVuY3Rpb24odCl7cmV0dXJuIHR5cGVvZiB0PT0ibnVtYmVyIj90aGlzLnBvd1ModCk6dGhpcy5wb3dNKHQpfSxvLnByb3RvdHlwZS5wb3dTPWZ1bmN0aW9uKHQpe2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLE1hdGgucG93KHRoaXMuZ2V0KHMsciksdCkpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5wb3dNPWZ1bmN0aW9uKHQpe2lmKHQ9ZS5jaGVja01hdHJpeCh0KSx0aGlzLnJvd3MhPT10LnJvd3N8fHRoaXMuY29sdW1ucyE9PXQuY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiTWF0cmljZXMgZGltZW5zaW9ucyBtdXN0IGJlIGVxdWFsIik7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsTWF0aC5wb3codGhpcy5nZXQocyxyKSx0LmdldChzLHIpKSk7cmV0dXJuIHRoaXN9fWZ1bmN0aW9uIFEobyxlLG4pe2xldCB0PW4/by5yb3dzOm8ucm93cy0xO2lmKGU8MHx8ZT50KXRocm93IG5ldyBSYW5nZUVycm9yKCJSb3cgaW5kZXggb3V0IG9mIHJhbmdlIil9ZnVuY3Rpb24gVyhvLGUsbil7bGV0IHQ9bj9vLmNvbHVtbnM6by5jb2x1bW5zLTE7aWYoZTwwfHxlPnQpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkNvbHVtbiBpbmRleCBvdXQgb2YgcmFuZ2UiKX1mdW5jdGlvbiBBKG8sZSl7aWYoZS50bzFEQXJyYXkmJihlPWUudG8xREFycmF5KCkpLGUubGVuZ3RoIT09by5jb2x1bW5zKXRocm93IG5ldyBSYW5nZUVycm9yKCJ2ZWN0b3Igc2l6ZSBtdXN0IGJlIHRoZSBzYW1lIGFzIHRoZSBudW1iZXIgb2YgY29sdW1ucyIpO3JldHVybiBlfWZ1bmN0aW9uIHR0KG8sZSl7aWYoZS50bzFEQXJyYXkmJihlPWUudG8xREFycmF5KCkpLGUubGVuZ3RoIT09by5yb3dzKXRocm93IG5ldyBSYW5nZUVycm9yKCJ2ZWN0b3Igc2l6ZSBtdXN0IGJlIHRoZSBzYW1lIGFzIHRoZSBudW1iZXIgb2Ygcm93cyIpO3JldHVybiBlfWZ1bmN0aW9uIHJlKG8sZSxuKXtyZXR1cm57cm93OmllKG8sZSksY29sdW1uOmxlKG8sbil9fWZ1bmN0aW9uIGllKG8sZSl7aWYodHlwZW9mIGUhPSJvYmplY3QiKXRocm93IG5ldyBUeXBlRXJyb3IoInVuZXhwZWN0ZWQgdHlwZSBmb3Igcm93IGluZGljZXMiKTtpZihlLnNvbWUodD0+dDwwfHx0Pj1vLnJvd3MpKXRocm93IG5ldyBSYW5nZUVycm9yKCJyb3cgaW5kaWNlcyBhcmUgb3V0IG9mIHJhbmdlIik7cmV0dXJuIEFycmF5LmlzQXJyYXkoZSl8fChlPUFycmF5LmZyb20oZSkpLGV9ZnVuY3Rpb24gbGUobyxlKXtpZih0eXBlb2YgZSE9Im9iamVjdCIpdGhyb3cgbmV3IFR5cGVFcnJvcigidW5leHBlY3RlZCB0eXBlIGZvciBjb2x1bW4gaW5kaWNlcyIpO2lmKGUuc29tZSh0PT50PDB8fHQ+PW8uY29sdW1ucykpdGhyb3cgbmV3IFJhbmdlRXJyb3IoImNvbHVtbiBpbmRpY2VzIGFyZSBvdXQgb2YgcmFuZ2UiKTtyZXR1cm4gQXJyYXkuaXNBcnJheShlKXx8KGU9QXJyYXkuZnJvbShlKSksZX1mdW5jdGlvbiBGdChvLGUsbix0LHMpe2lmKGFyZ3VtZW50cy5sZW5ndGghPT01KXRocm93IG5ldyBSYW5nZUVycm9yKCJleHBlY3RlZCA0IGFyZ3VtZW50cyIpO2lmKGF0KCJzdGFydFJvdyIsZSksYXQoImVuZFJvdyIsbiksYXQoInN0YXJ0Q29sdW1uIix0KSxhdCgiZW5kQ29sdW1uIixzKSxlPm58fHQ+c3x8ZTwwfHxlPj1vLnJvd3N8fG48MHx8bj49by5yb3dzfHx0PDB8fHQ+PW8uY29sdW1uc3x8czwwfHxzPj1vLmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIlN1Ym1hdHJpeCBpbmRpY2VzIGFyZSBvdXQgb2YgcmFuZ2UiKX1mdW5jdGlvbiBndChvLGU9MCl7bGV0IG49W107Zm9yKGxldCB0PTA7dDxvO3QrKyluLnB1c2goZSk7cmV0dXJuIG59ZnVuY3Rpb24gYXQobyxlKXtpZih0eXBlb2YgZSE9Im51bWJlciIpdGhyb3cgbmV3IFR5cGVFcnJvcihgJHtvfSBtdXN0IGJlIGEgbnVtYmVyYCl9ZnVuY3Rpb24gZXQobyl7aWYoby5pc0VtcHR5KCkpdGhyb3cgbmV3IEVycm9yKCJFbXB0eSBtYXRyaXggaGFzIG5vIGVsZW1lbnRzIHRvIGluZGV4Iil9ZnVuY3Rpb24gaGUobyl7bGV0IGU9Z3Qoby5yb3dzKTtmb3IobGV0IG49MDtuPG8ucm93czsrK24pZm9yKGxldCB0PTA7dDxvLmNvbHVtbnM7Kyt0KWVbbl0rPW8uZ2V0KG4sdCk7cmV0dXJuIGV9ZnVuY3Rpb24gdWUobyl7bGV0IGU9Z3Qoby5jb2x1bW5zKTtmb3IobGV0IG49MDtuPG8ucm93czsrK24pZm9yKGxldCB0PTA7dDxvLmNvbHVtbnM7Kyt0KWVbdF0rPW8uZ2V0KG4sdCk7cmV0dXJuIGV9ZnVuY3Rpb24gY2Uobyl7bGV0IGU9MDtmb3IobGV0IG49MDtuPG8ucm93cztuKyspZm9yKGxldCB0PTA7dDxvLmNvbHVtbnM7dCsrKWUrPW8uZ2V0KG4sdCk7cmV0dXJuIGV9ZnVuY3Rpb24gZmUobyl7bGV0IGU9Z3Qoby5yb3dzLDEpO2ZvcihsZXQgbj0wO248by5yb3dzOysrbilmb3IobGV0IHQ9MDt0PG8uY29sdW1uczsrK3QpZVtuXSo9by5nZXQobix0KTtyZXR1cm4gZX1mdW5jdGlvbiBnZShvKXtsZXQgZT1ndChvLmNvbHVtbnMsMSk7Zm9yKGxldCBuPTA7bjxvLnJvd3M7KytuKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zOysrdCllW3RdKj1vLmdldChuLHQpO3JldHVybiBlfWZ1bmN0aW9uIGFlKG8pe2xldCBlPTE7Zm9yKGxldCBuPTA7bjxvLnJvd3M7bisrKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zO3QrKyllKj1vLmdldChuLHQpO3JldHVybiBlfWZ1bmN0aW9uIG1lKG8sZSxuKXtjb25zdCB0PW8ucm93cyxzPW8uY29sdW1ucyxyPVtdO2ZvcihsZXQgaT0wO2k8dDtpKyspe2xldCBoPTAsbD0wLHU9MDtmb3IobGV0IGY9MDtmPHM7ZisrKXU9by5nZXQoaSxmKS1uW2ldLGgrPXUsbCs9dSp1O2U/ci5wdXNoKChsLWgqaC9zKS8ocy0xKSk6ci5wdXNoKChsLWgqaC9zKS9zKX1yZXR1cm4gcn1mdW5jdGlvbiB3ZShvLGUsbil7Y29uc3QgdD1vLnJvd3Mscz1vLmNvbHVtbnMscj1bXTtmb3IobGV0IGk9MDtpPHM7aSsrKXtsZXQgaD0wLGw9MCx1PTA7Zm9yKGxldCBmPTA7Zjx0O2YrKyl1PW8uZ2V0KGYsaSktbltpXSxoKz11LGwrPXUqdTtlP3IucHVzaCgobC1oKmgvdCkvKHQtMSkpOnIucHVzaCgobC1oKmgvdCkvdCl9cmV0dXJuIHJ9ZnVuY3Rpb24gcGUobyxlLG4pe2NvbnN0IHQ9by5yb3dzLHM9by5jb2x1bW5zLHI9dCpzO2xldCBpPTAsaD0wLGw9MDtmb3IobGV0IHU9MDt1PHQ7dSsrKWZvcihsZXQgZj0wO2Y8cztmKyspbD1vLmdldCh1LGYpLW4saSs9bCxoKz1sKmw7cmV0dXJuIGU/KGgtaSppL3IpLyhyLTEpOihoLWkqaS9yKS9yfWZ1bmN0aW9uIGRlKG8sZSl7Zm9yKGxldCBuPTA7bjxvLnJvd3M7bisrKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zO3QrKylvLnNldChuLHQsby5nZXQobix0KS1lW25dKX1mdW5jdGlvbiB5ZShvLGUpe2ZvcihsZXQgbj0wO248by5yb3dzO24rKylmb3IobGV0IHQ9MDt0PG8uY29sdW1uczt0Kyspby5zZXQobix0LG8uZ2V0KG4sdCktZVt0XSl9ZnVuY3Rpb24gTWUobyxlKXtmb3IobGV0IG49MDtuPG8ucm93cztuKyspZm9yKGxldCB0PTA7dDxvLmNvbHVtbnM7dCsrKW8uc2V0KG4sdCxvLmdldChuLHQpLWUpfWZ1bmN0aW9uIEVlKG8pe2NvbnN0IGU9W107Zm9yKGxldCBuPTA7bjxvLnJvd3M7bisrKXtsZXQgdD0wO2ZvcihsZXQgcz0wO3M8by5jb2x1bW5zO3MrKyl0Kz1NYXRoLnBvdyhvLmdldChuLHMpLDIpLyhvLmNvbHVtbnMtMSk7ZS5wdXNoKE1hdGguc3FydCh0KSl9cmV0dXJuIGV9ZnVuY3Rpb24gU2UobyxlKXtmb3IobGV0IG49MDtuPG8ucm93cztuKyspZm9yKGxldCB0PTA7dDxvLmNvbHVtbnM7dCsrKW8uc2V0KG4sdCxvLmdldChuLHQpL2Vbbl0pfWZ1bmN0aW9uIGplKG8pe2NvbnN0IGU9W107Zm9yKGxldCBuPTA7bjxvLmNvbHVtbnM7bisrKXtsZXQgdD0wO2ZvcihsZXQgcz0wO3M8by5yb3dzO3MrKyl0Kz1NYXRoLnBvdyhvLmdldChzLG4pLDIpLyhvLnJvd3MtMSk7ZS5wdXNoKE1hdGguc3FydCh0KSl9cmV0dXJuIGV9ZnVuY3Rpb24ga2UobyxlKXtmb3IobGV0IG49MDtuPG8ucm93cztuKyspZm9yKGxldCB0PTA7dDxvLmNvbHVtbnM7dCsrKW8uc2V0KG4sdCxvLmdldChuLHQpL2VbdF0pfWZ1bmN0aW9uIGJlKG8pe2NvbnN0IGU9by5zaXplLTE7bGV0IG49MDtmb3IobGV0IHQ9MDt0PG8uY29sdW1uczt0KyspZm9yKGxldCBzPTA7czxvLnJvd3M7cysrKW4rPU1hdGgucG93KG8uZ2V0KHMsdCksMikvZTtyZXR1cm4gTWF0aC5zcXJ0KG4pfWZ1bmN0aW9uIEllKG8sZSl7Zm9yKGxldCBuPTA7bjxvLnJvd3M7bisrKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zO3QrKylvLnNldChuLHQsby5nZXQobix0KS9lKX1jbGFzcyBfe3N0YXRpYyBmcm9tMURBcnJheShlLG4sdCl7aWYoZSpuIT09dC5sZW5ndGgpdGhyb3cgbmV3IFJhbmdlRXJyb3IoImRhdGEgbGVuZ3RoIGRvZXMgbm90IG1hdGNoIGdpdmVuIGRpbWVuc2lvbnMiKTtsZXQgcj1uZXcgSShlLG4pO2ZvcihsZXQgaT0wO2k8ZTtpKyspZm9yKGxldCBoPTA7aDxuO2grKylyLnNldChpLGgsdFtpKm4raF0pO3JldHVybiByfXN0YXRpYyByb3dWZWN0b3IoZSl7bGV0IG49bmV3IEkoMSxlLmxlbmd0aCk7Zm9yKGxldCB0PTA7dDxlLmxlbmd0aDt0Kyspbi5zZXQoMCx0LGVbdF0pO3JldHVybiBufXN0YXRpYyBjb2x1bW5WZWN0b3IoZSl7bGV0IG49bmV3IEkoZS5sZW5ndGgsMSk7Zm9yKGxldCB0PTA7dDxlLmxlbmd0aDt0Kyspbi5zZXQodCwwLGVbdF0pO3JldHVybiBufXN0YXRpYyB6ZXJvcyhlLG4pe3JldHVybiBuZXcgSShlLG4pfXN0YXRpYyBvbmVzKGUsbil7cmV0dXJuIG5ldyBJKGUsbikuZmlsbCgxKX1zdGF0aWMgcmFuZChlLG4sdD17fSl7aWYodHlwZW9mIHQhPSJvYmplY3QiKXRocm93IG5ldyBUeXBlRXJyb3IoIm9wdGlvbnMgbXVzdCBiZSBhbiBvYmplY3QiKTtjb25zdHtyYW5kb206cz1NYXRoLnJhbmRvbX09dDtsZXQgcj1uZXcgSShlLG4pO2ZvcihsZXQgaT0wO2k8ZTtpKyspZm9yKGxldCBoPTA7aDxuO2grKylyLnNldChpLGgscygpKTtyZXR1cm4gcn1zdGF0aWMgcmFuZEludChlLG4sdD17fSl7aWYodHlwZW9mIHQhPSJvYmplY3QiKXRocm93IG5ldyBUeXBlRXJyb3IoIm9wdGlvbnMgbXVzdCBiZSBhbiBvYmplY3QiKTtjb25zdHttaW46cz0wLG1heDpyPTFlMyxyYW5kb206aT1NYXRoLnJhbmRvbX09dDtpZighTnVtYmVyLmlzSW50ZWdlcihzKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJtaW4gbXVzdCBiZSBhbiBpbnRlZ2VyIik7aWYoIU51bWJlci5pc0ludGVnZXIocikpdGhyb3cgbmV3IFR5cGVFcnJvcigibWF4IG11c3QgYmUgYW4gaW50ZWdlciIpO2lmKHM+PXIpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIm1pbiBtdXN0IGJlIHNtYWxsZXIgdGhhbiBtYXgiKTtsZXQgaD1yLXMsbD1uZXcgSShlLG4pO2ZvcihsZXQgdT0wO3U8ZTt1KyspZm9yKGxldCBmPTA7ZjxuO2YrKyl7bGV0IGc9cytNYXRoLnJvdW5kKGkoKSpoKTtsLnNldCh1LGYsZyl9cmV0dXJuIGx9c3RhdGljIGV5ZShlLG4sdCl7bj09PXZvaWQgMCYmKG49ZSksdD09PXZvaWQgMCYmKHQ9MSk7bGV0IHM9TWF0aC5taW4oZSxuKSxyPXRoaXMuemVyb3MoZSxuKTtmb3IobGV0IGk9MDtpPHM7aSsrKXIuc2V0KGksaSx0KTtyZXR1cm4gcn1zdGF0aWMgZGlhZyhlLG4sdCl7bGV0IHM9ZS5sZW5ndGg7bj09PXZvaWQgMCYmKG49cyksdD09PXZvaWQgMCYmKHQ9bik7bGV0IHI9TWF0aC5taW4ocyxuLHQpLGk9dGhpcy56ZXJvcyhuLHQpO2ZvcihsZXQgaD0wO2g8cjtoKyspaS5zZXQoaCxoLGVbaF0pO3JldHVybiBpfXN0YXRpYyBtaW4oZSxuKXtlPXRoaXMuY2hlY2tNYXRyaXgoZSksbj10aGlzLmNoZWNrTWF0cml4KG4pO2xldCB0PWUucm93cyxzPWUuY29sdW1ucyxyPW5ldyBJKHQscyk7Zm9yKGxldCBpPTA7aTx0O2krKylmb3IobGV0IGg9MDtoPHM7aCsrKXIuc2V0KGksaCxNYXRoLm1pbihlLmdldChpLGgpLG4uZ2V0KGksaCkpKTtyZXR1cm4gcn1zdGF0aWMgbWF4KGUsbil7ZT10aGlzLmNoZWNrTWF0cml4KGUpLG49dGhpcy5jaGVja01hdHJpeChuKTtsZXQgdD1lLnJvd3Mscz1lLmNvbHVtbnMscj1uZXcgdGhpcyh0LHMpO2ZvcihsZXQgaT0wO2k8dDtpKyspZm9yKGxldCBoPTA7aDxzO2grKylyLnNldChpLGgsTWF0aC5tYXgoZS5nZXQoaSxoKSxuLmdldChpLGgpKSk7cmV0dXJuIHJ9c3RhdGljIGNoZWNrTWF0cml4KGUpe3JldHVybiBfLmlzTWF0cml4KGUpP2U6bmV3IEkoZSl9c3RhdGljIGlzTWF0cml4KGUpe3JldHVybiBlIT1udWxsJiZlLmtsYXNzPT09Ik1hdHJpeCJ9Z2V0IHNpemUoKXtyZXR1cm4gdGhpcy5yb3dzKnRoaXMuY29sdW1uc31hcHBseShlKXtpZih0eXBlb2YgZSE9ImZ1bmN0aW9uIil0aHJvdyBuZXcgVHlwZUVycm9yKCJjYWxsYmFjayBtdXN0IGJlIGEgZnVuY3Rpb24iKTtmb3IobGV0IG49MDtuPHRoaXMucm93cztuKyspZm9yKGxldCB0PTA7dDx0aGlzLmNvbHVtbnM7dCsrKWUuY2FsbCh0aGlzLG4sdCk7cmV0dXJuIHRoaXN9dG8xREFycmF5KCl7bGV0IGU9W107Zm9yKGxldCBuPTA7bjx0aGlzLnJvd3M7bisrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyllLnB1c2godGhpcy5nZXQobix0KSk7cmV0dXJuIGV9dG8yREFycmF5KCl7bGV0IGU9W107Zm9yKGxldCBuPTA7bjx0aGlzLnJvd3M7bisrKXtlLnB1c2goW10pO2ZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyllW25dLnB1c2godGhpcy5nZXQobix0KSl9cmV0dXJuIGV9dG9KU09OKCl7cmV0dXJuIHRoaXMudG8yREFycmF5KCl9aXNSb3dWZWN0b3IoKXtyZXR1cm4gdGhpcy5yb3dzPT09MX1pc0NvbHVtblZlY3Rvcigpe3JldHVybiB0aGlzLmNvbHVtbnM9PT0xfWlzVmVjdG9yKCl7cmV0dXJuIHRoaXMucm93cz09PTF8fHRoaXMuY29sdW1ucz09PTF9aXNTcXVhcmUoKXtyZXR1cm4gdGhpcy5yb3dzPT09dGhpcy5jb2x1bW5zfWlzRW1wdHkoKXtyZXR1cm4gdGhpcy5yb3dzPT09MHx8dGhpcy5jb2x1bW5zPT09MH1pc1N5bW1ldHJpYygpe2lmKHRoaXMuaXNTcXVhcmUoKSl7Zm9yKGxldCBlPTA7ZTx0aGlzLnJvd3M7ZSsrKWZvcihsZXQgbj0wO248PWU7bisrKWlmKHRoaXMuZ2V0KGUsbikhPT10aGlzLmdldChuLGUpKXJldHVybiExO3JldHVybiEwfXJldHVybiExfWlzRWNoZWxvbkZvcm0oKXtsZXQgZT0wLG49MCx0PS0xLHM9ITAscj0hMTtmb3IoO2U8dGhpcy5yb3dzJiZzOyl7Zm9yKG49MCxyPSExO248dGhpcy5jb2x1bW5zJiZyPT09ITE7KXRoaXMuZ2V0KGUsbik9PT0wP24rKzp0aGlzLmdldChlLG4pPT09MSYmbj50PyhyPSEwLHQ9bik6KHM9ITEscj0hMCk7ZSsrfXJldHVybiBzfWlzUmVkdWNlZEVjaGVsb25Gb3JtKCl7bGV0IGU9MCxuPTAsdD0tMSxzPSEwLHI9ITE7Zm9yKDtlPHRoaXMucm93cyYmczspe2ZvcihuPTAscj0hMTtuPHRoaXMuY29sdW1ucyYmcj09PSExOyl0aGlzLmdldChlLG4pPT09MD9uKys6dGhpcy5nZXQoZSxuKT09PTEmJm4+dD8ocj0hMCx0PW4pOihzPSExLHI9ITApO2ZvcihsZXQgaT1uKzE7aTx0aGlzLnJvd3M7aSsrKXRoaXMuZ2V0KGUsaSkhPT0wJiYocz0hMSk7ZSsrfXJldHVybiBzfWVjaGVsb25Gb3JtKCl7bGV0IGU9dGhpcy5jbG9uZSgpLG49MCx0PTA7Zm9yKDtuPGUucm93cyYmdDxlLmNvbHVtbnM7KXtsZXQgcz1uO2ZvcihsZXQgcj1uO3I8ZS5yb3dzO3IrKyllLmdldChyLHQpPmUuZ2V0KHMsdCkmJihzPXIpO2lmKGUuZ2V0KHMsdCk9PT0wKXQrKztlbHNle2Uuc3dhcFJvd3MobixzKTtsZXQgcj1lLmdldChuLHQpO2ZvcihsZXQgaT10O2k8ZS5jb2x1bW5zO2krKyllLnNldChuLGksZS5nZXQobixpKS9yKTtmb3IobGV0IGk9bisxO2k8ZS5yb3dzO2krKyl7bGV0IGg9ZS5nZXQoaSx0KS9lLmdldChuLHQpO2Uuc2V0KGksdCwwKTtmb3IobGV0IGw9dCsxO2w8ZS5jb2x1bW5zO2wrKyllLnNldChpLGwsZS5nZXQoaSxsKS1lLmdldChuLGwpKmgpfW4rKyx0Kyt9fXJldHVybiBlfXJlZHVjZWRFY2hlbG9uRm9ybSgpe2xldCBlPXRoaXMuZWNoZWxvbkZvcm0oKSxuPWUuY29sdW1ucyx0PWUucm93cyxzPXQtMTtmb3IoO3M+PTA7KWlmKGUubWF4Um93KHMpPT09MClzLS07ZWxzZXtsZXQgcj0wLGk9ITE7Zm9yKDtyPHQmJmk9PT0hMTspZS5nZXQocyxyKT09PTE/aT0hMDpyKys7Zm9yKGxldCBoPTA7aDxzO2grKyl7bGV0IGw9ZS5nZXQoaCxyKTtmb3IobGV0IHU9cjt1PG47dSsrKXtsZXQgZj1lLmdldChoLHUpLWwqZS5nZXQocyx1KTtlLnNldChoLHUsZil9fXMtLX1yZXR1cm4gZX1zZXQoKXt0aHJvdyBuZXcgRXJyb3IoInNldCBtZXRob2QgaXMgdW5pbXBsZW1lbnRlZCIpfWdldCgpe3Rocm93IG5ldyBFcnJvcigiZ2V0IG1ldGhvZCBpcyB1bmltcGxlbWVudGVkIil9cmVwZWF0KGU9e30pe2lmKHR5cGVvZiBlIT0ib2JqZWN0Iil0aHJvdyBuZXcgVHlwZUVycm9yKCJvcHRpb25zIG11c3QgYmUgYW4gb2JqZWN0Iik7Y29uc3R7cm93czpuPTEsY29sdW1uczp0PTF9PWU7aWYoIU51bWJlci5pc0ludGVnZXIobil8fG48PTApdGhyb3cgbmV3IFR5cGVFcnJvcigicm93cyBtdXN0IGJlIGEgcG9zaXRpdmUgaW50ZWdlciIpO2lmKCFOdW1iZXIuaXNJbnRlZ2VyKHQpfHx0PD0wKXRocm93IG5ldyBUeXBlRXJyb3IoImNvbHVtbnMgbXVzdCBiZSBhIHBvc2l0aXZlIGludGVnZXIiKTtsZXQgcz1uZXcgSSh0aGlzLnJvd3Mqbix0aGlzLmNvbHVtbnMqdCk7Zm9yKGxldCByPTA7cjxuO3IrKylmb3IobGV0IGk9MDtpPHQ7aSsrKXMuc2V0U3ViTWF0cml4KHRoaXMsdGhpcy5yb3dzKnIsdGhpcy5jb2x1bW5zKmkpO3JldHVybiBzfWZpbGwoZSl7Zm9yKGxldCBuPTA7bjx0aGlzLnJvd3M7bisrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChuLHQsZSk7cmV0dXJuIHRoaXN9bmVnKCl7cmV0dXJuIHRoaXMubXVsUygtMSl9Z2V0Um93KGUpe1EodGhpcyxlKTtsZXQgbj1bXTtmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0Kyspbi5wdXNoKHRoaXMuZ2V0KGUsdCkpO3JldHVybiBufWdldFJvd1ZlY3RvcihlKXtyZXR1cm4gSS5yb3dWZWN0b3IodGhpcy5nZXRSb3coZSkpfXNldFJvdyhlLG4pe1EodGhpcyxlKSxuPUEodGhpcyxuKTtmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspdGhpcy5zZXQoZSx0LG5bdF0pO3JldHVybiB0aGlzfXN3YXBSb3dzKGUsbil7USh0aGlzLGUpLFEodGhpcyxuKTtmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0Kyspe2xldCBzPXRoaXMuZ2V0KGUsdCk7dGhpcy5zZXQoZSx0LHRoaXMuZ2V0KG4sdCkpLHRoaXMuc2V0KG4sdCxzKX1yZXR1cm4gdGhpc31nZXRDb2x1bW4oZSl7Vyh0aGlzLGUpO2xldCBuPVtdO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKyluLnB1c2godGhpcy5nZXQodCxlKSk7cmV0dXJuIG59Z2V0Q29sdW1uVmVjdG9yKGUpe3JldHVybiBJLmNvbHVtblZlY3Rvcih0aGlzLmdldENvbHVtbihlKSl9c2V0Q29sdW1uKGUsbil7Vyh0aGlzLGUpLG49dHQodGhpcyxuKTtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspdGhpcy5zZXQodCxlLG5bdF0pO3JldHVybiB0aGlzfXN3YXBDb2x1bW5zKGUsbil7Vyh0aGlzLGUpLFcodGhpcyxuKTtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0Kyspe2xldCBzPXRoaXMuZ2V0KHQsZSk7dGhpcy5zZXQodCxlLHRoaXMuZ2V0KHQsbikpLHRoaXMuc2V0KHQsbixzKX1yZXR1cm4gdGhpc31hZGRSb3dWZWN0b3IoZSl7ZT1BKHRoaXMsZSk7Zm9yKGxldCBuPTA7bjx0aGlzLnJvd3M7bisrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChuLHQsdGhpcy5nZXQobix0KStlW3RdKTtyZXR1cm4gdGhpc31zdWJSb3dWZWN0b3IoZSl7ZT1BKHRoaXMsZSk7Zm9yKGxldCBuPTA7bjx0aGlzLnJvd3M7bisrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChuLHQsdGhpcy5nZXQobix0KS1lW3RdKTtyZXR1cm4gdGhpc31tdWxSb3dWZWN0b3IoZSl7ZT1BKHRoaXMsZSk7Zm9yKGxldCBuPTA7bjx0aGlzLnJvd3M7bisrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChuLHQsdGhpcy5nZXQobix0KSplW3RdKTtyZXR1cm4gdGhpc31kaXZSb3dWZWN0b3IoZSl7ZT1BKHRoaXMsZSk7Zm9yKGxldCBuPTA7bjx0aGlzLnJvd3M7bisrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChuLHQsdGhpcy5nZXQobix0KS9lW3RdKTtyZXR1cm4gdGhpc31hZGRDb2x1bW5WZWN0b3IoZSl7ZT10dCh0aGlzLGUpO2ZvcihsZXQgbj0wO248dGhpcy5yb3dzO24rKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspdGhpcy5zZXQobix0LHRoaXMuZ2V0KG4sdCkrZVtuXSk7cmV0dXJuIHRoaXN9c3ViQ29sdW1uVmVjdG9yKGUpe2U9dHQodGhpcyxlKTtmb3IobGV0IG49MDtuPHRoaXMucm93cztuKyspZm9yKGxldCB0PTA7dDx0aGlzLmNvbHVtbnM7dCsrKXRoaXMuc2V0KG4sdCx0aGlzLmdldChuLHQpLWVbbl0pO3JldHVybiB0aGlzfW11bENvbHVtblZlY3RvcihlKXtlPXR0KHRoaXMsZSk7Zm9yKGxldCBuPTA7bjx0aGlzLnJvd3M7bisrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChuLHQsdGhpcy5nZXQobix0KSplW25dKTtyZXR1cm4gdGhpc31kaXZDb2x1bW5WZWN0b3IoZSl7ZT10dCh0aGlzLGUpO2ZvcihsZXQgbj0wO248dGhpcy5yb3dzO24rKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspdGhpcy5zZXQobix0LHRoaXMuZ2V0KG4sdCkvZVtuXSk7cmV0dXJuIHRoaXN9bXVsUm93KGUsbil7USh0aGlzLGUpO2ZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChlLHQsdGhpcy5nZXQoZSx0KSpuKTtyZXR1cm4gdGhpc31tdWxDb2x1bW4oZSxuKXtXKHRoaXMsZSk7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKXRoaXMuc2V0KHQsZSx0aGlzLmdldCh0LGUpKm4pO3JldHVybiB0aGlzfW1heCgpe2lmKHRoaXMuaXNFbXB0eSgpKXJldHVybiBOYU47bGV0IGU9dGhpcy5nZXQoMCwwKTtmb3IobGV0IG49MDtuPHRoaXMucm93cztuKyspZm9yKGxldCB0PTA7dDx0aGlzLmNvbHVtbnM7dCsrKXRoaXMuZ2V0KG4sdCk+ZSYmKGU9dGhpcy5nZXQobix0KSk7cmV0dXJuIGV9bWF4SW5kZXgoKXtldCh0aGlzKTtsZXQgZT10aGlzLmdldCgwLDApLG49WzAsMF07Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLmdldCh0LHMpPmUmJihlPXRoaXMuZ2V0KHQscyksblswXT10LG5bMV09cyk7cmV0dXJuIG59bWluKCl7aWYodGhpcy5pc0VtcHR5KCkpcmV0dXJuIE5hTjtsZXQgZT10aGlzLmdldCgwLDApO2ZvcihsZXQgbj0wO248dGhpcy5yb3dzO24rKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspdGhpcy5nZXQobix0KTxlJiYoZT10aGlzLmdldChuLHQpKTtyZXR1cm4gZX1taW5JbmRleCgpe2V0KHRoaXMpO2xldCBlPXRoaXMuZ2V0KDAsMCksbj1bMCwwXTtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuZ2V0KHQscyk8ZSYmKGU9dGhpcy5nZXQodCxzKSxuWzBdPXQsblsxXT1zKTtyZXR1cm4gbn1tYXhSb3coZSl7aWYoUSh0aGlzLGUpLHRoaXMuaXNFbXB0eSgpKXJldHVybiBOYU47bGV0IG49dGhpcy5nZXQoZSwwKTtmb3IobGV0IHQ9MTt0PHRoaXMuY29sdW1uczt0KyspdGhpcy5nZXQoZSx0KT5uJiYobj10aGlzLmdldChlLHQpKTtyZXR1cm4gbn1tYXhSb3dJbmRleChlKXtRKHRoaXMsZSksZXQodGhpcyk7bGV0IG49dGhpcy5nZXQoZSwwKSx0PVtlLDBdO2ZvcihsZXQgcz0xO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLmdldChlLHMpPm4mJihuPXRoaXMuZ2V0KGUscyksdFsxXT1zKTtyZXR1cm4gdH1taW5Sb3coZSl7aWYoUSh0aGlzLGUpLHRoaXMuaXNFbXB0eSgpKXJldHVybiBOYU47bGV0IG49dGhpcy5nZXQoZSwwKTtmb3IobGV0IHQ9MTt0PHRoaXMuY29sdW1uczt0KyspdGhpcy5nZXQoZSx0KTxuJiYobj10aGlzLmdldChlLHQpKTtyZXR1cm4gbn1taW5Sb3dJbmRleChlKXtRKHRoaXMsZSksZXQodGhpcyk7bGV0IG49dGhpcy5nZXQoZSwwKSx0PVtlLDBdO2ZvcihsZXQgcz0xO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLmdldChlLHMpPG4mJihuPXRoaXMuZ2V0KGUscyksdFsxXT1zKTtyZXR1cm4gdH1tYXhDb2x1bW4oZSl7aWYoVyh0aGlzLGUpLHRoaXMuaXNFbXB0eSgpKXJldHVybiBOYU47bGV0IG49dGhpcy5nZXQoMCxlKTtmb3IobGV0IHQ9MTt0PHRoaXMucm93czt0KyspdGhpcy5nZXQodCxlKT5uJiYobj10aGlzLmdldCh0LGUpKTtyZXR1cm4gbn1tYXhDb2x1bW5JbmRleChlKXtXKHRoaXMsZSksZXQodGhpcyk7bGV0IG49dGhpcy5nZXQoMCxlKSx0PVswLGVdO2ZvcihsZXQgcz0xO3M8dGhpcy5yb3dzO3MrKyl0aGlzLmdldChzLGUpPm4mJihuPXRoaXMuZ2V0KHMsZSksdFswXT1zKTtyZXR1cm4gdH1taW5Db2x1bW4oZSl7aWYoVyh0aGlzLGUpLHRoaXMuaXNFbXB0eSgpKXJldHVybiBOYU47bGV0IG49dGhpcy5nZXQoMCxlKTtmb3IobGV0IHQ9MTt0PHRoaXMucm93czt0KyspdGhpcy5nZXQodCxlKTxuJiYobj10aGlzLmdldCh0LGUpKTtyZXR1cm4gbn1taW5Db2x1bW5JbmRleChlKXtXKHRoaXMsZSksZXQodGhpcyk7bGV0IG49dGhpcy5nZXQoMCxlKSx0PVswLGVdO2ZvcihsZXQgcz0xO3M8dGhpcy5yb3dzO3MrKyl0aGlzLmdldChzLGUpPG4mJihuPXRoaXMuZ2V0KHMsZSksdFswXT1zKTtyZXR1cm4gdH1kaWFnKCl7bGV0IGU9TWF0aC5taW4odGhpcy5yb3dzLHRoaXMuY29sdW1ucyksbj1bXTtmb3IobGV0IHQ9MDt0PGU7dCsrKW4ucHVzaCh0aGlzLmdldCh0LHQpKTtyZXR1cm4gbn1ub3JtKGU9ImZyb2Jlbml1cyIpe2xldCBuPTA7aWYoZT09PSJtYXgiKXJldHVybiB0aGlzLm1heCgpO2lmKGU9PT0iZnJvYmVuaXVzIil7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyluPW4rdGhpcy5nZXQodCxzKSp0aGlzLmdldCh0LHMpO3JldHVybiBNYXRoLnNxcnQobil9ZWxzZSB0aHJvdyBuZXcgUmFuZ2VFcnJvcihgdW5rbm93biBub3JtIHR5cGU6ICR7ZX1gKX1jdW11bGF0aXZlU3VtKCl7bGV0IGU9MDtmb3IobGV0IG49MDtuPHRoaXMucm93cztuKyspZm9yKGxldCB0PTA7dDx0aGlzLmNvbHVtbnM7dCsrKWUrPXRoaXMuZ2V0KG4sdCksdGhpcy5zZXQobix0LGUpO3JldHVybiB0aGlzfWRvdChlKXtfLmlzTWF0cml4KGUpJiYoZT1lLnRvMURBcnJheSgpKTtsZXQgbj10aGlzLnRvMURBcnJheSgpO2lmKG4ubGVuZ3RoIT09ZS5sZW5ndGgpdGhyb3cgbmV3IFJhbmdlRXJyb3IoInZlY3RvcnMgZG8gbm90IGhhdmUgdGhlIHNhbWUgc2l6ZSIpO2xldCB0PTA7Zm9yKGxldCBzPTA7czxuLmxlbmd0aDtzKyspdCs9bltzXSplW3NdO3JldHVybiB0fW1tdWwoZSl7ZT1JLmNoZWNrTWF0cml4KGUpO2xldCBuPXRoaXMucm93cyx0PXRoaXMuY29sdW1ucyxzPWUuY29sdW1ucyxyPW5ldyBJKG4scyksaT1uZXcgRmxvYXQ2NEFycmF5KHQpO2ZvcihsZXQgaD0wO2g8cztoKyspe2ZvcihsZXQgbD0wO2w8dDtsKyspaVtsXT1lLmdldChsLGgpO2ZvcihsZXQgbD0wO2w8bjtsKyspe2xldCB1PTA7Zm9yKGxldCBmPTA7Zjx0O2YrKyl1Kz10aGlzLmdldChsLGYpKmlbZl07ci5zZXQobCxoLHUpfX1yZXR1cm4gcn1zdHJhc3NlbjJ4MihlKXtlPUkuY2hlY2tNYXRyaXgoZSk7bGV0IG49bmV3IEkoMiwyKTtjb25zdCB0PXRoaXMuZ2V0KDAsMCkscz1lLmdldCgwLDApLHI9dGhpcy5nZXQoMCwxKSxpPWUuZ2V0KDAsMSksaD10aGlzLmdldCgxLDApLGw9ZS5nZXQoMSwwKSx1PXRoaXMuZ2V0KDEsMSksZj1lLmdldCgxLDEpLGc9KHQrdSkqKHMrZiksYT0oaCt1KSpzLGo9dCooaS1mKSx3PXUqKGwtcykseT0odCtyKSpmLG09KGgtdCkqKHMraSksTT0oci11KSoobCtmKSx6PWcrdy15K00sRT1qK3ksaz1hK3csUj1nLWEraittO3JldHVybiBuLnNldCgwLDAseiksbi5zZXQoMCwxLEUpLG4uc2V0KDEsMCxrKSxuLnNldCgxLDEsUiksbn1zdHJhc3NlbjN4MyhlKXtlPUkuY2hlY2tNYXRyaXgoZSk7bGV0IG49bmV3IEkoMywzKTtjb25zdCB0PXRoaXMuZ2V0KDAsMCkscz10aGlzLmdldCgwLDEpLHI9dGhpcy5nZXQoMCwyKSxpPXRoaXMuZ2V0KDEsMCksaD10aGlzLmdldCgxLDEpLGw9dGhpcy5nZXQoMSwyKSx1PXRoaXMuZ2V0KDIsMCksZj10aGlzLmdldCgyLDEpLGc9dGhpcy5nZXQoMiwyKSxhPWUuZ2V0KDAsMCksaj1lLmdldCgwLDEpLHc9ZS5nZXQoMCwyKSx5PWUuZ2V0KDEsMCksbT1lLmdldCgxLDEpLE09ZS5nZXQoMSwyKSx6PWUuZ2V0KDIsMCksRT1lLmdldCgyLDEpLGs9ZS5nZXQoMiwyKSxSPSh0K3Mrci1pLWgtZi1nKSptLHE9KHQtaSkqKC1qK20pLGI9aCooLWErait5LW0tTS16K2spLEY9KC10K2kraCkqKGEtaittKSxYPShpK2gpKigtYStqKSxjPXQqYSxwPSgtdCt1K2YpKihhLXcrTSksUz0oLXQrdSkqKHctTSksZD0odStmKSooLWErdyksUD0odCtzK3ItaC1sLXUtZikqTSxPPWYqKC1hK3creS1tLU0teitFKSxUPSgtcitmK2cpKihtK3otRSksRD0oci1nKSoobS1FKSxZPXIqeixHPShmK2cpKigteitFKSx2PSgtcitoK2wpKihNK3otayksVj0oci1sKSooTS1rKSxKPShoK2wpKigteitrKSxOPXMqeSxCPWwqRSwkPWkqdyxDPXUqaixVPWcqayx3dD1jK1krTixwdD1SK0YrWCtjK1QrWStHLGR0PWMrcCtkK1ArWSt2K0oscnQ9cStiK0YrYytZK3YrVixpdD1xK0YrWCtjK0IsbHQ9WSt2K1YrSiskLGp0PWMrcCtTK08rVCtEK1ksaHQ9VCtEK1krRytDLGt0PWMrcCtTK2QrVTtyZXR1cm4gbi5zZXQoMCwwLHd0KSxuLnNldCgwLDEscHQpLG4uc2V0KDAsMixkdCksbi5zZXQoMSwwLHJ0KSxuLnNldCgxLDEsaXQpLG4uc2V0KDEsMixsdCksbi5zZXQoMiwwLGp0KSxuLnNldCgyLDEsaHQpLG4uc2V0KDIsMixrdCksbn1tbXVsU3RyYXNzZW4oZSl7ZT1JLmNoZWNrTWF0cml4KGUpO2xldCBuPXRoaXMuY2xvbmUoKSx0PW4ucm93cyxzPW4uY29sdW1ucyxyPWUucm93cyxpPWUuY29sdW1ucztzIT09ciYmY29uc29sZS53YXJuKGBNdWx0aXBseWluZyAke3R9IHggJHtzfSBhbmQgJHtyfSB4ICR7aX0gbWF0cml4OiBkaW1lbnNpb25zIGRvIG5vdCBtYXRjaC5gKTtmdW5jdGlvbiBoKGcsYSxqKXtsZXQgdz1nLnJvd3MseT1nLmNvbHVtbnM7aWYodz09PWEmJnk9PT1qKXJldHVybiBnO3tsZXQgbT1fLnplcm9zKGEsaik7cmV0dXJuIG09bS5zZXRTdWJNYXRyaXgoZywwLDApLG19fWxldCBsPU1hdGgubWF4KHQsciksdT1NYXRoLm1heChzLGkpO249aChuLGwsdSksZT1oKGUsbCx1KTtmdW5jdGlvbiBmKGcsYSxqLHcpe2lmKGo8PTUxMnx8dzw9NTEyKXJldHVybiBnLm1tdWwoYSk7aiUyPT09MSYmdyUyPT09MT8oZz1oKGcsaisxLHcrMSksYT1oKGEsaisxLHcrMSkpOmolMj09PTE/KGc9aChnLGorMSx3KSxhPWgoYSxqKzEsdykpOnclMj09PTEmJihnPWgoZyxqLHcrMSksYT1oKGEsaix3KzEpKTtsZXQgeT1wYXJzZUludChnLnJvd3MvMiwxMCksbT1wYXJzZUludChnLmNvbHVtbnMvMiwxMCksTT1nLnN1Yk1hdHJpeCgwLHktMSwwLG0tMSksej1hLnN1Yk1hdHJpeCgwLHktMSwwLG0tMSksRT1nLnN1Yk1hdHJpeCgwLHktMSxtLGcuY29sdW1ucy0xKSxrPWEuc3ViTWF0cml4KDAseS0xLG0sYS5jb2x1bW5zLTEpLFI9Zy5zdWJNYXRyaXgoeSxnLnJvd3MtMSwwLG0tMSkscT1hLnN1Yk1hdHJpeCh5LGEucm93cy0xLDAsbS0xKSxiPWcuc3ViTWF0cml4KHksZy5yb3dzLTEsbSxnLmNvbHVtbnMtMSksRj1hLnN1Yk1hdHJpeCh5LGEucm93cy0xLG0sYS5jb2x1bW5zLTEpLFg9ZihfLmFkZChNLGIpLF8uYWRkKHosRikseSxtKSxjPWYoXy5hZGQoUixiKSx6LHksbSkscD1mKE0sXy5zdWIoayxGKSx5LG0pLFM9ZihiLF8uc3ViKHEseikseSxtKSxkPWYoXy5hZGQoTSxFKSxGLHksbSksUD1mKF8uc3ViKFIsTSksXy5hZGQoeixrKSx5LG0pLE89ZihfLnN1YihFLGIpLF8uYWRkKHEsRikseSxtKSxUPV8uYWRkKFgsUyk7VC5zdWIoZCksVC5hZGQoTyk7bGV0IEQ9Xy5hZGQocCxkKSxZPV8uYWRkKGMsUyksRz1fLnN1YihYLGMpO0cuYWRkKHApLEcuYWRkKFApO2xldCB2PV8uemVyb3MoMipULnJvd3MsMipULmNvbHVtbnMpO3JldHVybiB2PXYuc2V0U3ViTWF0cml4KFQsMCwwKSx2PXYuc2V0U3ViTWF0cml4KEQsVC5yb3dzLDApLHY9di5zZXRTdWJNYXRyaXgoWSwwLFQuY29sdW1ucyksdj12LnNldFN1Yk1hdHJpeChHLFQucm93cyxULmNvbHVtbnMpLHYuc3ViTWF0cml4KDAsai0xLDAsdy0xKX1yZXR1cm4gZihuLGUsbCx1KX1zY2FsZVJvd3MoZT17fSl7aWYodHlwZW9mIGUhPSJvYmplY3QiKXRocm93IG5ldyBUeXBlRXJyb3IoIm9wdGlvbnMgbXVzdCBiZSBhbiBvYmplY3QiKTtjb25zdHttaW46bj0wLG1heDp0PTF9PWU7aWYoIU51bWJlci5pc0Zpbml0ZShuKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJtaW4gbXVzdCBiZSBhIG51bWJlciIpO2lmKCFOdW1iZXIuaXNGaW5pdGUodCkpdGhyb3cgbmV3IFR5cGVFcnJvcigibWF4IG11c3QgYmUgYSBudW1iZXIiKTtpZihuPj10KXRocm93IG5ldyBSYW5nZUVycm9yKCJtaW4gbXVzdCBiZSBzbWFsbGVyIHRoYW4gbWF4Iik7bGV0IHM9bmV3IEkodGhpcy5yb3dzLHRoaXMuY29sdW1ucyk7Zm9yKGxldCByPTA7cjx0aGlzLnJvd3M7cisrKXtjb25zdCBpPXRoaXMuZ2V0Um93KHIpO2kubGVuZ3RoPjAmJnF0KGkse21pbjpuLG1heDp0LG91dHB1dDppfSkscy5zZXRSb3cocixpKX1yZXR1cm4gc31zY2FsZUNvbHVtbnMoZT17fSl7aWYodHlwZW9mIGUhPSJvYmplY3QiKXRocm93IG5ldyBUeXBlRXJyb3IoIm9wdGlvbnMgbXVzdCBiZSBhbiBvYmplY3QiKTtjb25zdHttaW46bj0wLG1heDp0PTF9PWU7aWYoIU51bWJlci5pc0Zpbml0ZShuKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJtaW4gbXVzdCBiZSBhIG51bWJlciIpO2lmKCFOdW1iZXIuaXNGaW5pdGUodCkpdGhyb3cgbmV3IFR5cGVFcnJvcigibWF4IG11c3QgYmUgYSBudW1iZXIiKTtpZihuPj10KXRocm93IG5ldyBSYW5nZUVycm9yKCJtaW4gbXVzdCBiZSBzbWFsbGVyIHRoYW4gbWF4Iik7bGV0IHM9bmV3IEkodGhpcy5yb3dzLHRoaXMuY29sdW1ucyk7Zm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXtjb25zdCBpPXRoaXMuZ2V0Q29sdW1uKHIpO2kubGVuZ3RoJiZxdChpLHttaW46bixtYXg6dCxvdXRwdXQ6aX0pLHMuc2V0Q29sdW1uKHIsaSl9cmV0dXJuIHN9ZmxpcFJvd3MoKXtjb25zdCBlPU1hdGguY2VpbCh0aGlzLmNvbHVtbnMvMik7Zm9yKGxldCBuPTA7bjx0aGlzLnJvd3M7bisrKWZvcihsZXQgdD0wO3Q8ZTt0Kyspe2xldCBzPXRoaXMuZ2V0KG4sdCkscj10aGlzLmdldChuLHRoaXMuY29sdW1ucy0xLXQpO3RoaXMuc2V0KG4sdCxyKSx0aGlzLnNldChuLHRoaXMuY29sdW1ucy0xLXQscyl9cmV0dXJuIHRoaXN9ZmxpcENvbHVtbnMoKXtjb25zdCBlPU1hdGguY2VpbCh0aGlzLnJvd3MvMik7Zm9yKGxldCBuPTA7bjx0aGlzLmNvbHVtbnM7bisrKWZvcihsZXQgdD0wO3Q8ZTt0Kyspe2xldCBzPXRoaXMuZ2V0KHQsbikscj10aGlzLmdldCh0aGlzLnJvd3MtMS10LG4pO3RoaXMuc2V0KHQsbixyKSx0aGlzLnNldCh0aGlzLnJvd3MtMS10LG4scyl9cmV0dXJuIHRoaXN9a3JvbmVja2VyUHJvZHVjdChlKXtlPUkuY2hlY2tNYXRyaXgoZSk7bGV0IG49dGhpcy5yb3dzLHQ9dGhpcy5jb2x1bW5zLHM9ZS5yb3dzLHI9ZS5jb2x1bW5zLGk9bmV3IEkobipzLHQqcik7Zm9yKGxldCBoPTA7aDxuO2grKylmb3IobGV0IGw9MDtsPHQ7bCsrKWZvcihsZXQgdT0wO3U8czt1KyspZm9yKGxldCBmPTA7ZjxyO2YrKylpLnNldChzKmgrdSxyKmwrZix0aGlzLmdldChoLGwpKmUuZ2V0KHUsZikpO3JldHVybiBpfXRyYW5zcG9zZSgpe2xldCBlPW5ldyBJKHRoaXMuY29sdW1ucyx0aGlzLnJvd3MpO2ZvcihsZXQgbj0wO248dGhpcy5yb3dzO24rKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspZS5zZXQodCxuLHRoaXMuZ2V0KG4sdCkpO3JldHVybiBlfXNvcnRSb3dzKGU9VHQpe2ZvcihsZXQgbj0wO248dGhpcy5yb3dzO24rKyl0aGlzLnNldFJvdyhuLHRoaXMuZ2V0Um93KG4pLnNvcnQoZSkpO3JldHVybiB0aGlzfXNvcnRDb2x1bW5zKGU9VHQpe2ZvcihsZXQgbj0wO248dGhpcy5jb2x1bW5zO24rKyl0aGlzLnNldENvbHVtbihuLHRoaXMuZ2V0Q29sdW1uKG4pLnNvcnQoZSkpO3JldHVybiB0aGlzfXN1Yk1hdHJpeChlLG4sdCxzKXtGdCh0aGlzLGUsbix0LHMpO2xldCByPW5ldyBJKG4tZSsxLHMtdCsxKTtmb3IobGV0IGk9ZTtpPD1uO2krKylmb3IobGV0IGg9dDtoPD1zO2grKylyLnNldChpLWUsaC10LHRoaXMuZ2V0KGksaCkpO3JldHVybiByfXN1Yk1hdHJpeFJvdyhlLG4sdCl7aWYobj09PXZvaWQgMCYmKG49MCksdD09PXZvaWQgMCYmKHQ9dGhpcy5jb2x1bW5zLTEpLG4+dHx8bjwwfHxuPj10aGlzLmNvbHVtbnN8fHQ8MHx8dD49dGhpcy5jb2x1bW5zKXRocm93IG5ldyBSYW5nZUVycm9yKCJBcmd1bWVudCBvdXQgb2YgcmFuZ2UiKTtsZXQgcz1uZXcgSShlLmxlbmd0aCx0LW4rMSk7Zm9yKGxldCByPTA7cjxlLmxlbmd0aDtyKyspZm9yKGxldCBpPW47aTw9dDtpKyspe2lmKGVbcl08MHx8ZVtyXT49dGhpcy5yb3dzKXRocm93IG5ldyBSYW5nZUVycm9yKGBSb3cgaW5kZXggb3V0IG9mIHJhbmdlOiAke2Vbcl19YCk7cy5zZXQocixpLW4sdGhpcy5nZXQoZVtyXSxpKSl9cmV0dXJuIHN9c3ViTWF0cml4Q29sdW1uKGUsbix0KXtpZihuPT09dm9pZCAwJiYobj0wKSx0PT09dm9pZCAwJiYodD10aGlzLnJvd3MtMSksbj50fHxuPDB8fG4+PXRoaXMucm93c3x8dDwwfHx0Pj10aGlzLnJvd3MpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkFyZ3VtZW50IG91dCBvZiByYW5nZSIpO2xldCBzPW5ldyBJKHQtbisxLGUubGVuZ3RoKTtmb3IobGV0IHI9MDtyPGUubGVuZ3RoO3IrKylmb3IobGV0IGk9bjtpPD10O2krKyl7aWYoZVtyXTwwfHxlW3JdPj10aGlzLmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoYENvbHVtbiBpbmRleCBvdXQgb2YgcmFuZ2U6ICR7ZVtyXX1gKTtzLnNldChpLW4scix0aGlzLmdldChpLGVbcl0pKX1yZXR1cm4gc31zZXRTdWJNYXRyaXgoZSxuLHQpe2lmKGU9SS5jaGVja01hdHJpeChlKSxlLmlzRW1wdHkoKSlyZXR1cm4gdGhpcztsZXQgcz1uK2Uucm93cy0xLHI9dCtlLmNvbHVtbnMtMTtGdCh0aGlzLG4scyx0LHIpO2ZvcihsZXQgaT0wO2k8ZS5yb3dzO2krKylmb3IobGV0IGg9MDtoPGUuY29sdW1ucztoKyspdGhpcy5zZXQobitpLHQraCxlLmdldChpLGgpKTtyZXR1cm4gdGhpc31zZWxlY3Rpb24oZSxuKXtsZXQgdD1yZSh0aGlzLGUsbikscz1uZXcgSShlLmxlbmd0aCxuLmxlbmd0aCk7Zm9yKGxldCByPTA7cjx0LnJvdy5sZW5ndGg7cisrKXtsZXQgaT10LnJvd1tyXTtmb3IobGV0IGg9MDtoPHQuY29sdW1uLmxlbmd0aDtoKyspe2xldCBsPXQuY29sdW1uW2hdO3Muc2V0KHIsaCx0aGlzLmdldChpLGwpKX19cmV0dXJuIHN9dHJhY2UoKXtsZXQgZT1NYXRoLm1pbih0aGlzLnJvd3MsdGhpcy5jb2x1bW5zKSxuPTA7Zm9yKGxldCB0PTA7dDxlO3QrKyluKz10aGlzLmdldCh0LHQpO3JldHVybiBufWNsb25lKCl7bGV0IGU9bmV3IEkodGhpcy5yb3dzLHRoaXMuY29sdW1ucyk7Zm9yKGxldCBuPTA7bjx0aGlzLnJvd3M7bisrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyllLnNldChuLHQsdGhpcy5nZXQobix0KSk7cmV0dXJuIGV9c3VtKGUpe3N3aXRjaChlKXtjYXNlInJvdyI6cmV0dXJuIGhlKHRoaXMpO2Nhc2UiY29sdW1uIjpyZXR1cm4gdWUodGhpcyk7Y2FzZSB2b2lkIDA6cmV0dXJuIGNlKHRoaXMpO2RlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKGBpbnZhbGlkIG9wdGlvbjogJHtlfWApfX1wcm9kdWN0KGUpe3N3aXRjaChlKXtjYXNlInJvdyI6cmV0dXJuIGZlKHRoaXMpO2Nhc2UiY29sdW1uIjpyZXR1cm4gZ2UodGhpcyk7Y2FzZSB2b2lkIDA6cmV0dXJuIGFlKHRoaXMpO2RlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKGBpbnZhbGlkIG9wdGlvbjogJHtlfWApfX1tZWFuKGUpe2NvbnN0IG49dGhpcy5zdW0oZSk7c3dpdGNoKGUpe2Nhc2Uicm93Ijp7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKW5bdF0vPXRoaXMuY29sdW1ucztyZXR1cm4gbn1jYXNlImNvbHVtbiI6e2ZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyluW3RdLz10aGlzLnJvd3M7cmV0dXJuIG59Y2FzZSB2b2lkIDA6cmV0dXJuIG4vdGhpcy5zaXplO2RlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKGBpbnZhbGlkIG9wdGlvbjogJHtlfWApfX12YXJpYW5jZShlLG49e30pe2lmKHR5cGVvZiBlPT0ib2JqZWN0IiYmKG49ZSxlPXZvaWQgMCksdHlwZW9mIG4hPSJvYmplY3QiKXRocm93IG5ldyBUeXBlRXJyb3IoIm9wdGlvbnMgbXVzdCBiZSBhbiBvYmplY3QiKTtjb25zdHt1bmJpYXNlZDp0PSEwLG1lYW46cz10aGlzLm1lYW4oZSl9PW47aWYodHlwZW9mIHQhPSJib29sZWFuIil0aHJvdyBuZXcgVHlwZUVycm9yKCJ1bmJpYXNlZCBtdXN0IGJlIGEgYm9vbGVhbiIpO3N3aXRjaChlKXtjYXNlInJvdyI6e2lmKCFBcnJheS5pc0FycmF5KHMpKXRocm93IG5ldyBUeXBlRXJyb3IoIm1lYW4gbXVzdCBiZSBhbiBhcnJheSIpO3JldHVybiBtZSh0aGlzLHQscyl9Y2FzZSJjb2x1bW4iOntpZighQXJyYXkuaXNBcnJheShzKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJtZWFuIG11c3QgYmUgYW4gYXJyYXkiKTtyZXR1cm4gd2UodGhpcyx0LHMpfWNhc2Ugdm9pZCAwOntpZih0eXBlb2YgcyE9Im51bWJlciIpdGhyb3cgbmV3IFR5cGVFcnJvcigibWVhbiBtdXN0IGJlIGEgbnVtYmVyIik7cmV0dXJuIHBlKHRoaXMsdCxzKX1kZWZhdWx0OnRocm93IG5ldyBFcnJvcihgaW52YWxpZCBvcHRpb246ICR7ZX1gKX19c3RhbmRhcmREZXZpYXRpb24oZSxuKXt0eXBlb2YgZT09Im9iamVjdCImJihuPWUsZT12b2lkIDApO2NvbnN0IHQ9dGhpcy52YXJpYW5jZShlLG4pO2lmKGU9PT12b2lkIDApcmV0dXJuIE1hdGguc3FydCh0KTtmb3IobGV0IHM9MDtzPHQubGVuZ3RoO3MrKyl0W3NdPU1hdGguc3FydCh0W3NdKTtyZXR1cm4gdH1jZW50ZXIoZSxuPXt9KXtpZih0eXBlb2YgZT09Im9iamVjdCImJihuPWUsZT12b2lkIDApLHR5cGVvZiBuIT0ib2JqZWN0Iil0aHJvdyBuZXcgVHlwZUVycm9yKCJvcHRpb25zIG11c3QgYmUgYW4gb2JqZWN0Iik7Y29uc3R7Y2VudGVyOnQ9dGhpcy5tZWFuKGUpfT1uO3N3aXRjaChlKXtjYXNlInJvdyI6e2lmKCFBcnJheS5pc0FycmF5KHQpKXRocm93IG5ldyBUeXBlRXJyb3IoImNlbnRlciBtdXN0IGJlIGFuIGFycmF5Iik7cmV0dXJuIGRlKHRoaXMsdCksdGhpc31jYXNlImNvbHVtbiI6e2lmKCFBcnJheS5pc0FycmF5KHQpKXRocm93IG5ldyBUeXBlRXJyb3IoImNlbnRlciBtdXN0IGJlIGFuIGFycmF5Iik7cmV0dXJuIHllKHRoaXMsdCksdGhpc31jYXNlIHZvaWQgMDp7aWYodHlwZW9mIHQhPSJudW1iZXIiKXRocm93IG5ldyBUeXBlRXJyb3IoImNlbnRlciBtdXN0IGJlIGEgbnVtYmVyIik7cmV0dXJuIE1lKHRoaXMsdCksdGhpc31kZWZhdWx0OnRocm93IG5ldyBFcnJvcihgaW52YWxpZCBvcHRpb246ICR7ZX1gKX19c2NhbGUoZSxuPXt9KXtpZih0eXBlb2YgZT09Im9iamVjdCImJihuPWUsZT12b2lkIDApLHR5cGVvZiBuIT0ib2JqZWN0Iil0aHJvdyBuZXcgVHlwZUVycm9yKCJvcHRpb25zIG11c3QgYmUgYW4gb2JqZWN0Iik7bGV0IHQ9bi5zY2FsZTtzd2l0Y2goZSl7Y2FzZSJyb3ciOntpZih0PT09dm9pZCAwKXQ9RWUodGhpcyk7ZWxzZSBpZighQXJyYXkuaXNBcnJheSh0KSl0aHJvdyBuZXcgVHlwZUVycm9yKCJzY2FsZSBtdXN0IGJlIGFuIGFycmF5Iik7cmV0dXJuIFNlKHRoaXMsdCksdGhpc31jYXNlImNvbHVtbiI6e2lmKHQ9PT12b2lkIDApdD1qZSh0aGlzKTtlbHNlIGlmKCFBcnJheS5pc0FycmF5KHQpKXRocm93IG5ldyBUeXBlRXJyb3IoInNjYWxlIG11c3QgYmUgYW4gYXJyYXkiKTtyZXR1cm4ga2UodGhpcyx0KSx0aGlzfWNhc2Ugdm9pZCAwOntpZih0PT09dm9pZCAwKXQ9YmUodGhpcyk7ZWxzZSBpZih0eXBlb2YgdCE9Im51bWJlciIpdGhyb3cgbmV3IFR5cGVFcnJvcigic2NhbGUgbXVzdCBiZSBhIG51bWJlciIpO3JldHVybiBJZSh0aGlzLHQpLHRoaXN9ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoYGludmFsaWQgb3B0aW9uOiAke2V9YCl9fXRvU3RyaW5nKGUpe3JldHVybiB6dCh0aGlzLGUpfX1fLnByb3RvdHlwZS5rbGFzcz0iTWF0cml4Iix0eXBlb2YgU3ltYm9sPCJ1IiYmKF8ucHJvdG90eXBlW1N5bWJvbC5mb3IoIm5vZGVqcy51dGlsLmluc3BlY3QuY3VzdG9tIildPWVlKTtmdW5jdGlvbiBUdChvLGUpe3JldHVybiBvLWV9Xy5yYW5kb209Xy5yYW5kLF8ucmFuZG9tSW50PV8ucmFuZEludCxfLmRpYWdvbmFsPV8uZGlhZyxfLnByb3RvdHlwZS5kaWFnb25hbD1fLnByb3RvdHlwZS5kaWFnLF8uaWRlbnRpdHk9Xy5leWUsXy5wcm90b3R5cGUubmVnYXRlPV8ucHJvdG90eXBlLm5lZyxfLnByb3RvdHlwZS50ZW5zb3JQcm9kdWN0PV8ucHJvdG90eXBlLmtyb25lY2tlclByb2R1Y3Q7Y2xhc3MgSSBleHRlbmRzIF97Y29uc3RydWN0b3IoZSxuKXtpZihzdXBlcigpLEkuaXNNYXRyaXgoZSkpcmV0dXJuIGUuY2xvbmUoKTtpZihOdW1iZXIuaXNJbnRlZ2VyKGUpJiZlPj0wKWlmKHRoaXMuZGF0YT1bXSxOdW1iZXIuaXNJbnRlZ2VyKG4pJiZuPj0wKWZvcihsZXQgdD0wO3Q8ZTt0KyspdGhpcy5kYXRhLnB1c2gobmV3IEZsb2F0NjRBcnJheShuKSk7ZWxzZSB0aHJvdyBuZXcgVHlwZUVycm9yKCJuQ29sdW1ucyBtdXN0IGJlIGEgcG9zaXRpdmUgaW50ZWdlciIpO2Vsc2UgaWYoQXJyYXkuaXNBcnJheShlKSl7Y29uc3QgdD1lO2lmKGU9dC5sZW5ndGgsbj1lP3RbMF0ubGVuZ3RoOjAsdHlwZW9mIG4hPSJudW1iZXIiKXRocm93IG5ldyBUeXBlRXJyb3IoIkRhdGEgbXVzdCBiZSBhIDJEIGFycmF5IHdpdGggYXQgbGVhc3Qgb25lIGVsZW1lbnQiKTt0aGlzLmRhdGE9W107Zm9yKGxldCBzPTA7czxlO3MrKyl7aWYodFtzXS5sZW5ndGghPT1uKXRocm93IG5ldyBSYW5nZUVycm9yKCJJbmNvbnNpc3RlbnQgYXJyYXkgZGltZW5zaW9ucyIpO3RoaXMuZGF0YS5wdXNoKEZsb2F0NjRBcnJheS5mcm9tKHRbc10pKX19ZWxzZSB0aHJvdyBuZXcgVHlwZUVycm9yKCJGaXJzdCBhcmd1bWVudCBtdXN0IGJlIGEgcG9zaXRpdmUgbnVtYmVyIG9yIGFuIGFycmF5Iik7dGhpcy5yb3dzPWUsdGhpcy5jb2x1bW5zPW59c2V0KGUsbix0KXtyZXR1cm4gdGhpcy5kYXRhW2VdW25dPXQsdGhpc31nZXQoZSxuKXtyZXR1cm4gdGhpcy5kYXRhW2VdW25dfXJlbW92ZVJvdyhlKXtyZXR1cm4gUSh0aGlzLGUpLHRoaXMuZGF0YS5zcGxpY2UoZSwxKSx0aGlzLnJvd3MtPTEsdGhpc31hZGRSb3coZSxuKXtyZXR1cm4gbj09PXZvaWQgMCYmKG49ZSxlPXRoaXMucm93cyksUSh0aGlzLGUsITApLG49RmxvYXQ2NEFycmF5LmZyb20oQSh0aGlzLG4pKSx0aGlzLmRhdGEuc3BsaWNlKGUsMCxuKSx0aGlzLnJvd3MrPTEsdGhpc31yZW1vdmVDb2x1bW4oZSl7Vyh0aGlzLGUpO2ZvcihsZXQgbj0wO248dGhpcy5yb3dzO24rKyl7Y29uc3QgdD1uZXcgRmxvYXQ2NEFycmF5KHRoaXMuY29sdW1ucy0xKTtmb3IobGV0IHM9MDtzPGU7cysrKXRbc109dGhpcy5kYXRhW25dW3NdO2ZvcihsZXQgcz1lKzE7czx0aGlzLmNvbHVtbnM7cysrKXRbcy0xXT10aGlzLmRhdGFbbl1bc107dGhpcy5kYXRhW25dPXR9cmV0dXJuIHRoaXMuY29sdW1ucy09MSx0aGlzfWFkZENvbHVtbihlLG4pe3R5cGVvZiBuPiJ1IiYmKG49ZSxlPXRoaXMuY29sdW1ucyksVyh0aGlzLGUsITApLG49dHQodGhpcyxuKTtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0Kyspe2NvbnN0IHM9bmV3IEZsb2F0NjRBcnJheSh0aGlzLmNvbHVtbnMrMSk7bGV0IHI9MDtmb3IoO3I8ZTtyKyspc1tyXT10aGlzLmRhdGFbdF1bcl07Zm9yKHNbcisrXT1uW3RdO3I8dGhpcy5jb2x1bW5zKzE7cisrKXNbcl09dGhpcy5kYXRhW3RdW3ItMV07dGhpcy5kYXRhW3RdPXN9cmV0dXJuIHRoaXMuY29sdW1ucys9MSx0aGlzfX1vZShfLEkpO2NsYXNzIG50IGV4dGVuZHMgX3tjb25zdHJ1Y3RvcihlKXtzdXBlcigpLHRoaXMuZGF0YT1lLHRoaXMucm93cz1lLmxlbmd0aCx0aGlzLmNvbHVtbnM9ZVswXS5sZW5ndGh9c2V0KGUsbix0KXtyZXR1cm4gdGhpcy5kYXRhW2VdW25dPXQsdGhpc31nZXQoZSxuKXtyZXR1cm4gdGhpcy5kYXRhW2VdW25dfX1jbGFzcyBSZXtjb25zdHJ1Y3RvcihlKXtlPW50LmNoZWNrTWF0cml4KGUpO2xldCBuPWUuY2xvbmUoKSx0PW4ucm93cyxzPW4uY29sdW1ucyxyPW5ldyBGbG9hdDY0QXJyYXkodCksaT0xLGgsbCx1LGYsZyxhLGosdyx5O2ZvcihoPTA7aDx0O2grKylyW2hdPWg7Zm9yKHc9bmV3IEZsb2F0NjRBcnJheSh0KSxsPTA7bDxzO2wrKyl7Zm9yKGg9MDtoPHQ7aCsrKXdbaF09bi5nZXQoaCxsKTtmb3IoaD0wO2g8dDtoKyspe2Zvcih5PU1hdGgubWluKGgsbCksZz0wLHU9MDt1PHk7dSsrKWcrPW4uZ2V0KGgsdSkqd1t1XTt3W2hdLT1nLG4uc2V0KGgsbCx3W2hdKX1mb3IoZj1sLGg9bCsxO2g8dDtoKyspTWF0aC5hYnMod1toXSk+TWF0aC5hYnMod1tmXSkmJihmPWgpO2lmKGYhPT1sKXtmb3IodT0wO3U8czt1KyspYT1uLmdldChmLHUpLG4uc2V0KGYsdSxuLmdldChsLHUpKSxuLnNldChsLHUsYSk7aj1yW2ZdLHJbZl09cltsXSxyW2xdPWosaT0taX1pZihsPHQmJm4uZ2V0KGwsbCkhPT0wKWZvcihoPWwrMTtoPHQ7aCsrKW4uc2V0KGgsbCxuLmdldChoLGwpL24uZ2V0KGwsbCkpfXRoaXMuTFU9bix0aGlzLnBpdm90VmVjdG9yPXIsdGhpcy5waXZvdFNpZ249aX1pc1Npbmd1bGFyKCl7bGV0IGU9dGhpcy5MVSxuPWUuY29sdW1ucztmb3IobGV0IHQ9MDt0PG47dCsrKWlmKGUuZ2V0KHQsdCk9PT0wKXJldHVybiEwO3JldHVybiExfXNvbHZlKGUpe2U9SS5jaGVja01hdHJpeChlKTtsZXQgbj10aGlzLkxVO2lmKG4ucm93cyE9PWUucm93cyl0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgbWF0cml4IGRpbWVuc2lvbnMiKTtpZih0aGlzLmlzU2luZ3VsYXIoKSl0aHJvdyBuZXcgRXJyb3IoIkxVIG1hdHJpeCBpcyBzaW5ndWxhciIpO2xldCBzPWUuY29sdW1ucyxyPWUuc3ViTWF0cml4Um93KHRoaXMucGl2b3RWZWN0b3IsMCxzLTEpLGk9bi5jb2x1bW5zLGgsbCx1O2Zvcih1PTA7dTxpO3UrKylmb3IoaD11KzE7aDxpO2grKylmb3IobD0wO2w8cztsKyspci5zZXQoaCxsLHIuZ2V0KGgsbCktci5nZXQodSxsKSpuLmdldChoLHUpKTtmb3IodT1pLTE7dT49MDt1LS0pe2ZvcihsPTA7bDxzO2wrKylyLnNldCh1LGwsci5nZXQodSxsKS9uLmdldCh1LHUpKTtmb3IoaD0wO2g8dTtoKyspZm9yKGw9MDtsPHM7bCsrKXIuc2V0KGgsbCxyLmdldChoLGwpLXIuZ2V0KHUsbCkqbi5nZXQoaCx1KSl9cmV0dXJuIHJ9Z2V0IGRldGVybWluYW50KCl7bGV0IGU9dGhpcy5MVTtpZighZS5pc1NxdWFyZSgpKXRocm93IG5ldyBFcnJvcigiTWF0cml4IG11c3QgYmUgc3F1YXJlIik7bGV0IG49dGhpcy5waXZvdFNpZ24sdD1lLmNvbHVtbnM7Zm9yKGxldCBzPTA7czx0O3MrKyluKj1lLmdldChzLHMpO3JldHVybiBufWdldCBsb3dlclRyaWFuZ3VsYXJNYXRyaXgoKXtsZXQgZT10aGlzLkxVLG49ZS5yb3dzLHQ9ZS5jb2x1bW5zLHM9bmV3IEkobix0KTtmb3IobGV0IHI9MDtyPG47cisrKWZvcihsZXQgaT0wO2k8dDtpKyspcj5pP3Muc2V0KHIsaSxlLmdldChyLGkpKTpyPT09aT9zLnNldChyLGksMSk6cy5zZXQocixpLDApO3JldHVybiBzfWdldCB1cHBlclRyaWFuZ3VsYXJNYXRyaXgoKXtsZXQgZT10aGlzLkxVLG49ZS5yb3dzLHQ9ZS5jb2x1bW5zLHM9bmV3IEkobix0KTtmb3IobGV0IHI9MDtyPG47cisrKWZvcihsZXQgaT0wO2k8dDtpKyspcjw9aT9zLnNldChyLGksZS5nZXQocixpKSk6cy5zZXQocixpLDApO3JldHVybiBzfWdldCBwaXZvdFBlcm11dGF0aW9uVmVjdG9yKCl7cmV0dXJuIEFycmF5LmZyb20odGhpcy5waXZvdFZlY3Rvcil9fWZ1bmN0aW9uIFoobyxlKXtsZXQgbj0wO3JldHVybiBNYXRoLmFicyhvKT5NYXRoLmFicyhlKT8obj1lL28sTWF0aC5hYnMobykqTWF0aC5zcXJ0KDErbipuKSk6ZSE9PTA/KG49by9lLE1hdGguYWJzKGUpKk1hdGguc3FydCgxK24qbikpOjB9Y2xhc3MgdmV7Y29uc3RydWN0b3IoZSl7ZT1udC5jaGVja01hdHJpeChlKTtsZXQgbj1lLmNsb25lKCksdD1lLnJvd3Mscz1lLmNvbHVtbnMscj1uZXcgRmxvYXQ2NEFycmF5KHMpLGksaCxsLHU7Zm9yKGw9MDtsPHM7bCsrKXtsZXQgZj0wO2ZvcihpPWw7aTx0O2krKylmPVooZixuLmdldChpLGwpKTtpZihmIT09MCl7Zm9yKG4uZ2V0KGwsbCk8MCYmKGY9LWYpLGk9bDtpPHQ7aSsrKW4uc2V0KGksbCxuLmdldChpLGwpL2YpO2ZvcihuLnNldChsLGwsbi5nZXQobCxsKSsxKSxoPWwrMTtoPHM7aCsrKXtmb3IodT0wLGk9bDtpPHQ7aSsrKXUrPW4uZ2V0KGksbCkqbi5nZXQoaSxoKTtmb3IodT0tdS9uLmdldChsLGwpLGk9bDtpPHQ7aSsrKW4uc2V0KGksaCxuLmdldChpLGgpK3Uqbi5nZXQoaSxsKSl9fXJbbF09LWZ9dGhpcy5RUj1uLHRoaXMuUmRpYWc9cn1zb2x2ZShlKXtlPUkuY2hlY2tNYXRyaXgoZSk7bGV0IG49dGhpcy5RUix0PW4ucm93cztpZihlLnJvd3MhPT10KXRocm93IG5ldyBFcnJvcigiTWF0cml4IHJvdyBkaW1lbnNpb25zIG11c3QgYWdyZWUiKTtpZighdGhpcy5pc0Z1bGxSYW5rKCkpdGhyb3cgbmV3IEVycm9yKCJNYXRyaXggaXMgcmFuayBkZWZpY2llbnQiKTtsZXQgcz1lLmNvbHVtbnMscj1lLmNsb25lKCksaT1uLmNvbHVtbnMsaCxsLHUsZjtmb3IodT0wO3U8aTt1KyspZm9yKGw9MDtsPHM7bCsrKXtmb3IoZj0wLGg9dTtoPHQ7aCsrKWYrPW4uZ2V0KGgsdSkqci5nZXQoaCxsKTtmb3IoZj0tZi9uLmdldCh1LHUpLGg9dTtoPHQ7aCsrKXIuc2V0KGgsbCxyLmdldChoLGwpK2Yqbi5nZXQoaCx1KSl9Zm9yKHU9aS0xO3U+PTA7dS0tKXtmb3IobD0wO2w8cztsKyspci5zZXQodSxsLHIuZ2V0KHUsbCkvdGhpcy5SZGlhZ1t1XSk7Zm9yKGg9MDtoPHU7aCsrKWZvcihsPTA7bDxzO2wrKylyLnNldChoLGwsci5nZXQoaCxsKS1yLmdldCh1LGwpKm4uZ2V0KGgsdSkpfXJldHVybiByLnN1Yk1hdHJpeCgwLGktMSwwLHMtMSl9aXNGdWxsUmFuaygpe2xldCBlPXRoaXMuUVIuY29sdW1ucztmb3IobGV0IG49MDtuPGU7bisrKWlmKHRoaXMuUmRpYWdbbl09PT0wKXJldHVybiExO3JldHVybiEwfWdldCB1cHBlclRyaWFuZ3VsYXJNYXRyaXgoKXtsZXQgZT10aGlzLlFSLG49ZS5jb2x1bW5zLHQ9bmV3IEkobixuKSxzLHI7Zm9yKHM9MDtzPG47cysrKWZvcihyPTA7cjxuO3IrKylzPHI/dC5zZXQocyxyLGUuZ2V0KHMscikpOnM9PT1yP3Quc2V0KHMscix0aGlzLlJkaWFnW3NdKTp0LnNldChzLHIsMCk7cmV0dXJuIHR9Z2V0IG9ydGhvZ29uYWxNYXRyaXgoKXtsZXQgZT10aGlzLlFSLG49ZS5yb3dzLHQ9ZS5jb2x1bW5zLHM9bmV3IEkobix0KSxyLGksaCxsO2ZvcihoPXQtMTtoPj0wO2gtLSl7Zm9yKHI9MDtyPG47cisrKXMuc2V0KHIsaCwwKTtmb3Iocy5zZXQoaCxoLDEpLGk9aDtpPHQ7aSsrKWlmKGUuZ2V0KGgsaCkhPT0wKXtmb3IobD0wLHI9aDtyPG47cisrKWwrPWUuZ2V0KHIsaCkqcy5nZXQocixpKTtmb3IobD0tbC9lLmdldChoLGgpLHI9aDtyPG47cisrKXMuc2V0KHIsaSxzLmdldChyLGkpK2wqZS5nZXQocixoKSl9fXJldHVybiBzfX1jbGFzcyBEdHtjb25zdHJ1Y3RvcihlLG49e30pe2lmKGU9bnQuY2hlY2tNYXRyaXgoZSksZS5pc0VtcHR5KCkpdGhyb3cgbmV3IEVycm9yKCJNYXRyaXggbXVzdCBiZSBub24tZW1wdHkiKTtsZXQgdD1lLnJvd3Mscz1lLmNvbHVtbnM7Y29uc3R7Y29tcHV0ZUxlZnRTaW5ndWxhclZlY3RvcnM6cj0hMCxjb21wdXRlUmlnaHRTaW5ndWxhclZlY3RvcnM6aT0hMCxhdXRvVHJhbnNwb3NlOmg9ITF9PW47bGV0IGw9Qm9vbGVhbihyKSx1PUJvb2xlYW4oaSksZj0hMSxnO2lmKHQ8cylpZighaClnPWUuY2xvbmUoKSxjb25zb2xlLndhcm4oIkNvbXB1dGluZyBTVkQgb24gYSBtYXRyaXggd2l0aCBtb3JlIGNvbHVtbnMgdGhhbiByb3dzLiBDb25zaWRlciBlbmFibGluZyBhdXRvVHJhbnNwb3NlIik7ZWxzZXtnPWUudHJhbnNwb3NlKCksdD1nLnJvd3Mscz1nLmNvbHVtbnMsZj0hMDtsZXQgYz1sO2w9dSx1PWN9ZWxzZSBnPWUuY2xvbmUoKTtsZXQgYT1NYXRoLm1pbih0LHMpLGo9TWF0aC5taW4odCsxLHMpLHc9bmV3IEZsb2F0NjRBcnJheShqKSx5PW5ldyBJKHQsYSksbT1uZXcgSShzLHMpLE09bmV3IEZsb2F0NjRBcnJheShzKSx6PW5ldyBGbG9hdDY0QXJyYXkodCksRT1uZXcgRmxvYXQ2NEFycmF5KGopO2ZvcihsZXQgYz0wO2M8ajtjKyspRVtjXT1jO2xldCBrPU1hdGgubWluKHQtMSxzKSxSPU1hdGgubWF4KDAsTWF0aC5taW4ocy0yLHQpKSxxPU1hdGgubWF4KGssUik7Zm9yKGxldCBjPTA7YzxxO2MrKyl7aWYoYzxrKXt3W2NdPTA7Zm9yKGxldCBwPWM7cDx0O3ArKyl3W2NdPVood1tjXSxnLmdldChwLGMpKTtpZih3W2NdIT09MCl7Zy5nZXQoYyxjKTwwJiYod1tjXT0td1tjXSk7Zm9yKGxldCBwPWM7cDx0O3ArKylnLnNldChwLGMsZy5nZXQocCxjKS93W2NdKTtnLnNldChjLGMsZy5nZXQoYyxjKSsxKX13W2NdPS13W2NdfWZvcihsZXQgcD1jKzE7cDxzO3ArKyl7aWYoYzxrJiZ3W2NdIT09MCl7bGV0IFM9MDtmb3IobGV0IGQ9YztkPHQ7ZCsrKVMrPWcuZ2V0KGQsYykqZy5nZXQoZCxwKTtTPS1TL2cuZ2V0KGMsYyk7Zm9yKGxldCBkPWM7ZDx0O2QrKylnLnNldChkLHAsZy5nZXQoZCxwKStTKmcuZ2V0KGQsYykpfU1bcF09Zy5nZXQoYyxwKX1pZihsJiZjPGspZm9yKGxldCBwPWM7cDx0O3ArKyl5LnNldChwLGMsZy5nZXQocCxjKSk7aWYoYzxSKXtNW2NdPTA7Zm9yKGxldCBwPWMrMTtwPHM7cCsrKU1bY109WihNW2NdLE1bcF0pO2lmKE1bY10hPT0wKXtNW2MrMV08MCYmKE1bY109MC1NW2NdKTtmb3IobGV0IHA9YysxO3A8cztwKyspTVtwXS89TVtjXTtNW2MrMV0rPTF9aWYoTVtjXT0tTVtjXSxjKzE8dCYmTVtjXSE9PTApe2ZvcihsZXQgcD1jKzE7cDx0O3ArKyl6W3BdPTA7Zm9yKGxldCBwPWMrMTtwPHQ7cCsrKWZvcihsZXQgUz1jKzE7UzxzO1MrKyl6W3BdKz1NW1NdKmcuZ2V0KHAsUyk7Zm9yKGxldCBwPWMrMTtwPHM7cCsrKXtsZXQgUz0tTVtwXS9NW2MrMV07Zm9yKGxldCBkPWMrMTtkPHQ7ZCsrKWcuc2V0KGQscCxnLmdldChkLHApK1MqeltkXSl9fWlmKHUpZm9yKGxldCBwPWMrMTtwPHM7cCsrKW0uc2V0KHAsYyxNW3BdKX19bGV0IGI9TWF0aC5taW4ocyx0KzEpO2lmKGs8cyYmKHdba109Zy5nZXQoayxrKSksdDxiJiYod1tiLTFdPTApLFIrMTxiJiYoTVtSXT1nLmdldChSLGItMSkpLE1bYi0xXT0wLGwpe2ZvcihsZXQgYz1rO2M8YTtjKyspe2ZvcihsZXQgcD0wO3A8dDtwKyspeS5zZXQocCxjLDApO3kuc2V0KGMsYywxKX1mb3IobGV0IGM9ay0xO2M+PTA7Yy0tKWlmKHdbY10hPT0wKXtmb3IobGV0IHA9YysxO3A8YTtwKyspe2xldCBTPTA7Zm9yKGxldCBkPWM7ZDx0O2QrKylTKz15LmdldChkLGMpKnkuZ2V0KGQscCk7Uz0tUy95LmdldChjLGMpO2ZvcihsZXQgZD1jO2Q8dDtkKyspeS5zZXQoZCxwLHkuZ2V0KGQscCkrUyp5LmdldChkLGMpKX1mb3IobGV0IHA9YztwPHQ7cCsrKXkuc2V0KHAsYywteS5nZXQocCxjKSk7eS5zZXQoYyxjLDEreS5nZXQoYyxjKSk7Zm9yKGxldCBwPTA7cDxjLTE7cCsrKXkuc2V0KHAsYywwKX1lbHNle2ZvcihsZXQgcD0wO3A8dDtwKyspeS5zZXQocCxjLDApO3kuc2V0KGMsYywxKX19aWYodSlmb3IobGV0IGM9cy0xO2M+PTA7Yy0tKXtpZihjPFImJk1bY10hPT0wKWZvcihsZXQgcD1jKzE7cDxzO3ArKyl7bGV0IFM9MDtmb3IobGV0IGQ9YysxO2Q8cztkKyspUys9bS5nZXQoZCxjKSptLmdldChkLHApO1M9LVMvbS5nZXQoYysxLGMpO2ZvcihsZXQgZD1jKzE7ZDxzO2QrKyltLnNldChkLHAsbS5nZXQoZCxwKStTKm0uZ2V0KGQsYykpfWZvcihsZXQgcD0wO3A8cztwKyspbS5zZXQocCxjLDApO20uc2V0KGMsYywxKX1sZXQgRj1iLTEsWD1OdW1iZXIuRVBTSUxPTjtmb3IoO2I+MDspe2xldCBjLHA7Zm9yKGM9Yi0yO2M+PS0xJiZjIT09LTE7Yy0tKXtjb25zdCBTPU51bWJlci5NSU5fVkFMVUUrWCpNYXRoLmFicyh3W2NdK01hdGguYWJzKHdbYysxXSkpO2lmKE1hdGguYWJzKE1bY10pPD1TfHxOdW1iZXIuaXNOYU4oTVtjXSkpe01bY109MDticmVha319aWYoYz09PWItMilwPTQ7ZWxzZXtsZXQgUztmb3IoUz1iLTE7Uz49YyYmUyE9PWM7Uy0tKXtsZXQgZD0oUyE9PWI/TWF0aC5hYnMoTVtTXSk6MCkrKFMhPT1jKzE/TWF0aC5hYnMoTVtTLTFdKTowKTtpZihNYXRoLmFicyh3W1NdKTw9WCpkKXt3W1NdPTA7YnJlYWt9fVM9PT1jP3A9MzpTPT09Yi0xP3A9MToocD0yLGM9Uyl9c3dpdGNoKGMrKyxwKXtjYXNlIDE6e2xldCBTPU1bYi0yXTtNW2ItMl09MDtmb3IobGV0IGQ9Yi0yO2Q+PWM7ZC0tKXtsZXQgUD1aKHdbZF0sUyksTz13W2RdL1AsVD1TL1A7aWYod1tkXT1QLGQhPT1jJiYoUz0tVCpNW2QtMV0sTVtkLTFdPU8qTVtkLTFdKSx1KWZvcihsZXQgRD0wO0Q8cztEKyspUD1PKm0uZ2V0KEQsZCkrVCptLmdldChELGItMSksbS5zZXQoRCxiLTEsLVQqbS5nZXQoRCxkKStPKm0uZ2V0KEQsYi0xKSksbS5zZXQoRCxkLFApfWJyZWFrfWNhc2UgMjp7bGV0IFM9TVtjLTFdO01bYy0xXT0wO2ZvcihsZXQgZD1jO2Q8YjtkKyspe2xldCBQPVood1tkXSxTKSxPPXdbZF0vUCxUPVMvUDtpZih3W2RdPVAsUz0tVCpNW2RdLE1bZF09TypNW2RdLGwpZm9yKGxldCBEPTA7RDx0O0QrKylQPU8qeS5nZXQoRCxkKStUKnkuZ2V0KEQsYy0xKSx5LnNldChELGMtMSwtVCp5LmdldChELGQpK08qeS5nZXQoRCxjLTEpKSx5LnNldChELGQsUCl9YnJlYWt9Y2FzZSAzOntjb25zdCBTPU1hdGgubWF4KE1hdGguYWJzKHdbYi0xXSksTWF0aC5hYnMod1tiLTJdKSxNYXRoLmFicyhNW2ItMl0pLE1hdGguYWJzKHdbY10pLE1hdGguYWJzKE1bY10pKSxkPXdbYi0xXS9TLFA9d1tiLTJdL1MsTz1NW2ItMl0vUyxUPXdbY10vUyxEPU1bY10vUyxZPSgoUCtkKSooUC1kKStPKk8pLzIsRz1kKk8qKGQqTyk7bGV0IHY9MDsoWSE9PTB8fEchPT0wKSYmKFk8MD92PTAtTWF0aC5zcXJ0KFkqWStHKTp2PU1hdGguc3FydChZKlkrRyksdj1HLyhZK3YpKTtsZXQgVj0oVCtkKSooVC1kKSt2LEo9VCpEO2ZvcihsZXQgTj1jO048Yi0xO04rKyl7bGV0IEI9WihWLEopO0I9PT0wJiYoQj1OdW1iZXIuTUlOX1ZBTFVFKTtsZXQgJD1WL0IsQz1KL0I7aWYoTiE9PWMmJihNW04tMV09QiksVj0kKndbTl0rQypNW05dLE1bTl09JCpNW05dLUMqd1tOXSxKPUMqd1tOKzFdLHdbTisxXT0kKndbTisxXSx1KWZvcihsZXQgVT0wO1U8cztVKyspQj0kKm0uZ2V0KFUsTikrQyptLmdldChVLE4rMSksbS5zZXQoVSxOKzEsLUMqbS5nZXQoVSxOKSskKm0uZ2V0KFUsTisxKSksbS5zZXQoVSxOLEIpO2lmKEI9WihWLEopLEI9PT0wJiYoQj1OdW1iZXIuTUlOX1ZBTFVFKSwkPVYvQixDPUovQix3W05dPUIsVj0kKk1bTl0rQyp3W04rMV0sd1tOKzFdPS1DKk1bTl0rJCp3W04rMV0sSj1DKk1bTisxXSxNW04rMV09JCpNW04rMV0sbCYmTjx0LTEpZm9yKGxldCBVPTA7VTx0O1UrKylCPSQqeS5nZXQoVSxOKStDKnkuZ2V0KFUsTisxKSx5LnNldChVLE4rMSwtQyp5LmdldChVLE4pKyQqeS5nZXQoVSxOKzEpKSx5LnNldChVLE4sQil9TVtiLTJdPVY7YnJlYWt9Y2FzZSA0OntpZih3W2NdPD0wJiYod1tjXT13W2NdPDA/LXdbY106MCx1KSlmb3IobGV0IFM9MDtTPD1GO1MrKyltLnNldChTLGMsLW0uZ2V0KFMsYykpO2Zvcig7YzxGJiYhKHdbY10+PXdbYysxXSk7KXtsZXQgUz13W2NdO2lmKHdbY109d1tjKzFdLHdbYysxXT1TLHUmJmM8cy0xKWZvcihsZXQgZD0wO2Q8cztkKyspUz1tLmdldChkLGMrMSksbS5zZXQoZCxjKzEsbS5nZXQoZCxjKSksbS5zZXQoZCxjLFMpO2lmKGwmJmM8dC0xKWZvcihsZXQgZD0wO2Q8dDtkKyspUz15LmdldChkLGMrMSkseS5zZXQoZCxjKzEseS5nZXQoZCxjKSkseS5zZXQoZCxjLFMpO2MrK31iLS07YnJlYWt9fX1pZihmKXtsZXQgYz1tO209eSx5PWN9dGhpcy5tPXQsdGhpcy5uPXMsdGhpcy5zPXcsdGhpcy5VPXksdGhpcy5WPW19c29sdmUoZSl7bGV0IG49ZSx0PXRoaXMudGhyZXNob2xkLHM9dGhpcy5zLmxlbmd0aCxyPUkuemVyb3MocyxzKTtmb3IobGV0IGE9MDthPHM7YSsrKU1hdGguYWJzKHRoaXMuc1thXSk8PXQ/ci5zZXQoYSxhLDApOnIuc2V0KGEsYSwxL3RoaXMuc1thXSk7bGV0IGk9dGhpcy5VLGg9dGhpcy5yaWdodFNpbmd1bGFyVmVjdG9ycyxsPWgubW11bChyKSx1PWgucm93cyxmPWkucm93cyxnPUkuemVyb3ModSxmKTtmb3IobGV0IGE9MDthPHU7YSsrKWZvcihsZXQgaj0wO2o8ZjtqKyspe2xldCB3PTA7Zm9yKGxldCB5PTA7eTxzO3krKyl3Kz1sLmdldChhLHkpKmkuZ2V0KGoseSk7Zy5zZXQoYSxqLHcpfXJldHVybiBnLm1tdWwobil9c29sdmVGb3JEaWFnb25hbChlKXtyZXR1cm4gdGhpcy5zb2x2ZShJLmRpYWcoZSkpfWludmVyc2UoKXtsZXQgZT10aGlzLlYsbj10aGlzLnRocmVzaG9sZCx0PWUucm93cyxzPWUuY29sdW1ucyxyPW5ldyBJKHQsdGhpcy5zLmxlbmd0aCk7Zm9yKGxldCBmPTA7Zjx0O2YrKylmb3IobGV0IGc9MDtnPHM7ZysrKU1hdGguYWJzKHRoaXMuc1tnXSk+biYmci5zZXQoZixnLGUuZ2V0KGYsZykvdGhpcy5zW2ddKTtsZXQgaT10aGlzLlUsaD1pLnJvd3MsbD1pLmNvbHVtbnMsdT1uZXcgSSh0LGgpO2ZvcihsZXQgZj0wO2Y8dDtmKyspZm9yKGxldCBnPTA7ZzxoO2crKyl7bGV0IGE9MDtmb3IobGV0IGo9MDtqPGw7aisrKWErPXIuZ2V0KGYsaikqaS5nZXQoZyxqKTt1LnNldChmLGcsYSl9cmV0dXJuIHV9Z2V0IGNvbmRpdGlvbigpe3JldHVybiB0aGlzLnNbMF0vdGhpcy5zW01hdGgubWluKHRoaXMubSx0aGlzLm4pLTFdfWdldCBub3JtMigpe3JldHVybiB0aGlzLnNbMF19Z2V0IHJhbmsoKXtsZXQgZT1NYXRoLm1heCh0aGlzLm0sdGhpcy5uKSp0aGlzLnNbMF0qTnVtYmVyLkVQU0lMT04sbj0wLHQ9dGhpcy5zO2ZvcihsZXQgcz0wLHI9dC5sZW5ndGg7czxyO3MrKyl0W3NdPmUmJm4rKztyZXR1cm4gbn1nZXQgZGlhZ29uYWwoKXtyZXR1cm4gQXJyYXkuZnJvbSh0aGlzLnMpfWdldCB0aHJlc2hvbGQoKXtyZXR1cm4gTnVtYmVyLkVQU0lMT04vMipNYXRoLm1heCh0aGlzLm0sdGhpcy5uKSp0aGlzLnNbMF19Z2V0IGxlZnRTaW5ndWxhclZlY3RvcnMoKXtyZXR1cm4gdGhpcy5VfWdldCByaWdodFNpbmd1bGFyVmVjdG9ycygpe3JldHVybiB0aGlzLlZ9Z2V0IGRpYWdvbmFsTWF0cml4KCl7cmV0dXJuIEkuZGlhZyh0aGlzLnMpfX1mdW5jdGlvbiBNdChvLGU9ITEpe3JldHVybiBvPW50LmNoZWNrTWF0cml4KG8pLGU/bmV3IER0KG8pLmludmVyc2UoKTpOZShvLEkuZXllKG8ucm93cykpfWZ1bmN0aW9uIE5lKG8sZSxuPSExKXtyZXR1cm4gbz1udC5jaGVja01hdHJpeChvKSxlPW50LmNoZWNrTWF0cml4KGUpLG4/bmV3IER0KG8pLnNvbHZlKGUpOm8uaXNTcXVhcmUoKT9uZXcgUmUobykuc29sdmUoZSk6bmV3IHZlKG8pLnNvbHZlKGUpfWNvbnN0IHFlPTEyMzQsX2U9KCk9Pih7c2VlZDpxZSxhcnJheVNodWZmbGUoZSl7Y29uc3R7YXJyOm4sc2FtcGxlU2l6ZTp0fT1lO2ZvcihsZXQgcz0wO3M8dDtzKyspe3RoaXMuc2VlZD0oMjE0MDEzKnRoaXMuc2VlZCsyNTMxMDExKSUtMjE0NzQ4MzY0ODtsZXQgcj10aGlzLnNlZWQ+PjE2JjMyNzY3O3I9ciVuLmxlbmd0aDtsZXQgaT1uW3NdO25bc109bltyXSxuW3JdPWl9fSxuZXh0SW50KGUpe3RoaXMuc2VlZD0oMjE0MDEzKnRoaXMuc2VlZCsyNTMxMDExKSUtMjE0NzQ4MzY0ODtsZXQgbj10aGlzLnNlZWQ+PjE2JjMyNzY3O3JldHVybiBuPW4lZSxufX0pLEs9KG8sZSxuKT0+KGVbMF0tb1swXSkqKG5bMV0tb1sxXSktKGVbMV0tb1sxXSkqKG5bMF0tb1swXSksemU9KG8sZSxuLHQscyxyLGksaCk9PiEoSyhvLGUsbik+MCE9SyhzLHIsaSk+MHx8SyhlLG4sdCk+MCE9SyhyLGksaCk+MHx8SyhuLHQsbyk+MCE9SyhpLGgscyk+MHx8Syh0LG8sZSk+MCE9SyhoLHMscik+MCksRmU9KG8sZSxuLHQscyxyKT0+SyhvLGUsbik+MD09Syh0LHMscik+MCxUZT1vPT57Y29uc3QgZT1vWzRdKm9bOF0tb1s1XSpvWzddLG49b1szXSpvWzhdLW9bNV0qb1s2XSx0PW9bM10qb1s3XS1vWzRdKm9bNl07cmV0dXJuIG9bMF0qZS1vWzFdKm4rb1syXSp0fSxQdD0obyxlKT0+e2NvbnN0IG49VGUobyk7aWYoTWF0aC5hYnMobik8PWUpcmV0dXJuIG51bGw7Y29uc3QgdD0xL247cmV0dXJuWyhvWzRdKm9bOF0tb1s1XSpvWzddKSp0LChvWzJdKm9bN10tb1sxXSpvWzhdKSp0LChvWzFdKm9bNV0tb1syXSpvWzRdKSp0LChvWzVdKm9bNl0tb1szXSpvWzhdKSp0LChvWzBdKm9bOF0tb1syXSpvWzZdKSp0LChvWzJdKm9bM10tb1swXSpvWzVdKSp0LChvWzNdKm9bN10tb1s0XSpvWzZdKSp0LChvWzFdKm9bNl0tb1swXSpvWzddKSp0LChvWzBdKm9bNF0tb1sxXSpvWzNdKSp0XX0sc3Q9KG8sZSk9Pntjb25zdCBuPWVbNl0qb1swXStlWzddKm9bMV0rZVs4XSx0PVtdO3JldHVybiB0WzBdPShlWzBdKm9bMF0rZVsxXSpvWzFdK2VbMl0pL24sdFsxXT0oZVszXSpvWzBdK2VbNF0qb1sxXStlWzVdKS9uLHR9LERlPShvLGUsbix0KT0+e2NvbnN0IHM9b3QoZSxvKSxyPW90KG4sbyksaT1vdCh0LG8pLGg9b3QoZSxuKSxsPW90KHQsbiksdT1tdChzLHIpLGY9bXQocixpKSxnPW10KHMsaSksYT1tdChoLGwpO3JldHVybiBNYXRoLm1pbihNYXRoLm1pbihNYXRoLm1pbih1LGYpLGcpLGEpfSxQZT0obyxlLG4sdCk9Pntjb25zdCBzPUsobyxlLG4pPD0wO3JldHVybiEoSyhlLG4sdCk8PTAhPT1zfHxLKG4sdCxvKTw9MCE9PXN8fEsodCxvLGUpPD0wIT09cyl9LG90PShvLGUpPT5bb1swXS1lWzBdLG9bMV0tZVsxXV0sbXQ9KG8sZSk9Pntjb25zdCBuPW9bMF0qZVsxXS1vWzFdKmVbMF07cmV0dXJuIE1hdGguYWJzKG4pKi41fSxYdD0obyxlKT0+e2NvbnN0e25vcm1Qb2ludHM6bixwYXJhbTp0fT1CdChvKSx7bm9ybVBvaW50czpzLHBhcmFtOnJ9PUJ0KGUpLGk9cy5sZW5ndGgsaD1bXSxsPVtdO2ZvcihsZXQgdT0wO3U8aTt1Kyspe2NvbnN0IGY9W25bdV1bMF0sblt1XVsxXSwxLDAsMCwwLC0oblt1XVswXSpzW3VdWzBdKSwtKG5bdV1bMV0qc1t1XVswXSldLGc9WzAsMCwwLG5bdV1bMF0sblt1XVsxXSwxLC0oblt1XVswXSpzW3VdWzFdKSwtKG5bdV1bMV0qc1t1XVsxXSldO2gucHVzaChmKSxoLnB1c2goZyksbC5wdXNoKFtzW3VdWzBdXSksbC5wdXNoKFtzW3VdWzFdXSl9dHJ5e2NvbnN0IHU9bmV3IEkoaCksZj1uZXcgSShsKSxnPXUudHJhbnNwb3NlKCksYT1nLm1tdWwodSksaj1nLm1tdWwoZikseT1NdChhKS5tbXVsKGopLnRvMURBcnJheSgpO3JldHVybiBYZSh5LHQscil9Y2F0Y2h7cmV0dXJuIG51bGx9fSxCdD1vPT57bGV0IGU9MCxuPTA7Zm9yKGxldCBsPTA7bDxvLmxlbmd0aDtsKyspZSs9b1tsXVswXSxuKz1vW2xdWzFdO2xldCB0PWUvby5sZW5ndGgscz1uL28ubGVuZ3RoLHI9MDtmb3IobGV0IGw9MDtsPG8ubGVuZ3RoO2wrKyl7Y29uc3QgdT1vW2xdWzBdLXQsZj1vW2xdWzFdLXM7cis9TWF0aC5zcXJ0KHUqdStmKmYpfWxldCBpPU1hdGguc3FydCgyKSpvLmxlbmd0aC9yO2NvbnN0IGg9W107Zm9yKGxldCBsPTA7bDxvLmxlbmd0aDtsKyspaC5wdXNoKFsob1tsXVswXS10KSppLChvW2xdWzFdLXMpKmldKTtyZXR1cm57bm9ybVBvaW50czpoLHBhcmFtOnttZWFuWDp0LG1lYW5ZOnMsczppfX19LFhlPShvLGUsbik9Pntjb25zdCB0PW4ucypuLm1lYW5YLHM9bi5zKm4ubWVhblkscj1bb1swXSt0Km9bNl0sb1sxXSt0Km9bN10sKG9bMF0rdCpvWzZdKSotZS5tZWFuWCsob1sxXSt0Km9bN10pKi1lLm1lYW5ZKyhvWzJdK3QpL2UucyxvWzNdK3Mqb1s2XSxvWzRdK3Mqb1s3XSwob1szXStzKm9bNl0pKi1lLm1lYW5YKyhvWzRdK3Mqb1s3XSkqLWUubWVhblkrKG9bNV0rcykvZS5zLG4ucypvWzZdLG4ucypvWzddLG4ucypvWzZdKi1lLm1lYW5YK24ucypvWzddKi1lLm1lYW5ZK24ucy9lLnNdO2ZvcihsZXQgaT0wO2k8OTtpKyspcltpXT1yW2ldL3JbOF07cmV0dXJuIHJ9LEJlPS4wMSxVZT0xMCxPZT0yMCxWZT0xMCxVdD1vPT57Y29uc3R7c3JjUG9pbnRzOmUsZHN0UG9pbnRzOm4sa2V5ZnJhbWU6dCxxdWlja01vZGU6c309byxyPVtbMCwwXSxbdC53aWR0aCwwXSxbdC53aWR0aCx0LmhlaWdodF0sWzAsdC5oZWlnaHRdXSxpPTQ7aWYoZS5sZW5ndGg8aSlyZXR1cm4gbnVsbDtjb25zdCBoPUJlLGw9MS8oaCpoKSx1PU1hdGgubWluKFVlLGUubGVuZ3RoKSxmPV9lKCksZz1bXTtmb3IobGV0IEU9MDtFPGUubGVuZ3RoO0UrKylnW0VdPUU7Zi5hcnJheVNodWZmbGUoe2FycjpnLHNhbXBsZVNpemU6Zy5sZW5ndGh9KTtjb25zdCBhPXM/VmU6T2Usaj1hKjI7bGV0IHc9MDtjb25zdCB5PVtdO2Zvcig7dzxqJiZ5Lmxlbmd0aDxhOyl7aWYodys9MSxmLmFycmF5U2h1ZmZsZSh7YXJyOmcsc2FtcGxlU2l6ZTppfSksIXplKGVbZ1swXV0sZVtnWzFdXSxlW2dbMl1dLGVbZ1szXV0sbltnWzBdXSxuW2dbMV1dLG5bZ1syXV0sbltnWzNdXSkpY29udGludWU7Y29uc3QgRT1YdChbZVtnWzBdXSxlW2dbMV1dLGVbZ1syXV0sZVtnWzNdXV0sW25bZ1swXV0sbltnWzFdXSxuW2dbMl1dLG5bZ1szXV1dKTtFIT09bnVsbCYmQ2Uoe0g6RSx0ZXN0UG9pbnRzOnJ9KSYmeS5wdXNoKEUpfWlmKHkubGVuZ3RoPT09MClyZXR1cm4gbnVsbDtjb25zdCBtPVtdO2ZvcihsZXQgRT0wO0U8eS5sZW5ndGg7RSsrKW0ucHVzaCh7SDp5W0VdLGNvc3Q6MH0pO2xldCBNPXU7Zm9yKGxldCBFPTA7RTxlLmxlbmd0aCYmbS5sZW5ndGg+MjtFKz1NKXtNPU1hdGgubWluKHUsZS5sZW5ndGgtRSk7bGV0IGs9RStNO2ZvcihsZXQgUj0wO1I8bS5sZW5ndGg7UisrKWZvcihsZXQgcT1FO3E8aztxKyspe2NvbnN0IGI9WWUoe0g6bVtSXS5ILHNyY1BvaW50OmVbcV0sZHN0UG9pbnQ6bltxXSxvbmVPdmVyU2NhbGUyOmx9KTttW1JdLmNvc3QrPWJ9bS5zb3J0KChSLHEpPT5SLmNvc3QtcS5jb3N0KSxtLnNwbGljZSgtTWF0aC5mbG9vcigobS5sZW5ndGgrMSkvMikpfWxldCB6PW51bGw7Zm9yKGxldCBFPTA7RTxtLmxlbmd0aDtFKyspe2NvbnN0IGs9TGUoe2luSDptW0VdLkh9KTtpZigkZSh7SDprLHRlc3RQb2ludHM6cixrZXlmcmFtZTp0fSkpe3o9azticmVha319cmV0dXJuIHp9LCRlPSh7SDpvLHRlc3RQb2ludHM6ZSxrZXlmcmFtZTpufSk9Pntjb25zdCB0PVB0KG8sMWUtNSk7aWYodD09PW51bGwpcmV0dXJuITE7Y29uc3Qgcz1bXTtmb3IobGV0IGk9MDtpPGUubGVuZ3RoO2krKylzLnB1c2goc3QoZVtpXSx0KSk7cmV0dXJuIShEZShzWzBdLHNbMV0sc1syXSxzWzNdKTxuLndpZHRoKm4uaGVpZ2h0KjFlLTR8fCFQZShzWzBdLHNbMV0sc1syXSxzWzNdKSl9LExlPSh7aW5IOm99KT0+e2NvbnN0IGU9MS9vWzhdLG49W107Zm9yKGxldCB0PTA7dDw4O3QrKyluW3RdPW9bdF0qZTtyZXR1cm4gbls4XT0xLG59LFllPSh7SDpvLHNyY1BvaW50OmUsZHN0UG9pbnQ6bixvbmVPdmVyU2NhbGUyOnR9KT0+e2NvbnN0IHM9c3QoZSxvKSxyPVtzWzBdLW5bMF0sc1sxXS1uWzFdXTtyZXR1cm4gTWF0aC5sb2coMSsoclswXSpyWzBdK3JbMV0qclsxXSkqdCl9LENlPSh7SDpvLHRlc3RQb2ludHM6ZX0pPT57Y29uc3Qgbj1bXTtmb3IobGV0IHQ9MDt0PGUubGVuZ3RoO3QrKyluW3RdPXN0KGVbdF0sbyk7Zm9yKGxldCB0PTA7dDxlLmxlbmd0aDt0Kyspe2NvbnN0IHM9dCxyPSh0KzEpJWUubGVuZ3RoLGk9KHQrMiklZS5sZW5ndGg7aWYoIUZlKGVbc10sZVtyXSxlW2ldLG5bc10sbltyXSxuW2ldKSlyZXR1cm4hMX1yZXR1cm4hMH0sT3Q9MyxWdD02LEhlPTgsJHQ9LjcsSmU9KHtrZXlmcmFtZTpvLHF1ZXJ5cG9pbnRzOmUscXVlcnl3aWR0aDpuLHF1ZXJ5aGVpZ2h0OnQsZGVidWdNb2RlOnN9KT0+e2xldCByPXt9O2NvbnN0IGk9W107Zm9yKGxldCBtPTA7bTxlLmxlbmd0aDttKyspe2NvbnN0IE09ZVttXSx6PU0ubWF4aW1hP28ubWF4aW1hUG9pbnRzOm8ubWluaW1hUG9pbnRzO2lmKHoubGVuZ3RoPT09MCljb250aW51ZTtjb25zdCBFPU0ubWF4aW1hP28ubWF4aW1hUG9pbnRzQ2x1c3Rlci5yb290Tm9kZTpvLm1pbmltYVBvaW50c0NsdXN0ZXIucm9vdE5vZGUsaz1bXSxSPW5ldyBHdChbXSwoWCxjKT0+WC5kLWMuZCk7RXQoe25vZGU6RSxrZXlwb2ludHM6eixxdWVyeXBvaW50Ok0scXVldWU6UixrZXlwb2ludEluZGV4ZXM6ayxudW1Qb3A6MH0pO2xldCBxPS0xLGI9TnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIsRj1OdW1iZXIuTUFYX1NBRkVfSU5URUdFUjtmb3IobGV0IFg9MDtYPGsubGVuZ3RoO1grKyl7Y29uc3QgYz16W2tbWF1dLHA9eXQoe3YxOmMuZGVzY3JpcHRvcnMsdjI6TS5kZXNjcmlwdG9yc30pO3A8Yj8oRj1iLGI9cCxxPWtbWF0pOnA8RiYmKEY9cCl9cSE9PS0xJiYoRj09PU51bWJlci5NQVhfU0FGRV9JTlRFR0VSfHwxKmIvRjwkdCkmJmkucHVzaCh7cXVlcnlwb2ludDpNLGtleXBvaW50OnpbcV19KX1pZihzJiYoci5tYXRjaGVzPWkpLGkubGVuZ3RoPFZ0KXJldHVybntkZWJ1Z0V4dHJhOnJ9O2NvbnN0IGg9TnQoe2tleXdpZHRoOm8ud2lkdGgsa2V5aGVpZ2h0Om8uaGVpZ2h0LHF1ZXJ5d2lkdGg6bixxdWVyeWhlaWdodDp0LG1hdGNoZXM6aX0pO3MmJihyLmhvdWdoTWF0Y2hlcz1oKTtjb25zdCBsPVV0KHtzcmNQb2ludHM6aC5tYXAobT0+W20ua2V5cG9pbnQueCxtLmtleXBvaW50LnldKSxkc3RQb2ludHM6aC5tYXAobT0+W20ucXVlcnlwb2ludC54LG0ucXVlcnlwb2ludC55XSksa2V5ZnJhbWU6b30pO2lmKGw9PT1udWxsKXJldHVybntkZWJ1Z0V4dHJhOnJ9O2NvbnN0IHU9THQoe0g6bCxtYXRjaGVzOmgsdGhyZXNob2xkOk90fSk7aWYocyYmKHIuaW5saWVyTWF0Y2hlcz11KSx1Lmxlbmd0aDxWdClyZXR1cm57ZGVidWdFeHRyYTpyfTtjb25zdCBmPVB0KGwsMWUtNSksZz0xMCoxMCxhPVtdO2ZvcihsZXQgbT0wO208ZS5sZW5ndGg7bSsrKXtjb25zdCBNPWVbbV0sej1zdChbTS54LE0ueV0sZik7bGV0IEU9LTEsaz1OdW1iZXIuTUFYX1NBRkVfSU5URUdFUixSPU51bWJlci5NQVhfU0FGRV9JTlRFR0VSO2NvbnN0IHE9TS5tYXhpbWE/by5tYXhpbWFQb2ludHM6by5taW5pbWFQb2ludHM7Zm9yKGxldCBiPTA7YjxxLmxlbmd0aDtiKyspe2NvbnN0IEY9cVtiXTtpZigoRi54LXpbMF0pKihGLngtelswXSkrKEYueS16WzFdKSooRi55LXpbMV0pPmcpY29udGludWU7Y29uc3QgYz15dCh7djE6Ri5kZXNjcmlwdG9ycyx2MjpNLmRlc2NyaXB0b3JzfSk7YzxrPyhSPWssaz1jLEU9Yik6YzxSJiYoUj1jKX1FIT09LTEmJihSPT09TnVtYmVyLk1BWF9TQUZFX0lOVEVHRVJ8fDEqay9SPCR0KSYmYS5wdXNoKHtxdWVyeXBvaW50Ok0sa2V5cG9pbnQ6cVtFXX0pfXMmJihyLm1hdGNoZXMyPWEpO2NvbnN0IGo9TnQoe2tleXdpZHRoOm8ud2lkdGgsa2V5aGVpZ2h0Om8uaGVpZ2h0LHF1ZXJ5d2lkdGg6bixxdWVyeWhlaWdodDp0LG1hdGNoZXM6YX0pO3MmJihyLmhvdWdoTWF0Y2hlczI9aik7Y29uc3Qgdz1VdCh7c3JjUG9pbnRzOmoubWFwKG09PlttLmtleXBvaW50LngsbS5rZXlwb2ludC55XSksZHN0UG9pbnRzOmoubWFwKG09PlttLnF1ZXJ5cG9pbnQueCxtLnF1ZXJ5cG9pbnQueV0pLGtleWZyYW1lOm99KTtpZih3PT09bnVsbClyZXR1cm57ZGVidWdFeHRyYTpyfTtjb25zdCB5PUx0KHtIOncsbWF0Y2hlczpqLHRocmVzaG9sZDpPdH0pO3JldHVybiBzJiYoci5pbmxpZXJNYXRjaGVzMj15KSx7SDp3LG1hdGNoZXM6eSxkZWJ1Z0V4dHJhOnJ9fSxFdD0oe25vZGU6byxrZXlwb2ludHM6ZSxxdWVyeXBvaW50Om4scXVldWU6dCxrZXlwb2ludEluZGV4ZXM6cyxudW1Qb3A6cn0pPT57aWYoby5sZWFmKXtmb3IobGV0IGw9MDtsPG8ucG9pbnRJbmRleGVzLmxlbmd0aDtsKyspcy5wdXNoKG8ucG9pbnRJbmRleGVzW2xdKTtyZXR1cm59Y29uc3QgaT1bXTtmb3IobGV0IGw9MDtsPG8uY2hpbGRyZW4ubGVuZ3RoO2wrKyl7Y29uc3QgZj1vLmNoaWxkcmVuW2xdLmNlbnRlclBvaW50SW5kZXgsZz15dCh7djE6ZVtmXS5kZXNjcmlwdG9ycyx2MjpuLmRlc2NyaXB0b3JzfSk7aS5wdXNoKGcpfWxldCBoPU51bWJlci5NQVhfU0FGRV9JTlRFR0VSO2ZvcihsZXQgbD0wO2w8by5jaGlsZHJlbi5sZW5ndGg7bCsrKWg9TWF0aC5taW4oaCxpW2xdKTtmb3IobGV0IGw9MDtsPG8uY2hpbGRyZW4ubGVuZ3RoO2wrKylpW2xdIT09aCYmdC5wdXNoKHtub2RlOm8uY2hpbGRyZW5bbF0sZDppW2xdfSk7Zm9yKGxldCBsPTA7bDxvLmNoaWxkcmVuLmxlbmd0aDtsKyspaVtsXT09PWgmJkV0KHtub2RlOm8uY2hpbGRyZW5bbF0sa2V5cG9pbnRzOmUscXVlcnlwb2ludDpuLHF1ZXVlOnQsa2V5cG9pbnRJbmRleGVzOnMsbnVtUG9wOnJ9KTtpZihyPEhlJiZ0Lmxlbmd0aD4wKXtjb25zdHtub2RlOmwsZDp1fT10LnBvcCgpO3IrPTEsRXQoe25vZGU6bCxrZXlwb2ludHM6ZSxxdWVyeXBvaW50Om4scXVldWU6dCxrZXlwb2ludEluZGV4ZXM6cyxudW1Qb3A6cn0pfX0sTHQ9bz0+e2NvbnN0e0g6ZSxtYXRjaGVzOm4sdGhyZXNob2xkOnR9PW8scz10KnQscj1bXTtmb3IobGV0IGk9MDtpPG4ubGVuZ3RoO2krKyl7Y29uc3QgaD1uW2ldLnF1ZXJ5cG9pbnQsbD1uW2ldLmtleXBvaW50LHU9c3QoW2wueCxsLnldLGUpOyh1WzBdLWgueCkqKHVbMF0taC54KSsodVsxXS1oLnkpKih1WzFdLWgueSk8PXMmJnIucHVzaChuW2ldKX1yZXR1cm4gcn07Y2xhc3MgS2V7Y29uc3RydWN0b3IoZSxuLHQ9ITEpe3RoaXMucXVlcnlXaWR0aD1lLHRoaXMucXVlcnlIZWlnaHQ9bix0aGlzLmRlYnVnTW9kZT10fW1hdGNoRGV0ZWN0aW9uKGUsbil7bGV0IHQ9e2ZyYW1lczpbXX0scz1udWxsO2ZvcihsZXQgbD0wO2w8ZS5sZW5ndGg7bCsrKXtjb25zdHtIOnUsbWF0Y2hlczpmLGRlYnVnRXh0cmE6Z309SmUoe2tleWZyYW1lOmVbbF0scXVlcnlwb2ludHM6bixxdWVyeXdpZHRoOnRoaXMucXVlcnlXaWR0aCxxdWVyeWhlaWdodDp0aGlzLnF1ZXJ5SGVpZ2h0LGRlYnVnTW9kZTp0aGlzLmRlYnVnTW9kZX0pO3QuZnJhbWVzLnB1c2goZyksdSYmKHM9PT1udWxsfHxzLm1hdGNoZXMubGVuZ3RoPGYubGVuZ3RoKSYmKHM9e2tleWZyYW1lSW5kZXg6bCxIOnUsbWF0Y2hlczpmfSl9aWYocz09PW51bGwpcmV0dXJue2tleWZyYW1lSW5kZXg6LTEsZGVidWdFeHRyYTp0fTtjb25zdCByPVtdLGk9W10saD1lW3Mua2V5ZnJhbWVJbmRleF07Zm9yKGxldCBsPTA7bDxzLm1hdGNoZXMubGVuZ3RoO2wrKyl7Y29uc3QgdT1zLm1hdGNoZXNbbF0ucXVlcnlwb2ludCxmPXMubWF0Y2hlc1tsXS5rZXlwb2ludDtyLnB1c2goe3g6dS54LHk6dS55fSksaS5wdXNoKHt4OihmLngrLjUpL2guc2NhbGUseTooZi55Ky41KS9oLnNjYWxlLHo6MH0pfXJldHVybntzY3JlZW5Db29yZHM6cix3b3JsZENvb3JkczppLGtleWZyYW1lSW5kZXg6cy5rZXlmcmFtZUluZGV4LGRlYnVnRXh0cmE6dH19fWNvbnN0IEdlPSh7c2NyZWVuQ29vcmRzOm8sd29ybGRDb29yZHM6ZSxwcm9qZWN0aW9uVHJhbnNmb3JtOm59KT0+e2NvbnN0IHQ9WHQoZS5tYXAobT0+W20ueCxtLnldKSxvLm1hcChtPT5bbS54LG0ueV0pKSxzPW5ldyBJKFtbdFswXSx0WzFdLHRbMl1dLFt0WzNdLHRbNF0sdFs1XV0sW3RbNl0sdFs3XSx0WzhdXV0pLHI9bmV3IEkobiksbD1NdChyKS5tbXVsKHMpLnRvMURBcnJheSgpLHU9TWF0aC5zcXJ0KGxbMF0qbFswXStsWzNdKmxbM10rbFs2XSpsWzZdKSxmPU1hdGguc3FydChsWzFdKmxbMV0rbFs0XSpsWzRdK2xbN10qbFs3XSksZz0odStmKS8yLGE9W107YVswXT1sWzBdL3UsYVszXT1sWzNdL3UsYVs2XT1sWzZdL3UsYVsxXT1sWzFdL2YsYVs0XT1sWzRdL2YsYVs3XT1sWzddL2YsYVsyXT1hWzNdKmFbN10tYVs2XSphWzRdLGFbNV09YVs2XSphWzFdLWFbMF0qYVs3XSxhWzhdPWFbMF0qYVs0XS1hWzFdKmFbM107Y29uc3Qgaj1NYXRoLnNxcnQoYVsyXSphWzJdK2FbNV0qYVs1XSthWzhdKmFbOF0pO2FbMl0vPWosYVs1XS89aixhWzhdLz1qO2NvbnN0IHc9W107cmV0dXJuIHdbMF09bFsyXS9nLHdbMV09bFs1XS9nLHdbMl09bFs4XS9nLFtbYVswXSxhWzFdLGFbMl0sd1swXV0sW2FbM10sYVs0XSxhWzVdLHdbMV1dLFthWzZdLGFbN10sYVs4XSx3WzJdXV19LFFlPShvLGUpPT5bW29bMF1bMF0qZVswXVswXStvWzBdWzJdKmVbMl1bMF0sb1swXVswXSplWzBdWzFdK29bMF1bMl0qZVsyXVsxXSxvWzBdWzBdKmVbMF1bMl0rb1swXVsyXSplWzJdWzJdLG9bMF1bMF0qZVswXVszXStvWzBdWzJdKmVbMl1bM11dLFtvWzFdWzFdKmVbMV1bMF0rb1sxXVsyXSplWzJdWzBdLG9bMV1bMV0qZVsxXVsxXStvWzFdWzJdKmVbMl1bMV0sb1sxXVsxXSplWzFdWzJdK29bMV1bMl0qZVsyXVsyXSxvWzFdWzFdKmVbMV1bM10rb1sxXVsyXSplWzJdWzNdXSxbZVsyXVswXSxlWzJdWzFdLGVbMl1bMl0sZVsyXVszXV1dLFl0PShvLGUsbix0KT0+e2NvbnN0IHM9b1swXVswXSplK29bMF1bMV0qbitvWzBdWzNdLHI9b1sxXVswXSplK29bMV1bMV0qbitvWzFdWzNdLGk9b1syXVswXSplK29bMl1bMV0qbitvWzJdWzNdO3JldHVybnt4OnMseTpyLHo6aX19LFdlPShvLGUsbix0KT0+e2NvbnN0e3g6cyx5OnIsejppfT1ZdChvLGUsbik7cmV0dXJue3g6cy9pLHk6ci9pfX0sWmU9NSx4ZT00LEN0PTEwLEFlPS4xLHRuPS45OTtsZXQgSD1bW10sW10sW11dLHg9W1tdLFtdXSxMPVtbXSxbXSxbXV07Y29uc3QgZW49KHtpbml0aWFsTW9kZWxWaWV3VHJhbnNmb3JtOm8scHJvamVjdGlvblRyYW5zZm9ybTplLHdvcmxkQ29vcmRzOm4sc2NyZWVuQ29vcmRzOnR9KT0+e2xldCBzPTAscj0wO2ZvcihsZXQgZz0wO2c8bi5sZW5ndGg7ZysrKXMrPW5bZ10ueCxyKz1uW2ddLnk7cy89bi5sZW5ndGgsci89bi5sZW5ndGg7Y29uc3QgaT1bXTtmb3IobGV0IGc9MDtnPG4ubGVuZ3RoO2crKylpLnB1c2goe3g6bltnXS54LXMseTpuW2ddLnktcix6Om5bZ10uen0pO2NvbnN0IGg9W1tdLFtdLFtdXTtmb3IobGV0IGc9MDtnPDM7ZysrKWZvcihsZXQgYT0wO2E8MzthKyspaFtnXVthXT1vW2ddW2FdO2hbMF1bM109b1swXVswXSpzK29bMF1bMV0qcitvWzBdWzNdLGhbMV1bM109b1sxXVswXSpzK29bMV1bMV0qcitvWzFdWzNdLGhbMl1bM109b1syXVswXSpzK29bMl1bMV0qcitvWzJdWzNdO2NvbnN0IGw9WzEsLjgsLjYsLjQsMF07bGV0IHU9aCxmPW51bGw7Zm9yKGxldCBnPTA7ZzxsLmxlbmd0aDtnKyspe2NvbnN0IGE9bm4oe2luaXRpYWxNb2RlbFZpZXdUcmFuc2Zvcm06dSxwcm9qZWN0aW9uVHJhbnNmb3JtOmUsd29ybGRDb29yZHM6aSxzY3JlZW5Db29yZHM6dCxpbmxpZXJQcm9iOmxbZ119KTtpZih1PWEubW9kZWxWaWV3VHJhbnNmb3JtLGEuZXJyPFplKXtmPXU7YnJlYWt9fXJldHVybiBmPT09bnVsbD9udWxsOihmWzBdWzNdPWZbMF1bM10tZlswXVswXSpzLWZbMF1bMV0qcixmWzFdWzNdPWZbMV1bM10tZlsxXVswXSpzLWZbMV1bMV0qcixmWzJdWzNdPWZbMl1bM10tZlsyXVswXSpzLWZbMl1bMV0qcixmKX0sbm49KHtpbml0aWFsTW9kZWxWaWV3VHJhbnNmb3JtOm8scHJvamVjdGlvblRyYW5zZm9ybTplLHdvcmxkQ29vcmRzOm4sc2NyZWVuQ29vcmRzOnQsaW5saWVyUHJvYjpzfSk9Pntjb25zdCByPXM8MTtsZXQgaT1vLGg9MCxsPTAsdT1uZXcgQXJyYXkobi5sZW5ndGgpLGY9bmV3IEFycmF5KG4ubGVuZ3RoKSxnPW5ldyBBcnJheShuLmxlbmd0aCksYT1uZXcgQXJyYXkobi5sZW5ndGgpO2ZvcihsZXQgaj0wO2o8PUN0O2orKyl7Y29uc3Qgdz1RZShlLGkpO2ZvcihsZXQgRT0wO0U8bi5sZW5ndGg7RSsrKXtjb25zdCBrPVdlKHcsbltFXS54LG5bRV0ueSxuW0VdLnopLFI9dFtFXS54LWsueCxxPXRbRV0ueS1rLnk7Z1tFXT1SLGFbRV09cSx1W0VdPVIqUitxKnF9bGV0IHk7aWYobD0wLHIpe2NvbnN0IEU9TWF0aC5tYXgoMyxNYXRoLmZsb29yKG4ubGVuZ3RoKnMpLTEpO2ZvcihsZXQgaz0wO2s8bi5sZW5ndGg7aysrKWZba109dVtrXTtmLnNvcnQoKGssUik9PmstUikseT1NYXRoLm1heChmW0VdKnhlLDE2KTtmb3IobGV0IGs9MDtrPG4ubGVuZ3RoO2srKylmW2tdPnk/bCs9eS82OmwrPXkvNiooMS0oMS1mW2tdL3kpKigxLWZba10veSkqKDEtZltrXS95KSl9ZWxzZSBmb3IobGV0IEU9MDtFPG4ubGVuZ3RoO0UrKylsKz11W0VdO2lmKGwvPW4ubGVuZ3RoLGw8QWV8fGo+MCYmbC9oPnRufHxqPT09Q3QpYnJlYWs7aD1sO2NvbnN0IG09W10sTT1bXTtmb3IobGV0IEU9MDtFPG4ubGVuZ3RoO0UrKyl7aWYociYmdVtFXT55KWNvbnRpbnVlO2NvbnN0IGs9cm4oe21vZGVsVmlld1Byb2plY3Rpb25UcmFuc2Zvcm06dyxtb2RlbFZpZXdUcmFuc2Zvcm06aSxwcm9qZWN0aW9uVHJhbnNmb3JtOmUsd29ybGRDb29yZDpuW0VdfSk7aWYocil7Y29uc3QgUj0oMS11W0VdL3kpKigxLXVbRV0veSk7Zm9yKGxldCBxPTA7cTwyO3ErKylmb3IobGV0IGI9MDtiPDY7YisrKWtbcV1bYl0qPVI7bS5wdXNoKFtnW0VdKlJdKSxtLnB1c2goW2FbRV0qUl0pfWVsc2UgbS5wdXNoKFtnW0VdXSksbS5wdXNoKFthW0VdXSk7Zm9yKGxldCBSPTA7UjxrLmxlbmd0aDtSKyspTS5wdXNoKGtbUl0pfWNvbnN0IHo9b24oe2RVOm0sSl9VX1M6TX0pO2lmKHo9PT1udWxsKWJyZWFrO2k9c24oe21vZGVsVmlld1RyYW5zZm9ybTppLGRTOnp9KX1yZXR1cm57bW9kZWxWaWV3VHJhbnNmb3JtOmksZXJyOmx9fSxzbj0oe21vZGVsVmlld1RyYW5zZm9ybTpvLGRTOmV9KT0+e2xldCBuPWVbMF0qZVswXStlWzFdKmVbMV0rZVsyXSplWzJdLHQscyxyO248MWUtNj8odD0xLHM9MCxyPTAsbj0wKToobj1NYXRoLnNxcnQobiksdD1lWzBdL24scz1lWzFdL24scj1lWzJdL24pO2NvbnN0IGk9TWF0aC5jb3MobiksaD1NYXRoLnNpbihuKSxsPTEtaTtIWzBdWzBdPXQqdCpsK2ksSFswXVsxXT10KnMqbC1yKmgsSFswXVsyXT10KnIqbCtzKmgsSFswXVszXT1lWzNdLEhbMV1bMF09cyp0KmwrcipoLEhbMV1bMV09cypzKmwraSxIWzFdWzJdPXMqcipsLXQqaCxIWzFdWzNdPWVbNF0sSFsyXVswXT1yKnQqbC1zKmgsSFsyXVsxXT1yKnMqbCt0KmgsSFsyXVsyXT1yKnIqbCtpLEhbMl1bM109ZVs1XTtjb25zdCB1PVtbXSxbXSxbXV07Zm9yKGxldCBmPTA7ZjwzO2YrKyl7Zm9yKGxldCBnPTA7Zzw0O2crKyl1W2ZdW2ddPW9bZl1bMF0qSFswXVtnXStvW2ZdWzFdKkhbMV1bZ10rb1tmXVsyXSpIWzJdW2ddO3VbZl1bM10rPW9bZl1bM119cmV0dXJuIHV9LG9uPSh7ZFU6byxKX1VfUzplfSk9Pntjb25zdCBuPW5ldyBJKGUpLHQ9bmV3IEkobykscz1uLnRyYW5zcG9zZSgpLHI9cy5tbXVsKG4pLGk9cy5tbXVsKHQpO2xldCBoO3RyeXtoPU10KHIpfWNhdGNoe3JldHVybiBudWxsfXJldHVybiBoLm1tdWwoaSkudG8xREFycmF5KCl9LHJuPSh7bW9kZWxWaWV3UHJvamVjdGlvblRyYW5zZm9ybTpvLG1vZGVsVmlld1RyYW5zZm9ybTplLHByb2plY3Rpb25UcmFuc2Zvcm06bix3b3JsZENvb3JkOnR9KT0+e2NvbnN0IHM9ZSx7eDpyLHk6aSx6Omh9PXQsbD1ZdChvLHIsaSksdT1sLnoqbC56O3hbMF1bMF09blswXVswXSpsLnovdSx4WzBdWzFdPW5bMF1bMV0qbC56L3UseFswXVsyXT0oblswXVsyXSpsLnotblsyXVsyXSpsLngpL3UseFsxXVswXT1uWzFdWzBdKmwuei91LHhbMV1bMV09blsxXVsxXSpsLnovdSx4WzFdWzJdPShuWzFdWzJdKmwuei1uWzJdWzJdKmwueSkvdSxMWzBdWzBdPXNbMF1bMl0qaSxMWzBdWzFdPS1zWzBdWzJdKnIsTFswXVsyXT1zWzBdWzFdKnItc1swXVswXSppLExbMF1bM109c1swXVswXSxMWzBdWzRdPXNbMF1bMV0sTFswXVs1XT1zWzBdWzJdLExbMV1bMF09c1sxXVsyXSppLExbMV1bMV09LXNbMV1bMl0qcixMWzFdWzJdPXNbMV1bMV0qci1zWzFdWzBdKmksTFsxXVszXT1zWzFdWzBdLExbMV1bNF09c1sxXVsxXSxMWzFdWzVdPXNbMV1bMl0sTFsyXVswXT1zWzJdWzJdKmksTFsyXVsxXT0tc1syXVsyXSpyLExbMl1bMl09c1syXVsxXSpyLXNbMl1bMF0qaSxMWzJdWzNdPXNbMl1bMF0sTFsyXVs0XT1zWzJdWzFdLExbMl1bNV09c1syXVsyXTtjb25zdCBmPVtbXSxbXV07Zm9yKGxldCBnPTA7ZzwyO2crKylmb3IobGV0IGE9MDthPDY7YSsrKXtmW2ddW2FdPTA7Zm9yKGxldCBqPTA7ajwzO2orKylmW2ddW2FdKz14W2ddW2pdKkxbal1bYV19cmV0dXJuIGZ9O2NsYXNzIGxue2NvbnN0cnVjdG9yKGUpe3RoaXMucHJvamVjdGlvblRyYW5zZm9ybT1lfWVzdGltYXRlKHtzY3JlZW5Db29yZHM6ZSx3b3JsZENvb3JkczpufSl7cmV0dXJuIEdlKHtzY3JlZW5Db29yZHM6ZSx3b3JsZENvb3JkczpuLHByb2plY3Rpb25UcmFuc2Zvcm06dGhpcy5wcm9qZWN0aW9uVHJhbnNmb3JtfSl9cmVmaW5lRXN0aW1hdGUoe2luaXRpYWxNb2RlbFZpZXdUcmFuc2Zvcm06ZSx3b3JsZENvb3JkczpuLHNjcmVlbkNvb3Jkczp0fSl7cmV0dXJuIGVuKHtpbml0aWFsTW9kZWxWaWV3VHJhbnNmb3JtOmUsd29ybGRDb29yZHM6bixzY3JlZW5Db29yZHM6dCxwcm9qZWN0aW9uVHJhbnNmb3JtOnRoaXMucHJvamVjdGlvblRyYW5zZm9ybX0pfX1sZXQgSHQ9bnVsbCxKdD0hMSxLdD1udWxsLFN0PW51bGw7b25tZXNzYWdlPW89Pntjb25zdHtkYXRhOmV9PW87c3dpdGNoKGUudHlwZSl7Y2FzZSJzZXR1cCI6ZS5wcm9qZWN0aW9uVHJhbnNmb3JtLEh0PWUubWF0Y2hpbmdEYXRhTGlzdCxKdD1lLmRlYnVnTW9kZSxLdD1uZXcgS2UoZS5pbnB1dFdpZHRoLGUuaW5wdXRIZWlnaHQsSnQpLFN0PW5ldyBsbihlLnByb2plY3Rpb25UcmFuc2Zvcm0pO2JyZWFrO2Nhc2UibWF0Y2giOmNvbnN0IG49ZS50YXJnZXRJbmRleGVzO2xldCB0PS0xLHM9bnVsbCxyPW51bGw7Zm9yKGxldCBmPTA7ZjxuLmxlbmd0aDtmKyspe2NvbnN0IGc9bltmXSx7a2V5ZnJhbWVJbmRleDphLHNjcmVlbkNvb3JkczpqLHdvcmxkQ29vcmRzOncsZGVidWdFeHRyYTp5fT1LdC5tYXRjaERldGVjdGlvbihIdFtnXSxlLmZlYXR1cmVQb2ludHMpO2lmKHI9eSxhIT09LTEpe2NvbnN0IG09U3QuZXN0aW1hdGUoe3NjcmVlbkNvb3JkczpqLHdvcmxkQ29vcmRzOnd9KTttJiYodD1nLHM9bSk7YnJlYWt9fXBvc3RNZXNzYWdlKHt0eXBlOiJtYXRjaERvbmUiLHRhcmdldEluZGV4OnQsbW9kZWxWaWV3VHJhbnNmb3JtOnMsZGVidWdFeHRyYTpyfSk7YnJlYWs7Y2FzZSJ0cmFja1VwZGF0ZSI6Y29uc3R7bW9kZWxWaWV3VHJhbnNmb3JtOmksd29ybGRDb29yZHM6aCxzY3JlZW5Db29yZHM6bH09ZSx1PVN0LnJlZmluZUVzdGltYXRlKHtpbml0aWFsTW9kZWxWaWV3VHJhbnNmb3JtOmksd29ybGRDb29yZHM6aCxzY3JlZW5Db29yZHM6bH0pO3Bvc3RNZXNzYWdlKHt0eXBlOiJ0cmFja1VwZGF0ZURvbmUiLG1vZGVsVmlld1RyYW5zZm9ybTp1fSk7YnJlYWs7Y2FzZSJkaXNwb3NlIjpjbG9zZSgpO2JyZWFrO2RlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIG1lc3NhZ2UgdHlwZSAnJHtlLnR5cGV9J2ApfX19KSgpOwo=",GZ=typeof window<"u"&&window.Blob&&new Blob([atob(FZ)],{type:"text/javascript;charset=utf-8"});function WZ(){var e=GZ&&(window.URL||window.webkitURL).createObjectURL(GZ);try{return e?new Worker(e):new Worker("data:application/javascript;base64,"+FZ)}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}for(var VZ=function(e,t,n,r){var a=function(e,t,n,r){return{x:e[0][0]*t+e[0][1]*n+e[0][3],y:e[1][0]*t+e[1][1]*n+e[1][3],z:e[2][0]*t+e[2][1]*n+e[2][3]}}(e,t,n),i=a.x,o=a.y,s=a.z;return{x:i/s,y:o/s}},UZ=1e3,XZ=function(){function e(t,n,r,a,i){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];T(this,e),this.markerDimensions=t,this.trackingDataList=n,this.projectionTransform=r,this.debugMode=o,this.trackingKeyframeList=[];for(var s=0;s<n.length;s++)this.trackingKeyframeList.push(n[s][1]);for(var u=0,c=0;c<this.trackingKeyframeList.length;c++)u=Math.max(u,this.trackingKeyframeList[c].points.length);this.featurePointsListT=[],this.imagePixelsListT=[],this.imagePropertiesListT=[];for(var l=0;l<this.trackingKeyframeList.length;l++){var d=this._prebuild(this.trackingKeyframeList[l],u),h=d.featurePoints,p=d.imagePixels,f=d.imageProperties;this.featurePointsListT[l]=h,this.imagePixelsListT[l]=p,this.imagePropertiesListT[l]=f}this.kernelCaches={}}return E(e,[{key:"dummyRun",value:function(e){for(var t=[[1,1,1,1],[1,1,1,1],[1,1,1,1]],n=0;n<this.featurePointsListT.length;n++)this.track(e,t,n)}},{key:"track",value:function(e,t,n){var r={},a=function(e,t){return[[e[0][0]*t[0][0]+e[0][2]*t[2][0],e[0][0]*t[0][1]+e[0][2]*t[2][1],e[0][0]*t[0][2]+e[0][2]*t[2][2],e[0][0]*t[0][3]+e[0][2]*t[2][3]],[e[1][1]*t[1][0]+e[1][2]*t[2][0],e[1][1]*t[1][1]+e[1][2]*t[2][1],e[1][1]*t[1][2]+e[1][2]*t[2][2],e[1][1]*t[1][3]+e[1][2]*t[2][3]],[t[2][0],t[2][1],t[2][2],t[2][3]]]}(this.projectionTransform,t),i=this._buildAdjustedModelViewTransform(a);this.markerDimensions[n][0],this.markerDimensions[n][1],this.trackingKeyframeList[n].width,this.trackingKeyframeList[n].height;for(var o=this.featurePointsListT[n],s=this.imagePixelsListT[n],u=this.imagePropertiesListT[n],c=this._computeProjection(i,e,n),l=this._computeMatching(o,s,u,c),d=l.matchingPointsT,h=l.simT,p=d.arraySync(),f=h.arraySync(),m=this.trackingKeyframeList[n],v=[],g=[],y=[],b=0;b<p.length;b++)if(f[b]>.8&&b<m.points.length){y.push(b);var x=VZ(a,p[b][0],p[b][1]);g.push(x),v.push({x:m.points[b].x/m.scale,y:m.points[b].y/m.scale,z:0})}return this.debugMode&&(r={projectedImage:c.arraySync(),matchingPoints:d.arraySync(),goodTrack:y,trackedPoints:g}),i.dispose(),c.dispose(),d.dispose(),h.dispose(),{worldCoords:v,screenCoords:g,debugExtra:r}}},{key:"_computeMatching",value:function(e,t,n,r){var a=this,i=21,o=r.shape[0],s=r.shape[1],u=e.shape[0];if(!this.kernelCaches.computeMatching){var c={variableNames:["features","markerPixels","markerProperties","targetPixels"],outputShape:[u,441],userCode:"\n\t  void main() {\n\t    ivec2 coords = getOutputCoords();\n\n\t    int featureIndex = coords[0];\n\t    int searchOffsetIndex = coords[1];\n\n\t    int markerWidth = int(getMarkerProperties(0));\n\t    int markerHeight = int(getMarkerProperties(1));\n\t    float markerScale = getMarkerProperties(2);\n\n\t    int searchOffsetX = imod(searchOffsetIndex, ".concat(i,") * ").concat(1,";\n\t    int searchOffsetY = searchOffsetIndex / ").concat(i," * ").concat(1,";\n\n\t    int sCenterX = int(getFeatures(featureIndex, 0) * markerScale);\n\t    int sCenterY = int(getFeatures(featureIndex, 1) * markerScale);\n\n\t    int sx = sCenterX + searchOffsetX - ").concat(10,";\n\t    int sy = sCenterY + searchOffsetY - ").concat(10,";\n\n\t    if (sx < ").concat(6," || sx >= (").concat(s," - ").concat(6,") || sy < ").concat(6," || sy >= (").concat(o," - ").concat(6,")) {\n\t      setOutput(-2.);\n\t    } \n\t    else {\n\t      float sumPoint = 0.;\n\t      float sumPointSquare = 0.;\n\t      float sumTemplate = 0.;\n\t      float sumTemplateSquare = 0.;\n\t      float sumPointTemplate = 0.;\n\n\t      for (int templateOffsetY = 0; templateOffsetY < ").concat(13,"; templateOffsetY++) {\n\t\tfor (int templateOffsetX = 0; templateOffsetX < ").concat(13,"; templateOffsetX++) {\n\t\t  int fx2 = sCenterX + templateOffsetX - ").concat(6,";\n\t\t  int fy2 = sCenterY + templateOffsetY - ").concat(6,";\n\n\t\t  int sx2 = sx + templateOffsetX - ").concat(6,";\n\t\t  int sy2 = sy + templateOffsetY - ").concat(6,";\n\n\t\t  int markerPixelIndex = fy2 * markerWidth + fx2;\n\t\t  float markerPixel = getMarkerPixels(markerPixelIndex);\n\t\t  float targetPixel = getTargetPixels(sy2, sx2);\n\n\t\t  sumTemplate += markerPixel;\n\t\t  sumTemplateSquare += markerPixel * markerPixel;\n\t\t  sumPoint += targetPixel;\n\t\t  sumPointSquare += targetPixel * targetPixel;\n\t\t  sumPointTemplate += targetPixel * markerPixel;\n\t\t}\n\t      }\n\n\t      // Normalized cross-correlation\n\t      // !important divide first avoid overflow (e.g. sumPoint / count * sumPoint)\n\t      float count = float(").concat(13," * ").concat(13,");\n\t      float pointVariance = sqrt(sumPointSquare - sumPoint / count * sumPoint);\n\t      float templateVariance = sqrt(sumTemplateSquare - sumTemplate / count * sumTemplate);\n\n\t      if (pointVariance < 0.0000001) {\n\t\tsetOutput(-3.);\n\t      } else if (templateVariance < 0.0000001) {\n\t\t//setOutput(sumTemplate);\n\t\tsetOutput(-4.);\n\t      } else {\n\t\tsumPointTemplate -= sumPoint / count * sumTemplate;\n\t\tfloat sim = sumPointTemplate / pointVariance / templateVariance;  \n\t\tsetOutput(sim);\n\t      }\n\t    }\n\t  }\n\t")},l={variableNames:["featurePoints","markerProperties","maxIndex"],outputShape:[u,2],userCode:"\n\t  void main() {\n\t    ivec2 coords = getOutputCoords();\n\n\t    float markerScale = getMarkerProperties(2);\n\n\t    int featureIndex = coords[0];\n\n\t    int maxIndex = int(getMaxIndex(featureIndex));\n\t    int searchLocationIndex = maxIndex / ".concat(441,";\n\t    int searchOffsetIndex = imod(maxIndex, ").concat(441,");\n\n\t    if (coords[1] == 0) {\n\t      int searchOffsetX = imod(searchOffsetIndex, ").concat(i,") * ").concat(1,";\n\t      setOutput(getFeaturePoints(featureIndex, 0) + float(searchOffsetX - ").concat(10,") / markerScale);\n\t    }\n\t    else if (coords[1] == 1) {\n\t      int searchOffsetY = searchOffsetIndex / ").concat(i," * ").concat(1,";\n\t      setOutput(getFeaturePoints(featureIndex, 1) + float(searchOffsetY - ").concat(10,") / markerScale);\n\t    }\n\t  }\n\t")},d={variableNames:["sims","maxIndex"],outputShape:[u],userCode:"\n\t  void main() {\n\t    int featureIndex = getOutputCoords();\n\t    int maxIndex = int(getMaxIndex(featureIndex));\n\t    setOutput(getSims(featureIndex, maxIndex));\n\t  }\n\t"};this.kernelCaches.computeMatching=[c,l,d]}return Rf((function(){var i=a.kernelCaches.computeMatching,o=a._compileAndRun(i[0],[e,t,n,r]),s=o.argMax(1);return{matchingPointsT:a._compileAndRun(i[1],[e,n,s]),simT:a._compileAndRun(i[2],[o,s])}}))}},{key:"_computeProjection",value:function(e,t,n){var r=this,a=this.trackingKeyframeList[n].width,i=this.trackingKeyframeList[n].height,o=this.trackingKeyframeList[n].scale,s=a+"-"+i+"-"+o;if(this.kernelCaches.computeProjection||(this.kernelCaches.computeProjection={}),!this.kernelCaches.computeProjection[s]){var u={variableNames:["M","pixel"],outputShape:[i,a],userCode:"\n\t  void main() {\n\t      ivec2 coords = getOutputCoords();\n\n\t      float m00 = getM(0, 0) * ".concat(UZ,".;\n\t      float m01 = getM(0, 1) * ").concat(UZ,".;\n\t      float m03 = getM(0, 3) * ").concat(UZ,".;\n\t      float m10 = getM(1, 0) * ").concat(UZ,".;\n\t      float m11 = getM(1, 1) * ").concat(UZ,".;\n\t      float m13 = getM(1, 3) * ").concat(UZ,".;\n\t      float m20 = getM(2, 0) * ").concat(UZ,".;\n\t      float m21 = getM(2, 1) * ").concat(UZ,".;\n\t      float m23 = getM(2, 3) * ").concat(UZ,".;\n\n\t      float y = float(coords[0]) / float(").concat(o,");\n\t      float x = float(coords[1]) / float(").concat(o,");\n\t      float uz = (x * m20) + (y * m21) + m23;\n\t      float oneOverUz = 1. / uz;\n\n\t      float ux = (x * m00) + (y * m01) + m03;\n\t      float uy = (x * m10) + (y * m11) + m13;\n\n\t      ux = floor(ux * oneOverUz + 0.5);\n\t      uy = floor(uy * oneOverUz + 0.5);\n\t      setOutput(getPixel(int(uy), int(ux)));\n\t    }\n\t")};this.kernelCaches.computeProjection[s]=u}return Rf((function(){var n=r.kernelCaches.computeProjection[s];return r._compileAndRun(n,[e,t])}))}},{key:"_buildAdjustedModelViewTransform",value:function(e){return Rf((function(){for(var t=[],n=0;n<e.length;n++){t.push([]);for(var r=0;r<e[n].length;r++)t[n].push(e[n][r]/UZ)}return ip(t,[3,4])}))}},{key:"_prebuild",value:function(e,t){return Rf((function(){for(var n=e.scale,r=[],a=0;a<t;a++)a<e.points.length?r.push([e.points[a].x/n,e.points[a].y/n]):r.push([-1,-1]);var i=ip(e.data,[e.width*e.height]),o=ip([e.width,e.height,e.scale],[3]);return{featurePoints:ip(r,[r.length,2],"float32"),imagePixels:i,imageProperties:o}}))}},{key:"_compileAndRun",value:function(e,t){var n=Df().compileAndRun(e,t);return Mf().makeTensorFromDataId(n.dataId,n.shape,n.dtype)}}]),e}(),BZ=[{sigma:.55,points:[[-1,0],[-.5,-.866025],[.5,-.866025],[1,-0],[.5,.866025],[-.5,.866025]]},{sigma:.475,points:[[0,.930969],[-.806243,.465485],[-.806243,-.465485],[-0,-.930969],[.806243,-.465485],[.806243,.465485]]},{sigma:.4,points:[[.847306,-0],[.423653,.733789],[-.423653,.733789],[-.847306,0],[-.423653,-.733789],[.423653,-.733789]]},{sigma:.325,points:[[-0,-.741094],[.641806,-.370547],[.641806,.370547],[0,.741094],[-.641806,.370547],[-.641806,-.370547]]},{sigma:.25,points:[[-.595502,0],[-.297751,-.51572],[.297751,-.51572],[.595502,-0],[.297751,.51572],[-.297751,.51572]]},{sigma:.175,points:[[0,.362783],[-.314179,.181391],[-.314179,-.181391],[-0,-.362783],[.314179,-.181391],[.314179,.181391]]},{sigma:.1,points:[[0,0]]}],HZ=[],ZZ=0;ZZ<BZ.length;ZZ++)for(var KZ=BZ[ZZ].sigma,jZ=0;jZ<BZ[ZZ].points.length;jZ++){var YZ=BZ[ZZ].points[jZ];HZ.push([KZ,YZ[0],YZ[1]])}var QZ={};var JZ={kernelName:"BinomialFilter",backendName:"webgl",kernelFunc:function(e){var t=e.inputs.image,n=e.backend,r=function(e){var t=e.shape[1],n=e.shape[0],r="w"+t+"h"+n;if(!QZ.hasOwnProperty(r)){var a={variableNames:["p"],outputShape:[n,t],userCode:"\n        void main() {\n          ivec2 coords = getOutputCoords();\n\n          float sum = getP(coords[0], coords[1]-2);\n          sum += getP(coords[0], coords[1]-1) * 4.;\n          sum += getP(coords[0], coords[1]) * 6.;\n          sum += getP(coords[0], coords[1]+1) * 4.;\n          sum += getP(coords[0], coords[1]+2);\n          setOutput(sum);\n        }\n      "},i={variableNames:["p"],outputShape:[n,t],userCode:"\n        void main() {\n          ivec2 coords = getOutputCoords();\n\n          float sum = getP(coords[0]-2, coords[1]);\n          sum += getP(coords[0]-1, coords[1]) * 4.;\n          sum += getP(coords[0], coords[1]) * 6.;\n          sum += getP(coords[0]+1, coords[1]) * 4.;\n          sum += getP(coords[0]+2, coords[1]);\n          sum /= 256.;\n          setOutput(sum);\n        }\n      "};QZ[r]=[a,i]}return QZ[r]}(t),a=i(r,2),o=a[0],s=a[1],u=n.runWebGLProgram(o,[t],t.dtype),c=n.runWebGLProgram(s,[u],t.dtype);return n.disposeIntermediateTensorInfo(u),c}},qZ={};var $Z={kernelName:"BuildExtremas",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=t.image0,r=t.image1,a=t.image2,i=e.backend,o=function(e){var t=e.shape[1],n=e.shape[0],r="w"+t+"h"+n;if(!qZ.hasOwnProperty(r)){var a={variableNames:["image0","image1","image2"],outputShape:[n,t],userCode:"\n        void main() {\n          ivec2 coords = getOutputCoords();\n    \n          int y = coords[0];\n          int x = coords[1];\n    \n          float value = getImage1(y, x);\n    \n          // Step 1: find local maxima/minima\n          if (value * value < ".concat(9,".) {\n            setOutput(0.);\n            return;\n          }\n          if (y < ").concat(7," || y > ").concat(n-1-7,") {\n            setOutput(0.);\n            return;\n          }\n          if (x < ").concat(7," || x > ").concat(t-1-7,") {\n            setOutput(0.);\n            return;\n          }\n    \n          bool isMax = true;\n          bool isMin = true;\n          for (int dy = -1; dy <= 1; dy++) {\n            for (int dx = -1; dx <= 1; dx++) {\n              float value0 = getImage0(y+dy, x+dx);\n              float value1 = getImage1(y+dy, x+dx);\n              float value2 = getImage2(y+dy, x+dx);\n    \n        if (value < value0 || value < value1 || value < value2) {\n          isMax = false;\n        }\n        if (value > value0 || value > value1 || value > value2) {\n          isMin = false;\n        }\n            }\n          }\n    \n          if (!isMax && !isMin) {\n            setOutput(0.);\n            return;\n          }\n    \n          // compute edge score and reject based on threshold\n          float dxx = getImage1(y, x+1) + getImage1(y, x-1) - 2. * getImage1(y, x);\n          float dyy = getImage1(y+1, x) + getImage1(y-1, x) - 2. * getImage1(y, x);\n          float dxy = 0.25 * (getImage1(y-1,x-1) + getImage1(y+1,x+1) - getImage1(y-1,x+1) - getImage1(y+1,x-1));\n    \n          float det = (dxx * dyy) - (dxy * dxy);\n    \n          if (abs(det) < 0.0001) { // determinant undefined. no solution\n            setOutput(0.);\n            return;\n          }\n    \n          float edgeScore = (dxx + dyy) * (dxx + dyy) / det;\n    \n          if (abs(edgeScore) >= ").concat(6.25," ) {\n            setOutput(0.);\n            return;\n          }\n          setOutput(getImage1(y,x));\n        }\n      ")};qZ[r]=a}return qZ[r]}(r);return n=Mf().runKernel("DownsampleBilinear",{image:n}),a=Mf().runKernel("UpsampleBilinear",{image:a,targetImage:r}),i.runWebGLProgram(o,[n,r,a],r.dtype)}},eK={};var tK={kernelName:"ComputeExtremaAngles",backendName:"webgl",kernelFunc:function(e){var t=e.inputs.histograms,n=e.backend,r=function(e){var t=e.shape[0];if(!eK.hasOwnProperty(t)){var n={variableNames:["histogram"],outputShape:[e.shape[0]],userCode:"\n            void main() {\n                int featureIndex = getOutputCoords();\n\n                int maxIndex = 0;\n                for (int i = 1; i < ".concat(36,"; i++) {\n                    if (getHistogram(featureIndex, i) > getHistogram(featureIndex, maxIndex)) {\n                        maxIndex = i;\n                    }\n                }\n\n                int prev = imod(maxIndex - 1 + ").concat(36,", ").concat(36,");\n                int next = imod(maxIndex + 1, ").concat(36,");\n\n                /**\n                 * Fit a quatratic to 3 points. The system of equations is:\n                 *\n                 * y0 = A*x0^2 + B*x0 + C\n                 * y1 = A*x1^2 + B*x1 + C\n                 * y2 = A*x2^2 + B*x2 + C\n                 *\n                 * This system of equations is solved for A,B,C.\n                 */\n                float p10 = float(maxIndex - 1);\n                float p11 = getHistogram(featureIndex, prev); \n                float p20 = float(maxIndex);\n                float p21 = getHistogram(featureIndex, maxIndex); \n                float p30 = float(maxIndex + 1);\n                float p31 = getHistogram(featureIndex, next); \n\n                float d1 = (p30-p20)*(p30-p10);\n                float d2 = (p10-p20)*(p30-p10);\n                float d3 = p10-p20;\n\n                // If any of the denominators are zero then, just use maxIndex.\n                    float fbin = float(maxIndex);\n                if ( abs(d1) > 0.00001 && abs(d2) > 0.00001 && abs(d3) > 0.00001) {\n                float a = p10*p10;\n                float b = p20*p20;\n\n                // Solve for the coefficients A,B,C\n                float A = ((p31-p21)/d1)-((p11-p21)/d2);\n                float B = ((p11-p21)+(A*(b-a)))/d3;\n                float C = p11-(A*a)-(B*p10);\n                fbin = -B / (2. * A);\n                }\n\n                float an = 2.0 *").concat(Math.PI," * (fbin + 0.5) / ").concat(36,". - ").concat(Math.PI,";\n                setOutput(an);\n            }\n            ")};eK[t]=n}return eK[t]}(t);return n.runWebGLProgram(r,[t],t.dtype)}},nK={};var rK={kernelName:"ComputeExtremaFreak",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=t.gaussianImagesT,r=t.prunedExtremas,a=t.prunedExtremasAngles,i=t.freakPointsT,o=t.pyramidImagesLength,s=e.backend,u=function(e,t){var n="".concat(e,"|").concat(t.shape[0]);if(!nK.hasOwnProperty(n)){for(var r=[],a=1;a<e;a++)r.push("image"+a);for(var i="float getPixel(int octave, int y, int x) {",o=1;o<e;o++)i+="\n  if (octave == ".concat(o,") {\n\treturn getImage").concat(o,"(y, x);\n  }\n");i+="}";var s={variableNames:[].concat(r,["extrema","angles","freakPoints"]),outputShape:[t.shape[0],HZ.length],userCode:"\n  ".concat(i,"\n  void main() {\n\tivec2 coords = getOutputCoords();\n\tint featureIndex = coords[0];\n\tint freakIndex = coords[1];\n\n\tfloat freakSigma = getFreakPoints(freakIndex, 0);\n\tfloat freakX = getFreakPoints(freakIndex, 1);\n\tfloat freakY = getFreakPoints(freakIndex, 2);\n\n\tint octave = int(getExtrema(featureIndex, 1));\n\tfloat inputY = getExtrema(featureIndex, 2);\n\tfloat inputX = getExtrema(featureIndex, 3);\n\tfloat inputAngle = getAngles(featureIndex);\n\tfloat cos = ").concat(7,". * cos(inputAngle);\n\tfloat sin = ").concat(7,". * sin(inputAngle);\n\n\tfloat yp = inputY + freakX * sin + freakY * cos;\n\tfloat xp = inputX + freakX * cos + freakY * -sin;\n\n\tint x0 = int(floor(xp));\n\tint x1 = x0 + 1;\n\tint y0 = int(floor(yp));\n\tint y1 = y0 + 1;\n\n\tfloat f1 = getPixel(octave, y0, x0);\n\tfloat f2 = getPixel(octave, y0, x1);\n\tfloat f3 = getPixel(octave, y1, x0);\n\tfloat f4 = getPixel(octave, y1, x1);\n\n\tfloat x1f = float(x1);\n\tfloat y1f = float(y1);\n\tfloat x0f = float(x0);\n\tfloat y0f = float(y0);\n\n\t// ratio for interpolation between four neighbouring points\n\tfloat value = (x1f - xp) * (y1f - yp) * f1\n\t\t+ (xp - x0f) * (y1f - yp) * f2\n\t\t+ (x1f - xp) * (yp - y0f) * f3\n\t\t+ (xp - x0f) * (yp - y0f) * f4;\n\n\tsetOutput(value);\n  }\n")};nK[n]=s}return nK[n]}(o,r);return s.runWebGLProgram(u,[].concat(b(n),[r,a,i]),"float32")}},aK=(HZ.length-1)*HZ.length/2,iK=Math.ceil(aK/8),oK={};var sK={kernelName:"ComputeFreakDescriptors",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=t.extremaFreaks,r=t.positionT,a=e.backend,i=function(e){var t="".concat(e.shape[0]);if(!oK.hasOwnProperty(t)){var n={variableNames:["freak","p"],outputShape:[e.shape[0],iK],userCode:"\n  void main() {\n    ivec2 coords = getOutputCoords();\n    int featureIndex = coords[0];\n    int descIndex = coords[1] * 8;\n\n    int sum = 0;\n    for (int i = 0; i < 8; i++) {\n      if (descIndex + i >= ".concat(aK,") {\n        continue;\n      }\n\n      int p1 = int(getP(descIndex + i, 0));\n      int p2 = int(getP(descIndex + i, 1));\n\n      float v1 = getFreak(featureIndex, p1);\n      float v2 = getFreak(featureIndex, p2);\n\n      if (v1 < v2 + 0.01) {\n        sum += int(pow(2.0, float(7 - i)));\n      }\n    }\n    setOutput(float(sum));\n  }\n")};oK[t]=n}return oK[t]}(n);return a.runWebGLProgram(i,[n,r],"int32")}},uK={};var cK={kernelName:"ComputeLocalization",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=t.prunedExtremasList,r=t.dogPyramidImagesT,a=e.backend,i=function(e,t){var n="".concat(e,"|").concat(t);if(!uK.hasOwnProperty(n)){for(var r=[],a="float getPixel(int octave, int y, int x) {",i=1;i<e;i++)r.push("image"+i),a+="\n\t\t\t\tif (octave == ".concat(i,") {\n\t\t\t\t\treturn getImage").concat(i,"(y, x);\n\t\t\t\t}\n\t\t\t");a+="}",uK[n]={variableNames:[].concat(r,["extrema"]),outputShape:[t,3,3],userCode:"\n\t\t\t".concat(a,"\n\t\t\n\t\t\tvoid main() {\n\t\t\t\tivec3 coords = getOutputCoords();\n\t\t\t\tint featureIndex = coords[0];\n\t\t\t\tfloat score = getExtrema(featureIndex, 0);\n\t\t\t\tif (score == 0.0) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\n\t\t\t\tint dy = coords[1]-1;\n\t\t\t\tint dx = coords[2]-1;\n\t\t\t\tint octave = int(getExtrema(featureIndex, 1));\n\t\t\t\tint y = int(getExtrema(featureIndex, 2));\n\t\t\t\tint x = int(getExtrema(featureIndex, 3));\n\t\t\t\tsetOutput(getPixel(octave, y+dy, x+dx));\n\t\t\t}\n\t\t\t")}}return uK[n]}(r.length,n.length),o=ip(n,[n.length,n[0].length],"int32");return a.runWebGLProgram(i,[].concat(b(r.slice(1)),[o]),r[0].dtype)}},lK=36,dK={};var hK={kernelName:"ComputeOrientationHistograms",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=t.gaussianImagesT,r=t.prunedExtremasT,a=t.radialPropertiesT,o=t.pyramidImagesLength,s=e.backend,u=function(e,t,n){var r="".concat(n,"|").concat(e.shape[0],"|").concat(t.shape[0]);if(!dK.hasOwnProperty(r)){for(var a=[],i=1;i<n;i++)a.push("image"+i);for(var o="float getPixel(int octave, int y, int x) {",s=1;s<n;s++)o+="\n            if (octave == ".concat(s,") {\n                return getImage").concat(s,"(y, x);\n            }\n            ");o+="}";var u={variableNames:[].concat(a,["extrema","radial"]),outputShape:[e.shape[0],t.shape[0],2],userCode:"\n                ".concat(o,"\n\n                void main() {\n                    ivec3 coords = getOutputCoords();\n                    int featureIndex = coords[0];\n                    int radialIndex = coords[1];\n                    int propertyIndex = coords[2];\n\n                    int radialY = int(getRadial(radialIndex, 0));\n                    int radialX = int(getRadial(radialIndex, 1));\n                    float radialW = getRadial(radialIndex, 2);\n\n                    int octave = int(getExtrema(featureIndex, 1));\n                    int y = int(getExtrema(featureIndex, 2));\n                    int x = int(getExtrema(featureIndex, 3));\n\n                    int xp = x + radialX;\n                    int yp = y + radialY;\n\n                    float dy = getPixel(octave, yp+1, xp) - getPixel(octave, yp-1, xp);\n                    float dx = getPixel(octave, yp, xp+1) - getPixel(octave, yp, xp-1);\n\n                    if (propertyIndex == 0) {\n                    // be careful that atan(0, 0) gives 1.57 instead of 0 (different from js), but doesn't matter here, coz magnitude is 0\n                    \n                    float angle = atan(dy, dx) + ").concat(Math.PI,";\n                    float fbin = angle * ").concat(lK,". * ").concat(.159154943091895,";\n                    setOutput(fbin);\n                    return;\n                    }\n\n                    if (propertyIndex == 1) {\n                        float mag = sqrt(dx * dx + dy * dy);\n                        float magnitude = radialW * mag;\n                        setOutput(magnitude);\n                        return;\n                    }\n                }\n\n                ")},c={variableNames:["fbinMag"],outputShape:[e.shape[0],lK],userCode:"\n            void main() {\n                ivec2 coords = getOutputCoords();\n                int featureIndex = coords[0];\n                int binIndex = coords[1];\n\n                float sum = 0.;\n                for (int i = 0; i < ".concat(t.shape[0],"; i++) {\n                    float fbin = getFbinMag(featureIndex, i, 0);\n                    int bin = int(floor(fbin - 0.5));\n                    int b1 = imod(bin + ").concat(lK,", ").concat(lK,");\n                    int b2 = imod(bin + 1 + ").concat(lK,", ").concat(lK,");\n\n                    if (b1 == binIndex || b2 == binIndex) {\n                        float magnitude = getFbinMag(featureIndex, i, 1);\n                        float w2 = fbin - float(bin) - 0.5;\n                        float w1 = w2 * -1. + 1.;\n\n                        if (b1 == binIndex) {\n                            sum += w1 * magnitude;\n                        }\n                        if (b2 == binIndex) {\n                            sum += w2 * magnitude;\n                        }\n                    }\n                }\n                setOutput(sum);\n            }\n            ")};dK[r]=[u,c]}return dK[r]}(r,a,o),c=i(u,2),l=c[0],d=c[1],h=s.runWebGLProgram(l,[].concat(b(n),[r,a]),a.dtype),p=s.runWebGLProgram(d,[h],a.dtype);return s.disposeIntermediateTensorInfo(h),p}},pK={};var fK={kernelName:"DownsampleBilinear",backendName:"webgl",kernelFunc:function(e){var t=e.inputs.image,n=e.backend,r=function(e){var t=e.shape[1],n=e.shape[0],r="w"+t+"h"+n;if(!pK.hasOwnProperty(r)){var a={variableNames:["p"],outputShape:[Math.floor(n/2),Math.floor(t/2)],userCode:"\n            void main() {\n                ivec2 coords = getOutputCoords();\n                int y = coords[0] * 2;\n                int x = coords[1] * 2;\n        \n                float sum = getP(y, x) * 0.25;\n                sum += getP(y+1,x) * 0.25; \n                sum += getP(y, x+1) * 0.25; \n                sum += getP(y+1,x+1) * 0.25;\n                setOutput(sum);\n            }\n            "};pK[r]=a}return pK[r]}(t);return n.runWebGLProgram(r,[t],t.dtype)}},mK={kernelName:"ExtremaReduction",backendName:"webgl",kernelFunc:function(e){var t=e.inputs.extremasResultT,n=e.backend,r=t.shape[0],a=t.shape[1],i={variableNames:["extrema"],outputShape:[Math.floor(r/2),Math.floor(a/2)],userCode:"\n\t\t  void main() {\n\t\t\tivec2 coords = getOutputCoords();\n\t\t\tint y = coords[0] * 2;\n\t\t\tint x = coords[1] * 2;\n  \n\t\t\tfloat location = 0.0;\n\t\t\tfloat values = getExtrema(y, x);\n  \n\t\t\tif (getExtrema(y+1, x) != 0.0) {\n\t\t\t  location = 1.0;\n\t\t  values = getExtrema(y+1, x);\n\t\t\t}\n\t\t\telse if (getExtrema(y, x+1) != 0.0) {\n\t\t\t  location = 2.0;\n\t\t  values = getExtrema(y, x+1);\n\t\t\t}\n\t\t\telse if (getExtrema(y+1, x+1) != 0.0) {\n\t\t\t  location = 3.0;\n\t\t  values = getExtrema(y+1, x+1);\n\t\t\t}\n  \n\t\t\tif (values < 0.0) {\n\t\t\t  setOutput(location * -1000.0 + values);\n\t\t\t} else {\n\t\t\t  setOutput(location * 1000.0 + values);\n\t\t\t}\n\t\t  }\n\t\t"};return n.runWebGLProgram(i,[t],t.dtype)}},vK={};var gK={kernelName:"SmoothHistograms",backendName:"webgl",kernelFunc:function(e){for(var t=e.inputs.histograms,n=e.backend,r=function(e){var t="h".concat(e.shape[0]);if(!vK.hasOwnProperty(t)){var n={variableNames:["histogram"],outputShape:[e.shape[0],36],userCode:"\n            void main() {\n                ivec2 coords = getOutputCoords();\n\n                int featureIndex = coords[0];\n                int binIndex = coords[1];\n\n                int prevBin = imod(binIndex - 1 + ".concat(36,", ").concat(36,");\n                int nextBin = imod(binIndex + 1, ").concat(36,");\n                float result = 0.274068619061197 * getHistogram(featureIndex, prevBin) + 0.451862761877606 * getHistogram(featureIndex, binIndex) + 0.274068619061197 * getHistogram(featureIndex, nextBin);\n\n                setOutput(result);\n            }\n            ")};vK[t]=n}return vK[t]}(t),a=0;a<5;a++){var i=t;t=n.runWebGLProgram(r,[t],t.dtype),a>0&&n.disposeIntermediateTensorInfo(i)}return t}},yK={};var bK={kernelName:"UpsampleBilinear",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=t.image,r=t.targetImage,a=e.backend,i=function(e,t){var n=t.shape[1],r=t.shape[0],a="w"+n+"h"+r;if(!yK.hasOwnProperty(a)){var i={variableNames:["p"],outputShape:[r,n],userCode:"\n              void main() {\n                ivec2 coords = getOutputCoords();\n                int j = coords[0];\n                int i = coords[1];\n        \n                float sj = 0.5 * float(j) - 0.25; \n                float si = 0.5 * float(i) - 0.25;\n        \n                float sj0 = floor(sj);\n                float sj1 = ceil(sj);\n                float si0 = floor(si);\n                float si1 = ceil(si);\n        \n                int sj0I = int(sj0);\n                int sj1I = int(sj1);\n                int si0I = int(si0);\n                int si1I = int(si1);\n        \n                float sum = 0.0;\n                sum += getP(sj0I, si0I) * (si1 - si) * (sj1 - sj);\n                sum += getP(sj1I, si0I) * (si1 - si) * (sj - sj0);\n                sum += getP(sj0I, si1I) * (si - si0) * (sj1 - sj);\n                sum += getP(sj1I, si1I) * (si - si0) * (sj - sj0);\n                setOutput(sum);\n              }\n            "};yK[a]=i}return yK[a]}(0,r);return a.runWebGLProgram(i,[n],n.dtype)}};md(JZ),md($Z),md(tK),md(rK),md(sK),md(cK),md(hK),md(fK),md(mK),md(gK),md(bK);HZ.length,HZ.length;var xK=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];T(this,e),this.debugMode=r,this.width=t,this.height=n;for(var a=0;t>=8&&n>=8&&(t/=2,n/=2,5!==++a););this.numOctaves=a,this.tensorCaches={},this.kernelCaches={}}return E(e,[{key:"detectImageData",value:function(e){for(var t=new Uint8ClampedArray(4*e.length),n=0;n<e.length;n++)t[4*n]=e[n],t[4*n+1]=e[n],t[4*n+2]=e[n],t[4*n+3]=255;var r=new ImageData(t,this.width,this.height);return this.detect(r)}},{key:"detect",value:function(e){for(var t=null,n=[],r=0;r<this.numOctaves;r++){var a,i=void 0;i=0===r?this._applyFilter(e):this._downsampleBilinear(n[r-1][n[r-1].length-1]),a=this._applyFilter(i),n.push([i,a])}for(var o=[],s=0;s<this.numOctaves;s++){var u=this._differenceImageBinomial(n[s][0],n[s][1]);o.push(u)}for(var c=[],l=1;l<this.numOctaves-1;l++){var d=this._buildExtremas(o[l-1],o[l],o[l+1]);c.push(d)}var h=this._applyPrune(c),p=this._computeLocalization(h,o),f=this._computeOrientationHistograms(p,n),m=this._smoothHistograms(f),v=this._computeExtremaAngles(m),g=this._computeExtremaFreak(n,p,v),y=this._computeFreakDescriptors(g),b=p.arraySync(),x=v.arraySync(),w=y.arraySync();this.debugMode&&(t={pyramidImages:n.map((function(e){return e.map((function(e){return e.arraySync()}))})),dogPyramidImages:o.map((function(e){return e?e.arraySync():null})),extremasResults:c.map((function(e){return e.arraySync()})),extremaAngles:v.arraySync(),prunedExtremas:h,localizedExtremas:p.arraySync()}),n.forEach((function(e){return e.forEach((function(e){return e.dispose()}))})),o.forEach((function(e){return e&&e.dispose()})),c.forEach((function(e){return e.dispose()})),p.dispose(),f.dispose(),m.dispose(),v.dispose(),g.dispose(),y.dispose();for(var k=[],S=0;S<b.length;S++)if(0!=b[S][0]){for(var T=[],_=0;_<w[S].length;_+=4){var I=16777216*w[S][_]+65536*w[S][_+1]+256*w[S][_+2]+w[S][_+3];T.push(I)}var E=b[S][1],C=b[S][2],M=b[S][3]*Math.pow(2,E)+Math.pow(2,E-1)-.5,N=C*Math.pow(2,E)+Math.pow(2,E-1)-.5,R=Math.pow(2,E);k.push({maxima:b[S][0]>0,x:M,y:N,scale:R,angle:x[S],descriptors:T})}return{featurePoints:k,debugExtra:t}}},{key:"_computeFreakDescriptors",value:function(e){if(!this.tensorCaches.computeFreakDescriptors){for(var t=[],n=[],r=0;r<e.shape[1];r++)for(var a=r+1;a<e.shape[1];a++)t.push(r),n.push(a);var i=ip(t,[t.length]).cast("int32"),o=ip(n,[n.length]).cast("int32");this.tensorCaches.computeFreakDescriptors={positionT:Af(eb([i,o],1))}}var s=this.tensorCaches.computeFreakDescriptors.positionT;return Rf((function(){return Mf().runKernel("ComputeFreakDescriptors",{extremaFreaks:e,positionT:s})}))}},{key:"_computeExtremaFreak",value:function(e,t,n){var r=this;this.tensorCaches._computeExtremaFreak||Rf((function(){var e=ip(HZ);r.tensorCaches._computeExtremaFreak={freakPointsT:Af(e)}}));for(var a=this.tensorCaches._computeExtremaFreak.freakPointsT,i=[],o=1;o<e.length;o++)i.push(e[o][1]);return Rf((function(){return Mf().runKernel("ComputeExtremaFreak",{gaussianImagesT:i,prunedExtremas:t,prunedExtremasAngles:n,freakPointsT:a,pyramidImagesLength:e.length})}))}},{key:"_computeExtremaAngles",value:function(e){return Rf((function(){return Mf().runKernel("ComputeExtremaAngles",{histograms:e})}))}},{key:"_computeOrientationHistograms",value:function(e,t){for(var n=this,r=[],a=1;a<t.length;a++)r.push(t[a][1]);this.tensorCaches.orientationHistograms||Rf((function(){for(var e=Math.ceil(4.5),t=[],r=-e;r<=e;r++)for(var a=-e;a<=e;a++){var i=a*a+r*r;if(i<=20.25){var o=-.05555555555555555*i,s=.0013888888*(720+o*(720+o*(360+o*(120+o*(30+o*(6+o))))));t.push([r,a,s])}}n.tensorCaches.orientationHistograms={radialPropertiesT:Af(ip(t,[t.length,3]))}}));var i=this.tensorCaches.orientationHistograms.radialPropertiesT;return Rf((function(){return Mf().runKernel("ComputeOrientationHistograms",{gaussianImagesT:r,prunedExtremasT:e,radialPropertiesT:i,pyramidImagesLength:t.length})}))}},{key:"_smoothHistograms",value:function(e){return Rf((function(){return Mf().runKernel("SmoothHistograms",{histograms:e})}))}},{key:"_computeLocalization",value:function(e,t){return Rf((function(){for(var n=Mf().runKernel("ComputeLocalization",{prunedExtremasList:e,dogPyramidImagesT:t}).arraySync(),r=[],a=0;a<n.length;a++){r.push([]);for(var i=0;i<n[a].length;i++)r[a].push([])}for(var o=[],s=0;s<e.length;s++)o[s]=[e[s][0],e[s][1],e[s][2],e[s][3]];for(var u=0;u<o.length;u++)if(0!==o[u][0]){var c=n[u],l=.5*(c[1][2]-c[1][0]),d=.5*(c[2][1]-c[0][1]),h=c[1][2]+c[1][0]-2*c[1][1],p=c[2][1]+c[0][1]-2*c[1][1],f=.25*(c[0][0]+c[2][2]-c[0][2]-c[2][0]),m=h*p-f*f,v=(p*-l+-f*-d)/m,g=(-f*-l+h*-d)/m,y=o[u][2]+g,b=o[u][3]+v;Math.abs(m)<1e-4||(o[u][2]=y,o[u][3]=b)}return ip(o,[o.length,o[0].length],"float32")}))}},{key:"_applyPrune",value:function(e){for(var t=[],n=[],r=0;r<100;r++){n.push([]),t.push([]);for(var a=0;a<5;a++)n[r].push([0,0,0,0]),t[r].push(0)}Rf((function(){for(var r=0;r<e.length;r++)for(var a=Mf().runKernel("ExtremaReduction",{extremasResultT:e[r]}),i=r+1,o=a.arraySync(),s=a.shape[0],u=a.shape[1],c=2*u/10,l=2*s/10,d=0;d<s;d++)for(var h=0;h<u;h++){var p=o[d][h];if(0!=p){for(var f=p%1e3,m=Math.floor(Math.abs(p)/1e3),v=2*h+(2===m||3===m?1:0),g=2*d+(1===m||3===m?1:0),y=Math.floor(v/c),b=10*Math.floor(g/l)+y,x=Math.abs(f),w=5;w>=1&&x>t[b][w-1];)w-=1;if(w<5){for(var k=4;k>=w+1;k--)t[b][k]=t[b][k-1],n[b][k][0]=n[b][k-1][0],n[b][k][1]=n[b][k-1][1],n[b][k][2]=n[b][k-1][2],n[b][k][3]=n[b][k-1][3];t[b][w]=x,n[b][w][0]=f,n[b][w][1]=i,n[b][w][2]=g,n[b][w][3]=v}}}}));for(var i=[],o=0;o<100;o++)for(var s=0;s<5;s++)i.push(n[o][s]);return i}},{key:"_buildExtremas",value:function(e,t,n){return Rf((function(){return Mf().runKernel("BuildExtremas",{image0:e,image1:t,image2:n})}))}},{key:"_differenceImageBinomial",value:function(e,t){return Rf((function(){return e.sub(t)}))}},{key:"_applyFilter",value:function(e){return Rf((function(){return Mf().runKernel("BinomialFilter",{image:e})}))}},{key:"_downsampleBilinear",value:function(e){return Rf((function(){return Mf().runKernel("DownsampleBilinear",{image:e})}))}},{key:"_compileAndRun",value:function(e,t){var n=Df().compileAndRun(e,t);return Mf().makeTensorFromDataId(n.dataId,n.shape,n.dtype)}},{key:"_runWebGLProgram",value:function(e,t,n){var r=Df().runWebGLProgram(e,t,n);return Mf().makeTensorFromDataId(r.dataId,r.shape,r.dtype)}}]),e}(),wK=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];T(this,e),this.debugMode=r,this.width=t,this.height=n;var a=Math.min(t,n)/2,i=Math.pow(2,Math.round(Math.log(a)/Math.log(2)));this.cropSize=i,this.detector=new xK(i,i,r),this.kernelCaches={},this.lastRandomIndex=4}return E(e,[{key:"detect",value:function(e){var t=Math.floor(this.height/2-this.cropSize/2),n=Math.floor(this.width/2-this.cropSize/2),r=this._detect(e,n,t);return this.debugMode&&(r.debugExtra.crop={startX:n,startY:t,cropSize:this.cropSize}),r}},{key:"detectMoving",value:function(e){var t=this.lastRandomIndex%3,n=Math.floor(this.lastRandomIndex/3),r=Math.floor(this.height/2-this.cropSize+n*this.cropSize/2),a=Math.floor(this.width/2-this.cropSize+t*this.cropSize/2);return a<0&&(a=0),r<0&&(r=0),a>=this.width-this.cropSize&&(a=this.width-this.cropSize-1),r>=this.height-this.cropSize&&(r=this.height-this.cropSize-1),this.lastRandomIndex=(this.lastRandomIndex+1)%9,this._detect(e,a,r)}},{key:"_detect",value:function(e,t,n){var r=e.slice([n,t],[this.cropSize,this.cropSize]),a=this.detector.detect(r),i=a.featurePoints,o=a.debugExtra;return i.forEach((function(e){e.x+=t,e.y+=n})),this.debugMode&&(o.projectedImage=r.arraySync()),r.dispose(),{featurePoints:i,debugExtra:o}}}]),e}(),kK=function(e){for(var t=e.image,n=e.ratio,r=Math.round(t.width*n),a=Math.round(t.height*n),i=new Uint8Array(r*a),o=0;o<r;o++){var s=Math.round(1*o/n),u=Math.round(1*(o+1)/n)-1;u>=t.width&&(u=t.width-1);for(var c=0;c<a;c++){var l=Math.round(1*c/n),d=Math.round(1*(c+1)/n)-1;d>=t.height&&(d=t.height-1);for(var h=0,p=0,f=s;f<=u;f++)for(var m=l;m<=d;m++)h+=1*t.data[m*t.width+f],p+=1;i[c*r+o]=Math.floor(h/p)}}return{data:i,width:r,height:a}},SK=function(e){for(var t=[],n=100/Math.min(e.width,e.height);;)if(t.push(n),(n*=Math.pow(2,1/3))>=.95){n=1;break}t.push(n),t.reverse();for(var r=[],a=0;a<t.length;a++)e.width,t[a],e.height,t[a],r.push(Object.assign(kK({image:e,ratio:t[a]}),{scale:t[a]}));return r},TK=function(e){var t=Math.min(e.width,e.height),n=[],r=[];n.push(256/t),n.push(128/t);for(var a=0;a<n.length;a++)r.push(Object.assign(kK({image:e,ratio:n[a]}),{scale:n[a]}));return r},_K=function(e){for(var t=e.v1,n=e.v2,r=0,a=0;a<t.length;a++){var i=(t[a]^n[a])>>>0;r+=IK(i)}return r},IK=function(e){var t=e-(e>>1&1431655765);return t=((t=((t=((t=(t>>2&858993459)+(858993459&t))>>4)+t&252645135)>>8)+t&16711935)>>16)+t&65535},EK=function(e){for(var t=e.points,n=[],r=0;r<t.length;r++)n.push(r);var a={seed:1234,arrayShuffle:function(e){for(var t=e.arr,n=e.sampleSize,r=0;r<n;r++){this.seed=(214013*this.seed+2531011)%-2147483648;var a=this.seed>>16&32767;a%=t.length;var i=t[r];t[r]=t[a],t[a]=i}},nextInt:function(e){return this.seed=(214013*this.seed+2531011)%-2147483648,(this.seed>>16&32767)%e}};return{rootNode:CK({points:t,pointIndexes:n,centerPointIndex:null,randomizer:a})}},CK=function e(t){var n=t.points,r=t.pointIndexes,a=t.centerPointIndex,i=t.randomizer,o=!1;(r.length<=8||r.length<=16)&&(o=!0);var s={};if(!o)for(var u=function(e){for(var t=e.points,n=e.pointIndexes,r=e.randomizer,a=[],i=0;i<n.length;i++)a.push(i);for(var o=Number.MAX_SAFE_INTEGER,s=-1,u=[],c=0;c<128;c++){r.arrayShuffle({arr:a,sampleSize:8});for(var l=0,d=[],h=0;h<n.length;h++){for(var p=Number.MAX_SAFE_INTEGER,f=0;f<8;f++){var m=n[a[f]],v=_K({v1:t[n[h]].descriptors,v2:t[m].descriptors});v<p&&(d[h]=a[f],p=v)}l+=p}u.push(d),l<o&&(o=l,s=c)}return u[s]}({points:n,pointIndexes:r,randomizer:i}),c=0;c<u.length;c++)void 0===s[r[u[c]]]&&(s[r[u[c]]]=[]),s[r[u[c]]].push(r[c]);1===Object.keys(s).length&&(o=!0);var l={centerPointIndex:a};if(o){l.leaf=!0,l.pointIndexes=[];for(var d=0;d<r.length;d++)l.pointIndexes.push(r[d]);return l}return l.leaf=!1,l.children=[],Object.keys(s).forEach((function(t){l.children.push(e({points:n,pointIndexes:s[t],centerPointIndex:t,randomizer:i}))})),l},MK={},NK={get exports(){return MK},set exports(e){MK=e}};!function(e,t){e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t||4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){n.r(t),n.d(t,"encode",(function(){return C})),n.d(t,"decode",(function(){return X})),n.d(t,"decodeAsync",(function(){return J})),n.d(t,"decodeArrayStream",(function(){return q})),n.d(t,"decodeStream",(function(){return $})),n.d(t,"Decoder",(function(){return V})),n.d(t,"Encoder",(function(){return I})),n.d(t,"ExtensionCodec",(function(){return S})),n.d(t,"ExtData",(function(){return p})),n.d(t,"EXT_TIMESTAMP",(function(){return v})),n.d(t,"encodeDateToTimeSpec",(function(){return y})),n.d(t,"encodeTimeSpecToTimestamp",(function(){return g})),n.d(t,"decodeTimestampToTimeSpec",(function(){return x})),n.d(t,"encodeTimestampExtension",(function(){return b})),n.d(t,"decodeTimestampExtension",(function(){return w}));var r=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,i=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(s){a={error:s}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return o},a=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e},i=typeof process<"u"&&typeof TextEncoder<"u"&&typeof TextDecoder<"u";function o(e){for(var t=e.length,n=0,r=0;r<t;){var a=e.charCodeAt(r++);if(4294967168&a)if(4294965248&a){if(a>=55296&&a<=56319&&r<t){var i=e.charCodeAt(r);56320==(64512&i)&&(++r,a=((1023&a)<<10)+(1023&i)+65536)}n+=4294901760&a?4:3}else n+=2;else n++}return n}var s=i?new TextEncoder:void 0,u=typeof process<"u"?200:0,c=null!=s&&s.encodeInto?function(e,t,n){s.encodeInto(e,t.subarray(n))}:function(e,t,n){t.set(s.encode(e),n)};function l(e,t,n){for(var r=t,i=r+n,o=[],s="";r<i;){var u=e[r++];if(128&u)if(192==(224&u)){var c=63&e[r++];o.push((31&u)<<6|c)}else if(224==(240&u)){c=63&e[r++];var l=63&e[r++];o.push((31&u)<<12|c<<6|l)}else if(240==(248&u)){var d=(7&u)<<18|(c=63&e[r++])<<12|(l=63&e[r++])<<6|63&e[r++];d>65535&&(d-=65536,o.push(d>>>10&1023|55296),d=56320|1023&d),o.push(d)}else o.push(u);else o.push(u);o.length>=4096&&(s+=String.fromCharCode.apply(String,a(o)),o.length=0)}return o.length>0&&(s+=String.fromCharCode.apply(String,a(o))),s}var d=i?new TextDecoder:null,h=typeof process<"u"?200:0,p=function(e,t){this.type=e,this.data=t};function f(e,t,n){var r=Math.floor(n/4294967296),a=n;e.setUint32(t,r),e.setUint32(t+4,a)}function m(e,t){return 4294967296*e.getInt32(t)+e.getUint32(t+4)}var v=-1;function g(e){var t,n=e.sec,r=e.nsec;if(n>=0&&r>=0&&n<=17179869183){if(0===r&&n<=4294967295){var a=new Uint8Array(4);return(t=new DataView(a.buffer)).setUint32(0,n),a}var i=n/4294967296,o=4294967295&n;return a=new Uint8Array(8),(t=new DataView(a.buffer)).setUint32(0,r<<2|3&i),t.setUint32(4,o),a}return a=new Uint8Array(12),(t=new DataView(a.buffer)).setUint32(0,r),f(t,4,n),a}function y(e){var t=e.getTime(),n=Math.floor(t/1e3),r=1e6*(t-1e3*n),a=Math.floor(r/1e9);return{sec:n+a,nsec:r-1e9*a}}function b(e){return e instanceof Date?g(y(e)):null}function x(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);switch(e.byteLength){case 4:return{sec:t.getUint32(0),nsec:0};case 8:var n=t.getUint32(0);return{sec:4294967296*(3&n)+t.getUint32(4),nsec:n>>>2};case 12:return{sec:m(t,4),nsec:t.getUint32(0)};default:throw new Error("Unrecognized data size for timestamp: "+e.length)}}function w(e){var t=x(e);return new Date(1e3*t.sec+t.nsec/1e6)}var k={type:v,encode:b,decode:w},S=function(){function e(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(k)}return e.prototype.register=function(e){var t=e.type,n=e.encode,r=e.decode;if(t>=0)this.encoders[t]=n,this.decoders[t]=r;else{var a=1+t;this.builtInEncoders[a]=n,this.builtInDecoders[a]=r}},e.prototype.tryToEncode=function(e,t){for(var n=0;n<this.builtInEncoders.length;n++)if(null!=(r=this.builtInEncoders[n])&&null!=(a=r(e,t)))return new p(-1-n,a);for(n=0;n<this.encoders.length;n++){var r,a;if(null!=(r=this.encoders[n])&&null!=(a=r(e,t)))return new p(n,a)}return e instanceof p?e:null},e.prototype.decode=function(e,t,n){var r=t<0?this.builtInDecoders[-1-t]:this.decoders[t];return r?r(e,t,n):new p(t,e)},e.defaultCodec=new e,e}();function T(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer?new Uint8Array(e):Uint8Array.from(e)}var _=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},I=function(){function e(e,t,n,r,a,i,o){void 0===e&&(e=S.defaultCodec),void 0===n&&(n=100),void 0===r&&(r=2048),void 0===a&&(a=!1),void 0===i&&(i=!1),void 0===o&&(o=!1),this.extensionCodec=e,this.context=t,this.maxDepth=n,this.initialBufferSize=r,this.sortKeys=a,this.forceFloat32=i,this.ignoreUndefined=o,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return e.prototype.encode=function(e,t){if(t>this.maxDepth)throw new Error("Too deep objects in depth "+t);null==e?this.encodeNil():"boolean"==typeof e?this.encodeBoolean(e):"number"==typeof e?this.encodeNumber(e):"string"==typeof e?this.encodeString(e):this.encodeObject(e,t)},e.prototype.getUint8Array=function(){return this.bytes.subarray(0,this.pos)},e.prototype.ensureBufferSizeToWrite=function(e){var t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(2*t)},e.prototype.resizeBuffer=function(e){var t=new ArrayBuffer(e),n=new Uint8Array(t),r=new DataView(t);n.set(this.bytes),this.view=r,this.bytes=n},e.prototype.encodeNil=function(){this.writeU8(192)},e.prototype.encodeBoolean=function(e){!1===e?this.writeU8(194):this.writeU8(195)},e.prototype.encodeNumber=function(e){Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):(this.writeU8(211),this.writeI64(e)):this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))},e.prototype.writeStringHeader=function(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else{if(!(e<4294967296))throw new Error("Too long string: "+e+" bytes in UTF-8");this.writeU8(219),this.writeU32(e)}},e.prototype.encodeString=function(e){var t=e.length;if(i&&t>u){var n=o(e);this.ensureBufferSizeToWrite(5+n),this.writeStringHeader(n),c(e,this.bytes,this.pos),this.pos+=n}else n=o(e),this.ensureBufferSizeToWrite(5+n),this.writeStringHeader(n),function(e,t,n){for(var r=e.length,a=n,i=0;i<r;){var o=e.charCodeAt(i++);if(4294967168&o){if(4294965248&o){if(o>=55296&&o<=56319&&i<r){var s=e.charCodeAt(i);56320==(64512&s)&&(++i,o=((1023&o)<<10)+(1023&s)+65536)}4294901760&o?(t[a++]=o>>18&7|240,t[a++]=o>>12&63|128,t[a++]=o>>6&63|128):(t[a++]=o>>12&15|224,t[a++]=o>>6&63|128)}else t[a++]=o>>6&31|192;t[a++]=63&o|128}else t[a++]=o}}(e,this.bytes,this.pos),this.pos+=n},e.prototype.encodeObject=function(e,t){var n=this.extensionCodec.tryToEncode(e,this.context);if(null!=n)this.encodeExtension(n);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else{if("object"!=typeof e)throw new Error("Unrecognized object: "+Object.prototype.toString.apply(e));this.encodeMap(e,t)}},e.prototype.encodeBinary=function(e){var t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else{if(!(t<4294967296))throw new Error("Too large binary: "+t);this.writeU8(198),this.writeU32(t)}var n=T(e);this.writeU8a(n)},e.prototype.encodeArray=function(e,t){var n,r,a=e.length;if(a<16)this.writeU8(144+a);else if(a<65536)this.writeU8(220),this.writeU16(a);else{if(!(a<4294967296))throw new Error("Too large array: "+a);this.writeU8(221),this.writeU32(a)}try{for(var i=_(e),o=i.next();!o.done;o=i.next()){var s=o.value;this.encode(s,t+1)}}catch(u){n={error:u}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},e.prototype.countWithoutUndefined=function(e,t){var n,r,a=0;try{for(var i=_(t),o=i.next();!o.done;o=i.next())void 0!==e[o.value]&&a++}catch(s){n={error:s}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return a},e.prototype.encodeMap=function(e,t){var n,r,a=Object.keys(e);this.sortKeys&&a.sort();var i=this.ignoreUndefined?this.countWithoutUndefined(e,a):a.length;if(i<16)this.writeU8(128+i);else if(i<65536)this.writeU8(222),this.writeU16(i);else{if(!(i<4294967296))throw new Error("Too large map object: "+i);this.writeU8(223),this.writeU32(i)}try{for(var o=_(a),s=o.next();!s.done;s=o.next()){var u=s.value,c=e[u];this.ignoreUndefined&&void 0===c||(this.encodeString(u),this.encode(c,t+1))}}catch(IY){n={error:IY}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}},e.prototype.encodeExtension=function(e){var t=e.data.length;if(1===t)this.writeU8(212);else if(2===t)this.writeU8(213);else if(4===t)this.writeU8(214);else if(8===t)this.writeU8(215);else if(16===t)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else{if(!(t<4294967296))throw new Error("Too large extension object: "+t);this.writeU8(201),this.writeU32(t)}this.writeI8(e.type),this.writeU8a(e.data)},e.prototype.writeU8=function(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++},e.prototype.writeU8a=function(e){var t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t},e.prototype.writeI8=function(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++},e.prototype.writeU16=function(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2},e.prototype.writeI16=function(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2},e.prototype.writeU32=function(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4},e.prototype.writeI32=function(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4},e.prototype.writeF32=function(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4},e.prototype.writeF64=function(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8},e.prototype.writeU64=function(e){this.ensureBufferSizeToWrite(8),function(e,t,n){var r=n/4294967296,a=n;e.setUint32(t,r),e.setUint32(t+4,a)}(this.view,this.pos,e),this.pos+=8},e.prototype.writeI64=function(e){this.ensureBufferSizeToWrite(8),f(this.view,this.pos,e),this.pos+=8},e}(),E={};function C(e,t){void 0===t&&(t=E);var n=new I(t.extensionCodec,t.context,t.maxDepth,t.initialBufferSize,t.sortKeys,t.forceFloat32,t.ignoreUndefined);return n.encode(e,1),n.getUint8Array()}function M(e){return(e<0?"-":"")+"0x"+Math.abs(e).toString(16).padStart(2,"0")}var N=function(){function e(e,t){void 0===e&&(e=16),void 0===t&&(t=16),this.maxKeyLength=e,this.maxLengthPerKey=t,this.caches=[];for(var n=0;n<this.maxKeyLength;n++)this.caches.push([])}return e.prototype.canBeCached=function(e){return e>0&&e<=this.maxKeyLength},e.prototype.get=function(e,t,n){var r=this.caches[n-1],a=r.length;e:for(var i=0;i<a;i++){for(var o=r[i],s=o.bytes,u=0;u<n;u++)if(s[u]!==e[t+u])continue e;return o.value}return null},e.prototype.store=function(e,t){var n=this.caches[e.length-1],r={bytes:e,value:t};n.length>=this.maxLengthPerKey?n[Math.random()*n.length|0]=r:n.push(r)},e.prototype.decode=function(e,t,n){var r=this.get(e,t,n);if(null!=r)return r;var a=l(e,t,n),i=Uint8Array.prototype.slice.call(e,t,t+n);return this.store(i,a),a},e}(),R=function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},L=function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(IY){i=[6,IY],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},A=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,a){!function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,a,(t=e[n](t)).done,t.value)}))}}},P=function e(t){return this instanceof e?(this.v=t,this):new e(t)},D=function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,a=n.apply(e,t||[]),i=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(e){a[e]&&(r[e]=function(t){return new Promise((function(n,r){i.push([e,t,n,r])>1||s(e,t)}))})}function s(e,t){try{(n=a[e](t)).value instanceof P?Promise.resolve(n.value.v).then(u,c):l(i[0][2],n)}catch(yj){l(i[0][3],yj)}var n}function u(e){s("next",e)}function c(e){s("throw",e)}function l(e,t){e(t),i.shift(),i.length&&s(i[0][0],i[0][1])}},O=new DataView(new ArrayBuffer(0)),z=new Uint8Array(O.buffer),F=function(){try{O.getInt8(0)}catch(Qo){return Qo.constructor}throw new Error("never reached")}(),G=new F("Insufficient data"),W=new N,V=function(){function e(e,t,n,r,a,i,o,s){void 0===e&&(e=S.defaultCodec),void 0===n&&(n=4294967295),void 0===r&&(r=4294967295),void 0===a&&(a=4294967295),void 0===i&&(i=4294967295),void 0===o&&(o=4294967295),void 0===s&&(s=W),this.extensionCodec=e,this.context=t,this.maxStrLength=n,this.maxBinLength=r,this.maxArrayLength=a,this.maxMapLength=i,this.maxExtLength=o,this.cachedKeyDecoder=s,this.totalPos=0,this.pos=0,this.view=O,this.bytes=z,this.headByte=-1,this.stack=[]}return e.prototype.setBuffer=function(e){this.bytes=T(e),this.view=function(e){if(e instanceof ArrayBuffer)return new DataView(e);var t=T(e);return new DataView(t.buffer,t.byteOffset,t.byteLength)}(this.bytes),this.pos=0},e.prototype.appendBuffer=function(e){if(-1!==this.headByte||this.hasRemaining()){var t=this.bytes.subarray(this.pos),n=T(e),r=new Uint8Array(t.length+n.length);r.set(t),r.set(n,t.length),this.setBuffer(r)}else this.setBuffer(e)},e.prototype.hasRemaining=function(e){return void 0===e&&(e=1),this.view.byteLength-this.pos>=e},e.prototype.createNoExtraBytesError=function(e){var t=this.view,n=this.pos;return new RangeError("Extra "+(t.byteLength-n)+" byte(s) found at buffer["+e+"]")},e.prototype.decodeSingleSync=function(){var e=this.decodeSync();if(this.hasRemaining())throw this.createNoExtraBytesError(this.pos);return e},e.prototype.decodeSingleAsync=function(e){var t,n,r,a;return R(this,void 0,void 0,(function(){var i,o,s,u,c,l,d,h;return L(this,(function(p){switch(p.label){case 0:i=!1,p.label=1;case 1:p.trys.push([1,6,7,12]),t=A(e),p.label=2;case 2:return[4,t.next()];case 3:if((n=p.sent()).done)return[3,5];if(s=n.value,i)throw this.createNoExtraBytesError(this.totalPos);this.appendBuffer(s);try{o=this.decodeSync(),i=!0}catch(f){if(!(f instanceof F))throw f}this.totalPos+=this.pos,p.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return u=p.sent(),r={error:u},[3,12];case 7:return p.trys.push([7,,10,11]),n&&!n.done&&(a=t.return)?[4,a.call(t)]:[3,9];case 8:p.sent(),p.label=9;case 9:return[3,11];case 10:if(r)throw r.error;return[7];case 11:return[7];case 12:if(i){if(this.hasRemaining())throw this.createNoExtraBytesError(this.totalPos);return[2,o]}throw l=(c=this).headByte,d=c.pos,h=c.totalPos,new RangeError("Insufficient data in parcing "+M(l)+" at "+h+" ("+d+" in the current buffer)")}}))}))},e.prototype.decodeArrayStream=function(e){return this.decodeMultiAsync(e,!0)},e.prototype.decodeStream=function(e){return this.decodeMultiAsync(e,!1)},e.prototype.decodeMultiAsync=function(e,t){return D(this,arguments,(function(){var n,r,a,i,o,s,u,c,l;return L(this,(function(d){switch(d.label){case 0:n=t,r=-1,d.label=1;case 1:d.trys.push([1,13,14,19]),a=A(e),d.label=2;case 2:return[4,P(a.next())];case 3:if((i=d.sent()).done)return[3,12];if(o=i.value,t&&0===r)throw this.createNoExtraBytesError(this.totalPos);this.appendBuffer(o),n&&(r=this.readArraySize(),n=!1,this.complete()),d.label=4;case 4:d.trys.push([4,9,,10]),d.label=5;case 5:return[4,P(this.decodeSync())];case 6:return[4,d.sent()];case 7:return d.sent(),0==--r?[3,8]:[3,5];case 8:return[3,10];case 9:if(!((s=d.sent())instanceof F))throw s;return[3,10];case 10:this.totalPos+=this.pos,d.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return u=d.sent(),c={error:u},[3,19];case 14:return d.trys.push([14,,17,18]),i&&!i.done&&(l=a.return)?[4,P(l.call(a))]:[3,16];case 15:d.sent(),d.label=16;case 16:return[3,18];case 17:if(c)throw c.error;return[7];case 18:return[7];case 19:return[2]}}))}))},e.prototype.decodeSync=function(){e:for(;;){var e=this.readHeadByte(),t=void 0;if(e>=224)t=e-256;else if(e<192)if(e<128)t=e;else if(e<144){if(0!==(r=e-128)){this.pushMapState(r),this.complete();continue e}t={}}else if(e<160){if(0!==(r=e-144)){this.pushArrayState(r),this.complete();continue e}t=[]}else{var n=e-160;t=this.decodeUtf8String(n,0)}else if(192===e)t=null;else if(194===e)t=!1;else if(195===e)t=!0;else if(202===e)t=this.readF32();else if(203===e)t=this.readF64();else if(204===e)t=this.readU8();else if(205===e)t=this.readU16();else if(206===e)t=this.readU32();else if(207===e)t=this.readU64();else if(208===e)t=this.readI8();else if(209===e)t=this.readI16();else if(210===e)t=this.readI32();else if(211===e)t=this.readI64();else if(217===e)n=this.lookU8(),t=this.decodeUtf8String(n,1);else if(218===e)n=this.lookU16(),t=this.decodeUtf8String(n,2);else if(219===e)n=this.lookU32(),t=this.decodeUtf8String(n,4);else if(220===e){if(0!==(r=this.readU16())){this.pushArrayState(r),this.complete();continue e}t=[]}else if(221===e){if(0!==(r=this.readU32())){this.pushArrayState(r),this.complete();continue e}t=[]}else if(222===e){if(0!==(r=this.readU16())){this.pushMapState(r),this.complete();continue e}t={}}else if(223===e){if(0!==(r=this.readU32())){this.pushMapState(r),this.complete();continue e}t={}}else if(196===e){var r=this.lookU8();t=this.decodeBinary(r,1)}else if(197===e)r=this.lookU16(),t=this.decodeBinary(r,2);else if(198===e)r=this.lookU32(),t=this.decodeBinary(r,4);else if(212===e)t=this.decodeExtension(1,0);else if(213===e)t=this.decodeExtension(2,0);else if(214===e)t=this.decodeExtension(4,0);else if(215===e)t=this.decodeExtension(8,0);else if(216===e)t=this.decodeExtension(16,0);else if(199===e)r=this.lookU8(),t=this.decodeExtension(r,1);else if(200===e)r=this.lookU16(),t=this.decodeExtension(r,2);else{if(201!==e)throw new Error("Unrecognized type byte: "+M(e));r=this.lookU32(),t=this.decodeExtension(r,4)}this.complete();for(var a=this.stack;a.length>0;){var i=a[a.length-1];if(0===i.type){if(i.array[i.position]=t,i.position++,i.position!==i.size)continue e;a.pop(),t=i.array}else{if(1===i.type){if(o=void 0,"string"!=(o=typeof t)&&"number"!==o)throw new Error("The type of key must be string or number but "+typeof t);i.key=t,i.type=2;continue e}if(i.map[i.key]=t,i.readCount++,i.readCount!==i.size){i.key=null,i.type=1;continue e}a.pop(),t=i.map}}return t}var o},e.prototype.readHeadByte=function(){return-1===this.headByte&&(this.headByte=this.readU8()),this.headByte},e.prototype.complete=function(){this.headByte=-1},e.prototype.readArraySize=function(){var e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:if(e<160)return e-144;throw new Error("Unrecognized array type byte: "+M(e))}},e.prototype.pushMapState=function(e){if(e>this.maxMapLength)throw new Error("Max length exceeded: map length ("+e+") > maxMapLengthLength ("+this.maxMapLength+")");this.stack.push({type:1,size:e,key:null,readCount:0,map:{}})},e.prototype.pushArrayState=function(e){if(e>this.maxArrayLength)throw new Error("Max length exceeded: array length ("+e+") > maxArrayLength ("+this.maxArrayLength+")");this.stack.push({type:0,size:e,array:new Array(e),position:0})},e.prototype.decodeUtf8String=function(e,t){var n;if(e>this.maxStrLength)throw new Error("Max length exceeded: UTF-8 byte length ("+e+") > maxStrLength ("+this.maxStrLength+")");if(this.bytes.byteLength<this.pos+t+e)throw G;var r,a=this.pos+t;return r=this.stateIsMapKey()&&null!==(n=this.cachedKeyDecoder)&&void 0!==n&&n.canBeCached(e)?this.cachedKeyDecoder.decode(this.bytes,a,e):i&&e>h?function(e,t,n){var r=e.subarray(t,t+n);return d.decode(r)}(this.bytes,a,e):l(this.bytes,a,e),this.pos+=t+e,r},e.prototype.stateIsMapKey=function(){return this.stack.length>0&&1===this.stack[this.stack.length-1].type},e.prototype.decodeBinary=function(e,t){if(e>this.maxBinLength)throw new Error("Max length exceeded: bin length ("+e+") > maxBinLength ("+this.maxBinLength+")");if(!this.hasRemaining(e+t))throw G;var n=this.pos+t,r=this.bytes.subarray(n,n+e);return this.pos+=t+e,r},e.prototype.decodeExtension=function(e,t){if(e>this.maxExtLength)throw new Error("Max length exceeded: ext length ("+e+") > maxExtLength ("+this.maxExtLength+")");var n=this.view.getInt8(this.pos+t),r=this.decodeBinary(e,t+1);return this.extensionCodec.decode(r,n,this.context)},e.prototype.lookU8=function(){return this.view.getUint8(this.pos)},e.prototype.lookU16=function(){return this.view.getUint16(this.pos)},e.prototype.lookU32=function(){return this.view.getUint32(this.pos)},e.prototype.readU8=function(){var e=this.view.getUint8(this.pos);return this.pos++,e},e.prototype.readI8=function(){var e=this.view.getInt8(this.pos);return this.pos++,e},e.prototype.readU16=function(){var e=this.view.getUint16(this.pos);return this.pos+=2,e},e.prototype.readI16=function(){var e=this.view.getInt16(this.pos);return this.pos+=2,e},e.prototype.readU32=function(){var e=this.view.getUint32(this.pos);return this.pos+=4,e},e.prototype.readI32=function(){var e=this.view.getInt32(this.pos);return this.pos+=4,e},e.prototype.readU64=function(){var e,t,n=(e=this.view,t=this.pos,4294967296*e.getUint32(t)+e.getUint32(t+4));return this.pos+=8,n},e.prototype.readI64=function(){var e=m(this.view,this.pos);return this.pos+=8,e},e.prototype.readF32=function(){var e=this.view.getFloat32(this.pos);return this.pos+=4,e},e.prototype.readF64=function(){var e=this.view.getFloat64(this.pos);return this.pos+=8,e},e}(),U={};function X(e,t){void 0===t&&(t=U);var n=new V(t.extensionCodec,t.context,t.maxStrLength,t.maxBinLength,t.maxArrayLength,t.maxMapLength,t.maxExtLength);return n.setBuffer(e),n.decodeSingleSync()}var B=function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(IY){i=[6,IY],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},H=function e(t){return this instanceof e?(this.v=t,this):new e(t)},Z=function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,a=n.apply(e,t||[]),i=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(e){a[e]&&(r[e]=function(t){return new Promise((function(n,r){i.push([e,t,n,r])>1||s(e,t)}))})}function s(e,t){try{(n=a[e](t)).value instanceof H?Promise.resolve(n.value.v).then(u,c):l(i[0][2],n)}catch(yj){l(i[0][3],yj)}var n}function u(e){s("next",e)}function c(e){s("throw",e)}function l(e,t){e(t),i.shift(),i.length&&s(i[0][0],i[0][1])}};function K(e){if(null==e)throw new Error("Assertion Failure: value must not be null nor undefined")}function j(e){return null!=e[Symbol.asyncIterator]?e:function(e){return Z(this,arguments,(function(){var t,n,r,a;return B(this,(function(i){switch(i.label){case 0:t=e.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,H(t.read())];case 3:return n=i.sent(),r=n.done,a=n.value,r?[4,H(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return K(a),[4,H(a)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}(e)}var Y=function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},Q=function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(IY){i=[6,IY],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function J(e,t){return void 0===t&&(t=U),Y(this,void 0,void 0,(function(){var n;return Q(this,(function(r){return n=j(e),[2,new V(t.extensionCodec,t.context,t.maxStrLength,t.maxBinLength,t.maxArrayLength,t.maxMapLength,t.maxExtLength).decodeSingleAsync(n)]}))}))}function q(e,t){void 0===t&&(t=U);var n=j(e);return new V(t.extensionCodec,t.context,t.maxStrLength,t.maxBinLength,t.maxArrayLength,t.maxMapLength,t.maxExtLength).decodeArrayStream(n)}function $(e,t){void 0===t&&(t=U);var n=j(e);return new V(t.extensionCodec,t.context,t.maxStrLength,t.maxBinLength,t.maxArrayLength,t.maxMapLength,t.maxExtLength).decodeStream(n)}}])}(NK);var RK=function(){function e(){T(this,e),this.data=null}return E(e,[{key:"compileImageTargets",value:function(e,t){var n=this;return new Promise(function(){var r=S(w().mark((function r(a,i){var o,s,u,c,l,d,h,p,f,m,v,g,y,b,x,k,S;return w().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:for(o=[],s=0;s<e.length;s++){for(u=e[s],(c=n.createProcessCanvas(u).getContext("2d")).drawImage(u,0,0,u.width,u.height),l=c.getImageData(0,0,u.width,u.height),d=new Uint8Array(u.width*u.height),h=0;h<d.length;h++)p=4*h,d[h]=Math.floor((l.data[p]+l.data[p+1]+l.data[p+2])/3);f={data:d,height:u.height,width:u.width},o.push(f)}m=50/o.length,v=0,n.data=[],g=w().mark((function e(){var r,a,i,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o[y],a=SK(r),i=m/a.length,e.next=5,LK(a,(function(){t(v+=i)}));case 5:s=e.sent,n.data.push({targetImage:r,imageList:a,matchingData:s});case 7:case"end":return e.stop()}}),e)})),y=0;case 7:if(!(y<o.length)){r.next=12;break}return r.delegateYield(g(),"t0",9);case 9:y++,r.next=7;break;case 12:for(b=0;b<o.length;b++)x=TK(o[b]),n.data[b].trackingImageList=x;return r.next=15,n.compileTrack({progressCallback:t,targetImages:o,basePercent:50});case 15:for(k=r.sent,S=0;S<o.length;S++)n.data[S].trackingData=k[S];a(n.data);case 18:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())}},{key:"exportData",value:function(){for(var e=[],t=0;t<this.data.length;t++)e.push({targetImage:{width:this.data[t].targetImage.width,height:this.data[t].targetImage.height},trackingData:this.data[t].trackingData,matchingData:this.data[t].matchingData});return MK.encode({v:2,dataList:e})}},{key:"importData",value:function(e){var t=MK.decode(new Uint8Array(e));if(!t.v||2!==t.v)return console.error("Your compiled .mind might be outdated. Please recompile"),[];var n=t.dataList;this.data=[];for(var r=0;r<n.length;r++)this.data.push({targetImage:n[r].targetImage,trackingData:n[r].trackingData,matchingData:n[r].matchingData});return this.data}},{key:"createProcessCanvas",value:function(e){console.warn("missing createProcessCanvas implementation")}},{key:"compileTrack",value:function(e){e.progressCallback,e.targetImages,e.basePercent;console.warn("missing compileTrack implementation")}}]),e}(),LK=function(){var e=S(w().mark((function e(t,n){var r,a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],a=w().mark((function e(a){var i,o;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t[a],o=new xK(i.width,i.height),e.next=3,Ux();case 3:Rf((function(){var e=ip(i.data,[i.data.length],"float32").reshape([i.height,i.width]),t=o.detect(e).featurePoints,s=t.filter((function(e){return e.maxima})),u=t.filter((function(e){return!e.maxima})),c=EK({points:s}),l=EK({points:u});r.push({maximaPoints:s,minimaPoints:u,maximaPointsCluster:c,minimaPointsCluster:l,width:i.width,height:i.height,scale:i.scale}),n(a)}));case 4:case"end":return e.stop()}}),e)})),i=0;case 3:if(!(i<t.length)){e.next=8;break}return e.delegateYield(a(i),"t0",5);case 5:i++,e.next=3;break;case 8:return e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),AK="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2NsYXNzIHp7Y29uc3RydWN0b3Iocyx0LG8pe3RoaXMuY3Vtc3VtPVtdO2ZvcihsZXQgZT0wO2U8bztlKyspe3RoaXMuY3Vtc3VtLnB1c2goW10pO2ZvcihsZXQgbj0wO248dDtuKyspdGhpcy5jdW1zdW1bZV0ucHVzaCgwKX10aGlzLmN1bXN1bVswXVswXT1zWzBdO2ZvcihsZXQgZT0xO2U8dDtlKyspdGhpcy5jdW1zdW1bMF1bZV09dGhpcy5jdW1zdW1bMF1bZS0xXStzW2VdO2ZvcihsZXQgZT0xO2U8bztlKyspdGhpcy5jdW1zdW1bZV1bMF09dGhpcy5jdW1zdW1bZS0xXVswXStzW2UqdF07Zm9yKGxldCBlPTE7ZTxvO2UrKylmb3IobGV0IG49MTtuPHQ7bisrKXRoaXMuY3Vtc3VtW2VdW25dPXNbZSp0K25dK3RoaXMuY3Vtc3VtW2UtMV1bbl0rdGhpcy5jdW1zdW1bZV1bbi0xXS10aGlzLmN1bXN1bVtlLTFdW24tMV19cXVlcnkocyx0LG8sZSl7bGV0IG49dGhpcy5jdW1zdW1bZV1bb107cmV0dXJuIHQ+MCYmKG4tPXRoaXMuY3Vtc3VtW3QtMV1bb10pLHM+MCYmKG4tPXRoaXMuY3Vtc3VtW2VdW3MtMV0pLHM+MCYmdD4wJiYobis9dGhpcy5jdW1zdW1bdC0xXVtzLTFdKSxufX1jb25zdCBDPTEwLGI9MixNPTYsRj01LEk9Ljk1LEw9LjksTz0uMixaPTgsTj0yNCoyLzMsVT1yPT57Y29uc3R7ZGF0YTpzLHdpZHRoOnQsaGVpZ2h0Om8sc2NhbGU6ZX09cixuPVt0Km9dO2ZvcihsZXQgaT0wO2k8bi5sZW5ndGg7aSsrKW5baV09ITE7Y29uc3QgYT1uZXcgRmxvYXQzMkFycmF5KHMubGVuZ3RoKTtmb3IobGV0IGk9MDtpPHQ7aSsrKWFbaV09LTEsYVt0KihvLTEpK2ldPS0xO2ZvcihsZXQgaT0wO2k8bztpKyspYVtpKnRdPS0xLGFbaSp0K3QtMV09LTE7Zm9yKGxldCBpPTE7aTx0LTE7aSsrKWZvcihsZXQgcD0xO3A8by0xO3ArKyl7bGV0IGY9aSt0KnAsaD0wLGM9MDtmb3IobGV0IHU9LTE7dTw9MTt1KyspaCs9c1tmK3QqdSsxXS1zW2YrdCp1LTFdLGMrPXNbZit0K3VdLXNbZi10K3VdO2gvPTMqMjU2LGMvPTMqMjU2LGFbZl09TWF0aC5zcXJ0KChoKmgrYypjKS8yKX1jb25zdCBnPW5ldyBVaW50MzJBcnJheSgxZTMpO2ZvcihsZXQgaT0wO2k8MWUzO2krKylnW2ldPTA7Y29uc3QgZD1bLTEsMSwtdCx0XTtmb3IobGV0IGk9MTtpPHQtMTtpKyspZm9yKGxldCBwPTE7cDxvLTE7cCsrKXtsZXQgZj1pK3QqcCxoPSEwO2ZvcihsZXQgYz0wO2M8ZC5sZW5ndGg7YysrKWlmKGFbZl08PWFbZitkW2NdXSl7aD0hMTticmVha31pZihoKXtsZXQgYz1NYXRoLmZsb29yKGFbZl0qMWUzKTtjPjk5OSYmKGM9OTk5KSxjPDAmJihjPTApLGdbY10rPTEsbltmXT0hMH19Y29uc3Qgdz0uMDIqdCpvO2xldCBqPTk5OSxFPTA7Zm9yKDtqPj0wJiYoRSs9Z1tqXSwhKEU+dykpOylqLS07Zm9yKGxldCBpPTA7aTxuLmxlbmd0aDtpKyspbltpXSYmYVtpXSoxZTM8aiYmKG5baV09ITEpO2NvbnN0IGw9W107Zm9yKGxldCBpPTA7aTxzLmxlbmd0aDtpKyspbFtpXT1zW2ldKnNbaV07Y29uc3QgUz1uZXcgeihzLHQsbyksRD1uZXcgeihsLHQsbyksaz1uZXcgRmxvYXQzMkFycmF5KHMubGVuZ3RoKTtmb3IobGV0IGk9MDtpPHQ7aSsrKWZvcihsZXQgcD0wO3A8bztwKyspe2NvbnN0IGY9cCp0K2k7aWYoIW5bZl0pe2tbZl09MTtjb250aW51ZX1jb25zdCBoPVAoe2ltYWdlOnIsY3g6aSxjeTpwLHNkVGhyZXNoOkYsaW1hZ2VEYXRhQ3Vtc3VtOlMsaW1hZ2VEYXRhU3FyQ3Vtc3VtOkR9KTtpZihoPT09bnVsbCl7a1tmXT0xO2NvbnRpbnVlfWxldCBjPS0xO2ZvcihsZXQgdT0tQzt1PD1DO3UrKyl7Zm9yKGxldCBtPS1DO208PUM7bSsrKXtpZihtKm0rdSp1PD1iKmIpY29udGludWU7Y29uc3QgeD1SKHtpbWFnZTpyLGN4OmkrbSxjeTpwK3UsdmxlbjpoLHR4OmksdHk6cCxpbWFnZURhdGFDdW1zdW06UyxpbWFnZURhdGFTcXJDdW1zdW06RH0pO2lmKHghPT1udWxsJiZ4PmMmJihjPXgsYz5JKSlicmVha31pZihjPkkpYnJlYWt9a1tmXT1jfXJldHVybiBWKHtpbWFnZTpyLGZlYXR1cmVNYXA6ayx0ZW1wbGF0ZVNpemU6TSxzZWFyY2hTaXplOmIsb2NjU2l6ZTpOLG1heFNpbVRocmVzaDpMLG1pblNpbVRocmVzaDpPLHNkVGhyZXNoOlosaW1hZ2VEYXRhQ3Vtc3VtOlMsaW1hZ2VEYXRhU3FyQ3Vtc3VtOkR9KX0sVj1yPT57bGV0e2ltYWdlOnMsZmVhdHVyZU1hcDp0LHRlbXBsYXRlU2l6ZTpvLHNlYXJjaFNpemU6ZSxvY2NTaXplOm4sbWF4U2ltVGhyZXNoOmEsbWluU2ltVGhyZXNoOmcsc2RUaHJlc2g6ZCxpbWFnZURhdGFDdW1zdW06dyxpbWFnZURhdGFTcXJDdW1zdW06an09cjtjb25zdHtkYXRhOkUsd2lkdGg6bCxoZWlnaHQ6UyxzY2FsZTpEfT1zO249TWF0aC5mbG9vcihNYXRoLm1pbihzLndpZHRoLHMuaGVpZ2h0KS8xMCk7Y29uc3Qgaz0obyoyKzEpKjMsQT1NYXRoLmZsb29yKGwvayksaT1NYXRoLmZsb29yKFMvayk7bGV0IHA9TWF0aC5mbG9vcihsL24pKk1hdGguZmxvb3IoUy9uKStBKmk7Y29uc3QgZj1bXSxoPW5ldyBGbG9hdDMyQXJyYXkoRS5sZW5ndGgpO2ZvcihsZXQgdT0wO3U8aC5sZW5ndGg7dSsrKWhbdV09dFt1XTtsZXQgYz0wO2Zvcig7YzxwOyl7bGV0IHU9YSxtPS0xLHg9LTE7Zm9yKGxldCB5PTA7eTxTO3krKylmb3IobGV0IFQ9MDtUPGw7VCsrKWhbeSpsK1RdPHUmJih1PWhbeSpsK1RdLG09VCx4PXkpO2lmKG09PT0tMSlicmVhaztjb25zdCB2PVAoe2ltYWdlOnMsY3g6bSxjeTp4LHNkVGhyZXNoOjAsaW1hZ2VEYXRhQ3Vtc3VtOncsaW1hZ2VEYXRhU3FyQ3Vtc3VtOmp9KTtpZih2PT09bnVsbCl7aFt4KmwrbV09MTtjb250aW51ZX1pZih2LyhvKjIrMSk8ZCl7aFt4KmwrbV09MTtjb250aW51ZX1sZXQgcT0xLF89LTE7Zm9yKGxldCB5PS1lO3k8PWU7eSsrKXtmb3IobGV0IFQ9LWU7VDw9ZTtUKyspe2lmKFQqVCt5Knk+ZSplfHxUPT09MCYmeT09PTApY29udGludWU7Y29uc3QgSD1SKHtpbWFnZTpzLHZsZW46dixjeDptK1QsY3k6eCt5LHR4Om0sdHk6eCxpbWFnZURhdGFDdW1zdW06dyxpbWFnZURhdGFTcXJDdW1zdW06an0pO2lmKEghPT1udWxsJiYoSDxxJiYocT1ILHE8ZyYmcTx1KXx8SD5fJiYoXz1ILF8+Ljk5KSkpYnJlYWt9aWYocTxnJiZxPHV8fF8+Ljk5KWJyZWFrfWlmKHE8ZyYmcTx1fHxfPi45OSl7aFt4KmwrbV09MTtjb250aW51ZX1mLnB1c2goe3g6bSx5Onh9KSxjKz0xO2ZvcihsZXQgeT0tbjt5PD1uO3krKylmb3IobGV0IFQ9LW47VDw9bjtUKyspeCt5PDB8fHgreT49U3x8bStUPDB8fG0rVD49bHx8KGhbKHgreSkqbCsobStUKV09MSl9cmV0dXJuIGZ9LFA9KHtpbWFnZTpyLGN4OnMsY3k6dCxzZFRocmVzaDpvLGltYWdlRGF0YUN1bXN1bTplLGltYWdlRGF0YVNxckN1bXN1bTpufSk9PntpZihzLU08MHx8cytNPj1yLndpZHRofHx0LU08MHx8dCtNPj1yLmhlaWdodClyZXR1cm4gbnVsbDtjb25zdCBhPTIqTSsxLGc9YSphO2xldCBkPWUucXVlcnkocy1NLHQtTSxzK00sdCtNKTtkLz1nO2xldCB3PW4ucXVlcnkocy1NLHQtTSxzK00sdCtNKTtyZXR1cm4gdy09MipkKmUucXVlcnkocy1NLHQtTSxzK00sdCtNKSx3Kz1nKmQqZCx3L2c8bypvP251bGw6KHc9TWF0aC5zcXJ0KHcpLHcpfSxSPXI9Pntjb25zdHtpbWFnZTpzLGN4OnQsY3k6byx2bGVuOmUsdHg6bix0eTphLGltYWdlRGF0YUN1bXN1bTpnLGltYWdlRGF0YVNxckN1bXN1bTpkfT1yLHtkYXRhOncsd2lkdGg6aixoZWlnaHQ6RX09cyxsPU07aWYodC1sPDB8fHQrbD49anx8by1sPDB8fG8rbD49RSlyZXR1cm4gbnVsbDtjb25zdCBTPTIqbCsxO2xldCBEPWcucXVlcnkodC1sLG8tbCx0K2wsbytsKSxrPWQucXVlcnkodC1sLG8tbCx0K2wsbytsKSxBPTAsaT0oby1sKSpqKyh0LWwpLHA9KGEtbCkqaisobi1sKSxmPWotUztmb3IobGV0IG09MDttPFM7bSsrKXtmb3IobGV0IHg9MDt4PFM7eCsrKUErPXdbaV0qd1twXSxpKz0xLHArPTE7aSs9ZixwKz1mfWxldCBoPWcucXVlcnkobi1sLGEtbCxuK2wsYStsKTtoLz1TKlMsQS09aCpEO2xldCBjPWstRCpELyhTKlMpO3JldHVybiBjPT0wP251bGw6KGM9TWF0aC5zcXJ0KGMpLDEqQS8oZSpjKSl9LFc9KHIscyk9Pntjb25zdCB0PVtdO2ZvcihsZXQgbz0wO288ci5sZW5ndGg7bysrKXtjb25zdCBlPXJbb10sbj1VKGUpLGE9e2RhdGE6ZS5kYXRhLHNjYWxlOmUuc2NhbGUsd2lkdGg6ZS53aWR0aCxoZWlnaHQ6ZS5oZWlnaHQscG9pbnRzOm59O3QucHVzaChhKSxzKG8pfXJldHVybiB0fSxYPSh7aW1hZ2U6cixyYXRpbzpzfSk9Pntjb25zdCB0PU1hdGgucm91bmQoci53aWR0aCpzKSxvPU1hdGgucm91bmQoci5oZWlnaHQqcyksZT1uZXcgVWludDhBcnJheSh0Km8pO2ZvcihsZXQgbj0wO248dDtuKyspe2xldCBhPU1hdGgucm91bmQoMSpuL3MpLGc9TWF0aC5yb3VuZCgxKihuKzEpL3MpLTE7Zz49ci53aWR0aCYmKGc9ci53aWR0aC0xKTtmb3IobGV0IGQ9MDtkPG87ZCsrKXtsZXQgdz1NYXRoLnJvdW5kKDEqZC9zKSxqPU1hdGgucm91bmQoMSooZCsxKS9zKS0xO2o+PXIuaGVpZ2h0JiYoaj1yLmhlaWdodC0xKTtsZXQgRT0wLGw9MDtmb3IobGV0IFM9YTtTPD1nO1MrKylmb3IobGV0IEQ9dztEPD1qO0QrKylFKz0xKnIuZGF0YVtEKnIud2lkdGgrU10sbCs9MTtlW2QqdCtuXT1NYXRoLmZsb29yKEUvbCl9fXJldHVybntkYXRhOmUsd2lkdGg6dCxoZWlnaHQ6b319LFk9cj0+e2NvbnN0IHM9TWF0aC5taW4oci53aWR0aCxyLmhlaWdodCksdD1bXSxvPVtdO3QucHVzaCgyNTYvcyksdC5wdXNoKDEyOC9zKTtmb3IobGV0IGU9MDtlPHQubGVuZ3RoO2UrKylvLnB1c2goT2JqZWN0LmFzc2lnbihYKHtpbWFnZTpyLHJhdGlvOnRbZV19KSx7c2NhbGU6dFtlXX0pKTtyZXR1cm4gb307b25tZXNzYWdlPXI9Pntjb25zdHtkYXRhOnN9PXI7aWYocy50eXBlPT09ImNvbXBpbGUiKXtjb25zdHt0YXJnZXRJbWFnZXM6dH09cyxvPTEwMC90Lmxlbmd0aDtsZXQgZT0wO2NvbnN0IG49W107Zm9yKGxldCBhPTA7YTx0Lmxlbmd0aDthKyspe2NvbnN0IGc9dFthXSxkPVkoZyksdz1vL2QubGVuZ3RoLGo9VyhkLEU9PntlKz13LHBvc3RNZXNzYWdlKHt0eXBlOiJwcm9ncmVzcyIscGVyY2VudDplfSl9KTtuLnB1c2goail9cG9zdE1lc3NhZ2Uoe3R5cGU6ImNvbXBpbGVEb25lIixsaXN0Om59KX19fSkoKTsK",PK=typeof window<"u"&&window.Blob&&new Blob([atob(AK)],{type:"text/javascript;charset=utf-8"});function DK(){var e=PK&&(window.URL||window.webkitURL).createObjectURL(PK);try{return e?new Worker(e):new Worker("data:application/javascript;base64,"+AK)}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}var OK=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n,[{key:"createProcessCanvas",value:function(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t}},{key:"compileTrack",value:function(e){var t=e.progressCallback,n=e.targetImages,r=e.basePercent;return new Promise((function(e,a){var i=new DK;i.onmessage=function(n){"progress"===n.data.type?t(r+n.data.percent*r/100):"compileDone"===n.data.type&&e(n.data.list)},i.postMessage({type:"compile",targetImages:n})}))}}]),n}(RK),zK=function(){function e(t,n){T(this,e),this.width=t,this.height=n,this.texShape=[n,t];var r=document.createElement("canvas").getContext("2d");r.canvas.width=t,r.canvas.height=n,this.context=r,this.program=this.buildProgram(t,n);var a=Df();this.tempPixelHandle=a.makeTensorInfo(this.texShape,"float32"),a.texData.get(this.tempPixelHandle.dataId).usage=2}return E(e,[{key:"_loadInput",value:function(e){return Rf((function(){var t=Qf(e);return t=t.mean(2)}))}},{key:"loadInput",value:function(e){this.context.drawImage(e,0,0,this.width,this.height);var t=Df();return t.gpgpu.uploadPixelDataToTexture(t.getTexture(this.tempPixelHandle.dataId),this.context.canvas),this._compileAndRun(this.program,[this.tempPixelHandle])}},{key:"buildProgram",value:function(e,t){var n=2===Qs().getNumber("WEBGL_VERSION")?"texture":"texture2D";return{variableNames:["A"],outputShape:this.texShape,userCode:"\n\tvoid main() {\n\t  ivec2 coords = getOutputCoords();\n\t  int texR = coords[0];\n\t  int texC = coords[1];\n\t  vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(e,".0, ").concat(t,".0);\n\n\t  vec4 values = ").concat(n,"(A, uv);\n\t  setOutput((0.299 * values.r + 0.587 * values.g + 0.114 * values.b) * 255.0);\n\t}\n      ")}}},{key:"_compileAndRun",value:function(e,t){var n=Df().compileAndRun(e,t);return Mf().makeTensorFromDataId(n.dataId,n.shape,n.dtype)}},{key:"_runWebGLProgram",value:function(e,t,n){var r=Df().runWebGLProgram(e,t,n);return Mf().makeTensorFromDataId(r.dataId,r.shape,r.dtype)}}]),e}(),FK={memory:Nf,nextFrame:Ux},GK=function(){function e(t){var n=this,r=t.inputWidth,a=t.inputHeight,i=t.onUpdate,o=void 0===i?null:i,s=t.debugMode,u=void 0!==s&&s,c=t.maxTrack,l=void 0===c?1:c,d=t.warmupTolerance,h=void 0===d?null:d,p=t.missTolerance,f=void 0===p?null:p,m=t.filterMinCF,v=void 0===m?null:m,g=t.filterBeta,y=void 0===g?null:g;T(this,e),this.inputWidth=r,this.inputHeight=a,this.maxTrack=l,this.filterMinCF=null===v?.001:v,this.filterBeta=null===y?1e3:y,this.warmupTolerance=null===h?5:h,this.missTolerance=null===f?5:f,this.cropDetector=new wK(this.inputWidth,this.inputHeight,u),this.inputLoader=new zK(this.inputWidth,this.inputHeight),this.markerDimensions=null,this.onUpdate=o,this.debugMode=u,this.processingVideo=!1,this.interestedTargetIndex=-1,this.trackingStates=[];var b=45*Math.PI/180,x=this.inputHeight/2/Math.tan(b/2);this.projectionTransform=[[x,0,this.inputWidth/2],[0,x,this.inputHeight/2],[0,0,1]],this.projectionMatrix=this._glProjectionMatrix({projectionTransform:this.projectionTransform,width:this.inputWidth,height:this.inputHeight,near:10,far:1e5}),this.worker=new WZ,this.workerMatchDone=null,this.workerTrackDone=null,this.worker.onmessage=function(e){"matchDone"===e.data.type&&null!==n.workerMatchDone&&n.workerMatchDone(e.data),"trackUpdateDone"===e.data.type&&null!==n.workerTrackDone&&n.workerTrackDone(e.data)}}return E(e,[{key:"showTFStats",value:function(){console.log(FK.memory().numTensors),console.table(FK.memory())}},{key:"addImageTargets",value:function(e){var t=this;return new Promise(function(){var n=S(w().mark((function n(r,a){var i,o;return w().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,fetch(e);case 2:return n.next=4,n.sent.arrayBuffer();case 4:i=n.sent,o=t.addImageTargetsFromBuffer(i),r(o);case 7:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}())}},{key:"addImageTargetsFromBuffer",value:function(e){for(var t=(new OK).importData(e),n=[],r=[],a=[],i=0;i<t.length;i++)r.push(t[i].matchingData),n.push(t[i].trackingData),a.push([t[i].targetImage.width,t[i].targetImage.height]);return this.tracker=new XZ(a,n,this.projectionTransform,this.inputWidth,this.inputHeight,this.debugMode),this.worker.postMessage({type:"setup",inputWidth:this.inputWidth,inputHeight:this.inputHeight,projectionTransform:this.projectionTransform,debugMode:this.debugMode,matchingDataList:r}),this.markerDimensions=a,{dimensions:a,matchingDataList:r,trackingDataList:n}}},{key:"dispose",value:function(){this.stopProcessVideo(),this.worker.postMessage({type:"dispose"})}},{key:"dummyRun",value:function(e){var t=this.inputLoader.loadInput(e);this.cropDetector.detect(t),this.tracker.dummyRun(t),t.dispose()}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getWorldMatrix",value:function(e,t){return this._glModelViewMatrix(e,t)}},{key:"_detectAndMatch",value:function(){var e=S(w().mark((function e(t,n){var r,a,i,o,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.cropDetector.detectMoving(t),a=r.featurePoints,e.next=4,this._workerMatch(a,n);case 4:return i=e.sent,o=i.targetIndex,s=i.modelViewTransform,e.abrupt("return",{targetIndex:o,modelViewTransform:s});case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_trackAndUpdate",value:function(){var e=S(w().mark((function e(t,n,r){var a,i,o;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.tracker.track(t,n,r),i=a.worldCoords,o=a.screenCoords,!(i.length<4)){e.next=5;break}e.t0=null,e.next=8;break;case 5:return e.next=7,this._workerTrackUpdate(n,{worldCoords:i,screenCoords:o});case 7:e.t0=e.sent;case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"processVideo",value:function(e){var t=this;if(!this.processingVideo){this.processingVideo=!0,this.trackingStates=[];for(var n=0;n<this.markerDimensions.length;n++)this.trackingStates.push({showing:!1,isTracking:!1,currentModelViewTransform:null,trackCount:0,trackMiss:0,filter:new $o({minCutOff:this.filterMinCF,beta:this.filterBeta})});S(w().mark((function n(){var r,a,i,o,s,u,c,l,d,h,p,f;return w().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.processingVideo){n.next=29;break}if(r=t.inputLoader.loadInput(e),!(t.trackingStates.reduce((function(e,t){return e+(t.isTracking?1:0)}),0)<t.maxTrack)){n.next=11;break}for(a=[],i=0;i<t.trackingStates.length;i++)!0!==t.trackingStates[i].isTracking&&(-1!==t.interestedTargetIndex&&t.interestedTargetIndex!==i||a.push(i));return n.next=7,t._detectAndMatch(r,a);case 7:o=n.sent,s=o.targetIndex,u=o.modelViewTransform,-1!==s&&(t.trackingStates[s].isTracking=!0,t.trackingStates[s].currentModelViewTransform=u);case 11:c=0;case 12:if(!(c<t.trackingStates.length)){n.next=23;break}if(!(l=t.trackingStates[c]).isTracking){n.next=19;break}return n.next=17,t._trackAndUpdate(r,l.currentModelViewTransform,c);case 17:null===(d=n.sent)?l.isTracking=!1:l.currentModelViewTransform=d;case 19:if(l.showing||l.isTracking&&(l.trackMiss=0,l.trackCount+=1,l.trackCount>t.warmupTolerance&&(l.showing=!0,l.trackingMatrix=null,l.filter.reset())),l.showing&&(l.isTracking?l.trackMiss=0:(l.trackCount=0,l.trackMiss+=1,l.trackMiss>t.missTolerance&&(l.showing=!1,l.trackingMatrix=null,t.onUpdate&&t.onUpdate({type:"updateMatrix",targetIndex:c,worldMatrix:null})))),l.showing){for(h=t._glModelViewMatrix(l.currentModelViewTransform,c),l.trackingMatrix=l.filter.filter(Date.now(),h),p=[],f=0;f<l.trackingMatrix.length;f++)p[f]=l.trackingMatrix[f];t.onUpdate&&t.onUpdate({type:"updateMatrix",targetIndex:c,worldMatrix:p})}case 20:c++,n.next=12;break;case 23:return r.dispose(),t.onUpdate&&t.onUpdate({type:"processDone"}),n.next=27,FK.nextFrame();case 27:n.next=0;break;case 29:case"end":return n.stop()}}),n)})))()}}},{key:"stopProcessVideo",value:function(){this.processingVideo=!1}},{key:"detect",value:function(){var e=S(w().mark((function e(t){var n,r,a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.inputLoader.loadInput(t),e.next=3,this.cropDetector.detect(n);case 3:return r=e.sent,a=r.featurePoints,i=r.debugExtra,e.abrupt("return",(n.dispose(),{featurePoints:a,debugExtra:i}));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"match",value:function(){var e=S(w().mark((function e(t,n){var r,a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._workerMatch(t,[n]);case 2:return r=e.sent,a=r.modelViewTransform,i=r.debugExtra,e.abrupt("return",{modelViewTransform:a,debugExtra:i});case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"track",value:function(){var e=S(w().mark((function e(t,n,r){var a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.inputLoader.loadInput(t),i=this.tracker.track(a,n,r),e.abrupt("return",(a.dispose(),i));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"trackUpdate",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n.worldCoords.length<4)){e.next=4;break}e.t0=null,e.next=7;break;case 4:return e.next=6,this._workerTrackUpdate(t,n);case 6:e.t0=e.sent;case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_workerMatch",value:function(e,t){var n=this;return new Promise(function(){var r=S(w().mark((function r(a,i){return w().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n.workerMatchDone=function(e){a({targetIndex:e.targetIndex,modelViewTransform:e.modelViewTransform,debugExtra:e.debugExtra})},n.worker.postMessage({type:"match",featurePoints:e,targetIndexes:t});case 1:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())}},{key:"_workerTrackUpdate",value:function(e,t){var n=this;return new Promise(function(){var r=S(w().mark((function r(a,i){var o,s;return w().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n.workerTrackDone=function(e){a(e.modelViewTransform)},o=t.worldCoords,s=t.screenCoords,n.worker.postMessage({type:"trackUpdate",modelViewTransform:e,worldCoords:o,screenCoords:s});case 3:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())}},{key:"_glModelViewMatrix",value:function(e,t){var n=this.markerDimensions[t][1];return[e[0][0],-e[1][0],-e[2][0],0,-e[0][1],e[1][1],e[2][1],0,-e[0][2],e[1][2],e[2][2],0,e[0][1]*n+e[0][3],-(e[1][1]*n+e[1][3]),-(e[2][1]*n+e[2][3]),1]}},{key:"_glProjectionMatrix",value:function(e){for(var t=e.projectionTransform,n=e.width,r=e.height,a=e.near,i=e.far,o=[[2*t[0][0]/n,0,-(2*t[0][2]/n-1),0],[0,2*t[1][1]/r,-(2*t[1][2]/r-1),0],[0,0,-(i+a)/(i-a),-2*i*a/(i-a)],[0,0,-1,0]],s=[],u=0;u<4;u++)for(var c=0;c<4;c++)s.push(o[c][u]);return s}}]),e}(),WK=new kt,VK=new wt,UK=new kt,XK=new qt,BK=new qt,HK=E((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};T(this,e);var n,r,a,i,o=this,s={camera:{fov:0,style:""},objects:new WeakMap},u=void 0!==t.element?t.element:document.createElement("div");u.style.overflow="hidden",this.domElement=u;var c=document.createElement("div");c.style.transformOrigin="0 0",c.style.pointerEvents="none",u.appendChild(c);var l=document.createElement("div");function d(e){return Math.abs(e)<1e-10?0:e}function h(e){var t=e.elements;return"matrix3d("+d(t[0])+","+d(-t[1])+","+d(t[2])+","+d(t[3])+","+d(t[4])+","+d(-t[5])+","+d(t[6])+","+d(t[7])+","+d(t[8])+","+d(-t[9])+","+d(t[10])+","+d(t[11])+","+d(t[12])+","+d(-t[13])+","+d(t[14])+","+d(t[15])+")"}function p(e){var t=e.elements;return"translate(-50%,-50%)"+("matrix3d("+d(t[0])+","+d(t[1])+","+d(t[2])+","+d(t[3])+","+d(-t[4])+","+d(-t[5])+","+d(-t[6])+","+d(-t[7])+","+d(t[8])+","+d(t[9])+","+d(t[10])+","+d(t[11])+","+d(t[12])+","+d(t[13])+","+d(t[14])+","+d(t[15])+")")}function f(e,t,n,r){if(e.isCSS3DObject){var a=!0===e.visible&&!0===e.layers.test(n.layers);if(e.element.style.display=!0===a?"":"none",!0===a){var i;e.onBeforeRender(o,t,n),e.isCSS3DSprite?(XK.copy(n.matrixWorldInverse),XK.transpose(),0!==e.rotation2D&&XK.multiply(BK.makeRotationZ(e.rotation2D)),e.matrixWorld.decompose(WK,VK,UK),XK.setPosition(WK),XK.scale(UK),XK.elements[3]=0,XK.elements[7]=0,XK.elements[11]=0,XK.elements[15]=1,i=p(XK)):i=p(e.matrixWorld);var u=e.element,c=s.objects.get(e);if(void 0===c||c.style!==i){u.style.transform=i;var d={style:i};s.objects.set(e,d)}u.parentNode!==l&&l.appendChild(u),e.onAfterRender(o,t,n)}}for(var h=0,m=e.children.length;h<m;h++)f(e.children[h],t,n,r)}l.style.transformStyle="preserve-3d",c.appendChild(l),this.getSize=function(){return{width:n,height:r}},this.render=function(e,t){var o,u,p=t.projectionMatrix.elements[5]*i;s.camera.fov!==p&&(c.style.perspective=t.isPerspectiveCamera?p+"px":"",s.camera.fov=p),t.view&&t.view.enabled?(c.style.transform="translate( ".concat(-t.view.offsetX*(n/t.view.width),"px, ").concat(-t.view.offsetY*(r/t.view.height),"px )"),c.style.transform+="scale( ".concat(t.view.fullWidth/t.view.width,", ").concat(t.view.fullHeight/t.view.height," )")):c.style.transform="",!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),t.isOrthographicCamera&&(o=-(t.right+t.left)/2,u=(t.top+t.bottom)/2);var m=t.view&&t.view.enabled?t.view.height/t.view.fullHeight:1,v=t.isOrthographicCamera?"scale( ".concat(m," )")+"scale("+p+")translate("+d(o)+"px,"+d(u)+"px)"+h(t.matrixWorldInverse):"scale( ".concat(m," )")+"translateZ("+p+"px)"+h(t.matrixWorldInverse),g=v+"translate("+a+"px,"+i+"px)";s.camera.style!==g&&(l.style.transform=g,s.camera.style=g),f(e,e,t,v)},this.setSize=function(e,t){a=(n=e)/2,i=(r=t)/2,u.style.width=e+"px",u.style.height=t+"px",c.style.width=e+"px",c.style.height=t+"px",l.style.width=e+"px",l.style.height=t+"px"}}));function ZK(e){return new Promise((function(e){return setTimeout(e)})).then(e)}var KK=function(){function e(t){if(T(this,e),!Qs().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),(null==t||0===t.length)&&(t="model"),this.modelJsonFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return E(e,[{key:"save",value:function(){var e=S(w().mark((function e(t){var n,r,a,i,o,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(typeof document>"u")){e.next=2;break}throw new Error("Browser downloads are not supported in this environment since `document` is not present");case 2:if(n=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer)){e.next=5;break}throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 5:return r=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],a=yp(t,r),i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),(o=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor).download=this.modelJsonFileName,o.href=i,e.next=10,ZK((function(){return o.dispatchEvent(new MouseEvent("click"))}));case 10:if(null==t.weightData){e.next=16;break}return(s=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=n,e.next=16,ZK((function(){return s.dispatchEvent(new MouseEvent("click"))}));case 16:return e.abrupt("return",{modelArtifactsInfo:kp(t)});case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();KK.URL_SCHEME="downloads://";var jK=function(){function e(t){if(T(this,e),null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received ".concat(t));this.jsonFile=t[0],this.weightsFiles=t.slice(1)}return E(e,[{key:"load",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=new FileReader;r.onload=function(r){var a=JSON.parse(r.target.result),i=a.modelTopology;if(null!=i)if(null!=a.weightsManifest)if(0!==t.weightsFiles.length){var o=xp(a,(function(e){return t.loadWeights(e)}));e(o)}else e({modelTopology:i});else n(new Error("weightManifest field is missing from file ".concat(t.jsonFile.name)));else n(new Error("modelTopology field is missing from file ".concat(t.jsonFile.name)))},r.onerror=function(e){return n("Failed to read model topology and weights manifest JSON from file '".concat(t.jsonFile.name,"'. BrowserFiles supports loading Keras-style tf.Model artifacts only."))},r.readAsText(t.jsonFile)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"loadWeights",value:function(e){var t,n=this,r=[],a=[],i=x(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;r.push.apply(r,b(o.weights)),a.push.apply(a,b(o.paths))}}catch(c){i.e(c)}finally{i.f()}var s=this.checkManifestAndWeightFiles(e),u=a.map((function(e){return n.loadWeightsFile(e,s[e])}));return Promise.all(u).then((function(e){return[r,vp(e)]}))}},{key:"loadWeightsFile",value:function(e,t){return new Promise((function(n,r){var a=new FileReader;a.onload=function(e){var t=e.target.result;n(t)},a.onerror=function(t){return r("Failed to weights data from file of path '".concat(e,"'."))},a.readAsArrayBuffer(t)}))}},{key:"checkManifestAndWeightFiles",value:function(e){var t,n=this,r=[],a=this.weightsFiles.map((function(e){return gp(e.name)})),i={},o=x(e);try{for(o.s();!(t=o.n()).done;){t.value.paths.forEach((function(e){var t=gp(e);if(-1!==r.indexOf(t))throw new Error("Duplicate file basename found in weights manifest: '".concat(t,"'"));if(r.push(t),-1===a.indexOf(t))throw new Error("Weight file with basename '".concat(t,"' is not provided."));i[e]=n.weightsFiles[a.indexOf(t)]}))}}catch(s){o.e(s)}finally{o.f()}if(r.length!==this.weightsFiles.length)throw new Error("Mismatch in the number of files in weights manifest (".concat(r.length,") and the number of weight files provided (").concat(this.weightsFiles.length,")."));return i}}]),e}();_p.registerSaveRouter((function(e){return Qs().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(KK.URL_SCHEME)?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"model";return new KK(e)}(e.slice(KK.URL_SCHEME.length)):null}));var YK=function(){function e(t){T(this,e),this.modelArtifacts=t}return E(e,[{key:"load",value:function(){return this.modelArtifacts}}]),e}(),QK=function(){function e(t){T(this,e),this.saveHandler=t}return E(e,[{key:"save",value:function(e){return this.saveHandler(e)}}]),e}(),JK=E((function e(t){T(this,e),t.load&&(this.load=function(){return Promise.resolve(t.load())}),t.save&&(this.save=function(e){return Promise.resolve(t.save(e))})}));function qK(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new YK(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new YK({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new YK({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))}var $K=Object.freeze(Object.defineProperty({__proto__:null,browserFiles:function(e){return new jK(e)},browserHTTPRequest:If,concatenateArrayBuffers:vp,copyModel:function(e,t){return af.apply(this,arguments)},decodeWeights:lp,encodeWeights:up,fromMemory:function(e,t,n,r){var a=arguments;return new JK(qK.apply(void 0,b(a)))},fromMemorySync:qK,getLoadHandlers:Ep,getModelArtifactsForJSON:xp,getModelArtifactsForJSONSync:bp,getModelArtifactsInfoForJSON:kp,getSaveHandlers:Ip,getWeightSpecs:Sp,http:_f,isHTTPScheme:Sf,listModels:function(){return nf.apply(this,arguments)},loadWeights:yf,moveModel:function(e,t){return of.apply(this,arguments)},registerLoadRouter:function(e){return _p.registerLoadRouter(e)},registerSaveRouter:function(e){return _p.registerSaveRouter(e)},removeModel:function(e){return rf.apply(this,arguments)},weightsLoaderFactory:xf,withSaveHandler:function(e){return new QK(e)},withSaveHandlerSync:function(e){return new QK(e)}},Symbol.toStringTag,{value:"Module"}));var ej=np({confusionMatrix_:function(e,t,n){var r=$h(e,"labels","confusionMatrix"),a=$h(t,"predictions","confusionMatrix");ls(null==n||n>0&&Number.isInteger(n),(function(){return"If provided, numClasses must be a positive integer, but got ".concat(n)})),ls(1===r.rank,(function(){return"Expected the rank of labels to be 1, but got ".concat(r.rank)})),ls(1===a.rank,(function(){return"Expected the rank of predictions to be 1, but got ".concat(a.rank)})),ls(r.shape[0]===a.shape[0],(function(){return"Mismatch in the number of examples: ".concat(r.shape[0]," vs. ").concat(a.shape[0],". Labels and predictions should have the same number of elements.")})),ls(n>0&&Number.isInteger(n),(function(){return"numClasses is required to be a positive integer, but got ".concat(n)}));var i=Cf(hf(r,"int32"),n),o=Cf(hf(a,"int32"),n),s=Gf(i),u=Ef(s,o);return hf(u,"int32")}}),tj=Object.freeze(Object.defineProperty({__proto__:null,confusionMatrix:ej},Symbol.toStringTag,{value:"Module"})),nj=.001,rj=.1;function aj(){return 32===Bh.backend.floatPrecision()?nj:rj}function ij(e,t,n){var r=!0;if((Cs(e)||Cs(t))&&(r=!1),Cs(e)&&Cs(t)&&(r=!0),r){var a=e.constructor.name,i=t.constructor.name;if(a!==i)throw new Error("Arrays are of different type. Actual: ".concat(a,". Expected: ").concat(i))}if(Array.isArray(e)&&Array.isArray(t)){var o=Qh(e),s=Qh(t);if(!ms(o,s))throw new Error("Arrays have different shapes. Actual: [".concat(o,"]. Expected: [").concat(s,"]"))}var u=Cs(e)?e:ps(e),c=Cs(t)?t:ps(t);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: ".concat(u.length," vs expected: ").concat(c.length,".\nActual:   ").concat(u,".\nExpected: ").concat(c,"."));for(var l=0;l<c.length;++l){var d=u[l],h=c[l];if(!n(d,h))throw new Error("Arrays differ: actual[".concat(l,"] = ").concat(d,", expected[").concat(l,"] = ").concat(h,".\nActual:   ").concat(u,".\nExpected: ").concat(c,"."))}typeof expect<"u"&&expect().nothing()}function oj(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}function sj(){return sj=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.play();case 2:if(e.t0="requestVideoFrameCallback"in t,!e.t0){e.next=6;break}return e.next=6,new Promise((function(e){t.requestVideoFrameCallback(e)}));case 6:case"end":return e.stop()}}),e)}))),sj.apply(this,arguments)}var uj=Object.freeze(Object.defineProperty({__proto__:null,TEST_EPSILON_FLOAT16:rj,createVideoElement:function(e){var t=document.createElement("video");return"playsInline"in t&&(t.playsInline=!0),t.muted=!0,t.loop=!0,t.style.position="fixed",t.style.left="0px",t.style.top="0px",t.preload="auto",t.appendChild(e),new Promise((function(e){t.addEventListener("loadeddata",(function(n){return e(t)})),t.load()}))},encodeStrings:function e(t){for(var n=0;n<t.length;n++){var r=t[n];Array.isArray(r)?e(r):t[n]=oh(r)}return t},expectArrayBuffersEqual:function(e,t){var n=new Float32Array(e),r=new Float32Array(t);if(n.length!==r.length)throw new Error("Expected ArrayBuffer to be of length ".concat(r.length,", but it was ").concat(n.length));for(var a=0;a<r.length;a++)if(n[a]!==r[a])throw new Error("Expected ArrayBuffer value at ".concat(a," to be ").concat(r[a]," but got ").concat(n[a]," instead"))},expectArraysClose:function(e,t,n){return null==n&&(n=aj()),ij(e,t,(function(e,t){return oj(e,t,n)}))},expectArraysEqual:function(e,t){var n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return Rs(e)||Rs(e[0])||Rs(t)||Rs(t[0])?ij(e,n,(function(e,t){return e==t})):ij(e,t,(function(e,t){return oj(e,t,0)}))},expectNumbersClose:function(e,t,n){if(null==n&&(n=aj()),!oj(e,t,n))throw new Error("Numbers differ: actual === ".concat(e,", expected === ").concat(t));typeof expect<"u"&&expect().nothing()},expectPromiseToFail:function(e,t){e().then((function(){return t.fail()}),(function(){return t()})),typeof expect<"u"&&expect().nothing()},expectValuesInRange:function(e,t,n){for(var r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error("Value out of range:".concat(e[r]," low: ").concat(t,", high: ").concat(n))},play:function(e){return sj.apply(this,arguments)},testEpsilon:aj},Symbol.toStringTag,{value:"Module"})),cj="3.21.0";var lj=np({addN_:function(e){ls(Array.isArray(e),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),ls(e.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got ".concat(e.length)}));var t=e.map((function(e,t){return $h(e,"tensors".concat(t),"addN")})),n=t[0];t.forEach((function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((function(e){if(!ms(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=t;return Bh.runKernel(iu,r)}});var dj=np({basicLSTMCell_:function(e,t,n,r,a,i){var o=$h(e,"forgetBias","basicLSTMCell"),s=$h(t,"lstmKernel","basicLSTMCell"),u=$h(n,"lstmBias","basicLSTMCell"),c=$h(r,"data","basicLSTMCell"),l=$h(a,"c","basicLSTMCell"),d=$h(i,"h","basicLSTMCell"),h=iv([c,d],1),p=Ef(h,s),f=Im(p,u),m=f.shape[0],v=f.shape[1]/4,g=[m,v],y=sv(f,[0,0],g),b=sv(f,[0,v],g),x=sv(f,[0,2*v],g),w=sv(f,[0,3*v],g),k=Im(Mm(ov(y),uv(b)),Mm(l,ov(Im(o,x))));return[k,Mm(uv(k),ov(w))]}});var hj=np({broadcastArgs_:function(e,t){var n=$h(e,"s0","broadcastArgs","int32"),r=$h(t,"s1","broadcastArgs","int32");if(1!==n.rank)throw new Error("broadcastArgs(): first input must be a vector (rank=1). Has rank ".concat(n.rank));if(1!==r.rank)throw new Error("broadcastArgs(): second input must be a vector (rank=1). Has rank ".concat(r.rank));var a={s0:n,s1:r};return Bh.runKernel(Su,a)}});var pj=np({denseBincount_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=$h(e,"x","denseBincount"),i=$h(t,"weights","denseBincount");ls("int32"===a.dtype,(function(){return"Error in denseBincount: input dtype must be int32, but got ".concat(a.dtype)})),ls(a.rank<=2,(function(){return"Error in denseBincount: input must be at most rank 2, but got rank ".concat(a.rank,".")})),ls(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),ls(i.size===a.size||0===i.size,(function(){return"Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ".concat(a.shape,", weights shape: ").concat(i.shape,".")}));var o={x:a,weights:i},s={size:n,binaryOutput:r};return Bh.runKernel(Vu,o,s)}});var fj=np({diag_:function(e){var t={x:$h(e,"x","diag")};return Bh.runKernel(Zu,t)}});var mj=np({einsum_:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=n.map((function(e,t){return $h(e,"tensors".concat(t),"einsum")})),i={equation:e};return Bh.runKernel(Ju,a,i)}});function vj(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");var r={start:e,stop:t,num:n};return Bh.runKernel(Tc,{},r)}var gj=2147483648;var yj=np({searchSorted_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"left",r=$h(e,"sortedSequence","searchSorted"),a=$h(t,"values","searchSorted"),i=r.shape[r.shape.length-1],o=a.shape[a.shape.length-1],s=nv(r,[-1,i]),u=nv(a,[-1,o]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(fs(u.shape)>=gj)throw new Error("values tensor size must less than ".concat(gj));if(s.shape[1]>=gj)throw new Error("trailing dim_size must less than ".concat(gj," for int32 output type, was ").concat(s.shape[1]));var c={sortedSequence:s,values:u},l={side:n};return Bh.runKernel(wl,c,l)}});function bj(e,t){return yj(e,t,"left")}var xj=np({maxPoolWithArgmax_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i={x:$h(e,"x","maxPoolWithArgmax")},o={filterSize:t,strides:n,pad:r,includeBatchInIndex:a},s=Bh.runKernel(Gc,i,o);return{result:s[0],indexes:s[1]}}});function wj(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).indexing,r=void 0===n?"xy":n;if("xy"!==r&&"ij"!==r)throw new TypeError("".concat(r," is not a valid third argument to meshgrid"));if(void 0===e)return[];var a=$h(e,"x","meshgrid",e instanceof kh?e.dtype:"float32");if(void 0===t)return[a];var i=$h(t,"y","meshgrid",t instanceof kh?t.dtype:"float32"),o=fs(a.shape),s=fs(i.shape);return"xy"===r?(a=nv(a,[1,-1]),i=nv(i,[-1,1]),[Ef(Bg([s,1],a.dtype),a),Ef(i,Bg([1,o],i.dtype))]):(a=nv(a,[-1,1]),i=nv(i,[1,-1]),[Ef(a,Bg([1,s],a.dtype)),Ef(Bg([o,1],i.dtype),i)])}var kj=np({multiRNNCell_:function(e,t,n,r){for(var a=$h(t,"data","multiRNNCell"),i=ep(n,"c","multiRNNCell"),o=ep(r,"h","multiRNNCell"),s=a,u=[],c=0;c<e.length;c++){var l=e[c](s,i[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}for(var d=[],h=[],p=0;p<u.length;p+=2)d.push(u[p]),h.push(u[p+1]);return[d,h]}});var Sj=np({multinomial_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=$h(e,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got ".concat(i,"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(o));n=n||Math.random();var s={logits:1===o?nv(a,[1,-1]):a},u={numSamples:t,seed:n,normalized:r},c=Bh.runKernel(Hc,s,u);return 1===o?nv(c,[c.size]):c}});var Tj=np({outerProduct_:function(e,t){var n=$h(e,"v1","outerProduct"),r=$h(t,"v2","outerProduct");ls(1===n.rank&&1===r.rank,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks ".concat(n.rank," and ").concat(r.rank,".")}));var a=nv(n,[-1,1]),i=nv(r,[1,-1]);return Ef(a,i)}});var _j=np({pad1d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return ls(2===t.length,(function(){return"Invalid number of paddings. Must be length of 2."})),Jg(e,[t],n)}});var Ij=np({pad2d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return ls(2===t.length&&2===t[0].length&&2===t[1].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Jg(e,t,n)}});var Ej=np({pad3d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return ls(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Jg(e,t,n)}});var Cj=np({pad4d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return ls(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Jg(e,t,n)}});var Mj=np({raggedGather_:function(e,t,n,r){var a=e.map((function(e,t){return $h(e,"tensors".concat(t),"raggedGather","int32")})),i={paramsNestedSplits:a,paramsDenseValues:$h(t,"paramsDenseValues","raggedGather"),indices:$h(n,"indices","raggedGather","int32")},o={outputRaggedRank:r},s=Bh.runKernel(il,i,o);return{outputNestedSplits:s.slice(0,s.length-1),outputDenseValues:s[s.length-1]}}});var Nj=np({raggedTensorToTensor_:function(e,t,n,r,a){var i=$h(e,"shape","raggedTensorToTensor","int32"),o=$h(t,"values","raggedTensorToTensor"),s={shape:i,values:o,defaultValue:$h(n,"defaultValue","raggedTensorToTensor",o.dtype),rowPartitionTensors:r.map((function(e,t){return $h(e,"tensors".concat(t),"raggedTensorToTensor","int32")}))},u={rowPartitionTypes:a};return Bh.runKernel(ol,s,u)}});var Rj=np({rand_:function(e,t,n){var r=fs(e),a=null;if(null==n||"float32"===n)a=new Float32Array(r);else if("int32"===n)a=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type ".concat(n));a=new Uint8Array(r)}for(var i=0;i<r;i++)a[i]=t();return Bh.makeTensor(a,e,n)}});var Lj=np({randomGamma_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0;if(null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type ".concat(r));for(var i=new Iy(t,n,r,a),o=df(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var Aj=np({randomStandardNormal_:function(e,t,n){if(null!=t&&"bool"===t)throw new Error("Unsupported data type ".concat(t));return Cy(e,0,1,t,n)}});var Pj=np({reverse1d_:function(e){var t=$h(e,"x","reverse");return ls(1===t.rank,(function(){return"Error in reverse1D: x must be rank 1 but got rank ".concat(t.rank,".")})),Py(t,0)}});var Dj=np({reverse2d_:function(e,t){var n=$h(e,"x","reverse");return ls(2===n.rank,(function(){return"Error in reverse2D: x must be rank 2 but got rank ".concat(n.rank,".")})),Py(n,t)}});var Oj=np({reverse3d_:function(e,t){var n=$h(e,"x","reverse");return ls(3===n.rank,(function(){return"Error in reverse3D: x must be rank 3 but got rank ".concat(n.rank,".")})),Py(n,t)}});var zj=np({reverse4d_:function(e,t){var n=$h(e,"x","reverse");return ls(4===n.rank,(function(){return"Error in reverse4D: x must be rank 4 but got rank ".concat(n.rank,".")})),Py(n,t)}});function Fj(){return Fj=S(w().mark((function e(t,n){var r,a,i,o,s,u,c,l,d,h,p;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=$h(t,"x","setdiff1d"),a=$h(n,"y","setdiff1d"),ls(r.dtype===a.dtype,(function(){return"x and y should have the same dtype, but got x (".concat(r.dtype,") and y (").concat(a.dtype,").")})),ls(1===r.rank,(function(){return"x should be 1D tensor, but got x (".concat(r.shape,").")})),ls(1===a.rank,(function(){return"y should be 1D tensor, but got y (".concat(a.shape,").")})),e.next=4,r.data();case 4:return i=e.sent,e.next=7,a.data();case 7:for(o=e.sent,s=new Set(o),u=0,c=0;c<i.length;c++)s.has(i[c])||u++;for(l=new bh([u],r.dtype),d=new bh([u],"int32"),h=0,p=0;h<i.length;h++)s.has(i[h])||(l.values[p]=i[h],d.values[p]=h,p++);return e.abrupt("return",[l.toTensor(),d.toTensor()]);case 14:case"end":return e.stop()}}),e)}))),Fj.apply(this,arguments)}var Gj=function(e,t){return Fj.apply(this,arguments)};function Wj(e,t,n){if(hs(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=Qh(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return ap(e,t,r,n)}function Vj(e,t,n){if(hs(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=Qh(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return ap(e,t,r,n)}function Uj(e,t,n){if(hs(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=Qh(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return ap(e,t=t||r,r,n)}function Xj(e,t){return yj(e,t,"right")}function Bj(){return Bj=S(w().mark((function e(t){var n,r,a;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=$h(t,"condition","whereAsync","bool"),e.next=3,n.data();case 3:return r=e.sent,a=hb(n.shape,r),e.abrupt("return",(t!==n&&n.dispose(),a));case 6:case"end":return e.stop()}}),e)}))),Bj.apply(this,arguments)}var Hj=function(e){return Bj.apply(this,arguments)};function Zj(){return Zj=S(w().mark((function e(t,n,r){var a,i,o,s,u,c,l,d,h,p,f,m,v;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=$h(t,"tensor","boolMask"),i=$h(n,"mask","boolMask","bool"),o=null!==r&&void 0!==r?r:0,s=i.rank,u=a.shape,ls(s>0,(function(){return"mask cannot be scalar"})),ds(u.slice(o,o+s),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),c=1,l=o;l<o+s;l++)c*=u[l];return d=u.slice(0,o).concat([c],u.slice(o+s)),h=nv(a,d),p=nv(i,[-1]),e.next=9,Hj(p);case 9:return f=e.sent,m=$y(f,[1]),v=mg(h,m,o),e.abrupt("return",(t!==a&&a.dispose(),n!==i&&i.dispose(),m.dispose(),h.dispose(),p.dispose(),f.dispose(),v));case 13:case"end":return e.stop()}}),e)}))),Zj.apply(this,arguments)}var Kj=function(e,t,n){return Zj.apply(this,arguments)};var jj=np({movingAverage_:function(e,t,n,r){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=$h(e,"v","movingAverage"),o=$h(t,"x","movingAverage"),s=$h(n,"decay","movingAverage");Ph(i,o),ls(ms(i.shape,o.shape),(function(){return"Shape mismatch in v and x"}));var u=ng(1),c=Lg(u,s),l=Mm(Lg(o,i),c);if(a){ls(null!=r,(function(){return"When using zeroDebias: true, step is required."}));var d=$h(r,"step","movingAverage");l=Cm(l,Lg(u,tg(s,d)))}return Im(i,l)}});var Yj=np({scatterND_:function(e,t,n){var r=$h(e,"indices","scatterND","int32"),a=$h(t,"updates","scatterND");tm(a,r,n);var i={indices:r,updates:a},o={shape:n};return Bh.runKernel(xl,i,o)}});var Qj=np({sparseToDense_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=$h(e,"sparseIndices","sparseToDense","int32"),i=$h(t,"sparseValues","sparseToDense","string_or_numeric"),o=$h(r,"defaultValue","sparseToDense",i.dtype);!function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was ".concat(e.dtype,"."));if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape ".concat(e.shape,"."));var a=e.rank>0?e.shape[0]:1,i=e.rank>1?e.shape[1]:1;if(n.length!==i)throw new Error("outputShape has incorrect number of elements:, ".concat(n.length,", should be: ").concat(i,"."));var o=t.size;if(0!==t.rank&&(1!==t.rank||o!==a))throw new Error("sparseValues has incorrect shape ".concat(t.shape,", should be [] or [").concat(a,"]"));if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(a,i,n,o);var s={sparseIndices:a,sparseValues:i,defaultValue:o},u={outputShape:n};return Bh.runKernel(Gl,s,u)}});var Jj=np({gatherND_:function(e,t){var n=$h(t,"indices","gatherND","int32"),r={params:$h(e,"x","gatherND","string_or_numeric"),indices:n};return Bh.runKernel(hc,r)}});function qj(){return qj=S(w().mark((function e(t,n){var r,a,i,o,s,u,c,l,d,h,p,f,m,v,g,y=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=y.length>2&&void 0!==y[2]?y[2]:1,a=$h(t,"predictions","inTopK"),i=$h(n,"targets","inTopK"),ls(a.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got ".concat(a.rank)})),ls(a.rank-1===i.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank ".concat(a.rank," and targets rank ").concat(i.rank)})),ds(a.shape.slice(0,a.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=a.shape[a.shape.length-1],ls(r>0&&r<=o,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension (".concat(o,"), but got ").concat(r)})),e.next=7,a.data();case 7:return s=e.sent,e.next=10,i.data();case 10:u=e.sent,c=s.length/o,l=o,d=Ss("bool",c),h=0;case 15:if(!(h<c)){e.next=30;break}for(p=h*l,f=s.subarray(p,p+l),m=[],v=0;v<f.length;v++)m.push({value:f[v],index:v});m.sort((function(e,t){return t.value-e.value})),d[h]=0,g=0;case 20:if(!(g<r)){e.next=27;break}if(m[g].index!==u[h]){e.next=24;break}return d[h]=1,e.abrupt("break",27);case 24:g++,e.next=20;break;case 27:h++,e.next=15;break;case 30:return e.abrupt("return",(t!==a&&a.dispose(),n!==i&&i.dispose(),ip(d,i.shape,"bool")));case 31:case"end":return e.stop()}}),e)}))),qj.apply(this,arguments)}var $j=function(e,t){return qj.apply(this,arguments)};var eY=np({fusedDepthwiseConv2d_:function(e){var t,n=e.x,r=e.filter,a=e.strides,o=e.pad,s=e.dataFormat,u=void 0===s?"NHWC":s,c=e.dilations,l=void 0===c?[1,1]:c,d=e.dimRoundingMode,h=e.bias,p=e.activation,f=void 0===p?"linear":p,m=e.preluActivationWeights,v=e.leakyreluAlpha;if(!1===xb(Bh.state.gradientDepth,f)){var g=Ov(n,r,a,o,u,l,d);return null!=h&&(g=Im(g,h)),bb(g,f,m,v)}var y=$h(n,"x","depthwiseConv2d","float32"),b=$h(r,"filter","depthwiseConv2d","float32"),x=y,w=!1;3===y.rank&&(w=!0,x=nv(y,[1,y.shape[0],y.shape[1],y.shape[2]])),ls(4===x.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank ".concat(x.rank,".")})),ls(4===b.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank ".concat(b.rank,".")})),ls(x.shape[3]===b.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels (".concat(x.shape[3],") must match the inChannels dimension in filter ").concat(b.shape[2],".")})),null==l&&(l=[1,1]),ls($m(a,l),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(a," and dilations '").concat(l,"'")})),tv("fused depthwiseConv2d",o,d);var k,S,T=Hm(x.shape,b.shape,a,l,o,d,!0);null!=h&&(t=i(Ah(k=$h(h,"bias","fused conv2d"),y),1),k=t[0],Uf(T.outShape,k.shape)),null!=m&&(S=$h(m,"prelu weights","fused depthwiseConv2d"));var _=function(e,t){ls(qm(l),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '".concat(l,"'")}));var n=i(t,4),r=n[0],s=n[1],u=n[2],c=n[3],h=gb(e,u,f),p=Sb(s.shape,h,r,a,o,l,d),m=kb(s,h,r.shape,a,o,l,d);return null!=c?[p,m,yb(k,h)]:[p,m]},I={x:x,filter:b,bias:k,preluActivationWeights:S},E={strides:a,pad:o,dataFormat:u,dilations:l,dimRoundingMode:d,activation:f,leakyreluAlpha:v};return null==h?Cg((function(e,t,n){var r=Bh.runKernel(ud,I,E);return n([t,e,r]),w&&(r=nv(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:_}}))(x,b):Cg((function(e,t,n,r){var a=Bh.runKernel(ud,I,E);return r([t,e,a,n]),w&&(a=nv(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:_}}))(x,b,k)}}),tY=Object.freeze(Object.defineProperty({__proto__:null,conv2d:wb,depthwiseConv2d:eY,matMul:Tb},Symbol.toStringTag,{value:"Module"})),nY=Object.freeze(Object.defineProperty({__proto__:null,nonMaxSuppressionV3Impl:zb,nonMaxSuppressionV4Impl:Fb,nonMaxSuppressionV5Impl:Gb,whereImpl:hb},Symbol.toStringTag,{value:"Module"}));var rY=Object.freeze(Object.defineProperty({__proto__:null,maxNorm:function(e){return new cI(e)},minMaxNorm:function(e){return new hI(e)},nonNeg:function(){return new dI},unitNorm:function(e){return new lI(e)}},Symbol.toStringTag,{value:"Module"}));var aY=Object.freeze(Object.defineProperty({__proto__:null,constant:function(e){return new b_(e)},glorotNormal:function(e){return new I_(e)},glorotUniform:function(e){return new __(e)},heNormal:function(e){return new E_(e)},heUniform:function(e){return new C_(e)},identity:function(e){return new S_(e)},leCunNormal:function(e){return new M_(e)},leCunUniform:function(e){return new N_(e)},ones:function(){return new y_},orthogonal:function(e){return new R_(e)},randomNormal:function(e){return new w_(e)},randomUniform:function(e){return new x_(e)},truncatedNormal:function(e){return new k_(e)},varianceScaling:function(e){return new T_(e)},zeros:function(){return new g_}},Symbol.toStringTag,{value:"Module"}));function iY(e){return $_(e)}function oY(e){return new PM(e)}function sY(e){return new zM(e)}function uY(e){return new WM(e)}function cY(e){return new XM(e)}function lY(e){return new ZM(e)}function dY(e){return new AM(e)}function hY(e){return new OM(e)}var pY=cY,fY=lY,mY=dY,vY=hY;var gY=Object.freeze(Object.defineProperty({__proto__:null,Layer:Q_,RNN:XC,RNNCell:BC,activation:function(e){return new sM(e)},add:function(e){return new fM(e)},alphaDropout:function(e){return new TM(e)},average:function(e){return new vM(e)},averagePooling1d:oY,averagePooling2d:sY,averagePooling3d:uY,avgPool1d:function(e){return oY(e)},avgPool2d:function(e){return sY(e)},avgPool3d:function(e){return uY(e)},avgPooling1d:function(e){return oY(e)},avgPooling2d:function(e){return sY(e)},avgPooling3d:function(e){return uY(e)},batchNormalization:function(e){return new EM(e)},bidirectional:function(e){return new YM(e)},concatenate:function(e){return new bM(e)},conv1d:function(e){return new zC(e)},conv2d:function(e){return new RC(e)},conv2dTranspose:function(e){return new AC(e)},conv3d:function(e){return new LC(e)},conv3dTranspose:function(e){return new PC(e)},convLstm2d:function(e){return new nM(e)},convLstm2dCell:function(e){return new tM(e)},cropping2D:function(e){return new FC(e)},dense:function(e){return new iM(e)},depthwiseConv2d:function(e){return new WC(e)},dot:function(e){return new wM(e)},dropout:function(e){return new rM(e)},elu:function(e){return new xC(e)},embedding:function(e){return new hM(e)},flatten:function(e){return new oM(e)},gaussianDropout:function(e){return new SM(e)},gaussianNoise:function(e){return new kM(e)},globalAveragePooling1d:function(e){return new UM(e)},globalAveragePooling2d:function(e){return new HM(e)},globalMaxPool1d:pY,globalMaxPool2d:fY,globalMaxPooling1d:cY,globalMaxPooling2d:lY,gru:function(e){return new jC(e)},gruCell:function(e){return new KC(e)},input:iY,inputLayer:function(e){return new q_(e)},layerNormalization:function(e){return new CM(e)},leakyReLU:function(e){return new yC(e)},lstm:function(e){return new QC(e)},lstmCell:function(e){return new YC(e)},masking:function(e){return new dM(e)},maxPool1d:mY,maxPool2d:vY,maxPooling1d:dY,maxPooling2d:hY,maxPooling3d:function(e){return new GM(e)},maximum:function(e){return new gM(e)},minimum:function(e){return new yM(e)},multiply:function(e){return new mM(e)},permute:function(e){return new lM(e)},prelu:function(e){return new bC(e)},reLU:function(e){return new gC(e)},repeatVector:function(e){return new uM(e)},rescaling:function(e){return new qM(e)},reshape:function(e){return new cM(e)},rnn:function(e){return new XC(e)},separableConv2d:function(e){return new OC(e)},simpleRNN:function(e){return new ZC(e)},simpleRNNCell:function(e){return new HC(e)},softmax:function(e){return new kC(e)},spatialDropout1d:function(e){return new aM(e)},stackedRNNCells:function(e){return new JC(e)},thresholdedReLU:function(e){return new wC(e)},timeDistributed:function(e){return new jM(e)},upSampling2d:function(e){return new GC(e)},zeroPadding2d:function(e){return new MM(e)}},Symbol.toStringTag,{value:"Module"}));var yY=Object.freeze(Object.defineProperty({__proto__:null,MAPE:function(e,t){return AI(e,t)},MSE:function(e,t){return RI(e,t)},binaryAccuracy:function(e,t){return WI(e,t)},binaryCrossentropy:function(e,t){return HI(e,t)},categoricalAccuracy:function(e,t){return VI(e,t)},categoricalCrossentropy:function(e,t){return KI(e,t)},cosineProximity:function(e,t){return zI(e,t)},mape:function(e,t){return AI(e,t)},meanAbsoluteError:function(e,t){return LI(e,t)},meanAbsolutePercentageError:function(e,t){return AI(e,t)},meanSquaredError:function(e,t){return RI(e,t)},mse:function(e,t){return RI(e,t)},precision:function(e,t){return XI(e,t)},recall:function(e,t){return BI(e,t)},sparseCategoricalAccuracy:function(e,t){return ZI(e,t)}},Symbol.toStringTag,{value:"Module"})),bY=Object.freeze(Object.defineProperty({__proto__:null,modelFromJSON:function(e,t){return WE.apply(this,arguments)}},Symbol.toStringTag,{value:"Module"}));var xY=Object.freeze(Object.defineProperty({__proto__:null,l1:function(e){return function(e){return lC(e),new hC({l1:null!=e?e.l1:null,l2:0})}(e)},l1l2:function(e){return new hC(e)},l2:function(e){return function(e){return lC(e),new hC({l2:null!=e?e.l2:null,l1:0})}(e)}},Symbol.toStringTag,{value:"Module"})),wY=function(e){m(n,e);var t=y(n);function n(){var e;return T(this,n),(e=t.apply(this,arguments)).model=null,e}return E(n,[{key:"setModel",value:function(e){if(!(e instanceof FE))throw new Error("model must be a LayersModel, not some other Container");this.model=e}}]),n}(wI);function kY(e,t){return e<t}function SY(e,t){return e>t}var TY=function(e){m(n,e);var t=y(n);function n(e){var r;if(T(this,n),r=t.call(this),null==e&&(e={}),e.restoreBestWeights)throw new rT("restoreBestWeights = True is not implemented in EarlyStopping yet.");return r.monitor=e.monitor||"val_loss",r.minDelta=Math.abs(e.minDelta||0),r.patience=e.patience||0,r.verbose=e.verbose||0,r.mode=e.mode||"auto",r.baseline=e.baseline,-1===["auto","min","max"].indexOf(r.mode)&&(console.warn("EarlyStopping mode '".concat(r.mode,"' is invalid. Falling back to mode 'auto'.")),r.mode="auto"),"min"===r.mode?r.monitorFunc=kY:"max"===r.mode||-1!==r.monitor.indexOf("acc")?r.monitorFunc=SY:r.monitorFunc=kY,r.monitorFunc===kY&&(r.minDelta*=-1),p(r)}return E(n,[{key:"onTrainBegin",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.wait=0,this.stoppedEpoch=0,null!=this.baseline?this.best=this.baseline:this.best=this.monitorFunc===kY?1/0:-1/0;case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=S(w().mark((function e(t,n){var r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yI(n);case 2:null!=(r=this.getMonitorValue(n))&&(this.monitorFunc(r-this.minDelta,this.best)?(this.best=r,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=t,this.model.stopTraining=!0)));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.stoppedEpoch>0&&this.verbose&&console.log("Epoch ".concat(this.stoppedEpoch,": early stopping."));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getMonitorValue",value:function(e){null==e&&(e={});var t=e[this.monitor];return null==t&&console.warn("Metric for EarlyStopping ".concat(this.monitor," is not available. Available metrics are: ").concat(Object.keys(e))),t}}]),n}(wY);var _Y={earlyStopping:function(e){return new TY(e)}},IY={};function EY(e){return IY[e]}function CY(e,t,n,r,a){var i=t.inputParams[e];if(i&&void 0!==i.inputIndexStart){var o=i.inputIndexStart,s=0===i.inputIndexEnd?void 0:void 0===i.inputIndexEnd?o+1:i.inputIndexEnd;if("tensor"===i.type)return MY(t.inputNames[i.inputIndexStart],n,r,a);if("tensors"===i.type)return t.inputNames.slice(o,s).map((function(e){return MY(e,n,r,a)}));var u=MY(t.inputNames.slice(o)[0],n,r,a),c=u.dataSync();return"number"===i.type?c[0]:Gs(u.shape,c)}var l=t.attrParams[e];return l&&l.value}function MY(e,t,n,r){var a=i(LY(e),2),o=a[0],s=a[1];if(null!=r){var u=r.getHashTableHandleByName(o);if(null!=u)return u}var c=n.currentContextIds.find((function(e){return!!t[RY(o,e)]}));return void 0!==c?t[RY(o,c)][s]:void 0}function NY(e,t){var n=i(LY(e),3),r=n[0],a=n[1],o=n[2];return[RY(r,t&&t.currentContextId),a,o]}function RY(e,t){return t?"".concat(e,"-").concat(t):e}function LY(e){var t=e.split(":");if(1===t.length)return[e,0,void 0];var n=t[0],r=3===t.length?t[1]:void 0;return[n,Number(t[t.length-1]),r]}function AY(e,t,n){var r=CY("pad",e,t,n);if("explicit"===r){r=CY("explicitPaddings",e,t,n);for(var a=[[0,0],[0,0],[0,0],[0,0]],i=0;i<4;i++)a[i][0]=r[2*i],a[i][1]=r[2*i+1];return a}return r}function PY(e){return e.kept?e:pf(e)}var DY=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]},Symbol.toStringTag,{value:"Module"})),OY=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]},Symbol.toStringTag,{value:"Module"})),zY=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}]},Symbol.toStringTag,{value:"Module"})),FY=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}]},Symbol.toStringTag,{value:"Module"})),GY=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}]},Symbol.toStringTag,{value:"Module"})),WY=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]},Symbol.toStringTag,{value:"Module"})),VY=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}]},Symbol.toStringTag,{value:"Module"})),UY=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}]},Symbol.toStringTag,{value:"Module"})),XY=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]}]},Symbol.toStringTag,{value:"Module"})),BY=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}]},Symbol.toStringTag,{value:"Module"})),HY=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]},Symbol.toStringTag,{value:"Module"})),ZY=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]}]},Symbol.toStringTag,{value:"Module"})),KY=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]},Symbol.toStringTag,{value:"Module"})),jY=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}]},Symbol.toStringTag,{value:"Module"})),YY=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]},Symbol.toStringTag,{value:"Module"})),QY=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}]},Symbol.toStringTag,{value:"Module"})),JY=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}]},Symbol.toStringTag,{value:"Module"})),qY=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}]},Symbol.toStringTag,{value:"Module"})),$Y=Object.freeze(Object.defineProperty({__proto__:null,json:[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}]},Symbol.toStringTag,{value:"Module"})),eQ=function(){function e(){var t;T(this,e);var n=[DY,OY,zY,FY,GY,WY,VY,UY,XY,BY,HY,ZY,KY,jY,YY,QY,JY,qY,$Y],r=(t=[]).concat.apply(t,b(n.map((function(e){return e.json}))));this.opMappers=r.reduce((function(e,t){return e[t.tfOpName]=t,e}),{})}return E(e,[{key:"transformGraph",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.node,a=[],o=[],s=[],u=r.reduce((function(e,n){return e[n.name]=t.mapNode(n),n.op.startsWith("Placeholder")?a.push(e[n.name]):"Const"===n.op?o.push(e[n.name]):(null==n.input||0===n.input.length)&&s.push(e[n.name]),e}),{}),c=[],l=[],d={},h={};null!=n&&(d=this.mapSignatureEntries(n.inputs),h=this.mapSignatureEntries(n.outputs));var p=Object.keys(u);p.forEach((function(e){var t=u[e];t.inputNames.forEach((function(e,n){var r=i(NY(e),3),a=r[0],o=r[2],s=u[a];if(null!=s.outputs){var c=s.outputs.indexOf(o);if(-1!==c){var l="".concat(a,":").concat(c);t.inputNames[n]=l}}t.inputs.push(s),s.children.push(t)}))})),0===Object.keys(h).length?p.forEach((function(e){var t=u[e];0===t.children.length&&l.push(t)})):Object.keys(h).forEach((function(e){var t=i(NY(e),1)[0],n=u[t];null!=n&&(n.signatureKey=h[e],l.push(n))})),Object.keys(d).length>0?Object.keys(d).forEach((function(e){var t=i(NY(e),1)[0],n=u[t];n&&(n.signatureKey=d[e],c.push(n))})):c=a;var f={};null!=e.library&&null!=e.library.function&&(f=e.library.function.reduce((function(e,n){return e[n.signature.name]=t.mapFunction(n),e}),{}));var m={nodes:u,inputs:c,outputs:l,weights:o,placeholders:a,signature:n,functions:f};return s.length>0&&(m.initNodes=s),m}},{key:"mapSignatureEntries",value:function(e){return Object.keys(e||{}).reduce((function(t,n){return t[e[n].name]=n,t}),{})}},{key:"mapNode",value:function(e){var t=EY(e.op)||this.opMappers[e.op]||{};null==e.attr&&(e.attr={});var n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map((function(e){return e.startsWith("^")?e.slice(1):e})),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return null!=t.inputs&&(n.inputParams=t.inputs.reduce((function(e,t){return e[t.name]={type:t.type,inputIndexStart:t.start,inputIndexEnd:t.end},e}),{})),null!=t.attrs&&(n.attrParams=t.attrs.reduce((function(t,n){var r,a=n.type;switch(n.type){case"string":void 0===(r=nQ(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=nQ(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":void 0===(r=hQ(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=hQ(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":void 0===(r=aQ(e.attr,n.tfName,n.defaultValue||0))&&n.tfDeprecatedName&&(r=aQ(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":void 0===(r=dQ(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=dQ(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":void 0===(r=rQ(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=rQ(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":void 0===(r=fQ(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=fQ(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":void 0===(r=lQ(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=lQ(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":void 0===(r=pQ(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=pQ(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":void 0===(r=sQ(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=sQ(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":void 0===(r=uQ(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=uQ(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":void 0===(r=oQ(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=oQ(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: ".concat(n.type," for op: ").concat(e.op))}return t[n.name]={value:r,type:a},t}),{})),n}},{key:"mapFunction",value:function(e){var t=this,n=e.nodeDef,r=[],a={};null!=n&&(a=n.reduce((function(e,n){return e[n.name]=t.mapNode(n),"Const"===n.op&&r.push(e[n.name]),e}),{}));var o=[],s=[];e.signature.inputArg.forEach((function(e){var t=i(NY(e.name),1)[0],n={name:t,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:iQ(e.type),type:"dtype"}},children:[]};n.signatureKey=e.name,o.push(n),a[t]=n})),Object.keys(a).forEach((function(e){var t=a[e];t.inputNames.forEach((function(e,n){var r=i(NY(e),3),o=r[0],s=r[2],u=a[o];if(null!=u.outputs){var c=u.outputs.indexOf(s);if(-1!==c){var l="".concat(o,":").concat(c);t.inputNames[n]=l}}t.inputs.push(u),u.children.push(t)}))}));var u=e.ret;e.signature.outputArg.forEach((function(e){var t=i(NY(u[e.name]),2),n=t[0],r=t[1],o=a[n];null!=o&&(o.defaultOutput=r,s.push(o))}));var c=this.mapArgsToSignature(e);return{nodes:a,inputs:o,outputs:s,weights:r,placeholders:[],signature:c}}},{key:"mapArgsToSignature",value:function(e){var t=this;return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((function(e,n){return e[n.name]=t.mapArgToTensorInfo(n),e}),{}),outputs:e.signature.outputArg.reduce((function(n,r){return n[r.name]=t.mapArgToTensorInfo(r,e.ret),n}),{})}}},{key:"mapArgToTensorInfo",value:function(e,t){var n=e.name;return null!=t&&(n=t[n]),{name:n,dtype:e.type}}}],[{key:"Instance",get:function(){return this._instance||(this._instance=new this)}}]),e}();function tQ(e,t){var n=Array.isArray(e)?String.fromCharCode.apply(null,e):function(e){var t=Qs().global;if(typeof t.atob<"u")return t.atob(e);if(typeof Buffer<"u")return new Buffer(e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(e);return t?n:n.toLowerCase()}function nQ(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return null!=a?tQ(a.s,r):n}function rQ(e,t,n){var r=e[t];return r?r.b:n}function aQ(e,t,n){var r=e[t]||{},a=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof a?a:parseInt(a,10)}function iQ(e){switch("string"==typeof e&&(e=QM[e]),e){case QM.DT_FLOAT:case QM.DT_HALF:return"float32";case QM.DT_INT32:case QM.DT_INT64:case QM.DT_INT8:case QM.DT_UINT8:return"int32";case QM.DT_BOOL:return"bool";case QM.DT_DOUBLE:return"float32";case QM.DT_STRING:return"string";default:return null}}function oQ(e,t,n){var r=e[t];return r&&r.func?r.func.name:n}function sQ(e,t,n){var r=e[t];return r&&r.type?iQ(r.type):n}function uQ(e,t,n){var r=e[t];return r&&r.list&&r.list.type?r.list.type.map((function(e){return iQ(e)})):n}function cQ(e){if(!e.unknownRank)return null!=e.dim?e.dim.map((function(e){return"number"==typeof e.size?e.size:parseInt(e.size,10)})):[]}function lQ(e,t,n){var r=e[t];return r&&r.shape?cQ(r.shape):n}function dQ(e,t,n){var r=e[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((function(e){return"number"==typeof e?e:parseInt(e,10)})):n}function hQ(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return a&&a.list&&a.list.s?a.list.s.map((function(e){return tQ(e,r)})):n}function pQ(e,t,n){var r=e[t];return r&&r.list&&r.list.shape?r.list.shape.map((function(e){return cQ(e)})):n}function fQ(e,t,n){var r=e[t];return r&&r.list&&r.list.b?r.list.b:n}var mQ=function(){function e(t,n,r){var a=this;T(this,e),this.node=t,this.tensorMap=n,this.context=r,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map((function(e){return a.getInput(e)})),null!=t.rawAttrs&&(this.attrs=Object.keys(t.rawAttrs).reduce((function(e,t){return e[t]=a.getAttr(t),e}),{}))}return E(e,[{key:"getInput",value:function(e){return MY(e,this.tensorMap,this.context)}},{key:"getAttr",value:function(e,t){var n=this.node.rawAttrs[e];if(null!=n.tensor)return MY(e,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return aQ(this.node.rawAttrs,e,t);if(null!=n.s)return nQ(this.node.rawAttrs,e,t);if(null!=n.b)return rQ(this.node.rawAttrs,e,t);if(null!=n.shape)return lQ(this.node.rawAttrs,e,t);if(null!=n.type)return sQ(this.node.rawAttrs,e,t);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return dQ(this.node.rawAttrs,e,t);if(null!=n.list.s)return hQ(this.node.rawAttrs,e,t);if(null!=n.list.shape)return pQ(this.node.rawAttrs,e,t);if(null!=n.list.b)return fQ(this.node.rawAttrs,e,t);if(null!=n.list.type)return uQ(this.node.rawAttrs,e,t)}return t}}]),e}(),vQ=Object.freeze(Object.defineProperty({__proto__:null,OP_SCOPE_SUFFIX:tp,abs:Nm,acos:Rm,acosh:Lm,add:Im,addN:lj,all:Am,any:Pm,argMax:Dm,argMin:Om,asin:zm,asinh:Fm,atan:Gm,atan2:Wm,atanh:Vm,avgPool:rv,avgPool3d:av,basicLSTMCell:dj,batchNorm:dv,batchNorm2d:hv,batchNorm3d:pv,batchNorm4d:fv,batchToSpaceND:cv,bincount:mv,booleanMaskAsync:Kj,broadcastArgs:hj,broadcastTo:vv,buffer:df,cast:hf,ceil:gv,clipByValue:bv,clone:pf,complex:rp,concat:iv,concat1d:xv,concat2d:wv,concat3d:kv,concat4d:Sv,conv1d:_v,conv2d:Tv,conv2dTranspose:Ev,conv3d:Cv,conv3dTranspose:Nv,cos:Rv,cosh:Lv,cosineWindow:mb,cumprod:Av,cumsum:Pv,denseBincount:pj,depthToSpace:Dv,depthwiseConv2d:Ov,diag:fj,dilation2d:zv,div:Cm,divNoNan:Vv,dot:Uv,dropout:pb,einsum:mj,elu:Xv,enclosingPowerOfTwo:fb,equal:Fv,erf:Bv,euclideanNorm:ug,exp:cg,expandDims:lg,expm1:dg,eye:pg,fft:Ky,fill:yv,floor:fg,floorDiv:Em,fused:tY,gather:mg,gatherND:Jj,greater:vg,greaterEqual:gg,ifft:jy,imag:Of,image:_x,inTopKAsync:$j,irfft:Yy,isFinite:yg,isInf:bg,isNaN:xg,leakyRelu:wg,less:kg,lessEqual:Sg,linalg:Ix,linspace:vj,localResponseNormalization:Tg,log:_g,log1p:Ig,logSigmoid:Rg,logSoftmax:Ag,logSumExp:Pg,logicalAnd:Dg,logicalNot:Og,logicalOr:zg,logicalXor:Fg,losses:Ex,lowerBound:bj,matMul:Ef,max:$v,maxPool:Gg,maxPool3d:Wg,maxPoolWithArgmax:xj,maximum:Vg,mean:Ug,meshgrid:wj,min:eg,minimum:Hg,mirrorPad:Zg,mod:Kg,moments:jg,movingAverage:jj,mul:Mm,multiRNNCell:kj,multinomial:Sj,neg:zf,norm:sg,notEqual:Yg,oneHot:Cf,ones:Bg,onesLike:Qg,op:np,outerProduct:Tj,pad:Jg,pad1d:_j,pad2d:Ij,pad3d:Ej,pad4d:Cj,pool:$g,pow:tg,prelu:ey,print:ff,prod:ty,raggedGather:Mj,raggedTensorToTensor:Nj,rand:Rj,randomGamma:Lj,randomNormal:Cy,randomStandardNormal:Aj,randomUniform:My,range:Ny,real:Ff,reciprocal:Ry,relu:Ly,relu6:Ay,reshape:nv,reverse:Py,reverse1d:Pj,reverse2d:Dj,reverse3d:Oj,reverse4d:zj,rfft:Jy,round:Dy,rsqrt:Oy,scalar:ng,scatterND:Yj,searchSorted:yj,selu:zy,separableConv2d:Fy,setdiff1dAsync:Gj,sigmoid:ov,sign:Gy,signal:Tx,sin:Wy,sinh:Vy,slice:sv,slice1d:Uy,slice2d:Xy,slice3d:By,slice4d:Hy,softmax:Zy,softplus:Ng,spaceToBatchND:qg,sparse:Cx,sparseToDense:Qj,spectral:Sx,split:Qy,sqrt:rg,square:ag,squaredDifference:qy,squeeze:$y,stack:eb,step:tb,stridedSlice:nb,string:Mx,sub:Lg,sum:ig,tan:rb,tanh:uv,tensor:ip,tensor1d:ab,tensor2d:ib,tensor3d:Hf,tensor4d:Wj,tensor5d:Vj,tensor6d:Uj,tile:hg,topk:ob,transpose:Gf,truncatedNormal:sb,unique:ub,unsortedSegmentSum:cb,unstack:lb,upperBound:Xj,variable:db,where:Gv,whereAsync:Hj,zeros:Xg,zerosLike:Wv},Symbol.toStringTag,{value:"Module"}));function gQ(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if("number"!=typeof e&&"number"!=typeof t){ls(e.length===t.length,(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}));for(var r=0;r<e.length;r++){var a=e[r],i=t[r];ls(a<0||i<0||a===i,(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}}}function yQ(e){return!("number"==typeof e||e.some((function(e){return e<0})))}function bQ(e,t,n){var r=xQ(e,n),a=!yQ(r);if(a&&0===t.length)throw new Error("Tried to calculate elements of an empty list with non-fully-defined elementShape: ".concat(r));if(a&&t.forEach((function(e){r=xQ(e.shape,r)})),!yQ(r))throw new Error("Non-fully-defined elementShape: ".concat(r));return r}function xQ(e,t){if("number"==typeof e)return t;if("number"==typeof t)return e;if(e.length!==t.length)throw new Error("Incompatible ranks during merge: ".concat(e," vs. ").concat(t));for(var n=[],r=0;r<e.length;++r){var a=e[r],i=t[r];if(a>=0&&i>=0&&a!==i)throw new Error("Incompatible shape during merge: ".concat(e," vs. ").concat(t));n[r]=a>=0?a:i}return n}var wQ=function(){function e(t,n,r,a,i,o,s){T(this,e),this.name=t,this.dtype=n,this.maxSize=r,this.elementShape=a,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.idTensor=ng(0),Af(this.idTensor)}return E(e,[{key:"id",get:function(){return this.idTensor.id}},{key:"closed",get:function(){return this.closed_}},{key:"clearAndClose",value:function(e){this.tensors.forEach((function(t){(null==e||!e.has(t.tensor.id))&&t.tensor.dispose()})),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}},{key:"size",value:function(){return this.tensors.length}},{key:"read",value:function(e){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||e>=this.size())throw new Error("Tried to read from index ".concat(e,", but array size is: ").concat(this.size()));var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray ".concat(this.name,": Could not read index ").concat(e," twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?)."));return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}},{key:"readMany",value:function(e){var t=this;return e.map((function(e){return t.read(e)}))}},{key:"write",value:function(e,t){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index ".concat(e,", but array is not resizeable and size is: ").concat(this.maxSize));var n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,",\n          because the value dtype is ").concat(t.dtype,", but TensorArray dtype is ").concat(this.dtype,"."));if(0===this.size()&&(null==this.elementShape||0===this.elementShape.length)&&(this.elementShape=t.shape),gQ(this.elementShape,t.shape,"TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,".")),n.read)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been read."));if(n.written)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been written."));n.tensor=t,Af(t),n.written=!0,this.tensors[e]=n}},{key:"writeMany",value:function(e,t){var n=this;if(e.length!==t.length)throw new Error("TensorArray ".concat(this.name,": could not write multiple tensors,because the index size: ").concat(e.length," is not the same as tensors size: ").concat(t.length,"."));e.forEach((function(e,r){return n.write(e,t[r])}))}},{key:"gather",value:function(e,t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but gather requested dtype ").concat(t));if(e)e=e.slice(0,this.size());else{e=[];for(var n=0;n<this.size();n++)e.push(n)}if(0===e.length)return ip([],[0].concat(this.elementShape));var r=this.readMany(e);return gQ(this.elementShape,r[0].shape,"TensorArray shape mismatch: "),eb(r,0)}},{key:"concat",value:function(e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but concat requested dtype ").concat(e));if(0===this.size())return ip([],[0].concat(this.elementShape));for(var t=[],n=0;n<this.size();n++)t.push(n);var r=this.readMany(t);return gQ(this.elementShape,r[0].shape,"TensorArray shape mismatch: tensor array shape (".concat(this.elementShape,") vs first tensor shape (").concat(r[0].shape,")")),iv(r,0)}},{key:"scatter",value:function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(t.shape[0]));var n=Math.max.apply(Math,b(e));if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size (".concat(n,"  vs. ").concat(this.maxSize,")"));this.writeMany(e,lb(t,0))}},{key:"split",value:function(e,t){var n=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));var r=0,a=e.map((function(e){return r+=e}));if(r!==t.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(t.shape));if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths (".concat(this.maxSize," vs. ").concat(e.length,"), and the TensorArray is not marked as dynamically resizeable"));var i=0===r?0:t.size/r,o=[];Rf((function(){t=nv(t,[1,r,i]);for(var s=0;s<e.length;++s){var u=[0,0===s?0:a[s-1],0],c=[1,e[s],i];o[s]=nv(sv(t,u,c),n.elementShape)}return o}));for(var s=[],u=0;u<e.length;u++)s[u]=u;this.writeMany(s,o)}}]),e}(),kQ=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;T(this,e),this.tensors=t,this.elementShape=n,this.elementDtype=r,null!=t&&t.forEach((function(e){if(r!==e.dtype)throw new Error("Invalid data types; op elements ".concat(r,", but list elements ").concat(e.dtype));gQ(n,e.shape,"TensorList shape mismatch: "),Af(e)})),this.idTensor=ng(0),this.maxNumElements=a,Af(this.idTensor)}return E(e,[{key:"id",get:function(){return this.idTensor.id}},{key:"copy",value:function(){return new e(b(this.tensors),this.elementShape,this.elementDtype)}},{key:"clearAndClose",value:function(e){this.tensors.forEach((function(t){(null==e||!e.has(t.id))&&t.dispose()})),this.tensors.length=0,this.idTensor.dispose()}},{key:"size",value:function(){return this.tensors.length}},{key:"stack",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(-1!==r&&this.tensors.length!==r)throw new Error("Operation expected a list with ".concat(r," elements but got a list with ").concat(this.tensors.length," elements."));gQ(e,this.elementShape,"TensorList shape mismatch: ");var a=bQ(this.elementShape,this.tensors,e);return Rf((function(){var e=n.tensors.map((function(e){return nv(e,a)}));return eb(e,0)}))}},{key:"popBack",value:function(e,t){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(0===this.size())throw new Error("Trying to pop from an empty list.");var n=bQ(this.elementShape,this.tensors,e),r=this.tensors.pop();return r.kept=!1,gQ(r.shape,e,"TensorList shape mismatch: "),nv(r,n)}},{key:"pushBack",value:function(e){if(e.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(this.elementDtype));if(gQ(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Af(e),this.tensors.push(e)}},{key:"resize",value:function(t){if(t<0)throw new Error("TensorListResize expects size to be non-negative. Got: ".concat(t));if(-1!==this.maxNumElements&&t>this.maxNumElements)throw new Error("TensorListResize input size ".concat(t," is greater maxNumElement ").concat(this.maxNumElements,"."));var n=new e([],this.elementShape,this.elementDtype,this.maxNumElements);n.tensors.length=t;for(var r=0;r<Math.min(this.tensors.length,t);++r)n.tensors[r]=this.tensors[r];return n}},{key:"getItem",value:function(e,t,n){if(n!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(n,", but list elements ").concat(this.elementDtype));if(e<0||e>this.tensors.length)throw new Error("Trying to access element ".concat(e," in a list with ").concat(this.tensors.length," elements."));if(null==this.tensors[e])throw new Error("element at index ".concat(e," is null."));gQ(this.tensors[e].shape,t,"TensorList shape mismatch: ");var r=bQ(this.elementShape,this.tensors,t);return nv(this.tensors[e],r)}},{key:"setItem",value:function(e,t){if(t.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t.dtype,", but list elements ").concat(this.elementDtype));if(e<0||-1!==this.maxNumElements&&e>=this.maxNumElements)throw new Error("Trying to set element ".concat(e," in a list with max ").concat(this.maxNumElements," elements."));gQ(this.elementShape,t.shape,"TensorList shape mismatch: "),Af(t),null!=this.tensors[e]&&(this.tensors[e].kept=!1),this.tensors[e]=t}},{key:"gather",value:function(e,t,n){var r=this;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));gQ(this.elementShape,n,"TensorList shape mismatch: "),e=e.slice(0,this.size());var a=bQ(this.elementShape,this.tensors,n);return 0===e.length?ip([],[0].concat(a)):Rf((function(){var t=e.map((function(e){return nv(r.tensors[e],a)}));return eb(t,0)}))}},{key:"concat",value:function(e,t){var n=this;if(e&&e!==this.elementDtype)throw new Error("TensorList dtype is ".concat(this.elementDtype," but concat requested dtype ").concat(e));gQ(this.elementShape,t,"TensorList shape mismatch: ");var r=bQ(this.elementShape,this.tensors,t);return 0===this.size()?ip([],[0].concat(r)):Rf((function(){var e=n.tensors.map((function(e){return nv(e,r)}));return iv(e,0)}))}}]),e}();function SQ(e,t,n){var r=e.dtype;if(e.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: ".concat(e.shape));if(e.dtype!==n)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(n));gQ(e.shape.slice(1),t,"TensorList shape mismatch: ");var a=lb(e);return new kQ(a,t,r)}function TQ(e,t,n,r){return new kQ([],e,t,r)}function _Q(e,t,n,r){if(t.length!==e.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(t.length," vs. ").concat(e.shape[0]));var a=Math.max.apply(Math,b(t));if(null!=r&&-1!==r&&a>=r)throw new Error("Max index must be < array size (".concat(a,"  vs. ").concat(r,")"));var i=new kQ([],n,e.dtype,r),o=lb(e,0);return t.forEach((function(e,t){i.setItem(e,o[t])})),i}function IQ(e,t,n){var r=0,a=t.map((function(e){return r+=e}));if(r!==e.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(e.shape));for(var i=xQ(e.shape.slice(1),n),o=0===r?0:e.size/r,s=Rf((function(){var n=[];e=nv(e,[1,r,o]);for(var s=0;s<t.length;++s){var u=[0,0===s?0:a[s-1],0],c=[1,t[s],o];n[s]=nv(sv(e,u,c),i)}return e.dispose(),n})),u=new kQ([],n,e.dtype,t.length),c=0;c<s.length;c++)u.setItem(c,s[c]);return u}var EQ=function(){var e=S(w().mark((function e(t,n,r){var a,i,o,s,u,c,l,d,h,p,f,m,v,g,y,b,x,k,S,T,_,I,E,C,M,N,R,L,A,P,D,O,z,F,G,W,V,U,X,B,H,Z,K,j,Y,Q,J,q,$,ee,te,ne,re,ae,ie,oe,se,ue,ce,le,de,he,pe,fe,me,ve,ge,ye,be,xe,we,ke,Se,Te,_e,Ie,Ee,Ce,Me,Ne,Re,Le,Ae,Pe,De,Oe,ze,Fe,Ge,We,Ve,Ue,Xe,Be,He,Ze,Ke,je,Ye,Qe,Je,qe,$e;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="If"===e.t0||"StatelessIf"===e.t0?3:"While"===e.t0||"StatelessWhile"===e.t0?12:"LoopCond"===e.t0?30:"Switch"===e.t0?32:"Merge"===e.t0?43:"Enter"===e.t0?48:"Exit"===e.t0?50:"NextIteration"===e.t0?52:"TensorArrayV3"===e.t0?54:"TensorArrayWriteV3"===e.t0?56:"TensorArrayReadV3"===e.t0?58:"TensorArrayGatherV3"===e.t0?60:"TensorArrayScatterV3"===e.t0?62:"TensorArrayConcatV3"===e.t0?64:"TensorArraySplitV3"===e.t0?66:"TensorArraySizeV3"===e.t0?68:"TensorArrayCloseV3"===e.t0?70:"TensorListSetItem"===e.t0?72:"TensorListGetItem"===e.t0?74:"TensorListScatterV2"===e.t0||"TensorListScatter"===e.t0?76:"TensorListReserve"===e.t0||"EmptyTensorList"===e.t0?78:"TensorListGather"===e.t0?82:"TensorListStack"===e.t0?84:"TensorListFromTensor"===e.t0?86:"TensorListConcat"===e.t0||"TensorListConcatV2"===e.t0?88:"TensorListPushBack"===e.t0?90:"TensorListPopBack"===e.t0?92:"TensorListSplit"===e.t0?94:"TensorListLength"===e.t0?96:"TensorListResize"===e.t0?98:100;break;case 3:return a=CY("thenBranch",t,n,r),i=CY("elseBranch",t,n,r),o=CY("cond",t,n,r),s=CY("args",t,n,r),e.next=6,o.data();case 6:if(!e.sent[0]){e.next=10;break}e.t1=r.functionMap[a].executeFunctionAsync(s,r.tensorArrayMap,r.tensorListMap),e.next=11;break;case 10:e.t1=r.functionMap[i].executeFunctionAsync(s,r.tensorArrayMap,r.tensorListMap);case 11:return e.abrupt("return",e.t1);case 12:return u=CY("body",t,n,r),c=CY("cond",t,n,r),l=CY("args",t,n,r),e.next=17,r.functionMap[c].executeFunctionAsync(l,r.tensorArrayMap,r.tensorListMap);case 17:return d=e.sent,h=l.map((function(e){return e.id})),e.next=21,d[0].data();case 21:p=e.sent,d.forEach((function(e){!e.kept&&-1===h.indexOf(e.id)&&e.dispose()})),f=l,m=w().mark((function e(){var t,n,a;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=f,e.next=3,r.functionMap[u].executeFunctionAsync(f,r.tensorArrayMap,r.tensorListMap);case 3:return f=e.sent,n=f.map((function(e){return e.id})),t.forEach((function(e){!e.kept&&-1===h.indexOf(e.id)&&-1===n.indexOf(e.id)&&e.dispose()})),e.next=8,r.functionMap[c].executeFunctionAsync(f,r.tensorArrayMap,r.tensorListMap);case 8:return a=e.sent,e.next=11,a[0].data();case 11:p=e.sent,a.forEach((function(e){!e.kept&&-1===h.indexOf(e.id)&&-1===n.indexOf(e.id)&&e.dispose()}));case 13:case"end":return e.stop()}}),e)}));case 25:if(!p[0]){e.next=29;break}return e.delegateYield(m(),"t2",27);case 27:e.next=25;break;case 29:return e.abrupt("return",f);case 30:return v=CY("pred",t,n,r),e.abrupt("return",[PY(v)]);case 32:return g=CY("pred",t,n,r),(y=CY("data",t,n,r)).kept||(y=PY(y)),e.next=37,g.data();case 37:if(!e.sent[0]){e.next=41;break}e.t3=[void 0,y],e.next=42;break;case 41:e.t3=[y,void 0];case 42:return e.abrupt("return",e.t3);case 43:if(b=t.inputNames.find((function(e){return void 0!==MY(e,n,r)})),!b){e.next=47;break}return x=MY(b,n,r),e.abrupt("return",[PY(x)]);case 47:return e.abrupt("return");case 48:return k=CY("frameName",t,n,r),S=CY("tensor",t,n,r),e.abrupt("return",(r.enterFrame(k),[PY(S)]));case 50:return T=CY("tensor",t,n,r),e.abrupt("return",(r.exitFrame(),[PY(T)]));case 52:return _=CY("tensor",t,n,r),e.abrupt("return",(r.nextIteration(),[PY(_)]));case 54:return I=CY("size",t,n,r),E=CY("dtype",t,n,r),C=CY("elementShape",t,n,r),M=CY("dynamicSize",t,n,r),N=CY("clearAfterRead",t,n,r),R=CY("identicalElementShapes",t,n,r),L=CY("name",t,n,r),A=new wQ(L,E,I,C,R,M,N),e.abrupt("return",(r.addTensorArray(A),[A.idTensor,ng(1)]));case 56:return P=CY("tensorArrayId",t,n,r),D=CY("index",t,n,r),O=CY("tensor",t,n,r),z=r.getTensorArray(P.id),e.abrupt("return",(z.write(D,O),[z.idTensor]));case 58:return F=CY("tensorArrayId",t,n,r),G=CY("index",t,n,r),e.abrupt("return",[r.getTensorArray(F.id).read(G)]);case 60:return W=CY("tensorArrayId",t,n,r),V=CY("indices",t,n,r),U=CY("dtype",t,n,r),e.abrupt("return",[r.getTensorArray(W.id).gather(V,U)]);case 62:return X=CY("tensorArrayId",t,n,r),B=CY("indices",t,n,r),H=CY("tensor",t,n,r),Z=r.getTensorArray(X.id),e.abrupt("return",(Z.scatter(B,H),[Z.idTensor]));case 64:return K=CY("tensorArrayId",t,n,r),j=r.getTensorArray(K.id),Y=CY("dtype",t,n,r),e.abrupt("return",[j.concat(Y)]);case 66:return Q=CY("tensorArrayId",t,n,r),J=CY("tensor",t,n,r),q=CY("lengths",t,n,r),$=r.getTensorArray(Q.id),e.abrupt("return",($.split(q,J),[$.idTensor]));case 68:return ee=CY("tensorArrayId",t,n,r),te=r.getTensorArray(ee.id),e.abrupt("return",[ng(te.size(),"int32")]);case 70:return ne=CY("tensorArrayId",t,n,r),re=r.getTensorArray(ne.id),e.abrupt("return",(re.clearAndClose(),[re.idTensor]));case 72:return ae=CY("tensorListId",t,n,r),ie=CY("index",t,n,r),oe=CY("tensor",t,n,r),se=r.getTensorList(ae.id),e.abrupt("return",(se.setItem(ie,oe),[se.idTensor]));case 74:return ue=CY("tensorListId",t,n,r),ce=CY("index",t,n,r),le=CY("elementShape",t,n,r),de=CY("elementDType",t,n,r),e.abrupt("return",[r.getTensorList(ue.id).getItem(ce,le,de)]);case 76:return he=CY("indices",t,n,r),pe=CY("tensor",t,n,r),fe=CY("elementShape",t,n,r),me=CY("numElements",t,n,r),ve=_Q(pe,he,fe,me),e.abrupt("return",(r.addTensorList(ve),[ve.idTensor]));case 78:return ge=CY("elementShape",t,n,r),ye=CY("elementDType",t,n,r),be="TensorListReserve"===t.op?"numElements":"maxNumElements",xe=CY(be,t,n,r),we="TensorListReserve"===t.op?-1:xe,ke=TQ(ge,ye,0,we),e.abrupt("return",(r.addTensorList(ke),[ke.idTensor]));case 82:return Se=CY("tensorListId",t,n,r),Te=CY("indices",t,n,r),_e=CY("elementShape",t,n,r),Ie=CY("elementDType",t,n,r),e.abrupt("return",[r.getTensorList(Se.id).gather(Te,Ie,_e)]);case 84:return Ee=CY("tensorListId",t,n,r),Ce=CY("elementShape",t,n,r),Me=CY("elementDType",t,n,r),Ne=CY("numElements",t,n,r),e.abrupt("return",[r.getTensorList(Ee.id).stack(Ce,Me,Ne)]);case 86:return Re=CY("tensor",t,n,r),Le=CY("elementShape",t,n,r),Ae=CY("elementDType",t,n,r),Pe=SQ(Re,Le,Ae),e.abrupt("return",(r.addTensorList(Pe),[Pe.idTensor]));case 88:return De=CY("tensorListId",t,n,r),Oe=r.getTensorList(De.id),ze=CY("dtype",t,n,r),Fe=CY("elementShape",t,n,r),e.abrupt("return",[Oe.concat(ze,Fe)]);case 90:return Ge=CY("tensorListId",t,n,r),We=CY("tensor",t,n,r),Ve=r.getTensorList(Ge.id),e.abrupt("return",(Ve.pushBack(We),[Ve.idTensor]));case 92:return Ue=CY("tensorListId",t,n,r),Xe=CY("elementShape",t,n,r),Be=CY("elementDType",t,n,r),e.abrupt("return",[r.getTensorList(Ue.id).popBack(Xe,Be)]);case 94:return He=CY("tensor",t,n,r),Ze=CY("elementShape",t,n,r),Ke=CY("lengths",t,n,r),je=IQ(He,Ke,Ze),e.abrupt("return",(r.addTensorList(je),[je.idTensor]));case 96:return Ye=CY("tensorListId",t,n,r),Qe=r.getTensorList(Ye.id),e.abrupt("return",[ng(Qe.size(),"int32")]);case 98:return Je=CY("tensorListId",t,n,r),qe=CY("size",t,n,r),$e=r.getTensorList(Je.id).resize(qe),e.abrupt("return",(r.addTensorList($e),[$e.idTensor]));case 100:throw TypeError("Node type ".concat(t.op," is not implemented"));case 101:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();function CQ(e,t,n){var r=i(CY("fusedOps",e,t,n),2),a=r[0],o=r[1],s="biasadd"===a,u=!s,c="prelu"===o,l="fusedbatchnorm"===a,d=CY("numArgs",e,t,n);if(s){if(c&&2!==d)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!c&&s&&1!==d)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");var h=CY("strides",e,t,n),p=AY(e,t,n),f=CY("dataFormat",e,t,n).toUpperCase(),m=CY("dilations",e,t,n),v=i(CY("args",e,t,n),2),g=v[0],y=v[1];return u&&(y=g,g=void 0),{stride:h,pad:p,dataFormat:f,dilations:m,biasArg:g,preluArg:y,activationFunc:o,leakyreluAlpha:CY("leakyreluAlpha",e,t,n)}}function MQ(e,t,n){return{boxes:CY("boxes",e,t,n),scores:CY("scores",e,t,n),maxOutputSize:CY("maxOutputSize",e,t,n),iouThreshold:CY("iouThreshold",e,t,n),scoreThreshold:CY("scoreThreshold",e,t,n),softNmsSigma:CY("softNmsSigma",e,t,n)}}var NQ=function(){var e=S(w().mark((function e(t,n,r,a){var i,o,s,u,c,l,d,h,p,f,m,v,g,y,b,x,k,S,T,_,I,E,C,M,N,R=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=R.length>4&&void 0!==R[4]?R[4]:vQ,e.t0=t.op,e.next="NonMaxSuppressionV5"===e.t0?4:"NonMaxSuppressionV4"===e.t0?15:"NonMaxSuppressionV3"===e.t0||"NonMaxSuppressionV2"===e.t0?26:"Where"===e.t0?31:"ListDiff"===e.t0?37:38;break;case 4:return o=MQ(t,n,r),s=o.boxes,u=o.scores,c=o.maxOutputSize,l=o.iouThreshold,d=o.scoreThreshold,h=o.softNmsSigma,e.next=13,i.image.nonMaxSuppressionWithScoreAsync(s,u,c,l,d,h);case 13:return p=e.sent,e.abrupt("return",[p.selectedIndices,p.selectedScores]);case 15:return f=MQ(t,n,r),m=f.boxes,v=f.scores,g=f.maxOutputSize,y=f.iouThreshold,b=f.scoreThreshold,x=CY("padToMaxOutputSize",t,n,r),e.next=24,i.image.nonMaxSuppressionPaddedAsync(m,v,g,y,b,x);case 24:return k=e.sent,e.abrupt("return",[k.selectedIndices,k.validOutputs]);case 26:return S=MQ(t,n,r),T=S.boxes,_=S.scores,I=S.maxOutputSize,E=S.iouThreshold,C=S.scoreThreshold,e.next=29,i.image.nonMaxSuppressionAsync(T,_,I,E,C);case 29:return e.t1=e.sent,e.abrupt("return",[e.t1]);case 31:return M=i.cast(CY("condition",t,n,r),"bool"),e.next=34,i.whereAsync(M);case 34:return e.t2=e.sent,N=[e.t2],e.abrupt("return",(M.dispose(),N));case 37:return e.abrupt("return",i.setdiff1dAsync(CY("x",t,n,r),CY("y",t,n,r)));case 38:throw TypeError("Node type ".concat(t.op," is not implemented"));case 39:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),RQ=function(){function e(t,n){T(this,e),this.keyDType=t,this.valueDType=n,this.handle=ng(0),this.tensorMap=new Map,Af(this.handle)}return E(e,[{key:"id",get:function(){return this.handle.id}},{key:"clearAndClose",value:function(){this.tensorMap.forEach((function(e){return e.dispose()})),this.tensorMap.clear(),this.handle.dispose()}},{key:"size",value:function(){return this.tensorMap.size}},{key:"tensorSize",value:function(){return ng(this.size(),"int32")}},{key:"import",value:function(){var e=S(w().mark((function e(t,n){var r,a=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkKeyAndValueTensor(t,n),e.next=3,t.data();case 3:return r=e.sent,e.abrupt("return",(this.tensorMap.forEach((function(e){return e.dispose()})),this.tensorMap.clear(),Rf((function(){var e=lb(n),t=r.length,i=e.length;ls(t===i,(function(){return"The number of elements doesn't match, keys has ".concat(t," elements, the values has ").concat(i," elements.")}));for(var o=0;o<t;o++){var s=r[o],u=e[o];Af(u),a.tensorMap.set(s,u)}return a.handle}))));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=S(w().mark((function e(t,n){var r,a=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkKeyAndValueTensor(t,n),e.next=3,t.data();case 3:return r=e.sent,e.abrupt("return",Rf((function(){for(var e=[],t=0;t<r.length;t++){var i=r[t],o=a.findWithDefault(i,n);e.push(o)}return eb(e)})));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"findWithDefault",value:function(e,t){var n=this.tensorMap.get(e);return null!==n&&void 0!==n?n:t}},{key:"checkKeyAndValueTensor",value:function(e,t){if(e.dtype!==this.keyDType)throw new Error("Expect key dtype ".concat(this.keyDType,", but got ").concat(e.dtype));if(t.dtype!==this.valueDType)throw new Error("Expect value dtype ".concat(this.valueDType,", but got ").concat(t.dtype))}}]),e}(),LQ=function(){var e=S(w().mark((function e(t,n,r,a){var i,o,s,u,c,l,d,h,p,f;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="HashTable"===e.t0||"HashTableV2"===e.t0?3:"LookupTableImport"===e.t0||"LookupTableImportV2"===e.t0?5:"LookupTableFind"===e.t0||"LookupTableFindV2"===e.t0?10:"LookupTableSize"===e.t0||"LookupTableSizeV2"===e.t0?15:17;break;case 3:return i=CY("keyDType",t,n,r),o=CY("valueDType",t,n,r),s=new RQ(i,o),e.abrupt("return",(a.addHashTable(t.name,s),[s.handle]));case 5:return u=CY("tableHandle",t,n,r,a),c=CY("keys",t,n,r),l=CY("values",t,n,r),e.next=8,a.getHashTableById(u.id).import(c,l);case 8:return e.t1=e.sent,e.abrupt("return",[e.t1]);case 10:return d=CY("tableHandle",t,n,r,a),h=CY("keys",t,n,r),p=CY("defaultValue",t,n,r),e.next=13,a.getHashTableById(d.id).find(h,p);case 13:return e.t2=e.sent,e.abrupt("return",[e.t2]);case 15:return f=CY("tableHandle",t,n,r,a),e.abrupt("return",[a.getHashTableById(f.id).tensorSize()]);case 17:throw TypeError("Node type ".concat(t.op," is not implemented"));case 18:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}();function AQ(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Rf,o=function(e,t,n){switch(e.category){case"arithmetic":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vQ;switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[r.add(CY("a",e,t,n),CY("b",e,t,n))];case"AddN":return[r.addN(CY("tensors",e,t,n))];case"FloorMod":case"Mod":return[r.mod(CY("a",e,t,n),CY("b",e,t,n))];case"Mul":return[r.mul(CY("a",e,t,n),CY("b",e,t,n))];case"RealDiv":case"Div":return[r.div(CY("a",e,t,n),CY("b",e,t,n))];case"DivNoNan":return[r.divNoNan(CY("a",e,t,n),CY("b",e,t,n))];case"FloorDiv":return[r.floorDiv(CY("a",e,t,n),CY("b",e,t,n))];case"Sub":return[r.sub(CY("a",e,t,n),CY("b",e,t,n))];case"Minimum":return[r.minimum(CY("a",e,t,n),CY("b",e,t,n))];case"Maximum":return[r.maximum(CY("a",e,t,n),CY("b",e,t,n))];case"Pow":return[r.pow(CY("a",e,t,n),CY("b",e,t,n))];case"SquaredDifference":return[r.squaredDifference(CY("a",e,t,n),CY("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"basic_math":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vQ;switch(e.op){case"Abs":case"ComplexAbs":return[r.abs(CY("x",e,t,n))];case"Acos":return[r.acos(CY("x",e,t,n))];case"Acosh":return[r.acosh(CY("x",e,t,n))];case"Asin":return[r.asin(CY("x",e,t,n))];case"Asinh":return[r.asinh(CY("x",e,t,n))];case"Atan":return[r.atan(CY("x",e,t,n))];case"Atan2":return[r.atan2(CY("x",e,t,n),CY("y",e,t,n))];case"Atanh":return[r.atanh(CY("x",e,t,n))];case"Ceil":return[r.ceil(CY("x",e,t,n))];case"Complex":return[r.complex(CY("real",e,t,n),CY("imag",e,t,n))];case"Cos":return[r.cos(CY("x",e,t,n))];case"Cosh":return[r.cosh(CY("x",e,t,n))];case"Elu":return[r.elu(CY("x",e,t,n))];case"Erf":return[r.erf(CY("x",e,t,n))];case"Exp":return[r.exp(CY("x",e,t,n))];case"Expm1":return[r.expm1(CY("x",e,t,n))];case"Floor":return[r.floor(CY("x",e,t,n))];case"Log":return[r.log(CY("x",e,t,n))];case"Log1p":return[r.log1p(CY("x",e,t,n))];case"Imag":return[r.imag(CY("x",e,t,n))];case"Neg":return[r.neg(CY("x",e,t,n))];case"Reciprocal":return[r.reciprocal(CY("x",e,t,n))];case"Real":return[r.real(CY("x",e,t,n))];case"Relu":return[r.relu(CY("x",e,t,n))];case"Round":return[r.round(CY("x",e,t,n))];case"Selu":return[r.selu(CY("x",e,t,n))];case"Sigmoid":return[r.sigmoid(CY("x",e,t,n))];case"Sin":return[r.sin(CY("x",e,t,n))];case"Sign":return[r.sign(CY("x",e,t,n))];case"Sinh":return[r.sinh(CY("x",e,t,n))];case"Softplus":return[r.softplus(CY("x",e,t,n))];case"Sqrt":return[r.sqrt(CY("x",e,t,n))];case"Square":return[r.square(CY("x",e,t,n))];case"Tanh":return[r.tanh(CY("x",e,t,n))];case"Tan":return[r.tan(CY("x",e,t,n))];case"ClipByValue":return[r.clipByValue(CY("x",e,t,n),CY("clipValueMin",e,t,n),CY("clipValueMax",e,t,n))];case"Relu6":return[r.relu6(CY("x",e,t,n))];case"Rsqrt":return[r.rsqrt(MY(e.inputNames[0],t,n))];case"Prod":return[r.prod(CY("x",e,t,n),CY("axes",e,t,n))];case"LeakyRelu":return[r.leakyRelu(CY("x",e,t,n),CY("alpha",e,t,n))];case"Prelu":return[r.prelu(CY("x",e,t,n),CY("alpha",e,t,n))];case"IsNan":return[r.isNaN(MY(e.inputNames[0],t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"control":return EQ(e,t,n);case"convolution":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vQ;switch(e.op){case"Conv1D":var a=CY("stride",e,t,n),i=CY("pad",e,t,n),o=CY("dataFormat",e,t,n).toUpperCase(),s=CY("dilation",e,t,n);return[r.conv1d(CY("x",e,t,n),CY("filter",e,t,n),a,i,o,s)];case"Conv2D":var u=CY("strides",e,t,n),c=AY(e,t,n),l=CY("dataFormat",e,t,n).toUpperCase(),d=CY("dilations",e,t,n);return[r.conv2d(CY("x",e,t,n),CY("filter",e,t,n),[u[1],u[2]],c,l,[d[1],d[2]])];case"_FusedConv2D":var h=CQ(e,t,n),p=h.stride,f=h.pad,m=h.dataFormat,v=h.dilations,g=h.biasArg,y=h.preluArg,b=h.activationFunc,x=h.leakyreluAlpha;return[r.fused.conv2d({x:CY("x",e,t,n),filter:CY("filter",e,t,n),strides:[p[1],p[2]],pad:f,dataFormat:m,dilations:[v[1],v[2]],bias:g,activation:b,preluActivationWeights:y,leakyreluAlpha:x})];case"FusedDepthwiseConv2dNative":var w=CQ(e,t,n),k=w.stride,S=w.pad,T=w.dataFormat,_=w.dilations,I=w.biasArg,E=w.preluArg,C=w.activationFunc,M=w.leakyreluAlpha;return[r.fused.depthwiseConv2d({x:CY("x",e,t,n),filter:CY("filter",e,t,n),strides:[k[1],k[2]],pad:S,dataFormat:T,dilations:[_[1],_[2]],bias:I,activation:C,preluActivationWeights:E,leakyreluAlpha:M})];case"Conv2DBackpropInput":case"Conv2dTranspose":var N=CY("outputShape",e,t,n),R=CY("strides",e,t,n),L=AY(e,t,n);return[r.conv2dTranspose(CY("x",e,t,n),CY("filter",e,t,n),N,[R[1],R[2]],L)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":var A=CY("strides",e,t,n),P=AY(e,t,n),D=CY("dilations",e,t,n),O=CY("dataFormat",e,t,n).toUpperCase();return[r.depthwiseConv2d(CY("input",e,t,n),CY("filter",e,t,n),[A[1],A[2]],P,O,[D[1],D[2]])];case"Conv3D":var z=CY("strides",e,t,n),F=CY("pad",e,t,n),G=CY("dataFormat",e,t,n).toUpperCase(),W=CY("dilations",e,t,n);return[r.conv3d(CY("x",e,t,n),CY("filter",e,t,n),[z[1],z[2],z[3]],F,G,[W[1],W[2],W[3]])];case"AvgPool":var V=CY("strides",e,t,n),U=CY("pad",e,t,n),X=CY("kernelSize",e,t,n);return[r.avgPool(CY("x",e,t,n),[X[1],X[2]],[V[1],V[2]],U)];case"MaxPool":var B=CY("strides",e,t,n),H=CY("pad",e,t,n),Z=CY("kernelSize",e,t,n);return[r.maxPool(CY("x",e,t,n),[Z[1],Z[2]],[B[1],B[2]],H)];case"MaxPoolWithArgmax":var K=CY("strides",e,t,n),j=CY("pad",e,t,n),Y=CY("kernelSize",e,t,n),Q=CY("includeBatchInIndex",e,t,n),J=r.maxPoolWithArgmax(CY("x",e,t,n),[Y[1],Y[2]],[K[1],K[2]],j,Q);return[J.result,J.indexes];case"AvgPool3D":var q=CY("strides",e,t,n),$=CY("pad",e,t,n),ee=CY("kernelSize",e,t,n);return[r.avgPool3d(CY("x",e,t,n),[ee[1],ee[2],ee[3]],[q[1],q[2],q[3]],$)];case"MaxPool3D":var te=CY("strides",e,t,n),ne=CY("pad",e,t,n),re=CY("kernelSize",e,t,n);return[r.maxPool3d(CY("x",e,t,n),[re[1],re[2],re[3]],[te[1],te[2],te[3]],ne)];case"Dilation2D":var ae=CY("strides",e,t,n),ie=CY("pad",e,t,n),oe=CY("dilations",e,t,n),se=ae[1],ue=ae[2],ce=oe[1],le=oe[2];return[r.dilation2d(CY("x",e,t,n),CY("filter",e,t,n),[se,ue],ie,[ce,le],"NHWC")];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"creation":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vQ;switch(e.op){case"Fill":var a=CY("shape",e,t,n),i=CY("dtype",e,t,n),o=CY("value",e,t,n);return[r.fill(a,o,i)];case"LinSpace":var s=CY("start",e,t,n),u=CY("stop",e,t,n),c=CY("num",e,t,n);return[r.linspace(s,u,c)];case"Multinomial":var l=CY("logits",e,t,n),d=CY("numSamples",e,t,n),h=CY("seed",e,t,n);return[r.multinomial(l,d,h)];case"OneHot":var p=CY("indices",e,t,n),f=CY("depth",e,t,n),m=CY("onValue",e,t,n),v=CY("offValue",e,t,n),g=CY("dtype",e,t,n);return[r.oneHot(p,f,m,v,g)];case"Ones":return[r.ones(CY("shape",e,t,n),CY("dtype",e,t,n))];case"OnesLike":return[r.onesLike(CY("x",e,t,n))];case"RandomStandardNormal":return[r.randomStandardNormal(CY("shape",e,t,n),CY("dtype",e,t,n),CY("seed",e,t,n))];case"RandomUniform":return[r.randomUniform(CY("shape",e,t,n),CY("minval",e,t,n),CY("maxval",e,t,n),CY("dtype",e,t,n))];case"Range":var y=CY("start",e,t,n),b=CY("stop",e,t,n),x=CY("step",e,t,n);return[r.range(y,b,x,CY("dtype",e,t,n))];case"TruncatedNormal":var w=CY("shape",e,t,n),k=CY("mean",e,t,n),S=CY("stdDev",e,t,n),T=CY("seed",e,t,n);return[r.truncatedNormal(w,k,S,CY("dtype",e,t,n),T)];case"Zeros":return[r.zeros(CY("shape",e,t,n),CY("dtype",e,t,n))];case"ZerosLike":return[r.zerosLike(CY("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"dynamic":return NQ(e,t,n);case"evaluation":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vQ;switch(e.op){case"LowerBound":var a=CY("sortedSequence",e,t,n),i=CY("values",e,t,n);return[r.lowerBound(a,i)];case"TopKV2":var o=CY("x",e,t,n),s=CY("k",e,t,n),u=CY("sorted",e,t,n),c=r.topk(o,s,u);return[c.values,c.indices];case"UpperBound":var l=CY("sortedSequence",e,t,n),d=CY("values",e,t,n);return[r.upperBound(l,d)];case"Unique":var h=CY("x",e,t,n),p=r.unique(h);return[p.values,p.indices];case"UniqueV2":var f=CY("x",e,t,n),m=CY("axis",e,t,n),v=r.unique(f,m);return[v.values,v.indices];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"image":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vQ;switch(e.op){case"ResizeBilinear":var a=CY("images",e,t,n),i=CY("size",e,t,n),o=CY("alignCorners",e,t,n),s=CY("halfPixelCenters",e,t,n);return[r.image.resizeBilinear(a,[i[0],i[1]],o,s)];case"ResizeNearestNeighbor":var u=CY("images",e,t,n),c=CY("size",e,t,n),l=CY("alignCorners",e,t,n),d=CY("halfPixelCenters",e,t,n);return[r.image.resizeNearestNeighbor(u,[c[0],c[1]],l,d)];case"CropAndResize":var h=CY("image",e,t,n),p=CY("boxes",e,t,n),f=CY("boxInd",e,t,n),m=CY("cropSize",e,t,n),v=CY("method",e,t,n),g=CY("extrapolationValue",e,t,n);return[r.image.cropAndResize(h,p,f,m,v,g)];case"ImageProjectiveTransformV3":var y=CY("images",e,t,n),b=CY("transforms",e,t,n),x=CY("outputShape",e,t,n),w=CY("fillValue",e,t,n),k=CY("interpolation",e,t,n),S=CY("fillMode",e,t,n);return[r.image.transform(y,b,k.toLowerCase(),S.toLowerCase(),w,x)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"graph":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vQ;switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":var a=CY("default",e,t,n);return[MY(e.name,t,n)||a];case"Placeholder":return[MY(e.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":case"Snapshot":return[PY(CY("x",e,t,n))];case"IdentityN":return CY("x",e,t,n).map((function(e){return PY(e)}));case"Shape":return[r.tensor1d(CY("x",e,t,n).shape,"int32")];case"ShapeN":return CY("x",e,t,n).map((function(e){return r.tensor1d(e.shape)}));case"Size":return[r.scalar(CY("x",e,t,n).size,"int32")];case"Rank":return[r.scalar(CY("x",e,t,n).rank,"int32")];case"NoOp":return[r.scalar(1)];case"Print":var i=CY("x",e,t,n),o=CY("data",e,t,n),s=CY("message",e,t,n),u=CY("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(s);for(var c=0;c<o.length;c++)console.log(Array.prototype.slice.call(o[c].dataSync()).slice(0,u));return[i];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"logical":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vQ;switch(e.op){case"Equal":return[r.equal(CY("a",e,t,n),CY("b",e,t,n))];case"NotEqual":return[r.notEqual(CY("a",e,t,n),CY("b",e,t,n))];case"Greater":return[r.greater(CY("a",e,t,n),CY("b",e,t,n))];case"GreaterEqual":return[r.greaterEqual(CY("a",e,t,n),CY("b",e,t,n))];case"Less":return[r.less(CY("a",e,t,n),CY("b",e,t,n))];case"LessEqual":return[r.lessEqual(CY("a",e,t,n),CY("b",e,t,n))];case"LogicalAnd":return[r.logicalAnd(CY("a",e,t,n),CY("b",e,t,n))];case"LogicalNot":return[r.logicalNot(CY("a",e,t,n))];case"LogicalOr":return[r.logicalOr(CY("a",e,t,n),CY("b",e,t,n))];case"Select":case"SelectV2":return[r.where(CY("condition",e,t,n),CY("a",e,t,n),CY("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"matrices":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vQ;switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[r.matMul(CY("a",e,t,n),CY("b",e,t,n),CY("transposeA",e,t,n),CY("transposeB",e,t,n))];case"Einsum":return[r.einsum.apply(r,[CY("equation",e,t,n)].concat(b(CY("tensors",e,t,n))))];case"Transpose":return[r.transpose(CY("x",e,t,n),CY("perm",e,t,n))];case"_FusedMatMul":var a=i(CY("fusedOps",e,t,n),2),o=a[0],s=a[1],u="biasadd"===o,c="prelu"===s,l=CY("numArgs",e,t,n),d=CY("leakyreluAlpha",e,t,n);if(u){if(c&&2!==l)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!c&&1!==l)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var h=i(CY("args",e,t,n),2),p=h[0],f=h[1];return[r.fused.matMul({a:CY("a",e,t,n),b:CY("b",e,t,n),transposeA:CY("transposeA",e,t,n),transposeB:CY("transposeB",e,t,n),bias:p,activation:s,preluActivationWeights:f,leakyreluAlpha:d})];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"normalization":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vQ;switch(e.op){case"EuclideanNorm":return[r.euclideanNorm(CY("x",e,t,n),CY("axis",e,t,n),CY("keepDims",e,t,n))];case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[r.batchNorm(CY("x",e,t,n),CY("mean",e,t,n),CY("variance",e,t,n),CY("offset",e,t,n),CY("scale",e,t,n),CY("epsilon",e,t,n))];case"LRN":return[r.localResponseNormalization(CY("x",e,t,n),CY("radius",e,t,n),CY("bias",e,t,n),CY("alpha",e,t,n),CY("beta",e,t,n))];case"Softmax":return[r.softmax(CY("x",e,t,n))];case"LogSoftmax":return[r.logSoftmax(CY("x",e,t,n))];case"SparseToDense":return[r.sparseToDense(CY("sparseIndices",e,t,n),CY("outputShape",e,t,n),CY("sparseValues",e,t,n),CY("defaultValue",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"reduction":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vQ;switch(e.op){case"Max":var a=CY("axis",e,t,n),i=CY("keepDims",e,t,n);return[r.max(CY("x",e,t,n),a,i)];case"Mean":var o=CY("axis",e,t,n),s=CY("keepDims",e,t,n);return[r.mean(CY("x",e,t,n),o,s)];case"Min":var u=CY("axis",e,t,n),c=CY("keepDims",e,t,n);return[r.min(CY("x",e,t,n),u,c)];case"Sum":var l=CY("axis",e,t,n),d=CY("keepDims",e,t,n);return[r.sum(CY("x",e,t,n),l,d)];case"All":var h=CY("axis",e,t,n),p=CY("keepDims",e,t,n);return[r.all(CY("x",e,t,n),h,p)];case"Any":var f=CY("axis",e,t,n),m=CY("keepDims",e,t,n);return[r.any(CY("x",e,t,n),f,m)];case"ArgMax":var v=CY("axis",e,t,n);return[r.argMax(CY("x",e,t,n),v)];case"ArgMin":var g=CY("axis",e,t,n);return[r.argMin(CY("x",e,t,n),g)];case"Prod":var y=CY("axis",e,t,n),b=CY("keepDims",e,t,n);return[r.prod(CY("x",e,t,n),y,b)];case"Cumprod":var x=CY("axis",e,t,n),w=CY("exclusive",e,t,n),k=CY("reverse",e,t,n);return[r.cumprod(CY("x",e,t,n),x,w,k)];case"Cumsum":var S=CY("axis",e,t,n),T=CY("exclusive",e,t,n),_=CY("reverse",e,t,n);return[r.cumsum(CY("x",e,t,n),S,T,_)];case"Bincount":var I=CY("x",e,t,n),E=CY("weights",e,t,n),C=CY("size",e,t,n);return[r.bincount(I,E,C)];case"DenseBincount":var M=CY("x",e,t,n),N=CY("weights",e,t,n),R=CY("size",e,t,n),L=CY("binaryOutput",e,t,n);return[r.denseBincount(M,N,R,L)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"slice_join":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vQ;switch(e.op){case"ConcatV2":case"Concat":var a=CY("n",e,t,n),i=CY("axis",e,t,n),o=CY("tensors",e,t,n);return o=o.slice(0,a),[r.concat(o,i)];case"Gather":var s=CY("x",e,t,n),u=CY("indices",e,t,n);return[r.gather(s,r.cast(u,"int32"),0)];case"GatherV2":var c=CY("axis",e,t,n),l=CY("batchDims",e,t,n),d=CY("x",e,t,n),h=CY("indices",e,t,n);return[r.gather(d,r.cast(h,"int32"),c,l)];case"Reverse":for(var p=CY("dims",e,t,n),f=[],m=0;m<p.length;m++)p[m]&&f.push(m);var v=CY("x",e,t,n);return[r.reverse(v,f)];case"ReverseV2":var g=CY("axis",e,t,n),y=CY("x",e,t,n);return[r.reverse(y,g)];case"Slice":var b=CY("begin",e,t,n),x=CY("size",e,t,n);return[r.slice(CY("x",e,t,n),b,x)];case"StridedSlice":var w=CY("begin",e,t,n),k=CY("end",e,t,n),S=CY("strides",e,t,n),T=CY("beginMask",e,t,n),_=CY("endMask",e,t,n),I=CY("ellipsisMask",e,t,n),E=CY("newAxisMask",e,t,n),C=CY("shrinkAxisMask",e,t,n),M=CY("x",e,t,n);return[r.stridedSlice(M,w,k,S,T,_,I,E,C)];case"Pack":return Rf((function(){var a=CY("axis",e,t,n),i=CY("tensors",e,t,n),o=i[0].shape,s=r.squeeze(i[0]).shape,u=i.map((function(e){var t=ms(e.shape,o);if(!t&&!ms(r.squeeze(e).shape,s))throw new Error("the input tensors shape does not match");return t?e:r.reshape(e,o)}));return[r.stack(u,a)]}));case"Unpack":var N=CY("axis",e,t,n),R=CY("tensor",e,t,n);return r.unstack(R,N);case"Tile":var L=CY("reps",e,t,n);return[r.tile(CY("x",e,t,n),L)];case"Split":case"SplitV":var A=CY("axis",e,t,n),P=CY("numOrSizeSplits",e,t,n),D=CY("x",e,t,n);return r.split(D,P,A);case"ScatterNd":var O=CY("indices",e,t,n),z=CY("values",e,t,n),F=CY("shape",e,t,n);return[r.scatterND(O,z,F)];case"GatherNd":var G=CY("x",e,t,n),W=CY("indices",e,t,n);return[r.gatherND(G,W)];case"SparseToDense":var V=CY("sparseIndices",e,t,n),U=CY("outputShape",e,t,n),X=CY("sparseValues",e,t,n),B=CY("defaultValue",e,t,n);return[r.sparseToDense(V,X,U,X.dtype===B.dtype?B:r.cast(B,X.dtype))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"sparse":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vQ;switch(e.op){case"SparseFillEmptyRows":var a=r.sparse.sparseFillEmptyRows(CY("indices",e,t,n),CY("values",e,t,n),CY("denseShape",e,t,n),CY("defaultValue",e,t,n));return[a.outputIndices,a.outputValues,a.emptyRowIndicator,a.reverseIndexMap];case"SparseReshape":var i=r.sparse.sparseReshape(CY("inputIndices",e,t,n),CY("inputShape",e,t,n),CY("newShape",e,t,n));return[i.outputIndices,i.outputShape];case"SparseSegmentMean":return[r.sparse.sparseSegmentMean(CY("data",e,t,n),CY("indices",e,t,n),CY("segmentIds",e,t,n))];case"SparseSegmentSum":return[r.sparse.sparseSegmentSum(CY("data",e,t,n),CY("indices",e,t,n),CY("segmentIds",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"spectral":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vQ;switch(e.op){case"FFT":return[r.fft(CY("x",e,t,n))];case"IFFT":return[r.ifft(CY("x",e,t,n))];case"RFFT":return[r.rfft(CY("x",e,t,n))];case"IRFFT":return[r.irfft(CY("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"string":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vQ;switch(e.op){case"StringNGrams":var a=r.string.stringNGrams(CY("data",e,t,n),CY("dataSplits",e,t,n),CY("separator",e,t,n),CY("nGramWidths",e,t,n),CY("leftPad",e,t,n),CY("rightPad",e,t,n),CY("padWidth",e,t,n),CY("preserveShortSequences",e,t,n));return[a.nGrams,a.nGramsSplits];case"StringSplit":var i=r.string.stringSplit(CY("input",e,t,n),CY("delimiter",e,t,n),CY("skipEmpty",e,t,n));return[i.indices,i.values,i.shape];case"StringToHashBucketFast":return[r.string.stringToHashBucketFast(CY("input",e,t,n),CY("numBuckets",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"transformation":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vQ;switch(e.op){case"Cast":return[r.cast(CY("x",e,t,n),CY("dtype",e,t,n))];case"ExpandDims":var a=CY("axis",e,t,n);return[r.expandDims(CY("x",e,t,n),a)];case"Squeeze":var i=CY("axis",e,t,n);return[r.squeeze(CY("x",e,t,n),i)];case"Reshape":return[r.reshape(CY("x",e,t,n),CY("shape",e,t,n))];case"MirrorPad":return[r.mirrorPad(CY("x",e,t,n),CY("padding",e,t,n),CY("mode",e,t,n))];case"PadV2":case"Pad":return[r.pad(CY("x",e,t,n),CY("padding",e,t,n),CY("constantValue",e,t,n))];case"SpaceToBatchND":var o=CY("blockShape",e,t,n),s=CY("paddings",e,t,n);return[r.spaceToBatchND(CY("x",e,t,n),o,s)];case"BatchToSpaceND":var u=CY("blockShape",e,t,n),c=CY("crops",e,t,n);return[r.batchToSpaceND(CY("x",e,t,n),u,c)];case"DepthToSpace":var l=CY("blockSize",e,t,n),d=CY("dataFormat",e,t,n).toUpperCase();return[r.depthToSpace(CY("x",e,t,n),l,d)];case"BroadcastTo":return[r.broadcastTo(CY("x",e,t,n),CY("shape",e,t,n))];case"BroadcastArgs":return[r.broadcastArgs(CY("s0",e,t,n),CY("s1",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"hash_table":return LQ(e,t,n,r);case"custom":var o=EY(e.op);if(o&&o.customExecutor)return o.customExecutor(new mQ(e,t,n));throw TypeError("Custom op ".concat(e.op," is not registered."));default:throw TypeError("Unknown op '".concat(e.op,"'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()"))}}(e,t,n);return Zs(o)?o.then((function(e){return[].concat(e)})):[].concat(o)}var PQ=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};T(this,e),this.weightMap=t,this.tensorArrayMap=n,this.tensorListMap=r,this.functionMap=a,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return E(e,[{key:"newFrame",value:function(e,t){return{id:e,frameName:t,iterationId:0}}},{key:"currentContext",get:function(){return this.contexts},set:function(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}},{key:"currentContextId",get:function(){return this._currentContextIds[0]}},{key:"currentContextIds",get:function(){return this._currentContextIds}},{key:"generateCurrentContextIds",value:function(){for(var e=[],t=0;t<this.contexts.length-1;t++){var n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e}},{key:"contextIdforContexts",value:function(e){return e?e.map((function(e){return 0===e.id&&0===e.iterationId?"":"".concat(e.frameName,"-").concat(e.iterationId)})).join("/"):""}},{key:"enterFrame",value:function(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}},{key:"exitFrame",value:function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}},{key:"nextIteration",value:function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}},{key:"getWeight",value:function(e){return this.weightMap[e]}},{key:"addTensorArray",value:function(e){this.tensorArrayMap[e.id]=e}},{key:"getTensorArray",value:function(e){return this.tensorArrayMap[e]}},{key:"addTensorList",value:function(e){this.tensorListMap[e.id]=e}},{key:"getTensorList",value:function(e){return this.tensorListMap[e]}},{key:"dispose",value:function(e){for(var t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(var n in this.tensorListMap)this.tensorListMap[n].clearAndClose(e)}}]),e}();function DQ(e,t,n,r){var a=new Set,i=[],o=null,s=null,u=new Set,c=Object.keys(e).map((function(e){return LY(e)[0]})),l=[];null!=r&&(l=r.map((function(e){return LY(e.name)[0]})));for(var d=b(t);d.length>0;){var h=d.pop();if((GQ(h)||WQ(h)||VQ(h))&&null==o&&(s=(o=h).children.map((function(e){return e.name})).filter((function(e){return a.has(e)}))),a.add(h.name),null==n[h.name]&&-1===c.indexOf(h.name)&&-1===l.indexOf(h.name)){if(0===h.inputs.length){i.push(h.name);continue}h.inputs.forEach((function(e){u.has(e.name)||(u.add(e.name),d.push(e))}))}}return{inputs:e,outputs:t,usedNodes:a,missingInputs:i,dynamicNode:o,syncInputs:s}}var OQ=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],zQ=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],FQ=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function GQ(e){return OQ.indexOf(e.op)>=0}function WQ(e){return zQ.indexOf(e.op)>=0}function VQ(e){return FQ.indexOf(e.op)>=0}var UQ=function(){function e(t,n){var r=this;T(this,e),this.graph=t,this.parent=n,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this.intermediateTensors={},this.keepTensorForDebug=!1,this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,null!=t.functions&&Object.keys(t.functions).forEach((function(n){r._functionExecutorMap[n]=new e(t.functions[n],r)}))}return E(e,[{key:"weightIds",get:function(){return this.parent?this.parent.weightIds:this._weightIds}},{key:"functionExecutorMap",get:function(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}},{key:"weightMap",get:function(){return this.parent?this.parent.weightMap:this._weightMap},set:function(e){var t,n=Object.keys(e).map((function(t){return e[t].map((function(e){return e.id}))}));this._weightIds=(t=[]).concat.apply(t,b(n)),this._weightMap=e}},{key:"resourceManager",set:function(e){this._resourceManager=e}},{key:"inputs",get:function(){return this._inputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))}},{key:"outputs",get:function(){return this._outputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))}},{key:"inputNodes",get:function(){return this._inputs.map((function(e){return e.signatureKey||e.name}))}},{key:"outputNodes",get:function(){return this._outputs.map((function(e){var t=e.signatureKey||e.name;return e.defaultOutput?"".concat(t,":").concat(e.defaultOutput):t}))}},{key:"functions",get:function(){var e=this;return Object.keys(this._functions).reduce((function(t,n){return t[n]=e._functions[n].signature,t}),{})}},{key:"getCompilationKey",value:function(e,t){var n=e.map((function(e){return e.name})).sort(),r=t.map((function(e){return e.name})).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)}},{key:"compile",value:function(e,t){var n=DQ(e,t,this.weightMap,this._initNodes),r=n.missingInputs,a=n.dynamicNode,i=n.syncInputs;if(null!=a)throw new Error("This execution contains the node '".concat(a.name,"', which has the dynamic op '").concat(a.op,"'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [").concat(i,"]"));if(r.length>0){var o=t.map((function(e){return e.name})),s=Object.keys(e);throw new Error("Cannot compute the outputs [".concat(o,"] from the provided inputs [").concat(s,"]. Missing the following inputs: [").concat(r,"]"))}return function(e,t,n){var r=n.usedNodes,a=n.inputs,i=[],o=Object.keys(a).map((function(e){return LY(e)[0]})).map((function(t){return e.nodes[t]})),s=e.initNodes;o.forEach((function(e){r.has(e.name)&&i.push(e)})),e.weights.forEach((function(e){r.has(e.name)&&i.push(e)})),null!=s&&s.forEach((function(e){r.has(e.name)&&i.push(e)}));for(var u=new Set,c=[];i.length>0;){var l=i.pop();u.add(l.name),t[l.name]||c.push(l),l.children.forEach((function(e){!u.has(e.name)&&r.has(e.name)&&e.inputs.every((function(e){return u.has(e.name)}))&&i.push(e)}))}return c}(this.graph,this.weightMap,n)}},{key:"execute",value:function(e,t){var n=this;e=this.mapInputs(e);var r=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);var a=r.map((function(e){return n.graph.nodes[LY(e)[0]]})),o=t.map((function(e){return LY(e)[0]})),s=o.map((function(e){return n.graph.nodes[e]}));this.resetIntermediateTensors(),0===s.length&&(s=this._outputs);var u=this.getCompilationKey(a,s),c=this.compiledMap.get(u);null==c&&(c=this.compile(e,s),this.compiledMap.set(u,c));var l={},d={};return Rf((function(){var r=new PQ(n.weightMap,l,d,n.functionExecutorMap),a=Object.assign({},n.weightMap);Object.keys(e).forEach((function(t){var n=i(LY(t),2),r=n[0],o=[];o[n[1]]=e[t],a[r]=o}));for(var s=n.getFrozenTensorIds(a),u={},h=0;h<c.length;h++){var p=c[h];if(!a[p.name]){var f=AQ(p,a,r,n._resourceManager);if(Zs(f))throw new Error("The execution of the op '".concat(p.op,"' returned a promise. Please use model.executeAsync() instead."));a[p.name]=f,n.checkTensorForDisposal(p.name,p,a,r,s,o,u)}}return null==n.parent&&r.dispose(s),t.map((function(e){return MY(e,a,r)}))}))}},{key:"getFrozenTensorIds",value:function(e){var t=[].concat.apply([],Object.keys(e).map((function(t){return e[t]})).map((function(e){return e.map((function(e){return e.id}))})));return new Set(t)}},{key:"checkTensorForDisposal",value:function(e,t,n,r,a,o,s){var u=this;"control"===t.category||-1!==o.indexOf(e)||(n[e].forEach((function(e){null!=e&&(s[e.id]=(s[e.id]||0)+t.children.length)})),t.inputs.forEach((function(e){if("control"!==e.category){var o=function(e,t,n){return t[RY(e,n.currentContextId)]}(e.name,n,r);null!=o&&o.forEach((function(e){if(e&&!e.kept&&!a.has(e.id)){var n=s[e.id];if(1===n){if(u.keepTensorForDebug){var o=i(NY(t.name,r),2),c=o[0],l=o[1];u.intermediateTensors[c]||(u.intermediateTensors[c]=[]),u.intermediateTensors[c][l]=e}else e.dispose();delete s[e.id]}else null!=n&&s[e.id]--}}))}})))}},{key:"executeAsync",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._executeAsync(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"disposeIntermediateTensors",value:function(){var e=this;this.intermediateTensors&&(Object.keys(this.intermediateTensors).forEach((function(t){return e.intermediateTensors[t].forEach((function(e){return e.dispose()}))})),this.disposeTensorsMap())}},{key:"disposeTensorsMap",value:function(){var e=this;this.tensorsMap&&Object.keys(this.tensorsMap).forEach((function(t){e.tensorsMap[t].forEach((function(t){t&&!t.kept&&!t.isDisposed&&!e.keepIds.has(t.id)&&t.dispose()}))}))}},{key:"getIntermediateTensors",value:function(){return this.tensorsMap}},{key:"resetIntermediateTensors",value:function(){for(var e in this.intermediateTensors)this.intermediateTensors[e].forEach((function(e){return e.dispose()})),delete this.intermediateTensors[e]}},{key:"_executeAsync",value:function(){var e=S(w().mark((function e(t,n){var r,a,i,o,s,u,c,l=this,d=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=d.length>3&&void 0!==d[3]?d[3]:{},i=d.length>4&&void 0!==d[4]?d[4]:{},(r=d.length>2&&void 0!==d[2]&&d[2])||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),n=this.mapOutputs(n),this.checkOutputs(n));try{this.keepTensorForDebug=Qs().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(qo){console.warn(qo.message)}return this.resetIntermediateTensors(),o=new PQ(this.weightMap,a,i,this.functionExecutorMap),e.next=9,this.executeWithControlFlow(t,o,n,r);case 9:return this.tensorsMap=e.sent,s=n.map((function(e){return MY(e,l.tensorsMap,o)})),u=s.map((function(e){return e.id})),c=Object.keys(t).map((function(e){return t[e].id})),e.abrupt("return",(this.keepIds=new Set([].concat(b(u),b(c),b(this.weightIds))),this.keepTensorForDebug||this.disposeTensorsMap(),null==this.parent&&o.dispose(this.keepIds),s));case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"executeFunctionAsync",value:function(){var e=S(w().mark((function e(t,n,r){var a,i=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.reduce((function(e,t,n){return e[i.inputs[n].name]=t,e}),{}),e.abrupt("return",this._executeAsync(a,this.outputNodes,!0,n,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"executeWithControlFlow",value:function(){var e=S(w().mark((function e(t,n,r,a){var o,s,u,c,l,d,h,p,f,m,v,g,y,x,k,S,T,_=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=Object.keys(t),s=o.map((function(e){return _.graph.nodes[LY(e)[0]]})),u=r.map((function(e){return LY(e)[0]})),c=u.map((function(e){return _.graph.nodes[e]})),0===c.length&&(c=this._outputs),l=DQ(t,c,this.weightMap,this._initNodes),d=l.usedNodes,h=l.missingInputs,p=l.dynamicNode,f=l.syncInputs,m=[].concat(b(s),b(this.graph.weights),b(this._initNodes||[])).map((function(e){return{node:e,contexts:n.currentContext}})),v=Object.assign({},this.weightMap),Object.keys(t).forEach((function(e){var n=i(LY(e),2),r=n[0],a=[];a[n[1]]=t[e],v[r]=a})),g={},y=this.getFrozenTensorIds(v),x={};case 6:if(!(m.length>0)){e.next=12;break}return k=this.processStack(s,m,n,v,x,y,u,g,d),e.next=10,Promise.all(k);case 10:e.next=6;break;case 12:if(null==p&&!a&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),S=c.filter((function(e){return!GQ(e)&&!MY(e.name,v,n)})).map((function(e){return e.name})),!(S.length>0)){e.next=17;break}throw T="",null!=p&&(T="Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [".concat(f,"]")),new Error("Cannot compute the outputs [".concat(S,"] from the provided inputs [").concat(o,"]. Consider providing the following inputs: [").concat(h,"]. ").concat(T));case 17:return e.abrupt("return",v);case 18:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"processStack",value:function(e,t,n,r,a,o,s,u,c){for(var l=this,d=[],h=function(){var e,h=t.pop();n.currentContext=h.contexts;var p="";if("Enter"===h.node.op&&CY("isConstant",h.node,r,n)&&(e=i(NY(h.node.name,n),1),p=e[0]),null==r[h.node.name]){var f,m=AQ(h.node,r,n,l._resourceManager);p||(f=i(NY(h.node.name,n),1),p=f[0]);var v=n.currentContext;Zs(m)?d.push(m.then((function(e){return r[p]=e,n.currentContext=v,l.checkTensorForDisposal(p,h.node,r,n,o,s,u),l.processChildNodes(h.node,t,n,r,a,c),e}))):(r[p]=m,l.checkTensorForDisposal(p,h.node,r,n,o,s,u),l.processChildNodes(h.node,t,n,r,a,c))}else l.processChildNodes(h.node,t,n,r,a,c)};t.length>0;)h();return d}},{key:"processChildNodes",value:function(e,t,n,r,a,o){e.children.forEach((function(e){var s=i(NY(e.name,n),1)[0];a[s]||!o.has(e.name)||("Merge"===e.op?e.inputNames.some((function(e){return!!MY(e,r,n)}))&&(a[s]=!0,t.push({contexts:n.currentContext,node:e})):e.inputNames.every((function(e){return!!MY(e,r,n)}))&&(a[s]=!0,t.push({contexts:n.currentContext,node:e})))}))}},{key:"dispose",value:function(){var e=this;Object.keys(this.weightMap).forEach((function(t){return e.weightMap[t].forEach((function(e){return e.dispose()}))}))}},{key:"checkInputShapeAndType",value:function(e){var t=this;Object.keys(e).forEach((function(n){var r=e[n],a=i(LY(n),1)[0],o=t.graph.nodes[a];if(o.attrParams.shape&&o.attrParams.shape.value){var s=o.attrParams.shape.value;ls(s.length===r.shape.length&&r.shape.every((function(e,t){return-1===s[t]||s[t]===e})),(function(){return"The shape of dict['".concat(o.name,"'] provided in model.execute(dict) must be [").concat(s,"], but was [").concat(r.shape,"]")}))}o.attrParams.dtype&&o.attrParams.dtype.value&&ls(r.dtype===o.attrParams.dtype.value,(function(){return"The dtype of dict['".concat(o.name,"'] provided in model.execute(dict) must be ").concat(o.attrParams.dtype.value,", but was ").concat(r.dtype)}))}))}},{key:"mapInputs",value:function(e){var t={};for(var n in e)if(null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[n]){t[this._signature.inputs[n].name]=e[n]}else t[n]=e[n];return t}},{key:"checkInputs",value:function(e){var t=this,n=Object.keys(e).filter((function(e){var n=i(LY(e),1)[0];return null==t.graph.nodes[n]}));if(n.length>0)throw new Error("The dict provided in model.execute(dict) has keys: [".concat(n,"] that are not part of graph"))}},{key:"mapOutputs",value:function(e){var t=this;return e.map((function(e){return null!=t._signature&&null!=t._signature.outputs&&null!=t._signature.outputs[e]?t._signature.outputs[e].name:e}),{})}},{key:"checkOutputs",value:function(e){var t=this;e.forEach((function(e){var n=i(LY(e),1)[0];if(!t.graph.nodes[n])throw new Error("The output '".concat(e,"' is not found in the graph"))}))}}]),e}(),XQ=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};T(this,e),this.hashTableNameToHandle=t,this.hashTableMap=n}return E(e,[{key:"addHashTable",value:function(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}},{key:"getHashTableHandleByName",value:function(e){return this.hashTableNameToHandle[e]}},{key:"getHashTableById",value:function(e){return this.hashTableMap[e]}},{key:"dispose",value:function(){for(var e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(var t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}}]),e}(),BQ="?tfjs-format=file",HQ="model.json",ZQ=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:$K;T(this,e),this.modelUrl=t,this.loadOptions=n,this.version="n/a",this.io=r,null==n&&(this.loadOptions={}),this.resourceManager=new XQ}return E(e,[{key:"modelVersion",get:function(){return this.version}},{key:"inputNodes",get:function(){return this.executor.inputNodes}},{key:"outputNodes",get:function(){return this.executor.outputNodes}},{key:"inputs",get:function(){return this.executor.inputs}},{key:"outputs",get:function(){return this.executor.outputs}},{key:"weights",get:function(){return this.executor.weightMap}},{key:"metadata",get:function(){return this.artifacts.userDefinedMetadata}},{key:"modelSignature",get:function(){return this.signature}},{key:"modelStructuredOutputKeys",get:function(){return this.structuredOutputKeys}},{key:"findIOHandler",value:function(){var e=this.modelUrl;if(null!=e.load)this.handler=e;else if(null!=this.loadOptions.requestInit)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{var t=this.io.getLoadHandlers(e,this.loadOptions);if(0===t.length)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error("Found more than one (".concat(t.length,") load handlers for URL '").concat([e],"'"));this.handler=t[0]}}},{key:"load",value:function(){var e=this;if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");var t=this.handler.load();return Zs(t)?t.then((function(t){return e.loadSync(t)})):this.loadSync(t)}},{key:"loadSync",value:function(e){this.artifacts=e;var t=this.artifacts.modelTopology,n=this.artifacts.signature;if(null!=this.artifacts.userDefinedMetadata){var r=this.artifacts.userDefinedMetadata;null!=r.signature&&(n=r.signature),null!=r.structuredOutputKeys&&(this.structuredOutputKeys=r.structuredOutputKeys)}this.signature=n,this.version="".concat(t.versions.producer,".").concat(t.versions.minConsumer);var a=this.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new UQ(eQ.Instance.transformGraph(t,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(a),this.executor.resourceManager=this.resourceManager,null!=e.modelInitializer&&null!=e.modelInitializer.node){var i=eQ.Instance.transformGraph(e.modelInitializer);this.initializer=new UQ(i),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}},{key:"save",value:function(){var e=S(w().mark((function e(t,n){var r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=7;break}if(0!==(r=this.io.getSaveHandlers(t)).length){e.next=4;break}throw new Error("Cannot find any save handlers for URL '".concat(t,"'"));case 4:if(!(r.length>1)){e.next=6;break}throw new Error("Found more than one (".concat(r.length,") save handlers for URL '").concat(t,"'"));case 6:t=r[0];case 7:if(null!=t.save){e.next=9;break}throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 9:return e.abrupt("return",t.save(this.artifacts));case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"predict",value:function(e,t){var n=this,r=this.execute(e,this.outputNodes);if(this.structuredOutputKeys){var a={};return(r instanceof kh?[r]:r).forEach((function(e,t){return a[n.structuredOutputKeys[t]]=e})),a}return r}},{key:"normalizeInputs",value:function(e){if(!(e instanceof kh)&&!Array.isArray(e))return e;if((e=Array.isArray(e)?e:[e]).length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,the graph model has ".concat(this.inputNodes.length," placeholders, while there are ").concat(e.length," input tensors."));return this.inputNodes.reduce((function(t,n,r){return t[n]=e[r],t}),{})}},{key:"normalizeOutputs",value:function(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}},{key:"execute",value:function(e,t){e=this.normalizeInputs(e),t=this.normalizeOutputs(t);var n=this.executor.execute(e,t);return n.length>1?n:n[0]}},{key:"executeAsync",value:function(){var e=S(w().mark((function e(t,n){var r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.normalizeInputs(t),n=this.normalizeOutputs(n),e.next=3,this.executor.executeAsync(t,n);case 3:return r=e.sent,e.abrupt("return",r.length>1?r:r[0]);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getIntermediateTensors",value:function(){return this.executor.getIntermediateTensors()}},{key:"disposeIntermediateTensors",value:function(){this.executor.disposeIntermediateTensors()}},{key:"convertTensorMapToTensorsMap",value:function(e){return Object.keys(e).reduce((function(t,n){return t[n]=[e[n]],t}),{})}},{key:"dispose",value:function(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}}]),e}();function KQ(){return KQ=S(w().mark((function e(t){var n,r,a,i=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:{},r=i.length>2&&void 0!==i[2]?i[2]:$K,null!=t){e.next=4;break}throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");case 4:return null==n&&(n={}),n.fromTFHub&&"string"==typeof t&&(t=jQ(t)),a=new ZQ(t,n,r),e.next=8,a.load();case 8:return e.abrupt("return",a);case 9:case"end":return e.stop()}}),e)}))),KQ.apply(this,arguments)}function jQ(e){return e.endsWith("/")||(e+="/"),"".concat(e).concat(HQ).concat(BQ)}var YQ="3.21.0",QQ=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this)).input=e,r}return E(n,[{key:"iterator",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.input.iterator();case 2:return e.abrupt("return",e.sent.decodeUTF8().split("\n").map((function(e){return e.endsWith("\r")&&(e=e.slice(0,-1)),e})));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(LN),JQ='"',qQ=Symbol("out"),$Q=Symbol("field"),eJ=Symbol("quote"),tJ=Symbol("quoteafterquote"),nJ=Symbol("quoteinquote"),rJ=function(e){m(n,e);var t=y(n);function n(e,r){var a;return T(this,n),(a=t.call(this)).input=e,a.hasHeader=!0,a.fullColumnNames=null,a.columnNamesValidated=!1,a.columnConfigs=null,a.configuredColumnsOnly=!1,a.delimiter=",",a.delimWhitespace=!1,a.base=new QQ(e),r||(r={}),a.hasHeader=!1!==r.hasHeader,a.fullColumnNames=r.columnNames,a.columnConfigs=r.columnConfigs,a.configuredColumnsOnly=r.configuredColumnsOnly,r.delimWhitespace?(ls(null==r.delimiter,(function(){return"Delimiter should not be provided when delimWhitespace is true."})),a.delimWhitespace=!0,a.delimiter=" "):a.delimiter=r.delimiter?r.delimiter:",",a}return E(n,[{key:"columnNames",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.columnNamesValidated,e.t0){e.next=4;break}return e.next=4,this.setColumnNames();case 4:return e.abrupt("return",this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setColumnNames",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i,o,s=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.maybeReadHeaderLine();case 2:if(t=e.sent,this.fullColumnNames||t){e.next=5;break}throw new Error("Column names must be provided if there is no header line.");case 5:if(this.fullColumnNames&&t&&ls(t.length===this.fullColumnNames.length,(function(){return"The length of provided columnNames ("+s.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+t.length.toString()+")."})),this.fullColumnNames||(this.fullColumnNames=t),n=this.fullColumnNames.reduce((function(e,t){return e[t]=e[t]+1||1,e}),{}),r=Object.keys(n).filter((function(e){return n[e]>1})),ls(0===r.length,(function(){return"Duplicate column names found: "+r.toString()})),!this.columnConfigs){e.next=16;break}a=0,i=Object.keys(this.columnConfigs);case 9:if(!(a<i.length)){e.next=16;break}if(o=i[a],-1!==this.fullColumnNames.indexOf(o)){e.next=13;break}throw new Error('The key "'+o+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").");case 13:a++,e.next=9;break;case 16:this.columnNamesValidated=!0;case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"maybeReadHeaderLine",value:function(){var e=S(w().mark((function e(){var t,n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasHeader){e.next=12;break}return e.next=3,this.base.iterator();case 3:return e.next=5,e.sent.next();case 5:if(!(t=e.sent).done){e.next=8;break}throw new Error("No data was found for CSV parsing.");case 8:return n=t.value,e.abrupt("return",this.parseRow(n,!1));case 12:return e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"iterator",value:function(){var e=S(w().mark((function e(){var t,n=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.columnNamesValidated,e.t0){e.next=4;break}return e.next=4,this.setColumnNames();case 4:return e.next=6,this.base.iterator();case 6:return t=e.sent,e.abrupt("return",(this.hasHeader&&(t=t.skip(1)),t.map((function(e){return n.makeDataElement(e)}))));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"makeDataElement",value:function(e){for(var t=this.parseRow(e),n={},r={},a=0;a<this.fullColumnNames.length;a++){var i=this.fullColumnNames[a],o=this.columnConfigs?this.columnConfigs[i]:null;if(!this.configuredColumnsOnly||o){var s=t[a],u=null;if(""===s)if(o&&void 0!==o.default)u=o.default;else{if(o&&(o.required||o.isLabel))throw new Error("Required column ".concat(i," is empty in this line: ").concat(e));u=void 0}else{var c=Number(s);if(isNaN(c))u=o&&"bool"===o.dtype?this.getBoolean(s):s;else if(o&&o.dtype)switch(o.dtype){case"float32":default:u=c;break;case"int32":u=Math.floor(c);break;case"bool":u=this.getBoolean(s)}else u=c}o&&o.isLabel?r[i]=u:n[i]=u}}return 0===Object.keys(r).length?n:{xs:n,ys:r}}},{key:"getBoolean",value:function(e){return"1"===e||"true"===e.toLowerCase()?1:0}},{key:"parseRow",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=[],r=0,a=e.length,i=qQ,o=0;o<a;o++)switch(i){case qQ:switch(e.charAt(o)){case JQ:r=o+1,i=eJ;break;case this.delimiter:if(r=o+1," "===this.delimiter&&this.delimWhitespace)break;n.push(""),i=qQ;break;default:i=$Q,r=o}break;case $Q:if(e.charAt(o)===this.delimiter)n.push(e.substring(r,o)),i=qQ,r=o+1;break;case eJ:if(e.charAt(o)===JQ)i=tJ;break;case tJ:switch(e.charAt(o)){case this.delimiter:n.push(e.substring(r,o-1)),i=qQ,r=o+1;break;case JQ:i=eJ;break;default:i=nJ}break;case nJ:if(e.charAt(o)===JQ)i=eJ}if(i===tJ?n.push(e.substring(r,a-1)):n.push(e.substring(r)),t&&n.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have ".concat(this.fullColumnNames.length," elements in a row, but got ").concat(n));return n}}]),n}(LN),aJ=function(e){m(n,e);var t=y(n);function n(e){var r;T(this,n),(r=t.call(this)).microphoneConfig=e,r.isClosed=!1,r.fftSize=e.fftSize||1024;var a=Math.log2(r.fftSize);if(r.fftSize<0||a<4||a>14||!Number.isInteger(a))throw new Error("Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got ".concat(r.fftSize));if(r.numFrames=e.numFramesPerSpectrogram||43,r.sampleRateHz=e.sampleRateHz,r.columnTruncateLength=e.columnTruncateLength||r.fftSize,r.audioTrackConstraints=e.audioTrackConstraints,r.smoothingTimeConstant=e.smoothingTimeConstant||0,r.includeSpectrogram=!1!==e.includeSpectrogram,r.includeWaveform=!0===e.includeWaveform,!r.includeSpectrogram&&!r.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.");return r}return E(n,[{key:"summary",value:function(){return"microphone"}},{key:"start",value:function(){var e=S(w().mark((function e(){var t,n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({audio:null==this.audioTrackConstraints||this.audioTrackConstraints,video:!1});case 3:this.stream=e.sent,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),new Error("Error thrown while initializing video stream: ".concat(e.t0.message));case 9:if(this.stream){e.next=11;break}throw new Error("Could not obtain audio from microphone.");case 11:if(t=window.AudioContext||window.webkitAudioContext,this.audioContext=new t,this.sampleRateHz){e.next=16;break}this.sampleRateHz=this.audioContext.sampleRate,e.next=18;break;case 16:if(this.audioContext.sampleRate===this.sampleRateHz){e.next=18;break}throw new Error("Mismatch in sampling rate: Expected: ".concat(this.sampleRateHz,"; Actual: ").concat(this.audioContext.sampleRate));case 18:n=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,n.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize);case 20:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"next",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isClosed){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return e.next=4,this.getAudioData();case 4:return r=e.sent,this.includeSpectrogram&&(a=this.flattenQueue(r.freqDataQueue),t=this.getTensorFromAudioDataArray(a,[this.numFrames,this.columnTruncateLength,1])),this.includeWaveform&&(i=this.flattenQueue(r.timeDataQueue),n=this.getTensorFromAudioDataArray(i,[this.numFrames*this.fftSize,1])),e.abrupt("return",{value:{spectrogram:t,waveform:n},done:!1});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"capture",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:return e.abrupt("return",e.sent.value);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAudioData",value:function(){var e=S(w().mark((function e(){var t,n,r,a=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],n=[],r=0,e.abrupt("return",new Promise((function(e){var i=setInterval((function(){a.includeSpectrogram&&(a.analyser.getFloatFrequencyData(a.freqData),a.freqData[0]===-1/0&&e({freqDataQueue:t,timeDataQueue:n}),t.push(a.freqData.slice(0,a.columnTruncateLength))),a.includeWaveform&&(a.analyser.getFloatTimeDomainData(a.timeData),n.push(a.timeData.slice())),++r===a.numFrames&&(clearInterval(i),e({freqDataQueue:t,timeDataQueue:n}))}),a.fftSize/a.sampleRateHz*1e3)})));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),null!=this.stream&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())}},{key:"toArray",value:function(){throw new Error("Can not convert infinite audio stream to array.")}},{key:"getSampleRate",value:function(){return this.sampleRateHz}},{key:"flattenQueue",value:function(e){var t=e[0].length,n=new Float32Array(e.length*t);return e.forEach((function(e,r){return n.set(e,r*t)})),n}},{key:"getTensorFromAudioDataArray",value:function(e,t){var n=new Float32Array(fs(t));return n.set(e,n.length-e.length),ip(n,t)}}],[{key:"create",value:function(){var e=S(w().mark((function e(){var t,r,a=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]?a[0]:{},Qs().get("IS_BROWSER")){e.next=3;break}throw new Error("microphone API is only supported in browser environment.");case 3:return r=new n(t),e.next=6,r.start();case 6:return e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),n}(mN),iJ=function(e){m(n,e);var t=y(n);function n(e,r){var a;if(T(this,n),(a=t.call(this)).webcamVideoElement=e,a.webcamConfig=r,a.isClosed=!0,a.resize=!1,a.needToResize())if(a.resize=!0,a.cropSize=[a.webcamConfig.resizeHeight,a.webcamConfig.resizeWidth],a.cropBoxInd=ab([0],"int32"),a.webcamConfig.centerCrop){var i=1*a.webcamConfig.resizeWidth/a.webcamVideoElement.width,o=1*a.webcamConfig.resizeHeight/a.webcamVideoElement.height,s=(1-i)/2,u=(1-o)/2,c=s+i,l=o+u;a.cropBox=ib([u,s,l,c],[1,4])}else a.cropBox=ib([0,0,1,1],[1,4]);return p(a)}return E(n,[{key:"summary",value:function(){return"webcam"}},{key:"start",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.webcamConfig.facingMode&&ls("user"===this.webcamConfig.facingMode||"environment"===this.webcamConfig.facingMode,(function(){return"Invalid webcam facing mode: ".concat(t.webcamConfig.facingMode,". Please provide 'user' or 'environment'")})),e.prev=1,e.next=4,navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}});case 4:this.stream=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),e.t0.message="Error thrown while initializing video stream: ".concat(e.t0.message),e.t0;case 10:if(this.stream){e.next=12;break}throw new Error("Could not obtain video from webcam.");case 12:try{this.webcamVideoElement.srcObject=this.stream}catch(jZ){console.log(jZ),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return e.abrupt("return",(this.webcamVideoElement.play(),this.isClosed=!1,new Promise((function(e){t.webcamVideoElement.onloadedmetadata=function(){e()}}))));case 14:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"next",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isClosed){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:e.prev=2,t=Qf(this.webcamVideoElement),e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(2),new Error("Error thrown converting video to pixels: ".concat(JSON.stringify(e.t0)));case 9:if(!this.resize){e.next=22;break}return e.prev=10,e.abrupt("return",{value:this.cropAndResizeFrame(t),done:!1});case 14:throw e.prev=14,e.t1=e.catch(10),new Error("Error thrown cropping the video: ".concat(e.t1.message));case 17:return e.prev=17,t.dispose(),e.finish(17);case 20:e.next=23;break;case 22:return e.abrupt("return",{value:t,done:!1});case 23:case"end":return e.stop()}}),e,this,[[2,6],[10,14,17,20]])})));return function(){return e.apply(this,arguments)}}()},{key:"needToResize",value:function(){return!(!this.webcamConfig.resizeWidth||!this.webcamConfig.resizeHeight||this.webcamVideoElement.width===this.webcamConfig.resizeWidth&&this.webcamVideoElement.height===this.webcamConfig.resizeHeight)}},{key:"cropAndResizeFrame",value:function(e){var t=this;return Rf((function(){var n,r=lg(hf(e,"float32"),0),a=(n=_x.cropAndResize(r,t.cropBox,t.cropBoxInd,t.cropSize,"bilinear")).shape;return nv(n,a.slice(1))}))}},{key:"capture",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:return e.abrupt("return",e.sent.value);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){this.stream.getTracks().forEach((function(e){return e.stop()}));try{this.webcamVideoElement.srcObject=null}catch(KZ){console.log(KZ),this.webcamVideoElement.src=null}this.isClosed=!0}},{key:"toArray",value:function(){throw new Error("Can not convert infinite video stream to array.")}}],[{key:"create",value:function(){var e=S(w().mark((function e(t){var r,a,i=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>1&&void 0!==i[1]?i[1]:{},Qs().get("IS_BROWSER")){e.next=3;break}throw new Error("tf.data.webcam is only supported in browser environment.");case 3:if(t){e.next=7;break}if(t=document.createElement("video"),r.resizeWidth&&r.resizeHeight){e.next=6;break}throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");case 6:t.width=r.resizeWidth,t.height=r.resizeHeight;case 7:return a=new n(t,r),e.next=10,a.start();case 10:return e.abrupt("return",a);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),n}(mN),oJ=E((function e(){T(this,e)})),sJ=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n,[{key:"split",value:function(e){return new uJ(this,e)}}]),n}(mN),uJ=function(e){m(n,e);var t=y(n);function n(e,r){var a;return T(this,n),(a=t.call(this)).upstream=e,a.impl=new cJ(e,r),a}return E(n,[{key:"summary",value:function(){return this.impl.summary()}},{key:"next",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.impl.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(sJ),cJ=function(e){m(n,e);var t=y(n);function n(e,r){var a;return T(this,n),(a=t.call(this)).upstream=e,a.separator=r,a.carryover="",a}return E(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Split('").concat(this.separator,"')")}},{key:"pump",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",""!==this.carryover&&(this.outputQueue.push(this.carryover),this.carryover="",!0));case 5:(n=t.value.split(this.separator))[0]=this.carryover+n[0],r=x(n.slice(0,-1));try{for(r.s();!(a=r.n()).done;)i=a.value,this.outputQueue.push(i)}catch(o){r.e(o)}finally{r.f()}return e.abrupt("return",(this.carryover=n[n.length-1],!0));case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(IN),lJ=function(e){m(n,e);var t=y(n);function n(){return T(this,n),t.apply(this,arguments)}return E(n,[{key:"decodeUTF8",value:function(){return new dJ(this)}}]),n}(mN),dJ=function(e){m(n,e);var t=y(n);function n(e){var r;return T(this,n),(r=t.call(this)).upstream=e,r.impl=new hJ(e),r}return E(n,[{key:"summary",value:function(){return this.impl.summary()}},{key:"next",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.impl.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(sJ),hJ=function(e){m(n,e);var t=y(n);function n(e){var r;if(T(this,n),(r=t.call(this)).upstream=e,Qs().get("IS_BROWSER"))r.decoder=new TextDecoder("utf-8");else{var a=require("string_decoder").StringDecoder;r.decoder=new a("utf8")}return p(r)}return E(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Utf8")}},{key:"pump",value:function(){var e=S(w().mark((function e(){var t,n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",!1);case 5:return n=t.value,e.abrupt("return",(r=Qs().get("IS_BROWSER")?this.decoder.decode(n,{stream:!0}):this.decoder.write(Buffer.from(n.buffer)),this.outputQueue.push(r),!0));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(IN),pJ=function(e){m(n,e);var t=y(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return T(this,n),(r=t.call(this)).file=e,r.options=a,ls(e instanceof Uint8Array||!!Qs().get("IS_BROWSER")&&(e instanceof File||e instanceof Blob),(function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."})),r.offset=a.offset||0,r.chunkSize=a.chunkSize||1048576,r}return E(n,[{key:"summary",value:function(){return"FileChunks ".concat(this.file)}},{key:"next",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size))){e.next=4;break}e.t0={value:null,done:!0},e.next=9;break;case 4:return e.next=6,new Promise((function(e,n){var r=t.offset+t.chunkSize;if(t.file instanceof Uint8Array)e(new Uint8Array(t.file.slice(t.offset,r)));else{var a=new FileReader;a.onload=function(t){var r=a.result;if(r instanceof ArrayBuffer&&(r=new Uint8Array(r)),!(r instanceof Uint8Array))return n(new TypeError("FileReader returned unknown type."));e(r)},a.onabort=function(e){return n(new Error("Aborted"))},a.onerror=function(e){return n(new Error(e.type))};var i=t.file.slice(t.offset,r);a.readAsArrayBuffer(i)}t.offset=r}));case 6:e.t1=e.sent,e.t2=!1,e.t0={value:e.t1,done:e.t2};case 9:return e.abrupt("return",e.t0);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(lJ);function fJ(e){return mJ.apply(this,arguments)}function mJ(){return mJ=S(w().mark((function e(t){var n,r,a,i,o,s,u=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>1&&void 0!==u[1]?u[1]:{},r=u.length>2?u[2]:void 0,"string"==typeof t?a=t:(a=t.url,i=vJ(t)),e.next=5,(r||ih)(a,i);case 5:if(!(o=e.sent).ok){e.next=15;break}return e.t0=Uint8Array,e.next=10,o.arrayBuffer();case 10:return e.t1=e.sent,s=new e.t0(e.t1),e.abrupt("return",new pJ(s,n));case 15:throw new Error(o.statusText);case 16:case"end":return e.stop()}}),e)}))),mJ.apply(this,arguments)}var vJ=function(e){return{method:e.method,headers:e.headers,body:e.body,mode:e.mode,credentials:e.credentials,cache:e.cache,redirect:e.redirect,referrer:e.referrer,integrity:e.integrity}};function gJ(e){return"string"==typeof e&&"file://"===e.slice(0,7)}var yJ=function(e){m(n,e);var t=y(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return T(this,n),(r=t.call(this)).input=e,r.options=a,r}return E(n,[{key:"iterator",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return gJ(this.input)&&Qs().get("IS_NODE")&&(t=require("fs"),this.input=t.readFileSync(this.input.slice(7))),e.abrupt("return",new pJ(this.input,this.options));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(oJ),bJ=function(e){m(n,e);var t=y(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return T(this,n),(r=t.call(this)).url=e,r.fileOptions=a,r}return E(n,[{key:"iterator",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",gJ(this.url)?new yJ(this.url,this.fileOptions).iterator():fJ(this.url,this.fileOptions));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(oJ);function xJ(){return xJ=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",iJ.create(t,n));case 1:case"end":return e.stop()}}),e)}))),xJ.apply(this,arguments)}function wJ(){return wJ=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",aJ.create(t));case 1:case"end":return e.stop()}}),e)}))),wJ.apply(this,arguments)}var kJ="3.21.0",SJ=Object.freeze(Object.defineProperty({__proto__:null,CSVDataset:rJ,Dataset:LN,FileDataSource:yJ,TextLineDataset:QQ,URLDataSource:bJ,array:function(e){return AN(S(w().mark((function t(){return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",lN(e));case 1:case"end":return t.stop()}}),t)}))),e.length)},csv:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new rJ(new bJ(e),t)},func:function(e){var t=dN(e);return AN(S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)}))))},generator:function(e){return AN(S(w().mark((function t(){var n;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e();case 2:return n=t.sent,t.abrupt("return",dN((function(){return n.next()})));case 4:case"end":return t.stop()}}),t)}))))},microphone:function(e){return wJ.apply(this,arguments)},version_data:kJ,webcam:function(e,t){return xJ.apply(this,arguments)},zip:function(e){if(!iN(e))throw new Error("The argument to zip() must be an object or array.");var t;if(Array.isArray(e))for(var n=0;n<e.length;n++)t=null==t?e[n].size:Math.min(t,e[n].size);else if(e instanceof Object)for(var r in e)t=null==t?e[r].size:Math.min(t,e[r].size);return AN(S(w().mark((function t(){var n;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,rN(e,(function(e){if(e instanceof LN)return{value:e.iterator(),recurse:!1};if(iN(e))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")}));case 2:return n=t.sent,t.abrupt("return",pN(n,fN.SHORTEST));case 4:case"end":return t.stop()}}),t)}))),t)}},Symbol.toStringTag,{value:"Module"})),TJ={"tfjs-core":cj,"tfjs-backend-cpu":"3.21.0","tfjs-backend-webgl":"3.21.0","tfjs-data":kJ,"tfjs-layers":sE,"tfjs-converter":YQ,tfjs:"3.21.0"},_J=Object.freeze(Object.defineProperty({__proto__:null,Abs:tu,Acos:nu,Acosh:ru,AdadeltaOptimizer:Rx,AdagradOptimizer:Lx,AdamOptimizer:Ax,AdamaxOptimizer:Px,Add:au,AddN:iu,All:ou,Any:su,ArgMax:uu,ArgMin:cu,Asin:lu,Asinh:du,Atan:hu,Atan2:fu,Atanh:pu,AvgPool:mu,AvgPool3D:gu,AvgPool3DGrad:yu,AvgPoolGrad:vu,BatchMatMul:bu,BatchToSpaceND:xu,Bincount:wu,BroadcastArgs:Su,BroadcastTo:ku,Callback:wY,CallbackList:kI,Cast:Tu,Ceil:_u,ClipByValue:Iu,Complex:Eu,ComplexAbs:Cu,Concat:Mu,Conv2D:Nu,Conv2DBackpropFilter:Ru,Conv2DBackpropInput:Lu,Conv3D:Au,Conv3DBackpropFilterV2:Pu,Conv3DBackpropInputV2:Du,Cos:Ou,Cosh:zu,CropAndResize:Wu,Cumprod:Fu,Cumsum:Gu,CustomCallback:_I,DataStorage:ns,DenseBincount:Vu,DepthToSpace:Uu,DepthwiseConv2dNative:Xu,DepthwiseConv2dNativeBackpropFilter:Bu,DepthwiseConv2dNativeBackpropInput:Hu,Diag:Zu,Dilation2D:Ku,Dilation2DBackpropFilter:Yu,Dilation2DBackpropInput:ju,get ENV(){return qs},EarlyStopping:TY,Einsum:Ju,Elu:qu,EluGrad:$u,Environment:js,Equal:tc,Erf:ec,Exp:nc,ExpandDims:rc,Expm1:ac,FFT:ic,Fill:oc,FlipLeftRight:sc,Floor:uc,FloorDiv:cc,FromPixels:ad,FusedBatchNorm:lc,FusedConv2D:sd,FusedDepthwiseConv2D:ud,GatherNd:hc,GatherV2:dc,GraphModel:ZQ,Greater:pc,GreaterEqual:fc,History:TI,IFFT:vc,Identity:mc,Imag:gc,InputSpec:H_,IsFinite:yc,IsInf:bc,IsNan:xc,KernelBackend:rs,LRN:Rc,LRNGrad:Lc,LayerVariable:U_,LayersModel:FE,LeakyRelu:wc,Less:kc,LessEqual:Sc,LinSpace:Tc,Log:_c,Log1p:Ic,LogSoftmax:Nc,LogicalAnd:Ec,LogicalNot:Cc,LogicalOr:Mc,LogicalXor:"LogicalXor",LowerBound:"LowerBound",Max:Ac,MaxPool:Dc,MaxPool3D:zc,MaxPool3DGrad:Fc,MaxPoolGrad:Oc,MaxPoolWithArgmax:Gc,Maximum:Pc,Mean:Wc,Min:Vc,Minimum:Uc,MirrorPad:Xc,Mod:Bc,MomentumOptimizer:Ox,Multinomial:Hc,Multiply:Zc,Neg:Kc,NonMaxSuppressionV3:Yc,NonMaxSuppressionV4:Qc,NonMaxSuppressionV5:Jc,NotEqual:jc,OP_SCOPE_SUFFIX:tp,OneHot:$c,OnesLike:qc,Optimizer:Nx,OptimizerConstructors:Gx,Pack:el,PadV2:tl,Pool:"Pool",Pow:nl,Prelu:rl,Prod:al,RMSPropOptimizer:zx,RNN:XC,RaggedGather:il,RaggedTensorToTensor:ol,Range:sl,get Rank(){return Th},Real:ul,RealDiv:Qu,Reciprocal:cl,get Reduction(){return ix},Relu:ll,Relu6:vl,Reshape:dl,ResizeBilinear:fl,ResizeBilinearGrad:ml,ResizeNearestNeighbor:hl,ResizeNearestNeighborGrad:pl,Reverse:gl,RotateWithOffset:id,Round:yl,Rsqrt:bl,SGDOptimizer:Dx,ScatterNd:xl,SearchSorted:wl,Select:kl,Selu:Sl,Sequential:HE,Sigmoid:Cl,Sign:El,Sin:_l,Sinh:Il,Slice:Tl,Softmax:Pl,Softplus:Ml,SpaceToBatchND:Ll,SparseFillEmptyRows:Dl,SparseReshape:Ol,SparseSegmentMean:zl,SparseSegmentSum:Fl,SparseToDense:Gl,SplitV:Al,Sqrt:Nl,Square:Vl,SquaredDifference:Wl,Step:rd,StridedSlice:Ul,StringNGrams:Xl,StringSplit:Bl,StringToHashBucketFast:Hl,Sub:Zl,Sum:Rl,SymbolicTensor:Z_,Tan:Kl,Tanh:jl,Tensor:kh,TensorBuffer:bh,Tile:Yl,TopK:Ql,Transform:Jl,Transpose:ql,Unique:$l,Unpack:ed,UnsortedSegmentSum:td,UpperBound:"UpperBound",Variable:Mh,ZerosLike:nd,_FusedMatMul:od,abs:Nm,acos:Rm,acosh:Lm,add:Im,addN:lj,all:Am,any:Pm,argMax:Dm,argMin:Om,asin:zm,asinh:Fm,atan:Gm,atan2:Wm,atanh:Vm,avgPool:rv,avgPool3d:av,backend:Df,backend_util:jw,basicLSTMCell:dj,batchNorm:dv,batchNorm2d:hv,batchNorm3d:pv,batchNorm4d:fv,batchToSpaceND:cv,bincount:mv,booleanMaskAsync:Kj,broadcastArgs:hj,broadcastTo:vv,broadcast_util:Bf,browser:Jf,buffer:df,callbacks:_Y,cast:hf,ceil:gv,clipByValue:bv,clone:pf,complex:rp,concat:iv,concat1d:xv,concat2d:wv,concat3d:kv,concat4d:Sv,constraints:rY,conv1d:_v,conv2d:Tv,conv2dTranspose:Ev,conv3d:Cv,conv3dTranspose:Nv,copyRegisteredKernels:function(e,t){fd(e).forEach((function(e){md(Object.assign({},e,{backendName:t}))}))},cos:Rv,cosh:Lv,cosineWindow:mb,cumprod:Av,cumsum:Pv,customGrad:Cg,data:SJ,denseBincount:pj,deprecationWarn:function(e){Qs().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")},depthToSpace:Dv,depthwiseConv2d:Ov,deregisterOp:function(e){delete IY[e]},device_util:jh,diag:fj,dilation2d:zv,disableDeprecationWarnings:function(){Qs().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")},dispose:Lf,disposeVariables:function(){Bh.disposeVariables()},div:Cm,divNoNan:Vv,dot:Uv,dropout:pb,einsum:mj,elu:Xv,enableDebugMode:function(){Qs().set("DEBUG",!0)},enableProdMode:function(){Qs().set("PROD",!0)},enclosingPowerOfTwo:fb,engine:Mf,env:Qs,equal:Fv,erf:Bv,euclideanNorm:ug,exp:cg,expandDims:lg,expm1:dg,eye:pg,fft:Ky,fill:yv,findBackend:function(e){return Bh.findBackend(e)},findBackendFactory:function(e){return Bh.findBackendFactory(e)},floor:fg,floorDiv:Em,fused:tY,gather:mg,gatherND:Jj,gather_util:$f,getBackend:function(){return Bh.backendName},getGradient:pd,getKernel:hd,getKernelsForBackend:fd,grad:function(e){return ls(Ds(e),(function(){return"The f passed in grad(f) must be a function"})),function(t,n){var r=$h(t,"x","tf.grad","string_or_numeric"),a=null!=n?$h(n,"dy","tf.grad"):null;return Bh.tidy((function(){var t=Bh.gradients((function(){return e(r)}),[r],a),n=t.value,i=t.grads;return null!=a&&ds(n.shape,a.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),Mg(i),i[0]}))}},grads:function(e){return ls(Ds(e),(function(){return"The f passed in grads(f) must be a function"})),function(t,n){ls(Array.isArray(t),(function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"}));var r=ep(t,"args","tf.grads","string_or_numeric"),a=null!=n?$h(n,"dy","tf.grads"):null;return Bh.tidy((function(){var t=Bh.gradients((function(){return e.apply(void 0,b(r))}),r,a),n=t.value,i=t.grads;return null!=a&&ds(n.shape,a.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Mg(i),i}))}},greater:vg,greaterEqual:gg,ifft:jy,imag:Of,image:_x,inTopKAsync:$j,initializers:aY,input:iY,io:$K,irfft:Yy,isFinite:yg,isInf:bg,isNaN:xg,keep:Af,kernel_impls:nY,layers:gY,leakyRelu:wg,less:kg,lessEqual:Sg,linalg:Ix,linspace:vj,loadGraphModel:function(e){return KQ.apply(this,arguments)},loadGraphModelSync:function(e){if(null==e)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide model artifacts or an IOHandler that loads the model");var t;if(e instanceof Array){var n=i(e,2),r=n[0],a=n[1];if(!r)throw new Error("modelJSON must be the first element of the array");if(!a||!(a instanceof ArrayBuffer))throw new Error("An ArrayBuffer of weights must be the second element of the array");if(!("modelTopology"in r))throw new Error("Model JSON is missing 'modelTopology'");if(!("weightsManifest"in r))throw new Error("Model JSON is missing 'weightsManifest'");t=qK(bp(r,Sp(r.weightsManifest),a))}else if("load"in e)t=e;else{if(!("modelTopology"in e&&"weightSpecs"in e&&"weightData"in e))throw new Error("Unknown model format");t=qK(e)}var o=new ZQ(t);return o.load(),o},loadLayersModel:function(e,t){return null==t&&(t={}),function(e,t){return VE.apply(this,arguments)}(e,t)},localResponseNormalization:Tg,log:_g,log1p:Ig,logSigmoid:Rg,logSoftmax:Ag,logSumExp:Pg,logicalAnd:Dg,logicalNot:Og,logicalOr:zg,logicalXor:Fg,losses:Ex,lowerBound:bj,matMul:Ef,math:tj,max:$v,maxPool:Gg,maxPool3d:Wg,maxPoolWithArgmax:xj,maximum:Vg,mean:Ug,memory:Nf,meshgrid:wj,metrics:yY,min:eg,minimum:Hg,mirrorPad:Zg,mod:Kg,model:function(e){return new FE(e)},models:bY,moments:jg,movingAverage:jj,mul:Mm,multiRNNCell:kj,multinomial:Sj,neg:zf,nextFrame:Ux,norm:sg,notEqual:Yg,oneHot:Cf,ones:Bg,onesLike:Qg,op:np,outerProduct:Tj,pad:Jg,pad1d:_j,pad2d:Ij,pad3d:Ej,pad4d:Cj,pool:$g,pow:tg,prelu:ey,print:ff,prod:ty,profile:function(e){return Bh.profile(e)},raggedGather:Mj,raggedTensorToTensor:Nj,rand:Rj,randomGamma:Lj,randomNormal:Cy,randomStandardNormal:Aj,randomUniform:My,range:Ny,ready:function(){return Bh.ready()},real:Ff,reciprocal:Ry,registerBackend:Pf,registerCallbackConstructor:function(e,t){EI.registerCallbackConstructor(e,t)},registerGradient:vd,registerKernel:md,registerOp:function(e,t){var n={tfOpName:e,category:"custom",inputs:[],attrs:[],customExecutor:t};IY[e]=n},regularizers:xY,relu:Ly,relu6:Ay,removeBackend:function(e){Bh.removeBackend(e)},reshape:nv,reverse:Py,reverse1d:Pj,reverse2d:Dj,reverse3d:Oj,reverse4d:zj,rfft:Jy,round:Dy,rsqrt:Oy,scalar:ng,scatterND:Yj,scatter_util:rm,searchSorted:yj,selu:zy,separableConv2d:Fy,sequential:function(e){return new HE(e)},serialization:_m,setBackend:function(e){return Bh.setBackend(e)},setPlatform:function(e,t){Qs().setPlatform(e,t)},setdiff1dAsync:Gj,sigmoid:ov,sign:Gy,signal:Tx,sin:Wy,sinh:Vy,slice:sv,slice1d:Uy,slice2d:Xy,slice3d:By,slice4d:Hy,slice_util:wm,softmax:Zy,softplus:Ng,spaceToBatchND:qg,sparse:Cx,sparseToDense:Qj,spectral:Sx,split:Qy,sqrt:rg,square:ag,squaredDifference:qy,squeeze:$y,stack:eb,step:tb,stridedSlice:nb,string:Mx,sub:Lg,sum:ig,sumOutType:Lh,tan:rb,tanh:uv,tensor:ip,tensor1d:ab,tensor2d:ib,tensor3d:Hf,tensor4d:Wj,tensor5d:Vj,tensor6d:Uj,tensor_util:Fh,test_util:uj,tidy:Rf,tile:hg,time:function(e){return Bh.time(e)},topk:ob,train:Wx,transpose:Gf,truncatedNormal:sb,unique:ub,unregisterGradient:function(e){if(!dd.has(e))throw new Error("The gradient '".concat(e,"' for backend is not registered"));dd.delete(e)},unregisterKernel:function(e,t){var n=gd(e,t);if(!ld.has(n))throw new Error("The kernel '".concat(e,"' for backend '").concat(t,"' is not registered"));ld.delete(n)},unsortedSegmentSum:cb,unstack:lb,upcastType:Rh,upperBound:Xj,util:uh,valueAndGrad:function(e){return ls(Ds(e),(function(){return"The f passed in valueAndGrad(f) must be a function"})),function(t,n){ls(t instanceof kh,(function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"})),ls(null==n||n instanceof kh,(function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"}));var r=Bh.gradients((function(){return e(t)}),[t],n),a=r.grads,i=r.value;return Mg(a),{grad:a[0],value:i}}},valueAndGrads:function(e){return ls(Ds(e),(function(){return"The f passed in valueAndGrads(f) must be a function"})),function(t,n){ls(Array.isArray(t)&&t.every((function(e){return e instanceof kh})),(function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"})),ls(null==n||n instanceof kh,(function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"}));var r=Bh.gradients((function(){return e.apply(void 0,b(t))}),t,n);return null!=n&&ds(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Mg(r.grads),r}},variable:db,variableGrads:Eg,version:TJ,version_converter:YQ,version_core:cj,version_layers:sE,where:Gv,whereAsync:Hj,zeros:Xg,zerosLike:Wv},Symbol.toStringTag,{value:"Module"})),IJ=new qt;IJ.compose(new kt,new wt,new kt(.001,.001,.001));var EJ=function(){function e(t){var n=t.container,r=t.imageTargetSrc,a=t.maxTrack,i=t.uiLoading,o=void 0===i?"yes":i,s=t.uiScanning,u=void 0===s?"yes":s,c=t.uiError,l=void 0===c?"yes":c,d=t.filterMinCF,h=void 0===d?null:d,p=t.filterBeta,f=void 0===p?null:p,m=t.warmupTolerance,v=void 0===m?null:m,g=t.missTolerance,y=void 0===g?null:g;T(this,e),this.container=n,this.imageTargetSrc=r,this.maxTrack=a,this.filterMinCF=h,this.filterBeta=f,this.warmupTolerance=v,this.missTolerance=y,this.ui=new es({uiLoading:o,uiScanning:u,uiError:l}),this.scene=new _o,this.cssScene=new _o,this.renderer=new So({antialias:!0,alpha:!0}),this.cssRenderer=new HK({antialias:!0}),this.renderer.outputEncoding=Me,this.renderer.setPixelRatio(window.devicePixelRatio),this.camera=new Lr,this.anchors=[],this.renderer.domElement.style.position="absolute",this.cssRenderer.domElement.style.position="absolute",this.container.appendChild(this.renderer.domElement),this.container.appendChild(this.cssRenderer.domElement),window.addEventListener("resize",this.resize.bind(this))}return E(e,[{key:"start",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ui.showLoading(),e.next=3,this._startVideo();case 3:return e.next=5,this._startAR();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){this.controller.stopProcessVideo(),this.video.srcObject.getTracks().forEach((function(e){e.stop()})),this.video.remove()}},{key:"addAnchor",value:function(e){var t=new vo;t.visible=!1,t.matrixAutoUpdate=!1;var n={group:t,targetIndex:e,onTargetFound:null,onTargetLost:null,onTargetUpdate:null,css:!1,visible:!1};return this.anchors.push(n),this.scene.add(t),n}},{key:"addCSSAnchor",value:function(e){var t=new vo;t.visible=!1,t.matrixAutoUpdate=!1;var n={group:t,targetIndex:e,onTargetFound:null,onTargetLost:null,onTargetUpdate:null,css:!0,visible:!1};return this.anchors.push(n),this.cssScene.add(t),n}},{key:"_startVideo",value:function(){var e=this;return new Promise((function(t,n){if(e.video=document.createElement("video"),e.video.setAttribute("autoplay",""),e.video.setAttribute("muted",""),e.video.setAttribute("playsinline",""),e.video.style.position="absolute",e.video.style.top="0px",e.video.style.left="0px",e.video.style.zIndex="-2",e.container.appendChild(e.video),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return e.ui.showCompatibility(),void n();navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment"}}).then((function(n){e.video.addEventListener("loadedmetadata",(function(){e.video.setAttribute("width",e.video.videoWidth),e.video.setAttribute("height",e.video.videoHeight),t()})),e.video.srcObject=n})).catch((function(e){console.log("getUserMedia error",e),n()}))}))}},{key:"_startAR",value:function(){var e=this;return new Promise(function(){var t=S(w().mark((function t(n,r){var a,o,s,u,c,l,d,h,p,f,m;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.video,e.container,e.controller=new GK({inputWidth:a.videoWidth,inputHeight:a.videoHeight,filterMinCF:e.filterMinCF,filterBeta:e.filterBeta,warmupTolerance:e.warmupTolerance,missTolerance:e.missTolerance,maxTrack:e.maxTrack,onUpdate:function(t){if("updateMatrix"===t.type){for(var n=t.targetIndex,r=t.worldMatrix,a=0;a<e.anchors.length;a++)if(e.anchors[a].targetIndex===n){if(e.anchors[a].css?e.anchors[a].group.children.forEach((function(e){e.element.style.visibility=null===r?"hidden":"visible"})):e.anchors[a].group.visible=null!==r,null!==r){var i=new qt;i.elements=b(r),i.multiply(e.postMatrixs[n]),e.anchors[a].css&&i.multiply(IJ),e.anchors[a].group.matrix=i}e.anchors[a].visible&&null===r&&(e.anchors[a].visible=!1,e.anchors[a].onTargetLost&&e.anchors[a].onTargetLost()),!e.anchors[a].visible&&null!==r&&(e.anchors[a].visible=!0,e.anchors[a].onTargetFound&&e.anchors[a].onTargetFound()),e.anchors[a].onTargetUpdate&&e.anchors[a].onTargetUpdate()}e.anchors.reduce((function(e,t){return e||t.visible}),!1)?e.ui.hideScanning():e.ui.showScanning()}}}),e.resize(),t.next=4,e.controller.addImageTargets(e.imageTargetSrc);case 4:for(o=t.sent,s=o.dimensions,e.postMatrixs=[],u=0;u<s.length;u++)c=new kt,l=new wt,d=new kt,h=i(s[u],2),p=h[0],f=h[1],c.x=p/2,c.y=p/2+(f-p)/2,d.x=p,d.y=p,d.z=p,(m=new qt).compose(c,l,d),e.postMatrixs.push(m);return t.next=10,e.controller.dummyRun(e.video);case 10:e.ui.hideLoading(),e.ui.showScanning(),e.controller.processVideo(e.video),n();case 14:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())}},{key:"resize",value:function(){var e=this.renderer,t=this.cssRenderer,n=this.camera,r=this.container,a=this.video;if(a){var i,o,s=a.videoWidth/a.videoHeight;s>r.clientWidth/r.clientHeight?i=(o=r.clientHeight)*s:o=(i=r.clientWidth)/s;var u=this.controller.getProjectionMatrix(),c=2*Math.atan(1/u[5]/o*r.clientHeight)*180/Math.PI,l=u[14]/(u[10]-1),d=u[14]/(u[10]+1);u[5],u[0],n.fov=c,n.near=l,n.far=d,n.aspect=r.clientWidth/r.clientHeight,n.updateProjectionMatrix(),a.style.top=-(o-r.clientHeight)/2+"px",a.style.left=-(i-r.clientWidth)/2+"px",a.style.width=i+"px",a.style.height=o+"px";var h=e.domElement,p=t.domElement;h.style.position="absolute",h.style.left=0,h.style.top=0,h.style.width=r.clientWidth+"px",h.style.height=r.clientHeight+"px",p.style.position="absolute",p.style.left=0,p.style.top=0,p.style.width=r.clientWidth+"px",p.style.height=r.clientHeight+"px",e.setSize(r.clientWidth,r.clientHeight),t.setSize(r.clientWidth,r.clientHeight)}}}]),e}();window.MINDAR||(window.MINDAR={}),window.MINDAR.IMAGE||(window.MINDAR.IMAGE={}),window.MINDAR.IMAGE.MindARThree=EJ,window.MINDAR.IMAGE.tf=_J;var CJ=null;function MJ(t){var n=(0,e.useRef)(null);return(0,e.useEffect)((function(){var e=new EJ({container:n.current,imageTargetSrc:"https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.0/examples/image-tracking/assets/card-example/card.mind"}),r=e.renderer,a=e.scene,i=e.camera,o=e.addAnchor(0),s=new Zr(1,.55),u=new Hn({color:65535,transparent:!0,opacity:.5}),c=new Sr(s,u);return o.onTargetFound=function(){CJ=o,t.callback("[EntryPoint]","WebGlBridgeDetected",0)},o.onTargetLost=function(){CJ=null,t.callback("[EntryPoint]","WebGlBridgeLost",0)},o.group.add(c),e.start(),r.setAnimationLoop((function(){if(r.render(a,i),CJ){var e=JSON.stringify(o.group.matrix);console.log(o.group.matrix),t.callback("[EntryPoint]","WebGlBridgeSetMatrix",e)}})),function(){}}),[]),(0,c.jsx)("div",{className:"mindar",style:{width:"100%",height:"100%",zIndex:0},ref:n})}function NJ(){var t=(0,u.JM)({loaderUrl:"./build/engine/ARAlbum.loader.js",dataUrl:"./build/engine/ARAlbum.data",frameworkUrl:"./build/engine/ARAlbum.framework.js",codeUrl:"./build/engine/ARAlbum.wasm",streamingAssetsUrl:"streamingassets"}),n=t.unityProvider,r=t.addEventListener,a=t.removeEventListener,o=t.sendMessage,s=t.loadingProgression,d=t.isLoaded,h=i((0,e.useState)(!0),2),p=h[0],f=h[1],m=Math.round(100*s),v=(0,e.useCallback)((function(){f(!1)}));return(0,e.useEffect)((function(){return r("OnStartEngine",v),function(){a("OnStartEngine",v)}}),[r,a,v]),(0,c.jsxs)("div",{className:"engine",children:[!1===d?(0,c.jsx)("div",{className:"loading-overlay",style:{zIndex:4},children:(0,c.jsxs)("p",{children:["Loading... (",m,"%)"]})}):"",(0,c.jsx)(u.Y4,{unityProvider:n,style:{width:"100%",height:"100vh",zIndex:3,position:"relative"}}),p?(0,c.jsx)(l,{isActive:p}):"",p?"":(0,c.jsx)(MJ,{callback:function(e,t,n){o(e,t,n)}})]})}var RJ=function(){return(0,c.jsx)("div",{className:"App",children:(0,c.jsx)(NJ,{})})},LJ=function(e){e&&e instanceof Function&&n.e(787).then(n.bind(n,787)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,i=t.getLCP,o=t.getTTFB;n(e),r(e),a(e),i(e),o(e)}))};t.createRoot(document.getElementById("root")).render((0,c.jsx)(RJ,{})),LJ()}()}();
//# sourceMappingURL=main.359810dd.js.map